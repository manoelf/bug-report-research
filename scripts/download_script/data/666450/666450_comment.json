{"comments": {}, "bugs": {"666450": {"comments": [{"author": "rudd-o@rudd-o.com", "creation_time": "2011-06-23T00:17:15Z", "time": "2011-06-23T00:17:15Z", "creator": "rudd-o@rudd-o.com", "id": 5549903, "count": 0, "is_private": false, "bug_id": 666450, "text": "User-Agent:       Mozilla/5.0 (X11; Linux x86_64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: Mozilla/5.0 (X11; WINDOWS, not Linux; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\n\nWhen FF starts up, the DLL is loaded, then immediately unloaded by FF upon startup:\n\n0[732140]: Loaded library C:\\Users\\Rudd-O\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\hob5ycuo.default\\extensions\\chunder@me.com\\components\\chunder_x86.dll (load lib)\n0[732140]: Unloaded library C:\\Users\\Rudd-O\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\hob5ycuo.default\\extensions\\chunder@me.com\\components\\chunder_x86.dll\n\nNever does the module get executed.  The module was built with the command line options in this post:\n\nhttp://stackoverflow.com/questions/6447487/xpcom-component-dll-loads-into-firefox-but-then-fails-to-register-its-class\n\nThis appears to be a bug in either Firefox, or the XULRunner SDK, or the documentation that fails to specify any magical incantations needed to make it work.  I am inclined to believe it is in Firefox.\n\nFOR THE RECORD: The very same module loads just fine into Firefox when compiled on Linux 64-bit Ubuntu.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. compile module with the above options\n2. install module in extensions folder, with proper manifest and all\n3. discover that FF4 is not fully loading the module -- open, load, unload, never execute entry point declared in symbol NSModule\n\n\nExpected Results:  \nThe class declared in my module should be available through Components.classes.", "tags": [], "raw_text": "User-Agent:       Mozilla/5.0 (X11; Linux x86_64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: Mozilla/5.0 (X11; WINDOWS, not Linux; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\n\nWhen FF starts up, the DLL is loaded, then immediately unloaded by FF upon startup:\n\n0[732140]: Loaded library C:\\Users\\Rudd-O\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\hob5ycuo.default\\extensions\\chunder@me.com\\components\\chunder_x86.dll (load lib)\n0[732140]: Unloaded library C:\\Users\\Rudd-O\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\hob5ycuo.default\\extensions\\chunder@me.com\\components\\chunder_x86.dll\n\nNever does the module get executed.  The module was built with the command line options in this post:\n\nhttp://stackoverflow.com/questions/6447487/xpcom-component-dll-loads-into-firefox-but-then-fails-to-register-its-class\n\nThis appears to be a bug in either Firefox, or the XULRunner SDK, or the documentation that fails to specify any magical incantations needed to make it work.  I am inclined to believe it is in Firefox.\n\nFOR THE RECORD: The very same module loads just fine into Firefox when compiled on Linux 64-bit Ubuntu.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. compile module with the above options\n2. install module in extensions folder, with proper manifest and all\n3. discover that FF4 is not fully loading the module -- open, load, unload, never execute entry point declared in symbol NSModule\n\n\nExpected Results:  \nThe class declared in my module should be available through Components.classes.", "attachment_id": null}, {"count": 1, "id": 5551084, "is_private": false, "time": "2011-06-23T15:16:48Z", "creation_time": "2011-06-23T15:16:48Z", "creator": "jorgev@fastmail.fm", "author": "jorgev@fastmail.fm", "attachment_id": null, "raw_text": "Did you declare the component in chrome.manifest? Have you read this: https://developer.mozilla.org/en/XPCOM/XPCOM_changes_in_Gecko_2.0?\n\nDoes this happen only in 4.0.1 or also 4.0?", "text": "Did you declare the component in chrome.manifest? Have you read this: https://developer.mozilla.org/en/XPCOM/XPCOM_changes_in_Gecko_2.0?\n\nDoes this happen only in 4.0.1 or also 4.0?", "bug_id": 666450, "tags": []}, {"count": 2, "id": 5551093, "is_private": false, "time": "2011-06-23T15:18:16Z", "creation_time": "2011-06-23T15:18:16Z", "creator": "rudd-o@rudd-o.com", "author": "rudd-o@rudd-o.com", "attachment_id": null, "raw_text": "This is my chrome.manifest:\n\nresource  chunderbrowserextension               content/\ncontent   chunderbrowserextension               content/\nlocale    chunderbrowserextension               en-US locale/en-US/\noverlay   chrome://browser/content/browser.xul  chrome://chunderbrowserextension/content/browser.xul\nmanifest  components/chunder.manifest\nbinary-component components/libchunder_x86.so           ABI=Linux_x86-gcc3\nbinary-component components/libchunder_x86_64.so        ABI=Linux_x86_64-gcc3\nbinary-component components/chunder_x86.dll             ABI=WINNT_x86-msvc\nbinary-component components/chunder_x86_64.dll          ABI=WINNT_x86_64-msvc\ninterfaces components/nsISoundSubsystem.xpt", "text": "This is my chrome.manifest:\n\nresource  chunderbrowserextension               content/\ncontent   chunderbrowserextension               content/\nlocale    chunderbrowserextension               en-US locale/en-US/\noverlay   chrome://browser/content/browser.xul  chrome://chunderbrowserextension/content/browser.xul\nmanifest  components/chunder.manifest\nbinary-component components/libchunder_x86.so           ABI=Linux_x86-gcc3\nbinary-component components/libchunder_x86_64.so        ABI=Linux_x86_64-gcc3\nbinary-component components/chunder_x86.dll             ABI=WINNT_x86-msvc\nbinary-component components/chunder_x86_64.dll          ABI=WINNT_x86_64-msvc\ninterfaces components/nsISoundSubsystem.xpt", "bug_id": 666450, "tags": []}, {"author": "rudd-o@rudd-o.com", "time": "2011-06-23T15:20:03Z", "creation_time": "2011-06-23T15:20:03Z", "creator": "rudd-o@rudd-o.com", "count": 3, "id": 5551098, "is_private": false, "tags": [], "bug_id": 666450, "text": "I do not know if it happens with firefox 4.0.  I did follow the somewhat confusing instructions in that Web page, they lead me to a module that loads flawlessly on Linux,", "raw_text": "I do not know if it happens with firefox 4.0.  I did follow the somewhat confusing instructions in that Web page, they lead me to a module that loads flawlessly on Linux,", "attachment_id": null}, {"id": 5551136, "count": 4, "is_private": false, "author": "rudd-o@rudd-o.com", "creation_time": "2011-06-23T15:35:18Z", "time": "2011-06-23T15:35:18Z", "creator": "rudd-o@rudd-o.com", "raw_text": "Module source:\n\n#include <xpcom-config.h>\n#include <mozilla/ModuleUtils.h>\n#include \"nsIClassInfoImpl.h\"\n#include \"nsSoundSubsystem.h\"\n\n/* FACTORY for a single interface module */\n/* after http://mxr.mozilla.org/mozilla-central/source/xpcom/sample/nsSampleModule.cpp */\n/* notes for firefox 4 after https://developer.mozilla.org/en/XPCOM/XPCOM_changes_in_Gecko_2.0 */\n\nNS_GENERIC_FACTORY_CONSTRUCTOR(nsSoundSubsystem)\n\nNS_DEFINE_NAMED_CID(NS_SOUNDSUBSYSTEM_CID);\n\nstatic const mozilla::Module::CIDEntry kSoundSubsystemCIDs[] = {\n    { &kNS_SOUNDSUBSYSTEM_CID, false, NULL, nsSoundSubsystemConstructor },\n    { NULL }\n};\n\nstatic const mozilla::Module::ContractIDEntry kSoundSubsystemContracts[] = {\n    { NS_SOUNDSUBSYSTEM_CONTRACTID, &kNS_SOUNDSUBSYSTEM_CID },\n    { NULL }\n};\n\n/*84 // Category entries are category/key/value triples which can be used\n85 // to register contract ID as content handlers or to observe certain\n86 // notifications. Most modules do not need to register any category\n87 // entries: this is just a sample of how you'd do it.\n88 // @see nsICategoryManager for information on retrieving category data.\n89 static const mozilla::Module::CategoryEntry kSampleCategories[] = {\n90     { \"my-category\", \"my-key\", NS_SAMPLE_CONTRACTID },\n91     { NULL }\n92 };*/\n\nstatic const mozilla::Module kSoundSubsystemModule = {\n    mozilla::Module::kVersion,\n    kSoundSubsystemCIDs,\n    kSoundSubsystemContracts\n};\n\nNSMODULE_DEFN(nsSoundSubsystemModule) = &kSoundSubsystemModule;\n\n/*\n105 // The following line implements the one-and-only \"NSGetModule\" symbol\n106 // for compatibility with mozilla 1.9.2. You should only use this\n107 // if you need a binary which is backwards-compatible and if you use\n108 // interfaces carefully across multiple versions.\n109 NS_IMPL_MOZILLA192_NSGETMODULE(&kSampleModule)\n110*/", "attachment_id": null, "text": "Module source:\n\n#include <xpcom-config.h>\n#include <mozilla/ModuleUtils.h>\n#include \"nsIClassInfoImpl.h\"\n#include \"nsSoundSubsystem.h\"\n\n/* FACTORY for a single interface module */\n/* after http://mxr.mozilla.org/mozilla-central/source/xpcom/sample/nsSampleModule.cpp */\n/* notes for firefox 4 after https://developer.mozilla.org/en/XPCOM/XPCOM_changes_in_Gecko_2.0 */\n\nNS_GENERIC_FACTORY_CONSTRUCTOR(nsSoundSubsystem)\n\nNS_DEFINE_NAMED_CID(NS_SOUNDSUBSYSTEM_CID);\n\nstatic const mozilla::Module::CIDEntry kSoundSubsystemCIDs[] = {\n    { &kNS_SOUNDSUBSYSTEM_CID, false, NULL, nsSoundSubsystemConstructor },\n    { NULL }\n};\n\nstatic const mozilla::Module::ContractIDEntry kSoundSubsystemContracts[] = {\n    { NS_SOUNDSUBSYSTEM_CONTRACTID, &kNS_SOUNDSUBSYSTEM_CID },\n    { NULL }\n};\n\n/*84 // Category entries are category/key/value triples which can be used\n85 // to register contract ID as content handlers or to observe certain\n86 // notifications. Most modules do not need to register any category\n87 // entries: this is just a sample of how you'd do it.\n88 // @see nsICategoryManager for information on retrieving category data.\n89 static const mozilla::Module::CategoryEntry kSampleCategories[] = {\n90     { \"my-category\", \"my-key\", NS_SAMPLE_CONTRACTID },\n91     { NULL }\n92 };*/\n\nstatic const mozilla::Module kSoundSubsystemModule = {\n    mozilla::Module::kVersion,\n    kSoundSubsystemCIDs,\n    kSoundSubsystemContracts\n};\n\nNSMODULE_DEFN(nsSoundSubsystemModule) = &kSoundSubsystemModule;\n\n/*\n105 // The following line implements the one-and-only \"NSGetModule\" symbol\n106 // for compatibility with mozilla 1.9.2. You should only use this\n107 // if you need a binary which is backwards-compatible and if you use\n108 // interfaces carefully across multiple versions.\n109 NS_IMPL_MOZILLA192_NSGETMODULE(&kSampleModule)\n110*/", "bug_id": 666450, "tags": []}, {"attachment_id": null, "raw_text": "May I add that the DLL is being opened on Windows when firefox starts, it just gets loaded then immediately unloaded (but JUST on windows):\n\n\t\nFirefox NSPR log: [732140]: Loaded library C:\\Users\\Rudd-O\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\hob5ycuo.default\\extensions\\chunder@m\u200c\u200be.com\\components\\chunder_x86.dll (load lib) [732140]: Unloaded library C:\\Users\\Rudd-O\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\hob5ycuo.default\\extensions\\chunder@m\u200c\u200be.com\\components\\chunder_x86.dll", "text": "May I add that the DLL is being opened on Windows when firefox starts, it just gets loaded then immediately unloaded (but JUST on windows):\n\n\t\nFirefox NSPR log: [732140]: Loaded library C:\\Users\\Rudd-O\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\hob5ycuo.default\\extensions\\chunder@m\u200c\u200be.com\\components\\chunder_x86.dll (load lib) [732140]: Unloaded library C:\\Users\\Rudd-O\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\hob5ycuo.default\\extensions\\chunder@m\u200c\u200be.com\\components\\chunder_x86.dll", "bug_id": 666450, "tags": [], "id": 5551263, "count": 5, "is_private": false, "time": "2011-06-23T16:22:32Z", "creation_time": "2011-06-23T16:22:32Z", "creator": "rudd-o@rudd-o.com", "author": "rudd-o@rudd-o.com"}, {"raw_text": "Workaround:\n\nThe way to make the plugin load on firefox:\n\nstatic const mozilla::Module kSoundSubsystemModule = {\n    2, /* mozilla::Module::kVersion is 1 in the SDK, WTF, */\n    kSoundSubsystemCIDs,\n    kSoundSubsystemContracts\n};\n\nThis MUST be a bug, because 1 works fine on Linux, but 2 must be used on Windows.  Also, people must not be writing many XPCOM extensions in binary language, since nobody noticed it or seems to have reported it.", "attachment_id": null, "tags": [], "text": "Workaround:\n\nThe way to make the plugin load on firefox:\n\nstatic const mozilla::Module kSoundSubsystemModule = {\n    2, /* mozilla::Module::kVersion is 1 in the SDK, WTF, */\n    kSoundSubsystemCIDs,\n    kSoundSubsystemContracts\n};\n\nThis MUST be a bug, because 1 works fine on Linux, but 2 must be used on Windows.  Also, people must not be writing many XPCOM extensions in binary language, since nobody noticed it or seems to have reported it.", "bug_id": 666450, "is_private": false, "count": 6, "id": 5555466, "author": "rudd-o@rudd-o.com", "creator": "rudd-o@rudd-o.com", "creation_time": "2011-06-24T23:56:10Z", "time": "2011-06-24T23:56:10Z"}, {"count": 7, "id": 5559932, "is_private": false, "author": "jorgev@fastmail.fm", "creation_time": "2011-06-27T21:58:27Z", "time": "2011-06-27T21:58:27Z", "creator": "jorgev@fastmail.fm", "raw_text": "Moving to Core > XPCOM. It sounds to me like we should be checking for the right kVersion on all platforms but we're only doing it on Windows.", "attachment_id": null, "text": "Moving to Core > XPCOM. It sounds to me like we should be checking for the right kVersion on all platforms but we're only doing it on Windows.", "bug_id": 666450, "tags": []}, {"is_private": false, "id": 5559979, "count": 8, "author": "rudd-o@rudd-o.com", "creator": "rudd-o@rudd-o.com", "creation_time": "2011-06-27T22:12:04Z", "time": "2011-06-27T22:12:04Z", "raw_text": "I don't get it.  Does this mean I am using the wrong SDK software?  I followed the instructions and mozilla::module::kversion is defined as 1, but this clearly does NOT WORK.", "attachment_id": null, "tags": [], "text": "I don't get it.  Does this mean I am using the wrong SDK software?  I followed the instructions and mozilla::module::kversion is defined as 1, but this clearly does NOT WORK.", "bug_id": 666450}, {"creator": "jorgev@fastmail.fm", "time": "2011-06-27T22:50:25Z", "creation_time": "2011-06-27T22:50:25Z", "author": "jorgev@fastmail.fm", "tags": [], "text": "Ah, yes, this is for 4.0.1. I think the kVersion bump happened in 5.0, so it's the other way around. kVersion = 1 should work on those cases.", "bug_id": 666450, "attachment_id": null, "is_private": false, "id": 5560094, "count": 9, "raw_text": "Ah, yes, this is for 4.0.1. I think the kVersion bump happened in 5.0, so it's the other way around. kVersion = 1 should work on those cases."}, {"author": "rudd-o@rudd-o.com", "creator": "rudd-o@rudd-o.com", "time": "2011-06-28T01:26:43Z", "creation_time": "2011-06-28T01:26:43Z", "is_private": false, "id": 5560551, "count": 10, "tags": [], "text": "Yeah but kVersion 1 does NOT work.  That is the bug.  Only when hardcoded to kVersion = 2 it works.", "bug_id": 666450, "raw_text": "Yeah but kVersion 1 does NOT work.  That is the bug.  Only when hardcoded to kVersion = 2 it works.", "attachment_id": null}]}}}