{"bugs": {"702678": {"comments": [{"attachment_id": null, "time": "2011-11-15T18:17:39Z", "text": "This is a spin-off of bug 629500, and the patch I will add as soon as I know the bug number used to be part of that patch series.\n\nIn that bug, I removed the mechanism that the print preview tests (layout/base/tests/chrome/*printpreview*) were using to detect when they wouldn't work, so instead I just ran them unconditionally, on the theory that the print preview infrastructure ought to work even when we don't expose \"print preview\" as a UI command (OSX).  That was working fine, but has since started failing on our Windows XP build robots.  My suspicion is that those don't have any configured printers, and for some reason this makes nsIWebBrowserPrint::PrintPreview() hang, which seems like a bug in its own right.  But perhaps one to be addressed separately.  Hence this spin-off.\n\nThe patch I'll add doesn't fix the above problem, but it modernizes the print preview tests a bit -- notably going through the docshell to get a nsIWebBrowserPrint that's properly initialized -- and fixes one of them so it actually tests what it's supposed to (a previous mass change accidentally deleted a critical HTML snippet).  Hopefully this will make it easier to pin down the problem.", "creation_time": "2011-11-15T18:17:39Z", "raw_text": "This is a spin-off of bug 629500, and the patch I will add as soon as I know the bug number used to be part of that patch series.\n\nIn that bug, I removed the mechanism that the print preview tests (layout/base/tests/chrome/*printpreview*) were using to detect when they wouldn't work, so instead I just ran them unconditionally, on the theory that the print preview infrastructure ought to work even when we don't expose \"print preview\" as a UI command (OSX).  That was working fine, but has since started failing on our Windows XP build robots.  My suspicion is that those don't have any configured printers, and for some reason this makes nsIWebBrowserPrint::PrintPreview() hang, which seems like a bug in its own right.  But perhaps one to be addressed separately.  Hence this spin-off.\n\nThe patch I'll add doesn't fix the above problem, but it modernizes the print preview tests a bit -- notably going through the docshell to get a nsIWebBrowserPrint that's properly initialized -- and fixes one of them so it actually tests what it's supposed to (a previous mass change accidentally deleted a critical HTML snippet).  Hopefully this will make it easier to pin down the problem.", "bug_id": 702678, "id": 5849830, "is_private": false, "count": 0, "tags": [], "author": "zackw@panix.com", "creator": "zackw@panix.com"}, {"raw_text": "Forgot to mention that this also adds a bunch of defensive try/catch statements to the tests.  I was hoping that these would convert the XP timeouts into plain failures, but they don't, alas; still, I think they are worthy.\n\nI do not have any computers with Windows XP on them, and even if I did, I suspect the problem may be specific to our build farm's configuration.", "creation_time": "2011-11-15T18:22:35Z", "time": "2011-11-15T18:22:35Z", "attachment_id": 574618, "text": "Created attachment 574618\n1/n: overhaul print preview tests and run them unconditionally\n\nForgot to mention that this also adds a bunch of defensive try/catch statements to the tests.  I was hoping that these would convert the XP timeouts into plain failures, but they don't, alas; still, I think they are worthy.\n\nI do not have any computers with Windows XP on them, and even if I did, I suspect the problem may be specific to our build farm's configuration.", "id": 5849842, "is_private": false, "count": 1, "tags": [], "bug_id": 702678, "author": "zackw@panix.com", "creator": "zackw@panix.com"}, {"author": "zackw@panix.com", "creator": "zackw@panix.com", "time": "2011-11-15T18:24:02Z", "attachment_id": null, "text": "The expectation here is that there will be a second code-changing patch that fixes the source of the XP hangs, once we figure out what that is.", "raw_text": "The expectation here is that there will be a second code-changing patch that fixes the source of the XP hangs, once we figure out what that is.", "creation_time": "2011-11-15T18:24:02Z", "bug_id": 702678, "id": 5849846, "count": 2, "is_private": false, "tags": []}, {"bug_id": 702678, "id": 5850757, "count": 3, "is_private": false, "tags": [], "attachment_id": null, "time": "2011-11-15T22:40:28Z", "text": "Try run for 460971226266 is complete.\nDetailed breakdown of the results available here:\n    https://tbpl.mozilla.org/?tree=Try&rev=460971226266\nResults (out of 209 total builds):\n    success: 192\n    warnings: 17\nBuilds available at http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/zackw@panix.com-460971226266", "creation_time": "2011-11-15T22:40:28Z", "raw_text": "Try run for 460971226266 is complete.\nDetailed breakdown of the results available here:\n    https://tbpl.mozilla.org/?tree=Try&rev=460971226266\nResults (out of 209 total builds):\n    success: 192\n    warnings: 17\nBuilds available at http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/zackw@panix.com-460971226266", "author": "release@mozilla.com", "creator": "release@mozilla.com"}, {"creator": "zackw@panix.com", "author": "zackw@panix.com", "raw_text": "Logs for XP hangs from the above build cycle:\n\nhttps://tbpl.mozilla.org/php/getParsedLog.php?id=7409665&tree=Try (opt)\nhttps://tbpl.mozilla.org/php/getParsedLog.php?id=7410371&tree=Try (debug)\n\nThe Ru failure appears to be unrelated (bug 696670, bug 696671, bug 696673, bug 696674).", "creation_time": "2011-11-15T23:05:40Z", "text": "Logs for XP hangs from the above build cycle:\n\nhttps://tbpl.mozilla.org/php/getParsedLog.php?id=7409665&tree=Try (opt)\nhttps://tbpl.mozilla.org/php/getParsedLog.php?id=7410371&tree=Try (debug)\n\nThe Ru failure appears to be unrelated (bug 696670, bug 696671, bug 696673, bug 696674).", "attachment_id": null, "time": "2011-11-15T23:05:40Z", "is_private": false, "count": 4, "tags": [], "id": 5850861, "bug_id": 702678}, {"creator": "bugs@pettay.fi", "author": "bugs@pettay.fi", "creation_time": "2012-05-23T08:25:58Z", "raw_text": "So, this bug is still waiting for the fix for the hang problem.", "text": "Comment on attachment 574618\n1/n: overhaul print preview tests and run them unconditionally\n\nSo, this bug is still waiting for the fix for the hang problem.", "time": "2012-05-23T08:25:58Z", "attachment_id": 574618, "count": 5, "is_private": false, "tags": [], "id": 6330367, "bug_id": 702678}, {"text": "Zack, I think you should submit to Try to check were we stand (wrt the hang).\n\nPS: If necessary, I currently have a WinXP with no printer (to run checks/tests)...", "creator": "bugzillamozillaorg_serge_20140323@gautherie.fr", "author": "bugzillamozillaorg_serge_20140323@gautherie.fr", "time": "2012-05-24T07:25:18Z", "attachment_id": null, "raw_text": "Zack, I think you should submit to Try to check were we stand (wrt the hang).\n\nPS: If necessary, I currently have a WinXP with no printer (to run checks/tests)...", "creation_time": "2012-05-24T07:25:18Z", "bug_id": 702678, "tags": [], "count": 6, "is_private": false, "id": 6333850}, {"attachment_id": 627102, "time": "2012-05-25T04:58:43Z", "text": "Created attachment 627102\nscreen shot of hung test_printpreview.xul on winxp\n\nTry server is being very, very slow today, but the relevant tests do indeed still fail on our Windows XP testers:\n\n11787 ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | Test timed out.\n11791 ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview_bug396024.xul | Test timed out.\n11795 ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview_bug482976.xul | Test timed out.\n\nSome kind soul has arranged for them to take screen shots when this happens and stick them into the build log; that's the attachment.  It looks like the problem is indeed that there are no configured printers and this wedges the test.  Tomorrow, I will try to find the code that's producing the offending dialog box.", "raw_text": "Try server is being very, very slow today, but the relevant tests do indeed still fail on our Windows XP testers:\n\n11787 ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | Test timed out.\n11791 ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview_bug396024.xul | Test timed out.\n11795 ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview_bug482976.xul | Test timed out.\n\nSome kind soul has arranged for them to take screen shots when this happens and stick them into the build log; that's the attachment.  It looks like the problem is indeed that there are no configured printers and this wedges the test.  Tomorrow, I will try to find the code that's producing the offending dialog box.", "creation_time": "2012-05-25T04:58:43Z", "bug_id": 702678, "id": 6337320, "count": 7, "is_private": false, "tags": [], "author": "zackw@panix.com", "creator": "zackw@panix.com"}, {"author": "bugzillamozillaorg_serge_20140323@gautherie.fr", "creator": "bugzillamozillaorg_serge_20140323@gautherie.fr", "attachment_id": null, "time": "2012-05-25T07:36:51Z", "text": "(In reply to Zack Weinberg (:zwol) from comment #7)\n\n> Some kind soul has arranged for them to take screen shots when this happens\n\nBug 589668 :-)\n\n> It looks like the problem is indeed that there are no configured printers\n\nYeah:\n\"Print Preview Error // There must be at least one printer available to show Print Preview.\"\nWindows alert is quite obvious ;->\n\n> I will try to find the code that's producing the offending dialog box.\n\nSee\nhttp://mxr.mozilla.org/mozilla-central/search?string=NS_ERROR_GFX_PRINTER_PRINTPREVIEW&case=on", "raw_text": "(In reply to Zack Weinberg (:zwol) from comment #7)\n\n> Some kind soul has arranged for them to take screen shots when this happens\n\nBug 589668 :-)\n\n> It looks like the problem is indeed that there are no configured printers\n\nYeah:\n\"Print Preview Error // There must be at least one printer available to show Print Preview.\"\nWindows alert is quite obvious ;->\n\n> I will try to find the code that's producing the offending dialog box.\n\nSee\nhttp://mxr.mozilla.org/mozilla-central/search?string=NS_ERROR_GFX_PRINTER_PRINTPREVIEW&case=on", "creation_time": "2012-05-25T07:36:51Z", "bug_id": 702678, "id": 6337499, "is_private": false, "count": 8, "tags": []}, {"creation_time": "2012-05-25T07:44:55Z", "raw_text": "Review of attachment 574618:\n-----------------------------------------------------------------\n\n::: layout/base/tests/chrome/printpreview_bug396024_helper.xul\n@@ -67,5 @@\n> -    finish();\n> -    return;\n> -  }\n> -\n> -  if (printService.defaultPrinterName != '') {\n\nThe regression would seem to be that you removed this check... (in the 3 helper files)", "text": "Comment on attachment 574618\n1/n: overhaul print preview tests and run them unconditionally\n\nReview of attachment 574618:\n-----------------------------------------------------------------\n\n::: layout/base/tests/chrome/printpreview_bug396024_helper.xul\n@@ -67,5 @@\n> -    finish();\n> -    return;\n> -  }\n> -\n> -  if (printService.defaultPrinterName != '') {\n\nThe regression would seem to be that you removed this check... (in the 3 helper files)", "creator": "bugzillamozillaorg_serge_20140323@gautherie.fr", "author": "bugzillamozillaorg_serge_20140323@gautherie.fr", "time": "2012-05-25T07:44:55Z", "attachment_id": 574618, "tags": [], "count": 9, "is_private": false, "id": 6337508, "bug_id": 702678}, {"id": 6338421, "tags": [], "count": 10, "is_private": false, "bug_id": 702678, "raw_text": "(In reply to Serge Gautherie (:sgautherie) from comment #9)\n> \n> The regression would seem to be that you removed this check... (in the 3\n> helper files)\n\nYeah, because printService.defaultPrinterName is going away in bug 629500.  We need to do something else now.  The original theory was that we *shouldn't* need any configured printers to do a print preview.\n\n> See\n> http://mxr.mozilla.org/mozilla-central/search?string=NS_ERROR_GFX_PRINTER_PRINTPREVIEW&case=on\n\nThanks.", "creation_time": "2012-05-25T15:18:28Z", "time": "2012-05-25T15:18:28Z", "attachment_id": null, "text": "(In reply to Serge Gautherie (:sgautherie) from comment #9)\n> \n> The regression would seem to be that you removed this check... (in the 3\n> helper files)\n\nYeah, because printService.defaultPrinterName is going away in bug 629500.  We need to do something else now.  The original theory was that we *shouldn't* need any configured printers to do a print preview.\n\n> See\n> http://mxr.mozilla.org/mozilla-central/search?string=NS_ERROR_GFX_PRINTER_PRINTPREVIEW&case=on\n\nThanks.", "author": "zackw@panix.com", "creator": "zackw@panix.com"}, {"creation_time": "2012-05-25T15:26:08Z", "raw_text": "https://tbpl.mozilla.org/?tree=Try&rev=9cbc24038b13 has the complete try results now.", "time": "2012-05-25T15:26:08Z", "attachment_id": null, "text": "https://tbpl.mozilla.org/?tree=Try&rev=9cbc24038b13 has the complete try results now.", "id": 6338469, "tags": [], "is_private": false, "count": 11, "bug_id": 702678, "author": "zackw@panix.com", "creator": "zackw@panix.com"}, {"creator": "zackw@panix.com", "author": "zackw@panix.com", "creation_time": "2012-05-25T18:19:30Z", "raw_text": "New patch series coming shortly.", "text": "Comment on attachment 574618\n1/n: overhaul print preview tests and run them unconditionally\n\nNew patch series coming shortly.", "time": "2012-05-25T18:19:30Z", "attachment_id": 574618, "tags": [], "is_private": false, "count": 12, "id": 6339094, "bug_id": 702678}, {"creator": "zackw@panix.com", "author": "zackw@panix.com", "is_private": false, "count": 13, "tags": [], "id": 6339104, "bug_id": 702678, "raw_text": "Part 1: run the print preview tests unconditionally, and convert all exceptions into failures.  (It seems to me that SimpleTest ought to do this for us, but I guess at least this way I have a chance to make sure everything is torn down properly.)", "creation_time": "2012-05-25T18:21:14Z", "text": "Created attachment 627301\n1/3: run print preview tests unconditionally, make more robust\n\nPart 1: run the print preview tests unconditionally, and convert all exceptions into failures.  (It seems to me that SimpleTest ought to do this for us, but I guess at least this way I have a chance to make sure everything is torn down properly.)", "attachment_id": 627301, "time": "2012-05-25T18:21:14Z"}, {"is_private": false, "count": 14, "tags": [], "id": 6339107, "bug_id": 702678, "creation_time": "2012-05-25T18:22:18Z", "raw_text": "Hat tip to dolske for the technique (borrowed from the password manager tests).", "text": "Created attachment 627302\n2/3: Make print preview tests fail, rather than hanging, if the print engine's modal error dialog appears.\n\nHat tip to dolske for the technique (borrowed from the password manager tests).", "attachment_id": 627302, "time": "2012-05-25T18:22:18Z", "creator": "zackw@panix.com", "author": "zackw@panix.com"}, {"tags": [], "is_private": false, "count": 15, "id": 6339118, "bug_id": 702678, "creation_time": "2012-05-25T18:24:51Z", "raw_text": "Having thoroughly buttressed the tests, the actual _fix_ here is just to nuke NS_ERROR_GFX_PRINTER_PRINTPREVIEW and make nsDeviceContextSpecWin::Init succeed even if there is no printer configured, as long as we're just doing print preview.  (This is consistent with all the other platforms.)", "text": "Created attachment 627304\nwhen doing print preview, don't fail nsDeviceContextSpecWin::Init just because there is no configured printer. (Makes Windows consistent with all other platforms.)\n\nHaving thoroughly buttressed the tests, the actual _fix_ here is just to nuke NS_ERROR_GFX_PRINTER_PRINTPREVIEW and make nsDeviceContextSpecWin::Init succeed even if there is no printer configured, as long as we're just doing print preview.  (This is consistent with all the other platforms.)", "attachment_id": 627304, "time": "2012-05-25T18:24:51Z", "creator": "zackw@panix.com", "author": "zackw@panix.com"}, {"author": "zackw@panix.com", "creator": "zackw@panix.com", "bug_id": 702678, "id": 6339129, "tags": [], "count": 16, "is_private": false, "attachment_id": null, "time": "2012-05-25T18:26:38Z", "text": "I locally verified that with parts 1 and 2, the tests still pass when nsDeviceContextSpecG::Init works, and fail promptly and without leaving any detritus when nsDeviceContextSpecG::Init is hacked to always fail.  Try server builds are running now, and hopefully will actually post results this time.", "raw_text": "I locally verified that with parts 1 and 2, the tests still pass when nsDeviceContextSpecG::Init works, and fail promptly and without leaving any detritus when nsDeviceContextSpecG::Init is hacked to always fail.  Try server builds are running now, and hopefully will actually post results this time.", "creation_time": "2012-05-25T18:26:38Z"}, {"creation_time": "2012-05-25T18:33:52Z", "raw_text": "Review of attachment 627302:\n-----------------------------------------------------------------\n\n::: layout/base/tests/chrome/printpreview_common.js\n@@ +85,5 @@\n> +            var childDoc = childDocShell.QueryInterface(Ci.nsIDocShell)\n> +                .contentViewer\n> +                .DOMDocument;\n> +            if (childDoc.location.href ===\n> +                \"chrome://global/content/commonDialog.xul\")\n\nSo the error dialog you're looking for is a standard commonDialog.xul (ie, the print stuff was just using prompt service's .alert() or whatever). I assumed it was something different, but same approach wfm either way! :)", "attachment_id": 627302, "time": "2012-05-25T18:33:52Z", "text": "Comment on attachment 627302\n2/3: Make print preview tests fail, rather than hanging, if the print engine's modal error dialog appears.\n\nReview of attachment 627302:\n-----------------------------------------------------------------\n\n::: layout/base/tests/chrome/printpreview_common.js\n@@ +85,5 @@\n> +            var childDoc = childDocShell.QueryInterface(Ci.nsIDocShell)\n> +                .contentViewer\n> +                .DOMDocument;\n> +            if (childDoc.location.href ===\n> +                \"chrome://global/content/commonDialog.xul\")\n\nSo the error dialog you're looking for is a standard commonDialog.xul (ie, the print stuff was just using prompt service's .alert() or whatever). I assumed it was something different, but same approach wfm either way! :)", "id": 6339153, "is_private": false, "count": 17, "tags": [], "bug_id": 702678, "author": "jdinbox@gmail.com", "creator": "jdinbox@gmail.com"}, {"creation_time": "2012-05-25T18:38:11Z", "raw_text": "(In reply to Justin Dolske [:Dolske] from comment #17)\n> Comment on attachment 627302\n...\n> So the error dialog you're looking for is a standard commonDialog.xul (ie,\n> the print stuff was just using prompt service's .alert() or whatever). I\n> assumed it was something different, but same approach wfm either way! :)\n\nYes, it is exactly using prompt service's .alert().  Via the deprecated window watcher methods, but I think I'll leave that as is till I get to bug 650960.", "text": "(In reply to Justin Dolske [:Dolske] from comment #17)\n> Comment on attachment 627302\n...\n> So the error dialog you're looking for is a standard commonDialog.xul (ie,\n> the print stuff was just using prompt service's .alert() or whatever). I\n> assumed it was something different, but same approach wfm either way! :)\n\nYes, it is exactly using prompt service's .alert().  Via the deprecated window watcher methods, but I think I'll leave that as is till I get to bug 650960.", "time": "2012-05-25T18:38:11Z", "attachment_id": null, "count": 18, "is_private": false, "tags": [], "id": 6339174, "bug_id": 702678, "creator": "zackw@panix.com", "author": "zackw@panix.com"}, {"id": 6339187, "tags": [], "is_private": false, "count": 19, "bug_id": 702678, "raw_text": "My review powers don't extend into widget land, though this looks like it's _mostly_ just a rubberstamp. Perhaps you can find someone on IRC to do so within minutes. :)", "creation_time": "2012-05-25T18:40:34Z", "attachment_id": 627304, "time": "2012-05-25T18:40:34Z", "text": "Comment on attachment 627304\nwhen doing print preview, don't fail nsDeviceContextSpecWin::Init just because there is no configured printer. (Makes Windows consistent with all other platforms.)\n\nMy review powers don't extend into widget land, though this looks like it's _mostly_ just a rubberstamp. Perhaps you can find someone on IRC to do so within minutes. :)", "author": "jdinbox@gmail.com", "creator": "jdinbox@gmail.com"}, {"bug_id": 702678, "is_private": false, "count": 20, "tags": [], "id": 6339223, "text": "(In reply to Justin Dolske [:Dolske] from comment #19)\n> ... this looks like it's\n> _mostly_ just a rubberstamp. Perhaps you can find someone on IRC to do so\n> within minutes. :)\n\nLet's not be too hasty; for all I know that doesn't even compile, let alone solve the problem.  I'll worry about getting it reviewed if tryserver is happy with it.", "time": "2012-05-25T18:50:26Z", "attachment_id": null, "creation_time": "2012-05-25T18:50:26Z", "raw_text": "(In reply to Justin Dolske [:Dolske] from comment #19)\n> ... this looks like it's\n> _mostly_ just a rubberstamp. Perhaps you can find someone on IRC to do so\n> within minutes. :)\n\nLet's not be too hasty; for all I know that doesn't even compile, let alone solve the problem.  I'll worry about getting it reviewed if tryserver is happy with it.", "creator": "zackw@panix.com", "author": "zackw@panix.com"}, {"creation_time": "2012-05-25T19:27:20Z", "raw_text": "(In reply to Zack Weinberg (:zwol) from comment #13)\n> It seems to me that SimpleTest ought to do this for us\n\nThat looks like bug 718205, doesn't it?", "text": "(In reply to Zack Weinberg (:zwol) from comment #13)\n> It seems to me that SimpleTest ought to do this for us\n\nThat looks like bug 718205, doesn't it?", "creator": "bugzillamozillaorg_serge_20140323@gautherie.fr", "author": "bugzillamozillaorg_serge_20140323@gautherie.fr", "attachment_id": null, "time": "2012-05-25T19:27:20Z", "tags": [], "is_private": false, "count": 21, "id": 6339361, "bug_id": 702678}, {"author": "bugzillamozillaorg_serge_20140323@gautherie.fr", "creator": "bugzillamozillaorg_serge_20140323@gautherie.fr", "id": 6339408, "is_private": false, "count": 22, "tags": [], "bug_id": 702678, "raw_text": "Review of attachment 627302:\n-----------------------------------------------------------------\n\n::: layout/base/tests/chrome/printpreview_bug396024_helper.xul\n@@ +52,1 @@\n>    window.close();\n\nstopDialogMonitor() should be first.\n\nSimpleTest.finish() <-> window.close() is \"wrong\" :-/\nSee bug 749872 for a possible way to avoid it.\n\nNB: Same in the 2 other helpers.\n\n::: layout/base/tests/chrome/printpreview_common.js\n@@ +53,5 @@\n> +\n> +    observe : function (subject, topic, data) {\n> +        var doc = getDialogDoc();\n> +        if (doc) {\n> +            ok(false, \"Printing error: \" +\n\nShouldn't there be a specific \"no printer\" case with a todo(false, ...)? (Or is that handled elsewhere?)", "creation_time": "2012-05-25T19:42:44Z", "time": "2012-05-25T19:42:44Z", "attachment_id": 627302, "text": "Comment on attachment 627302\n2/3: Make print preview tests fail, rather than hanging, if the print engine's modal error dialog appears.\n\nReview of attachment 627302:\n-----------------------------------------------------------------\n\n::: layout/base/tests/chrome/printpreview_bug396024_helper.xul\n@@ +52,1 @@\n>    window.close();\n\nstopDialogMonitor() should be first.\n\nSimpleTest.finish() <-> window.close() is \"wrong\" :-/\nSee bug 749872 for a possible way to avoid it.\n\nNB: Same in the 2 other helpers.\n\n::: layout/base/tests/chrome/printpreview_common.js\n@@ +53,5 @@\n> +\n> +    observe : function (subject, topic, data) {\n> +        var doc = getDialogDoc();\n> +        if (doc) {\n> +            ok(false, \"Printing error: \" +\n\nShouldn't there be a specific \"no printer\" case with a todo(false, ...)? (Or is that handled elsewhere?)"}, {"tags": [], "is_private": false, "count": 23, "id": 6339414, "bug_id": 702678, "raw_text": "(In reply to Serge Gautherie (:sgautherie) from comment #22)\n> Shouldn't there be a specific \"no printer\" case with a todo(false, ...)? (Or\n> is that handled elsewhere?)\n\nOh, that's patch 3/3: confused by each patch adding an \"error\" that the next patch fixes :-|\n\nYou are eventually fixing bug 135664, aren't you?", "creation_time": "2012-05-25T19:48:22Z", "creator": "bugzillamozillaorg_serge_20140323@gautherie.fr", "text": "(In reply to Serge Gautherie (:sgautherie) from comment #22)\n> Shouldn't there be a specific \"no printer\" case with a todo(false, ...)? (Or\n> is that handled elsewhere?)\n\nOh, that's patch 3/3: confused by each patch adding an \"error\" that the next patch fixes :-|\n\nYou are eventually fixing bug 135664, aren't you?", "author": "bugzillamozillaorg_serge_20140323@gautherie.fr", "time": "2012-05-25T19:48:22Z", "attachment_id": null}, {"author": "zackw@panix.com", "creator": "zackw@panix.com", "id": 6340065, "count": 24, "is_private": false, "tags": [], "bug_id": 702678, "raw_text": "(In reply to Serge Gautherie (:sgautherie) from comment #21)\n> (In reply to Zack Weinberg (:zwol) from comment #13)\n> > It seems to me that SimpleTest ought to do this for us\n> \n> That looks like bug 718205, doesn't it?\n\nYes, except this is a chrome mochitest rather than a plain one.\n\n(In reply to Serge Gautherie (:sgautherie) from comment #22)\n> >    window.close();\n> \n> stopDialogMonitor() should be first.\n\nDuh, of course.  Don't know what I was thinking.  Will fix.\n\n> SimpleTest.finish() <-> window.close() is \"wrong\" :-/\n> See bug 749872 for a possible way to avoid it.\n\nCould you be more specific, please?\n\n(In reply to Serge Gautherie (:sgautherie) from comment #23)\n> Oh, that's patch 3/3: confused by each patch adding an \"error\" that the next\n> patch fixes :-|\n\nIt was meant to be easier to review that way.  Sorry for the confusion.\n\n> You are eventually fixing bug 135664, aren't you?\n\nI may in fact have fixed it right here :)  Will experiment and report.", "creation_time": "2012-05-25T23:19:44Z", "attachment_id": null, "time": "2012-05-25T23:19:44Z", "text": "(In reply to Serge Gautherie (:sgautherie) from comment #21)\n> (In reply to Zack Weinberg (:zwol) from comment #13)\n> > It seems to me that SimpleTest ought to do this for us\n> \n> That looks like bug 718205, doesn't it?\n\nYes, except this is a chrome mochitest rather than a plain one.\n\n(In reply to Serge Gautherie (:sgautherie) from comment #22)\n> >    window.close();\n> \n> stopDialogMonitor() should be first.\n\nDuh, of course.  Don't know what I was thinking.  Will fix.\n\n> SimpleTest.finish() <-> window.close() is \"wrong\" :-/\n> See bug 749872 for a possible way to avoid it.\n\nCould you be more specific, please?\n\n(In reply to Serge Gautherie (:sgautherie) from comment #23)\n> Oh, that's patch 3/3: confused by each patch adding an \"error\" that the next\n> patch fixes :-|\n\nIt was meant to be easier to review that way.  Sorry for the confusion.\n\n> You are eventually fixing bug 135664, aren't you?\n\nI may in fact have fixed it right here :)  Will experiment and report."}, {"author": "bugzillamozillaorg_serge_20140323@gautherie.fr", "creator": "bugzillamozillaorg_serge_20140323@gautherie.fr", "attachment_id": null, "time": "2012-05-26T00:33:32Z", "text": "(In reply to Zack Weinberg (:zwol) from comment #24)\n\n> Yes, except this is a chrome mochitest rather than a plain one.\n\nI added comments there.\n\n> > SimpleTest.finish() <-> window.close() is \"wrong\" :-/\n> > See bug 749872 for a possible way to avoid it.\n> \n> Could you be more specific, please?\n\nThey are two exclusive constraints:\n*Nothing should execute after ST.finish(), not even w.close().\n*Nothing \"can\" actually execute after w.close(), not even ST.finish().\n\nThe current code obviously succeeds, but it's not sane.\nYet, as this is not your code, I'm fine if you just file a follow-up bug about that.\n\n> It was meant to be easier to review that way.  Sorry for the confusion.\n\nThat's fine as long as they get pushed as a group and with an explicit comment: just unusual (to me).\n\n> I may in fact have fixed it right here :)  Will experiment and report.\n\nThat's what I meant.", "raw_text": "(In reply to Zack Weinberg (:zwol) from comment #24)\n\n> Yes, except this is a chrome mochitest rather than a plain one.\n\nI added comments there.\n\n> > SimpleTest.finish() <-> window.close() is \"wrong\" :-/\n> > See bug 749872 for a possible way to avoid it.\n> \n> Could you be more specific, please?\n\nThey are two exclusive constraints:\n*Nothing should execute after ST.finish(), not even w.close().\n*Nothing \"can\" actually execute after w.close(), not even ST.finish().\n\nThe current code obviously succeeds, but it's not sane.\nYet, as this is not your code, I'm fine if you just file a follow-up bug about that.\n\n> It was meant to be easier to review that way.  Sorry for the confusion.\n\nThat's fine as long as they get pushed as a group and with an explicit comment: just unusual (to me).\n\n> I may in fact have fixed it right here :)  Will experiment and report.\n\nThat's what I meant.", "creation_time": "2012-05-26T00:33:32Z", "bug_id": 702678, "id": 6340181, "is_private": false, "count": 25, "tags": []}, {"text": "Comment on attachment 627304\nwhen doing print preview, don't fail nsDeviceContextSpecWin::Init just because there is no configured printer. (Makes Windows consistent with all other platforms.)\n\nThis turns out not to work, in a really unhelpful way, too:\n\n11778 INFO TEST-START | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul\n11779 INFO TEST-PASS | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | Access Ci\n11780 INFO TEST-PASS | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | Access Cc\n11781 ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | Printing error: An unknown error occurred while printing.\n11782 ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | exception in runTests: [Exception... \"Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIWebBrowserPrint.printPreview]\"  nsresult: \"0x80004005 (NS_ERROR_FAILURE)\"  location: \"JS frame :: chrome://mochitests/content/chrome/layout/base/test/chrome/printpreview_helper.xul :: printpreview :: line 60\"  data: no]\n11783 INFO TEST-END | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | finished in 179ms\n\n... so we go from having .printPreview throw a specific error that I can grep for, to a generic error that could come from anywhere.  I'm trying to set up an XP virtual machine so I can debug a little more easily, but that will take some time.  If anyone with convenient access to an XP box with no printers whatsoever configured wants to have a look at this, that would be much appreciated.  Meanwhile I'm going to address Serge's concerns with patch 2.", "time": "2012-05-26T16:15:04Z", "attachment_id": 627304, "creation_time": "2012-05-26T16:15:04Z", "raw_text": "This turns out not to work, in a really unhelpful way, too:\n\n11778 INFO TEST-START | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul\n11779 INFO TEST-PASS | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | Access Ci\n11780 INFO TEST-PASS | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | Access Cc\n11781 ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | Printing error: An unknown error occurred while printing.\n11782 ERROR TEST-UNEXPECTED-FAIL | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | exception in runTests: [Exception... \"Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIWebBrowserPrint.printPreview]\"  nsresult: \"0x80004005 (NS_ERROR_FAILURE)\"  location: \"JS frame :: chrome://mochitests/content/chrome/layout/base/test/chrome/printpreview_helper.xul :: printpreview :: line 60\"  data: no]\n11783 INFO TEST-END | chrome://mochitests/content/chrome/layout/base/test/chrome/test_printpreview.xul | finished in 179ms\n\n... so we go from having .printPreview throw a specific error that I can grep for, to a generic error that could come from anywhere.  I'm trying to set up an XP virtual machine so I can debug a little more easily, but that will take some time.  If anyone with convenient access to an XP box with no printers whatsoever configured wants to have a look at this, that would be much appreciated.  Meanwhile I'm going to address Serge's concerns with patch 2.", "bug_id": 702678, "count": 26, "is_private": false, "tags": [], "id": 6340811, "creator": "zackw@panix.com", "author": "zackw@panix.com"}, {"time": "2012-05-26T16:16:07Z", "attachment_id": null, "author": "zackw@panix.com", "text": "Since --post-to-bugzilla doesn't seem to be working, these are the tryserver runs:\n\nhttps://tbpl.mozilla.org/?tree=Try&rev=d26bb452fe68 (patch 2)\nhttps://tbpl.mozilla.org/?tree=Try&rev=f8e858f5f3fb (patch 3)", "creator": "zackw@panix.com", "raw_text": "Since --post-to-bugzilla doesn't seem to be working, these are the tryserver runs:\n\nhttps://tbpl.mozilla.org/?tree=Try&rev=d26bb452fe68 (patch 2)\nhttps://tbpl.mozilla.org/?tree=Try&rev=f8e858f5f3fb (patch 3)", "creation_time": "2012-05-26T16:16:07Z", "bug_id": 702678, "id": 6340812, "count": 27, "is_private": false, "tags": []}, {"text": "Comment on attachment 627304\nwhen doing print preview, don't fail nsDeviceContextSpecWin::Init just because there is no configured printer. (Makes Windows consistent with all other platforms.)\n\nReview of attachment 627304:\n-----------------------------------------------------------------\n\n::: widget/nsIDeviceContextSpec.h\n@@ +81,5 @@\n>    NS_ERROR_GENERATE_FAILURE(NS_ERROR_MODULE_GFX,NS_ERROR_GFX_PRINTER_BASE+11)\n>  /* print-to-file: I/O error while printing to file */\n>  #define NS_ERROR_GFX_PRINTER_FILE_IO_ERROR          \\\n>    NS_ERROR_GENERATE_FAILURE(NS_ERROR_MODULE_GFX,NS_ERROR_GFX_PRINTER_BASE+12)\n> +/* code 13 no longer used */\n\nNit: \"Code NS_ERROR_GFX_PRINTER_BASE + 13 no longer used.\"\n\n::: widget/windows/nsDeviceContextSpecWin.cpp\n@@ +364,5 @@\n>    }\n>    return rv;\n>  }\n>  \n> +NS_IMETHODIMP nsDeviceContextSpecWin::Init(nsIWidget* aWidget,\n\nNit: no need to remove the separator comment line.", "time": "2012-05-26T22:17:04Z", "attachment_id": 627304, "creation_time": "2012-05-26T22:17:04Z", "raw_text": "Review of attachment 627304:\n-----------------------------------------------------------------\n\n::: widget/nsIDeviceContextSpec.h\n@@ +81,5 @@\n>    NS_ERROR_GENERATE_FAILURE(NS_ERROR_MODULE_GFX,NS_ERROR_GFX_PRINTER_BASE+11)\n>  /* print-to-file: I/O error while printing to file */\n>  #define NS_ERROR_GFX_PRINTER_FILE_IO_ERROR          \\\n>    NS_ERROR_GENERATE_FAILURE(NS_ERROR_MODULE_GFX,NS_ERROR_GFX_PRINTER_BASE+12)\n> +/* code 13 no longer used */\n\nNit: \"Code NS_ERROR_GFX_PRINTER_BASE + 13 no longer used.\"\n\n::: widget/windows/nsDeviceContextSpecWin.cpp\n@@ +364,5 @@\n>    }\n>    return rv;\n>  }\n>  \n> +NS_IMETHODIMP nsDeviceContextSpecWin::Init(nsIWidget* aWidget,\n\nNit: no need to remove the separator comment line.", "bug_id": 702678, "is_private": false, "count": 28, "tags": [], "id": 6341069, "creator": "bugzillamozillaorg_serge_20140323@gautherie.fr", "author": "bugzillamozillaorg_serge_20140323@gautherie.fr"}, {"creator": "zackw@panix.com", "author": "zackw@panix.com", "bug_id": 702678, "tags": [], "is_private": false, "count": 29, "id": 8325790, "text": "*** Bug 135664 has been marked as a duplicate of this bug. ***", "time": "2014-01-23T15:44:04Z", "attachment_id": null, "raw_text": "", "creation_time": "2014-01-23T15:44:04Z"}, {"author": "benjamin@smedbergs.us", "creator": "benjamin@smedbergs.us", "creation_time": "2016-06-27T20:14:29Z", "raw_text": "Resetting owner to default per Zack's request.", "time": "2016-06-27T20:14:29Z", "attachment_id": null, "text": "Resetting owner to default per Zack's request.", "id": 11505679, "tags": [], "is_private": false, "count": 30, "bug_id": 702678}]}}, "comments": {}}