{"comments": {}, "bugs": {"639810": {"comments": [{"attachment_id": null, "creator": "lumberjake@blueyonder.co.uk", "author": "lumberjake@blueyonder.co.uk", "count": 0, "text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.15) Gecko/20110303 Firefox/3.6.15\nBuild Identifier: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.15) Gecko/20110303 Firefox/3.6.15\n\nI am creating a hit counter. I found that when issuing a request for an image ( in this case dynamically generated via php, multiple requests are sent ( therefore wrongly incrementing my counter ).\n\nI have reproduced a very simple example at http://www.jpeg.me.uk/ff-cache/\nrecord.txt is a plain text file that stores the current count.\nincrement.php is the script which increments the counter, then generates a png file to output the count.\ncode.html is the php code ran in increment.php\n\nEach request for increment.php results in the counter being incremented by two\n\nOddly in my more complicated generator / hit recording script, the counter is actually incremented by three with each ( seemingly ) single request.\n\nif header( 'Content-Type: image/png' ); is removed, and the count is output in plain text, the count is shown as, and is only incremented by one.\n\nHmm, now I notice that the file is incremented by TWO on each hit using the example in code.html even when cache is ENABLED.\n\nHowever if I add header( 'Cache-Control: no-cache, must-revalidate' );\n( cache still enabled )then the count is only incremented by one as it should be.\n\nHOWEVER MORE, if I then set network.http.use-cache to false, the counter is incremented by 3 with each visit..\n\nWhat the fuck mate, what's up with that?!\n\nNot really a problem but curious to know what's going on there.\n\nReproducible: Always\n\nSteps to Reproduce:\n1.Go to about:config and set network.http.use-cache to false\n2.Go to http://jpeg.me.uk/ff-cache/increment.php\n3.Shit brix\nActual Results:  \nCounter is incremented by more than one\n\nExpected Results:  \nCounter is incremented by one.", "is_private": false, "tags": [], "raw_text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.15) Gecko/20110303 Firefox/3.6.15\nBuild Identifier: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.15) Gecko/20110303 Firefox/3.6.15\n\nI am creating a hit counter. I found that when issuing a request for an image ( in this case dynamically generated via php, multiple requests are sent ( therefore wrongly incrementing my counter ).\n\nI have reproduced a very simple example at http://www.jpeg.me.uk/ff-cache/\nrecord.txt is a plain text file that stores the current count.\nincrement.php is the script which increments the counter, then generates a png file to output the count.\ncode.html is the php code ran in increment.php\n\nEach request for increment.php results in the counter being incremented by two\n\nOddly in my more complicated generator / hit recording script, the counter is actually incremented by three with each ( seemingly ) single request.\n\nif header( 'Content-Type: image/png' ); is removed, and the count is output in plain text, the count is shown as, and is only incremented by one.\n\nHmm, now I notice that the file is incremented by TWO on each hit using the example in code.html even when cache is ENABLED.\n\nHowever if I add header( 'Cache-Control: no-cache, must-revalidate' );\n( cache still enabled )then the count is only incremented by one as it should be.\n\nHOWEVER MORE, if I then set network.http.use-cache to false, the counter is incremented by 3 with each visit..\n\nWhat the fuck mate, what's up with that?!\n\nNot really a problem but curious to know what's going on there.\n\nReproducible: Always\n\nSteps to Reproduce:\n1.Go to about:config and set network.http.use-cache to false\n2.Go to http://jpeg.me.uk/ff-cache/increment.php\n3.Shit brix\nActual Results:  \nCounter is incremented by more than one\n\nExpected Results:  \nCounter is incremented by one.", "bug_id": 639810, "creation_time": "2011-03-08T14:14:37Z", "id": 5330008, "time": "2011-03-08T14:14:37Z"}, {"is_private": false, "attachment_id": null, "creation_time": "2011-03-08T15:00:58Z", "bug_id": 639810, "raw_text": "I'm not able to reproduce this. Could you create a log as described in https://developer.mozilla.org/en/HTTP_Logging#Logging_HTTP_Activity and attach it here?", "tags": [], "creator": "bjarne@runitsoft.com", "time": "2011-03-08T15:00:58Z", "author": "bjarne@runitsoft.com", "id": 5330083, "count": 1, "text": "I'm not able to reproduce this. Could you create a log as described in https://developer.mozilla.org/en/HTTP_Logging#Logging_HTTP_Activity and attach it here?"}, {"text": "Bjarne - following those steps results in an empty log file.\n\nIf you go to http://jpeg.me.uk/ff-cache/increment.php - each time you refresh the page, the number is only incrementing by one?", "count": 2, "author": "lumberjake@blueyonder.co.uk", "creator": "lumberjake@blueyonder.co.uk", "attachment_id": null, "time": "2011-03-08T15:28:08Z", "id": 5330130, "raw_text": "Bjarne - following those steps results in an empty log file.\n\nIf you go to http://jpeg.me.uk/ff-cache/increment.php - each time you refresh the page, the number is only incrementing by one?", "bug_id": 639810, "creation_time": "2011-03-08T15:28:08Z", "tags": [], "is_private": false}, {"is_private": false, "creation_time": "2011-03-08T20:45:13Z", "bug_id": 639810, "raw_text": "(In reply to comment #2)\n> Bjarne - following those steps results in an empty log file.\n\nWeird...  these steps normally work quite nicely. Boris - you are more experienced than me here; Any typical pitfalls with those steps?\n\n> If you go to http://jpeg.me.uk/ff-cache/increment.php - each time you refresh\n> the page, the number is only incrementing by one?\n\nI got it reproduced now - didn't realize from comment #0 that setting network.http.use-cache=false is the crucial point. My bad! With this setting the counter is incremented by 2 using 3.6.15 (as you seem to be using) as well as a trunk build (4.0preb13). I'll have a look...", "tags": [], "time": "2011-03-08T20:45:13Z", "id": 5331241, "attachment_id": null, "creator": "bjarne@runitsoft.com", "author": "bjarne@runitsoft.com", "text": "(In reply to comment #2)\n> Bjarne - following those steps results in an empty log file.\n\nWeird...  these steps normally work quite nicely. Boris - you are more experienced than me here; Any typical pitfalls with those steps?\n\n> If you go to http://jpeg.me.uk/ff-cache/increment.php - each time you refresh\n> the page, the number is only incrementing by one?\n\nI got it reproduced now - didn't realize from comment #0 that setting network.http.use-cache=false is the crucial point. My bad! With this setting the counter is incremented by 2 using 3.6.15 (as you seem to be using) as well as a trunk build (4.0preb13). I'll have a look...", "count": 3}, {"is_private": false, "raw_text": "> Any typical pitfalls with those steps?\n\nYes.  If you're using out of process plugins and the page involved has a plugin running on it, weird stuff will happen at the moment.\n\nBut the latter is not the case here.  So I have no idea why Jake got an empty log file, short of him making a typo somewhere.", "creation_time": "2011-03-08T20:51:08Z", "bug_id": 639810, "tags": [], "time": "2011-03-08T20:51:08Z", "id": 5331260, "attachment_id": null, "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu", "count": 4, "text": "> Any typical pitfalls with those steps?\n\nYes.  If you're using out of process plugins and the page involved has a plugin running on it, weird stuff will happen at the moment.\n\nBut the latter is not the case here.  So I have no idea why Jake got an empty log file, short of him making a typo somewhere."}, {"id": 5331778, "time": "2011-03-08T23:44:17Z", "tags": [], "raw_text": "It's a \"feature\" of the img-cache which fails to validate the img after it has been loaded because the img-cache entry has no expiration-time. Expiration-time on the img-cache entry is copied from the http-cache entry and since we switched off the http-cache, it's not set.\n\nI guess this (again) raises the question of the img-cache (and in particular what to do about it if http-cache is switched off).\n\nOtoh, since e.g. ImageLoader (in nsImageDocument.cpp) should know that the image in question was just loaded, it could set up load-flags to drop validation, no..?", "bug_id": 639810, "creation_time": "2011-03-08T23:44:17Z", "is_private": false, "text": "It's a \"feature\" of the img-cache which fails to validate the img after it has been loaded because the img-cache entry has no expiration-time. Expiration-time on the img-cache entry is copied from the http-cache entry and since we switched off the http-cache, it's not set.\n\nI guess this (again) raises the question of the img-cache (and in particular what to do about it if http-cache is switched off).\n\nOtoh, since e.g. ImageLoader (in nsImageDocument.cpp) should know that the image in question was just loaded, it could set up load-flags to drop validation, no..?", "count": 5, "author": "bjarne@runitsoft.com", "creator": "bjarne@runitsoft.com", "attachment_id": null}, {"is_private": false, "tags": [], "raw_text": "Maybe.  What's the callstack to the loadImage call that ends up doing the second GET?", "bug_id": 639810, "creation_time": "2011-03-09T04:20:04Z", "id": 5332297, "time": "2011-03-09T04:20:04Z", "attachment_id": null, "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu", "count": 6, "text": "Maybe.  What's the callstack to the loadImage call that ends up doing the second GET?"}, {"author": "bjarne@runitsoft.com", "text": "First call to AsyncOpen after pressing ctrl-r\n\n#0  nsHttpChannel::AsyncOpen (this=0x7fffd8399800, listener=0x7fffda15f830, context=0x0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/netwerk/protocol/http/nsHttpChannel.cpp:3606\n#1  0x00007ffff5bd0236 in nsURILoader::OpenURI (this=0x7fffe1cb4d20, channel=0x7fffd8399858, aIsContentPreferred=0, aWindowContext=0x7fffddf92430) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/uriloader/base/nsURILoader.cpp:863\n#2  0x00007ffff5bb05bc in nsDocShell::DoChannelLoad (this=0x7fffddf92400, aChannel=0x7fffd8399858, aURILoader=0x7fffe1cb4d20, aBypassClassifier=0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/base/nsDocShell.cpp:9060\n#3  0x00007ffff5bafe51 in nsDocShell::DoURILoad (this=0x7fffddf92400, aURI=0x7fffddfd9f00, aReferrerURI=0x0, aSendReferrer=1, aOwner=0x0, aTypeHint=0x7ffff7b988d0 \"\", aPostData=0x0, aHeadersData=0x0, aFirstParty=1, aDocShell=0x0, \n    aRequest=0x7fffffff7bc0, aIsNewWindowTarget=0, aBypassClassifier=0, aForceAllowCookies=0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/base/nsDocShell.cpp:8902\n#4  0x00007ffff5bae841 in nsDocShell::InternalLoad (this=0x7fffddf92400, aURI=0x7fffddfd9f00, aReferrer=0x0, aOwner=0x0, aFlags=0, aWindowTarget=0x0, aTypeHint=0x7ffff7b988d0 \"\", aPostData=0x0, aHeadersData=0x0, aLoadType=2, \n    aSHEntry=0x7fffda1d2280, aFirstParty=1, aDocShell=0x0, aRequest=0x0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/base/nsDocShell.cpp:8565\n#5  0x00007ffff5bb57f6 in nsDocShell::LoadHistoryEntry (this=0x7fffddf92400, aEntry=0x7fffda1d2280, aLoadType=2) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/base/nsDocShell.cpp:10134\n#6  0x00007ffff5b91e3f in nsDocShell::LoadURI (this=0x7fffddf92400, aURI=0x7fffddfd9f00, aLoadInfo=0x7fffd83abda0, aLoadFlags=0, aFirstParty=0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/base/nsDocShell.cpp:1333\n#7  0x00007ffff5c1694b in nsSHistory::InitiateLoad (this=0x7fffdddef940, aFrameEntry=0x7fffda1d2280, aFrameDS=0x7fffddf924f8, aLoadType=3) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/shistory/src/nsSHistory.cpp:1679\n#8  0x00007ffff5c15ef6 in nsSHistory::LoadEntry (this=0x7fffdddef940, aIndex=0, aLoadType=3, aHistCmd=3) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/shistory/src/nsSHistory.cpp:1546\n#9  0x00007ffff5c12fa8 in nsSHistory::Reload (this=0x7fffdddef940, aReloadFlags=0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/shistory/src/nsSHistory.cpp:812\n\n\nSecond call to AsyncOpen (ctrl-r is only pushed once for both loads)\n\n#0  nsHttpChannel::AsyncOpen (this=0x7fffd8398800, listener=0x7fffdfd65280, context=0x0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/netwerk/protocol/http/nsHttpChannel.cpp:3606\n#1  0x00007ffff4d776f3 in imgLoader::ValidateRequestWithNewChannel (this=0x7fffe1ca69c0, request=0x7fffdbb67530, aURI=0x7fffddd8bf00, aInitialDocumentURI=0x7fffe177cc00, aReferrerURI=0x7fffe177cc00, aLoadGroup=0x7fffe1cbb7f0, \n    aObserver=0x7fffdf3d0ee0, aCX=0x7fffe0db3000, aLoadFlags=5120, aExistingRequest=0x0, aProxyRequest=0x7fffdf3f8e20, aPolicy=0x0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/modules/libpr0n/src/imgLoader.cpp:1249\n#2  0x00007ffff4d77edf in imgLoader::ValidateEntry (this=0x7fffe1ca69c0, aEntry=0x7fffe1dd3bb0, aURI=0x7fffddd8bf00, aInitialDocumentURI=0x7fffe177cc00, aReferrerURI=0x7fffe177cc00, aLoadGroup=0x7fffe1cbb7f0, aObserver=0x7fffdf3d0ee0, \n    aCX=0x7fffe0db3000, aLoadFlags=5120, aCanMakeNewChannel=1, aExistingRequest=0x0, aProxyRequest=0x7fffdf3f8e20, aPolicy=0x0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/modules/libpr0n/src/imgLoader.cpp:1384\n#3  0x00007ffff4d78c89 in imgLoader::LoadImage (this=0x7fffe1ca69c0, aURI=0x7fffddd8bf00, aInitialDocumentURI=0x7fffe177cc00, aReferrerURI=0x7fffe177cc00, aLoadGroup=0x7fffe1cbb7f0, aObserver=0x7fffdf3d0ee0, aCX=0x7fffe0db3000, aLoadFlags=5120, \n    aCacheKey=0x0, aRequest=0x0, aPolicy=0x0, _retval=0x7fffdf3f8e20) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/modules/libpr0n/src/imgLoader.cpp:1581\n#4  0x00007ffff5128369 in nsContentUtils::LoadImage (aURI=0x7fffddd8bf00, aLoadingDocument=0x7fffe0db3000, aLoadingPrincipal=0x7fffe6a6ac40, aReferrer=0x7fffe177cc00, aObserver=0x7fffdf3d0ee0, aLoadFlags=5120, aRequest=0x7fffdf3f8e20)\n    at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsContentUtils.cpp:2532\n#5  0x00007ffff50cd904 in nsImageBoxFrame::UpdateImage (this=0x7fffdf3f8db0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/layout/xul/base/src/nsImageBoxFrame.cpp:271\n#6  0x00007ffff50cd0cd in nsImageBoxFrame::AttributeChanged (this=0x7fffdf3f8db0, aNameSpaceID=0, aAttribute=0x7fffe578b6a0, aModType=2) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/layout/xul/base/src/nsImageBoxFrame.cpp:173\n#7  0x00007ffff4dcdec4 in nsCSSFrameConstructor::AttributeChanged (this=0x7fffe02dc400, aElement=0x7fffe01e9e00, aNameSpaceID=0, aAttribute=0x7fffe578b6a0, aModType=2)\n    at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/layout/base/nsCSSFrameConstructor.cpp:8264\n#8  0x00007ffff4e5a8db in PresShell::AttributeChanged (this=0x7fffe02dbc00, aDocument=0x7fffe0db3000, aElement=0x7fffe01e9e00, aNameSpaceID=0, aAttribute=0x7fffe578b6a0, aModType=2)\n    at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/layout/base/nsPresShell.cpp:5070\n#9  0x00007ffff51dedd3 in nsNodeUtils::AttributeChanged (aElement=0x7fffe01e9e00, aNameSpaceID=0, aAttribute=0x7fffe578b6a0, aModType=2) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsNodeUtils.cpp:134\n#10 0x00007ffff51c698a in nsGenericElement::SetAttrAndNotify (this=0x7fffe01e9e00, aNamespaceID=0, aName=0x7fffe578b6a0, aPrefix=0x0, aOldValue=..., aParsedValue=..., aModType=2 '\\002', aFireMutation=0, aNotify=1, \n    aValueForAfterSetAttr=0x7fffffff8280) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsGenericElement.cpp:4775\n#11 0x00007ffff51c61a5 in nsGenericElement::SetAttr (this=0x7fffe01e9e00, aNamespaceID=0, aName=0x7fffe578b6a0, aPrefix=0x0, aValue=..., aNotify=1)\n    at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsGenericElement.cpp:4673\n#12 0x00007ffff5162d23 in nsGenericElement::SetAttr (this=0x7fffe01e9e00, aNameSpaceID=0, aName=0x7fffe578b6a0, aValue=..., aNotify=1) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsGenericElement.h:387\n#13 0x00007ffff51bdc27 in nsGenericElement::SetAttribute (this=0x7fffe01e9e00, aName=..., aValue=...) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsGenericElement.cpp:2460\n#14 0x00007ffff57c433f in nsXULElement::SetAttribute (this=0x7fffe01e9e00, name=..., value=...) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/xul/content/src/nsXULElement.h:561\n#15 0x00007ffff5ada1fb in nsIDOMElement_SetAttribute (cx=0x7fffe1789800, argc=2, vp=0x7fffe38fe438) at dom_quickstubs.cpp:4825\n#16 0x00007ffff65a3f26 in js::CallJSNative (cx=0x7fffe1789800, native=0x7ffff5ada040 <nsIDOMElement_SetAttribute>, argc=2, vp=0x7fffe38fe438) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jscntxtinlines.h:701\n#17 0x00007ffff67f5d85 in js::Interpret (cx=0x7fffe1789800, entryFrame=0x7fffe38fe370, inlineCallCount=1, interpMode=JSINTERP_NORMAL) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsinterp.cpp:4799\n#18 0x00007ffff659fe4e in js::RunScript (cx=0x7fffe1789800, script=0x7fffe1c3ebe0, fp=0x7fffe38fe370) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsinterp.cpp:653\n#19 0x00007ffff65a03b1 in js::Invoke (cx=0x7fffe1789800, argsRef=..., flags=0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsinterp.cpp:740\n#20 0x00007ffff6578f5f in js_fun_apply (cx=0x7fffe1789800, argc=2, vp=0x7fffe38fe338) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsfun.cpp:2206\n#21 0x00007ffff65a3f26 in js::CallJSNative (cx=0x7fffe1789800, native=0x7ffff6578c57 <js_fun_apply(JSContext*, unsigned int, js::Value*)>, argc=2, vp=0x7fffe38fe338)\n    at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jscntxtinlines.h:701\n#22 0x00007ffff67f5d85 in js::Interpret (cx=0x7fffe1789800, entryFrame=0x7fffe38fe2e0, inlineCallCount=0, interpMode=JSINTERP_NORMAL) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsinterp.cpp:4799\n#23 0x00007ffff659fe4e in js::RunScript (cx=0x7fffe1789800, script=0x7fffe0298c40, fp=0x7fffe38fe2e0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsinterp.cpp:653\n\n(I'm pretty sure I saw ImageLoader in this stack last night, but oh well...)", "count": 7, "attachment_id": null, "creator": "bjarne@runitsoft.com", "time": "2011-03-09T09:35:51Z", "id": 5332612, "is_private": false, "raw_text": "First call to AsyncOpen after pressing ctrl-r\n\n#0  nsHttpChannel::AsyncOpen (this=0x7fffd8399800, listener=0x7fffda15f830, context=0x0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/netwerk/protocol/http/nsHttpChannel.cpp:3606\n#1  0x00007ffff5bd0236 in nsURILoader::OpenURI (this=0x7fffe1cb4d20, channel=0x7fffd8399858, aIsContentPreferred=0, aWindowContext=0x7fffddf92430) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/uriloader/base/nsURILoader.cpp:863\n#2  0x00007ffff5bb05bc in nsDocShell::DoChannelLoad (this=0x7fffddf92400, aChannel=0x7fffd8399858, aURILoader=0x7fffe1cb4d20, aBypassClassifier=0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/base/nsDocShell.cpp:9060\n#3  0x00007ffff5bafe51 in nsDocShell::DoURILoad (this=0x7fffddf92400, aURI=0x7fffddfd9f00, aReferrerURI=0x0, aSendReferrer=1, aOwner=0x0, aTypeHint=0x7ffff7b988d0 \"\", aPostData=0x0, aHeadersData=0x0, aFirstParty=1, aDocShell=0x0, \n    aRequest=0x7fffffff7bc0, aIsNewWindowTarget=0, aBypassClassifier=0, aForceAllowCookies=0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/base/nsDocShell.cpp:8902\n#4  0x00007ffff5bae841 in nsDocShell::InternalLoad (this=0x7fffddf92400, aURI=0x7fffddfd9f00, aReferrer=0x0, aOwner=0x0, aFlags=0, aWindowTarget=0x0, aTypeHint=0x7ffff7b988d0 \"\", aPostData=0x0, aHeadersData=0x0, aLoadType=2, \n    aSHEntry=0x7fffda1d2280, aFirstParty=1, aDocShell=0x0, aRequest=0x0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/base/nsDocShell.cpp:8565\n#5  0x00007ffff5bb57f6 in nsDocShell::LoadHistoryEntry (this=0x7fffddf92400, aEntry=0x7fffda1d2280, aLoadType=2) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/base/nsDocShell.cpp:10134\n#6  0x00007ffff5b91e3f in nsDocShell::LoadURI (this=0x7fffddf92400, aURI=0x7fffddfd9f00, aLoadInfo=0x7fffd83abda0, aLoadFlags=0, aFirstParty=0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/base/nsDocShell.cpp:1333\n#7  0x00007ffff5c1694b in nsSHistory::InitiateLoad (this=0x7fffdddef940, aFrameEntry=0x7fffda1d2280, aFrameDS=0x7fffddf924f8, aLoadType=3) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/shistory/src/nsSHistory.cpp:1679\n#8  0x00007ffff5c15ef6 in nsSHistory::LoadEntry (this=0x7fffdddef940, aIndex=0, aLoadType=3, aHistCmd=3) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/shistory/src/nsSHistory.cpp:1546\n#9  0x00007ffff5c12fa8 in nsSHistory::Reload (this=0x7fffdddef940, aReloadFlags=0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/docshell/shistory/src/nsSHistory.cpp:812\n\n\nSecond call to AsyncOpen (ctrl-r is only pushed once for both loads)\n\n#0  nsHttpChannel::AsyncOpen (this=0x7fffd8398800, listener=0x7fffdfd65280, context=0x0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/netwerk/protocol/http/nsHttpChannel.cpp:3606\n#1  0x00007ffff4d776f3 in imgLoader::ValidateRequestWithNewChannel (this=0x7fffe1ca69c0, request=0x7fffdbb67530, aURI=0x7fffddd8bf00, aInitialDocumentURI=0x7fffe177cc00, aReferrerURI=0x7fffe177cc00, aLoadGroup=0x7fffe1cbb7f0, \n    aObserver=0x7fffdf3d0ee0, aCX=0x7fffe0db3000, aLoadFlags=5120, aExistingRequest=0x0, aProxyRequest=0x7fffdf3f8e20, aPolicy=0x0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/modules/libpr0n/src/imgLoader.cpp:1249\n#2  0x00007ffff4d77edf in imgLoader::ValidateEntry (this=0x7fffe1ca69c0, aEntry=0x7fffe1dd3bb0, aURI=0x7fffddd8bf00, aInitialDocumentURI=0x7fffe177cc00, aReferrerURI=0x7fffe177cc00, aLoadGroup=0x7fffe1cbb7f0, aObserver=0x7fffdf3d0ee0, \n    aCX=0x7fffe0db3000, aLoadFlags=5120, aCanMakeNewChannel=1, aExistingRequest=0x0, aProxyRequest=0x7fffdf3f8e20, aPolicy=0x0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/modules/libpr0n/src/imgLoader.cpp:1384\n#3  0x00007ffff4d78c89 in imgLoader::LoadImage (this=0x7fffe1ca69c0, aURI=0x7fffddd8bf00, aInitialDocumentURI=0x7fffe177cc00, aReferrerURI=0x7fffe177cc00, aLoadGroup=0x7fffe1cbb7f0, aObserver=0x7fffdf3d0ee0, aCX=0x7fffe0db3000, aLoadFlags=5120, \n    aCacheKey=0x0, aRequest=0x0, aPolicy=0x0, _retval=0x7fffdf3f8e20) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/modules/libpr0n/src/imgLoader.cpp:1581\n#4  0x00007ffff5128369 in nsContentUtils::LoadImage (aURI=0x7fffddd8bf00, aLoadingDocument=0x7fffe0db3000, aLoadingPrincipal=0x7fffe6a6ac40, aReferrer=0x7fffe177cc00, aObserver=0x7fffdf3d0ee0, aLoadFlags=5120, aRequest=0x7fffdf3f8e20)\n    at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsContentUtils.cpp:2532\n#5  0x00007ffff50cd904 in nsImageBoxFrame::UpdateImage (this=0x7fffdf3f8db0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/layout/xul/base/src/nsImageBoxFrame.cpp:271\n#6  0x00007ffff50cd0cd in nsImageBoxFrame::AttributeChanged (this=0x7fffdf3f8db0, aNameSpaceID=0, aAttribute=0x7fffe578b6a0, aModType=2) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/layout/xul/base/src/nsImageBoxFrame.cpp:173\n#7  0x00007ffff4dcdec4 in nsCSSFrameConstructor::AttributeChanged (this=0x7fffe02dc400, aElement=0x7fffe01e9e00, aNameSpaceID=0, aAttribute=0x7fffe578b6a0, aModType=2)\n    at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/layout/base/nsCSSFrameConstructor.cpp:8264\n#8  0x00007ffff4e5a8db in PresShell::AttributeChanged (this=0x7fffe02dbc00, aDocument=0x7fffe0db3000, aElement=0x7fffe01e9e00, aNameSpaceID=0, aAttribute=0x7fffe578b6a0, aModType=2)\n    at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/layout/base/nsPresShell.cpp:5070\n#9  0x00007ffff51dedd3 in nsNodeUtils::AttributeChanged (aElement=0x7fffe01e9e00, aNameSpaceID=0, aAttribute=0x7fffe578b6a0, aModType=2) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsNodeUtils.cpp:134\n#10 0x00007ffff51c698a in nsGenericElement::SetAttrAndNotify (this=0x7fffe01e9e00, aNamespaceID=0, aName=0x7fffe578b6a0, aPrefix=0x0, aOldValue=..., aParsedValue=..., aModType=2 '\\002', aFireMutation=0, aNotify=1, \n    aValueForAfterSetAttr=0x7fffffff8280) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsGenericElement.cpp:4775\n#11 0x00007ffff51c61a5 in nsGenericElement::SetAttr (this=0x7fffe01e9e00, aNamespaceID=0, aName=0x7fffe578b6a0, aPrefix=0x0, aValue=..., aNotify=1)\n    at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsGenericElement.cpp:4673\n#12 0x00007ffff5162d23 in nsGenericElement::SetAttr (this=0x7fffe01e9e00, aNameSpaceID=0, aName=0x7fffe578b6a0, aValue=..., aNotify=1) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsGenericElement.h:387\n#13 0x00007ffff51bdc27 in nsGenericElement::SetAttribute (this=0x7fffe01e9e00, aName=..., aValue=...) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/base/src/nsGenericElement.cpp:2460\n#14 0x00007ffff57c433f in nsXULElement::SetAttribute (this=0x7fffe01e9e00, name=..., value=...) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/content/xul/content/src/nsXULElement.h:561\n#15 0x00007ffff5ada1fb in nsIDOMElement_SetAttribute (cx=0x7fffe1789800, argc=2, vp=0x7fffe38fe438) at dom_quickstubs.cpp:4825\n#16 0x00007ffff65a3f26 in js::CallJSNative (cx=0x7fffe1789800, native=0x7ffff5ada040 <nsIDOMElement_SetAttribute>, argc=2, vp=0x7fffe38fe438) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jscntxtinlines.h:701\n#17 0x00007ffff67f5d85 in js::Interpret (cx=0x7fffe1789800, entryFrame=0x7fffe38fe370, inlineCallCount=1, interpMode=JSINTERP_NORMAL) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsinterp.cpp:4799\n#18 0x00007ffff659fe4e in js::RunScript (cx=0x7fffe1789800, script=0x7fffe1c3ebe0, fp=0x7fffe38fe370) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsinterp.cpp:653\n#19 0x00007ffff65a03b1 in js::Invoke (cx=0x7fffe1789800, argsRef=..., flags=0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsinterp.cpp:740\n#20 0x00007ffff6578f5f in js_fun_apply (cx=0x7fffe1789800, argc=2, vp=0x7fffe38fe338) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsfun.cpp:2206\n#21 0x00007ffff65a3f26 in js::CallJSNative (cx=0x7fffe1789800, native=0x7ffff6578c57 <js_fun_apply(JSContext*, unsigned int, js::Value*)>, argc=2, vp=0x7fffe38fe338)\n    at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jscntxtinlines.h:701\n#22 0x00007ffff67f5d85 in js::Interpret (cx=0x7fffe1789800, entryFrame=0x7fffe38fe2e0, inlineCallCount=0, interpMode=JSINTERP_NORMAL) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsinterp.cpp:4799\n#23 0x00007ffff659fe4e in js::RunScript (cx=0x7fffe1789800, script=0x7fffe0298c40, fp=0x7fffe38fe2e0) at /home/bjarne/Work/Mozilla/CleanFireFox/mozilla-central/js/src/jsinterp.cpp:653\n\n(I'm pretty sure I saw ImageLoader in this stack last night, but oh well...)", "bug_id": 639810, "creation_time": "2011-03-09T09:35:51Z", "tags": []}, {"creator": "bzbarsky@mit.edu", "attachment_id": null, "count": 8, "text": "> Second call to AsyncOpen (ctrl-r is only pushed once for both loads)\n\nThanks.  That second load is not coming from nsImageDocument; it's coming from the UI, when the favicon is shown for the tab.  For image documents we use the image itself as the favicon.\n\nThat codepath should definitely force loading from cache; the question is whether it has any API to do that right now...  If not, we should add some.\n\nNot a cache issue, in any case.", "author": "bzbarsky@mit.edu", "tags": [], "raw_text": "> Second call to AsyncOpen (ctrl-r is only pushed once for both loads)\n\nThanks.  That second load is not coming from nsImageDocument; it's coming from the UI, when the favicon is shown for the tab.  For image documents we use the image itself as the favicon.\n\nThat codepath should definitely force loading from cache; the question is whether it has any API to do that right now...  If not, we should add some.\n\nNot a cache issue, in any case.", "bug_id": 639810, "creation_time": "2011-03-09T16:44:20Z", "is_private": false, "id": 5333274, "time": "2011-03-09T16:44:20Z"}, {"text": "Does this imply that embedding the counter in html should make it load only once?", "count": 9, "author": "bjarne@runitsoft.com", "creator": "bjarne@runitsoft.com", "attachment_id": null, "id": 5333945, "time": "2011-03-09T20:19:00Z", "tags": [], "creation_time": "2011-03-09T20:19:00Z", "bug_id": 639810, "raw_text": "Does this imply that embedding the counter in html should make it load only once?", "is_private": false}, {"tags": [], "creator": "bzbarsky@mit.edu", "creation_time": "2011-03-09T22:13:51Z", "bug_id": 639810, "raw_text": "I would think so, yes.", "is_private": false, "attachment_id": null, "count": 10, "text": "I would think so, yes.", "id": 5334293, "time": "2011-03-09T22:13:51Z", "author": "bzbarsky@mit.edu"}, {"creation_time": "2015-09-02T21:18:58Z", "bug_id": 639810, "raw_text": "The pref network.http.use-cache was removed in bug 1198387.\n\nbz, you commented above... is it worth keeping this bug open?", "tags": [], "is_private": false, "time": "2015-09-02T21:18:58Z", "id": 10689207, "creator": "jruderman@gmail.com", "attachment_id": null, "count": 11, "text": "The pref network.http.use-cache was removed in bug 1198387.\n\nbz, you commented above... is it worth keeping this bug open?", "author": "jruderman@gmail.com"}, {"id": 10689241, "time": "2015-09-02T21:24:03Z", "is_private": false, "tags": [], "creation_time": "2015-09-02T21:24:03Z", "bug_id": 639810, "raw_text": "Yes, because cache misses can just happen, things can be sent no-cache, etc.  The favicon code should not trigger a new network load, period.", "author": "bzbarsky@mit.edu", "text": "Yes, because cache misses can just happen, things can be sent no-cache, etc.  The favicon code should not trigger a new network load, period.", "count": 12, "attachment_id": null, "creator": "bzbarsky@mit.edu"}]}}}