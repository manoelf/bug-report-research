{"bugs": {"637619": {"comments": [{"creation_time": "2011-03-01T11:55:13Z", "attachment_id": null, "id": 5311219, "text": "Followup from bug 493699 (and the basic bug 479880).  \n\nWe're not going to display whatever content a proxy server sent along with a non-200 HTTP response, but we could switch from the current, somewhat ad-hoc set of boilerplate replies chosen from the existing set of Firefox error messages (i.e. \"Proxy server refusing connections\", etc) to a new set that displays something as accurate as possible,  including new boilerplate error messages if needed. \n\nAlas, the correct message to display is not always so clear from the status code: there's a lot of drift between the HTTP spec and what proxies actually do in practice, so many codes are overloaded.  See the comments and logic in nsHttpChannel::ProcessFailedSSLConnect:\n\n  http://mxr.mozilla.org/mozilla-central/source/netwerk/protocol/http/nsHttpChannel.cpp#810\n   \nIf anyone with some domain expertise here can suggest a better (and researched in the real world) set of error messages for the various error codes, I'd be up for changing the logic, including adding new error pages.  I don't have time to do the research myself, and I suspect proxy authors/admins may be in a better position to know anyway.", "raw_text": "Followup from bug 493699 (and the basic bug 479880).  \n\nWe're not going to display whatever content a proxy server sent along with a non-200 HTTP response, but we could switch from the current, somewhat ad-hoc set of boilerplate replies chosen from the existing set of Firefox error messages (i.e. \"Proxy server refusing connections\", etc) to a new set that displays something as accurate as possible,  including new boilerplate error messages if needed. \n\nAlas, the correct message to display is not always so clear from the status code: there's a lot of drift between the HTTP spec and what proxies actually do in practice, so many codes are overloaded.  See the comments and logic in nsHttpChannel::ProcessFailedSSLConnect:\n\n  http://mxr.mozilla.org/mozilla-central/source/netwerk/protocol/http/nsHttpChannel.cpp#810\n   \nIf anyone with some domain expertise here can suggest a better (and researched in the real world) set of error messages for the various error codes, I'd be up for changing the logic, including adding new error pages.  I don't have time to do the research myself, and I suspect proxy authors/admins may be in a better position to know anyway.", "is_private": false, "tags": [], "author": "jduell.mcbugs@gmail.com", "creator": "jduell.mcbugs@gmail.com", "count": 0, "bug_id": 637619, "time": "2011-03-01T11:55:13Z"}, {"is_private": false, "tags": [], "time": "2011-03-17T10:02:55Z", "count": 1, "raw_text": "Problem still exists in 3.6.15, in a slightly different shape.\n\nI had accidentally left an (external) proxy configured for a site which is in our local network (due to bug 642396). I got a message that was styled like a local browser error message saying that site was unreachable... with no hint at all that this was a proxy message! Useless debugging of our firewall config until I noticed that request went through proxy...\n\nIf you cannot use the proxy's message \"as is\" at least make it clear that this is what is happening (\"Proxy returned an error, details cannot be displayed for security reasons\") rather than make it look like a local problem.\n\nMoreover, wouldn't it solve the security issue by just stripping all HTML markup from the proxy's response, but leaving the actual text intact? Or only stripping \"dangerous\" HTML tags (so that the proxy's response doesn't turn into a jumbly mess if it contains multiple paragraphs or lists)", "bug_id": 637619, "author": "mozilla@misc.lka.org.lu", "id": 5350380, "attachment_id": null, "text": "Problem still exists in 3.6.15, in a slightly different shape.\n\nI had accidentally left an (external) proxy configured for a site which is in our local network (due to bug 642396). I got a message that was styled like a local browser error message saying that site was unreachable... with no hint at all that this was a proxy message! Useless debugging of our firewall config until I noticed that request went through proxy...\n\nIf you cannot use the proxy's message \"as is\" at least make it clear that this is what is happening (\"Proxy returned an error, details cannot be displayed for security reasons\") rather than make it look like a local problem.\n\nMoreover, wouldn't it solve the security issue by just stripping all HTML markup from the proxy's response, but leaving the actual text intact? Or only stripping \"dangerous\" HTML tags (so that the proxy's response doesn't turn into a jumbly mess if it contains multiple paragraphs or lists)", "creator": "mozilla@misc.lka.org.lu", "creation_time": "2011-03-17T10:02:55Z"}, {"author": "jduell.mcbugs@gmail.com", "text": "> Moreover, wouldn't it solve the security issue by just stripping \n> all HTML markup from the proxy's response\n\nWe considered that at one point, but concluded that 1) full markup stripping would be pretty ugly, and 2) partial markup could be tricky to get right from a security perspective.   That's what I recall being told by my betters at the time...", "creator": "jduell.mcbugs@gmail.com", "attachment_id": null, "id": 5350704, "creation_time": "2011-03-17T14:54:37Z", "tags": [], "is_private": false, "time": "2011-03-17T14:54:37Z", "count": 2, "bug_id": 637619, "raw_text": "> Moreover, wouldn't it solve the security issue by just stripping \n> all HTML markup from the proxy's response\n\nWe considered that at one point, but concluded that 1) full markup stripping would be pretty ugly, and 2) partial markup could be tricky to get right from a security perspective.   That's what I recall being told by my betters at the time..."}, {"bug_id": 637619, "raw_text": "Maybe we could define a header whose content is displayed, if present?", "count": 3, "time": "2011-03-17T16:58:51Z", "tags": [], "is_private": false, "creation_time": "2011-03-17T16:58:51Z", "text": "Maybe we could define a header whose content is displayed, if present?", "creator": "mnot@mnot.net", "id": 5350969, "attachment_id": null, "author": "mnot@mnot.net"}, {"raw_text": "Markup stripping would be ugly?\n\nSo, what's the purpose of an error message: is it more important that it is beautiful, or is it more important that it is useful and helps in actually guiding the problem?\n\nWell, different people may indeed have different priorities, so why not make this an about:config option?", "tags": [], "is_private": false, "creation_time": "2011-03-17T17:26:51Z", "text": "Markup stripping would be ugly?\n\nSo, what's the purpose of an error message: is it more important that it is beautiful, or is it more important that it is useful and helps in actually guiding the problem?\n\nWell, different people may indeed have different priorities, so why not make this an about:config option?", "id": 5351058, "attachment_id": null, "count": 4, "bug_id": 637619, "time": "2011-03-17T17:26:51Z", "author": "mozilla@misc.lka.org.lu", "creator": "mozilla@misc.lka.org.lu"}, {"creation_time": "2011-03-18T03:57:32Z", "text": "bz: how much do you still stand by bug 493699 comment 11?", "creator": "jduell.mcbugs@gmail.com", "attachment_id": null, "id": 5352689, "author": "jduell.mcbugs@gmail.com", "bug_id": 637619, "raw_text": "bz: how much do you still stand by bug 493699 comment 11?", "count": 5, "time": "2011-03-18T03:57:32Z", "tags": [], "is_private": false}, {"raw_text": "As stated there, fully.\n\nIf we just stripped all markup, I'd be more ok with that, but even that's a hard problem... Or we could display the response, whatever it is, as text/plain; the problem there is that it would be well-nigh unreadable.\n\nI suppose we could also try to use some sort of sanitizing parser; I hear Henri is working on that.\n\n> is it more important that it is beautiful, or is it more important that it is\n> useful and helps in actually guiding the problem?\n\n\"Ugly\" means things like \"just dump the HTML as plaintext\" here.  It's not clear how \"useful\" that would be to someone trying to then read the gunk.  Markup stripping often leads to similar outcomes, by the way: the result is completely unreadable.", "bug_id": 637619, "count": 6, "time": "2011-03-18T04:20:52Z", "is_private": false, "tags": [], "creation_time": "2011-03-18T04:20:52Z", "attachment_id": null, "id": 5352700, "creator": "bzbarsky@mit.edu", "text": "As stated there, fully.\n\nIf we just stripped all markup, I'd be more ok with that, but even that's a hard problem... Or we could display the response, whatever it is, as text/plain; the problem there is that it would be well-nigh unreadable.\n\nI suppose we could also try to use some sort of sanitizing parser; I hear Henri is working on that.\n\n> is it more important that it is beautiful, or is it more important that it is\n> useful and helps in actually guiding the problem?\n\n\"Ugly\" means things like \"just dump the HTML as plaintext\" here.  It's not clear how \"useful\" that would be to someone trying to then read the gunk.  Markup stripping often leads to similar outcomes, by the way: the result is completely unreadable.", "author": "bzbarsky@mit.edu"}, {"time": "2011-03-18T06:52:36Z", "bug_id": 637619, "count": 7, "creator": "hsivonen@mozilla.com", "author": "hsivonen@mozilla.com", "is_private": false, "tags": [], "raw_text": "(In reply to comment #6)\n> I suppose we could also try to use some sort of sanitizing parser; I hear Henri\n> is working on that.\n\nAfter I learned that a sanitizing parser was trouble and after I realized that the use cases I was addressing didn't require a sanitizing *parser* anyway, I wrote a DOM fragment sanitizer instead, and the plan is not to have a sanitizing parser.\n\nThat is, with the current plan, the isn't going to be a way to ask a parser that is consuming a network stream to output a sanitized DOM. My first reaction is that making proxy errors better isn't compelling enough a reason to change that plan, but then I don't use proxies, so I'm biased.", "id": 5352814, "attachment_id": null, "text": "(In reply to comment #6)\n> I suppose we could also try to use some sort of sanitizing parser; I hear Henri\n> is working on that.\n\nAfter I learned that a sanitizing parser was trouble and after I realized that the use cases I was addressing didn't require a sanitizing *parser* anyway, I wrote a DOM fragment sanitizer instead, and the plan is not to have a sanitizing parser.\n\nThat is, with the current plan, the isn't going to be a way to ask a parser that is consuming a network stream to output a sanitized DOM. My first reaction is that making proxy errors better isn't compelling enough a reason to change that plan, but then I don't use proxies, so I'm biased.", "creation_time": "2011-03-18T06:52:36Z"}, {"time": "2011-03-18T07:11:46Z", "bug_id": 637619, "count": 8, "creator": "mozilla@misc.lka.org.lu", "author": "mozilla@misc.lka.org.lu", "is_private": false, "tags": [], "raw_text": "(in reply to comment #6)\n> \"Ugly\" means things like \"just dump the HTML as plaintext\" here.  It's not clear how \"useful\" that would be to someone trying to then read the gunk. \n\nWhy do you think that this would be useless in all cases?\n\n> Markup stripping often leads to similar outcomes, by the way: the result is\ncompletely unreadable.\n\nIf this only happens \"often\" rather than \"always\", it means that there are still many cases where it would stay readable. Would it be useful to keep the info at least for these cases? Right now, we're denying users access to the result, even in cases where it would stay readable.", "id": 5352826, "attachment_id": null, "text": "(in reply to comment #6)\n> \"Ugly\" means things like \"just dump the HTML as plaintext\" here.  It's not clear how \"useful\" that would be to someone trying to then read the gunk. \n\nWhy do you think that this would be useless in all cases?\n\n> Markup stripping often leads to similar outcomes, by the way: the result is\ncompletely unreadable.\n\nIf this only happens \"often\" rather than \"always\", it means that there are still many cases where it would stay readable. Would it be useful to keep the info at least for these cases? Right now, we're denying users access to the result, even in cases where it would stay readable.", "creation_time": "2011-03-18T07:11:46Z"}, {"bug_id": 637619, "count": 9, "time": "2011-03-18T12:05:48Z", "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu", "raw_text": "> Why do you think that this would be useless in all cases?\n\nIt wouldn't be useless in _all_ cases.  Clearly, some people can read HTML.  It would be pretty useless for most people, though.  And when it's useless it creates a terrible user experience, which I think outweighs the benefits....\n\nJason, what do you think of handling these sort of things by synthesizing a page with a null principal and some sort of innocuous URI?  It would take a bit of work, but would be the \"right\" solution to this problem.", "is_private": false, "tags": [], "creation_time": "2011-03-18T12:05:48Z", "attachment_id": null, "id": 5353070, "text": "> Why do you think that this would be useless in all cases?\n\nIt wouldn't be useless in _all_ cases.  Clearly, some people can read HTML.  It would be pretty useless for most people, though.  And when it's useless it creates a terrible user experience, which I think outweighs the benefits....\n\nJason, what do you think of handling these sort of things by synthesizing a page with a null principal and some sort of innocuous URI?  It would take a bit of work, but would be the \"right\" solution to this problem."}, {"count": 10, "raw_text": "http://openfwtk.cvs.sourceforge.net/viewvc/openfwtk/fwtk/squid-gw/connect.c?revision=1.20&view=markup\n\nsee lines 151-187\n\nI AM a proxy developer. Anything would be better than current \"solution\". Proxy developers may change default pages to plaintext. Proxy administrators may do that as well. But dropping all information on the floor is definitely *not* acceptable.", "bug_id": 637619, "is_private": false, "tags": [], "time": "2011-03-18T13:27:01Z", "creation_time": "2011-03-18T13:27:01Z", "author": "ark@eltex.net", "attachment_id": null, "id": 5353141, "creator": "ark@eltex.net", "text": "http://openfwtk.cvs.sourceforge.net/viewvc/openfwtk/fwtk/squid-gw/connect.c?revision=1.20&view=markup\n\nsee lines 151-187\n\nI AM a proxy developer. Anything would be better than current \"solution\". Proxy developers may change default pages to plaintext. Proxy administrators may do that as well. But dropping all information on the floor is definitely *not* acceptable."}, {"author": "abarth-mozilla@adambarth.com", "creator": "abarth-mozilla@adambarth.com", "text": "One solution is to accept text/plain responses from the proxy and display them in the context of a network error page (i.e., that explained to the use that the text came from the proxy and not the web site they were trying to reach).", "id": 5354122, "attachment_id": null, "creation_time": "2011-03-18T20:05:53Z", "tags": [], "is_private": false, "time": "2011-03-18T20:05:53Z", "count": 11, "bug_id": 637619, "raw_text": "One solution is to accept text/plain responses from the proxy and display them in the context of a network error page (i.e., that explained to the use that the text came from the proxy and not the web site they were trying to reach)."}, {"author": "torisugari@gmail.com", "creator": "torisugari@gmail.com", "count": 12, "bug_id": 637619, "time": "2011-12-14T09:40:12Z", "creation_time": "2011-12-14T09:40:12Z", "text": "Probably bug 157531 also wants a synthesized error page.", "attachment_id": null, "id": 5914942, "raw_text": "Probably bug 157531 also wants a synthesized error page.", "tags": [], "is_private": false}, {"author": "ism55ism55@yahoo.com", "attachment_id": null, "id": 6161728, "creator": "ism55ism55@yahoo.com", "text": "Is there a workaround for this issue with current Firefox version?\nWill you consider a workaround such as Microsoft did with IE - described here:\n\nhttp://blogs.technet.com/b/nettracer/archive/2011/09/22/internet-explorer-doesn-t-display-isa-or-tmg-error-message-502-\nwhen-connecting-to-https-servers.aspx\n\nJJ.", "creation_time": "2012-03-22T09:17:07Z", "is_private": false, "tags": [], "time": "2012-03-22T09:17:07Z", "count": 13, "raw_text": "Is there a workaround for this issue with current Firefox version?\nWill you consider a workaround such as Microsoft did with IE - described here:\n\nhttp://blogs.technet.com/b/nettracer/archive/2011/09/22/internet-explorer-doesn-t-display-isa-or-tmg-error-message-502-\nwhen-connecting-to-https-servers.aspx\n\nJJ.", "bug_id": 637619}, {"text": "You mean you don't mind it's off by default?", "creator": "torisugari@gmail.com", "attachment_id": null, "id": 6161930, "author": "torisugari@gmail.com", "creation_time": "2012-03-22T11:30:33Z", "time": "2012-03-22T11:30:33Z", "tags": [], "is_private": false, "bug_id": 637619, "raw_text": "You mean you don't mind it's off by default?", "count": 14}, {"creation_time": "2012-03-22T11:33:58Z", "text": "Yes, make it off by default, but make sure that the replacement error message contains the following 2 items:\n\n1. Explanation what is happening (real proxy error message cannot be displayed due to security reasons)\n2. Instructions how to switch setting on in order to see real message from proxy.", "creator": "mozilla@misc.lka.org.lu", "id": 6161938, "attachment_id": null, "author": "mozilla@misc.lka.org.lu", "bug_id": 637619, "raw_text": "Yes, make it off by default, but make sure that the replacement error message contains the following 2 items:\n\n1. Explanation what is happening (real proxy error message cannot be displayed due to security reasons)\n2. Instructions how to switch setting on in order to see real message from proxy.", "count": 15, "time": "2012-03-22T11:33:58Z", "tags": [], "is_private": false}, {"tags": [], "is_private": false, "raw_text": "In summary, there are 2 plans:\n\n1. Synthesize       (comment #9)\n2. Off-by-default   (comment #15)", "text": "In summary, there are 2 plans:\n\n1. Synthesize       (comment #9)\n2. Off-by-default   (comment #15)", "id": 6161969, "attachment_id": null, "creation_time": "2012-03-22T12:03:45Z", "time": "2012-03-22T12:03:45Z", "count": 16, "bug_id": 637619, "author": "torisugari@gmail.com", "creator": "torisugari@gmail.com"}, {"raw_text": "(In reply to Alain Knaff from comment #15)\n> Yes, make it off by default, but make sure that the replacement error\n> message contains the following 2 items:\n> \n> 1. Explanation what is happening (real proxy error message cannot be\n> displayed due to security reasons)\n> 2. Instructions how to switch setting on in order to see real message from\n> proxy.\n\nnot sure about (2) where i can find \"Instructions how to switch setting on\" ?", "tags": [], "is_private": false, "creation_time": "2012-03-23T11:35:18Z", "text": "(In reply to Alain Knaff from comment #15)\n> Yes, make it off by default, but make sure that the replacement error\n> message contains the following 2 items:\n> \n> 1. Explanation what is happening (real proxy error message cannot be\n> displayed due to security reasons)\n> 2. Instructions how to switch setting on in order to see real message from\n> proxy.\n\nnot sure about (2) where i can find \"Instructions how to switch setting on\" ?", "id": 6165268, "attachment_id": null, "bug_id": 637619, "count": 17, "time": "2012-03-23T11:35:18Z", "creator": "ism55ism55@yahoo.com", "author": "ism55ism55@yahoo.com"}, {"is_private": false, "tags": [], "raw_text": "(In reply to O. Atsushi (Torisugari) from comment #16)\n> In summary, there are 2 plans:\n> \n> 1. Synthesize       (comment #9)\n> 2. Off-by-default   (comment #15)\nThanks for reply!\nSo it is planned for future releases or currently supported? any documentation available ?", "attachment_id": null, "id": 6165269, "text": "(In reply to O. Atsushi (Torisugari) from comment #16)\n> In summary, there are 2 plans:\n> \n> 1. Synthesize       (comment #9)\n> 2. Off-by-default   (comment #15)\nThanks for reply!\nSo it is planned for future releases or currently supported? any documentation available ?", "creation_time": "2012-03-23T11:36:35Z", "time": "2012-03-23T11:36:35Z", "count": 18, "bug_id": 637619, "author": "ism55ism55@yahoo.com", "creator": "ism55ism55@yahoo.com"}, {"creation_time": "2012-03-23T12:06:09Z", "author": "mozilla@misc.lka.org.lu", "creator": "mozilla@misc.lka.org.lu", "text": "(In reply to john from comment #17)\n> (In reply to Alain Knaff from comment #15)\n> > Yes, make it off by default, but make sure that the replacement error\n> > message contains the following 2 items:\n> > \n> > 1. Explanation what is happening (real proxy error message cannot be\n> > displayed due to security reasons)\n> > 2. Instructions how to switch setting on in order to see real message from\n> > proxy.\n> \n> not sure about (2) where i can find \"Instructions how to switch setting on\" ?\n\nSorry, I'm not sure I'm understanding your question here.\n\nMy message was a message to whoever would fix this, to remind them to not only include a text explaining what happened, but also a hint about how to address it (for example, by toggling a setting in about:config).\n\nThe wording of that second part could be something like \"in order to see the actual error message sent by the proxy, go to about:config and set network.proxy.show_message to true. Be aware that this may introduce a security risk if you don't trust your proxy or the network to your proxy\"", "id": 6165307, "attachment_id": null, "count": 19, "bug_id": 637619, "raw_text": "(In reply to john from comment #17)\n> (In reply to Alain Knaff from comment #15)\n> > Yes, make it off by default, but make sure that the replacement error\n> > message contains the following 2 items:\n> > \n> > 1. Explanation what is happening (real proxy error message cannot be\n> > displayed due to security reasons)\n> > 2. Instructions how to switch setting on in order to see real message from\n> > proxy.\n> \n> not sure about (2) where i can find \"Instructions how to switch setting on\" ?\n\nSorry, I'm not sure I'm understanding your question here.\n\nMy message was a message to whoever would fix this, to remind them to not only include a text explaining what happened, but also a hint about how to address it (for example, by toggling a setting in about:config).\n\nThe wording of that second part could be something like \"in order to see the actual error message sent by the proxy, go to about:config and set network.proxy.show_message to true. Be aware that this may introduce a security risk if you don't trust your proxy or the network to your proxy\"", "tags": [], "is_private": false, "time": "2012-03-23T12:06:09Z"}, {"count": 20, "bug_id": 637619, "raw_text": "(In reply to Alain Knaff from comment #19)\n> (In reply to john from comment #17)\n> > (In reply to Alain Knaff from comment #15)\n> > > Yes, make it off by default, but make sure that the replacement error\n> > > message contains the following 2 items:\n> > > \n> > > 1. Explanation what is happening (real proxy error message cannot be\n> > > displayed due to security reasons)\n> > > 2. Instructions how to switch setting on in order to see real message from\n> > > proxy.\n> > \n> > not sure about (2) where i can find \"Instructions how to switch setting on\" ?\n> \n> Sorry, I'm not sure I'm understanding your question here.\n> \n> My message was a message to whoever would fix this, to remind them to not\n> only include a text explaining what happened, but also a hint about how to\n> address it (for example, by toggling a setting in about:config).\n> \n> The wording of that second part could be something like \"in order to see the\n> actual error message sent by the proxy, go to about:config and set\n> network.proxy.show_message to true. Be aware that this may introduce a\n> security risk if you don't trust your proxy or the network to your proxy\"\n\nI misread your previous reply. I would like same solution/workaround as you asked for.\nBTW - does chrome support such feature as IE (as Ive added to description above)\nThanks !", "tags": [], "is_private": false, "time": "2012-03-23T12:17:38Z", "creation_time": "2012-03-23T12:17:38Z", "author": "ism55ism55@yahoo.com", "creator": "ism55ism55@yahoo.com", "text": "(In reply to Alain Knaff from comment #19)\n> (In reply to john from comment #17)\n> > (In reply to Alain Knaff from comment #15)\n> > > Yes, make it off by default, but make sure that the replacement error\n> > > message contains the following 2 items:\n> > > \n> > > 1. Explanation what is happening (real proxy error message cannot be\n> > > displayed due to security reasons)\n> > > 2. Instructions how to switch setting on in order to see real message from\n> > > proxy.\n> > \n> > not sure about (2) where i can find \"Instructions how to switch setting on\" ?\n> \n> Sorry, I'm not sure I'm understanding your question here.\n> \n> My message was a message to whoever would fix this, to remind them to not\n> only include a text explaining what happened, but also a hint about how to\n> address it (for example, by toggling a setting in about:config).\n> \n> The wording of that second part could be something like \"in order to see the\n> actual error message sent by the proxy, go to about:config and set\n> network.proxy.show_message to true. Be aware that this may introduce a\n> security risk if you don't trust your proxy or the network to your proxy\"\n\nI misread your previous reply. I would like same solution/workaround as you asked for.\nBTW - does chrome support such feature as IE (as Ive added to description above)\nThanks !", "id": 6165324, "attachment_id": null}, {"tags": [], "is_private": false, "time": "2012-03-23T14:59:53Z", "count": 21, "bug_id": 637619, "raw_text": "Bug 479880 is a relatively dangerous bug. We should carefully consider whether or not we may use off-by-default in a safe way. Maybe we should wait for new technologies e.g. <iframe sandbox> (bug 341604) or they're still dangerous...", "author": "torisugari@gmail.com", "text": "Bug 479880 is a relatively dangerous bug. We should carefully consider whether or not we may use off-by-default in a safe way. Maybe we should wait for new technologies e.g. <iframe sandbox> (bug 341604) or they're still dangerous...", "creator": "torisugari@gmail.com", "attachment_id": null, "id": 6165671, "creation_time": "2012-03-23T14:59:53Z"}, {"time": "2014-08-06T01:29:44Z", "count": 22, "bug_id": 637619, "author": "dsmutil@gmail.com", "creator": "dsmutil@gmail.com", "is_private": false, "tags": [], "raw_text": "The iframe sandbox bug has been completed if that would help with this bug.\n\nThis is a big issue because it looks like the Internet connection is down (\"I can get there on my phone\"), increasing support calls.\n\nI couldn't find a related bug, but the 3xx response workaround doesn't work any longer. With a 302 response you get:\n\"Title:Page Load Error; Body: Failed to Connect/The connection was refused when attempting to contact ...\"\nAnd a 403 you get:\n\"Title: Page Load Error; Body: Proxy Server Refused Connection/The connection was refused when attempting to contact the proxy server you have configured. Please check your proxy settings and try again.\"", "id": 9145865, "attachment_id": null, "text": "The iframe sandbox bug has been completed if that would help with this bug.\n\nThis is a big issue because it looks like the Internet connection is down (\"I can get there on my phone\"), increasing support calls.\n\nI couldn't find a related bug, but the 3xx response workaround doesn't work any longer. With a 302 response you get:\n\"Title:Page Load Error; Body: Failed to Connect/The connection was refused when attempting to contact ...\"\nAnd a 403 you get:\n\"Title: Page Load Error; Body: Proxy Server Refused Connection/The connection was refused when attempting to contact the proxy server you have configured. Please check your proxy settings and try again.\"", "creation_time": "2014-08-06T01:29:44Z"}, {"author": "mozilla@misc.lka.org.lu", "creator": "mozilla@misc.lka.org.lu", "time": "2014-11-12T12:06:43Z", "count": 23, "bug_id": 637619, "attachment_id": null, "id": 9579255, "text": "Any progress on this? The bug is still present an regularly I lose some time tracking down phantom \"network timeouts\" which are really this bug.\n\nPlease, make it at least so that it sth like \"proxy detected an error, sorry we can't give you any details\", rather than sending people on wild goose chases with fake \"network timeout error\"s. (Ok, at least the fact that this \"timeout\" pops up so quickly is a tip-off, but still...)", "creation_time": "2014-11-12T12:06:43Z", "is_private": false, "tags": [], "raw_text": "Any progress on this? The bug is still present an regularly I lose some time tracking down phantom \"network timeouts\" which are really this bug.\n\nPlease, make it at least so that it sth like \"proxy detected an error, sorry we can't give you any details\", rather than sending people on wild goose chases with fake \"network timeout error\"s. (Ok, at least the fact that this \"timeout\" pops up so quickly is a tip-off, but still...)"}, {"count": 24, "raw_text": "As a service provider with hundred of schools using our proxy service and with more and more websites prompting to use HTTPS, the stagnation on this issue is not maintainable anymore.\n\nOur support desk is getting a non negligible number of requests for us to provide a differentiation between 'administratively denied' and 'connection fault'.\n\nOne solution would be for browsers to implement a new 5xx error code with a clear 'connection denied' semantic. The browser could then include a new error page, possibly including a simple line of text reported by the browser (optionally) explaining why the connection was refused.\n\nIf acceptable, my organisation is willing to work on a draft-RFC document defining this code to get out of this impasse. However such work has no value if no browser's vendor is willing to implement it, therefore I am seeking Mozilla's position on this approach.", "bug_id": 637619, "is_private": false, "tags": [], "time": "2015-11-30T15:42:37Z", "creation_time": "2015-11-30T15:42:37Z", "author": "thomas.mangin@exa-networks.co.uk", "id": 10973903, "attachment_id": null, "text": "As a service provider with hundred of schools using our proxy service and with more and more websites prompting to use HTTPS, the stagnation on this issue is not maintainable anymore.\n\nOur support desk is getting a non negligible number of requests for us to provide a differentiation between 'administratively denied' and 'connection fault'.\n\nOne solution would be for browsers to implement a new 5xx error code with a clear 'connection denied' semantic. The browser could then include a new error page, possibly including a simple line of text reported by the browser (optionally) explaining why the connection was refused.\n\nIf acceptable, my organisation is willing to work on a draft-RFC document defining this code to get out of this impasse. However such work has no value if no browser's vendor is willing to implement it, therefore I am seeking Mozilla's position on this approach.", "creator": "thomas.mangin@exa-networks.co.uk"}, {"raw_text": "Patrick, thoughts on comment 24?", "bug_id": 637619, "count": 25, "time": "2015-11-30T16:21:20Z", "is_private": false, "tags": [], "creation_time": "2015-11-30T16:21:20Z", "id": 10974035, "attachment_id": null, "text": "Patrick, thoughts on comment 24?", "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu"}, {"count": 26, "bug_id": 637619, "time": "2016-02-08T16:45:56Z", "author": "mcmanus@ducksong.com", "creator": "mcmanus@ducksong.com", "raw_text": "I'd be happy to see standards work here", "is_private": false, "tags": [], "creation_time": "2016-02-08T16:45:56Z", "attachment_id": null, "id": 11147030, "text": "I'd be happy to see standards work here"}, {"tags": [], "is_private": false, "raw_text": "Then I will start to work on a draft RFC document - happy to collaborate with anyone with enough time to help. https://github.com/thomas-mangin/draft", "text": "Then I will start to work on a draft RFC document - happy to collaborate with anyone with enough time to help. https://github.com/thomas-mangin/draft", "id": 11147100, "attachment_id": null, "creation_time": "2016-02-08T17:03:22Z", "time": "2016-02-08T17:03:22Z", "count": 27, "bug_id": 637619, "author": "thomas.mangin@exa-networks.co.uk", "creator": "thomas.mangin@exa-networks.co.uk"}, {"time": "2016-02-09T00:29:31Z", "bug_id": 637619, "count": 28, "creator": "mnot@mnot.net", "author": "mnot@mnot.net", "tags": [], "is_private": false, "raw_text": "Patrick, that's good to hear.\n\nThomas - I don't think we need a new status code here; the semantics of the existing ones should be sufficient, and new status codes are more work both for standardisation and implementation.\n\nMy thinking is that we can do this with a new media type; something that conveys a constrained set of information from the proxy to the browser, to be presented to the user more safely.\n\nI've taken a quick stab here:\n  https://mnot.github.io/I-D/proxy-explanation/\n(Thomas: happy to work with you, this was just the easiest way to sketch it out)\n\nAs it is, I suspect that this is only going to be used in CONNECT responses (i.e., it won't work for transparent proxies), because of the risk of an origin posing as a proxy. Would love to hear from browser security folks about how concerned (or not) they are about that, though.", "text": "Patrick, that's good to hear.\n\nThomas - I don't think we need a new status code here; the semantics of the existing ones should be sufficient, and new status codes are more work both for standardisation and implementation.\n\nMy thinking is that we can do this with a new media type; something that conveys a constrained set of information from the proxy to the browser, to be presented to the user more safely.\n\nI've taken a quick stab here:\n  https://mnot.github.io/I-D/proxy-explanation/\n(Thomas: happy to work with you, this was just the easiest way to sketch it out)\n\nAs it is, I suspect that this is only going to be used in CONNECT responses (i.e., it won't work for transparent proxies), because of the risk of an origin posing as a proxy. Would love to hear from browser security folks about how concerned (or not) they are about that, though.", "id": 11148867, "attachment_id": null, "creation_time": "2016-02-09T00:29:31Z"}, {"raw_text": "Mark,\n\nThank you for putting this together - I will collaborate with you on github. I am happy with your approach which goes further that I was willing to ask but is an overall better solution.\n\nI totally agree this should only be accepted by browsers if a proxy was explicitly configured. It could also be a configuration option on the browser (but this is beyond the RFC to define).\n\nThe json message(s) may want to be returned in UTF-8. The draft may also want to allow replies using the new 481 code. \nThere is also a small security consideration as the user may click the link and therefore any message relaid may require some some a 'warning' as a MIM attacker could pretend to be the proxy.\n\nI will make sure we have an implementation of the draft, hopefully within this week, on our open source proxy: https://github.com/exa-networks/exaproxy", "tags": [], "is_private": false, "creation_time": "2016-02-09T08:18:54Z", "text": "Mark,\n\nThank you for putting this together - I will collaborate with you on github. I am happy with your approach which goes further that I was willing to ask but is an overall better solution.\n\nI totally agree this should only be accepted by browsers if a proxy was explicitly configured. It could also be a configuration option on the browser (but this is beyond the RFC to define).\n\nThe json message(s) may want to be returned in UTF-8. The draft may also want to allow replies using the new 481 code. \nThere is also a small security consideration as the user may click the link and therefore any message relaid may require some some a 'warning' as a MIM attacker could pretend to be the proxy.\n\nI will make sure we have an implementation of the draft, hopefully within this week, on our open source proxy: https://github.com/exa-networks/exaproxy", "id": 11149426, "attachment_id": null, "bug_id": 637619, "count": 29, "time": "2016-02-09T08:18:54Z", "creator": "thomas.mangin@exa-networks.co.uk", "author": "thomas.mangin@exa-networks.co.uk"}, {"creation_time": "2016-02-09T09:16:20Z", "attachment_id": null, "id": 11149523, "text": "s/481/451/ ... :-)", "raw_text": "s/481/451/ ... :-)", "is_private": false, "tags": [], "author": "thomas.mangin@exa-networks.co.uk", "creator": "thomas.mangin@exa-networks.co.uk", "count": 30, "bug_id": 637619, "time": "2016-02-09T09:16:20Z"}, {"creator": "mnot@mnot.net", "text": "Thomas - good point about the security consideration. A browser *could* decide to only support the new media type when the proxy is configured to use HTTPS -- nice carrot/stick :)", "id": 11149528, "attachment_id": null, "author": "mnot@mnot.net", "creation_time": "2016-02-09T09:18:52Z", "time": "2016-02-09T09:18:52Z", "tags": [], "is_private": false, "bug_id": 637619, "raw_text": "Thomas - good point about the security consideration. A browser *could* decide to only support the new media type when the proxy is configured to use HTTPS -- nice carrot/stick :)", "count": 31}, {"raw_text": "I am sure one can have too many configuration options but only turning on the feature if an proxy is configured for the relevant protocol seems careful.\n\nI am not sure the field 'moreinfo' is wise though. It provides an URL to the client and as the browser can not be sure it is speaking to the expected proxy (MIM attack), this field could be used to trick the end-user to click on an malicious URL.\nTherefore in order to protect end users, I would suggest its removal (the text should be more than enough to explain the policy) and even perhaps encourage clients to be suspicious of any URL in the text and at least make sure they can not be clicked on.", "is_private": false, "tags": [], "creation_time": "2016-02-09T20:20:15Z", "id": 11151426, "attachment_id": null, "text": "I am sure one can have too many configuration options but only turning on the feature if an proxy is configured for the relevant protocol seems careful.\n\nI am not sure the field 'moreinfo' is wise though. It provides an URL to the client and as the browser can not be sure it is speaking to the expected proxy (MIM attack), this field could be used to trick the end-user to click on an malicious URL.\nTherefore in order to protect end users, I would suggest its removal (the text should be more than enough to explain the policy) and even perhaps encourage clients to be suspicious of any URL in the text and at least make sure they can not be clicked on.", "bug_id": 637619, "count": 32, "time": "2016-02-09T20:20:15Z", "creator": "thomas.mangin@exa-networks.co.uk", "author": "thomas.mangin@exa-networks.co.uk"}, {"count": 33, "bug_id": 637619, "time": "2016-02-09T22:37:00Z", "author": "mnot@mnot.net", "creator": "mnot@mnot.net", "raw_text": "I'm not sure; I think it depends on what the UX of the feature is. E.g., if a browser just puts the JSON into a HTML template and presents that, any Web site or MitM can fake that -- even today. \n\nOTOH if it's a privileged UX (one that can't be imitated by HTML+JS+CSS), users *might* become used to trusting it.\n\nI'd love to hear some implementer / security folk input. Barring that, leaving it open for experimentation is the usual path here, so that the security teams can find the right balance.", "is_private": false, "tags": [], "creation_time": "2016-02-09T22:37:00Z", "attachment_id": null, "id": 11151964, "text": "I'm not sure; I think it depends on what the UX of the feature is. E.g., if a browser just puts the JSON into a HTML template and presents that, any Web site or MitM can fake that -- even today. \n\nOTOH if it's a privileged UX (one that can't be imitated by HTML+JS+CSS), users *might* become used to trusting it.\n\nI'd love to hear some implementer / security folk input. Barring that, leaving it open for experimentation is the usual path here, so that the security teams can find the right balance."}, {"tags": [], "is_private": false, "raw_text": "The draft https://mnot.github.io/I-D/proxy-explanation/ (-01) is now implemented by ExaProxy. \n\nYou can run it by doing:\n\n> git clone git@github.com:thomas-mangin/exaproxy.git\n> cd exaproxy\n> env exaproxy.http.connections=100 exaproxy.tls.enable=false exaproxy.security.connect=80 exaproxy.redirector.enable=true exaproxy.redirector.program=etc/exaproxy/redirector/icap-deny-proxy-explanation exaproxy.redirector.protocol='icap://' ./sbin/exaproxy\n\nThis proxy will refuse ANY connection to any site returning a 403 page with a application/proxy-explanation+json payload. You can test it running:\n\n> ./QA/test/connect-http-google-proxy-explanation", "text": "The draft https://mnot.github.io/I-D/proxy-explanation/ (-01) is now implemented by ExaProxy. \n\nYou can run it by doing:\n\n> git clone git@github.com:thomas-mangin/exaproxy.git\n> cd exaproxy\n> env exaproxy.http.connections=100 exaproxy.tls.enable=false exaproxy.security.connect=80 exaproxy.redirector.enable=true exaproxy.redirector.program=etc/exaproxy/redirector/icap-deny-proxy-explanation exaproxy.redirector.protocol='icap://' ./sbin/exaproxy\n\nThis proxy will refuse ANY connection to any site returning a 403 page with a application/proxy-explanation+json payload. You can test it running:\n\n> ./QA/test/connect-http-google-proxy-explanation", "attachment_id": null, "id": 11171241, "creation_time": "2016-02-17T09:45:07Z", "time": "2016-02-17T09:45:07Z", "count": 34, "bug_id": 637619, "author": "thomas.mangin@exa-networks.co.uk", "creator": "thomas.mangin@exa-networks.co.uk"}, {"tags": [], "is_private": false, "raw_text": "Regarding the security consideration about the URL provided. A solution could be to make it 'clickable' if the domain part of it is the same as the proxy setup on the browser. Some more elaborate code could look at the DNS reply and figure its domain.", "text": "Regarding the security consideration about the URL provided. A solution could be to make it 'clickable' if the domain part of it is the same as the proxy setup on the browser. Some more elaborate code could look at the DNS reply and figure its domain.", "attachment_id": null, "id": 11171316, "creation_time": "2016-02-17T10:08:48Z", "time": "2016-02-17T10:08:48Z", "bug_id": 637619, "count": 35, "creator": "thomas.mangin@exa-networks.co.uk", "author": "thomas.mangin@exa-networks.co.uk"}, {"is_private": false, "tags": [], "time": "2016-02-24T16:34:40Z", "count": 36, "raw_text": "", "bug_id": 637619, "author": "mcmanus@ducksong.com", "id": 11191713, "attachment_id": null, "creator": "mcmanus@ducksong.com", "text": "*** Bug 1017379 has been marked as a duplicate of this bug. ***", "creation_time": "2016-02-24T16:34:40Z"}, {"creation_time": "2017-09-13T18:39:31Z", "attachment_id": null, "id": 12658808, "creator": "bug-husbandry-bot@mozilla.bugs", "text": "Bulk change to priority: https://bugzilla.mozilla.org/show_bug.cgi?id=1399258", "author": "bug-husbandry-bot@mozilla.bugs", "raw_text": "Bulk change to priority: https://bugzilla.mozilla.org/show_bug.cgi?id=1399258", "bug_id": 637619, "count": 37, "time": "2017-09-13T18:39:31Z", "is_private": false, "tags": []}, {"author": "robert@marcanoonline.com", "creator": "robert@marcanoonline.com", "time": "2018-08-12T18:30:08Z", "count": 38, "bug_id": 637619, "id": 13538169, "attachment_id": null, "text": "Arriving to the bug because 403 responses to CONNECT from the proxy server are displayed as generic \"The proxy server is refusing connections\". The proxy server has some acl entries in order to authorize access to some servers, this is no problem when the page is not over HTTPS, the proxy response is fully displayed, but in the case of HTTPS responses they aren't.\n \nI understand that showing the proxy response contents for a proxy CONNECT request is somewhat dangerous, the user may be tricked they are accessing the real page. With the increase of usage on encryption on the web, it has increased our support requests because users think the proxy is down, and not that the network policies prohibit access to those pages (think for example a hospital cashier/biller that only have access to banks and insurance providers web pages).\n\nI think a small change that could help, without the complexity of showing/sanitizing the proxy CONNECT response, it is to show a user friendly error message, after the \"The proxy server is refusing connections\", for example, if the proxy response is 403, say something like \"The proxy server is refusing connections, access is forbidden\", or something like that.\n\nI wish this detailed message is added, if accepted I could provide a patch, because the other option is to do TLS/SSL interception in order to show the proxy response. I want to avoid that, some proxy installations are for small businesses that  don't need the burden of securing the proxy CA keys properly.", "creation_time": "2018-08-12T18:30:08Z", "is_private": false, "tags": [], "raw_text": "Arriving to the bug because 403 responses to CONNECT from the proxy server are displayed as generic \"The proxy server is refusing connections\". The proxy server has some acl entries in order to authorize access to some servers, this is no problem when the page is not over HTTPS, the proxy response is fully displayed, but in the case of HTTPS responses they aren't.\n \nI understand that showing the proxy response contents for a proxy CONNECT request is somewhat dangerous, the user may be tricked they are accessing the real page. With the increase of usage on encryption on the web, it has increased our support requests because users think the proxy is down, and not that the network policies prohibit access to those pages (think for example a hospital cashier/biller that only have access to banks and insurance providers web pages).\n\nI think a small change that could help, without the complexity of showing/sanitizing the proxy CONNECT response, it is to show a user friendly error message, after the \"The proxy server is refusing connections\", for example, if the proxy response is 403, say something like \"The proxy server is refusing connections, access is forbidden\", or something like that.\n\nI wish this detailed message is added, if accepted I could provide a patch, because the other option is to do TLS/SSL interception in order to show the proxy response. I want to avoid that, some proxy installations are for small businesses that  don't need the burden of securing the proxy CA keys properly."}, {"author": "ambrose.li@gmail.com", "creator": "ambrose.li@gmail.com", "time": "2019-01-18T17:42:34Z", "count": 39, "bug_id": 637619, "text": "This is still a problem in the current Nightly builds (66.0a1, 2019-01-17). I was going to file a bug when I noticed a dozen bugs for the same problem. Please fix this because the current error message is just factually wrong.", "attachment_id": null, "id": 13871028, "creation_time": "2019-01-18T17:42:34Z", "tags": [], "is_private": false, "raw_text": "This is still a problem in the current Nightly builds (66.0a1, 2019-01-17). I was going to file a bug when I noticed a dozen bugs for the same problem. Please fix this because the current error message is just factually wrong."}]}}, "comments": {}}