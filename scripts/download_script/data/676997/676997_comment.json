{"comments": {}, "bugs": {"676997": {"comments": [{"is_private": false, "creator": "gbrown@mozilla.com", "creation_time": "2011-08-06T01:07:35Z", "author": "gbrown@mozilla.com", "text": "With patches for bug 668349 and 668351, xpcshell tests can be run on an Android device, and the majority of tests pass. \n\nHowever, uriloader/exthandler/tests/unit/test_handlerService.js consistently fails when run on Android.", "time": "2011-08-06T01:07:35Z", "tags": [], "attachment_id": null, "raw_text": "With patches for bug 668349 and 668351, xpcshell tests can be run on an Android device, and the majority of tests pass. \n\nHowever, uriloader/exthandler/tests/unit/test_handlerService.js consistently fails when run on Android.", "id": 5637172, "count": 0, "bug_id": 676997}, {"creator": "gbrown@mozilla.com", "is_private": false, "count": 1, "author": "gbrown@mozilla.com", "creation_time": "2011-08-09T21:35:15Z", "time": "2011-08-09T21:35:15Z", "tags": [], "bug_id": 676997, "text": "geoff@geoff-MacBookPro:~/src/mozilla-central/objdir-droid$ make SOLO_FILE=test_handlerService.js -C uriloader/exthandler/tests check-one-remote\nmake: Entering directory `/home/geoff/src/mozilla-central/objdir-droid/uriloader/exthandler/tests'\n/usr/bin/python2.6 -u ../../../../config/pythonpath.py \\\n\t  -I../../../../build \\\n\t  -I../../../../build/mobile \\\n\t  ../../../../testing/xpcshell/remotexpcshelltests.py \\\n\t  --symbols-path=../../../dist/crashreporter-symbols \\\n\t  --build-info-json=../../../mozinfo.json \\\n\t  --test-path=test_handlerService.js \\\n\t  --profile-name=fennec \\\n\t  --verbose \\\n\t   \\\n\t  --dm_trans=adb \\\n\t  --deviceIP= \\\n\t  --objdir=../../.. \\\n\t  --apk=../../../dist/fennec-8.0a1.en-US.eabi-arm.apk \\\n          --noSetup \\\n\t  ../../../_tests/xpcshell/uriloader/exthandler/tests/unit ../../../_tests/xpcshell/uriloader/exthandler/tests/unit_ipc\npackage set: org.mozilla.fennec_unofficial\nchmod /data/local/tests/xpcshell/p\nTEST-INFO | profile dir is /data/local/tests/xpcshell/p\nTEST-INFO | /home/geoff/src/mozilla-central/objdir-droid/_tests/xpcshell/uriloader/exthandler/tests/unit/test_handlerService.js | running test ...\ncd /data/local/tests/xpcshell/uriloader/exthandler/tests/unit; LD_LIBRARY_PATH=/data/local/tests/xpcshell/b; export CACHE_PATH=/data/local/tests/xpcshell/b; export GRE_HOME=/data/data/org.mozilla.fennec_unofficial; export XPCSHELL_TEST_PROFILE_DIR=/data/local/tests/xpcshell/p; /data/local/tests/xpcshell/b/xpcshell -r /data/local/tests/xpcshell/c/httpd.manifest --greomni /data/local/tests/xpcshell/b/fennec-8.0a1.en-US.eabi-arm.apk -j -s -e 'const _HTTPD_JS_PATH = \"/data/local/tests/xpcshell/c/httpd.js\";' -e 'const _HEAD_JS_PATH = \"/data/local/tests/xpcshell/head.js\";' -f /data/local/tests/xpcshell/head.js -e 'const _SERVER_ADDR = \"localhost\"' -e 'const _HEAD_FILES = [\"head_handlerService.js\"];' -e 'const _TAIL_FILES = [\"tail_handlerService.js\"];' -e 'const _TEST_FILE = [\"test_handlerService.js\"];' -e '_execute_test(); quit(0);'\nTEST-KNOWN-FAIL | /home/geoff/src/mozilla-central/objdir-droid/_tests/xpcshell/uriloader/exthandler/tests/unit/test_handlerService.js | test passed\n>>>>>>>\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file /home/geoff/src/mozilla-central/xpcom/base/nsTraceRefcntImpl.cpp, line 172\nWARNING: No default pref files found.: file /home/geoff/src/mozilla-central/modules/libpref/src/Preferences.cpp, line 923\nWARNING: GetIsLinkUp is not supported without a bridge connection: file /home/geoff/src/mozilla-central/netwerk/system/android/nsAndroidNetworkLinkService.cpp, line 61\n*** HandlerServiceTest: getFile: requesting UMimTyp\n*** HandlerServiceTest: getFile: requesting CurProcD\n*** HandlerServiceTest: the following NS_ERROR_FAILURE exception in nsIDirectoryServiceProvider::getFile is expected, as we don't provide the 'CurProcD' file\n\nTEST-INFO | (xpcshell/head.js) | test 1 pending\n*** HandlerServiceTest: getFile: requesting ProfLDS\n*** HandlerServiceTest: the following NS_ERROR_FAILURE exception in nsIDirectoryServiceProvider::getFile is expected, as we don't provide the 'ProfLDS' file\nJS Component Loader: ERROR (null):0\n                     uncaught exception: 2147500037\n*** HandlerServiceTest: getFile: requesting TmpD\n*** HandlerServiceTest: the following NS_ERROR_FAILURE exception in nsIDirectoryServiceProvider::getFile is expected, as we don't provide the 'TmpD' file\n*** HandlerServiceTest: getFile: requesting ProfLDS\n*** HandlerServiceTest: the following NS_ERROR_FAILURE exception in nsIDirectoryServiceProvider::getFile is expected, as we don't provide the 'ProfLDS' file\nJS Component Loader: ERROR (null):0\n                     uncaught exception: 2147500037\n###!!! ASSERTION: no extension: '!aExtension.IsEmpty()', file /home/geoff/src/mozilla-central/uriloader/exthandler/android/nsMIMEInfoAndroid.cpp, line 341\n\nTEST-PASS | test_handlerService.js | [run_test : 118] true == true\n\nTEST-PASS | test_handlerService.js | [run_test : 120] nonexistent/type == nonexistent/type\n\nTEST-PASS | test_handlerService.js | [run_test : 123] nonexistent/type == nonexistent/type\n\nTEST-UNEXPECTED-FAIL | test_handlerService.js | 2 == 0 - See following stack:\nJS frame :: /data/local/tests/xpcshell/head.js :: do_throw :: line 445\nJS frame :: /data/local/tests/xpcshell/head.js :: _do_check_eq :: line 539\nJS frame :: /data/local/tests/xpcshell/head.js :: do_check_eq :: line 560\nJS frame :: test_handlerService.js :: run_test :: line 126\nJS frame :: /data/local/tests/xpcshell/head.js :: _execute_test :: line 326\nJS frame :: -e :: <TOP_LEVEL> :: line 1\n\nTEST-INFO | (xpcshell/head.js) | exiting test\nWARNING: nsExceptionService ignoring thread destruction after shutdown: file /home/geoff/src/mozilla-central/xpcom/base/nsExceptionService.cpp, line 197\nWARNING: unable to Flush() diry datasource during XPCOM shutdown: file /home/geoff/src/mozilla-central/rdf/base/src/nsRDFXMLDataSource.cpp, line 776\nWARNING: OOPDeinit() without successful OOPInit(): file /home/geoff/src/mozilla-central/toolkit/crashreporter/nsExceptionHandler.cpp, line 1830\nnsStringStats\n => mAllocCount:           1604\n => mReallocCount:           22\n => mFreeCount:            1604\n => mShareCount:           7080\n => mAdoptCount:             73\n => mAdoptFreeCount:         73\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file /home/geoff/src/mozilla-central/xpcom/base/nsTraceRefcntImpl.cpp, line 172\n<<<<<<<\nINFO | Result summary:\nINFO | Passed: 0\nINFO | Failed: 0\nINFO | Todo: 1\nmake: Leaving directory `/home/geoff/src/mozilla-central/objdir-droid/uriloader/exthandler/tests'", "attachment_id": null, "raw_text": "geoff@geoff-MacBookPro:~/src/mozilla-central/objdir-droid$ make SOLO_FILE=test_handlerService.js -C uriloader/exthandler/tests check-one-remote\nmake: Entering directory `/home/geoff/src/mozilla-central/objdir-droid/uriloader/exthandler/tests'\n/usr/bin/python2.6 -u ../../../../config/pythonpath.py \\\n\t  -I../../../../build \\\n\t  -I../../../../build/mobile \\\n\t  ../../../../testing/xpcshell/remotexpcshelltests.py \\\n\t  --symbols-path=../../../dist/crashreporter-symbols \\\n\t  --build-info-json=../../../mozinfo.json \\\n\t  --test-path=test_handlerService.js \\\n\t  --profile-name=fennec \\\n\t  --verbose \\\n\t   \\\n\t  --dm_trans=adb \\\n\t  --deviceIP= \\\n\t  --objdir=../../.. \\\n\t  --apk=../../../dist/fennec-8.0a1.en-US.eabi-arm.apk \\\n          --noSetup \\\n\t  ../../../_tests/xpcshell/uriloader/exthandler/tests/unit ../../../_tests/xpcshell/uriloader/exthandler/tests/unit_ipc\npackage set: org.mozilla.fennec_unofficial\nchmod /data/local/tests/xpcshell/p\nTEST-INFO | profile dir is /data/local/tests/xpcshell/p\nTEST-INFO | /home/geoff/src/mozilla-central/objdir-droid/_tests/xpcshell/uriloader/exthandler/tests/unit/test_handlerService.js | running test ...\ncd /data/local/tests/xpcshell/uriloader/exthandler/tests/unit; LD_LIBRARY_PATH=/data/local/tests/xpcshell/b; export CACHE_PATH=/data/local/tests/xpcshell/b; export GRE_HOME=/data/data/org.mozilla.fennec_unofficial; export XPCSHELL_TEST_PROFILE_DIR=/data/local/tests/xpcshell/p; /data/local/tests/xpcshell/b/xpcshell -r /data/local/tests/xpcshell/c/httpd.manifest --greomni /data/local/tests/xpcshell/b/fennec-8.0a1.en-US.eabi-arm.apk -j -s -e 'const _HTTPD_JS_PATH = \"/data/local/tests/xpcshell/c/httpd.js\";' -e 'const _HEAD_JS_PATH = \"/data/local/tests/xpcshell/head.js\";' -f /data/local/tests/xpcshell/head.js -e 'const _SERVER_ADDR = \"localhost\"' -e 'const _HEAD_FILES = [\"head_handlerService.js\"];' -e 'const _TAIL_FILES = [\"tail_handlerService.js\"];' -e 'const _TEST_FILE = [\"test_handlerService.js\"];' -e '_execute_test(); quit(0);'\nTEST-KNOWN-FAIL | /home/geoff/src/mozilla-central/objdir-droid/_tests/xpcshell/uriloader/exthandler/tests/unit/test_handlerService.js | test passed\n>>>>>>>\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file /home/geoff/src/mozilla-central/xpcom/base/nsTraceRefcntImpl.cpp, line 172\nWARNING: No default pref files found.: file /home/geoff/src/mozilla-central/modules/libpref/src/Preferences.cpp, line 923\nWARNING: GetIsLinkUp is not supported without a bridge connection: file /home/geoff/src/mozilla-central/netwerk/system/android/nsAndroidNetworkLinkService.cpp, line 61\n*** HandlerServiceTest: getFile: requesting UMimTyp\n*** HandlerServiceTest: getFile: requesting CurProcD\n*** HandlerServiceTest: the following NS_ERROR_FAILURE exception in nsIDirectoryServiceProvider::getFile is expected, as we don't provide the 'CurProcD' file\n\nTEST-INFO | (xpcshell/head.js) | test 1 pending\n*** HandlerServiceTest: getFile: requesting ProfLDS\n*** HandlerServiceTest: the following NS_ERROR_FAILURE exception in nsIDirectoryServiceProvider::getFile is expected, as we don't provide the 'ProfLDS' file\nJS Component Loader: ERROR (null):0\n                     uncaught exception: 2147500037\n*** HandlerServiceTest: getFile: requesting TmpD\n*** HandlerServiceTest: the following NS_ERROR_FAILURE exception in nsIDirectoryServiceProvider::getFile is expected, as we don't provide the 'TmpD' file\n*** HandlerServiceTest: getFile: requesting ProfLDS\n*** HandlerServiceTest: the following NS_ERROR_FAILURE exception in nsIDirectoryServiceProvider::getFile is expected, as we don't provide the 'ProfLDS' file\nJS Component Loader: ERROR (null):0\n                     uncaught exception: 2147500037\n###!!! ASSERTION: no extension: '!aExtension.IsEmpty()', file /home/geoff/src/mozilla-central/uriloader/exthandler/android/nsMIMEInfoAndroid.cpp, line 341\n\nTEST-PASS | test_handlerService.js | [run_test : 118] true == true\n\nTEST-PASS | test_handlerService.js | [run_test : 120] nonexistent/type == nonexistent/type\n\nTEST-PASS | test_handlerService.js | [run_test : 123] nonexistent/type == nonexistent/type\n\nTEST-UNEXPECTED-FAIL | test_handlerService.js | 2 == 0 - See following stack:\nJS frame :: /data/local/tests/xpcshell/head.js :: do_throw :: line 445\nJS frame :: /data/local/tests/xpcshell/head.js :: _do_check_eq :: line 539\nJS frame :: /data/local/tests/xpcshell/head.js :: do_check_eq :: line 560\nJS frame :: test_handlerService.js :: run_test :: line 126\nJS frame :: /data/local/tests/xpcshell/head.js :: _execute_test :: line 326\nJS frame :: -e :: <TOP_LEVEL> :: line 1\n\nTEST-INFO | (xpcshell/head.js) | exiting test\nWARNING: nsExceptionService ignoring thread destruction after shutdown: file /home/geoff/src/mozilla-central/xpcom/base/nsExceptionService.cpp, line 197\nWARNING: unable to Flush() diry datasource during XPCOM shutdown: file /home/geoff/src/mozilla-central/rdf/base/src/nsRDFXMLDataSource.cpp, line 776\nWARNING: OOPDeinit() without successful OOPInit(): file /home/geoff/src/mozilla-central/toolkit/crashreporter/nsExceptionHandler.cpp, line 1830\nnsStringStats\n => mAllocCount:           1604\n => mReallocCount:           22\n => mFreeCount:            1604\n => mShareCount:           7080\n => mAdoptCount:             73\n => mAdoptFreeCount:         73\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file /home/geoff/src/mozilla-central/xpcom/base/nsTraceRefcntImpl.cpp, line 172\n<<<<<<<\nINFO | Result summary:\nINFO | Passed: 0\nINFO | Failed: 0\nINFO | Todo: 1\nmake: Leaving directory `/home/geoff/src/mozilla-central/objdir-droid/uriloader/exthandler/tests'", "id": 5643493}, {"id": 5644086, "attachment_id": null, "raw_text": "The failing test calls:\n\nvar handlerInfo = mimeSvc.getFromTypeAndExtension(\"nonexistent/type\", null);\n\nand fails because handlerInfo.preferredAction != Ci.nsIHandlerInfo.saveToDisk.\n\nI suspect that the assertion about a non-empty extension is inappropriate. From nsIMIMEService:\n\n\"One of aMIMEType and aFileExt can be an empty string. At least one of aMIMEType and aFileExt must be nonempty.\"", "author": "gbrown@mozilla.com", "creation_time": "2011-08-10T01:19:37Z", "time": "2011-08-10T01:19:37Z", "bug_id": 676997, "tags": [], "text": "The failing test calls:\n\nvar handlerInfo = mimeSvc.getFromTypeAndExtension(\"nonexistent/type\", null);\n\nand fails because handlerInfo.preferredAction != Ci.nsIHandlerInfo.saveToDisk.\n\nI suspect that the assertion about a non-empty extension is inappropriate. From nsIMIMEService:\n\n\"One of aMIMEType and aFileExt can be an empty string. At least one of aMIMEType and aFileExt must be nonempty.\"", "creator": "gbrown@mozilla.com", "is_private": false, "count": 2}]}}}