{"bugs": {"649563": {"comments": [{"attachment_id": null, "creation_time": "2011-04-13T03:42:11Z", "tags": [], "creator": "josh@joshmatthews.net", "raw_text": "http://mxr.mozilla.org/mozilla-central/search?string=%28get|set%29%28bool|int|char%29pref&regexp=1&find=\\.html&findi=&filter=^[^\\0]*%24&hitlimit=&tree=mozilla-central\nhttp://mxr.mozilla.org/mozilla-central/search?string=%28get|set%29%28bool|int|char%29pref&regexp=1&find=\\.js&findi=&filter=^[^\\0]*%24&hitlimit=&tree=mozilla-central\nhttp://mxr.mozilla.org/mozilla-central/search?string=%28get|set%29%28bool|int|char%29pref&regexp=1&find=\\.js&findi=&filter=^[^\\0]*%24&hitlimit=&tree=mozilla-central\n\nThis searches for (get|set)(char|bool|int)pref will do for a start.  Not every result needs to be changed, but", "bug_id": 649563, "text": "http://mxr.mozilla.org/mozilla-central/search?string=%28get|set%29%28bool|int|char%29pref&regexp=1&find=\\.html&findi=&filter=^[^\\0]*%24&hitlimit=&tree=mozilla-central\nhttp://mxr.mozilla.org/mozilla-central/search?string=%28get|set%29%28bool|int|char%29pref&regexp=1&find=\\.js&findi=&filter=^[^\\0]*%24&hitlimit=&tree=mozilla-central\nhttp://mxr.mozilla.org/mozilla-central/search?string=%28get|set%29%28bool|int|char%29pref&regexp=1&find=\\.js&findi=&filter=^[^\\0]*%24&hitlimit=&tree=mozilla-central\n\nThis searches for (get|set)(char|bool|int)pref will do for a start.  Not every result needs to be changed, but", "is_private": false, "count": 0, "time": "2011-04-13T03:42:11Z", "author": "josh@joshmatthews.net", "id": 5405617}, {"id": 5405625, "author": "josh@joshmatthews.net", "is_private": false, "bug_id": 649563, "attachment_id": null, "tags": [], "creation_time": "2011-04-13T03:47:18Z", "count": 1, "time": "2011-04-13T03:47:18Z", "text": "My goodness, comment 0 is quite poorly written.  Those searches will do for a start, but only mochitest tests (not mochitest-chrome or any of the other variants) need changing.  The basic formula is\n\n1) delete any lines like\n\n>25   var prefs = Components.classes[\"@mozilla.org/preferences-service;1\"]\n>26             .getService(Components.interfaces.nsIPrefBranch);\n\n2) change any line that uses |prefs| like\n\n>27   var gOriginalHtml5Pref = prefs.getBoolPref(\"html5.parser.enable\");\n>28   prefs.setBoolPref(\"html5.parser.enable\", true);\n\nto read\n\n>27   var gOriginalHtml5Pref = SpecialPowers.getBoolPref(\"html5.parser.enable\");\n>28   SpecialPowers.setBoolPref(\"html5.parser.enable\", true);\n\n3) make sure the test still passes\n\nFor extra credit, add another two steps:\n\n4) delete any lines like\n\n>netscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\n\n5) make sure the test still passes. If it doesn't undo step 4.", "creator": "josh@joshmatthews.net", "raw_text": "My goodness, comment 0 is quite poorly written.  Those searches will do for a start, but only mochitest tests (not mochitest-chrome or any of the other variants) need changing.  The basic formula is\n\n1) delete any lines like\n\n>25   var prefs = Components.classes[\"@mozilla.org/preferences-service;1\"]\n>26             .getService(Components.interfaces.nsIPrefBranch);\n\n2) change any line that uses |prefs| like\n\n>27   var gOriginalHtml5Pref = prefs.getBoolPref(\"html5.parser.enable\");\n>28   prefs.setBoolPref(\"html5.parser.enable\", true);\n\nto read\n\n>27   var gOriginalHtml5Pref = SpecialPowers.getBoolPref(\"html5.parser.enable\");\n>28   SpecialPowers.setBoolPref(\"html5.parser.enable\", true);\n\n3) make sure the test still passes\n\nFor extra credit, add another two steps:\n\n4) delete any lines like\n\n>netscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\n\n5) make sure the test still passes. If it doesn't undo step 4."}, {"time": "2011-04-13T03:50:05Z", "count": 2, "text": "See this patch for an example of the changes required: https://bugzilla.mozilla.org/attachment.cgi?id=499705&action=diff", "raw_text": "See this patch for an example of the changes required: https://bugzilla.mozilla.org/attachment.cgi?id=499705&action=diff", "creator": "josh@joshmatthews.net", "id": 5405629, "author": "josh@joshmatthews.net", "is_private": false, "bug_id": 649563, "tags": [], "creation_time": "2011-04-13T03:50:05Z", "attachment_id": null}, {"is_private": false, "count": 3, "time": "2011-04-13T03:56:52Z", "author": "josh@joshmatthews.net", "id": 5405639, "attachment_id": null, "tags": [], "creation_time": "2011-04-13T03:56:52Z", "creator": "josh@joshmatthews.net", "raw_text": "Hmm, my mistake, the second search for .js files is far far too broad.  Most of the results there are for non-test files.", "bug_id": 649563, "text": "Hmm, my mistake, the second search for .js files is far far too broad.  Most of the results there are for non-test files."}, {"raw_text": "And of course the third search is the same as the second.  Here's a better one for XUL files:\n\nhttp://mxr.mozilla.org/mozilla-central/search?string=%28get|set%29%28bool|int|char%29pref&regexp=1&find=\\.xul&findi=&filter=^[^\\0]*%24&hitlimit=&tree=mozilla-central", "creator": "josh@joshmatthews.net", "text": "And of course the third search is the same as the second.  Here's a better one for XUL files:\n\nhttp://mxr.mozilla.org/mozilla-central/search?string=%28get|set%29%28bool|int|char%29pref&regexp=1&find=\\.xul&findi=&filter=^[^\\0]*%24&hitlimit=&tree=mozilla-central", "time": "2011-04-13T03:58:44Z", "count": 4, "tags": [], "creation_time": "2011-04-13T03:58:44Z", "attachment_id": null, "bug_id": 649563, "author": "josh@joshmatthews.net", "is_private": false, "id": 5405643}, {"bug_id": 649563, "text": "(In reply to comment #1)\n> My goodness, comment 0 is quite poorly written.  Those searches will do for a\n> start, but only mochitest tests (not mochitest-chrome or any of the other\n> variants) need changing.  The basic formula is\nFor a new contributor it isn't clear what can be used to identify a mochitest-chrome test though they should be able to figure it out by the path name containing chrome. Specifically, I haven't checked the other links but the link in comment #4 contains many mochitest-chrome tests.", "attachment_id": null, "creation_time": "2011-04-29T03:05:05Z", "tags": [], "creator": "robert.strong.bugs@gmail.com", "raw_text": "(In reply to comment #1)\n> My goodness, comment 0 is quite poorly written.  Those searches will do for a\n> start, but only mochitest tests (not mochitest-chrome or any of the other\n> variants) need changing.  The basic formula is\nFor a new contributor it isn't clear what can be used to identify a mochitest-chrome test though they should be able to figure it out by the path name containing chrome. Specifically, I haven't checked the other links but the link in comment #4 contains many mochitest-chrome tests.", "id": 5438836, "is_private": false, "count": 5, "time": "2011-04-29T03:05:05Z", "author": "robert.strong.bugs@gmail.com"}, {"id": 5530744, "is_private": false, "author": "szu.han.chang@gmail.com", "bug_id": 649563, "tags": [], "creation_time": "2011-06-14T05:16:26Z", "attachment_id": null, "time": "2011-06-14T05:16:26Z", "count": 6, "text": "I've made the required changes, but how do I make sure the test still passes?", "raw_text": "I've made the required changes, but how do I make sure the test still passes?", "creator": "szu.han.chang@gmail.com"}, {"tags": [], "creation_time": "2011-08-11T09:38:32Z", "attachment_id": null, "raw_text": "Han Chang:\nto make sure test pass, run the Mochitest:\nhttps://developer.mozilla.org/en/Mochitest\n\nAbout this bug, many tests use prefHasUserValue to save a possible user pref and restore it later. So, I see two possibilites here:\neither implement prefHasUserValue in SpecialPowers, either change the tests so they clearUserPref a value they have modified without restoring its previous value. After all, mochitest profile is only used for the tests, and there's not point keeping a user value between test. Or did I miss something ?", "creator": "arno@renevier.net", "bug_id": 649563, "text": "Han Chang:\nto make sure test pass, run the Mochitest:\nhttps://developer.mozilla.org/en/Mochitest\n\nAbout this bug, many tests use prefHasUserValue to save a possible user pref and restore it later. So, I see two possibilites here:\neither implement prefHasUserValue in SpecialPowers, either change the tests so they clearUserPref a value they have modified without restoring its previous value. After all, mochitest profile is only used for the tests, and there's not point keeping a user value between test. Or did I miss something ?", "is_private": false, "author": "arno@renevier.net", "time": "2011-08-11T09:38:32Z", "count": 7, "id": 5647150}, {"creator": "martijn.martijn@gmail.com", "raw_text": "Perhaps also test Fennec, where e10 is used?\n\nNote bug 621363, where is being discussed that SpecialPowers setPref and getPref might have to be rewriteen.", "text": "Perhaps also test Fennec, where e10 is used?\n\nNote bug 621363, where is being discussed that SpecialPowers setPref and getPref might have to be rewriteen.", "count": 8, "time": "2011-08-11T09:56:20Z", "attachment_id": null, "tags": [], "creation_time": "2011-08-11T09:56:20Z", "bug_id": 649563, "is_private": false, "author": "martijn.martijn@gmail.com", "id": 5647170}, {"creator": "josh@joshmatthews.net", "raw_text": "I no longer think this is good first bug material, since the plan in bug 621363 is to rewrite all tests that set parameters to use a new system that doesn't exist yet.", "text": "I no longer think this is good first bug material, since the plan in bug 621363 is to rewrite all tests that set parameters to use a new system that doesn't exist yet.", "count": 9, "time": "2011-08-11T14:27:25Z", "attachment_id": null, "tags": [], "creation_time": "2011-08-11T14:27:25Z", "bug_id": 649563, "author": "josh@joshmatthews.net", "is_private": false, "id": 5647487}, {"count": 10, "time": "2011-08-13T15:31:42Z", "text": "Agreed, I'll leave it alone for now then, thanks for all of your help though!", "creator": "szu.han.chang@gmail.com", "raw_text": "Agreed, I'll leave it alone for now then, thanks for all of your help though!", "id": 5651789, "is_private": false, "author": "szu.han.chang@gmail.com", "bug_id": 649563, "attachment_id": null, "tags": [], "creation_time": "2011-08-13T15:31:42Z"}, {"time": "2014-08-21T14:04:11Z", "count": 11, "text": "(In reply to Josh Matthews [:jdm] (away until 8/24) from comment #9)\n> I no longer think this is good first bug material, since the plan in bug\n> 621363 is to rewrite all tests that set parameters to use a new system that\n> doesn't exist yet.\n\nThe new system has become SpecialPowers.pushPrefEnv. I can help people that want convert the existing callers.\n\nThe mochitests that need changing from prefbranch setting to SpecialPowers.pushPrefEnv:\ncontent/html/content/test/test_anchor_ping.html\ndom/plugins/test/mochitest/test_bug751809.html\ndom/plugins/test/mochitest/test_plugin_tag_clicktoplay.html\ndom/tests/mochitest/localstorage/test_localStorageQuotaPrivateBrowsing_perwindowpb.html\ndom/base/test/test_bug1022229.html\ndom/plugins/test/mochitest/test_secondPlugin.html\ndom/tests/mochitest/bugs/test_bug61098.html\nsecurity/manager/ssl/tests/mochitest/mixedcontent/test_bug383369.html \nsecurity/manager/ssl/tests/mochitest/stricttransportsecurity/test_sts_privatebrowsing_perwindowpb.html \ntoolkit/components/passwordmgr/test/test_notifications.html\ntoolkit/components/passwordmgr/test/test_prompt.html \ndom/workers/test/test_suspend.html\n\nI'm not sure if mochitest-chrome tests would need converting to SpecialPowers.pushPrefEnv. If they would need to run oop too, then they would need converting, indeed.\nAfaik, browser-chrome tests don't need converting.", "raw_text": "(In reply to Josh Matthews [:jdm] (away until 8/24) from comment #9)\n> I no longer think this is good first bug material, since the plan in bug\n> 621363 is to rewrite all tests that set parameters to use a new system that\n> doesn't exist yet.\n\nThe new system has become SpecialPowers.pushPrefEnv. I can help people that want convert the existing callers.\n\nThe mochitests that need changing from prefbranch setting to SpecialPowers.pushPrefEnv:\ncontent/html/content/test/test_anchor_ping.html\ndom/plugins/test/mochitest/test_bug751809.html\ndom/plugins/test/mochitest/test_plugin_tag_clicktoplay.html\ndom/tests/mochitest/localstorage/test_localStorageQuotaPrivateBrowsing_perwindowpb.html\ndom/base/test/test_bug1022229.html\ndom/plugins/test/mochitest/test_secondPlugin.html\ndom/tests/mochitest/bugs/test_bug61098.html\nsecurity/manager/ssl/tests/mochitest/mixedcontent/test_bug383369.html \nsecurity/manager/ssl/tests/mochitest/stricttransportsecurity/test_sts_privatebrowsing_perwindowpb.html \ntoolkit/components/passwordmgr/test/test_notifications.html\ntoolkit/components/passwordmgr/test/test_prompt.html \ndom/workers/test/test_suspend.html\n\nI'm not sure if mochitest-chrome tests would need converting to SpecialPowers.pushPrefEnv. If they would need to run oop too, then they would need converting, indeed.\nAfaik, browser-chrome tests don't need converting.", "creator": "martijn.martijn@gmail.com", "id": 9212553, "author": "martijn.martijn@gmail.com", "is_private": false, "bug_id": 649563, "tags": [], "creation_time": "2014-08-21T14:04:11Z", "attachment_id": null}, {"id": 9212790, "time": "2014-08-21T14:54:25Z", "author": "martijn.martijn@gmail.com", "count": 12, "is_private": false, "text": "(In reply to Martijn Wargers [:mwargers] (QA) from comment #11)\n> I'm not sure if mochitest-chrome tests would need converting to\n> SpecialPowers.pushPrefEnv. If they would need to run oop too, then they\n> would need converting, indeed.\n> Afaik, browser-chrome tests don't need converting.\n\nActually, it would be better to convert those too, because they would benefit from the automatic reset of the preferences after the test has been run with the usage of SpecialPowers.pushPrefEnv.", "bug_id": 649563, "raw_text": "(In reply to Martijn Wargers [:mwargers] (QA) from comment #11)\n> I'm not sure if mochitest-chrome tests would need converting to\n> SpecialPowers.pushPrefEnv. If they would need to run oop too, then they\n> would need converting, indeed.\n> Afaik, browser-chrome tests don't need converting.\n\nActually, it would be better to convert those too, because they would benefit from the automatic reset of the preferences after the test has been run with the usage of SpecialPowers.pushPrefEnv.", "creator": "martijn.martijn@gmail.com", "tags": [], "creation_time": "2014-08-21T14:54:25Z", "attachment_id": null}, {"id": 11972460, "author": "VYV03354@nifty.ne.jp", "is_private": false, "bug_id": 649563, "attachment_id": null, "creation_time": "2017-01-11T01:14:51Z", "tags": [], "count": 13, "time": "2017-01-11T01:14:51Z", "text": "We still have bunch of nsIPrefBranch usage, but it no longer depends on enablePrivilege.", "creator": "VYV03354@nifty.ne.jp", "raw_text": "We still have bunch of nsIPrefBranch usage, but it no longer depends on enablePrivilege."}]}}, "comments": {}}