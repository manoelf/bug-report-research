{"bugs": {"704251": {"comments": [{"author": "jacob.benoit.1@gmail.com", "count": 0, "text": "Using the XPCOM reference tracing patch in bug 704240 I saw this:\n\nREFTRACING: nsCOMPtr@0x1f324f8 : imgRequest@0x1f323a0 -> nsFileChannel@0x1f31cb0\nREFTRACING: nsCOMPtr@0x1f324c8 : imgRequest@0x1f323a0 -> nsSystemPrincipal@0x1894580\nREFTRACING: nsCOMPtr@0x1f31e30 : nsFileChannel@0x1f31cb0 -> imgRequest@0x1f323a0\n\nThis means that a imgRequest and a nsFileChannel are referencing each other. Looking at imgRequest.cpp and nsFileChannel.cpp, I can't find where this cycle is declared to the cycle collector?\n\nI didn't observe an actual leak though, as these objects got deleted soon after.", "creator": "jacob.benoit.1@gmail.com", "is_private": false, "creation_time": "2011-11-21T20:54:41Z", "bug_id": 704251, "id": 5863354, "attachment_id": null, "raw_text": "Using the XPCOM reference tracing patch in bug 704240 I saw this:\n\nREFTRACING: nsCOMPtr@0x1f324f8 : imgRequest@0x1f323a0 -> nsFileChannel@0x1f31cb0\nREFTRACING: nsCOMPtr@0x1f324c8 : imgRequest@0x1f323a0 -> nsSystemPrincipal@0x1894580\nREFTRACING: nsCOMPtr@0x1f31e30 : nsFileChannel@0x1f31cb0 -> imgRequest@0x1f323a0\n\nThis means that a imgRequest and a nsFileChannel are referencing each other. Looking at imgRequest.cpp and nsFileChannel.cpp, I can't find where this cycle is declared to the cycle collector?\n\nI didn't observe an actual leak though, as these objects got deleted soon after.", "time": "2011-11-21T20:54:41Z", "tags": []}, {"id": 5863364, "bug_id": 704251, "text": "Still using that patch, I do see a large number of imgRequest objects being kept alive until very late during Firefox shutdown, not sure if that's expected.", "count": 1, "author": "jacob.benoit.1@gmail.com", "time": "2011-11-21T20:56:54Z", "raw_text": "Still using that patch, I do see a large number of imgRequest objects being kept alive until very late during Firefox shutdown, not sure if that's expected.", "is_private": false, "creation_time": "2011-11-21T20:56:54Z", "creator": "jacob.benoit.1@gmail.com", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "joe@drew.ca", "creation_time": "2011-11-21T20:59:48Z", "is_private": false, "raw_text": "imgRequest removes its reference to the channel after OnStopRequest, so it's not actually an issue. And yes, a large number of imgRequest objects are stored until shutdown: that's the image cache! :)\n\nFor now I'm going to call this invalid, but please reopen if necessary.", "time": "2011-11-21T20:59:48Z", "author": "joe@drew.ca", "text": "imgRequest removes its reference to the channel after OnStopRequest, so it's not actually an issue. And yes, a large number of imgRequest objects are stored until shutdown: that's the image cache! :)\n\nFor now I'm going to call this invalid, but please reopen if necessary.", "count": 2, "id": 5863370, "bug_id": 704251}, {"creator": "jacob.benoit.1@gmail.com", "is_private": false, "creation_time": "2011-11-21T21:03:15Z", "attachment_id": null, "tags": [], "text": "oh ok, thanks!", "count": 3, "author": "jacob.benoit.1@gmail.com", "id": 5863382, "bug_id": 704251, "raw_text": "oh ok, thanks!", "time": "2011-11-21T21:03:15Z"}, {"bug_id": 704251, "id": 5863763, "author": "bzbarsky@mit.edu", "text": "Note that imgRequest and imgRequestProxy are not cycle collected at all, which in fact has caused leak problems....\n\nWe should really consider fixing that.  :(", "count": 4, "raw_text": "Note that imgRequest and imgRequestProxy are not cycle collected at all, which in fact has caused leak problems....\n\nWe should really consider fixing that.  :(", "time": "2011-11-21T22:40:28Z", "is_private": false, "creation_time": "2011-11-21T22:40:28Z", "creator": "bzbarsky@mit.edu", "tags": [], "attachment_id": null}, {"raw_text": "reopening then! can't deny i'm glad that my tool has found something.", "time": "2011-11-21T22:42:07Z", "author": "jacob.benoit.1@gmail.com", "text": "reopening then! can't deny i'm glad that my tool has found something.", "count": 5, "id": 5863777, "bug_id": 704251, "attachment_id": null, "tags": [], "creator": "jacob.benoit.1@gmail.com", "creation_time": "2011-11-21T22:42:07Z", "is_private": false}, {"attachment_id": 576214, "raw_text": "Can someone teach me how to get this to build?\n\n/home/bjacob/mozilla-central/image/src/imgRequest.cpp: In member function \u2018virtual nsrefcnt imgRequest::AddRef()\u2019:\n/home/bjacob/mozilla-central/image/src/imgRequest.cpp:177:1: error: no match for \u2018operator++\u2019 in \u2018++((imgRequest*)this)->imgRequest::mRefCnt\u2019\n/home/bjacob/mozilla-central/image/src/imgRequest.cpp:177:1: note: candidate is:\n../../dist/include/gfxRect.h:83:36: note: mozilla::css::Corner operator++(mozilla::css::Corner&, int)\n../../dist/include/gfxRect.h:83:36: note:   candidate expects 2 arguments, 1 provided\n/home/bjacob/mozilla-central/image/src/imgRequest.cpp: In member function \u2018virtual nsrefcnt imgRequest::Release()\u2019:\n/home/bjacob/mozilla-central/image/src/imgRequest.cpp:177:1: error: no match for \u2018operator--\u2019 in \u2018--((imgRequest*)this)->imgRequest::mRefCnt\u2019", "time": "2011-11-22T19:30:27Z", "tags": [], "author": "jacob.benoit.1@gmail.com", "count": 6, "text": "Created attachment 576214\npatch that fails to build\n\nCan someone teach me how to get this to build?\n\n/home/bjacob/mozilla-central/image/src/imgRequest.cpp: In member function \u2018virtual nsrefcnt imgRequest::AddRef()\u2019:\n/home/bjacob/mozilla-central/image/src/imgRequest.cpp:177:1: error: no match for \u2018operator++\u2019 in \u2018++((imgRequest*)this)->imgRequest::mRefCnt\u2019\n/home/bjacob/mozilla-central/image/src/imgRequest.cpp:177:1: note: candidate is:\n../../dist/include/gfxRect.h:83:36: note: mozilla::css::Corner operator++(mozilla::css::Corner&, int)\n../../dist/include/gfxRect.h:83:36: note:   candidate expects 2 arguments, 1 provided\n/home/bjacob/mozilla-central/image/src/imgRequest.cpp: In member function \u2018virtual nsrefcnt imgRequest::Release()\u2019:\n/home/bjacob/mozilla-central/image/src/imgRequest.cpp:177:1: error: no match for \u2018operator--\u2019 in \u2018--((imgRequest*)this)->imgRequest::mRefCnt\u2019", "creator": "jacob.benoit.1@gmail.com", "creation_time": "2011-11-22T19:30:27Z", "is_private": false, "id": 5866090, "bug_id": 704251}, {"creator": "josh@joshmatthews.net", "author": "josh@joshmatthews.net", "count": 7, "text": "Needs more NS_IMPL_CYCLE_COLLECTING_ADDREF, etc. http://mxr.mozilla.org/mozilla-central/source/xpfe/components/directory/nsDirectoryViewer.cpp#123", "id": 5866204, "bug_id": 704251, "is_private": false, "creation_time": "2011-11-22T20:06:48Z", "time": "2011-11-22T20:06:48Z", "attachment_id": null, "raw_text": "Needs more NS_IMPL_CYCLE_COLLECTING_ADDREF, etc. http://mxr.mozilla.org/mozilla-central/source/xpfe/components/directory/nsDirectoryViewer.cpp#123", "tags": []}]}}, "comments": {}}