{"comments": {}, "bugs": {"691309": {"comments": [{"bug_id": 691309, "id": 5753872, "count": 0, "is_private": false, "tags": [], "attachment_id": null, "time": "2011-10-03T13:23:51Z", "author": "D.O.Teller+bugspam@gmail.com", "text": "We are not the only ones hunting down I/O in the main thread. Android offers a developer tool to monitor I/O happening in the main thread and, essentially, kill off applications that have any: http://www.talkandroid.com/23545-strict-mode-in-android-2-3-gingerbread-helps-developers-make-better-leaner-apps/\n\nI do not think we have anything quite equivalent for Mozilla, although perhaps Instruments or XPerf can do something related. I am wondering if we could add a build mode that provides the same kind of feature.", "creator": "D.O.Teller+bugspam@gmail.com", "creation_time": "2011-10-03T13:23:51Z", "raw_text": "We are not the only ones hunting down I/O in the main thread. Android offers a developer tool to monitor I/O happening in the main thread and, essentially, kill off applications that have any: http://www.talkandroid.com/23545-strict-mode-in-android-2-3-gingerbread-helps-developers-make-better-leaner-apps/\n\nI do not think we have anything quite equivalent for Mozilla, although perhaps Instruments or XPerf can do something related. I am wondering if we could add a build mode that provides the same kind of feature."}, {"raw_text": "Attaching a small utility patch that makes any PRLog launched from the main thread easier to filter out.", "creation_time": "2011-11-08T13:02:53Z", "attachment_id": 572783, "time": "2011-11-08T13:02:53Z", "text": "Created attachment 572783\nMonitoring PRLog on main thread\n\nAttaching a small utility patch that makes any PRLog launched from the main thread easier to filter out.", "id": 5833785, "tags": [], "count": 1, "is_private": false, "bug_id": 691309, "author": "D.O.Teller+bugspam@gmail.com", "creator": "D.O.Teller+bugspam@gmail.com"}, {"creator": "D.O.Teller+bugspam@gmail.com", "author": "D.O.Teller+bugspam@gmail.com", "raw_text": "With the profiler, we now have ways to do this by instrumenting low-level functions performing main thread IO.\n\nSo this bug is now about instrumenting all low-level IO functions with SAMPLE_LABEL(\"IO\", \"FunctionName\"). This will let us find all main thread IO by just filtering upon \"IO::\" in Cleopatra.\n\nMore info about SAMPLE_LABEL: https://developer.mozilla.org/en-US/docs/Performance/Profiling_with_the_Built-in_Profiler#Pseudostack\nAnd a few examples: http://dxr.mozilla.org/search.cgi?tree=mozilla-central&string=SAMPLE_LABEL", "creation_time": "2012-11-21T20:36:45Z", "text": "With the profiler, we now have ways to do this by instrumenting low-level functions performing main thread IO.\n\nSo this bug is now about instrumenting all low-level IO functions with SAMPLE_LABEL(\"IO\", \"FunctionName\"). This will let us find all main thread IO by just filtering upon \"IO::\" in Cleopatra.\n\nMore info about SAMPLE_LABEL: https://developer.mozilla.org/en-US/docs/Performance/Profiling_with_the_Built-in_Profiler#Pseudostack\nAnd a few examples: http://dxr.mozilla.org/search.cgi?tree=mozilla-central&string=SAMPLE_LABEL", "time": "2012-11-21T20:36:45Z", "attachment_id": null, "tags": [], "is_private": false, "count": 2, "id": 6843176, "bug_id": 691309}, {"count": 3, "is_private": false, "tags": [], "id": 6843401, "bug_id": 691309, "creation_time": "2012-11-21T21:33:52Z", "raw_text": "We can start by labelling as IO:\n- the relevant methods of nsLocalFileUnix, nsLocalFileWin;\n- the relevant functions of sqlite.\n\nOr we can try and locate all Posix and Win32 IO functions.", "text": "We can start by labelling as IO:\n- the relevant methods of nsLocalFileUnix, nsLocalFileWin;\n- the relevant functions of sqlite.\n\nOr we can try and locate all Posix and Win32 IO functions.", "attachment_id": null, "time": "2012-11-21T21:33:52Z", "creator": "D.O.Teller+bugspam@gmail.com", "author": "D.O.Teller+bugspam@gmail.com"}, {"bug_id": 691309, "tags": [], "is_private": false, "count": 4, "id": 7226415, "text": "I'll start working on this bug. Feel free to assign to me.", "attachment_id": null, "time": "2013-03-20T20:21:12Z", "raw_text": "I'll start working on this bug. Feel free to assign to me.", "creation_time": "2013-03-20T20:21:12Z", "creator": "u415160@disabled.tld", "author": "u415160@disabled.tld"}, {"author": "D.O.Teller+bugspam@gmail.com", "creator": "D.O.Teller+bugspam@gmail.com", "time": "2013-03-20T20:39:35Z", "attachment_id": null, "text": "Actually, BenWa has advanced a lot on the more general question of monitoring I/O since the bug was filed. BenWa, can Richard help you at this stage?", "raw_text": "Actually, BenWa has advanced a lot on the more general question of monitoring I/O since the bug was filed. BenWa, can Richard help you at this stage?", "creation_time": "2013-03-20T20:39:35Z", "bug_id": 691309, "id": 7226494, "tags": [], "is_private": false, "count": 5}, {"author": "b56girard@gmail.com", "creator": "b56girard@gmail.com", "bug_id": 691309, "id": 7245362, "tags": [], "count": 6, "is_private": false, "attachment_id": null, "time": "2013-03-26T16:42:42Z", "text": "We talked about this during the snappy work week:\n- Profile can highlight IO functions. This will find slow IO calls but the probability of it being missed decreases as the runtime for the IO is less then the sampling interval.\n- We plan on intercepting certain Gecko IO calls that will cover most IO calls in practice. We will instrument the code to repo this to the profiler and telemetry.\n\nNathan what are the calls we are interested in watching?", "raw_text": "We talked about this during the snappy work week:\n- Profile can highlight IO functions. This will find slow IO calls but the probability of it being missed decreases as the runtime for the IO is less then the sampling interval.\n- We plan on intercepting certain Gecko IO calls that will cover most IO calls in practice. We will instrument the code to repo this to the profiler and telemetry.\n\nNathan what are the calls we are interested in watching?", "creation_time": "2013-03-26T16:42:42Z"}, {"creator": "froydnj+bz@gmail.com", "author": "froydnj+bz@gmail.com", "creation_time": "2013-03-26T16:51:54Z", "raw_text": "(In reply to Benoit Girard (:BenWa) from comment #6)\n> Nathan what are the calls we are interested in watching?\n\nWe were planning on watching:\n\n- Wrapper functions in storage/src/TelemetryVFS.cpp;\n- Calls made by OS.File;\n- Calls made by NSPR (PR_Read/PR_Write/etc.).\n\nThose three categories might not catch everything, but they ought to catch the majority of interesting cases.", "text": "(In reply to Benoit Girard (:BenWa) from comment #6)\n> Nathan what are the calls we are interested in watching?\n\nWe were planning on watching:\n\n- Wrapper functions in storage/src/TelemetryVFS.cpp;\n- Calls made by OS.File;\n- Calls made by NSPR (PR_Read/PR_Write/etc.).\n\nThose three categories might not catch everything, but they ought to catch the majority of interesting cases.", "attachment_id": null, "time": "2013-03-26T16:51:54Z", "tags": [], "count": 7, "is_private": false, "id": 7245401, "bug_id": 691309}, {"bug_id": 691309, "tags": [], "is_private": false, "count": 8, "id": 7245408, "text": "Fwiw, barring any bug, OS.File should not be able to do main thread I/O, so they might not need watching \u2013 at least on the main thread.", "time": "2013-03-26T16:53:15Z", "attachment_id": null, "raw_text": "Fwiw, barring any bug, OS.File should not be able to do main thread I/O, so they might not need watching \u2013 at least on the main thread.", "creation_time": "2013-03-26T16:53:15Z", "creator": "D.O.Teller+bugspam@gmail.com", "author": "D.O.Teller+bugspam@gmail.com"}, {"creator": "D.O.Teller+bugspam@gmail.com", "author": "D.O.Teller+bugspam@gmail.com", "raw_text": "Richard, if you are still interested in this bug, you should synchronize with BenWa and froydnj over irc.", "creation_time": "2013-04-25T15:21:39Z", "text": "Richard, if you are still interested in this bug, you should synchronize with BenWa and froydnj over irc.", "attachment_id": null, "time": "2013-04-25T15:21:39Z", "is_private": false, "count": 9, "tags": [], "id": 7355065, "bug_id": 691309}, {"author": "u415160@disabled.tld", "creator": "u415160@disabled.tld", "bug_id": 691309, "id": 7588784, "is_private": false, "count": 10, "tags": [], "time": "2013-06-30T07:23:56Z", "attachment_id": null, "text": "Unfortunately i won't be able to look at this anymore.", "creation_time": "2013-06-30T07:23:56Z", "raw_text": "Unfortunately i won't be able to look at this anymore."}]}}}