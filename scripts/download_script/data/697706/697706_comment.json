{"bugs": {"697706": {"comments": [{"time": "2011-10-27T13:56:25Z", "attachment_id": null, "raw_text": "When the variable \"archive_keep_folder_structure\" messages is set to \"true\", messages coming from Inbox should be archived into into Archives\\Year\\Inbox.\nThe problem is that messages are archived into Archives\\Year instead.\nMessages from Inbox\\Subfolder are archived into Archives\\Year\\Subfolder. This shows that the \"Inbox\" directory is just skipped.\n\nSoftware version: Thunderbird 7.0.1, under both FreeBSD and Windows XP, with Lightning extension installed (both enabled and disabled).\n\nSteps to reproduce:\n1- create an empty profile\n2- create a dummy e-mail account and set it so that:\n\n   mail.identity.id1.archive_folder = mailbox://user@localhost/Archives\n   mail.identity.id1.archive_granularity = 1\n   mail.identity.id1.archive_keep_folder_structure = true\n\n3- start writing a message, save it in drafts\n4- move the draft into the Inbox folder\n5- right-click the message and select \"Archive\".\n   The message is moved into Archives\\2011\n6- if you create other folders (e.g. sub-folders of Inbox) you can reproduce the effects described above: the folder structure is kept except for the level \"Inbox\".\n\nThe Error Console only shows one entry (but I am not sure it related):\n> Warning: Use of getAttributeNodeNS() is deprecated. Use getAttributeNS() instead.\n> Source File: chrome://messenger/content/messenger.xul\n> Line: 0\n\nThank you in advance!", "tags": [], "creator": "ardovm@yahoo.it", "author": "ardovm@yahoo.it", "text": "When the variable \"archive_keep_folder_structure\" messages is set to \"true\", messages coming from Inbox should be archived into into Archives\\Year\\Inbox.\nThe problem is that messages are archived into Archives\\Year instead.\nMessages from Inbox\\Subfolder are archived into Archives\\Year\\Subfolder. This shows that the \"Inbox\" directory is just skipped.\n\nSoftware version: Thunderbird 7.0.1, under both FreeBSD and Windows XP, with Lightning extension installed (both enabled and disabled).\n\nSteps to reproduce:\n1- create an empty profile\n2- create a dummy e-mail account and set it so that:\n\n   mail.identity.id1.archive_folder = mailbox://user@localhost/Archives\n   mail.identity.id1.archive_granularity = 1\n   mail.identity.id1.archive_keep_folder_structure = true\n\n3- start writing a message, save it in drafts\n4- move the draft into the Inbox folder\n5- right-click the message and select \"Archive\".\n   The message is moved into Archives\\2011\n6- if you create other folders (e.g. sub-folders of Inbox) you can reproduce the effects described above: the folder structure is kept except for the level \"Inbox\".\n\nThe Error Console only shows one entry (but I am not sure it related):\n> Warning: Use of getAttributeNodeNS() is deprecated. Use getAttributeNS() instead.\n> Source File: chrome://messenger/content/messenger.xul\n> Line: 0\n\nThank you in advance!", "count": 0, "bug_id": 697706, "id": 5808722, "is_private": false, "creation_time": "2011-10-27T13:56:25Z"}, {"tags": [], "time": "2011-10-29T07:47:20Z", "attachment_id": null, "raw_text": "(In reply to Arrigo Marchiori from comment #0)\nMore info in bug 630784", "bug_id": 697706, "id": 5813106, "is_private": false, "creation_time": "2011-10-29T07:47:20Z", "creator": "wraithlike@gmail.com", "author": "wraithlike@gmail.com", "text": "(In reply to Arrigo Marchiori from comment #0)\nMore info in bug 630784", "count": 1}, {"is_private": false, "creation_time": "2011-10-30T14:31:27Z", "creator": "ardovm@yahoo.it", "tags": [], "attachment_id": null, "bug_id": 697706, "id": 5813869, "author": "ardovm@yahoo.it", "text": "(In reply to Hashem Masoud from comment #1)\n\nThank you for the pointer, Hashem.\n\nHowever, I should add that this bug is not related to IMAP. The test I proposed above does not configure any POP3 or IMAP servers, and my mail servers are all POP3.", "count": 2, "time": "2011-10-30T14:31:27Z", "raw_text": "(In reply to Hashem Masoud from comment #1)\n\nThank you for the pointer, Hashem.\n\nHowever, I should add that this bug is not related to IMAP. The test I proposed above does not configure any POP3 or IMAP servers, and my mail servers are all POP3."}, {"tags": [], "raw_text": "Confirmed with Tb 7.0.1.\n\nArchive setting of a POP3 account, which are set via UI of Account Settings/Copies&Folders, Message Archives, Archive Options.\n(only one identity is defined for this account)\n> mail.identity.idX.archive_enabled = true (usually not shown in about config if true)\n> mail.identity.idX.archives_folder_picker_mode = 0 (Archives of an account)\n> mail.identity.idX.archive_folder = mailbox://y-01@y.y.y/Archives (Archives of my own)\n> mail.identity.idX.archive_granularity = 0 (A single folder)\n> mail.identity.idX.archive_keep_folder_structure = true\n\n  Folder where a mail is held    Folder the mail is archived to\n   root-level Inbox               Archives             <= this bug\n   root-level XXX                 Archives/XXX         <= as expected\n   Inbox/AAA                      Archives/AAA         <= this bug\n   Inbox/Inbox/BBB                Archives/Inbox/BBB   <= this bug\n   XXX/YYY                        Archives/XXX/YYY     <= as expected\n\nProblem occurs with any valid archive_granularity value.", "attachment_id": null, "time": "2011-10-30T23:39:56Z", "is_private": false, "creation_time": "2011-10-30T23:39:56Z", "bug_id": 697706, "id": 5814339, "count": 3, "text": "Confirmed with Tb 7.0.1.\n\nArchive setting of a POP3 account, which are set via UI of Account Settings/Copies&Folders, Message Archives, Archive Options.\n(only one identity is defined for this account)\n> mail.identity.idX.archive_enabled = true (usually not shown in about config if true)\n> mail.identity.idX.archives_folder_picker_mode = 0 (Archives of an account)\n> mail.identity.idX.archive_folder = mailbox://y-01@y.y.y/Archives (Archives of my own)\n> mail.identity.idX.archive_granularity = 0 (A single folder)\n> mail.identity.idX.archive_keep_folder_structure = true\n\n  Folder where a mail is held    Folder the mail is archived to\n   root-level Inbox               Archives             <= this bug\n   root-level XXX                 Archives/XXX         <= as expected\n   Inbox/AAA                      Archives/AAA         <= this bug\n   Inbox/Inbox/BBB                Archives/Inbox/BBB   <= this bug\n   XXX/YYY                        Archives/XXX/YYY     <= as expected\n\nProblem occurs with any valid archive_granularity value.", "author": "m-wada@usa.com", "creator": "m-wada@usa.com"}, {"creator": "lukefilewalker@gmx.net", "creation_time": "2012-07-31T09:16:02Z", "is_private": false, "attachment_id": null, "tags": [], "count": 4, "text": "Hello\n\nAny news about this bug? It's still present in current TB 14.0.", "author": "lukefilewalker@gmx.net", "id": 6519619, "bug_id": 697706, "time": "2012-07-31T09:16:02Z", "raw_text": "Hello\n\nAny news about this bug? It's still present in current TB 14.0."}, {"raw_text": "This bug is still present on version 15.0.", "attachment_id": null, "time": "2012-09-04T09:39:03Z", "tags": [], "count": 5, "text": "This bug is still present on version 15.0.", "author": "ardovm@yahoo.it", "creator": "ardovm@yahoo.it", "creation_time": "2012-09-04T09:39:03Z", "is_private": false, "id": 6606790, "bug_id": 697706}, {"raw_text": "Bug still present on version 24.1.0", "time": "2013-11-05T08:33:56Z", "bug_id": 697706, "id": 8041079, "author": "ardovm@yahoo.it", "text": "Bug still present on version 24.1.0", "count": 6, "tags": [], "attachment_id": null, "creation_time": "2013-11-05T08:33:56Z", "is_private": false, "creator": "ardovm@yahoo.it"}, {"bug_id": 697706, "id": 9476021, "is_private": false, "creation_time": "2014-10-21T08:59:18Z", "creator": "krzysztof.krason@gmail.com", "text": "Still occuring in EarlyBird 35.0a2", "count": 7, "author": "krzysztof.krason@gmail.com", "tags": [], "time": "2014-10-21T08:59:18Z", "raw_text": "Still occuring in EarlyBird 35.0a2", "attachment_id": null}, {"attachment_id": null, "raw_text": "Still occurring.", "time": "2015-01-21T17:07:37Z", "tags": [], "author": "marcelg@hay.net", "count": 8, "text": "Still occurring.", "creator": "marcelg@hay.net", "creation_time": "2015-01-21T17:07:37Z", "is_private": false, "id": 9823828, "bug_id": 697706}, {"tags": [], "time": "2015-01-21T23:12:25Z", "attachment_id": null, "raw_text": "Comment in source.\n> http://mxr.mozilla.org/comm-central/source/mail/base/content/mailWindowOverlay.js#1782\n> 1786       if (archiveFolder.canCreateSubfolders && batch.keepFolderStructure) {\n> 1787         // Collect in-order list of folders of source folder structure,\n> 1788         // excluding top-level INBOX folder\nIt looks intentional.\nAffected by support of namespace=\"Inbox.\" imap server?\nIf so, I yhink mail.server.server#.namespace.personal etc. is better counted when keeping FolderStructure, or \"exclding top level Inbox\" is better optional, in order to avoid confusion of POP3 users and no-namespace imap server users. .", "bug_id": 697706, "id": 9825855, "is_private": false, "creation_time": "2015-01-21T23:12:25Z", "creator": "m-wada@usa.com", "author": "m-wada@usa.com", "count": 9, "text": "Comment in source.\n> http://mxr.mozilla.org/comm-central/source/mail/base/content/mailWindowOverlay.js#1782\n> 1786       if (archiveFolder.canCreateSubfolders && batch.keepFolderStructure) {\n> 1787         // Collect in-order list of folders of source folder structure,\n> 1788         // excluding top-level INBOX folder\nIt looks intentional.\nAffected by support of namespace=\"Inbox.\" imap server?\nIf so, I yhink mail.server.server#.namespace.personal etc. is better counted when keeping FolderStructure, or \"exclding top level Inbox\" is better optional, in order to avoid confusion of POP3 users and no-namespace imap server users. ."}, {"time": "2016-02-13T15:23:24Z", "raw_text": "This is a 4 year old issue, could a DEV comment? Would anyone (@WADA) know the reason why this is intentional?", "id": 11163643, "bug_id": 697706, "author": "gro.allizom@danols.com", "text": "This is a 4 year old issue, could a DEV comment? Would anyone (@WADA) know the reason why this is intentional?", "count": 10, "tags": [], "attachment_id": null, "creation_time": "2016-02-13T15:23:24Z", "is_private": false, "creator": "gro.allizom@danols.com"}, {"attachment_id": null, "tags": [], "creator": "gro.allizom@danols.com", "creation_time": "2016-02-13T15:29:00Z", "is_private": false, "time": "2016-02-13T15:29:00Z", "raw_text": "Could anyone point me in the right direction on how could I can modify the code myself? If I understand correclty Thunderbird is a JS application. So at first I attempted to locate the `mainWindowOverlay.js` in the install folder but it was not found, then I did a grep search for `excluding top-level INBOX folde` (http://mxr.mozilla.org/comm-central/source/mail/base/content/mailWindowOverlay.js#1813) but still no luck.", "count": 11, "text": "Could anyone point me in the right direction on how could I can modify the code myself? If I understand correclty Thunderbird is a JS application. So at first I attempted to locate the `mainWindowOverlay.js` in the install folder but it was not found, then I did a grep search for `excluding top-level INBOX folde` (http://mxr.mozilla.org/comm-central/source/mail/base/content/mailWindowOverlay.js#1813) but still no luck.", "author": "gro.allizom@danols.com", "id": 11163647, "bug_id": 697706}, {"tags": [], "time": "2016-02-15T18:41:00Z", "attachment_id": null, "raw_text": "You are looking in the right place for the archive code in mailWindowOverlay.js  Although not all of TB is JS, the archive methods are all in JS.\n\nThe correct way to adapt the behavior would be an extension. Unfortunately, in one of my extensions where I adapted the archive behavior, I have this note:\n\n  function processNextBatch_exquilla()\n  {\n    log.debug(\"Calling overridden processNextBatch\");\n\n    // I really hate to use a frozen version of this. I need to add a hook in the core\n    //  code instead. See bug 832034.\n\nThat is, there are not adequate hooks to override this in the existing code.", "bug_id": 697706, "id": 11166518, "is_private": false, "creation_time": "2016-02-15T18:41:00Z", "creator": "rkent@caspia.com", "author": "rkent@caspia.com", "count": 12, "text": "You are looking in the right place for the archive code in mailWindowOverlay.js  Although not all of TB is JS, the archive methods are all in JS.\n\nThe correct way to adapt the behavior would be an extension. Unfortunately, in one of my extensions where I adapted the archive behavior, I have this note:\n\n  function processNextBatch_exquilla()\n  {\n    log.debug(\"Calling overridden processNextBatch\");\n\n    // I really hate to use a frozen version of this. I need to add a hook in the core\n    //  code instead. See bug 832034.\n\nThat is, there are not adequate hooks to override this in the existing code."}, {"tags": [], "time": "2020-11-17T22:28:23Z", "raw_text": "Have just installed Thunderbird 78.3.1 in new CentOS 8 installation these days - I can't believe this annoying \"feature\" is still present...\n\nIn particular, because I have some installations (Thunderbird installed between 2015 and 2019 in CentOS 7 and Fedora 29 / 30 / 31 / 32) where this is respected (so I get messages to Archives-2020-Inbox, as expected...). The last one at Fedora 32, installed last year (in Fedora 29 at that time), and regularly updated by now. No problem there.\n\nIs there any (hidden?) setting to achieve this - by my opinion just normal - behavior? Or, any other workaround?", "attachment_id": null, "bug_id": 697706, "id": 15136650, "is_private": false, "creation_time": "2020-11-17T22:28:23Z", "creator": "luti@gmx.net", "text": "Have just installed Thunderbird 78.3.1 in new CentOS 8 installation these days - I can't believe this annoying \"feature\" is still present...\n\nIn particular, because I have some installations (Thunderbird installed between 2015 and 2019 in CentOS 7 and Fedora 29 / 30 / 31 / 32) where this is respected (so I get messages to Archives-2020-Inbox, as expected...). The last one at Fedora 32, installed last year (in Fedora 29 at that time), and regularly updated by now. No problem there.\n\nIs there any (hidden?) setting to achieve this - by my opinion just normal - behavior? Or, any other workaround?", "count": 13, "author": "luti@gmx.net"}, {"attachment_id": null, "raw_text": "For version Thunderbird 91.3.2 (64-bit),\narchive: omni.ja\nfile: modules\\MessageArchiver.jsm\n_possible_ problem code location: line 252\n\n  while (folder != rootFolder && folder != inboxFolder) {\n    folderNames.unshift(folder.name);\n    folder = folder.parent;\n  }\n\nINBOX folder removed archive from structure.\nWhat the reason to process inboxFolder other than any folders?\nThis turns \"keep original folder structure\" to \"keep original folder structure, EXCLUDE INBOX\" :(\nUser don't get expected structure.", "time": "2021-11-30T05:03:42Z", "tags": [], "author": "glukout39@yopmail.com", "text": "For version Thunderbird 91.3.2 (64-bit),\narchive: omni.ja\nfile: modules\\MessageArchiver.jsm\n_possible_ problem code location: line 252\n\n  while (folder != rootFolder && folder != inboxFolder) {\n    folderNames.unshift(folder.name);\n    folder = folder.parent;\n  }\n\nINBOX folder removed archive from structure.\nWhat the reason to process inboxFolder other than any folders?\nThis turns \"keep original folder structure\" to \"keep original folder structure, EXCLUDE INBOX\" :(\nUser don't get expected structure.", "count": 14, "creator": "glukout39@yopmail.com", "is_private": false, "creation_time": "2021-11-30T05:03:42Z", "bug_id": 697706, "id": 15677211}, {"bug_id": 697706, "id": 15677634, "author": "glukout39@yopmail.com", "text": "My proof of concept test i made on Thunderbird 91.3.2 (64-bit):\n\n1. I created folder \"zabbix\" as \"INBOX\" subfolder on IMAP account.\n2. Copied any message to \"INBOX\\zabbix\" folder.\n3. I created local folder \"archive\"\n4. Configured archiving to \"archive\" folder, \"one folder\" option (no \"by years\", no \"by monthes\"), check \"keep original folder structure\".\n5. Right mouse button on message in \"INBOX\\zabbix\" - Archive action.\n6. Thunderbird created \"zabbix\" folder as \"archive\" folder and place message to \"archive\\zabbix\".\n\n7. Extract file \"modules\\MessageArchiver.jsm\" from \"C:\\Program Files\\Mozilla Thunderbird\\omni.ja\".\n8. Change line 252 from\n`      while (folder != rootFolder && folder != inboxFolder) {`\n   to \n`      while (folder != rootFolder /*&& folder != inboxFolder*/) {`\n  then repack file back to onmi.ja\n\n9. Repeate archive message action as (5) above.\n10. Thunderbird created \"INBOX\\zabbix\" folder as \"archive\" subfolder folder and place message to **\"archive\\INBOX\\zabbix\"**.", "count": 15, "time": "2021-11-30T13:09:25Z", "raw_text": "My proof of concept test i made on Thunderbird 91.3.2 (64-bit):\n\n1. I created folder \"zabbix\" as \"INBOX\" subfolder on IMAP account.\n2. Copied any message to \"INBOX\\zabbix\" folder.\n3. I created local folder \"archive\"\n4. Configured archiving to \"archive\" folder, \"one folder\" option (no \"by years\", no \"by monthes\"), check \"keep original folder structure\".\n5. Right mouse button on message in \"INBOX\\zabbix\" - Archive action.\n6. Thunderbird created \"zabbix\" folder as \"archive\" folder and place message to \"archive\\zabbix\".\n\n7. Extract file \"modules\\MessageArchiver.jsm\" from \"C:\\Program Files\\Mozilla Thunderbird\\omni.ja\".\n8. Change line 252 from\n`      while (folder != rootFolder && folder != inboxFolder) {`\n   to \n`      while (folder != rootFolder /*&& folder != inboxFolder*/) {`\n  then repack file back to onmi.ja\n\n9. Repeate archive message action as (5) above.\n10. Thunderbird created \"INBOX\\zabbix\" folder as \"archive\" subfolder folder and place message to **\"archive\\INBOX\\zabbix\"**.", "creation_time": "2021-11-30T13:09:25Z", "is_private": false, "creator": "glukout39@yopmail.com", "tags": [], "attachment_id": null}]}}, "comments": {}}