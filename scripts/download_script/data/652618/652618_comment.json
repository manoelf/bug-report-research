{"bugs": {"652618": {"comments": [{"is_private": false, "count": 0, "time": "2011-04-25T19:54:53Z", "author": "michael.j.tosh@lmco.com", "id": 5430044, "attachment_id": null, "tags": [], "creation_time": "2011-04-25T19:54:53Z", "creator": "michael.j.tosh@lmco.com", "raw_text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.16) Gecko/20110319 Firefox/3.6.16 (.NET CLR 3.5.30729)\nBuild Identifier: \n\nWhen the params file is rewritten, any time a param is changed, then the group permissions are not set properly.  In order to properly set permissions, the user must run checksetup.pl after each change.\n\nI have \"apache\" user running under the \"apache\" group, but also a member of the \"bz-run\" group.  I have set the webservergroup in localconfig to be \"bz-run\".  I also have a local user account on the system (not my webserver) called \"bz-admin\", who is a member of \"bz-run\".\n\nFor security reasons, we do not run whine.pl or collectstats.pl under the apache user, we instead run them under the bz-admin user.  If a change is made to params, then whine.pl and collectstats.pl cannot run.\n\nReproducible: Always\n\n\n\n\nThe code to correct this problem, in Bugzilla/Install/Filesystem.pm, is only run if Bugzilla->usage_mode == USAGE_MODE_CMDLINE.  I would expect that when recreating the params file, an expected change, that the permissions are set correctly.", "bug_id": 652618, "text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.16) Gecko/20110319 Firefox/3.6.16 (.NET CLR 3.5.30729)\nBuild Identifier: \n\nWhen the params file is rewritten, any time a param is changed, then the group permissions are not set properly.  In order to properly set permissions, the user must run checksetup.pl after each change.\n\nI have \"apache\" user running under the \"apache\" group, but also a member of the \"bz-run\" group.  I have set the webservergroup in localconfig to be \"bz-run\".  I also have a local user account on the system (not my webserver) called \"bz-admin\", who is a member of \"bz-run\".\n\nFor security reasons, we do not run whine.pl or collectstats.pl under the apache user, we instead run them under the bz-admin user.  If a change is made to params, then whine.pl and collectstats.pl cannot run.\n\nReproducible: Always\n\n\n\n\nThe code to correct this problem, in Bugzilla/Install/Filesystem.pm, is only run if Bugzilla->usage_mode == USAGE_MODE_CMDLINE.  I would expect that when recreating the params file, an expected change, that the permissions are set correctly."}, {"raw_text": "Without this fix, whine.pl and collectstats.pl need to run as the apache user.  With this fix, as long as they are a member of $webservergroup, they can read the params file.", "creator": "michael.j.tosh@lmco.com", "text": "Created attachment 565292\nCode Patch Ver 1\n\nWithout this fix, whine.pl and collectstats.pl need to run as the apache user.  With this fix, as long as they are a member of $webservergroup, they can read the params file.", "time": "2011-10-06T18:14:35Z", "count": 1, "creation_time": "2011-10-06T18:14:35Z", "tags": [], "attachment_id": 565292, "bug_id": 652618, "is_private": false, "author": "michael.j.tosh@lmco.com", "id": 5764065}, {"count": 2, "time": "2011-11-22T16:56:11Z", "text": "Comment on attachment 565292\nCode Patch Ver 1\n\n>=== modified file 'Bugzilla/Config.pm'\n\n> sub _fix_perms {\n\n>     # The webserver should never try to chown files.\n>-    if (Bugzilla->usage_mode == USAGE_MODE_CMDLINE) {\n>+    if (Bugzilla->usage_mode == USAGE_MODE_CMDLINE || $force) {\n\nThe comment is now wrong with this $force argument. I will let mkanat review this patch.", "creator": "LpSolit@gmail.com", "raw_text": ">=== modified file 'Bugzilla/Config.pm'\n\n> sub _fix_perms {\n\n>     # The webserver should never try to chown files.\n>-    if (Bugzilla->usage_mode == USAGE_MODE_CMDLINE) {\n>+    if (Bugzilla->usage_mode == USAGE_MODE_CMDLINE || $force) {\n\nThe comment is now wrong with this $force argument. I will let mkanat review this patch.", "id": 5865587, "author": "LpSolit@gmail.com", "is_private": false, "bug_id": 652618, "attachment_id": 565292, "tags": [], "creation_time": "2011-11-22T16:56:11Z"}, {"attachment_id": 565292, "creation_time": "2011-11-23T22:06:36Z", "tags": [], "creator": "mkanat@bugzilla.org", "raw_text": "Review of attachment 565292:\n-----------------------------------------------------------------\n\nThe reason that that code is behind USAGE_MODE_CMDLINE is that Apache runs under only one user and one group--it can't normally change ownership on any other file. Also, we usually don't want the owner to change to the current user, when in the webserver, because that owner is Apache.\n\nInstead, perhaps we should investigate some way of creating the file with the same permissions as the original file. Perhaps using File::copy would do it.", "bug_id": 652618, "text": "Comment on attachment 565292\nCode Patch Ver 1\n\nReview of attachment 565292:\n-----------------------------------------------------------------\n\nThe reason that that code is behind USAGE_MODE_CMDLINE is that Apache runs under only one user and one group--it can't normally change ownership on any other file. Also, we usually don't want the owner to change to the current user, when in the webserver, because that owner is Apache.\n\nInstead, perhaps we should investigate some way of creating the file with the same permissions as the original file. Perhaps using File::copy would do it.", "is_private": false, "count": 3, "time": "2011-11-23T22:06:36Z", "author": "mkanat@bugzilla.org", "id": 5869532}]}}, "comments": {}}