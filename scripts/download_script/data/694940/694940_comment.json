{"bugs": {"694940": {"comments": [{"creation_time": "2011-10-17T10:36:23Z", "raw_text": "Loading script with script.async=false does not preserve order execution.\n\nThe bug seems platform specific. I'm getting it only on a 32 bit Linux machine with Firefox 7.0.1 and Ubuntu 10.04.\nI couldn't reproduce the bug on Linux 64 bit, Windows and Mac\n\nHere is a minimal test case I'm running. You can find it online at this url:\nhttp://rewind.sgconsulting.it/test-lab/index2.html\n\nThe javascript code is this:\n<script type=\"text/javascript\">\nvar script1 = document.createElement(\"script\"),\n    script2 = document.createElement(\"script\")\n;\n\nscript1.async = false;\nscript1.src = \"http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js\";\n\nscript2.async = false;\nscript2.src = \"../js/jquery.lightbox-0.5.min.js\";\n\ndocument.head.appendChild(script1);\ndocument.head.appendChild(script2);\n</script>\n\nSometimes the jQuery is executed after jquery.lightbox and so I get an error.\nSee the attached file with a screenshot of the firebug console.", "attachment_id": 567413, "time": "2011-10-17T10:36:23Z", "text": "Created attachment 567413\nScreenshot of the firebug console\n\nLoading script with script.async=false does not preserve order execution.\n\nThe bug seems platform specific. I'm getting it only on a 32 bit Linux machine with Firefox 7.0.1 and Ubuntu 10.04.\nI couldn't reproduce the bug on Linux 64 bit, Windows and Mac\n\nHere is a minimal test case I'm running. You can find it online at this url:\nhttp://rewind.sgconsulting.it/test-lab/index2.html\n\nThe javascript code is this:\n<script type=\"text/javascript\">\nvar script1 = document.createElement(\"script\"),\n    script2 = document.createElement(\"script\")\n;\n\nscript1.async = false;\nscript1.src = \"http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js\";\n\nscript2.async = false;\nscript2.src = \"../js/jquery.lightbox-0.5.min.js\";\n\ndocument.head.appendChild(script1);\ndocument.head.appendChild(script2);\n</script>\n\nSometimes the jQuery is executed after jquery.lightbox and so I get an error.\nSee the attached file with a screenshot of the firebug console.", "id": 5785940, "tags": [], "is_private": false, "count": 0, "bug_id": 694940, "author": "filippo.pacini@gmail.com", "creator": "filippo.pacini@gmail.com"}, {"id": 5786683, "is_private": false, "count": 1, "tags": [], "bug_id": 694940, "creation_time": "2011-10-17T17:23:04Z", "raw_text": "Non-parser-inserted scripts do not have any execution order imposed on them per spec, last I checked.  They're executed in the order they load in.", "attachment_id": null, "time": "2011-10-17T17:23:04Z", "text": "Non-parser-inserted scripts do not have any execution order imposed on them per spec, last I checked.  They're executed in the order they load in.", "author": "bzbarsky@mit.edu", "creator": "bzbarsky@mit.edu"}, {"id": 5788573, "tags": [], "count": 2, "is_private": false, "bug_id": 694940, "creation_time": "2011-10-18T09:01:52Z", "raw_text": "I'm not an expert in the field, but googling around I found this proposal as accepted and part of HTML5 spec:\n\"Make script-inserted external scripts that have .async=false execute in the insertion order, default to true\"\nhttp://www.w3.org/Bugs/Public/show_bug.cgi?id=11295\n\nSee also here:\nhttp://wiki.whatwg.org/wiki/Dynamic_Script_Execution_Order\nfor a discussion on the matter.", "attachment_id": null, "time": "2011-10-18T09:01:52Z", "text": "I'm not an expert in the field, but googling around I found this proposal as accepted and part of HTML5 spec:\n\"Make script-inserted external scripts that have .async=false execute in the insertion order, default to true\"\nhttp://www.w3.org/Bugs/Public/show_bug.cgi?id=11295\n\nSee also here:\nhttp://wiki.whatwg.org/wiki/Dynamic_Script_Execution_Order\nfor a discussion on the matter.", "author": "filippo.pacini@gmail.com", "creator": "filippo.pacini@gmail.com"}, {"author": "filippo.pacini@gmail.com", "creator": "filippo.pacini@gmail.com", "bug_id": 694940, "id": 5788696, "tags": [], "is_private": false, "count": 3, "time": "2011-10-18T11:05:08Z", "attachment_id": null, "text": "Ok I think I found out what's happening:\n\nwhen I request the script from:\nhttp://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js\n\ngoogle answers with a redirect to the same url but using the https protocol.\n\nThis causes sometimes the script to be inserted in the html after the second one and so it's executed later.\n\nI don't know if this behavior is a bug according to html specs or not, but preserving execution order is important e.g. for script loaders which are becoming popular especially in big sites.", "raw_text": "Ok I think I found out what's happening:\n\nwhen I request the script from:\nhttp://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js\n\ngoogle answers with a redirect to the same url but using the https protocol.\n\nThis causes sometimes the script to be inserted in the html after the second one and so it's executed later.\n\nI don't know if this behavior is a bug according to html specs or not, but preserving execution order is important e.g. for script loaders which are becoming popular especially in big sites.", "creation_time": "2011-10-18T11:05:08Z"}, {"creator": "getify@gmail.com", "author": "getify@gmail.com", "tags": [], "is_private": false, "count": 4, "id": 5788784, "bug_id": 694940, "raw_text": "(In reply to Boris Zbarsky (:bz) from comment #1)\n> Non-parser-inserted scripts do not have any execution order imposed on them\n> per spec, last I checked.  They're executed in the order they load in.\n\nBoris, you may recall that in FF4b8, FF implemented what I call \"ordered async\", which was later spec'd by Ian. \"Ordered Async\" means that dynamically inserted scripts which have their `async` property set to false will all load in parallel, but will execute in order (that is, the order they are requested, not the order they finish loading).\n\nFor reference:\n\nhttps://bugzilla.mozilla.org/show_bug.cgi?id=602838\n\nhttp://wiki.whatwg.org/wiki/Dynamic_Script_Execution_Order\n\nhttp://www.w3.org/Bugs/Public/show_bug.cgi?id=11295\n\nhttp://ln.hixie.ch/?start=1296711456&count=1\n\n-------------\n\nI helped filipo develop this simple test for this bug report, using no other lib and just creating dynamically inserted script elements with `async=false`. I couldn't reproduce on my machine the out-of-order behavior that he was seeing, but I confirmed that it did in fact exhibit that unexpected (buggy) behavior on his machine (linux, with FF7).\n\nFilipo: if you change the test to request jquery from the https:// address, does the bug go away? If so, that might in fact point in the general direction of the source of this bug.", "creation_time": "2011-10-18T12:27:20Z", "text": "(In reply to Boris Zbarsky (:bz) from comment #1)\n> Non-parser-inserted scripts do not have any execution order imposed on them\n> per spec, last I checked.  They're executed in the order they load in.\n\nBoris, you may recall that in FF4b8, FF implemented what I call \"ordered async\", which was later spec'd by Ian. \"Ordered Async\" means that dynamically inserted scripts which have their `async` property set to false will all load in parallel, but will execute in order (that is, the order they are requested, not the order they finish loading).\n\nFor reference:\n\nhttps://bugzilla.mozilla.org/show_bug.cgi?id=602838\n\nhttp://wiki.whatwg.org/wiki/Dynamic_Script_Execution_Order\n\nhttp://www.w3.org/Bugs/Public/show_bug.cgi?id=11295\n\nhttp://ln.hixie.ch/?start=1296711456&count=1\n\n-------------\n\nI helped filipo develop this simple test for this bug report, using no other lib and just creating dynamically inserted script elements with `async=false`. I couldn't reproduce on my machine the out-of-order behavior that he was seeing, but I confirmed that it did in fact exhibit that unexpected (buggy) behavior on his machine (linux, with FF7).\n\nFilipo: if you change the test to request jquery from the https:// address, does the bug go away? If so, that might in fact point in the general direction of the source of this bug.", "time": "2011-10-18T12:27:20Z", "attachment_id": null}, {"is_private": false, "count": 5, "tags": [], "id": 5788898, "bug_id": 694940, "creation_time": "2011-10-18T13:23:28Z", "raw_text": "Yes using https the bug goes way.\n\nI've also tried creating a simple test loading 2 scripts with the first script sleeping for some seconds and then redirecting to a different url but I can't reproduce the bug. Neither to http nor to https\n\nMight it be something related to how google does the redirect? \nHere is a screenshot of my Net Panel in firebug when the error occur:\nhttp://rewind.sgconsulting.it/test-lab/when_error_occurs.png\n\nThe google request has no response code while in my tests with a status code 302 everything works fine.", "text": "Yes using https the bug goes way.\n\nI've also tried creating a simple test loading 2 scripts with the first script sleeping for some seconds and then redirecting to a different url but I can't reproduce the bug. Neither to http nor to https\n\nMight it be something related to how google does the redirect? \nHere is a screenshot of my Net Panel in firebug when the error occur:\nhttp://rewind.sgconsulting.it/test-lab/when_error_occurs.png\n\nThe google request has no response code while in my tests with a status code 302 everything works fine.", "creator": "filippo.pacini@gmail.com", "time": "2011-10-18T13:23:28Z", "attachment_id": null, "author": "filippo.pacini@gmail.com"}, {"author": "bzbarsky@mit.edu", "creator": "bzbarsky@mit.edu", "bug_id": 694940, "id": 5789530, "tags": [], "count": 6, "is_private": false, "time": "2011-10-18T17:33:13Z", "attachment_id": null, "text": "> Boris, you may recall that in FF4b8, FF implemented what I call \"ordered async\"\n\nAh, I had forgotten that in fact.  OK.\n\nThe redirect thing should not affect script ordering behavior.\n\nLike Kyle, I cannot reproduce this problem...\n\nfilippo, can you reproduce the problem in safe mode?", "creation_time": "2011-10-18T17:33:13Z", "raw_text": "> Boris, you may recall that in FF4b8, FF implemented what I call \"ordered async\"\n\nAh, I had forgotten that in fact.  OK.\n\nThe redirect thing should not affect script ordering behavior.\n\nLike Kyle, I cannot reproduce this problem...\n\nfilippo, can you reproduce the problem in safe mode?"}, {"creator": "filippo.pacini@gmail.com", "author": "filippo.pacini@gmail.com", "creation_time": "2011-10-19T10:22:31Z", "raw_text": "Yes I could reproduce the problem in safe mode. See\nhttp://rewind.sgconsulting.it/test-lab/safe_mode.png\n\nI was also able to reproduce the problem on another machine. \nSo I'm sure it's not a problem of my pc :-)\n\nBoth machines are Ubuntu Linux 32bit. One is 10.04 the other is 10.10.\nFirefox is 7.0.1 installed using ppa:mozillateam/firefox-stable", "text": "Yes I could reproduce the problem in safe mode. See\nhttp://rewind.sgconsulting.it/test-lab/safe_mode.png\n\nI was also able to reproduce the problem on another machine. \nSo I'm sure it's not a problem of my pc :-)\n\nBoth machines are Ubuntu Linux 32bit. One is 10.04 the other is 10.10.\nFirefox is 7.0.1 installed using ppa:mozillateam/firefox-stable", "attachment_id": null, "time": "2011-10-19T10:22:31Z", "is_private": false, "count": 7, "tags": [], "id": 5791474, "bug_id": 694940}, {"bug_id": 694940, "is_private": false, "count": 8, "tags": [], "id": 5791561, "text": "I installed 32-bit Ubuntu 10.04 and Firefox 7.0.1 from the PPA on VirtualBox OSE on 64-bit Ubuntu 11.10 host. I was unable to reproduce the problem.\n\nThe network view from comment 5 looks really strange. What causes the second jquery request if the first one is still stalled?", "time": "2011-10-19T12:10:24Z", "attachment_id": null, "raw_text": "I installed 32-bit Ubuntu 10.04 and Firefox 7.0.1 from the PPA on VirtualBox OSE on 64-bit Ubuntu 11.10 host. I was unable to reproduce the problem.\n\nThe network view from comment 5 looks really strange. What causes the second jquery request if the first one is still stalled?", "creation_time": "2011-10-19T12:10:24Z", "creator": "hsivonen@mozilla.com", "author": "hsivonen@mozilla.com"}, {"tags": [], "is_private": false, "count": 9, "id": 5791988, "bug_id": 694940, "creation_time": "2011-10-19T15:43:37Z", "raw_text": "The first one is the request to http://ajax.googleapis.com\nThis one should redirect to the some url but with https protocol.\nThe second one is the request to the https url.\n\nI'm not sure however of the first one because in firebug I was not able to see the response (it remains as you see in the screenshot forever). I also tried with httpfox and with wireshark, but couldn't see the response.\n\nMoreover the behavior on other platforms (MAC and Windows) is different: I have a single request to the http url and the response is either a 200 or 304 status code.", "text": "The first one is the request to http://ajax.googleapis.com\nThis one should redirect to the some url but with https protocol.\nThe second one is the request to the https url.\n\nI'm not sure however of the first one because in firebug I was not able to see the response (it remains as you see in the screenshot forever). I also tried with httpfox and with wireshark, but couldn't see the response.\n\nMoreover the behavior on other platforms (MAC and Windows) is different: I have a single request to the http url and the response is either a 200 or 304 status code.", "time": "2011-10-19T15:43:37Z", "attachment_id": null, "creator": "filippo.pacini@gmail.com", "author": "filippo.pacini@gmail.com"}, {"bug_id": 694940, "tags": [], "is_private": false, "count": 10, "id": 5792293, "creator": "filippo.pacini@gmail.com", "text": "I've done some other tests trying to understand what's happening in the first request.\nDoing only a request to:\nhttp://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js\n\nHere is another screenshot made with httpfox:\nhttp://rewind.sgconsulting.it/test-lab/jquery_req.png\n\nIn the first request there's no bytes received and the response type is \"Redirect (cached)\" \nIn the sencond row there's the request to the https url with result (Cache)\n\nI've also tried replicating the exact same request using netcat, but what I get back from googleapis is a 200 OK response (directly from the http url) with the gzipped jquery library.\nThis is the same behavior as I see on other platforms or with other browsers.\n\nHope it helps.", "author": "filippo.pacini@gmail.com", "attachment_id": null, "time": "2011-10-19T17:28:16Z", "raw_text": "I've done some other tests trying to understand what's happening in the first request.\nDoing only a request to:\nhttp://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js\n\nHere is another screenshot made with httpfox:\nhttp://rewind.sgconsulting.it/test-lab/jquery_req.png\n\nIn the first request there's no bytes received and the response type is \"Redirect (cached)\" \nIn the sencond row there's the request to the https url with result (Cache)\n\nI've also tried replicating the exact same request using netcat, but what I get back from googleapis is a 200 OK response (directly from the http url) with the gzipped jquery library.\nThis is the same behavior as I see on other platforms or with other browsers.\n\nHope it helps.", "creation_time": "2011-10-19T17:28:16Z"}, {"author": "bzbarsky@mit.edu", "creator": "bzbarsky@mit.edu", "bug_id": 694940, "id": 5792304, "tags": [], "is_private": false, "count": 11, "time": "2011-10-19T17:32:30Z", "attachment_id": null, "text": "The HTTP behavior should really be irrelevant.  When a script is added to the DOM, we append it to a queue of scripts to run.  Only the first script from the queue is executed (when it's ready), then it's removed, and the process is repeated.\n\nSo if the scripts are really running out of order (as opposed to, say, the jquery script just ending up with bogus data), something is very very wrong somewhere.\n\nIf you run the same build against a clean profile, can you reproduce the problem?", "creation_time": "2011-10-19T17:32:30Z", "raw_text": "The HTTP behavior should really be irrelevant.  When a script is added to the DOM, we append it to a queue of scripts to run.  Only the first script from the queue is executed (when it's ready), then it's removed, and the process is repeated.\n\nSo if the scripts are really running out of order (as opposed to, say, the jquery script just ending up with bogus data), something is very very wrong somewhere.\n\nIf you run the same build against a clean profile, can you reproduce the problem?"}, {"id": 5793963, "is_private": false, "count": 12, "tags": [], "bug_id": 694940, "creation_time": "2011-10-20T08:13:46Z", "raw_text": "Ok I created an empty profile with only firebug installed. It's installed by default if you want I can try to install it and repeat the tests.\n\nI ran the tests doing lots and lots of reloads and I got the error only twice. \n\nI also found out what causes the strange redirect from http to https.\nIt's a plugin called HTTPS Everywhere:\nhttps://www.eff.org/https-everywhere\n\nMy bad I had completely forgotten it.", "time": "2011-10-20T08:13:46Z", "attachment_id": null, "text": "Ok I created an empty profile with only firebug installed. It's installed by default if you want I can try to install it and repeat the tests.\n\nI ran the tests doing lots and lots of reloads and I got the error only twice. \n\nI also found out what causes the strange redirect from http to https.\nIt's a plugin called HTTPS Everywhere:\nhttps://www.eff.org/https-everywhere\n\nMy bad I had completely forgotten it.", "author": "filippo.pacini@gmail.com", "creator": "filippo.pacini@gmail.com"}, {"bug_id": 694940, "is_private": false, "count": 13, "tags": [], "id": 5794155, "text": "(In reply to filippo from comment #12)\n> Ok I created an empty profile with only firebug installed. It's installed by\n> default if you want I can try to install it and repeat the tests.\n\nFirebug installed by default? Can you reproduce the problem without Firebug?\n\nI installed Firebug into PPA Firefox 7.0.1 on Ubuntu 10.04 on a VM, but I was unable to reproduce the problem (tried HTTP caches enabled and disabled).", "attachment_id": null, "time": "2011-10-20T11:36:10Z", "raw_text": "(In reply to filippo from comment #12)\n> Ok I created an empty profile with only firebug installed. It's installed by\n> default if you want I can try to install it and repeat the tests.\n\nFirebug installed by default? Can you reproduce the problem without Firebug?\n\nI installed Firebug into PPA Firefox 7.0.1 on Ubuntu 10.04 on a VM, but I was unable to reproduce the problem (tried HTTP caches enabled and disabled).", "creation_time": "2011-10-20T11:36:10Z", "creator": "hsivonen@mozilla.com", "author": "hsivonen@mozilla.com"}, {"creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu", "raw_text": "filippo, I thought you said you reproduced the problem in safe mode (i.e. without Firebug and without HTTPS Everywhere)...  Is that the case?", "creation_time": "2011-10-20T14:40:49Z", "text": "filippo, I thought you said you reproduced the problem in safe mode (i.e. without Firebug and without HTTPS Everywhere)...  Is that the case?", "time": "2011-10-20T14:40:49Z", "attachment_id": null, "is_private": false, "count": 14, "tags": [], "id": 5794404, "bug_id": 694940}, {"creator": "filippo.pacini@gmail.com", "author": "filippo.pacini@gmail.com", "bug_id": 694940, "is_private": false, "count": 15, "tags": [], "id": 5794567, "text": "(In reply to Henri Sivonen (:hsivonen) from comment #13)\n> (In reply to filippo from comment #12)\n> > Ok I created an empty profile with only firebug installed. It's installed by\n> > default if you want I can try to install it and repeat the tests.\n> \n> Firebug installed by default? Can you reproduce the problem without Firebug?\n> \n\nI had Firebug installed through apt-get and when I created the new profile it was there and got automatically updated to the latest version.\nNow I've removed the firebug package and uninstalled it. I still see the bug though rarely.\n\nI'll try to simplify the tests even more, removing jquery and using something simpler. \nI'll also try to reproduce it on other machines.\n\n(In reply to Boris Zbarsky (:bz) from comment #14)\n> filippo, I thought you said you reproduced the problem in safe mode (i.e.\n> without Firebug and without HTTPS Everywhere)...  Is that the case?\n\nYes I could see the error also in safe mode. In fact HTTPS Everywhere was disabled and there was not the double request from http to https.", "time": "2011-10-20T15:45:44Z", "attachment_id": null, "raw_text": "(In reply to Henri Sivonen (:hsivonen) from comment #13)\n> (In reply to filippo from comment #12)\n> > Ok I created an empty profile with only firebug installed. It's installed by\n> > default if you want I can try to install it and repeat the tests.\n> \n> Firebug installed by default? Can you reproduce the problem without Firebug?\n> \n\nI had Firebug installed through apt-get and when I created the new profile it was there and got automatically updated to the latest version.\nNow I've removed the firebug package and uninstalled it. I still see the bug though rarely.\n\nI'll try to simplify the tests even more, removing jquery and using something simpler. \nI'll also try to reproduce it on other machines.\n\n(In reply to Boris Zbarsky (:bz) from comment #14)\n> filippo, I thought you said you reproduced the problem in safe mode (i.e.\n> without Firebug and without HTTPS Everywhere)...  Is that the case?\n\nYes I could see the error also in safe mode. In fact HTTPS Everywhere was disabled and there was not the double request from http to https.", "creation_time": "2011-10-20T15:45:44Z"}, {"author": "bug-husbandry-bot@mozilla.bugs", "creator": "bug-husbandry-bot@mozilla.bugs", "attachment_id": null, "time": "2018-06-29T04:49:27Z", "text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1472046\n\nMove all DOM bugs that haven\u2019t been updated in more than 3 years and has no one currently assigned to P5.\n\nIf you have questions, please contact :mdaly.", "creation_time": "2018-06-29T04:49:27Z", "raw_text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1472046\n\nMove all DOM bugs that haven\u2019t been updated in more than 3 years and has no one currently assigned to P5.\n\nIf you have questions, please contact :mdaly.", "bug_id": 694940, "id": 13436210, "count": 16, "is_private": false, "tags": []}]}}, "comments": {}}