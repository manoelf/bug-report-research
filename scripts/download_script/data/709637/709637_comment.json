{"comments": {}, "bugs": {"709637": {"comments": [{"raw_text": "When Tb's profile is copied and used, two identical search folders(search folder name, msf filename) are shown always, if search folder name contains special character and msf file name for it is hashed. \n\nThis is spin-off of bug 707730 comment #20.\n\n[Steps to reproduce]\n(1) Create search folder with special character in search folder name.\n    .msf file for search folder\n      \"X Y<Z> under \"A B\" : \"A B.sbd\\X Y0b864a7a.msf\"\n    virtualFolders.dat content\n      uri=imap://uid@imap.server.name/A B/X%20Y%3CZ%3E\n      (note: space in parent folder name is not escaped since initial)\n(2) Terminate Tb\n(3) Copy Tb's profile directory Prof1 to Prof2.\n(4) Add the copied Prof2 directory as new profile p2.\n    Start profile manager, Create Profile, Choose Folder,\n      choose copied Prof2 directory\n(5) Start Tb with new profile uses copied profile\n    => Two search folders which uses same \"A B.sbd\\X Y0b864a7a.msf\" appears.\n       \"X Y<Z>\" (search folder name) and \"X Y0b864a7a\" (msf file name)\n(6) Terminate Tb\n    virtualFolders.dat content\n      uri=imap://uid@imap.server.name/A B/X%20Y%3CZ%3E\n      uri=imap://uid@imap.server.name/A B/X Y0b864a7a\n      (note: space between X and Y is not escaped)\n(7) Restart Tb\n(8) Without open of search folder, update property of search folder\n    (no left click of folder, right click, context menu, properties)\n    Update property of \"X Y<Z>\"\n      rule for uri=imap:// ... /A B/X%20Y%3CZ%3E is updated\n    Update property of\"X Y0b864a7a\"\n      rule for uri=imap:// ... /A B/\"X%20Y0b864a7a\" is updated\n      (note: space between X and Y is changed to %20 sooner or later)\n(9) Repeat (8).\n    Each setting change is saved in virtualFolders.dat,\n    and kept in properties of each search folder.\n(10) Open of search folder, and change Property of search folder\n    Left click(open) \"X Y<Z>\", Left click \"X Y0b864a7a\".\n    Open \"X Y<Z>\", uadate property of \"X Y<Z>\",\n      view property of \"X Y0b864a7a\" => update on \"X Y<Z>\" is reflected\n    Open \"X Y0b864a7a\", uadate property of \"X Y0b864a7a\",\n      view property of\"X Y<Z>\" =>  update on \"X Y0b864a7a\" is reflected\n    File of \"A B.sbd\\X Y0b864a7a.msf\" is shared.\n(11)Terminate Tb.\n    Rule for next two search folder in virtualFolders.dat is identical.\n      uri=imap://uid@imap.server.name/A B/X%20Y%3CZ%3E\n      uri=imap://uid@imap.server.name/A B/X&20Y0b864a7a\n\nQuick summary of this bug's phenomenon.\n\n.msf file for search folder\n  \"X Y<Z>\"            : \"X Y0b864a7a.msf\"\n  \"X Y<Z> under \"A B\" : \"A B.sbd\\X Y0b864a7a.msf\"\nvirtualFolders.dat content\n  uri=imap://uid@imap.server.name/X%20Y%3CZ%3E\n  uri=imap://uid@imap.server.name/A B/X%20Y%3CZ%3E\nstring relevant to search folder\n  (A1) Unescaped Search folder name  : X Y<Z>\n  (A2) Escaped Search folder name    : X%20Y%3CZ%3E\n  (B1) Unescaped msf file name       : X Y0b864a7a\n  (B2) Escaped msf file name         : X%20Y0b864a7a\n\n(1) If (B1) != (A2), search folder named (A1) and (B1) is shown at folder pane upon restart, and \"uri with enescaped (B1)\" is written to virtualFolders.dat in addition to proper/escaped \"uri with (A2)\".\nIf \"bla bla\", (A1)==(B1), so duplicated search folder is shown at folder pane.\n(2) \"uri with enescaped (B1)\" is replaced by correct \"uri with escaped (B2)\" sooner or later.\n(3-1) If (B2) == (A2), only single \"uri with (A2)==(B2)\" is kept in virtualFolders.dat, and only single search folder of (A1)==(B1) is shown at folder pane after restart.\n(3-2) If (B2) != (A2), both \"uri with (A2)\" and \"uri with (B2)\" are kept in virtualFolders.dat, and both search folder of (A1) and (B1) are shown at folder pane forever, and same (B1).msf file is shared by search folder of (A1) and (B1).\n\n(i) Ordinal ascii folder\n    (A1)=foo  ==  (A2)=foo == (B1)=foo ==  (B2)=foo \n    (B1) == (A2) : This bug doesn't occur\n    (B2) == (A2) : Irrelevant   \n(ii) escaped string != unecaped string(e.g. space. case of bug 707730)\n    (A1)=x y != (A2)=x%20y, (B1)=x y != (B2)=x%20y\n    (B1) != (A2) : This bug can occur\n    (B2) == (A2) : Duplicated search folder disappears after restart\n(iii) hashed file name is used for msf file due to special chars\n    without char needs to escape\n      (A1)=x+special == (A2)=x+special, (B1)=x+hash == (B2)=x+hash\n    with chars need to escape\n      (A1)=x+special != (A2)=esc(x+special), (B1)=x+hash != (B2)=esc(x+hash)\n    (B1) != (A2) : This bug can occur\n    (B2) != (A2) : Multiple search folders remain, with sharing same (B1).msf.\n\nThis bug's phenomenon can be produced by;\n(a) Use of copied profile.\n    Absolute path of .msf for folder in panaca.dat is wrong in copied profile.\n(b) Delete of panacea.dat.\n    Pointer to .msf file for search folder doesn't exist in panacea.dat.", "attachment_id": null, "id": 5907721, "count": 0, "is_private": false, "creator": "m-wada@usa.com", "text": "When Tb's profile is copied and used, two identical search folders(search folder name, msf filename) are shown always, if search folder name contains special character and msf file name for it is hashed. \n\nThis is spin-off of bug 707730 comment #20.\n\n[Steps to reproduce]\n(1) Create search folder with special character in search folder name.\n    .msf file for search folder\n      \"X Y<Z> under \"A B\" : \"A B.sbd\\X Y0b864a7a.msf\"\n    virtualFolders.dat content\n      uri=imap://uid@imap.server.name/A B/X%20Y%3CZ%3E\n      (note: space in parent folder name is not escaped since initial)\n(2) Terminate Tb\n(3) Copy Tb's profile directory Prof1 to Prof2.\n(4) Add the copied Prof2 directory as new profile p2.\n    Start profile manager, Create Profile, Choose Folder,\n      choose copied Prof2 directory\n(5) Start Tb with new profile uses copied profile\n    => Two search folders which uses same \"A B.sbd\\X Y0b864a7a.msf\" appears.\n       \"X Y<Z>\" (search folder name) and \"X Y0b864a7a\" (msf file name)\n(6) Terminate Tb\n    virtualFolders.dat content\n      uri=imap://uid@imap.server.name/A B/X%20Y%3CZ%3E\n      uri=imap://uid@imap.server.name/A B/X Y0b864a7a\n      (note: space between X and Y is not escaped)\n(7) Restart Tb\n(8) Without open of search folder, update property of search folder\n    (no left click of folder, right click, context menu, properties)\n    Update property of \"X Y<Z>\"\n      rule for uri=imap:// ... /A B/X%20Y%3CZ%3E is updated\n    Update property of\"X Y0b864a7a\"\n      rule for uri=imap:// ... /A B/\"X%20Y0b864a7a\" is updated\n      (note: space between X and Y is changed to %20 sooner or later)\n(9) Repeat (8).\n    Each setting change is saved in virtualFolders.dat,\n    and kept in properties of each search folder.\n(10) Open of search folder, and change Property of search folder\n    Left click(open) \"X Y<Z>\", Left click \"X Y0b864a7a\".\n    Open \"X Y<Z>\", uadate property of \"X Y<Z>\",\n      view property of \"X Y0b864a7a\" => update on \"X Y<Z>\" is reflected\n    Open \"X Y0b864a7a\", uadate property of \"X Y0b864a7a\",\n      view property of\"X Y<Z>\" =>  update on \"X Y0b864a7a\" is reflected\n    File of \"A B.sbd\\X Y0b864a7a.msf\" is shared.\n(11)Terminate Tb.\n    Rule for next two search folder in virtualFolders.dat is identical.\n      uri=imap://uid@imap.server.name/A B/X%20Y%3CZ%3E\n      uri=imap://uid@imap.server.name/A B/X&20Y0b864a7a\n\nQuick summary of this bug's phenomenon.\n\n.msf file for search folder\n  \"X Y<Z>\"            : \"X Y0b864a7a.msf\"\n  \"X Y<Z> under \"A B\" : \"A B.sbd\\X Y0b864a7a.msf\"\nvirtualFolders.dat content\n  uri=imap://uid@imap.server.name/X%20Y%3CZ%3E\n  uri=imap://uid@imap.server.name/A B/X%20Y%3CZ%3E\nstring relevant to search folder\n  (A1) Unescaped Search folder name  : X Y<Z>\n  (A2) Escaped Search folder name    : X%20Y%3CZ%3E\n  (B1) Unescaped msf file name       : X Y0b864a7a\n  (B2) Escaped msf file name         : X%20Y0b864a7a\n\n(1) If (B1) != (A2), search folder named (A1) and (B1) is shown at folder pane upon restart, and \"uri with enescaped (B1)\" is written to virtualFolders.dat in addition to proper/escaped \"uri with (A2)\".\nIf \"bla bla\", (A1)==(B1), so duplicated search folder is shown at folder pane.\n(2) \"uri with enescaped (B1)\" is replaced by correct \"uri with escaped (B2)\" sooner or later.\n(3-1) If (B2) == (A2), only single \"uri with (A2)==(B2)\" is kept in virtualFolders.dat, and only single search folder of (A1)==(B1) is shown at folder pane after restart.\n(3-2) If (B2) != (A2), both \"uri with (A2)\" and \"uri with (B2)\" are kept in virtualFolders.dat, and both search folder of (A1) and (B1) are shown at folder pane forever, and same (B1).msf file is shared by search folder of (A1) and (B1).\n\n(i) Ordinal ascii folder\n    (A1)=foo  ==  (A2)=foo == (B1)=foo ==  (B2)=foo \n    (B1) == (A2) : This bug doesn't occur\n    (B2) == (A2) : Irrelevant   \n(ii) escaped string != unecaped string(e.g. space. case of bug 707730)\n    (A1)=x y != (A2)=x%20y, (B1)=x y != (B2)=x%20y\n    (B1) != (A2) : This bug can occur\n    (B2) == (A2) : Duplicated search folder disappears after restart\n(iii) hashed file name is used for msf file due to special chars\n    without char needs to escape\n      (A1)=x+special == (A2)=x+special, (B1)=x+hash == (B2)=x+hash\n    with chars need to escape\n      (A1)=x+special != (A2)=esc(x+special), (B1)=x+hash != (B2)=esc(x+hash)\n    (B1) != (A2) : This bug can occur\n    (B2) != (A2) : Multiple search folders remain, with sharing same (B1).msf.\n\nThis bug's phenomenon can be produced by;\n(a) Use of copied profile.\n    Absolute path of .msf for folder in panaca.dat is wrong in copied profile.\n(b) Delete of panacea.dat.\n    Pointer to .msf file for search folder doesn't exist in panacea.dat.", "time": "2011-12-12T01:57:37Z", "tags": [], "bug_id": 709637, "creation_time": "2011-12-12T01:57:37Z", "author": "m-wada@usa.com"}, {"count": 1, "bug_id": 709637, "is_private": false, "creator": "m-wada@usa.com", "text": "Simple test procedure to see this bug's phenomenon.\n(0) Create test IMAP folder(call F).\n    Create search folder named VF1 (VF1.msf is used) under IMAP folder F,\n    and update properties of VF1.\n(1) Terminate Tb.\n(2) At F.sbd directory,\n    copy VF1.msf to \"bla bla.msf\"\n    copy VF1.msf to \"A B357de86d.msf\"\n(3) Add entry for \"bla bla\" and \"A B<C>\" to virtualFolders.dat.\n    uri=imap:// ... /F/bla%20bla\n    scope=imap:// ... /INBOX\n    terms=AND (subject,contains,F/bla bla)\n    searchOnline=false\n    uri=imap:// ... /F/A%20B%3CC%3E\n    scope=imap:// ... /INBOX\n    terms=AND (subject,contains,F/A%20B%3CC%3E)\n    searchOnline=false\n(4) Restart Tb in offline mode to inhibit automatic server connection.\n    thunderbird.exe -offline -p \"prof-name\"\n    Two \"bla bla\" at folder pane. Both uses same \"bla bla.msf\". \n    \"A B<C>\" and \"A B357de86d\" at folder pane. Both uses same \"A B357de86d.msf\". \n(5) Terminate Tb.\n    Following entries are added to virtualFolders.dat.\n      uri=imap:// ... /F/bla bla\n      uri=imap:// ... /F/A B357de86d\n    folder name part is file name of .msf file.\n    folder name part is not escaped.\n(6) Restart Tb\n    Single \"bla bla\". Changed to \"uri=imap:// ... /F/bla%20bla\" sooner or later.\n    Stil \"A B<C>\" and \"A B357de86d\" at folder pane.\n    \"A B357de86d\" is changed to \"uri= ... /F/A%20B357de86d\" sooner or later.\n    Following remains, unless manually delete search folder or remove entry.\n      uri=imap:// ... /F/A%20B%3CC%3E\n      uri=imap:// ... /F/A%20B357de86d\"\n\nDuring repeated testing, following were observed.\n(1) \"bla bla\"\n(1-1) duplicated search folder named \"bla bla\". both uses same \"bla bla.msf\"\n    => sooner or later, changd to single \"bla bla\"\n(1-2) single search folder named \"bla%20bla\"\n    => sooner or later, changd to expected \"bla bla\"\n(1-3) single IMAP folder(non-existent) named \"bla%20bla\"\n    => disappers after server access, because non-existent folder\n(2) \"A B<C>\"\n(2-1) two search folder \"A B<C>\" and \"A B357de86d\"\n(2-2) single search folder named \"A%20B%3CC%3E\"\n    => sooner or later, changd to expected \"A B<C>\"\n(2-3) single IMAP folder(non-existent) named \"A%20B%3CC%3E\"\n    => disappers after server access, because non-existent folder\nPhenomenon looks to depend on copied .msf file content and remained garbage data in panacea.dat file which is relevant to .msf file name, search folder name, and escaped search folder name.\n\nIn above test case, both of next happens at same time.\n(A) Recovery of unknown search folder from existent/valid .msf file for sarch folder. Search folder name is .msf file name, and search rule is obtained from .msf file content. In this process, it looks that escaping of folder name is not done when entry is added to virtualFolders.dat.\n(B) Re-creation of .msf file for search folder defined in virtualFolders.dat when .msf file for the search folder is unknown or not found.\nI think it's same in \"copied profile use\" case and \"panacea.dat delete\" case.", "tags": [], "time": "2011-12-13T02:46:59Z", "creation_time": "2011-12-13T02:46:59Z", "author": "m-wada@usa.com", "raw_text": "Simple test procedure to see this bug's phenomenon.\n(0) Create test IMAP folder(call F).\n    Create search folder named VF1 (VF1.msf is used) under IMAP folder F,\n    and update properties of VF1.\n(1) Terminate Tb.\n(2) At F.sbd directory,\n    copy VF1.msf to \"bla bla.msf\"\n    copy VF1.msf to \"A B357de86d.msf\"\n(3) Add entry for \"bla bla\" and \"A B<C>\" to virtualFolders.dat.\n    uri=imap:// ... /F/bla%20bla\n    scope=imap:// ... /INBOX\n    terms=AND (subject,contains,F/bla bla)\n    searchOnline=false\n    uri=imap:// ... /F/A%20B%3CC%3E\n    scope=imap:// ... /INBOX\n    terms=AND (subject,contains,F/A%20B%3CC%3E)\n    searchOnline=false\n(4) Restart Tb in offline mode to inhibit automatic server connection.\n    thunderbird.exe -offline -p \"prof-name\"\n    Two \"bla bla\" at folder pane. Both uses same \"bla bla.msf\". \n    \"A B<C>\" and \"A B357de86d\" at folder pane. Both uses same \"A B357de86d.msf\". \n(5) Terminate Tb.\n    Following entries are added to virtualFolders.dat.\n      uri=imap:// ... /F/bla bla\n      uri=imap:// ... /F/A B357de86d\n    folder name part is file name of .msf file.\n    folder name part is not escaped.\n(6) Restart Tb\n    Single \"bla bla\". Changed to \"uri=imap:// ... /F/bla%20bla\" sooner or later.\n    Stil \"A B<C>\" and \"A B357de86d\" at folder pane.\n    \"A B357de86d\" is changed to \"uri= ... /F/A%20B357de86d\" sooner or later.\n    Following remains, unless manually delete search folder or remove entry.\n      uri=imap:// ... /F/A%20B%3CC%3E\n      uri=imap:// ... /F/A%20B357de86d\"\n\nDuring repeated testing, following were observed.\n(1) \"bla bla\"\n(1-1) duplicated search folder named \"bla bla\". both uses same \"bla bla.msf\"\n    => sooner or later, changd to single \"bla bla\"\n(1-2) single search folder named \"bla%20bla\"\n    => sooner or later, changd to expected \"bla bla\"\n(1-3) single IMAP folder(non-existent) named \"bla%20bla\"\n    => disappers after server access, because non-existent folder\n(2) \"A B<C>\"\n(2-1) two search folder \"A B<C>\" and \"A B357de86d\"\n(2-2) single search folder named \"A%20B%3CC%3E\"\n    => sooner or later, changd to expected \"A B<C>\"\n(2-3) single IMAP folder(non-existent) named \"A%20B%3CC%3E\"\n    => disappers after server access, because non-existent folder\nPhenomenon looks to depend on copied .msf file content and remained garbage data in panacea.dat file which is relevant to .msf file name, search folder name, and escaped search folder name.\n\nIn above test case, both of next happens at same time.\n(A) Recovery of unknown search folder from existent/valid .msf file for sarch folder. Search folder name is .msf file name, and search rule is obtained from .msf file content. In this process, it looks that escaping of folder name is not done when entry is added to virtualFolders.dat.\n(B) Re-creation of .msf file for search folder defined in virtualFolders.dat when .msf file for the search folder is unknown or not found.\nI think it's same in \"copied profile use\" case and \"panacea.dat delete\" case.", "attachment_id": null, "id": 5911156}]}}}