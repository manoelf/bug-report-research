{"comments": {}, "bugs": {"634074": {"comments": [{"time": "2011-02-14T22:00:15Z", "id": 5278108, "is_private": false, "raw_text": "I can use https://secure.eff.org without errors or warnings in other browsers (IE9, Opera). On one system, Minefield and Firefox can navigate the site without errors or warnings. On another one, Firefox will show the page at https://secure.eff.org and then pop up a modal dialog (multiple times) saying that the certificate is not trusted, ever time the site is accessed. Clicking on links will take us to the untrusted certificate error page.\n\nInspecting the certificate in Firefox's certificate viewer on the bad system shows a very strange and long certificate chain that is much different than what is shown in other browsers and/or the good system, and different from what the server actually sent (as seen in Wireshark). Screenshot attached.", "creation_time": "2011-02-14T22:00:15Z", "bug_id": 634074, "tags": [], "author": "brian@briansmith.org", "text": "Created attachment 512271\nScreen shot of bad certificate chain\n\nI can use https://secure.eff.org without errors or warnings in other browsers (IE9, Opera). On one system, Minefield and Firefox can navigate the site without errors or warnings. On another one, Firefox will show the page at https://secure.eff.org and then pop up a modal dialog (multiple times) saying that the certificate is not trusted, ever time the site is accessed. Clicking on links will take us to the untrusted certificate error page.\n\nInspecting the certificate in Firefox's certificate viewer on the bad system shows a very strange and long certificate chain that is much different than what is shown in other browsers and/or the good system, and different from what the server actually sent (as seen in Wireshark). Screenshot attached.", "count": 0, "attachment_id": 512271, "creator": "brian@briansmith.org"}, {"count": 1, "text": "This seems to be due to some kind of profile corruption. I will investigate the cause of the corruption and why the corruption isn't detected by the cert chain validation code.", "author": "brian@briansmith.org", "time": "2011-02-14T22:05:39Z", "id": 5278127, "raw_text": "This seems to be due to some kind of profile corruption. I will investigate the cause of the corruption and why the corruption isn't detected by the cert chain validation code.", "bug_id": 634074, "creation_time": "2011-02-14T22:05:39Z", "creator": "brian@briansmith.org", "tags": [], "attachment_id": null, "is_private": false}, {"bug_id": 634074, "creation_time": "2011-02-17T17:59:37Z", "raw_text": "I have run into this same problem now on Amazon.com, with similar symptoms to bug 613977.", "tags": [], "is_private": false, "time": "2011-02-17T17:59:37Z", "id": 5286761, "creator": "brian@briansmith.org", "attachment_id": null, "text": "I have run into this same problem now on Amazon.com, with similar symptoms to bug 613977.", "count": 2, "author": "brian@briansmith.org"}, {"text": "Sorry, the bug I mentioned in Comment 2 is actually bug 619563.", "count": 3, "author": "brian@briansmith.org", "creator": "brian@briansmith.org", "attachment_id": null, "time": "2011-02-17T18:03:49Z", "id": 5286776, "raw_text": "Sorry, the bug I mentioned in Comment 2 is actually bug 619563.", "creation_time": "2011-02-17T18:03:49Z", "bug_id": 634074, "tags": [], "is_private": false}, {"text": "Brian, what do you think the security rating should be for this bug?", "count": 4, "id": 5287535, "author": "jstenback+bmo@gmail.com", "time": "2011-02-17T21:16:13Z", "creator": "jstenback+bmo@gmail.com", "tags": [], "raw_text": "Brian, what do you think the security rating should be for this bug?", "bug_id": 634074, "creation_time": "2011-02-17T21:16:13Z", "is_private": false, "attachment_id": null}, {"time": "2011-02-17T23:13:39Z", "id": 5287971, "bug_id": 634074, "creation_time": "2011-02-17T23:13:39Z", "raw_text": "This seems less likely to be an exploitable security vulnerability than I suspected, but I am still investigating.\n\nI suspect there is something wrong with the cert database entries for \"AddTrust External CA Root\" and/or \"UTN - DataCorp SGC\".\n\nThe EFF has a certificate for secure.eff.org and another wildcard certificate for *.eff.org. The favicon for https://secure.eff.org is https://robin.eff.org/favicon.ico and the trouble seems to occur there. robin.eff.org sends four certs in its cert chain as shown at the bottom of the attached image.\n\nThe cert chain building code in NSS does not stop building the cert chain after adding AddTrust External CA Root. Instead, it keeps building a cert chain alternating between the last cert provided (UTN - DataCorp SGC) and the root CA (AddTrust External CA Root) until it hits its maximum of 20 certs in a chain. I am investigating why this happens.\n\nI have observed exactly the same behavior with the same certs (AddTrust External CA and UTN - DataCorp SGC) on amazon.com, but only on one occasion.", "tags": [], "is_private": false, "count": 5, "text": "This seems less likely to be an exploitable security vulnerability than I suspected, but I am still investigating.\n\nI suspect there is something wrong with the cert database entries for \"AddTrust External CA Root\" and/or \"UTN - DataCorp SGC\".\n\nThe EFF has a certificate for secure.eff.org and another wildcard certificate for *.eff.org. The favicon for https://secure.eff.org is https://robin.eff.org/favicon.ico and the trouble seems to occur there. robin.eff.org sends four certs in its cert chain as shown at the bottom of the attached image.\n\nThe cert chain building code in NSS does not stop building the cert chain after adding AddTrust External CA Root. Instead, it keeps building a cert chain alternating between the last cert provided (UTN - DataCorp SGC) and the root CA (AddTrust External CA Root) until it hits its maximum of 20 certs in a chain. I am investigating why this happens.\n\nI have observed exactly the same behavior with the same certs (AddTrust External CA and UTN - DataCorp SGC) on amazon.com, but only on one occasion.", "author": "brian@briansmith.org", "creator": "brian@briansmith.org", "attachment_id": null}, {"id": 5288543, "time": "2011-02-18T02:51:23Z", "tags": [], "raw_text": "It seems like in a previous release the Addtrust cert was subordinate to the UTI - DataCorp SGC cert, and in current releases the UTI - DataCorp SGC cert is subordinate to the Addtrust cert. It also seems like it is possible for the user to get his profile into a state where the self-issued Addtrust cert and the UTI-DataCorp-issued Addtrust cert are both available. This state confuses NSS. \n\nIn my profile, I have these CA certs, where \"SKI\" is \"Subject Key Identifier\" and \"AKI\" is \"Certificate Authority Key Identifier\":\n\nAddTrust External CA Root\nin Built-in Token Object\nIssued by: AddTrust External CA Root\nSKI: adbd987a34b426f7fac42654ef03bde024cb541a\nAKI: adbd987a34b426f7fac42654ef03bde024cb541a\n\nAddTrust External CA Root\nin Software Security Device\nIssued by: UTN - DataCorp SGC\nSKI: adbd987a34b426f7fac42654ef03bde024cb541a\nAKI: 5332d1b3cf7ffae0f1a05d854e92d29e451db44f \n\nUTN - DataCorp SGC\nIssued by: UTN - DataCorp SGC\nSKI: 5332d1b3cf7ffae0f1a05d854e92d29e451db44f\nAKI: not provided\n\nThe website provides a different \"UTN - DataCorp SGC\" certificate in its cert chain:\n\nUTN - DataCorp SGC\nIssued by: AddTrust External CA Root\nSKI: 5332d1b3cf7ffae0f1a05d854e92d29e451db44f\nAKI: adbd987a34b426f7fac42654ef03bde024cb541a\n\nThis fourth server-provided certificate is expecting to get chained to the first AddTrust cert, but instead we chain it to the second cert. The second cert isn't a root and the it is expecting to get chained to the third certificate, but instead we are chaining it to the fourth certificate. The fourth certificate isn't a root so we chain it back to the second certificate. This creates an infinite loop. NSS breaks the loop after 20 certs have been added to the chain and returns an error message since it never reached the end of the chain.\n\nI can observe the same trucated infinite cert chain by going to Tools -> Options -> Advanced -> View Certificates, under \"The USERTRUST Network\" and look at the chain in the Details tab.", "bug_id": 634074, "creation_time": "2011-02-18T02:51:23Z", "is_private": false, "text": "It seems like in a previous release the Addtrust cert was subordinate to the UTI - DataCorp SGC cert, and in current releases the UTI - DataCorp SGC cert is subordinate to the Addtrust cert. It also seems like it is possible for the user to get his profile into a state where the self-issued Addtrust cert and the UTI-DataCorp-issued Addtrust cert are both available. This state confuses NSS. \n\nIn my profile, I have these CA certs, where \"SKI\" is \"Subject Key Identifier\" and \"AKI\" is \"Certificate Authority Key Identifier\":\n\nAddTrust External CA Root\nin Built-in Token Object\nIssued by: AddTrust External CA Root\nSKI: adbd987a34b426f7fac42654ef03bde024cb541a\nAKI: adbd987a34b426f7fac42654ef03bde024cb541a\n\nAddTrust External CA Root\nin Software Security Device\nIssued by: UTN - DataCorp SGC\nSKI: adbd987a34b426f7fac42654ef03bde024cb541a\nAKI: 5332d1b3cf7ffae0f1a05d854e92d29e451db44f \n\nUTN - DataCorp SGC\nIssued by: UTN - DataCorp SGC\nSKI: 5332d1b3cf7ffae0f1a05d854e92d29e451db44f\nAKI: not provided\n\nThe website provides a different \"UTN - DataCorp SGC\" certificate in its cert chain:\n\nUTN - DataCorp SGC\nIssued by: AddTrust External CA Root\nSKI: 5332d1b3cf7ffae0f1a05d854e92d29e451db44f\nAKI: adbd987a34b426f7fac42654ef03bde024cb541a\n\nThis fourth server-provided certificate is expecting to get chained to the first AddTrust cert, but instead we chain it to the second cert. The second cert isn't a root and the it is expecting to get chained to the third certificate, but instead we are chaining it to the fourth certificate. The fourth certificate isn't a root so we chain it back to the second certificate. This creates an infinite loop. NSS breaks the loop after 20 certs have been added to the chain and returns an error message since it never reached the end of the chain.\n\nI can observe the same trucated infinite cert chain by going to Tools -> Options -> Advanced -> View Certificates, under \"The USERTRUST Network\" and look at the chain in the Details tab.", "count": 6, "author": "brian@briansmith.org", "creator": "brian@briansmith.org", "attachment_id": null}, {"creator": "brian@briansmith.org", "attachment_id": 513352, "text": "Created attachment 513352\nThe cert8.db file from the affected profile\n\nThis should block because it at least affects two very high profile sites: amazon.com and eff.org. On amazon.com, it basically prevents stylesheets and/or images from loading on Amazon's HTTPS site. When the problem occurs, it makes both sites virtually unusable. It may also drive users to the \"Add Exception\" UI for amazon.com (via the modal dialog) which is bad.\n\nCreate a new profile and then replace its cert8.db file with the one I am attaching to reproduce the problem. Then navigate to https://robin.eff.org. To reproduce on amazon.com, try signing out and then signing in and do a hard refresh; the styling of the page will be completely jacked.", "count": 7, "author": "brian@briansmith.org", "tags": [], "raw_text": "This should block because it at least affects two very high profile sites: amazon.com and eff.org. On amazon.com, it basically prevents stylesheets and/or images from loading on Amazon's HTTPS site. When the problem occurs, it makes both sites virtually unusable. It may also drive users to the \"Add Exception\" UI for amazon.com (via the modal dialog) which is bad.\n\nCreate a new profile and then replace its cert8.db file with the one I am attaching to reproduce the problem. Then navigate to https://robin.eff.org. To reproduce on amazon.com, try signing out and then signing in and do a hard refresh; the styling of the page will be completely jacked.", "bug_id": 634074, "creation_time": "2011-02-18T03:03:42Z", "is_private": false, "id": 5288567, "time": "2011-02-18T03:03:42Z"}, {"count": 8, "text": "Because of the way certs are put in a shared (cross-site) cache in NSS, even if the user doesn't have two different AddTrust certs stored on his computer, an website may still be able to (accidentally or maliciously) DoS websites that use these certs: User navigates to a website that supplies a complete cert chain including one pair of certs in the SSL handshake and in another window/tab navigates to another website that supplies the other two certs in the SSL handshake. For example, this could be used as a denial of service attack on Firefox users, preventing them from logging in or ordering from Amazon.com.", "author": "brian@briansmith.org", "creator": "brian@briansmith.org", "attachment_id": null, "id": 5288584, "time": "2011-02-18T03:18:12Z", "tags": [], "raw_text": "Because of the way certs are put in a shared (cross-site) cache in NSS, even if the user doesn't have two different AddTrust certs stored on his computer, an website may still be able to (accidentally or maliciously) DoS websites that use these certs: User navigates to a website that supplies a complete cert chain including one pair of certs in the SSL handshake and in another window/tab navigates to another website that supplies the other two certs in the SSL handshake. For example, this could be used as a denial of service attack on Firefox users, preventing them from logging in or ordering from Amazon.com.", "bug_id": 634074, "creation_time": "2011-02-18T03:18:12Z", "is_private": false}, {"count": 9, "text": "Brian, I suspect that this is a duplicate of bug 479508, for which Nelson wrote an (incomplete) patch nearly 2 years ago.  It would be great to see that bug fixed!", "author": "rob@sectigo.com", "creator": "rob@sectigo.com", "attachment_id": null, "time": "2011-02-18T10:23:37Z", "id": 5289073, "bug_id": 634074, "creation_time": "2011-02-18T10:23:37Z", "raw_text": "Brian, I suspect that this is a duplicate of bug 479508, for which Nelson wrote an (incomplete) patch nearly 2 years ago.  It would be great to see that bug fixed!", "tags": [], "is_private": false}, {"author": "wtc@google.com", "count": 10, "text": "Rob: you are right one.  My code inspection last night\nalso ended up in nssCertificateArray_FindBestCertificate.\nYou can duplicate my code inspection by following the\nNSSCertificate_BuildChain call with the CERT_MAX_CERT_CHAIN\nargument:\nhttp://mxr.mozilla.org/security/ident?i=NSSCertificate_BuildChain\n\nTo a human being, it's clear that when multiple issuer\ncerts are available, a root cert, or more generally a\ntrust anchor, should be favored.  So Nelson's patch in\nbug 479508 is the right approach.\n\nA risk of that approach is that nssCertificateArray_FindBestCertificate\nis used by not only find_cert_issuer.  Some other callers\nof nssCertificateArray_FindBestCertificate may not favor\na trust anchor.\n\nShall we continue the technical discussion in bug 479508,\nif we can't simply mark this bug as a duplicate?", "attachment_id": null, "creator": "wtc@google.com", "id": 5289492, "time": "2011-02-18T15:21:24Z", "is_private": false, "tags": [], "raw_text": "Rob: you are right one.  My code inspection last night\nalso ended up in nssCertificateArray_FindBestCertificate.\nYou can duplicate my code inspection by following the\nNSSCertificate_BuildChain call with the CERT_MAX_CERT_CHAIN\nargument:\nhttp://mxr.mozilla.org/security/ident?i=NSSCertificate_BuildChain\n\nTo a human being, it's clear that when multiple issuer\ncerts are available, a root cert, or more generally a\ntrust anchor, should be favored.  So Nelson's patch in\nbug 479508 is the right approach.\n\nA risk of that approach is that nssCertificateArray_FindBestCertificate\nis used by not only find_cert_issuer.  Some other callers\nof nssCertificateArray_FindBestCertificate may not favor\na trust anchor.\n\nShall we continue the technical discussion in bug 479508,\nif we can't simply mark this bug as a duplicate?", "bug_id": 634074, "creation_time": "2011-02-18T15:21:24Z"}, {"attachment_id": null, "creator": "rob@sectigo.com", "author": "rob@sectigo.com", "text": "(In reply to comment #10)\n> Shall we continue the technical discussion in bug 479508,\n\nWan-Teh: IIUC, Nelson also mentioned another approach to fix/workaround this buggy behaviour:\n\"I suspect the only real solution to this is for PSM to switch to always \nuse libPKIX.  Bug 479393 requests just that.\"\n\nI suggest that efforts should be concentrated on whichever of these 2 bugs is likely to be the simplest/quickest to resolve.\n\nBTW, does \"P1 blocker\" mean that Mozilla want this buggy behaviour fixed in time for FF4.0 ?", "count": 11, "is_private": false, "tags": [], "bug_id": 634074, "creation_time": "2011-02-18T15:48:44Z", "raw_text": "(In reply to comment #10)\n> Shall we continue the technical discussion in bug 479508,\n\nWan-Teh: IIUC, Nelson also mentioned another approach to fix/workaround this buggy behaviour:\n\"I suspect the only real solution to this is for PSM to switch to always \nuse libPKIX.  Bug 479393 requests just that.\"\n\nI suggest that efforts should be concentrated on whichever of these 2 bugs is likely to be the simplest/quickest to resolve.\n\nBTW, does \"P1 blocker\" mean that Mozilla want this buggy behaviour fixed in time for FF4.0 ?", "id": 5289563, "time": "2011-02-18T15:48:44Z"}, {"author": "wtc@google.com", "text": "Brian: please run a quick experiment to see if libpkix\ncan build this certificate chain successfully.  Please\nset the environment variable NSS_ENABLE_PKIX_VERIFY to 1,\nand then run Firefox.  Does that solve the problem?\n\nRob: in Bugzilla, the severity/importance level 'blocker'\ndoes not mean it will block a release.  The 'blocker'\nlevel is defined as:\n    blocker\tBlocks development and/or testing work\nhttps://bugzilla.mozilla.org/page.cgi?id=fields.html#importance\n\nI lowered the severity/importance level to 'major'.", "count": 12, "attachment_id": null, "creator": "wtc@google.com", "time": "2011-02-18T16:13:54Z", "id": 5289620, "is_private": false, "bug_id": 634074, "creation_time": "2011-02-18T16:13:54Z", "raw_text": "Brian: please run a quick experiment to see if libpkix\ncan build this certificate chain successfully.  Please\nset the environment variable NSS_ENABLE_PKIX_VERIFY to 1,\nand then run Firefox.  Does that solve the problem?\n\nRob: in Bugzilla, the severity/importance level 'blocker'\ndoes not mean it will block a release.  The 'blocker'\nlevel is defined as:\n    blocker\tBlocks development and/or testing work\nhttps://bugzilla.mozilla.org/page.cgi?id=fields.html#importance\n\nI lowered the severity/importance level to 'major'.", "tags": []}, {"is_private": false, "raw_text": "Based on the problem description, I don't think we'd hold release for this, but it is something we'd like to see fixed. Marking it .x, but if a safe, reviewed patch comes along in time, please nominate it for approval.", "creation_time": "2011-02-18T17:02:01Z", "bug_id": 634074, "tags": [], "time": "2011-02-18T17:02:01Z", "id": 5289779, "attachment_id": null, "creator": "bugzilla@johnath.com", "author": "bugzilla@johnath.com", "count": 13, "text": "Based on the problem description, I don't think we'd hold release for this, but it is something we'd like to see fixed. Marking it .x, but if a safe, reviewed patch comes along in time, please nominate it for approval."}, {"is_private": false, "attachment_id": null, "creator": "nelson@bolyard.me", "tags": [], "raw_text": "This is clearly (IMO) a dup of bug 479508, and (IMO) is not worthy of being \nsecurity sensitive, just as bug 479508 is not security sensitive.\n\nHas anyone here tried setting the environment variable NSS_ENABLE_PKIX_VERIFY \nto 1, to see what that does?", "creation_time": "2011-02-18T18:01:59Z", "bug_id": 634074, "id": 5289977, "author": "nelson@bolyard.me", "time": "2011-02-18T18:01:59Z", "count": 14, "text": "This is clearly (IMO) a dup of bug 479508, and (IMO) is not worthy of being \nsecurity sensitive, just as bug 479508 is not security sensitive.\n\nHas anyone here tried setting the environment variable NSS_ENABLE_PKIX_VERIFY \nto 1, to see what that does?"}, {"id": 5290145, "author": "rrelyea@redhat.com", "time": "2011-02-18T18:59:12Z", "text": "Inifinite loops are allowed under pkix. Because of our processing code, CA's have avoided them in the past.\n\nPKIX tries more than one path, looking for the patch that works properly, So I join wtc and Nelson in asking what happens if you set NSS_ENABLE_PKIX_VERIFY?\n\nIt may be time to think about shift PKIX to default in the next set of releases (probably not 4.0:).\n\nbob", "count": 15, "attachment_id": null, "is_private": false, "creator": "rrelyea@redhat.com", "tags": [], "raw_text": "Inifinite loops are allowed under pkix. Because of our processing code, CA's have avoided them in the past.\n\nPKIX tries more than one path, looking for the patch that works properly, So I join wtc and Nelson in asking what happens if you set NSS_ENABLE_PKIX_VERIFY?\n\nIt may be time to think about shift PKIX to default in the next set of releases (probably not 4.0:).\n\nbob", "bug_id": 634074, "creation_time": "2011-02-18T18:59:12Z"}, {"id": 5290511, "time": "2011-02-18T20:48:46Z", "is_private": false, "tags": [], "bug_id": 634074, "creation_time": "2011-02-18T20:48:46Z", "raw_text": "fennec can pick this up when the platform gets it.", "author": "doug.turner@gmail.com", "count": 16, "text": "fennec can pick this up when the platform gets it.", "attachment_id": null, "creator": "doug.turner@gmail.com"}, {"id": 5290806, "time": "2011-02-18T22:17:47Z", "is_private": false, "tags": [], "raw_text": "See bug 635384. With NSS_ENABLE_PKIX_VERIFY=1, the behavior is even worse because we execute an infinite loop in pkix_BuildForwardDepthFirstSearch when attempting to access https://robin.eff.org", "creation_time": "2011-02-18T22:17:47Z", "bug_id": 634074, "author": "brian@briansmith.org", "text": "See bug 635384. With NSS_ENABLE_PKIX_VERIFY=1, the behavior is even worse because we execute an infinite loop in pkix_BuildForwardDepthFirstSearch when attempting to access https://robin.eff.org", "count": 17, "attachment_id": null, "creator": "brian@briansmith.org"}, {"time": "2011-02-18T22:18:32Z", "id": 5290811, "is_private": false, "creation_time": "2011-02-18T22:18:32Z", "bug_id": 634074, "raw_text": "(In reply to comment #14)\n> This is clearly (IMO) a dup of bug 479508, and (IMO) is not worthy of being \n> security sensitive, just as bug 479508 is not security sensitive.\n\nI agree, but I cannot clear the sensitive flag. I filed it as sensitive because I initially suspected a different cause.", "tags": [], "author": "brian@briansmith.org", "text": "(In reply to comment #14)\n> This is clearly (IMO) a dup of bug 479508, and (IMO) is not worthy of being \n> security sensitive, just as bug 479508 is not security sensitive.\n\nI agree, but I cannot clear the sensitive flag. I filed it as sensitive because I initially suspected a different cause.", "count": 18, "attachment_id": null, "creator": "brian@briansmith.org"}, {"time": "2011-02-18T22:43:54Z", "id": 5290912, "is_private": false, "raw_text": "Opening bug up per previous comments.", "creation_time": "2011-02-18T22:43:54Z", "bug_id": 634074, "tags": [], "author": "jstenback+bmo@gmail.com", "text": "Opening bug up per previous comments.", "count": 19, "attachment_id": null, "creator": "jstenback+bmo@gmail.com"}, {"creator": "brian@briansmith.org", "attachment_id": null, "text": "This is not a regression from 3.6 as it happens in 3.6.12 too. If the cert is an EV cert then Firefox may crash with a stack overflow (not verified yet) because of bug 635384.", "count": 20, "author": "brian@briansmith.org", "tags": [], "raw_text": "This is not a regression from 3.6 as it happens in 3.6.12 too. If the cert is an EV cert then Firefox may crash with a stack overflow (not verified yet) because of bug 635384.", "creation_time": "2011-02-23T00:50:00Z", "bug_id": 634074, "is_private": false, "id": 5297490, "time": "2011-02-23T00:50:00Z"}, {"count": 21, "text": "From Bug 639315: \"check https://pki.treas.gov for some certificate bundles to import to see this issue.\"", "author": "brian@briansmith.org", "time": "2011-03-07T03:49:46Z", "id": 5326431, "raw_text": "From Bug 639315: \"check https://pki.treas.gov for some certificate bundles to import to see this issue.\"", "bug_id": 634074, "creation_time": "2011-03-07T03:49:46Z", "creator": "brian@briansmith.org", "tags": [], "attachment_id": null, "is_private": false}, {"raw_text": "", "bug_id": 634074, "creation_time": "2011-03-07T03:50:12Z", "tags": [], "is_private": false, "time": "2011-03-07T03:50:12Z", "id": 5326434, "creator": "brian@briansmith.org", "attachment_id": null, "count": 22, "text": "*** Bug 639315 has been marked as a duplicate of this bug. ***", "author": "brian@briansmith.org"}, {"id": 5330891, "time": "2011-03-08T19:08:10Z", "is_private": false, "tags": [], "bug_id": 634074, "creation_time": "2011-03-08T19:08:10Z", "raw_text": "I confirm that\n- NSS_ENABLE_PKIX_VERIFY=1 \n- attached cert8.db\n- visit https://robin.eff.org/\n\nresults in an endless loop.\n\nActually, not just a loop, but an endless recursion.\nI'll attach a stacktrace with 333 frames.", "author": "kaie@kuix.de", "count": 23, "text": "I confirm that\n- NSS_ENABLE_PKIX_VERIFY=1 \n- attached cert8.db\n- visit https://robin.eff.org/\n\nresults in an endless loop.\n\nActually, not just a loop, but an endless recursion.\nI'll attach a stacktrace with 333 frames.", "attachment_id": null, "creator": "kaie@kuix.de"}, {"tags": [], "creator": "kaie@kuix.de", "bug_id": 634074, "creation_time": "2011-03-08T19:08:51Z", "raw_text": "", "is_private": false, "attachment_id": 517812, "count": 24, "text": "Created attachment 517812\npkix recursion stack", "id": 5330894, "time": "2011-03-08T19:08:51Z", "author": "kaie@kuix.de"}, {"attachment_id": 517814, "creator": "kaie@kuix.de", "author": "kaie@kuix.de", "count": 25, "text": "Created attachment 517814\nzip archive, certs sent by server\n\nlet's make sure we are able to debug this problem, even if the config of server robin.eff.org changes.\n\nattaching a zip file that contains 5 certs sent by the server\n\ndumped with nss tool vfyserv\n\n\n        Subject: C=US/postalCode=94110, ST=California, L=San Francisco/street=454 Shotwell St, O=Electronic Frontier Foundation, OU=Comodo PremiumSSL Wildcard, CN=*.eff.org\n        Subject: C=GB, ST=Greater Manchester, L=Salford, O=COMODO CA Limited, CN=COMODO High Assurance Secure Server CA\n        Subject: C=GB, ST=Greater Manchester, L=Salford, O=COMODO CA Limited, CN=COMODO Certification Authority\n        Subject: C=US, ST=UT, L=Salt Lake City, O=The USERTRUST Network, OU=http://www.usertrust.com, CN=UTN - DATACorp SGC\n        Subject: C=SE, O=AddTrust AB, OU=AddTrust External TTP Network, CN=AddTrust External CA Root", "is_private": false, "tags": [], "bug_id": 634074, "creation_time": "2011-03-08T19:17:10Z", "raw_text": "let's make sure we are able to debug this problem, even if the config of server robin.eff.org changes.\n\nattaching a zip file that contains 5 certs sent by the server\n\ndumped with nss tool vfyserv\n\n\n        Subject: C=US/postalCode=94110, ST=California, L=San Francisco/street=454 Shotwell St, O=Electronic Frontier Foundation, OU=Comodo PremiumSSL Wildcard, CN=*.eff.org\n        Subject: C=GB, ST=Greater Manchester, L=Salford, O=COMODO CA Limited, CN=COMODO High Assurance Secure Server CA\n        Subject: C=GB, ST=Greater Manchester, L=Salford, O=COMODO CA Limited, CN=COMODO Certification Authority\n        Subject: C=US, ST=UT, L=Salt Lake City, O=The USERTRUST Network, OU=http://www.usertrust.com, CN=UTN - DATACorp SGC\n        Subject: C=SE, O=AddTrust AB, OU=AddTrust External TTP Network, CN=AddTrust External CA Root", "id": 5330929, "time": "2011-03-08T19:17:10Z"}, {"count": 26, "text": "*** Bug 664956 has been marked as a duplicate of this bug. ***", "author": "brian@briansmith.org", "time": "2012-05-13T19:50:16Z", "id": 6303833, "raw_text": "", "bug_id": 634074, "creation_time": "2012-05-13T19:50:16Z", "creator": "brian@briansmith.org", "tags": [], "attachment_id": null, "is_private": false}, {"is_private": false, "tags": [], "bug_id": 634074, "creation_time": "2012-07-30T23:34:07Z", "raw_text": "With the patch to NSS in bug 764393, this should be fixed without requiring the switch to libpkix. (We need to verify this.)\n\nWan-Teh pushed the beta of NSS with that fix to mozilla-inbound today.\n\nComodo has requested that we fix this bug in the mozilla-beta and mozilla-aurora channels and I agree that we should do so, as the fix is pretty simple and it fixes a serious problem.. But, I recommend that we wait at least a week to make sure Nightly does not experience any regressions.", "id": 6518724, "time": "2012-07-30T23:34:07Z", "attachment_id": null, "creator": "brian@briansmith.org", "author": "brian@briansmith.org", "count": 27, "text": "With the patch to NSS in bug 764393, this should be fixed without requiring the switch to libpkix. (We need to verify this.)\n\nWan-Teh pushed the beta of NSS with that fix to mozilla-inbound today.\n\nComodo has requested that we fix this bug in the mozilla-beta and mozilla-aurora channels and I agree that we should do so, as the fix is pretty simple and it fixes a serious problem.. But, I recommend that we wait at least a week to make sure Nightly does not experience any regressions."}, {"attachment_id": null, "creator": "kaie@kuix.de", "author": "kaie@kuix.de", "text": "Do you intend to use this bug for \"landing NSS 3.13.6 into mozilla-central and branches\"?\nIf yes, the subject should probably mention it for clarity.\nI understand you want to release NSS 3.13.6 next week.", "count": 28, "is_private": false, "creation_time": "2012-08-02T22:12:02Z", "bug_id": 634074, "raw_text": "Do you intend to use this bug for \"landing NSS 3.13.6 into mozilla-central and branches\"?\nIf yes, the subject should probably mention it for clarity.\nI understand you want to release NSS 3.13.6 next week.", "tags": [], "time": "2012-08-02T22:12:02Z", "id": 6528163}, {"attachment_id": null, "creator": "brian@briansmith.org", "author": "brian@briansmith.org", "text": "I filed a new bug for the landing of the NSS release because that's what we usually do, and because the NSS release makes several changes unrelated to this bug. That bug is bug 780009.", "count": 29, "is_private": false, "raw_text": "I filed a new bug for the landing of the NSS release because that's what we usually do, and because the NSS release makes several changes unrelated to this bug. That bug is bug 780009.", "bug_id": 634074, "creation_time": "2012-08-02T22:27:37Z", "tags": [], "time": "2012-08-02T22:27:37Z", "id": 6528211}, {"count": 30, "text": "So what still needs to be done here now that we've updated to NSS 3.13.6?", "author": "lukasblakk+bugs@gmail.com", "time": "2012-08-15T21:43:50Z", "id": 6558180, "raw_text": "So what still needs to be done here now that we've updated to NSS 3.13.6?", "creation_time": "2012-08-15T21:43:50Z", "bug_id": 634074, "creator": "lukasblakk+bugs@gmail.com", "tags": [], "attachment_id": null, "is_private": false}, {"creator": "brian@briansmith.org", "attachment_id": null, "text": "Rob/Robin, could you please verify that the latest build of Firefox 15 beta fixes the issue to your satisfaction? We will be shipping the final beta before Firefox 15 release soon.\n\nhttp://www.mozilla.org/en-US/firefox/all-beta.html\n\nThanks for your help!", "count": 31, "author": "brian@briansmith.org", "tags": [], "bug_id": 634074, "creation_time": "2012-08-21T22:08:07Z", "raw_text": "Rob/Robin, could you please verify that the latest build of Firefox 15 beta fixes the issue to your satisfaction? We will be shipping the final beta before Firefox 15 release soon.\n\nhttp://www.mozilla.org/en-US/firefox/all-beta.html\n\nThanks for your help!", "is_private": false, "id": 6572456, "time": "2012-08-21T22:08:07Z"}, {"creator": "rob@sectigo.com", "attachment_id": null, "text": "(In reply to Brian Smith (:bsmith) from comment #31)\n> Rob/Robin, could you please verify that the latest build of Firefox 15 beta\n> fixes the issue to your satisfaction?\n\nVerified on Linux and Windows 7.  Thanks!", "count": 32, "author": "rob@sectigo.com", "tags": [], "creation_time": "2012-08-22T08:11:06Z", "bug_id": 634074, "raw_text": "(In reply to Brian Smith (:bsmith) from comment #31)\n> Rob/Robin, could you please verify that the latest build of Firefox 15 beta\n> fixes the issue to your satisfaction?\n\nVerified on Linux and Windows 7.  Thanks!", "is_private": false, "id": 6573548, "time": "2012-08-22T08:11:06Z"}, {"count": 33, "text": "Thanks Rob, adjusting status flags accordingly.", "author": "lukasblakk+bugs@gmail.com", "creator": "lukasblakk+bugs@gmail.com", "attachment_id": null, "time": "2012-08-22T16:01:47Z", "id": 6574426, "bug_id": 634074, "creation_time": "2012-08-22T16:01:47Z", "raw_text": "Thanks Rob, adjusting status flags accordingly.", "tags": [], "is_private": false}, {"time": "2012-09-11T21:34:10Z", "author": "kwilson@mozilla.com", "id": 6626849, "text": "Is this bug considered to be completely fixed? \nIf yes, can we close this bug?", "count": 34, "attachment_id": null, "is_private": false, "bug_id": 634074, "creation_time": "2012-09-11T21:34:10Z", "raw_text": "Is this bug considered to be completely fixed? \nIf yes, can we close this bug?", "tags": [], "creator": "kwilson@mozilla.com"}, {"creator": "kaie@kuix.de", "attachment_id": null, "count": 35, "text": "(In reply to Kathleen Wilson from comment #34)\n> Is this bug considered to be completely fixed? \n\nIt depends on how you interpret this bug.\n\nIf the bug is meant to fix the special category of loops where a cross signed root is involved, then this bug is believed to be fixed.\n\nOn the other hand, if this bug rather means \"fix all possible loops\", then no, the bug isn't fixed. Bob said, a \"cross cert to cross cert loop will require full pkix\".", "author": "kaie@kuix.de", "bug_id": 634074, "creation_time": "2012-10-06T01:51:10Z", "raw_text": "(In reply to Kathleen Wilson from comment #34)\n> Is this bug considered to be completely fixed? \n\nIt depends on how you interpret this bug.\n\nIf the bug is meant to fix the special category of loops where a cross signed root is involved, then this bug is believed to be fixed.\n\nOn the other hand, if this bug rather means \"fix all possible loops\", then no, the bug isn't fixed. Bob said, a \"cross cert to cross cert loop will require full pkix\".", "tags": [], "is_private": false, "time": "2012-10-06T01:51:10Z", "id": 6703551}, {"is_private": false, "tags": [], "raw_text": "Still not working for us with Firefox 18...", "creation_time": "2013-01-17T16:43:29Z", "bug_id": 634074, "id": 7012466, "time": "2013-01-17T16:43:29Z", "attachment_id": null, "creator": "jtaglia@captchme.com", "author": "jtaglia@captchme.com", "text": "Still not working for us with Firefox 18...", "count": 36}, {"is_private": false, "bug_id": 634074, "creation_time": "2014-06-18T23:54:20Z", "raw_text": "This is fixed in Firefox 31 in general by the switch to mozilla::pkix (bug 915930). For some cases, it was fixed in NSS by a patch that Wan-Teh wrote long ago.\n\nThe only remaining work is to write an automated test that proves that we can handle this case.", "tags": [], "time": "2014-06-18T23:54:20Z", "id": 8949482, "attachment_id": null, "creator": "brian@briansmith.org", "author": "brian@briansmith.org", "count": 37, "text": "This is fixed in Firefox 31 in general by the switch to mozilla::pkix (bug 915930). For some cases, it was fixed in NSS by a patch that Wan-Teh wrote long ago.\n\nThe only remaining work is to write an automated test that proves that we can handle this case."}, {"is_private": false, "tags": [], "bug_id": 634074, "creation_time": "2015-06-18T15:49:54Z", "raw_text": "I noticed this very problem (with a loop in CrossCerts from UTN-DATACorpSGC and AddTrustExternalCARoot) today in the CertifcatePatrol plugin (2.0.14.1-signed) in Firefox 38.0.1.\n\nThe looping Cert chain was reported/visualized for the _old_ Certificate in the CertificatePatrol plugin for the site adblockplus.org (for a server certificate that was valid from 09-Apr-2014 to 10-Apr-2015).  The current/new server certificate does not have this problem.\n\nIs this a problem in the CertificatePatrol plugin, or is the problem not really fixed in the underlying Firefox code?", "id": 10405128, "time": "2015-06-18T15:49:54Z", "attachment_id": null, "creator": "Martin.Rex@sap.com", "author": "Martin.Rex@sap.com", "text": "I noticed this very problem (with a loop in CrossCerts from UTN-DATACorpSGC and AddTrustExternalCARoot) today in the CertifcatePatrol plugin (2.0.14.1-signed) in Firefox 38.0.1.\n\nThe looping Cert chain was reported/visualized for the _old_ Certificate in the CertificatePatrol plugin for the site adblockplus.org (for a server certificate that was valid from 09-Apr-2014 to 10-Apr-2015).  The current/new server certificate does not have this problem.\n\nIs this a problem in the CertificatePatrol plugin, or is the problem not really fixed in the underlying Firefox code?", "count": 38}, {"author": "dkeeler@mozilla.com", "count": 39, "text": "It could be that the certificate viewer is doing the wrong thing (I suspect GetChain). Would you please file a new bug with the relevant certificates attached? Thanks.", "attachment_id": null, "creator": "dkeeler@mozilla.com", "time": "2015-06-18T16:10:59Z", "id": 10405226, "is_private": false, "raw_text": "It could be that the certificate viewer is doing the wrong thing (I suspect GetChain). Would you please file a new bug with the relevant certificates attached? Thanks.", "creation_time": "2015-06-18T16:10:59Z", "bug_id": 634074, "tags": []}, {"text": "I've found out this bug has much more critical consequences. With the bad UTN-DATACorpSGC certificate in the cert store, when I try to login to startssl.com using my client certificate, Firefox enters an endless loop and gets completely frozen. Even the multiprocess nightly. Removing this cert stops the freezing from happening.", "count": 40, "author": "peci1@seznam.cz", "creator": "peci1@seznam.cz", "attachment_id": null, "time": "2015-10-08T01:09:42Z", "id": 10818920, "raw_text": "I've found out this bug has much more critical consequences. With the bad UTN-DATACorpSGC certificate in the cert store, when I try to login to startssl.com using my client certificate, Firefox enters an endless loop and gets completely frozen. Even the multiprocess nightly. Removing this cert stops the freezing from happening.", "bug_id": 634074, "creation_time": "2015-10-08T01:09:42Z", "tags": [], "is_private": false}, {"creation_time": "2015-10-08T17:55:52Z", "bug_id": 634074, "raw_text": "(In reply to Martin Pecka from comment #40)\n> I've found out this bug has much more critical consequences. With the bad\n> UTN-DATACorpSGC certificate in the cert store, when I try to login to\n> startssl.com using my client certificate, Firefox enters an endless loop and\n> gets completely frozen. Even the multiprocess nightly. Removing this cert\n> stops the freezing from happening.\n\nGood to know. We plan to remove that root in Firefox 44 -- Bug #1208461", "tags": [], "creator": "kwilson@mozilla.com", "attachment_id": null, "is_private": false, "count": 41, "text": "(In reply to Martin Pecka from comment #40)\n> I've found out this bug has much more critical consequences. With the bad\n> UTN-DATACorpSGC certificate in the cert store, when I try to login to\n> startssl.com using my client certificate, Firefox enters an endless loop and\n> gets completely frozen. Even the multiprocess nightly. Removing this cert\n> stops the freezing from happening.\n\nGood to know. We plan to remove that root in Firefox 44 -- Bug #1208461", "time": "2015-10-08T17:55:52Z", "author": "kwilson@mozilla.com", "id": 10821533}, {"bug_id": 634074, "creation_time": "2015-10-08T22:02:21Z", "raw_text": "(In reply to Martin Pecka from comment #40)\n> Removing this cert stops the freezing from happening.\n\nMartin, which cert did you remove to stop the freezing from happening?  Was it the self-signed \"UTN - DATACorp SGC\" built-in root (that bug #1208461 will be removing soon), or was it one of the \"UTN - DATACorp SGC\"<--->\"AddTrust External CA Root\" cross-certificates?", "tags": [], "creator": "rob@sectigo.com", "attachment_id": null, "is_private": false, "count": 42, "text": "(In reply to Martin Pecka from comment #40)\n> Removing this cert stops the freezing from happening.\n\nMartin, which cert did you remove to stop the freezing from happening?  Was it the self-signed \"UTN - DATACorp SGC\" built-in root (that bug #1208461 will be removing soon), or was it one of the \"UTN - DATACorp SGC\"<--->\"AddTrust External CA Root\" cross-certificates?", "time": "2015-10-08T22:02:21Z", "author": "rob@sectigo.com", "id": 10822708}, {"is_private": false, "attachment_id": null, "raw_text": "(In reply to Rob Stradling from comment #42)\n> Martin, which cert did you remove to stop the freezing from happening?  Was\n> it the self-signed \"UTN - DATACorp SGC\" built-in root (that bug #1208461\n> will be removing soon), or was it one of the \"UTN - DATACorp\n> SGC\"<--->\"AddTrust External CA Root\" cross-certificates?\n\nRob, I removed the UTN certificate signed by Addtrust. The self-signed UTN hasn't been touched.", "creation_time": "2015-10-09T08:07:39Z", "bug_id": 634074, "creator": "peci1@seznam.cz", "tags": [], "author": "peci1@seznam.cz", "time": "2015-10-09T08:07:39Z", "id": 10823661, "text": "(In reply to Rob Stradling from comment #42)\n> Martin, which cert did you remove to stop the freezing from happening?  Was\n> it the self-signed \"UTN - DATACorp SGC\" built-in root (that bug #1208461\n> will be removing soon), or was it one of the \"UTN - DATACorp\n> SGC\"<--->\"AddTrust External CA Root\" cross-certificates?\n\nRob, I removed the UTN certificate signed by Addtrust. The self-signed UTN hasn't been touched.", "count": 43}, {"is_private": false, "attachment_id": null, "raw_text": "Thanks Martin.  That's what I thought.\n\nKathleen, I don't think bug #1208461 will actually have any effect on any remaining cross-cert looping bugs.", "bug_id": 634074, "creation_time": "2015-10-09T11:15:05Z", "creator": "rob@sectigo.com", "tags": [], "author": "rob@sectigo.com", "time": "2015-10-09T11:15:05Z", "id": 10824072, "count": 44, "text": "Thanks Martin.  That's what I thought.\n\nKathleen, I don't think bug #1208461 will actually have any effect on any remaining cross-cert looping bugs."}, {"attachment_id": null, "creator": "dkeeler@mozilla.com", "author": "dkeeler@mozilla.com", "count": 45, "text": "This is an NSS bug. TLS certificate verification in Firefox won't have this problem because mozilla::pkix knows how to handle looping/cross-signing. (Note that this can still affect Firefox because there are places where the affected NSS functions will still be called (e.g. when libssl builds the client certificate chain if requested by the server and selected by the user)).", "is_private": false, "tags": [], "raw_text": "This is an NSS bug. TLS certificate verification in Firefox won't have this problem because mozilla::pkix knows how to handle looping/cross-signing. (Note that this can still affect Firefox because there are places where the affected NSS functions will still be called (e.g. when libssl builds the client certificate chain if requested by the server and selected by the user)).", "creation_time": "2016-05-12T23:45:20Z", "bug_id": 634074, "id": 11405666, "time": "2016-05-12T23:45:20Z"}]}}}