{"comments": {}, "bugs": {"697963": {"comments": [{"is_private": false, "count": 0, "id": 5811105, "creator": "vincent-moz@vinc17.net", "time": "2011-10-28T11:56:53Z", "creation_time": "2011-10-28T11:56:53Z", "author": "vincent-moz@vinc17.net", "attachment_id": null, "raw_text": "User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0a1) Gecko/20111028 Firefox/10.0a1\nBuild ID: 20111028031044\n\nSteps to reproduce:\n\n1. Remove the .mozilla directory (to have a really fresh profile, with no add-ons).\n2. Start Firefox with \"./firefox\" from a terminal.\n\n\nActual results:\n\nA \"ps -aef\" shows:\nvlefevre 22759 22445  9 13:49 pts/13   00:00:01 ./firefox\nvlefevre 22760 22759  0 13:49 pts/13   00:00:00 [firefox] <defunct>\n\n\nExpected results:\n\nThere should be no zombie (<defunct>) processes.\n\nThis is always reproducible.", "tags": [], "bug_id": 697963, "text": "User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0a1) Gecko/20111028 Firefox/10.0a1\nBuild ID: 20111028031044\n\nSteps to reproduce:\n\n1. Remove the .mozilla directory (to have a really fresh profile, with no add-ons).\n2. Start Firefox with \"./firefox\" from a terminal.\n\n\nActual results:\n\nA \"ps -aef\" shows:\nvlefevre 22759 22445  9 13:49 pts/13   00:00:01 ./firefox\nvlefevre 22760 22759  0 13:49 pts/13   00:00:00 [firefox] <defunct>\n\n\nExpected results:\n\nThere should be no zombie (<defunct>) processes.\n\nThis is always reproducible."}, {"bug_id": 697963, "text": "Does it cause any problems? Does Firefox not start?", "tags": [], "raw_text": "Does it cause any problems? Does Firefox not start?", "attachment_id": null, "author": "acelists@atlas.sk", "creation_time": "2011-11-02T16:10:49Z", "time": "2011-11-02T16:10:49Z", "creator": "acelists@atlas.sk", "id": 5820974, "count": 1, "is_private": false}, {"bug_id": 697963, "text": "Firefox starts and I can use it. But I don't know whether this problem can be related to other bugs. I wonder whether the problem is due to an expected dead process that hasn't been waited for or to some processed that shouldn't have died.", "tags": [], "attachment_id": null, "raw_text": "Firefox starts and I can use it. But I don't know whether this problem can be related to other bugs. I wonder whether the problem is due to an expected dead process that hasn't been waited for or to some processed that shouldn't have died.", "creator": "vincent-moz@vinc17.net", "time": "2011-11-02T16:33:42Z", "creation_time": "2011-11-02T16:33:42Z", "author": "vincent-moz@vinc17.net", "is_private": false, "id": 5821043, "count": 2}, {"text": "Does the zombie go away after some time?", "bug_id": 697963, "tags": [], "raw_text": "Does the zombie go away after some time?", "attachment_id": null, "author": "acelists@atlas.sk", "time": "2011-11-02T16:37:27Z", "creation_time": "2011-11-02T16:37:27Z", "creator": "acelists@atlas.sk", "id": 5821054, "count": 3, "is_private": false}, {"author": "vincent-moz@vinc17.net", "creator": "vincent-moz@vinc17.net", "creation_time": "2011-11-02T20:44:58Z", "time": "2011-11-02T20:44:58Z", "is_private": false, "count": 4, "id": 5821848, "bug_id": 697963, "text": "It didn't seem to go away. But I haven't tried for a long time since this was mainly for testing Firefox stability with a really clean profile.", "tags": [], "raw_text": "It didn't seem to go away. But I haven't tried for a long time since this was mainly for testing Firefox stability with a really clean profile.", "attachment_id": null}, {"author": "vincent-moz@vinc17.net", "creator": "vincent-moz@vinc17.net", "time": "2011-11-02T22:52:47Z", "creation_time": "2011-11-02T22:52:47Z", "is_private": false, "count": 5, "id": 5822282, "tags": [], "text": "Created attachment 571488\nstrace output concerning the dead process\n\nI can reproduce this problem on another machine with:\n\n  Mozilla/5.0 (X11; Linux x86_64; rv:10.0a1) Gecko/20111102 Firefox/10.0a1\n\nI've attached the strace output concerning the dead process. One can see that it writes an error message \"X error occurred in GLX probe, ...\", but this message isn't visible anywhere (it seems to be transmitted to the pipe to the parent firefox process).", "bug_id": 697963, "raw_text": "I can reproduce this problem on another machine with:\n\n  Mozilla/5.0 (X11; Linux x86_64; rv:10.0a1) Gecko/20111102 Firefox/10.0a1\n\nI've attached the strace output concerning the dead process. One can see that it writes an error message \"X error occurred in GLX probe, ...\", but this message isn't visible anywhere (it seems to be transmitted to the pipe to the parent firefox process).", "attachment_id": 571488}, {"time": "2011-11-03T08:13:21Z", "creation_time": "2011-11-03T08:13:21Z", "creator": "acelists@atlas.sk", "author": "acelists@atlas.sk", "id": 5823038, "count": 6, "is_private": false, "text": "I could be the separate process that gets the details of your GPU and driver for the HW acceleration feature. There were problems with this detection that is why it was moved to separate process, otherwise it would kill whole Firefox. Maybe you hit some of those problems and the process gets stale.\n\nDo you always get the zombie when you delete ~/.mozilla?\nDo you never get the zombie when the profile is already created? The detection should be the same, unless you disabled HW acceleration manually.\n\nCan you paste contents of Graphics section from about:support ?\nPost one when you have the zombie, and one when you have a normal profile created and the zombie is not produced.", "bug_id": 697963, "tags": [], "attachment_id": null, "raw_text": "I could be the separate process that gets the details of your GPU and driver for the HW acceleration feature. There were problems with this detection that is why it was moved to separate process, otherwise it would kill whole Firefox. Maybe you hit some of those problems and the process gets stale.\n\nDo you always get the zombie when you delete ~/.mozilla?\nDo you never get the zombie when the profile is already created? The detection should be the same, unless you disabled HW acceleration manually.\n\nCan you paste contents of Graphics section from about:support ?\nPost one when you have the zombie, and one when you have a normal profile created and the zombie is not produced."}, {"bug_id": 697963, "text": "(In reply to :aceman from comment #6)\n> Do you always get the zombie when you delete ~/.mozilla?\n\nYes, and the message \"failed to create drawable\" from libGL is output twice.\n\n> Do you never get the zombie when the profile is already created?\n\nNever, and I get only one message \"failed to create drawable\" from libGL.\n\n> Can you paste contents of Graphics section from about:support ?\n\nAdapter Description\n\nGLXtest process failed (exited with status 1): X error occurred in GLX probe, error_code=9, request_code=55, minor_code=0\n\nWebGL Renderer\n\nBlocked for your graphics card because of unresolved driver issues.\n\nGPU Accelerated Windows\n\n0/1. Blocked for your graphics driver version. Try updating your graphics driver to version <Anything with EXT_texture_from_pixmap support> or newer.\n\nin both cases.", "tags": [], "attachment_id": null, "raw_text": "(In reply to :aceman from comment #6)\n> Do you always get the zombie when you delete ~/.mozilla?\n\nYes, and the message \"failed to create drawable\" from libGL is output twice.\n\n> Do you never get the zombie when the profile is already created?\n\nNever, and I get only one message \"failed to create drawable\" from libGL.\n\n> Can you paste contents of Graphics section from about:support ?\n\nAdapter Description\n\nGLXtest process failed (exited with status 1): X error occurred in GLX probe, error_code=9, request_code=55, minor_code=0\n\nWebGL Renderer\n\nBlocked for your graphics card because of unresolved driver issues.\n\nGPU Accelerated Windows\n\n0/1. Blocked for your graphics driver version. Try updating your graphics driver to version <Anything with EXT_texture_from_pixmap support> or newer.\n\nin both cases.", "creator": "vincent-moz@vinc17.net", "time": "2011-11-03T08:53:59Z", "creation_time": "2011-11-03T08:53:59Z", "author": "vincent-moz@vinc17.net", "is_private": false, "id": 5823077, "count": 7}, {"raw_text": "So can you give details of your card and driver? Try lspci (search for VGA) and glxinfo (lines with e.g. Driver and Renderer).", "attachment_id": null, "bug_id": 697963, "text": "So can you give details of your card and driver? Try lspci (search for VGA) and glxinfo (lines with e.g. Driver and Renderer).", "tags": [], "is_private": false, "count": 8, "id": 5823184, "author": "acelists@atlas.sk", "creator": "acelists@atlas.sk", "creation_time": "2011-11-03T11:12:05Z", "time": "2011-11-03T11:12:05Z"}, {"attachment_id": null, "raw_text": "VGA compatible controller: nVidia Corporation G98 [Quadro NVS 295] (rev a1)\n\nglxinfo gives:\nOpenGL renderer string: Software Rasterizer\nand no lines with driver.\n\nThe machine is a Debian/unstable one, without proprietary drivers.", "tags": [], "text": "VGA compatible controller: nVidia Corporation G98 [Quadro NVS 295] (rev a1)\n\nglxinfo gives:\nOpenGL renderer string: Software Rasterizer\nand no lines with driver.\n\nThe machine is a Debian/unstable one, without proprietary drivers.", "bug_id": 697963, "is_private": false, "count": 9, "id": 5823214, "creator": "vincent-moz@vinc17.net", "time": "2011-11-03T11:53:04Z", "creation_time": "2011-11-03T11:53:04Z", "author": "vincent-moz@vinc17.net"}, {"id": 5823230, "count": 10, "attachment_id": null, "is_private": false, "raw_text": "OK, what is the version of Mesa installed?\nAlso, please see into /var/log/Xorg.0.log (check the file date to be sure it is the log of the currently running X server) and check which driver for your card you are using. Is it \"nv\" or \"nouveau\" or something else? Which version? I think proprietary nvidia driver would show up as \"nvidia\" there.", "time": "2011-11-03T12:15:43Z", "creation_time": "2011-11-03T12:15:43Z", "creator": "acelists@atlas.sk", "tags": [], "bug_id": 697963, "text": "OK, what is the version of Mesa installed?\nAlso, please see into /var/log/Xorg.0.log (check the file date to be sure it is the log of the currently running X server) and check which driver for your card you are using. Is it \"nv\" or \"nouveau\" or something else? Which version? I think proprietary nvidia driver would show up as \"nvidia\" there.", "author": "acelists@atlas.sk"}, {"raw_text": "nouveau compiled for 1.11.0, module version 0.0.16\ndriver date: 2011-03-24", "attachment_id": null, "bug_id": 697963, "text": "nouveau compiled for 1.11.0, module version 0.0.16\ndriver date: 2011-03-24", "tags": [], "id": 5823249, "count": 11, "is_private": false, "author": "vincent-moz@vinc17.net", "time": "2011-11-03T12:34:13Z", "creation_time": "2011-11-03T12:34:13Z", "creator": "vincent-moz@vinc17.net"}, {"author": "acelists@atlas.sk", "creator": "acelists@atlas.sk", "time": "2011-11-03T19:52:08Z", "creation_time": "2011-11-03T19:52:08Z", "is_private": false, "count": 12, "id": 5824485, "tags": [], "text": "And Mesa?", "bug_id": 697963, "raw_text": "And Mesa?", "attachment_id": null}, {"author": "vincent-moz@vinc17.net", "creation_time": "2011-11-03T22:37:05Z", "time": "2011-11-03T22:37:05Z", "creator": "vincent-moz@vinc17.net", "id": 5825044, "count": 13, "is_private": false, "bug_id": 697963, "text": "Mesa 7.11", "tags": [], "raw_text": "Mesa 7.11", "attachment_id": null}, {"count": 14, "id": 5826198, "is_private": false, "author": "jacob.benoit.1@gmail.com", "time": "2011-11-04T13:02:25Z", "creation_time": "2011-11-04T13:02:25Z", "creator": "jacob.benoit.1@gmail.com", "raw_text": "I confirm we've had (and thought we fixed) similar bugs in the past around that glxtest process: bug 677531, bug 681026 .\n\nThis process is expected to die, so the problem is just that we're failing to waitpid() for it.\n\nI can't reproduce this problem here, but this could easily be related to the fact that on your system, a X error occurs in the glxtest process, which is not the case on my system.\n\nThe first thing to do to try to reproduce would be, precisely, to trigger a X error in toolkit/xre/glxtest.cpp to see if that reproduces the problem.", "attachment_id": null, "bug_id": 697963, "text": "I confirm we've had (and thought we fixed) similar bugs in the past around that glxtest process: bug 677531, bug 681026 .\n\nThis process is expected to die, so the problem is just that we're failing to waitpid() for it.\n\nI can't reproduce this problem here, but this could easily be related to the fact that on your system, a X error occurs in the glxtest process, which is not the case on my system.\n\nThe first thing to do to try to reproduce would be, precisely, to trigger a X error in toolkit/xre/glxtest.cpp to see if that reproduces the problem.", "tags": []}, {"author": "jacob.benoit.1@gmail.com", "creator": "jacob.benoit.1@gmail.com", "time": "2011-11-04T13:14:20Z", "creation_time": "2011-11-04T13:14:20Z", "is_private": false, "count": 15, "id": 5826224, "bug_id": 697963, "text": "Actually, this still doesn't make sense to me: the fact that about:support shows your X error is proof that we hit the GetData() function in GfxInfoX11.cpp which is also where we waitpid().", "tags": [], "raw_text": "Actually, this still doesn't make sense to me: the fact that about:support shows your X error is proof that we hit the GetData() function in GfxInfoX11.cpp which is also where we waitpid().", "attachment_id": null}, {"time": "2011-11-04T13:22:00Z", "creation_time": "2011-11-04T13:22:00Z", "creator": "jacob.benoit.1@gmail.com", "author": "jacob.benoit.1@gmail.com", "id": 5826233, "count": 16, "is_private": false, "tags": [], "bug_id": 697963, "text": "(In reply to Vincent Lefevre from comment #7)\n> (In reply to :aceman from comment #6)\n> > Do you always get the zombie when you delete ~/.mozilla?\n> \n> Yes, and the message \"failed to create drawable\" from libGL is output twice.\n> \n> > Do you never get the zombie when the profile is already created?\n> \n> Never, and I get only one message \"failed to create drawable\" from libGL.\n\nOK, this is the key to reproduce. I can reproduce by using an empty .mozilla, but I can't reproduce by using just a new profile in existing .mozilla.", "attachment_id": null, "raw_text": "(In reply to Vincent Lefevre from comment #7)\n> (In reply to :aceman from comment #6)\n> > Do you always get the zombie when you delete ~/.mozilla?\n> \n> Yes, and the message \"failed to create drawable\" from libGL is output twice.\n> \n> > Do you never get the zombie when the profile is already created?\n> \n> Never, and I get only one message \"failed to create drawable\" from libGL.\n\nOK, this is the key to reproduce. I can reproduce by using an empty .mozilla, but I can't reproduce by using just a new profile in existing .mozilla."}, {"author": "jacob.benoit.1@gmail.com", "creator": "jacob.benoit.1@gmail.com", "time": "2011-11-04T13:35:10Z", "creation_time": "2011-11-04T13:35:10Z", "is_private": false, "count": 17, "id": 5826253, "tags": [], "bug_id": 697963, "text": "In toolkit/xre/nsAppRunner.cpp, we're forking the glxtest process very early, then we set up the crash reporter, and only later do we do SelectProfile() which apparently forks again.", "raw_text": "In toolkit/xre/nsAppRunner.cpp, we're forking the glxtest process very early, then we set up the crash reporter, and only later do we do SelectProfile() which apparently forks again.", "attachment_id": null}, {"creator": "jacob.benoit.1@gmail.com", "time": "2011-11-04T15:18:13Z", "creation_time": "2011-11-04T15:18:13Z", "author": "jacob.benoit.1@gmail.com", "is_private": false, "id": 5826459, "count": 18, "tags": [], "text": "Benjamin, do you have any clue as to why we are failing to waitpid() for the glxtest process specifically when there is no .mozilla directory, if if this can be related to SelectProfile() forking after the glxtest process is forked? (comment 17)", "bug_id": 697963, "attachment_id": null, "raw_text": "Benjamin, do you have any clue as to why we are failing to waitpid() for the glxtest process specifically when there is no .mozilla directory, if if this can be related to SelectProfile() forking after the glxtest process is forked? (comment 17)"}, {"creator": "benjamin@smedbergs.us", "creation_time": "2011-11-04T15:42:07Z", "time": "2011-11-04T15:42:07Z", "author": "benjamin@smedbergs.us", "is_private": false, "count": 19, "id": 5826502, "tags": [], "text": "When the user launches with -P or -profilemanager, we show the profile selection dialog in the first process and then exec to start a brand new process with the selected profile. In that case we do initialize gecko and graphics and presumably you should be waiting on it later.\n\nThis shouldn't affect *this* case, though, since a missing .mozilla directory shouldn't be showing the profile manager ever and we shouldn't be forking or execing anything, instead following this code path: http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#2130\n\nThat should also kick off any profile migration code, but that also AFAIK doesn't cause any execs or forks: we've worked pretty hard to remove all of the exec/forking from the common-case startup path.", "bug_id": 697963, "attachment_id": null, "raw_text": "When the user launches with -P or -profilemanager, we show the profile selection dialog in the first process and then exec to start a brand new process with the selected profile. In that case we do initialize gecko and graphics and presumably you should be waiting on it later.\n\nThis shouldn't affect *this* case, though, since a missing .mozilla directory shouldn't be showing the profile manager ever and we shouldn't be forking or execing anything, instead following this code path: http://mxr.mozilla.org/mozilla-central/source/toolkit/xre/nsAppRunner.cpp#2130\n\nThat should also kick off any profile migration code, but that also AFAIK doesn't cause any execs or forks: we've worked pretty hard to remove all of the exec/forking from the common-case startup path."}, {"text": "Actually, in the present case (no existing .mozilla directory), we do execv():\n\nBreakpoint 1, LaunchChild (aNative=0x4bc630, aBlankCommandLine=false)\n    at /home/bjacob/mozilla-inbound/toolkit/xre/nsAppRunner.cpp:1647\n1647      if (execv(exePath.get(), gRestartArgv) == -1)\n(gdb) bt\n#0  LaunchChild (aNative=0x4bc630, aBlankCommandLine=false)\n    at /home/bjacob/mozilla-inbound/toolkit/xre/nsAppRunner.cpp:1647\n#1  0x00007ffff3eb22d9 in ImportProfiles (aPService=0x4cfaf0, aNative=0x4bc630)\n    at /home/bjacob/mozilla-inbound/toolkit/xre/nsAppRunner.cpp:1919\n#2  0x00007ffff3eb2fc3 in SelectProfile (aResult=0x7fffffffba60, aNative=0x4bc630, aStartOffline=0x7fffffffba5f, \n    aProfileName=0x7fffffffb7a0) at /home/bjacob/mozilla-inbound/toolkit/xre/nsAppRunner.cpp:2075\n#3  0x00007ffff3eb656f in XRE_main (argc=2, argv=0x7fffffffe258, aAppData=0x424b10)\n    at /home/bjacob/mozilla-inbound/toolkit/xre/nsAppRunner.cpp:3190\n#4  0x0000000000401878 in do_main (exePath=0x7fffffffd020 \"/home/bjacob/build/inbound/dist/bin/libxpcom.so\", argc=2, \n    argv=0x7fffffffe258) at /home/bjacob/mozilla-inbound/browser/app/nsBrowserApp.cpp:198\n#5  0x0000000000401a91 in main (argc=2, argv=0x7fffffffe258)\n    at /home/bjacob/mozilla-inbound/browser/app/nsBrowserApp.cpp:281\n\n\nI think that explains it.\n\nDo we want to fix it? I'm tempted to WONTFIX this as this only affects an uncommon case (basically, first usage of firefox), the bug doesn't cause any harm besides using 1 PID and a small amount of memory while Firefox is running, and fixing it requires making non-local changes in this very 'core' part of the codebase. What do you think?", "bug_id": 697963, "tags": [], "attachment_id": null, "raw_text": "Actually, in the present case (no existing .mozilla directory), we do execv():\n\nBreakpoint 1, LaunchChild (aNative=0x4bc630, aBlankCommandLine=false)\n    at /home/bjacob/mozilla-inbound/toolkit/xre/nsAppRunner.cpp:1647\n1647      if (execv(exePath.get(), gRestartArgv) == -1)\n(gdb) bt\n#0  LaunchChild (aNative=0x4bc630, aBlankCommandLine=false)\n    at /home/bjacob/mozilla-inbound/toolkit/xre/nsAppRunner.cpp:1647\n#1  0x00007ffff3eb22d9 in ImportProfiles (aPService=0x4cfaf0, aNative=0x4bc630)\n    at /home/bjacob/mozilla-inbound/toolkit/xre/nsAppRunner.cpp:1919\n#2  0x00007ffff3eb2fc3 in SelectProfile (aResult=0x7fffffffba60, aNative=0x4bc630, aStartOffline=0x7fffffffba5f, \n    aProfileName=0x7fffffffb7a0) at /home/bjacob/mozilla-inbound/toolkit/xre/nsAppRunner.cpp:2075\n#3  0x00007ffff3eb656f in XRE_main (argc=2, argv=0x7fffffffe258, aAppData=0x424b10)\n    at /home/bjacob/mozilla-inbound/toolkit/xre/nsAppRunner.cpp:3190\n#4  0x0000000000401878 in do_main (exePath=0x7fffffffd020 \"/home/bjacob/build/inbound/dist/bin/libxpcom.so\", argc=2, \n    argv=0x7fffffffe258) at /home/bjacob/mozilla-inbound/browser/app/nsBrowserApp.cpp:198\n#5  0x0000000000401a91 in main (argc=2, argv=0x7fffffffe258)\n    at /home/bjacob/mozilla-inbound/browser/app/nsBrowserApp.cpp:281\n\n\nI think that explains it.\n\nDo we want to fix it? I'm tempted to WONTFIX this as this only affects an uncommon case (basically, first usage of firefox), the bug doesn't cause any harm besides using 1 PID and a small amount of memory while Firefox is running, and fixing it requires making non-local changes in this very 'core' part of the codebase. What do you think?", "time": "2011-11-04T21:16:44Z", "creation_time": "2011-11-04T21:16:44Z", "creator": "jacob.benoit.1@gmail.com", "author": "jacob.benoit.1@gmail.com", "count": 20, "id": 5827434, "is_private": false}, {"attachment_id": null, "raw_text": "I don't think this bug is harmful, indeed. But we can also just remove the profile import code, since that code was going from Firefox <0.9.2 to Firefox >=0.9.3.  We can avoid an extra process on first-launch and remove some unuseful code at the same time...", "bug_id": 697963, "text": "I don't think this bug is harmful, indeed. But we can also just remove the profile import code, since that code was going from Firefox <0.9.2 to Firefox >=0.9.3.  We can avoid an extra process on first-launch and remove some unuseful code at the same time...", "tags": [], "is_private": false, "id": 5831047, "count": 21, "creator": "benjamin@smedbergs.us", "creation_time": "2011-11-07T16:48:00Z", "time": "2011-11-07T16:48:00Z", "author": "benjamin@smedbergs.us"}, {"id": 5864124, "count": 22, "is_private": false, "creation_time": "2011-11-22T00:30:51Z", "time": "2011-11-22T00:30:51Z", "creator": "mozilla@virginmedia.com", "author": "mozilla@virginmedia.com", "attachment_id": null, "raw_text": "I'm noticing this bug I think, and I *do* have a .mozilla directory.  I only noticed when my Firefox hung for some unknown reason and I saw a whole bunch of defunct processes.  I get an extra one each time I do a restart of Firefox.\n\nMy graphics hardware and drivers are too old and useless to support hardware acceleration.  Everything is showing as blacklisted.", "tags": [], "text": "I'm noticing this bug I think, and I *do* have a .mozilla directory.  I only noticed when my Firefox hung for some unknown reason and I saw a whole bunch of defunct processes.  I get an extra one each time I do a restart of Firefox.\n\nMy graphics hardware and drivers are too old and useless to support hardware acceleration.  Everything is showing as blacklisted.", "bug_id": 697963}]}}}