{"comments": {}, "bugs": {"704753": {"comments": [{"count": 0, "is_private": false, "tags": [], "id": 5867769, "bug_id": 704753, "creation_time": "2011-11-23T06:02:08Z", "raw_text": "User Agent: Mozilla/5.0 (X11; Linux i686) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2\n\nSteps to reproduce:\n\nCurrently, it's possible for a new user to sign up for an account, and immediately create a lot of bugs very quickly.  Additionally, if editbugs is enabled for new users, they can also make lots of edits quickly.\n\n\n\nActual results:\n\nThis request is prompted by this problem:\nhttp://thread.gmane.org/gmane.science.linguistics.wikipedia.technical/56816\n\n\nExpected results:\n\nWe would like the ability to limit the rate at which changes are made, bugs are created, or comments made.  This doesn't completely eliminate the problem, but it limits the damage that one bad actor can cause, giving us far less to clean up after when a bad actor comes in.\n\nThis feature request is modeled after the rate limiter feature of MediaWiki:\nhttp://www.mediawiki.org/wiki/Manual:$wgRateLimits", "text": "User Agent: Mozilla/5.0 (X11; Linux i686) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2\n\nSteps to reproduce:\n\nCurrently, it's possible for a new user to sign up for an account, and immediately create a lot of bugs very quickly.  Additionally, if editbugs is enabled for new users, they can also make lots of edits quickly.\n\n\n\nActual results:\n\nThis request is prompted by this problem:\nhttp://thread.gmane.org/gmane.science.linguistics.wikipedia.technical/56816\n\n\nExpected results:\n\nWe would like the ability to limit the rate at which changes are made, bugs are created, or comments made.  This doesn't completely eliminate the problem, but it limits the damage that one bad actor can cause, giving us far less to clean up after when a bad actor comes in.\n\nThis feature request is modeled after the rate limiter feature of MediaWiki:\nhttp://www.mediawiki.org/wiki/Manual:$wgRateLimits", "time": "2011-11-23T06:02:08Z", "attachment_id": null, "creator": "robla@wikimedia.org", "author": "robla@wikimedia.org"}, {"creator": "robla@wikimedia.org", "author": "robla@wikimedia.org", "is_private": false, "count": 1, "tags": [], "id": 5867776, "bug_id": 704753, "raw_text": "LpSolit suggested it would be reasonably simple to write an extension for at least modifications.  For that, this hook would need to be employed:\nhttp://www.bugzilla.org/docs/4.0/en/html/api/Bugzilla/Hook.html#bug_check_can_change_field\n\nTo limit bug creation, a hook would be needed for bug_end_of_create or  bug_end_of_create_validators.\n\nFor comments, object_before_set would need to be employed.", "creation_time": "2011-11-23T06:12:59Z", "text": "LpSolit suggested it would be reasonably simple to write an extension for at least modifications.  For that, this hook would need to be employed:\nhttp://www.bugzilla.org/docs/4.0/en/html/api/Bugzilla/Hook.html#bug_check_can_change_field\n\nTo limit bug creation, a hook would be needed for bug_end_of_create or  bug_end_of_create_validators.\n\nFor comments, object_before_set would need to be employed.", "attachment_id": null, "time": "2011-11-23T06:12:59Z"}, {"creation_time": "2011-11-23T15:56:56Z", "raw_text": "Have you considered just not giving editbugs to new contributors? They can still file bugs and make comments - but mass-closing all the bugs filed by one person is very simple, and mass-nullifying their comments is (admittedly a bit harder) one database query. This is the mechanism most public Bugzillas use.\n\nI can imagine, though, perhaps, that Wikimedia has principled opposition to the idea of limiting the editing powers of new people?\n\nGerv", "creator": "gerv@mozilla.org", "text": "Have you considered just not giving editbugs to new contributors? They can still file bugs and make comments - but mass-closing all the bugs filed by one person is very simple, and mass-nullifying their comments is (admittedly a bit harder) one database query. This is the mechanism most public Bugzillas use.\n\nI can imagine, though, perhaps, that Wikimedia has principled opposition to the idea of limiting the editing powers of new people?\n\nGerv", "time": "2011-11-23T15:56:56Z", "attachment_id": null, "author": "gerv@mozilla.org", "count": 2, "is_private": false, "tags": [], "id": 5868477, "bug_id": 704753}, {"text": "Hi Gerv, you're correct that there's principled opposition to the idea of limiting editing powers. While it's probably more of a requirement for us than others, it's still something that anyone running a public repository would benefit from.\n\nWith rate limiting combined with the ability to quickly and easily revert bad changes (bug 363346) we'd stack the deck in favor of the good guys.", "time": "2011-11-23T19:26:19Z", "attachment_id": null, "creation_time": "2011-11-23T19:26:19Z", "raw_text": "Hi Gerv, you're correct that there's principled opposition to the idea of limiting editing powers. While it's probably more of a requirement for us than others, it's still something that anyone running a public repository would benefit from.\n\nWith rate limiting combined with the ability to quickly and easily revert bad changes (bug 363346) we'd stack the deck in favor of the good guys.", "bug_id": 704753, "tags": [], "is_private": false, "count": 3, "id": 5869038, "creator": "robla@wikimedia.org", "author": "robla@wikimedia.org"}, {"author": "gerv@mozilla.org", "creator": "gerv@mozilla.org", "raw_text": "I wouldn't hold your breath for someone else to implement bug 363346 - the age of the bug is an indication of what sort of priority it seems to have.\n\nDepending on how you did it, you could rate limit using a single \"change counter\" attached to a user's account and counting all the changes. Changing 5 fields on 1 bug would be the same as 1 field on 5 bugs. But perhaps that's OK. You reset all the counters every hour, say.\n\nHowever, you would still need exceptions for privileged users because otherwise people couldn't use the \"mass change\" abilities of Bugzilla to e.g. move all bugs targetted at one release forward to the next one.\n\nAnother option would be to limit use of the \"mass change\" UI to a more restricted group of people. (Do we know if that's what your guy used?)\n\nGerv", "creation_time": "2011-11-24T12:00:39Z", "time": "2011-11-24T12:00:39Z", "attachment_id": null, "text": "I wouldn't hold your breath for someone else to implement bug 363346 - the age of the bug is an indication of what sort of priority it seems to have.\n\nDepending on how you did it, you could rate limit using a single \"change counter\" attached to a user's account and counting all the changes. Changing 5 fields on 1 bug would be the same as 1 field on 5 bugs. But perhaps that's OK. You reset all the counters every hour, say.\n\nHowever, you would still need exceptions for privileged users because otherwise people couldn't use the \"mass change\" abilities of Bugzilla to e.g. move all bugs targetted at one release forward to the next one.\n\nAnother option would be to limit use of the \"mass change\" UI to a more restricted group of people. (Do we know if that's what your guy used?)\n\nGerv", "id": 5870539, "tags": [], "is_private": false, "count": 4, "bug_id": 704753}, {"creator": "ariel@wikimedia.org", "author": "ariel@wikimedia.org", "tags": [], "count": 5, "is_private": false, "id": 5872358, "bug_id": 704753, "raw_text": "Good question.  I don't know how to tell what they used.  There seem to be a few batches of changes with each batch looking identical (i.e. one batch has a particular comment field added and a specific change to the cc list, another batch has a different change to the cc list, etc), so that means it's possible.", "creation_time": "2011-11-25T15:52:10Z", "text": "Good question.  I don't know how to tell what they used.  There seem to be a few batches of changes with each batch looking identical (i.e. one batch has a particular comment field added and a specific change to the cc list, another batch has a different change to the cc list, etc), so that means it's possible.", "time": "2011-11-25T15:52:10Z", "attachment_id": null}, {"creation_time": "2011-11-25T16:07:10Z", "raw_text": "A small hack or extension to limit that UI should be pretty easy. Then, they either have to script Bugzilla themselves using some sort of browser add-in or HTTPUnit (probably not worth it for a griefer) or they have to load, edit and submit each bug manually (which gets boring fast).\n\nThat would be the simplest solution; why not try that, and see if the problem recurs?\n\nGerv", "text": "A small hack or extension to limit that UI should be pretty easy. Then, they either have to script Bugzilla themselves using some sort of browser add-in or HTTPUnit (probably not worth it for a griefer) or they have to load, edit and submit each bug manually (which gets boring fast).\n\nThat would be the simplest solution; why not try that, and see if the problem recurs?\n\nGerv", "time": "2011-11-25T16:07:10Z", "attachment_id": null, "tags": [], "count": 6, "is_private": false, "id": 5872386, "bug_id": 704753, "creator": "gerv@mozilla.org", "author": "gerv@mozilla.org"}, {"author": "ariel@wikimedia.org", "creator": "ariel@wikimedia.org", "id": 5872503, "tags": [], "is_private": false, "count": 7, "bug_id": 704753, "raw_text": "Hmm, isn't \"change several bugs\" attached to the editbugs right?  Because the accounts created yesterday for spam/vandalism don't have that right, we changed that default earlier yesterday before re-enabling self-registration.", "creation_time": "2011-11-25T17:21:08Z", "time": "2011-11-25T17:21:08Z", "attachment_id": null, "text": "Hmm, isn't \"change several bugs\" attached to the editbugs right?  Because the accounts created yesterday for spam/vandalism don't have that right, we changed that default earlier yesterday before re-enabling self-registration."}, {"tags": [], "is_private": false, "count": 8, "id": 5872554, "bug_id": 704753, "creation_time": "2011-11-25T17:55:22Z", "raw_text": "Are these new accounts you are talking about?\n\nIf people don't have editbugs, all they can do is add comments - either in bulk or singly. (The 'change several bugs' feature doesn't require special permissions to use, but of course you can only make changes that you'd be permitted to make individually.) You can change Bugzilla to say that bulk changes require editbugs by hacking the very top of process_bug.cgi.\n\nGerv", "text": "Are these new accounts you are talking about?\n\nIf people don't have editbugs, all they can do is add comments - either in bulk or singly. (The 'change several bugs' feature doesn't require special permissions to use, but of course you can only make changes that you'd be permitted to make individually.) You can change Bugzilla to say that bulk changes require editbugs by hacking the very top of process_bug.cgi.\n\nGerv", "time": "2011-11-25T17:55:22Z", "attachment_id": null, "creator": "gerv@mozilla.org", "author": "gerv@mozilla.org"}, {"author": "ariel@wikimedia.org", "creator": "ariel@wikimedia.org", "bug_id": 704753, "id": 5872599, "is_private": false, "count": 9, "tags": [], "time": "2011-11-25T18:25:51Z", "attachment_id": null, "text": "Well even without editbugs, editing the CC list is still permitted (just checked with a test account).  And that is clearly what this guy did.  His changes were limited to comments and the CC list.  His two new accounts from yesterday as well as my test account, all created after we turned off editbugs as default for all users, show that editbugs is off. \n\nI'm looking at: \n\n214         [% IF bugs.size > 1 && caneditbugs && !dotweak %]\n215           <a href=\"buglist.cgi?[% urlquerypart FILTER html %]\n216             [%- \"&order=$qorder\" FILTER html IF order %]&amp;tweak=1\"\n217             >Change&nbsp;Several&nbsp;[% terms.Bugs %]&nbsp;at&nbsp;Once</a>\n218           |\n219         [% END %]\n\nin http://mxr.mozilla.org/mozilla/source/webtools/bugzilla/template/en/default/list/list.html.tmpl\n\nand \n\n987 if (!$user->in_group('editbugs')) {\n988     foreach my $product (keys %$bugproducts) {\n989         my $prod = new Bugzilla::Product({name => $product});\n990         if (!$user->in_group('editbugs', $prod->id)) {\n991             $vars->{'caneditbugs'} = 0;\n992             last;\n993         }\n994     }\n995 }\n\nfrom http://mxr.mozilla.org/mozilla/source/webtools/bugzilla/buglist.cgi\n\nwhich seem to indicate that one needs editbugs to get mass bug changes. Or am I misreading something?  And thanks for your patience btw.", "raw_text": "Well even without editbugs, editing the CC list is still permitted (just checked with a test account).  And that is clearly what this guy did.  His changes were limited to comments and the CC list.  His two new accounts from yesterday as well as my test account, all created after we turned off editbugs as default for all users, show that editbugs is off. \n\nI'm looking at: \n\n214         [% IF bugs.size > 1 && caneditbugs && !dotweak %]\n215           <a href=\"buglist.cgi?[% urlquerypart FILTER html %]\n216             [%- \"&order=$qorder\" FILTER html IF order %]&amp;tweak=1\"\n217             >Change&nbsp;Several&nbsp;[% terms.Bugs %]&nbsp;at&nbsp;Once</a>\n218           |\n219         [% END %]\n\nin http://mxr.mozilla.org/mozilla/source/webtools/bugzilla/template/en/default/list/list.html.tmpl\n\nand \n\n987 if (!$user->in_group('editbugs')) {\n988     foreach my $product (keys %$bugproducts) {\n989         my $prod = new Bugzilla::Product({name => $product});\n990         if (!$user->in_group('editbugs', $prod->id)) {\n991             $vars->{'caneditbugs'} = 0;\n992             last;\n993         }\n994     }\n995 }\n\nfrom http://mxr.mozilla.org/mozilla/source/webtools/bugzilla/buglist.cgi\n\nwhich seem to indicate that one needs editbugs to get mass bug changes. Or am I misreading something?  And thanks for your patience btw.", "creation_time": "2011-11-25T18:25:51Z"}, {"creator": "gerv@mozilla.org", "author": "gerv@mozilla.org", "text": "The code snippets you show make it so that you need editbugs to see the mass-change UI; that's not quite the same thing as needing editbugs to actually make such changes, although hacking up the URLs by hand would be tiresome.\n\nYou are quite right: editing the CC list and adding comments are the two things an unprivileged user can do (on bugs they didn't file) by default. There was some talk of restricting unprivileged users to only _adding_ CC list members and not removing them, but I can't find the bug relating to that.\n\nWe had a persistent troll here for a few weeks, where we were chasing him around. If the accounts he creates have a pattern (e.g. all at the same domain), you can put a negative regexp in the parameter which says who can create accounts, and ban him that way. (This is made complex by the fact that gmail allows for arbitrary dots and so on, giving you multiple addresses for one mailbox). \n\nOr, you can try IP address/block banning, but if he has access to proxies or hacked boxes, he can get around that.\n\nIn the end, ours just went away; we never came up with a particularly good banning algorithm. So I don't have great wisdom to share...\n\nIt would be much easier to write a tool which reversed comment-and-CC damage than it would be to write one which reversed arbitrary changes. So at this point, that might be the right route. Deleting comments entirely is probably not recommended, but you can turn them blank without worrying about breaking DB integrity.\n\nGerv", "attachment_id": null, "time": "2011-11-25T18:51:21Z", "creation_time": "2011-11-25T18:51:21Z", "raw_text": "The code snippets you show make it so that you need editbugs to see the mass-change UI; that's not quite the same thing as needing editbugs to actually make such changes, although hacking up the URLs by hand would be tiresome.\n\nYou are quite right: editing the CC list and adding comments are the two things an unprivileged user can do (on bugs they didn't file) by default. There was some talk of restricting unprivileged users to only _adding_ CC list members and not removing them, but I can't find the bug relating to that.\n\nWe had a persistent troll here for a few weeks, where we were chasing him around. If the accounts he creates have a pattern (e.g. all at the same domain), you can put a negative regexp in the parameter which says who can create accounts, and ban him that way. (This is made complex by the fact that gmail allows for arbitrary dots and so on, giving you multiple addresses for one mailbox). \n\nOr, you can try IP address/block banning, but if he has access to proxies or hacked boxes, he can get around that.\n\nIn the end, ours just went away; we never came up with a particularly good banning algorithm. So I don't have great wisdom to share...\n\nIt would be much easier to write a tool which reversed comment-and-CC damage than it would be to write one which reversed arbitrary changes. So at this point, that might be the right route. Deleting comments entirely is probably not recommended, but you can turn them blank without worrying about breaking DB integrity.\n\nGerv", "bug_id": 704753, "tags": [], "count": 10, "is_private": false, "id": 5872625}, {"id": 5872970, "is_private": false, "count": 11, "tags": [], "bug_id": 704753, "creation_time": "2011-11-25T23:48:46Z", "raw_text": "(In reply to Gervase Markham [:gerv] from comment #10)\n> ..\n> There was some talk of restricting unprivileged users to only _adding_ CC\n> list members and not removing them, but I can't find the bug relating to\n> that.\n\nbug 28849?", "attachment_id": null, "time": "2011-11-25T23:48:46Z", "text": "(In reply to Gervase Markham [:gerv] from comment #10)\n> ..\n> There was some talk of restricting unprivileged users to only _adding_ CC\n> list members and not removing them, but I can't find the bug relating to\n> that.\n\nbug 28849?", "author": "jayvdb@gmail.com", "creator": "jayvdb@gmail.com"}, {"creator": "gerv@mozilla.org", "author": "gerv@mozilla.org", "bug_id": 704753, "tags": [], "is_private": false, "count": 12, "id": 5875529, "text": "John: yes, that's it. Thanks for the tip :-) Ariel: I suggest that that's another patch you might want to take.\n\nGerv", "attachment_id": null, "time": "2011-11-28T14:53:58Z", "creation_time": "2011-11-28T14:53:58Z", "raw_text": "John: yes, that's it. Thanks for the tip :-) Ariel: I suggest that that's another patch you might want to take.\n\nGerv"}, {"author": "mkanat@bugzilla.org", "creator": "mkanat@bugzilla.org", "time": "2011-11-29T10:50:50Z", "attachment_id": null, "text": "One reasonable solution here would be to do general DoS protection by watching how recently a user has taken any action, and then putting in an exponential backoff for them doing further actions, that triggered after too many actions were taken.\n\nYou could start this off as an extension, and if it proved worthwhile, we could take it upstream as general DoS protection.", "creation_time": "2011-11-29T10:50:50Z", "raw_text": "One reasonable solution here would be to do general DoS protection by watching how recently a user has taken any action, and then putting in an exponential backoff for them doing further actions, that triggered after too many actions were taken.\n\nYou could start this off as an extension, and if it proved worthwhile, we could take it upstream as general DoS protection.", "bug_id": 704753, "id": 5878403, "tags": [], "is_private": false, "count": 13}, {"bug_id": 704753, "id": 5879717, "tags": [], "is_private": false, "count": 14, "time": "2011-11-29T20:33:59Z", "attachment_id": 577706, "text": "Created attachment 577706\nupdate patch against trunk to tighten up editbug\n\nPatch to make editbugs group necessary to add or remove arbitrary CCs.  Self can still be added or removed.", "raw_text": "Patch to make editbugs group necessary to add or remove arbitrary CCs.  Self can still be added or removed.", "creation_time": "2011-11-29T20:33:59Z", "author": "mhershberger@wikimedia.org", "creator": "mhershberger@wikimedia.org"}, {"creator": "mkanat@bugzilla.org", "author": "mkanat@bugzilla.org", "bug_id": 704753, "count": 15, "is_private": false, "tags": [], "id": 5881310, "text": "Comment on attachment 577706\nupdate patch against trunk to tighten up editbug\n\nThis patch has nothing to do with this bug.", "attachment_id": 577706, "time": "2011-11-30T06:00:51Z", "creation_time": "2011-11-30T06:00:51Z", "raw_text": "This patch has nothing to do with this bug."}, {"creator": "gerv@mozilla.org", "author": "gerv@mozilla.org", "creation_time": "2011-11-30T11:29:12Z", "raw_text": "Hi Mark,\n\nWhat Max is saying is: thanks very much for submitting a patch, but perhaps it would be good to file a new, more tightly-scoped bug to track it :-)\n\nHowever, I think that many public Bugzillas think it's OK for unprivileged users to be able to add CCs of other users, because the normal initial response to \"I can't do this, I don't have the privs\" is \"CC someone who can\".\n\nGerv", "text": "Hi Mark,\n\nWhat Max is saying is: thanks very much for submitting a patch, but perhaps it would be good to file a new, more tightly-scoped bug to track it :-)\n\nHowever, I think that many public Bugzillas think it's OK for unprivileged users to be able to add CCs of other users, because the normal initial response to \"I can't do this, I don't have the privs\" is \"CC someone who can\".\n\nGerv", "time": "2011-11-30T11:29:12Z", "attachment_id": null, "tags": [], "count": 16, "is_private": false, "id": 5881671, "bug_id": 704753}, {"creator": "mhershberger@wikimedia.org", "author": "mhershberger@wikimedia.org", "bug_id": 704753, "is_private": false, "count": 17, "tags": [], "id": 5882894, "text": "(In reply to Gervase Markham [:gerv] from comment #16)\n> Hi Mark,\n> \n> What Max is saying is: thanks very much for submitting a patch, but perhaps\n> it would be good to file a new, more tightly-scoped bug to track it :-)\n\nSure.  I was just putting it here since that is what *we* ended up using at Wikimedia to fight our vandal.\n\n> However, I think that many public Bugzillas think it's OK for unprivileged\n> users to be able to add CCs of other users, because the normal initial\n> response to \"I can't do this, I don't have the privs\" is \"CC someone who\n> can\".\n\nAgreed.  And we do intend to be generous with the editbugs bit, but a more general fix might be to make this something that bz admins could allow or disallow for editbugs.\n\nHrm... Now that I think about it, allowing anyone with a login to add arbitrary CCs would allow vandals to bomb someone with email.\n\nNevertheless, new bug with updated patch coming up.", "time": "2011-11-30T19:08:08Z", "attachment_id": null, "creation_time": "2011-11-30T19:08:08Z", "raw_text": "(In reply to Gervase Markham [:gerv] from comment #16)\n> Hi Mark,\n> \n> What Max is saying is: thanks very much for submitting a patch, but perhaps\n> it would be good to file a new, more tightly-scoped bug to track it :-)\n\nSure.  I was just putting it here since that is what *we* ended up using at Wikimedia to fight our vandal.\n\n> However, I think that many public Bugzillas think it's OK for unprivileged\n> users to be able to add CCs of other users, because the normal initial\n> response to \"I can't do this, I don't have the privs\" is \"CC someone who\n> can\".\n\nAgreed.  And we do intend to be generous with the editbugs bit, but a more general fix might be to make this something that bz admins could allow or disallow for editbugs.\n\nHrm... Now that I think about it, allowing anyone with a login to add arbitrary CCs would allow vandals to bomb someone with email.\n\nNevertheless, new bug with updated patch coming up."}, {"author": "mhershberger@wikimedia.org", "creator": "mhershberger@wikimedia.org", "id": 5883167, "tags": [], "count": 18, "is_private": false, "bug_id": 704753, "raw_text": "(In reply to Mark A. Hershberger from comment #17)\n> Nevertheless, new bug with updated patch coming up.\n\nBug #706604", "creation_time": "2011-11-30T20:13:08Z", "attachment_id": null, "time": "2011-11-30T20:13:08Z", "text": "(In reply to Mark A. Hershberger from comment #17)\n> Nevertheless, new bug with updated patch coming up.\n\nBug #706604"}, {"creator": "mkanat@bugzilla.org", "author": "mkanat@bugzilla.org", "count": 19, "is_private": false, "tags": [], "id": 5884460, "bug_id": 704753, "raw_text": "Yeah, I do appreciate Mark's contributions, absolutely. But let's keep this bug focused on throttling, not on permissions.", "creation_time": "2011-12-01T05:51:11Z", "text": "Yeah, I do appreciate Mark's contributions, absolutely. But let's keep this bug focused on throttling, not on permissions.", "time": "2011-12-01T05:51:11Z", "attachment_id": null}, {"bug_id": 704753, "is_private": false, "count": 20, "tags": [], "id": 8074705, "text": "*** Bug 937821 has been marked as a duplicate of this bug. ***", "time": "2013-11-13T07:14:29Z", "attachment_id": null, "creation_time": "2013-11-13T07:14:29Z", "raw_text": "", "creator": "glob@mozilla.com", "author": "glob@mozilla.com"}]}}}