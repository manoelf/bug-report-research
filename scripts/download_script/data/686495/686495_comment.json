{"comments": {}, "bugs": {"686495": {"comments": [{"attachment_id": null, "raw_text": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:6.0) Gecko/20100101 Firefox/6.0\nBuild ID: 20110811165603\n\nSteps to reproduce:\n\nWhile TB-v6.0.2 was running, unplugged from network (WIFI physically switched off) and started running off battery (not using or looking at TB). I have a win7-x64 laptop. \n\n\nActual results:\n\nTB constantly uses a small amount of CPU (5-10%), burning battery directly and preventing Windows from idling the CPU (which burns even more power indirectly).\n\n\nExpected results:\n\nTB CPU usage should be 0.0% when in background with no network access.", "bug_id": 686495, "text": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:6.0) Gecko/20100101 Firefox/6.0\nBuild ID: 20110811165603\n\nSteps to reproduce:\n\nWhile TB-v6.0.2 was running, unplugged from network (WIFI physically switched off) and started running off battery (not using or looking at TB). I have a win7-x64 laptop. \n\n\nActual results:\n\nTB constantly uses a small amount of CPU (5-10%), burning battery directly and preventing Windows from idling the CPU (which burns even more power indirectly).\n\n\nExpected results:\n\nTB CPU usage should be 0.0% when in background with no network access.", "tags": [], "count": 0, "id": 5715676, "is_private": false, "creation_time": "2011-09-13T17:45:25Z", "time": "2011-09-13T17:45:25Z", "creator": "scovich@gmail.com", "author": "scovich@gmail.com"}, {"bug_id": 686495, "text": "Is 'Work Offline' checked in the File menu when this happens (which indicates that Thunderbird notices that there's no network connection at all) ? And what happens if you check it manually ?", "tags": [], "attachment_id": null, "raw_text": "Is 'Work Offline' checked in the File menu when this happens (which indicates that Thunderbird notices that there's no network connection at all) ? And what happens if you check it manually ?", "creator": "jo.hermans@gmail.com", "time": "2011-09-13T21:26:26Z", "creation_time": "2011-09-13T21:26:26Z", "author": "jo.hermans@gmail.com", "is_private": false, "count": 1, "id": 5716017}, {"tags": [], "bug_id": 686495, "text": "(In reply to Jo Hermans from comment #1)\n> Is 'Work Offline' checked in the File menu when this happens (which\n> indicates that Thunderbird notices that there's no network connection at\n> all) ? And what happens if you check it manually ?\n\nInteresting. I had assumed it was working offline because it always offers to send outbound messages when I plug back in. However, the icon bottom-left indeed indicates *online* and going offline manually seems to fix the problem. \n\nThat begs the question, then... why does TB need so much CPU when idling in online mode? At any given time it should be (a) checking for and/or downloading messages (some CPU understandable, though not nearly as much as it seems to use), (b) waiting for a connection timeout (should use no CPU) or (c) truly idle (again, no CPU). Given that no messages are arriving over my online-but-physically-disconnected network, that leaves only (b) or (c).", "raw_text": "(In reply to Jo Hermans from comment #1)\n> Is 'Work Offline' checked in the File menu when this happens (which\n> indicates that Thunderbird notices that there's no network connection at\n> all) ? And what happens if you check it manually ?\n\nInteresting. I had assumed it was working offline because it always offers to send outbound messages when I plug back in. However, the icon bottom-left indeed indicates *online* and going offline manually seems to fix the problem. \n\nThat begs the question, then... why does TB need so much CPU when idling in online mode? At any given time it should be (a) checking for and/or downloading messages (some CPU understandable, though not nearly as much as it seems to use), (b) waiting for a connection timeout (should use no CPU) or (c) truly idle (again, no CPU). Given that no messages are arriving over my online-but-physically-disconnected network, that leaves only (b) or (c).", "attachment_id": null, "author": "scovich@gmail.com", "creator": "scovich@gmail.com", "creation_time": "2011-09-13T23:59:19Z", "time": "2011-09-13T23:59:19Z", "is_private": false, "id": 5716317, "count": 2}, {"tags": [], "bug_id": 686495, "text": "Ryan are you network drivers up to date ? (we seem to not detect properly that you are offline/online)", "attachment_id": null, "raw_text": "Ryan are you network drivers up to date ? (we seem to not detect properly that you are offline/online)", "creation_time": "2011-10-05T08:02:32Z", "time": "2011-10-05T08:02:32Z", "creator": "ludovic@hirlimann.net", "author": "ludovic@hirlimann.net", "count": 3, "id": 5759652, "is_private": false}, {"author": "scovich@gmail.com", "creation_time": "2011-10-05T12:07:53Z", "time": "2011-10-05T12:07:53Z", "creator": "scovich@gmail.com", "id": 5759923, "count": 4, "is_private": false, "text": "I'm on a ThinkPad and Lenovo's tools at least think I'm up to date. I haven't tried to figure out what wireless card I have to go hunting down a bleeding edge driver from the manufacturer. \n\nAlso, even when officially offline, compacting a folder (which I've set to happen automatically) seems to cause the same sort of long-term dribble of CPU usage. \n\nIn any case, this sidesteps the real issue: why does TB need so much CPU to wait on the network? I suspect the answer lies inside code shared with FF, since it exhibits the same behavior (see comments in bug #683651). Right now TB/FF drain battery faster than running with wireless enabled.", "bug_id": 686495, "tags": [], "raw_text": "I'm on a ThinkPad and Lenovo's tools at least think I'm up to date. I haven't tried to figure out what wireless card I have to go hunting down a bleeding edge driver from the manufacturer. \n\nAlso, even when officially offline, compacting a folder (which I've set to happen automatically) seems to cause the same sort of long-term dribble of CPU usage. \n\nIn any case, this sidesteps the real issue: why does TB need so much CPU to wait on the network? I suspect the answer lies inside code shared with FF, since it exhibits the same behavior (see comments in bug #683651). Right now TB/FF drain battery faster than running with wireless enabled.", "attachment_id": null}, {"is_private": false, "id": 5775888, "count": 5, "author": "vseerror@lehigh.edu", "creator": "vseerror@lehigh.edu", "creation_time": "2011-10-11T21:37:17Z", "time": "2011-10-11T21:37:17Z", "raw_text": "Ryan, \n\nWhat model thinkpad?\n\nDoes this reproduce if you have thunderbird started in safe mode?\n\nAs a variation to comment 0, does it reproduce if you start thunderbird with network enabled, then disable network after startup is complete?\n\nAs for a connection to bug 683651, it's a leap to make a connection without having more symptoms. Especially since, I think, you imply the CPU is high there only while it's actually getting mail. (did I read it correctly?)\n\n----\n\nhere is a list of \"battery\" bugs to give you a flavor (and there are more related bugs that won't mention the word battery) -- https://bugzilla.mozilla.org/buglist.cgi?type1-0-0=substring&list_id=1479360&field0-0-0=short_desc&type0-0-1=substring&field0-0-1=status_whiteboard&type1-0-1=allwordssubstr&resolution=---&resolution=FIXED&resolution=INVALID&resolution=DUPLICATE&value0-0-2=network&classification=Client%20Software&classification=Components&chfieldto=Now&query_format=advanced&chfieldfrom=2009-01-01&field0-0-2=component&longdesc=battery%20batteries&value0-0-1=battery&type0-0-0=anywordssubstr&value0-0-0=batter%20power%20network%20cpu%20processor&field1-0-0=short_desc&type0-0-2=substring&product=Core&product=Firefox&product=MailNews%20Core&product=Thunderbird&product=Toolkit&longdesc_type=anywordssubstr&field1-0-1=short_desc\n\nless expansive list -- https://bugzilla.mozilla.org/buglist.cgi?type1-0-0=substring&list_id=1478830&field0-0-0=short_desc&type0-0-1=substring&field0-0-1=status_whiteboard&type1-0-1=allwordssubstr&resolution=---&classification=Client%20Software&classification=Components&query_format=advanced&value0-0-1=battery&type0-0-0=anywordssubstr&value0-0-0=batter&field1-0-0=short_desc&product=Core&product=Firefox&product=MailNews%20Core&product=Thunderbird&field1-0-1=short_desc", "attachment_id": null, "tags": [], "bug_id": 686495, "text": "Ryan, \n\nWhat model thinkpad?\n\nDoes this reproduce if you have thunderbird started in safe mode?\n\nAs a variation to comment 0, does it reproduce if you start thunderbird with network enabled, then disable network after startup is complete?\n\nAs for a connection to bug 683651, it's a leap to make a connection without having more symptoms. Especially since, I think, you imply the CPU is high there only while it's actually getting mail. (did I read it correctly?)\n\n----\n\nhere is a list of \"battery\" bugs to give you a flavor (and there are more related bugs that won't mention the word battery) -- https://bugzilla.mozilla.org/buglist.cgi?type1-0-0=substring&list_id=1479360&field0-0-0=short_desc&type0-0-1=substring&field0-0-1=status_whiteboard&type1-0-1=allwordssubstr&resolution=---&resolution=FIXED&resolution=INVALID&resolution=DUPLICATE&value0-0-2=network&classification=Client%20Software&classification=Components&chfieldto=Now&query_format=advanced&chfieldfrom=2009-01-01&field0-0-2=component&longdesc=battery%20batteries&value0-0-1=battery&type0-0-0=anywordssubstr&value0-0-0=batter%20power%20network%20cpu%20processor&field1-0-0=short_desc&type0-0-2=substring&product=Core&product=Firefox&product=MailNews%20Core&product=Thunderbird&product=Toolkit&longdesc_type=anywordssubstr&field1-0-1=short_desc\n\nless expansive list -- https://bugzilla.mozilla.org/buglist.cgi?type1-0-0=substring&list_id=1478830&field0-0-0=short_desc&type0-0-1=substring&field0-0-1=status_whiteboard&type1-0-1=allwordssubstr&resolution=---&classification=Client%20Software&classification=Components&query_format=advanced&value0-0-1=battery&type0-0-0=anywordssubstr&value0-0-0=batter&field1-0-0=short_desc&product=Core&product=Firefox&product=MailNews%20Core&product=Thunderbird&field1-0-1=short_desc"}, {"attachment_id": null, "is_private": false, "count": 6, "id": 5776079, "raw_text": "(In reply to Wayne Mery (:wsmwk) from comment #5)\n>\n> What model thinkpad?\nT410s\n\n>\n> Does this reproduce if you have thunderbird started in safe mode?\nYes.\n\n> \n> As a variation to comment 0, does it reproduce if you start thunderbird with\n> network enabled, then disable network after startup is complete?\nYes. In fact, that's my normal usage pattern: fire up TB, download emails to read on the commute, go offline, notice battery draining fast...\n\nAs a more precise use case: \n1. Start TB in safe mode\n2. Wait until everything loads and settles down\n3. Physically switch off wireless\n4. Click on a folder in a different account\n\nThis time the connection timed out after about 30 seconds, with CPU sitting at 8-10% the entire time. Sometimes it times out faster (or the CPU stops, at least), but usually it still hasn't given up after 30 minutes. Manually sending TB offline drops the CPU a lot but leaves dwm.exe busy. \n\n> \n> As for a connection to bug 683651, it's a leap to make a connection without\n> having more symptoms. Especially since, I think, you imply the CPU is high\n> there only while it's actually getting mail. (did I read it correctly?)\nNow that I've been paying close attention to the CPU meter whenever on battery, I've identified several problems; I think the first two are related. \n\n1. a broken/timeout connection potentially sucks up CPU forever (this bug)\n2. slow connections suck up CPU until the download completes (bug 683651)\n3. often, keypresses register *very* slowly (300-700ms each) when composing an email in should-be-offline-mode.\n4. even in offline mode, TB and FF both cause non-negligible activity in dwm.exe (not previously reported by me, but Mac users seem to see a similar issue, e.g. bugs 682693 and 254884)\n\nOverall, waiting on network seems to consume considerable CPU regardless of bytes transferred. Based on the above, I came to the conclusion that the two bugs are related. I also suspect the CPU spike seen when loading messages over a fast connection is unnecessarily high. \n\nI guess, the times when the connection never times out is probably a different bug, because even if Windows tells TB there's Internet access it should eventually give up and close unresponsive connections. Minor by itself, but a real problem if those unresponsive connections burn battery in the meantime.", "creator": "scovich@gmail.com", "creation_time": "2011-10-11T22:39:01Z", "time": "2011-10-11T22:39:01Z", "author": "scovich@gmail.com", "tags": [], "text": "(In reply to Wayne Mery (:wsmwk) from comment #5)\n>\n> What model thinkpad?\nT410s\n\n>\n> Does this reproduce if you have thunderbird started in safe mode?\nYes.\n\n> \n> As a variation to comment 0, does it reproduce if you start thunderbird with\n> network enabled, then disable network after startup is complete?\nYes. In fact, that's my normal usage pattern: fire up TB, download emails to read on the commute, go offline, notice battery draining fast...\n\nAs a more precise use case: \n1. Start TB in safe mode\n2. Wait until everything loads and settles down\n3. Physically switch off wireless\n4. Click on a folder in a different account\n\nThis time the connection timed out after about 30 seconds, with CPU sitting at 8-10% the entire time. Sometimes it times out faster (or the CPU stops, at least), but usually it still hasn't given up after 30 minutes. Manually sending TB offline drops the CPU a lot but leaves dwm.exe busy. \n\n> \n> As for a connection to bug 683651, it's a leap to make a connection without\n> having more symptoms. Especially since, I think, you imply the CPU is high\n> there only while it's actually getting mail. (did I read it correctly?)\nNow that I've been paying close attention to the CPU meter whenever on battery, I've identified several problems; I think the first two are related. \n\n1. a broken/timeout connection potentially sucks up CPU forever (this bug)\n2. slow connections suck up CPU until the download completes (bug 683651)\n3. often, keypresses register *very* slowly (300-700ms each) when composing an email in should-be-offline-mode.\n4. even in offline mode, TB and FF both cause non-negligible activity in dwm.exe (not previously reported by me, but Mac users seem to see a similar issue, e.g. bugs 682693 and 254884)\n\nOverall, waiting on network seems to consume considerable CPU regardless of bytes transferred. Based on the above, I came to the conclusion that the two bugs are related. I also suspect the CPU spike seen when loading messages over a fast connection is unnecessarily high. \n\nI guess, the times when the connection never times out is probably a different bug, because even if Windows tells TB there's Internet access it should eventually give up and close unresponsive connections. Minor by itself, but a real problem if those unresponsive connections burn battery in the meantime.", "bug_id": 686495}, {"tags": [], "text": "There are reports of issues like #1 - bug 554898 (unconfirmed as of now).  \n\nIf none of the bugs in [1] match your issue, then I guess it would be useful to have a protocol log showing any activity that might be occurring/attempted after the connection goes down. If you have ONLY imap accounts, please use instructions at https://wiki.mozilla.org/MailNews:Logging and setting of \n imap:5,ImapAutoSync:5,nsHostResolver:5,nsSocketTransport:5,timestamp\n\ntake note of the time (compared to the log entries) when the network connection changed, where cpu changed, etc\n\nyou had indicated safe mode makes no difference. But to be absolutely certain there is no impact from direct2d problems, please first\ndo the following\n- tools | options | advanced | general | config editor\n- paste gfx.direct2d.disabled into filter and change it to \"true\"\n- paste layers.acceleration.disabled preference and change it to \"true\" (create the boolean if necessary with right click)\n- restart Thunderbird \n\n[1] connection performance bugs (does not include core bugs): https://bugzilla.mozilla.org/buglist.cgi?type1-0-0=nowordssubstr&keywords=perf%2C%20&keywords_type=allwords&list_id=1480498&field0-0-0=short_desc&bug_severity=normal&bug_severity=minor&type0-0-1=substring&field0-0-1=status_whiteboard&type1-0-1=allwordssubstr&resolution=---&resolution=FIXED&resolution=INVALID&resolution=DUPLICATE&value0-0-2=network&classification=Client%20Software&classification=Components&chfieldto=Now&query_format=advanced&chfieldfrom=2010-01-01&value1-0-0=news&field0-0-2=component&value0-0-1=battery&type0-0-0=anywordssubstr&value0-0-0=network&component=Backend&component=Database&component=Folder%20and%20Message%20Lists&component=General&component=Networking%3A%20IMAP&component=Networking%3A%20POP&component=Networking%3A%20SMTP&component=Search&field1-0-0=component&type0-0-2=substring&product=MailNews%20Core&product=Thunderbird&field1-0-1=short_desc", "bug_id": 686495, "raw_text": "There are reports of issues like #1 - bug 554898 (unconfirmed as of now).  \n\nIf none of the bugs in [1] match your issue, then I guess it would be useful to have a protocol log showing any activity that might be occurring/attempted after the connection goes down. If you have ONLY imap accounts, please use instructions at https://wiki.mozilla.org/MailNews:Logging and setting of \n imap:5,ImapAutoSync:5,nsHostResolver:5,nsSocketTransport:5,timestamp\n\ntake note of the time (compared to the log entries) when the network connection changed, where cpu changed, etc\n\nyou had indicated safe mode makes no difference. But to be absolutely certain there is no impact from direct2d problems, please first\ndo the following\n- tools | options | advanced | general | config editor\n- paste gfx.direct2d.disabled into filter and change it to \"true\"\n- paste layers.acceleration.disabled preference and change it to \"true\" (create the boolean if necessary with right click)\n- restart Thunderbird \n\n[1] connection performance bugs (does not include core bugs): https://bugzilla.mozilla.org/buglist.cgi?type1-0-0=nowordssubstr&keywords=perf%2C%20&keywords_type=allwords&list_id=1480498&field0-0-0=short_desc&bug_severity=normal&bug_severity=minor&type0-0-1=substring&field0-0-1=status_whiteboard&type1-0-1=allwordssubstr&resolution=---&resolution=FIXED&resolution=INVALID&resolution=DUPLICATE&value0-0-2=network&classification=Client%20Software&classification=Components&chfieldto=Now&query_format=advanced&chfieldfrom=2010-01-01&value1-0-0=news&field0-0-2=component&value0-0-1=battery&type0-0-0=anywordssubstr&value0-0-0=network&component=Backend&component=Database&component=Folder%20and%20Message%20Lists&component=General&component=Networking%3A%20IMAP&component=Networking%3A%20POP&component=Networking%3A%20SMTP&component=Search&field1-0-0=component&type0-0-2=substring&product=MailNews%20Core&product=Thunderbird&field1-0-1=short_desc", "attachment_id": null, "author": "vseerror@lehigh.edu", "creator": "vseerror@lehigh.edu", "time": "2011-10-12T00:43:53Z", "creation_time": "2011-10-12T00:43:53Z", "is_private": false, "id": 5776391, "count": 7}, {"is_private": false, "count": 8, "id": 5777249, "creator": "scovich@gmail.com", "time": "2011-10-12T13:27:06Z", "creation_time": "2011-10-12T13:27:06Z", "author": "scovich@gmail.com", "attachment_id": null, "raw_text": "(In reply to Wayne Mery (:wsmwk) from comment #7)\n> you had indicated safe mode makes no difference. But to be absolutely\n> certain there is no impact from direct2d problems, please first\n> do the following\n> - tools | options | advanced | general | config editor\n> - paste gfx.direct2d.disabled into filter and change it to \"true\"\n> - paste layers.acceleration.disabled preference and change it to \"true\"\n> (create the boolean if necessary with right click)\n> - restart Thunderbird \n\nThis seems to nail #4: Offline, safe mode, with those settings disabled, TB burns essentially zero CPU (task manager reports unchanging accumulated CPU time). If I go online, then TB accumulates 1 cpu-sec every couple of minutes. Normal mode (including a calendar extension), the amounts go up somewhat, but not much.\n\nMeanwhile, I can't say I notice any performance difference. What would I give up by disabling d2d permanently?", "tags": [], "bug_id": 686495, "text": "(In reply to Wayne Mery (:wsmwk) from comment #7)\n> you had indicated safe mode makes no difference. But to be absolutely\n> certain there is no impact from direct2d problems, please first\n> do the following\n> - tools | options | advanced | general | config editor\n> - paste gfx.direct2d.disabled into filter and change it to \"true\"\n> - paste layers.acceleration.disabled preference and change it to \"true\"\n> (create the boolean if necessary with right click)\n> - restart Thunderbird \n\nThis seems to nail #4: Offline, safe mode, with those settings disabled, TB burns essentially zero CPU (task manager reports unchanging accumulated CPU time). If I go online, then TB accumulates 1 cpu-sec every couple of minutes. Normal mode (including a calendar extension), the amounts go up somewhat, but not much.\n\nMeanwhile, I can't say I notice any performance difference. What would I give up by disabling d2d permanently?"}, {"author": "scovich@gmail.com", "time": "2011-10-12T14:07:22Z", "creation_time": "2011-10-12T14:07:22Z", "creator": "scovich@gmail.com", "id": 5777299, "count": 9, "is_private": false, "bug_id": 686495, "text": "(In reply to Wayne Mery (:wsmwk) from comment #7)\n> useful to have a protocol log showing any activity that might be\n> occurring/attempted after the connection goes down. If you have ONLY imap\n> accounts, please use instructions at\n> https://wiki.mozilla.org/MailNews:Logging and setting of \n>  imap:5,ImapAutoSync:5,nsHostResolver:5,nsSocketTransport:5,timestamp\n> \n> take note of the time (compared to the log entries) when the network\n> connection changed, where cpu changed, etc\n\nOK, I fired up TB, killed the wireless in the middle of it looking up servers, and poked around a bit in the trace that resulted during the following minute. \n\nThere are 725 calls to PR_Poll; at first there are six active sockets (strange, I have only four accounts!), but eventually that number drops to zero. The distribution of timeouts is fairly uniform over time, with the following value histogram:\n 11    > 750ms\n 48    350-750ms\n  6    30-350ms\n 42    1-30ms\n618    0ms\n\nMessages seen:\nMSG_TIMEOUT_CHANGED 120\nMSG_ENSURE_CONNECT 111\nMSG_DNS_LOOKUP_COMPLETE 69\n\nSTS poll iter never gets above [1].\n\nFunctions called:\nnsSocketTransport::PostEvent 311\nnsSocketTransport::OnSocketEvent 311\nnsSocketTransport::SendStatus 191\nnsSocketOutputStream::CloseWithStatus 186\nnsSocketInputStream::CloseWithStatus 186\nnsSocketInputStream::Read 146\nnsSocketOutputStream::AsyncWait 129\nnsSocketTransport::OnSocketReady 110\nnsSocketInputStream::OnSocketReady 105\nnsSocketOutputStream::OnSocketReady 89\nnsSocketInputStream::AsyncWait 82\nnsSocketTransportService::RemoveFromPollList 75\nnsSocketTransportService::DetachSocket 75\nnsSocketTransport::RecoverFromError 75\nnsSocketTransport::OnSocketDetached 75\nnsSocketTransportService::RemoveFromIdleList 69\nnsSocketTransportService::AttachSocket 69\nnsSocketTransportService::AddToPollList 69\nnsSocketTransportService::AddToIdleList 69\nnsSocketTransport::InitiateSocket 69\nnsSocketTransport::BuildSocket 69\nnsSocketTransport::ResolveHost 56\nnsSocketTransport::OpenOutputStream 56\nnsSocketTransport::OpenInputStream 56\nnsSocketTransport::Init 56\nnsHostResolver::ResolveHost 56\nnsSocketOutputStream::Write 16\nnsSocketTransport::OnMsgInputClosed 6\n\nIs there anything else in the log that might be useful?", "tags": [], "raw_text": "(In reply to Wayne Mery (:wsmwk) from comment #7)\n> useful to have a protocol log showing any activity that might be\n> occurring/attempted after the connection goes down. If you have ONLY imap\n> accounts, please use instructions at\n> https://wiki.mozilla.org/MailNews:Logging and setting of \n>  imap:5,ImapAutoSync:5,nsHostResolver:5,nsSocketTransport:5,timestamp\n> \n> take note of the time (compared to the log entries) when the network\n> connection changed, where cpu changed, etc\n\nOK, I fired up TB, killed the wireless in the middle of it looking up servers, and poked around a bit in the trace that resulted during the following minute. \n\nThere are 725 calls to PR_Poll; at first there are six active sockets (strange, I have only four accounts!), but eventually that number drops to zero. The distribution of timeouts is fairly uniform over time, with the following value histogram:\n 11    > 750ms\n 48    350-750ms\n  6    30-350ms\n 42    1-30ms\n618    0ms\n\nMessages seen:\nMSG_TIMEOUT_CHANGED 120\nMSG_ENSURE_CONNECT 111\nMSG_DNS_LOOKUP_COMPLETE 69\n\nSTS poll iter never gets above [1].\n\nFunctions called:\nnsSocketTransport::PostEvent 311\nnsSocketTransport::OnSocketEvent 311\nnsSocketTransport::SendStatus 191\nnsSocketOutputStream::CloseWithStatus 186\nnsSocketInputStream::CloseWithStatus 186\nnsSocketInputStream::Read 146\nnsSocketOutputStream::AsyncWait 129\nnsSocketTransport::OnSocketReady 110\nnsSocketInputStream::OnSocketReady 105\nnsSocketOutputStream::OnSocketReady 89\nnsSocketInputStream::AsyncWait 82\nnsSocketTransportService::RemoveFromPollList 75\nnsSocketTransportService::DetachSocket 75\nnsSocketTransport::RecoverFromError 75\nnsSocketTransport::OnSocketDetached 75\nnsSocketTransportService::RemoveFromIdleList 69\nnsSocketTransportService::AttachSocket 69\nnsSocketTransportService::AddToPollList 69\nnsSocketTransportService::AddToIdleList 69\nnsSocketTransport::InitiateSocket 69\nnsSocketTransport::BuildSocket 69\nnsSocketTransport::ResolveHost 56\nnsSocketTransport::OpenOutputStream 56\nnsSocketTransport::OpenInputStream 56\nnsSocketTransport::Init 56\nnsHostResolver::ResolveHost 56\nnsSocketOutputStream::Write 16\nnsSocketTransport::OnMsgInputClosed 6\n\nIs there anything else in the log that might be useful?", "attachment_id": null}, {"tags": [], "text": "Update: I tried again, this time killing wifi during the download of an email with five 3MB photos. CPU usage hovered at 40-50% as usual. Then I parsed the log entries for the minute that followed.\n\nLines of log data parsed: 167k\nActive sockets: 16 (!)\nPR_Poll calls: 4802\nPR_Poll timeout histo: \n      9    > 100ms\n     13    10-100ms\n    472    2-10ms\n    542    1ms\n   3766    0ms\n\nMessages seen:\n   MSG_TIMEOUT_CHANGED 18\n   MSG_ENSURE_CONNECT 4\n   MSG_DNS_LOOKUP_COMPLETE 2\n\nHot functions (others account for only 215 calls):\n    4464    nsSocketInputStream::Read\n    3192    nsSocketTransport::OnSocketReady\n    3181    nsSocketInputStream::OnSocketReady\n    3170    nsSocketInputStream::AsyncWait\n    1304    nsSocketTransport::SendStatus", "bug_id": 686495, "attachment_id": null, "raw_text": "Update: I tried again, this time killing wifi during the download of an email with five 3MB photos. CPU usage hovered at 40-50% as usual. Then I parsed the log entries for the minute that followed.\n\nLines of log data parsed: 167k\nActive sockets: 16 (!)\nPR_Poll calls: 4802\nPR_Poll timeout histo: \n      9    > 100ms\n     13    10-100ms\n    472    2-10ms\n    542    1ms\n   3766    0ms\n\nMessages seen:\n   MSG_TIMEOUT_CHANGED 18\n   MSG_ENSURE_CONNECT 4\n   MSG_DNS_LOOKUP_COMPLETE 2\n\nHot functions (others account for only 215 calls):\n    4464    nsSocketInputStream::Read\n    3192    nsSocketTransport::OnSocketReady\n    3181    nsSocketInputStream::OnSocketReady\n    3170    nsSocketInputStream::AsyncWait\n    1304    nsSocketTransport::SendStatus", "creation_time": "2011-10-12T14:42:31Z", "time": "2011-10-12T14:42:31Z", "creator": "scovich@gmail.com", "author": "scovich@gmail.com", "id": 5777391, "count": 10, "is_private": false}, {"is_private": false, "id": 5999132, "count": 11, "creator": "vseerror@lehigh.edu", "time": "2012-01-22T16:25:23Z", "creation_time": "2012-01-22T16:25:23Z", "author": "vseerror@lehigh.edu", "attachment_id": null, "raw_text": "(In reply to Ryan Johnson from comment #8)\n> Meanwhile, I can't say I notice any performance difference. What would I\n> give up by disabling d2d permanently?\n\nnothing. and in fact as of version 9 d2d/hwa is disabled by default in thunderbird.\n\nmight you bel able to test with the \"daily\" development build?\nftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-central/", "tags": [], "text": "(In reply to Ryan Johnson from comment #8)\n> Meanwhile, I can't say I notice any performance difference. What would I\n> give up by disabling d2d permanently?\n\nnothing. and in fact as of version 9 d2d/hwa is disabled by default in thunderbird.\n\nmight you bel able to test with the \"daily\" development build?\nftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-central/", "bug_id": 686495}, {"id": 6049932, "count": 12, "is_private": false, "author": "scovich@gmail.com", "creation_time": "2012-02-10T14:14:38Z", "time": "2012-02-10T14:14:38Z", "creator": "scovich@gmail.com", "raw_text": "This problem continues unabated with TB 10.0. Please find attached a screenshot showing Thunderbird busily working away while in offline mode. \n\nI'm trying to get debug symbols and xperf profiling up and running, but hopefully this will at least confirm that there is a bug.", "attachment_id": 596032, "text": "Created attachment 596032\nThunderbird trying to use the network in offline mode\n\nThis problem continues unabated with TB 10.0. Please find attached a screenshot showing Thunderbird busily working away while in offline mode. \n\nI'm trying to get debug symbols and xperf profiling up and running, but hopefully this will at least confirm that there is a bug.", "bug_id": 686495, "tags": []}, {"raw_text": "Oh, forgot to add: Task Manager reports 20% utilization of *four* cores, so one CPU is actually 80% utilized by whatever TB is doing.", "attachment_id": null, "tags": [], "bug_id": 686495, "text": "Oh, forgot to add: Task Manager reports 20% utilization of *four* cores, so one CPU is actually 80% utilized by whatever TB is doing.", "is_private": false, "count": 13, "id": 6049938, "author": "scovich@gmail.com", "creator": "scovich@gmail.com", "creation_time": "2012-02-10T14:16:50Z", "time": "2012-02-10T14:16:50Z"}, {"author": "scovich@gmail.com", "time": "2012-02-10T21:04:53Z", "creation_time": "2012-02-10T21:04:53Z", "creator": "scovich@gmail.com", "id": 6051602, "count": 14, "is_private": false, "tags": [], "text": "Profiler results are now in. More than 75% of samples are due to obviously graphics-related functions like:\nxul.dll!nsBoxFrame::BuildDisplayList\nxul.dll!_moz_cairo_fill_preserve\nxul.dll!nsDisplayList::ComputeVisibilityForSublist\nxul.dll!nsIFrame::BuildDisplayListForChild\nxul.dll!nsStyleContext::DoGetStyleDisplay\nxul.dll!nsRuleNode::GetParentDisplay\nxul.dll!pixman_blt_sse2\nxul.dll!nsRuleNode::GetStyleDisplay\nxul.dll!nsWindow::OnPaint\nxul.dll!nsRect::ScaleToNearestPixels\nxul.dll!nsViewManager::UpdateWidgetArea\nxul.dll!mozilla::gfx::BaseRect<int;nsRect;nsPoint;nsSize;nsMargin>::Intersect\nxul.dll!pixman_fill_sse2\n\nThe remaining functions are mostly memory management, nsAttribute-related, or other generic helpers that are probably called by graphics functions...\n\nIn the syscall department we have:\nwin32k.sys!NtUserBeginPaint\nwin32k.sys!hbmSelectBitmap\n\nThat's one expensive spinning circle...", "bug_id": 686495, "raw_text": "Profiler results are now in. More than 75% of samples are due to obviously graphics-related functions like:\nxul.dll!nsBoxFrame::BuildDisplayList\nxul.dll!_moz_cairo_fill_preserve\nxul.dll!nsDisplayList::ComputeVisibilityForSublist\nxul.dll!nsIFrame::BuildDisplayListForChild\nxul.dll!nsStyleContext::DoGetStyleDisplay\nxul.dll!nsRuleNode::GetParentDisplay\nxul.dll!pixman_blt_sse2\nxul.dll!nsRuleNode::GetStyleDisplay\nxul.dll!nsWindow::OnPaint\nxul.dll!nsRect::ScaleToNearestPixels\nxul.dll!nsViewManager::UpdateWidgetArea\nxul.dll!mozilla::gfx::BaseRect<int;nsRect;nsPoint;nsSize;nsMargin>::Intersect\nxul.dll!pixman_fill_sse2\n\nThe remaining functions are mostly memory management, nsAttribute-related, or other generic helpers that are probably called by graphics functions...\n\nIn the syscall department we have:\nwin32k.sys!NtUserBeginPaint\nwin32k.sys!hbmSelectBitmap\n\nThat's one expensive spinning circle...", "attachment_id": null}, {"attachment_id": null, "raw_text": "can you try the \"daily\" (development) build ?\nfrom ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-central/\n\nit's generally stable, but you should backup your profile first", "bug_id": 686495, "text": "can you try the \"daily\" (development) build ?\nfrom ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-central/\n\nit's generally stable, but you should backup your profile first", "tags": [], "id": 6156432, "count": 15, "is_private": false, "creation_time": "2012-03-20T19:42:55Z", "time": "2012-03-20T19:42:55Z", "creator": "vseerror@lehigh.edu", "author": "vseerror@lehigh.edu"}, {"attachment_id": null, "raw_text": "(In reply to Wayne Mery (:wsmwk) from comment #15)\n> can you try the \"daily\" (development) build ?\n> from\n> ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-\n> central/\n> \n> it's generally stable, but you should backup your profile first\n\nRyan ?", "text": "(In reply to Wayne Mery (:wsmwk) from comment #15)\n> can you try the \"daily\" (development) build ?\n> from\n> ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-\n> central/\n> \n> it's generally stable, but you should backup your profile first\n\nRyan ?", "bug_id": 686495, "tags": [], "is_private": false, "id": 6315174, "count": 16, "creator": "vseerror@lehigh.edu", "time": "2012-05-17T11:11:33Z", "creation_time": "2012-05-17T11:11:33Z", "author": "vseerror@lehigh.edu"}, {"raw_text": "(In reply to Wayne Mery (:wsmwk) from comment #16)\n> (In reply to Wayne Mery (:wsmwk) from comment #15)\n> > can you try the \"daily\" (development) build ?\n> > from\n> > ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-\n> > central/\n> > \n> > it's generally stable, but you should backup your profile first\n> \n> Ryan ?\n\nSorry, Teh Busy hit and I haven't had a chance to try this out. Is it still the dev build, or is there some beta I should now try?", "attachment_id": null, "text": "(In reply to Wayne Mery (:wsmwk) from comment #16)\n> (In reply to Wayne Mery (:wsmwk) from comment #15)\n> > can you try the \"daily\" (development) build ?\n> > from\n> > ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-\n> > central/\n> > \n> > it's generally stable, but you should backup your profile first\n> \n> Ryan ?\n\nSorry, Teh Busy hit and I haven't had a chance to try this out. Is it still the dev build, or is there some beta I should now try?", "bug_id": 686495, "tags": [], "is_private": false, "count": 17, "id": 6318849, "author": "scovich@gmail.com", "creator": "scovich@gmail.com", "creation_time": "2012-05-18T14:18:15Z", "time": "2012-05-18T14:18:15Z"}, {"creation_time": "2012-05-18T17:00:48Z", "time": "2012-05-18T17:00:48Z", "creator": "vseerror@lehigh.edu", "author": "vseerror@lehigh.edu", "count": 18, "id": 6319320, "is_private": false, "tags": [], "text": "> Is it still the dev build, or is there some beta I should now try?\nI forget why I suggested you try it - so I think just go for ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-central/", "bug_id": 686495, "attachment_id": null, "raw_text": "> Is it still the dev build, or is there some beta I should now try?\nI forget why I suggested you try it - so I think just go for ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-central/"}, {"attachment_id": null, "raw_text": "(In reply to Wayne Mery (:wsmwk) from comment #18)\n> > Is it still the dev build, or is there some beta I should now try?\n> I forget why I suggested you try it - so I think just go for\n> ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-\n> central/\n\nThe only difference I can tell with Daily is that the idle CPU util is slightly lower (which is good), and that it takes the laptop 30-60s to suspend when Daily is running (which is bad). CPU util while attempting to use nonexistent network connections remains the same.", "tags": [], "bug_id": 686495, "text": "(In reply to Wayne Mery (:wsmwk) from comment #18)\n> > Is it still the dev build, or is there some beta I should now try?\n> I forget why I suggested you try it - so I think just go for\n> ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-comm-\n> central/\n\nThe only difference I can tell with Daily is that the idle CPU util is slightly lower (which is good), and that it takes the laptop 30-60s to suspend when Daily is running (which is bad). CPU util while attempting to use nonexistent network connections remains the same.", "id": 6346775, "count": 19, "is_private": false, "time": "2012-05-29T22:29:55Z", "creation_time": "2012-05-29T22:29:55Z", "creator": "scovich@gmail.com", "author": "scovich@gmail.com"}, {"raw_text": "As requested, the profile data for Daily while it attempts to connect with no network connection available.", "attachment_id": 628170, "tags": [], "text": "Created attachment 628170\nCompressed plain-text xperf profile data for Daily and DWM\n\nAs requested, the profile data for Daily while it attempts to connect with no network connection available.", "bug_id": 686495, "is_private": false, "count": 20, "id": 6347210, "author": "scovich@gmail.com", "creator": "scovich@gmail.com", "time": "2012-05-30T00:59:58Z", "creation_time": "2012-05-30T00:59:58Z"}, {"bug_id": 686495, "text": "Created attachment 628171\nScreenshot (incl. system tray, task manager) of Daily hogging CPU\n\nHere's a screenshot of Daily hogging CPU at the time I profiled it. Note that nearly two full CPU are busy, half that systime. To be fair, I had clicked on each of my accounts several times to make sure the profiler had plenty to chew on, but this is a recurring problem (I've taken to closing TB before suspending, because it does this on wakeup even if network *is* available).", "tags": [], "attachment_id": 628171, "raw_text": "Here's a screenshot of Daily hogging CPU at the time I profiled it. Note that nearly two full CPU are busy, half that systime. To be fair, I had clicked on each of my accounts several times to make sure the profiler had plenty to chew on, but this is a recurring problem (I've taken to closing TB before suspending, because it does this on wakeup even if network *is* available).", "creator": "scovich@gmail.com", "time": "2012-05-30T01:03:32Z", "creation_time": "2012-05-30T01:03:32Z", "author": "scovich@gmail.com", "is_private": false, "id": 6347217, "count": 21}, {"tags": [], "bug_id": 686495, "text": "(In reply to Ludovic Hirlimann [:Usul] from comment #3)\n> Ryan are you network drivers up to date ? (we seem to not detect properly\n> that you are offline/online)\n\nI just figured this one out: TB correctly notices that I'm offline when *all* network adapters are offline/disconnected. Problem is, I have several virtual adapters (two for VMWare, e.g.) that are always connected but never provide an internet connection.\n\nIs there a way to make TB check explicitly for an Internet connection, rather than assuming there's internet access whenever any adapter is connected?", "raw_text": "(In reply to Ludovic Hirlimann [:Usul] from comment #3)\n> Ryan are you network drivers up to date ? (we seem to not detect properly\n> that you are offline/online)\n\nI just figured this one out: TB correctly notices that I'm offline when *all* network adapters are offline/disconnected. Problem is, I have several virtual adapters (two for VMWare, e.g.) that are always connected but never provide an internet connection.\n\nIs there a way to make TB check explicitly for an Internet connection, rather than assuming there's internet access whenever any adapter is connected?", "attachment_id": null, "author": "scovich@gmail.com", "creation_time": "2012-09-07T18:55:32Z", "time": "2012-09-07T18:55:32Z", "creator": "scovich@gmail.com", "count": 22, "id": 6618744, "is_private": false}, {"id": 6628252, "count": 23, "is_private": false, "time": "2012-09-12T09:37:37Z", "creation_time": "2012-09-12T09:37:37Z", "creator": "ludovic@hirlimann.net", "author": "ludovic@hirlimann.net", "attachment_id": null, "raw_text": "Not that I know of.", "tags": [], "bug_id": 686495, "text": "Not that I know of."}, {"is_private": false, "count": 24, "id": 9222444, "creator": "vseerror@lehigh.edu", "creation_time": "2014-08-24T16:31:00Z", "time": "2014-08-24T16:31:00Z", "author": "vseerror@lehigh.edu", "attachment_id": null, "raw_text": "Ryan, can you instrument this using the modern Gecko profiler?\n\nDownload https://github.com/bgirard/Gecko-Profiler-Addon/blob/master/geckoprofiler.xpi?raw=true \n\nInstall as addon to thunderbird, in bottom right status bar click \"disabled\", do the test work for a minute, then click \"dump profile\", wait for profile to build, click \"upload\" on the left, get the URL.", "tags": [], "text": "Ryan, can you instrument this using the modern Gecko profiler?\n\nDownload https://github.com/bgirard/Gecko-Profiler-Addon/blob/master/geckoprofiler.xpi?raw=true \n\nInstall as addon to thunderbird, in bottom right status bar click \"disabled\", do the test work for a minute, then click \"dump profile\", wait for profile to build, click \"upload\" on the left, get the URL.", "bug_id": 686495}, {"raw_text": "Removing myslef on all the bugs I'm cced on. Please NI me if you need something on MailNews Core bugs from me.", "count": 25, "id": 10776140, "attachment_id": null, "is_private": false, "tags": [], "bug_id": 686495, "text": "Removing myslef on all the bugs I'm cced on. Please NI me if you need something on MailNews Core bugs from me.", "author": "ludovic@hirlimann.net", "creation_time": "2015-09-25T12:47:18Z", "time": "2015-09-25T12:47:18Z", "creator": "ludovic@hirlimann.net"}]}}}