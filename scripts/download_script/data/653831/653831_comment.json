{"comments": {}, "bugs": {"653831": {"comments": [{"creator": "limi@mozilla.com", "raw_text": "(This is related to bug 522375 & bug 561148)\n\nWe currently measure startup time, but we have also had pretty significant shutdown time issues in the past, and while we think most of these have been resolved, we don't have data on how long this actually takes in the wild. It seems like we should track this in a similar way to tracking startup time, since it contributes to Firefox feeling slow/sluggish.\n\nIn bug 561148, Marco said: \"I suppose one could time from the first shutdown notification to the last bit of the program, we could probably file a bug to track these times.\"\n\nThis is that bug. Implementation left as an exercise to the reader. :P\n\nPS: Couldn't find a bug on this if there is one already.\nPPS: I copied the CC list from the startup time bug, I realize that might not be the same set of people interested in this, but I assumed it was better than an empty list.", "text": "(This is related to bug 522375 & bug 561148)\n\nWe currently measure startup time, but we have also had pretty significant shutdown time issues in the past, and while we think most of these have been resolved, we don't have data on how long this actually takes in the wild. It seems like we should track this in a similar way to tracking startup time, since it contributes to Firefox feeling slow/sluggish.\n\nIn bug 561148, Marco said: \"I suppose one could time from the first shutdown notification to the last bit of the program, we could probably file a bug to track these times.\"\n\nThis is that bug. Implementation left as an exercise to the reader. :P\n\nPS: Couldn't find a bug on this if there is one already.\nPPS: I copied the CC list from the startup time bug, I realize that might not be the same set of people interested in this, but I assumed it was better than an empty list.", "count": 0, "time": "2011-04-29T21:22:23Z", "attachment_id": null, "creation_time": "2011-04-29T21:22:23Z", "tags": [], "bug_id": 653831, "author": "limi@mozilla.com", "is_private": false, "id": 5440476}, {"id": 5442510, "author": "hzbz@pm.me", "time": "2011-05-02T09:44:28Z", "count": 1, "is_private": false, "text": "Cc'ing Alice, who wrote the tshutdown tests (iirc).", "bug_id": 653831, "raw_text": "Cc'ing Alice, who wrote the tshutdown tests (iirc).", "creator": "hzbz@pm.me", "tags": [], "creation_time": "2011-05-02T09:44:28Z", "attachment_id": null}, {"bug_id": 653831, "text": "The current measurement that we collect for shutdown time is pretty simple.  The browser is opened on a blocking system call which the talos process then waits on.  When a test is complete the browser drops a timestamp using a javascript dump and then closes itself.  Immediately upon the talos wait() completing we take a second timestamp.  Comparing the one from the browser to the one from talos we have the shutdown time.\n\nThe advantages of this metric are that we go by when the process is actually no longer around.  This stops the case where you may think that the process has shut down but it is still working in the background.", "creation_time": "2011-05-02T16:13:01Z", "tags": [], "attachment_id": null, "raw_text": "The current measurement that we collect for shutdown time is pretty simple.  The browser is opened on a blocking system call which the talos process then waits on.  When a test is complete the browser drops a timestamp using a javascript dump and then closes itself.  Immediately upon the talos wait() completing we take a second timestamp.  Comparing the one from the browser to the one from talos we have the shutdown time.\n\nThe advantages of this metric are that we go by when the process is actually no longer around.  This stops the case where you may think that the process has shut down but it is still working in the background.", "creator": "anodelman@mozilla.com", "id": 5443197, "is_private": false, "author": "anodelman@mozilla.com", "time": "2011-05-02T16:13:01Z", "count": 2}, {"creation_time": "2011-05-02T16:17:22Z", "tags": [], "attachment_id": null, "raw_text": "Note that with bug 552864, this could be made built-in more easily.", "creator": "mh+mozilla@glandium.org", "bug_id": 653831, "text": "Note that with bug 552864, this could be made built-in more easily.", "is_private": false, "time": "2011-05-02T16:17:22Z", "author": "mh+mozilla@glandium.org", "count": 3, "id": 5443215}, {"creator": "taras.mozilla@glek.net", "raw_text": "I posted a naive patch in 666707. This patch tackles time to shutdown, but it can also be extended to report a boolean on whether the browser exited normally like 666707.\n\n\nMike what was your suggestion?", "attachment_id": 541870, "tags": [], "creation_time": "2011-06-25T00:33:46Z", "text": "Created attachment 541870\nproof of concept\n\nI posted a naive patch in 666707. This patch tackles time to shutdown, but it can also be extended to report a boolean on whether the browser exited normally like 666707.\n\n\nMike what was your suggestion?", "bug_id": 653831, "count": 4, "author": "taras.mozilla@glek.net", "time": "2011-06-25T00:33:46Z", "is_private": false, "id": 5555515}, {"attachment_id": null, "tags": [], "creation_time": "2011-06-27T06:04:06Z", "creator": "mh+mozilla@glandium.org", "raw_text": "I was more thinking of actually measuring the end of the shutdown in main(), after we shutdown XPCOM. The problem is that this can't be tracked with telemetry, then, but anything that measures a significant part of the shutdown will have this problem...", "bug_id": 653831, "text": "I was more thinking of actually measuring the end of the shutdown in main(), after we shutdown XPCOM. The problem is that this can't be tracked with telemetry, then, but anything that measures a significant part of the shutdown will have this problem...", "is_private": false, "count": 5, "author": "mh+mozilla@glandium.org", "time": "2011-06-27T06:04:06Z", "id": 5558075}, {"is_private": false, "count": 6, "author": "taras.mozilla@glek.net", "time": "2011-06-27T16:16:00Z", "id": 5558835, "attachment_id": null, "tags": [], "creation_time": "2011-06-27T16:16:00Z", "creator": "taras.mozilla@glek.net", "raw_text": "(In reply to comment #5)\n> I was more thinking of actually measuring the end of the shutdown in main(),\n> after we shutdown XPCOM. The problem is that this can't be tracked with\n> telemetry, then, but anything that measures a significant part of the\n> shutdown will have this problem...\n\nWell as this patch shows, you can save that data and telemetry it on the following startup :)\n\nNote, doing it in main() isn't much better since that's still before a bunch of destructors run(and possibly cause a freeze).", "bug_id": 653831, "text": "(In reply to comment #5)\n> I was more thinking of actually measuring the end of the shutdown in main(),\n> after we shutdown XPCOM. The problem is that this can't be tracked with\n> telemetry, then, but anything that measures a significant part of the\n> shutdown will have this problem...\n\nWell as this patch shows, you can save that data and telemetry it on the following startup :)\n\nNote, doing it in main() isn't much better since that's still before a bunch of destructors run(and possibly cause a freeze)."}, {"bug_id": 653831, "text": "(In reply to comment #6)\n> Well as this patch shows, you can save that data and telemetry it on the\n> following startup :)\n> \n> Note, doing it in main() isn't much better since that's still before a bunch\n> of destructors run(and possibly cause a freeze).\n\nAfter bug 552864, destructors that run after shutdown are very much likely to fail at least on linux, because the libraries are unloaded. So there should really be no such thing left.", "attachment_id": null, "tags": [], "creation_time": "2011-06-27T16:58:07Z", "creator": "mh+mozilla@glandium.org", "raw_text": "(In reply to comment #6)\n> Well as this patch shows, you can save that data and telemetry it on the\n> following startup :)\n> \n> Note, doing it in main() isn't much better since that's still before a bunch\n> of destructors run(and possibly cause a freeze).\n\nAfter bug 552864, destructors that run after shutdown are very much likely to fail at least on linux, because the libraries are unloaded. So there should really be no such thing left.", "id": 5558944, "is_private": false, "count": 7, "time": "2011-06-27T16:58:07Z", "author": "mh+mozilla@glandium.org"}, {"bug_id": 653831, "text": "(In reply to comment #7)\n> (In reply to comment #6)\n> > Well as this patch shows, you can save that data and telemetry it on the\n> > following startup :)\n> > \n> > Note, doing it in main() isn't much better since that's still before a bunch\n> > of destructors run(and possibly cause a freeze).\n> \n> After bug 552864, destructors that run after shutdown are very much likely\n> to fail at least on linux, because the libraries are unloaded. So there\n> should really be no such thing left.\n\nThat's true, but I wouldn't rely on that unless we had some telemetry to back that up. Ie if the firefox executable gets linked to some library that has destructors.", "attachment_id": null, "creation_time": "2011-06-27T17:03:59Z", "tags": [], "creator": "taras.mozilla@glek.net", "raw_text": "(In reply to comment #7)\n> (In reply to comment #6)\n> > Well as this patch shows, you can save that data and telemetry it on the\n> > following startup :)\n> > \n> > Note, doing it in main() isn't much better since that's still before a bunch\n> > of destructors run(and possibly cause a freeze).\n> \n> After bug 552864, destructors that run after shutdown are very much likely\n> to fail at least on linux, because the libraries are unloaded. So there\n> should really be no such thing left.\n\nThat's true, but I wouldn't rely on that unless we had some telemetry to back that up. Ie if the firefox executable gets linked to some library that has destructors.", "id": 5558974, "is_private": false, "count": 8, "time": "2011-06-27T17:03:59Z", "author": "taras.mozilla@glek.net"}]}}}