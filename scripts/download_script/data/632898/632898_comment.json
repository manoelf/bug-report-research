{"bugs": {"632898": {"comments": [{"tags": [], "is_private": false, "raw_text": "User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b11) Gecko/20100101 Firefox/4.0b11\nBuild Identifier:               Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b12pre) Gecko/20110209 Firefox/4.0b12pre\n\nI've written a bootstrapped extension using AddonManager.getAddonById to load subscripts, and Services.wm.getEnumerator Services.ww.registerNotification to access and modify current and future browser windows.\nIf, using profile with extension installed, I switch to another browser version (from beta 11 to nightly, or back, which causes Compatibility Checker to launch), the first navigator window doesn't show up in the window enumeration, and the notification is not fired for it, too.\n\nMy bootstrap.js: https://github.com/dgutov/bmreplace/blob/97eb0b742414255f30a01a31c3c0341763da9ebb/bootstrap.js#L114\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Have extension that calls Services.wm.getEnumerator and Services.ww.registerNotification inside AddonManager.getAddonById callback, and modifies somehow each navigator window.\n2. Upgrade or downgrade browser.\n3. Look at the first navigator window.\nActual Results:  \nThe first navigator window on the first startup after upgrade isn't modified by the extension.\n\nExpected Results:  \nAll navigator windows should have the same modifications.\n\nI can reproduce it also with this sample extension:\nhttps://github.com/Mardak/restartless/tree/examples/shiftAllBrowsers\n\nIf I change the startup function to\n\nfunction startup(data, reason) AddonManager.getAddonByID(data.id, function(addon) {\n  // Shift all open and new browser windows\n  watchWindows(shiftBrowser);\n});\n\nthen it also doesn't \"shift\" the first navigator window after upgrade.\n\nWorkaround - wrap getEnumerator and registerNotification calls in another callback in a timer. This helps with the first extension:\n\nfunction startup(data, reason) AddonManager.getAddonByID(data.id, function(addon) {\n  include(addon, \"content/main.js\");\n  include(addon, \"content/bookmarks.js\");\n  icon = addon.getResourceURI(\"content/icon.png\").spec;\n  \n  var timer = Cc[\"@mozilla.org/timer;1\"].createInstance(Ci.nsITimer);\n  timer.initWithCallback({notify: function() {\n    // new windows\n    Services.ww.registerNotification(windowWatcher);\n      \n    // existing windows\n    eachWindow(loadIntoWindow);\n  }}, 0, Ci.nsITimer.TYPE_ONE_SHOT);\n});", "text": "User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b11) Gecko/20100101 Firefox/4.0b11\nBuild Identifier:               Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b12pre) Gecko/20110209 Firefox/4.0b12pre\n\nI've written a bootstrapped extension using AddonManager.getAddonById to load subscripts, and Services.wm.getEnumerator Services.ww.registerNotification to access and modify current and future browser windows.\nIf, using profile with extension installed, I switch to another browser version (from beta 11 to nightly, or back, which causes Compatibility Checker to launch), the first navigator window doesn't show up in the window enumeration, and the notification is not fired for it, too.\n\nMy bootstrap.js: https://github.com/dgutov/bmreplace/blob/97eb0b742414255f30a01a31c3c0341763da9ebb/bootstrap.js#L114\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Have extension that calls Services.wm.getEnumerator and Services.ww.registerNotification inside AddonManager.getAddonById callback, and modifies somehow each navigator window.\n2. Upgrade or downgrade browser.\n3. Look at the first navigator window.\nActual Results:  \nThe first navigator window on the first startup after upgrade isn't modified by the extension.\n\nExpected Results:  \nAll navigator windows should have the same modifications.\n\nI can reproduce it also with this sample extension:\nhttps://github.com/Mardak/restartless/tree/examples/shiftAllBrowsers\n\nIf I change the startup function to\n\nfunction startup(data, reason) AddonManager.getAddonByID(data.id, function(addon) {\n  // Shift all open and new browser windows\n  watchWindows(shiftBrowser);\n});\n\nthen it also doesn't \"shift\" the first navigator window after upgrade.\n\nWorkaround - wrap getEnumerator and registerNotification calls in another callback in a timer. This helps with the first extension:\n\nfunction startup(data, reason) AddonManager.getAddonByID(data.id, function(addon) {\n  include(addon, \"content/main.js\");\n  include(addon, \"content/bookmarks.js\");\n  icon = addon.getResourceURI(\"content/icon.png\").spec;\n  \n  var timer = Cc[\"@mozilla.org/timer;1\"].createInstance(Ci.nsITimer);\n  timer.initWithCallback({notify: function() {\n    // new windows\n    Services.ww.registerNotification(windowWatcher);\n      \n    // existing windows\n    eachWindow(loadIntoWindow);\n  }}, 0, Ci.nsITimer.TYPE_ONE_SHOT);\n});", "id": 5266869, "attachment_id": null, "creation_time": "2011-02-09T18:55:06Z", "time": "2011-02-09T18:55:06Z", "bug_id": 632898, "count": 0, "creator": "dgutov@yandex.ru", "author": "dgutov@yandex.ru"}, {"creator": "bug-husbandry-bot@mozilla.bugs", "author": "bug-husbandry-bot@mozilla.bugs", "bug_id": 632898, "count": 1, "time": "2018-06-29T04:49:49Z", "creation_time": "2018-06-29T04:49:49Z", "text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1472046\n\nMove all DOM bugs that haven\u2019t been updated in more than 3 years and has no one currently assigned to P5.\n\nIf you have questions, please contact :mdaly.", "id": 13436361, "attachment_id": null, "raw_text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1472046\n\nMove all DOM bugs that haven\u2019t been updated in more than 3 years and has no one currently assigned to P5.\n\nIf you have questions, please contact :mdaly.", "tags": [], "is_private": false}]}}, "comments": {}}