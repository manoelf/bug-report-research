{"comments": {}, "bugs": {"696440": {"comments": [{"creation_time": "2011-10-21T18:48:45Z", "raw_text": "Currently, our templates are full of [% PROCESS global/header.html.tmpl %] and [% PROCESS global/footer.html.tmpl %] to include the header and footer of HTML pages. In some cases, this is problematic because what should be displayed in the header is not yet known when header.html.tmpl is called, or calling the header/footer templates depends if the template has already been called or not (e.g. in mass-change where we loop over each bug). To remove some useless code from our templates and to remove some of the hacks introduced in them, we should use the WRAPPER option in Bugzilla::Template->create(). This has no noticeable benefit on performance; this only slightly decreases the number of calls in templates.", "text": "Currently, our templates are full of [% PROCESS global/header.html.tmpl %] and [% PROCESS global/footer.html.tmpl %] to include the header and footer of HTML pages. In some cases, this is problematic because what should be displayed in the header is not yet known when header.html.tmpl is called, or calling the header/footer templates depends if the template has already been called or not (e.g. in mass-change where we loop over each bug). To remove some useless code from our templates and to remove some of the hacks introduced in them, we should use the WRAPPER option in Bugzilla::Template->create(). This has no noticeable benefit on performance; this only slightly decreases the number of calls in templates.", "time": "2011-10-21T18:48:45Z", "attachment_id": null, "is_private": false, "count": 0, "tags": [], "id": 5797422, "bug_id": 696440, "creator": "LpSolit@gmail.com", "author": "LpSolit@gmail.com"}, {"author": "LpSolit@gmail.com", "creator": "LpSolit@gmail.com", "id": 5797464, "count": 1, "is_private": false, "tags": [], "bug_id": 696440, "raw_text": "More info: the wrapper is called last, and can access all variables defined in the already processed templates. So this lets us e.g. set the title and JS + CSS scripts to load in the header very late in the process, right before displaying the page. For non-HTML pages, we just have to pass no_wrapper => 1 to Bugzilla->template and that's it.", "creation_time": "2011-10-21T18:58:59Z", "attachment_id": null, "time": "2011-10-21T18:58:59Z", "text": "More info: the wrapper is called last, and can access all variables defined in the already processed templates. So this lets us e.g. set the title and JS + CSS scripts to load in the header very late in the process, right before displaying the page. For non-HTML pages, we just have to pass no_wrapper => 1 to Bugzilla->template and that's it."}, {"id": 5797527, "tags": [], "is_private": false, "count": 2, "bug_id": 696440, "creation_time": "2011-10-21T19:23:07Z", "raw_text": "Here is a proof of concept. It works with show_bug.cgi and some admin pages + a page or two I played with. I forgot to include global/wrapper.html.tmpl in the patch. It simply contains:\n\n[% PROCESS global/header.html.tmpl %]\n[% content %]\n[% PROCESS global/footer.html.tmpl %]\n\nI suppose that at this point, we could merge both the header and footer templates into a single one, to avoid two useless PROCESS calls.", "author": "LpSolit@gmail.com", "attachment_id": 568736, "time": "2011-10-21T19:23:07Z", "creator": "LpSolit@gmail.com", "text": "Created attachment 568736\nProof of concept, v0.01\n\nHere is a proof of concept. It works with show_bug.cgi and some admin pages + a page or two I played with. I forgot to include global/wrapper.html.tmpl in the patch. It simply contains:\n\n[% PROCESS global/header.html.tmpl %]\n[% content %]\n[% PROCESS global/footer.html.tmpl %]\n\nI suppose that at this point, we could merge both the header and footer templates into a single one, to avoid two useless PROCESS calls."}, {"bug_id": 696440, "count": 3, "is_private": false, "tags": [], "id": 5799229, "text": "Oh, this will not work for process_bug.cgi, which displays the header separately in a separate template.\n\nWe also can't put this into create's WRAPPER, because not all of our pages are HTML.\n\nI do generally like the idea of using WRAPPER where we can, if it makes the templates simpler.", "time": "2011-10-23T08:19:40Z", "attachment_id": null, "creation_time": "2011-10-23T08:19:40Z", "raw_text": "Oh, this will not work for process_bug.cgi, which displays the header separately in a separate template.\n\nWe also can't put this into create's WRAPPER, because not all of our pages are HTML.\n\nI do generally like the idea of using WRAPPER where we can, if it makes the templates simpler.", "creator": "mkanat@bugzilla.org", "author": "mkanat@bugzilla.org"}, {"raw_text": "(In reply to Max Kanat-Alexander from comment #3)\n> Oh, this will not work for process_bug.cgi, which displays the header\n> separately in a separate template.\n\nI already thought about that, same for non-HTML pages. And I think I have a reasonable solution. :) You can enclose the header and banner into\n\n[% UNLESS no_header %]\n  [% PROCESS global/header.html.tmpl %]\n[% END %]\n\n[% content %]\n\n[% UNLESS no_footer %]\n  [% PROCESS global/footer.html.tmpl %]\n[% END %]\n\nDisplaying raw attachments won't be affected as we don't use $template->process at all.", "creation_time": "2011-10-23T10:51:51Z", "time": "2011-10-23T10:51:51Z", "attachment_id": null, "text": "(In reply to Max Kanat-Alexander from comment #3)\n> Oh, this will not work for process_bug.cgi, which displays the header\n> separately in a separate template.\n\nI already thought about that, same for non-HTML pages. And I think I have a reasonable solution. :) You can enclose the header and banner into\n\n[% UNLESS no_header %]\n  [% PROCESS global/header.html.tmpl %]\n[% END %]\n\n[% content %]\n\n[% UNLESS no_footer %]\n  [% PROCESS global/footer.html.tmpl %]\n[% END %]\n\nDisplaying raw attachments won't be affected as we don't use $template->process at all.", "id": 5799297, "tags": [], "is_private": false, "count": 4, "bug_id": 696440, "author": "LpSolit@gmail.com", "creator": "LpSolit@gmail.com"}, {"bug_id": 696440, "count": 5, "is_private": false, "tags": [], "id": 5799352, "text": "I did very good progress on this, so I will do it myself. process_bug.cgi (including mass-change) is working fine now, and even viewing patches in diff mode works great (I had to work around the way PatchReader works, but it appeared it was in fact easy to do).", "creator": "LpSolit@gmail.com", "time": "2011-10-23T13:31:43Z", "attachment_id": null, "author": "LpSolit@gmail.com", "raw_text": "I did very good progress on this, so I will do it myself. process_bug.cgi (including mass-change) is working fine now, and even viewing patches in diff mode works great (I had to work around the way PatchReader works, but it appeared it was in fact easy to do).", "creation_time": "2011-10-23T13:31:43Z"}, {"bug_id": 696440, "tags": [], "is_private": false, "count": 6, "id": 5799809, "text": "(In reply to Fr\u00e9d\u00e9ric Buclin from comment #4)\n> I already thought about that, same for non-HTML pages. And I think I have a\n> reasonable solution. :) You can enclose the header and banner into [snip]\n\n  Sure, that sounds possible! :-) Perhaps we could also analyze the format of the processed template, and not run the wrapper at all if it's not .html?\n\n  If this simplifies all of our templates, that would be pretty awesome.", "attachment_id": null, "time": "2011-10-24T05:32:29Z", "creation_time": "2011-10-24T05:32:29Z", "raw_text": "(In reply to Fr\u00e9d\u00e9ric Buclin from comment #4)\n> I already thought about that, same for non-HTML pages. And I think I have a\n> reasonable solution. :) You can enclose the header and banner into [snip]\n\n  Sure, that sounds possible! :-) Perhaps we could also analyze the format of the processed template, and not run the wrapper at all if it's not .html?\n\n  If this simplifies all of our templates, that would be pretty awesome.", "creator": "mkanat@bugzilla.org", "author": "mkanat@bugzilla.org"}, {"bug_id": 696440, "tags": [], "count": 7, "is_private": false, "id": 6437060, "text": "Created attachment 638196\nWIP, v0.5\n\nThis WIP patch is not complete (global/wrapper.html.tmpl is not included in the patch + it needs more testing), but it shows how the code would look like. It brings very little value (the code cleanup is small, and there is no perf win), and so I stopped working on it a few days after I filed this bug. I'm attaching it here anyway in case someone else wants to finish the work. But it's low priority and I have more important work to do.", "time": "2012-07-01T17:23:54Z", "attachment_id": 638196, "creation_time": "2012-07-01T17:23:54Z", "raw_text": "This WIP patch is not complete (global/wrapper.html.tmpl is not included in the patch + it needs more testing), but it shows how the code would look like. It brings very little value (the code cleanup is small, and there is no perf win), and so I stopped working on it a few days after I filed this bug. I'm attaching it here anyway in case someone else wants to finish the work. But it's low priority and I have more important work to do.", "creator": "LpSolit@gmail.com", "author": "LpSolit@gmail.com"}]}}}