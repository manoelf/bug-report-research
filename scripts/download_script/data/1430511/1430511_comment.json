{"bugs": {"1430511": {"comments": [{"tags": [], "time": "2018-01-15T01:59:24Z", "text": "Created attachment 8942549\nstorexss.png\n\nUser Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0\nBuild ID: 20180103231032\n\nSteps to reproduce:\n\nAdding the following to prefs.js mozilla user profile :\n\nuser_pref(\"app.support.baseURL\", \"\\\"></html:a><html:img src=\\\"nopath.nopath\\\" onerror=\\\"alert('Stored XSS');\\\"></html:img><html:a href=\\\"\");\n\nWill cause an alert dialog box to popup when a user access chrome://browser/content/preferences/in-content/preferences.xul and perform a search with no results.\n\nSince prefs.js can be modified using a low privileged process (runonce key in HKCU registry for example) and that from the JavaScript context one can access the Standard JavaScript code modules, one can turn mozilla into a persistent malware. For example, using the OS.File module it is possible to implement a ransomware.\n\nREMARK : The dialog box do not show up when no results are returned when preferences page is loaded using the about:preferences URI.\n\n\nActual results:\n\nWith the preference app.support.baseURL set to the above value and from chrome://browser/content/preferences/in-content/preferences.xul searching for \"ewwe\" lead to the result shown in the attach storedxss.png\n\n\n\n\nExpected results:\n\nValue of the app.support.baseURL preference should be sanitized before being inserted into the html content at line 307 of chrome://browser/content/preferences/in-content/findInPage.js.", "attachment_id": 8942549, "is_private": false, "author": "francois.lajeunesse.robert@gmail.com", "creation_time": "2018-01-15T01:59:24Z", "id": 12969168, "count": 0, "bug_id": 1430511, "creator": "francois.lajeunesse.robert@gmail.com", "raw_text": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0\nBuild ID: 20180103231032\n\nSteps to reproduce:\n\nAdding the following to prefs.js mozilla user profile :\n\nuser_pref(\"app.support.baseURL\", \"\\\"></html:a><html:img src=\\\"nopath.nopath\\\" onerror=\\\"alert('Stored XSS');\\\"></html:img><html:a href=\\\"\");\n\nWill cause an alert dialog box to popup when a user access chrome://browser/content/preferences/in-content/preferences.xul and perform a search with no results.\n\nSince prefs.js can be modified using a low privileged process (runonce key in HKCU registry for example) and that from the JavaScript context one can access the Standard JavaScript code modules, one can turn mozilla into a persistent malware. For example, using the OS.File module it is possible to implement a ransomware.\n\nREMARK : The dialog box do not show up when no results are returned when preferences page is loaded using the about:preferences URI.\n\n\nActual results:\n\nWith the preference app.support.baseURL set to the above value and from chrome://browser/content/preferences/in-content/preferences.xul searching for \"ewwe\" lead to the result shown in the attach storedxss.png\n\n\n\n\nExpected results:\n\nValue of the app.support.baseURL preference should be sanitized before being inserted into the html content at line 307 of chrome://browser/content/preferences/in-content/findInPage.js."}, {"text": "> REMARK : The dialog box do not show up when no results are returned when preferences page is loaded using the \n> about:preferences URI.\n\nIt's possible to make it work in about:preferences. To do so the erreounous URL must have a valid scheme for example: https://nopath.nopath.", "tags": [], "time": "2018-01-16T02:49:42Z", "author": "francois.lajeunesse.robert@gmail.com", "is_private": false, "attachment_id": null, "creation_time": "2018-01-16T02:49:42Z", "creator": "francois.lajeunesse.robert@gmail.com", "raw_text": "> REMARK : The dialog box do not show up when no results are returned when preferences page is loaded using the \n> about:preferences URI.\n\nIt's possible to make it work in about:preferences. To do so the erreounous URL must have a valid scheme for example: https://nopath.nopath.", "bug_id": 1430511, "id": 12971140, "count": 1}, {"bug_id": 1430511, "is_private": false, "raw_text": "Could someone sec-rate this, please? :-)", "creator": "gijskruitbosch+bugs@gmail.com", "author": "gijskruitbosch+bugs@gmail.com", "count": 2, "attachment_id": null, "id": 12974853, "text": "Could someone sec-rate this, please? :-)", "creation_time": "2018-01-17T00:09:19Z", "time": "2018-01-17T00:09:19Z", "tags": []}, {"creation_time": "2018-01-17T00:09:50Z", "text": "Created attachment 8943076\nPatch v0.1", "time": "2018-01-17T00:09:50Z", "tags": [], "raw_text": "", "author": "gijskruitbosch+bugs@gmail.com", "creator": "gijskruitbosch+bugs@gmail.com", "bug_id": 1430511, "is_private": false, "count": 3, "id": 12974854, "attachment_id": 8943076}, {"tags": [], "time": "2018-01-17T00:11:42Z", "text": "Comment on attachment 8943076\nPatch v0.1\n\n:flod, can you doublecheck this is OK and offer any ideas you might have in terms of how we would deal with uplift? Thanks!", "creation_time": "2018-01-17T00:11:42Z", "id": 12974862, "attachment_id": 8943076, "count": 4, "is_private": false, "bug_id": 1430511, "creator": "gijskruitbosch+bugs@gmail.com", "author": "gijskruitbosch+bugs@gmail.com", "raw_text": ":flod, can you doublecheck this is OK and offer any ideas you might have in terms of how we would deal with uplift? Thanks!"}, {"creation_time": "2018-01-17T03:24:34Z", "bug_id": 1430511, "raw_text": "This is moderate to low, I think. Calling it sec-moderate for now.", "creator": "albill@gmail.com", "count": 5, "id": 12975134, "text": "This is moderate to low, I think. Calling it sec-moderate for now.", "time": "2018-01-17T03:24:34Z", "tags": [], "is_private": false, "author": "albill@gmail.com", "attachment_id": null}, {"is_private": false, "author": "francesco.lodolo@gmail.com", "attachment_id": 8943076, "text": "Comment on attachment 8943076\nPatch v0.1\n\nReview of attachment 8943076:\n-----------------------------------------------------------------\n\nWe can uplift this to 59 without any concern, the r+ is for that (59/60).\n\nUplifting to 58 would be a serious problem though: we're past sign-offs, to update localizations relman would need to manually update sign-off data in Ship It for builds, and repeat it for any dot release. \nRealistically, we would end up with English text in the middle of preferences for all languages, which is not OK.\n\nSo, if we want to fix this for 58, we need a different approach for that version that doesn't involve changing strings. Can we hard-code 'https://support.mozilla.org/1/firefox/%VERSION%/%OS%/%LOCALE%/' instead of reading it from prefs, only for that version?", "time": "2018-01-17T07:36:21Z", "tags": [], "bug_id": 1430511, "raw_text": "Review of attachment 8943076:\n-----------------------------------------------------------------\n\nWe can uplift this to 59 without any concern, the r+ is for that (59/60).\n\nUplifting to 58 would be a serious problem though: we're past sign-offs, to update localizations relman would need to manually update sign-off data in Ship It for builds, and repeat it for any dot release. \nRealistically, we would end up with English text in the middle of preferences for all languages, which is not OK.\n\nSo, if we want to fix this for 58, we need a different approach for that version that doesn't involve changing strings. Can we hard-code 'https://support.mozilla.org/1/firefox/%VERSION%/%OS%/%LOCALE%/' instead of reading it from prefs, only for that version?", "creator": "francesco.lodolo@gmail.com", "count": 6, "id": 12975420, "creation_time": "2018-01-17T07:36:21Z"}, {"bug_id": 1430511, "is_private": false, "raw_text": "(In reply to Francesco Lodolo [:flod] from comment #6)\n> Can we hard-code [url] instead of reading it from prefs, only for that version?\n\nThis isn't a serious enough problem to warrant cramming it into 58 last minute. An attacker who can write into your pref files or profile directory can do a lot more damage than just hoping someone searches for a non-existent preference.", "author": "dveditz@mozilla.com", "creator": "dveditz@mozilla.com", "count": 7, "id": 12976388, "attachment_id": null, "text": "(In reply to Francesco Lodolo [:flod] from comment #6)\n> Can we hard-code [url] instead of reading it from prefs, only for that version?\n\nThis isn't a serious enough problem to warrant cramming it into 58 last minute. An attacker who can write into your pref files or profile directory can do a lot more damage than just hoping someone searches for a non-existent preference.", "creation_time": "2018-01-17T15:11:28Z", "time": "2018-01-17T15:11:28Z", "tags": []}, {"count": 8, "id": 12976444, "bug_id": 1430511, "raw_text": "Review of attachment 8943076:\n-----------------------------------------------------------------\n\nCan you do the same for https://searchfox.org/mozilla-central/source/browser/components/preferences/in-content/preferences.js#543-547 ?", "creator": "jaws@mozilla.com", "creation_time": "2018-01-17T15:24:23Z", "attachment_id": 8943076, "is_private": false, "author": "jaws@mozilla.com", "time": "2018-01-17T15:24:23Z", "tags": [], "text": "Comment on attachment 8943076\nPatch v0.1\n\nReview of attachment 8943076:\n-----------------------------------------------------------------\n\nCan you do the same for https://searchfox.org/mozilla-central/source/browser/components/preferences/in-content/preferences.js#543-547 ?"}, {"count": 9, "id": 12979326, "attachment_id": null, "bug_id": 1430511, "is_private": false, "raw_text": "(In reply to Jared Wein [:jaws] (please needinfo? me) from comment #8)\n> Comment on attachment 8943076\n> Patch v0.1\n> \n> Review of attachment 8943076:\n> -----------------------------------------------------------------\n> \n> Can you do the same for\n> https://searchfox.org/mozilla-central/source/browser/components/preferences/\n> in-content/preferences.js#543-547 ?\n\nPer IRC, split this out to https://bugzilla.mozilla.org/show_bug.cgi?id=1431428 .", "creator": "gijskruitbosch+bugs@gmail.com", "author": "gijskruitbosch+bugs@gmail.com", "time": "2018-01-18T15:24:41Z", "tags": [], "text": "(In reply to Jared Wein [:jaws] (please needinfo? me) from comment #8)\n> Comment on attachment 8943076\n> Patch v0.1\n> \n> Review of attachment 8943076:\n> -----------------------------------------------------------------\n> \n> Can you do the same for\n> https://searchfox.org/mozilla-central/source/browser/components/preferences/\n> in-content/preferences.js#543-547 ?\n\nPer IRC, split this out to https://bugzilla.mozilla.org/show_bug.cgi?id=1431428 .", "creation_time": "2018-01-18T15:24:41Z"}, {"bug_id": 1430511, "is_private": false, "raw_text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/233ed3c7331a\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/8aa90bdddd80", "author": "gijskruitbosch+bugs@gmail.com", "creator": "gijskruitbosch+bugs@gmail.com", "count": 10, "attachment_id": null, "id": 12979510, "text": "https://hg.mozilla.org/integration/mozilla-inbound/rev/233ed3c7331a\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/8aa90bdddd80", "creation_time": "2018-01-18T16:20:33Z", "time": "2018-01-18T16:20:33Z", "tags": []}, {"creator": "aryx.bugmail@gmx-topmail.de", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/233ed3c7331a\nhttps://hg.mozilla.org/mozilla-central/rev/8aa90bdddd80", "bug_id": 1430511, "id": 12980460, "count": 11, "creation_time": "2018-01-18T21:57:31Z", "author": "aryx.bugmail@gmx-topmail.de", "is_private": false, "attachment_id": null, "text": "https://hg.mozilla.org/mozilla-central/rev/233ed3c7331a\nhttps://hg.mozilla.org/mozilla-central/rev/8aa90bdddd80", "tags": [], "time": "2018-01-18T21:57:31Z"}]}}, "comments": {}}