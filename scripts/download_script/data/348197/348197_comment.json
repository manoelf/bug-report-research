{"comments": {}, "bugs": {"348197": {"comments": [{"is_private": false, "creator": "evan.yan@gmail.com", "attachment_id": null, "raw_text": "this bug can be easily reproduced by the steps below.\n\nstepsA:\n1. start orca;\n2. start firefox;\n\nstepsB:\n1. start firefox;\n2. start orca;\n3. select menu->Edit->Preference.\n\nthe error message is:\n\n###!!! ASSERTION: This method currently only supports docshells: 'docShell', file ../../../../mozilla/accessible/src/base/nsAccessNode.cpp, line 513\n###!!! ASSERTION: You can't dereference a NULL nsCOMPtr with operator->().: 'mRawPtr != 0', file ../../../dist/include/xpcom/nsCOMPtr.h, line 849\nSegmentation Fault - core dumped\n\nIt seems a regression introduced by bug 344539", "creation_time": "2006-08-10T12:04:00Z", "time": "2006-08-10T12:04:00Z", "text": "this bug can be easily reproduced by the steps below.\n\nstepsA:\n1. start orca;\n2. start firefox;\n\nstepsB:\n1. start firefox;\n2. start orca;\n3. select menu->Edit->Preference.\n\nthe error message is:\n\n###!!! ASSERTION: This method currently only supports docshells: 'docShell', file ../../../../mozilla/accessible/src/base/nsAccessNode.cpp, line 513\n###!!! ASSERTION: You can't dereference a NULL nsCOMPtr with operator->().: 'mRawPtr != 0', file ../../../dist/include/xpcom/nsCOMPtr.h, line 849\nSegmentation Fault - core dumped\n\nIt seems a regression introduced by bug 344539", "author": "evan.yan@gmail.com", "bug_id": 348197, "tags": [], "id": 2940538, "count": 0}, {"attachment_id": 233069, "creator": "evan.yan@gmail.com", "raw_text": "", "time": "2006-08-10T12:07:07Z", "creation_time": "2006-08-10T12:07:07Z", "is_private": false, "id": 2940539, "count": 1, "text": "Created attachment 233069\ncore dump stack", "author": "evan.yan@gmail.com", "bug_id": 348197, "tags": []}, {"creator": "evan.yan@gmail.com", "attachment_id": 233070, "raw_text": "add null check", "creation_time": "2006-08-10T12:09:50Z", "time": "2006-08-10T12:09:50Z", "is_private": false, "id": 2940543, "count": 2, "text": "Created attachment 233070\npatch\n\nadd null check", "author": "evan.yan@gmail.com", "bug_id": 348197, "tags": []}, {"id": 2940590, "count": 3, "text": "Comment on attachment 233070\npatch\n\nI'm not sure this is still needed after the checkin for bug 347426, but I'll r= it. Please check to see if that checkin already fixes this.", "author": "aaronlev@gmail.com", "bug_id": 348197, "tags": [], "attachment_id": 233070, "creator": "aaronlev@gmail.com", "raw_text": "I'm not sure this is still needed after the checkin for bug 347426, but I'll r= it. Please check to see if that checkin already fixes this.", "time": "2006-08-10T13:35:16Z", "creation_time": "2006-08-10T13:35:16Z", "is_private": false}, {"author": "evan.yan@gmail.com", "text": "(In reply to comment #3)\n> I'm not sure this is still needed after the checkin for bug 347426, but I'll r=\n> it. Please check to see if that checkin already fixes this.\n> \nthe build I worked on was checked out on 2006-08-09, later than the checkin for bug 347426. GetContentDocShell() still return null sometimes, so I think we need the null check.\n", "is_private": false, "tags": [], "bug_id": 348197, "raw_text": "(In reply to comment #3)\n> I'm not sure this is still needed after the checkin for bug 347426, but I'll r=\n> it. Please check to see if that checkin already fixes this.\n> \nthe build I worked on was checked out on 2006-08-09, later than the checkin for bug 347426. GetContentDocShell() still return null sometimes, so I think we need the null check.\n", "creator": "evan.yan@gmail.com", "attachment_id": null, "count": 4, "id": 2940597, "creation_time": "2006-08-10T13:45:32Z", "time": "2006-08-10T13:45:32Z"}, {"author": "aaronlev@gmail.com", "text": "When is sometimes?", "tags": [], "bug_id": 348197, "count": 5, "id": 2940605, "is_private": false, "raw_text": "When is sometimes?", "attachment_id": null, "creator": "aaronlev@gmail.com", "time": "2006-08-10T13:58:05Z", "creation_time": "2006-08-10T13:58:05Z"}, {"is_private": false, "raw_text": "(In reply to comment #5)\n> When is sometimes?\n> \nI debugged under the condition as the bug description, there are two cases that GetContentDocShell() returns null.\none is \"if (State(accessible) & STATE_INVISIBLE)\" get true; the other is \"treeNode->GetChildCount(&subDocuments)\" get zero child.", "attachment_id": null, "creator": "evan.yan@gmail.com", "time": "2006-08-10T14:10:40Z", "creation_time": "2006-08-10T14:10:40Z", "author": "evan.yan@gmail.com", "text": "(In reply to comment #5)\n> When is sometimes?\n> \nI debugged under the condition as the bug description, there are two cases that GetContentDocShell() returns null.\none is \"if (State(accessible) & STATE_INVISIBLE)\" get true; the other is \"treeNode->GetChildCount(&subDocuments)\" get zero child.", "tags": [], "bug_id": 348197, "count": 6, "id": 2940618}, {"author": "aaronlev@gmail.com", "text": "Is it on both trunk and branch, or just one of those?\n\nI want to avoid \"wallpaper\" fixes. That is the name for fixes where we don't understand the root cause of the null pointer. Sometimes if you investigate you find the bug is really bigger and somewhere else.", "is_private": false, "tags": [], "bug_id": 348197, "raw_text": "Is it on both trunk and branch, or just one of those?\n\nI want to avoid \"wallpaper\" fixes. That is the name for fixes where we don't understand the root cause of the null pointer. Sometimes if you investigate you find the bug is really bigger and somewhere else.", "attachment_id": null, "creator": "aaronlev@gmail.com", "count": 7, "time": "2006-08-10T15:13:32Z", "creation_time": "2006-08-10T15:13:32Z", "id": 2940658}, {"text": "It's only on trunk build.\non 1.8 branch, because the patch of bug 346858 didn't get into it, we don't deal with RELATION_EMBEDS in 1.8 branch, so the crash code will never be called.\n\nthe root cause of this bug:\nnsRootAccessible doesn't have content area all the time.\n\nGetContentDocShell() will return null in two cases as follows.\n1. refRelationSetCB() may be called when the Document's state is STATE_INVISIBLE, like when firefox start up.\nit will return null at http://lxr.mozilla.org/seamonkey/source/accessible/src/base/nsRootAccessible.cpp#942\n2. when a dialog like prefPane pop up, the type of the docShell is nsIDocShellTreeItem::typeChrome, and it has no subDocument. nsRootAccessible also has no content area in this condition.\n\nI think it's reasonable for GetContentDocShell() to return null in those conditions, so adding null check in the caller function nsRootAccessible::GetAccessibleRelated() is the right fix.\n\nAaron, how do you think?", "author": "evan.yan@gmail.com", "bug_id": 348197, "is_private": false, "tags": [], "creator": "evan.yan@gmail.com", "attachment_id": null, "raw_text": "It's only on trunk build.\non 1.8 branch, because the patch of bug 346858 didn't get into it, we don't deal with RELATION_EMBEDS in 1.8 branch, so the crash code will never be called.\n\nthe root cause of this bug:\nnsRootAccessible doesn't have content area all the time.\n\nGetContentDocShell() will return null in two cases as follows.\n1. refRelationSetCB() may be called when the Document's state is STATE_INVISIBLE, like when firefox start up.\nit will return null at http://lxr.mozilla.org/seamonkey/source/accessible/src/base/nsRootAccessible.cpp#942\n2. when a dialog like prefPane pop up, the type of the docShell is nsIDocShellTreeItem::typeChrome, and it has no subDocument. nsRootAccessible also has no content area in this condition.\n\nI think it's reasonable for GetContentDocShell() to return null in those conditions, so adding null check in the caller function nsRootAccessible::GetAccessibleRelated() is the right fix.\n\nAaron, how do you think?", "creation_time": "2006-08-14T10:26:47Z", "id": 2943961, "time": "2006-08-14T10:26:47Z", "count": 8}, {"bug_id": 348197, "is_private": false, "tags": [], "text": "Thanks for the explanation. Please add a comment next to the null check and land this fix! :)", "author": "aaronlev@gmail.com", "time": "2006-08-14T14:08:14Z", "id": 2944075, "creation_time": "2006-08-14T14:08:14Z", "count": 9, "attachment_id": null, "creator": "aaronlev@gmail.com", "raw_text": "Thanks for the explanation. Please add a comment next to the null check and land this fix! :)"}]}}}