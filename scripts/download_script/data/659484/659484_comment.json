{"comments": {}, "bugs": {"659484": {"comments": [{"tags": [], "creation_time": "2011-05-24T23:01:18Z", "attachment_id": null, "raw_text": "User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: 3.3a4pre 2011-05-22\n\nGlobal Search is not working - just sits there with hte \"Searching\" message, and the 4 checkboxes for Filters. \n\nI also notice that when I tried to quit that Miramar didn't exit and I had to Force-Quit - when I restarted the same behavior is happening except it is now quitting, just slowly. \n\nError message it generates is below\n\nReproducible: Always\n\nSteps to Reproduce:\n1.Start Miramar \n2.Search - enter any text\n\n\n\n\nError from the error Console was:\n\nError: [Exception... \"Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIMsgFolder.server]\"  nsresult: \"0x80004005 (NS_ERROR_FAILURE)\"  location: \"JS frame :: resource:///modules/gloda/datamodel.js :: <TOP_LEVEL> :: line 480\"  data: no]\nSource File: resource:///modules/gloda/datastore.js\nLine: 421", "creator": "mitra_lists@mitra.biz", "bug_id": 659484, "text": "User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: 3.3a4pre 2011-05-22\n\nGlobal Search is not working - just sits there with hte \"Searching\" message, and the 4 checkboxes for Filters. \n\nI also notice that when I tried to quit that Miramar didn't exit and I had to Force-Quit - when I restarted the same behavior is happening except it is now quitting, just slowly. \n\nError message it generates is below\n\nReproducible: Always\n\nSteps to Reproduce:\n1.Start Miramar \n2.Search - enter any text\n\n\n\n\nError from the error Console was:\n\nError: [Exception... \"Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIMsgFolder.server]\"  nsresult: \"0x80004005 (NS_ERROR_FAILURE)\"  location: \"JS frame :: resource:///modules/gloda/datamodel.js :: <TOP_LEVEL> :: line 480\"  data: no]\nSource File: resource:///modules/gloda/datastore.js\nLine: 421", "is_private": false, "author": "mitra_lists@mitra.biz", "time": "2011-05-24T23:01:18Z", "count": 0, "id": 5490936}, {"bug_id": 659484, "text": "can you rebuild you gloda db and keep the current one somewhere (in case we want to analyze what's going on) ?", "attachment_id": null, "creation_time": "2011-05-25T11:26:54Z", "tags": [], "creator": "ludovic@hirlimann.net", "raw_text": "can you rebuild you gloda db and keep the current one somewhere (in case we want to analyze what's going on) ?", "id": 5491911, "is_private": false, "count": 1, "author": "ludovic@hirlimann.net", "time": "2011-05-25T11:26:54Z"}, {"creator": "mitra_lists@mitra.biz", "raw_text": "Ludovic\n\nCan you give me instructions (or a link) to how to rebuild the gloda db - and what file I should put aside (I'm unix proficient - just not sure where the file is, or how to do a rebuild).", "attachment_id": null, "creation_time": "2011-05-25T15:39:55Z", "tags": [], "text": "Ludovic\n\nCan you give me instructions (or a link) to how to rebuild the gloda db - and what file I should put aside (I'm unix proficient - just not sure where the file is, or how to do a rebuild).", "bug_id": 659484, "count": 2, "author": "mitra_lists@mitra.biz", "time": "2011-05-25T15:39:55Z", "is_private": false, "id": 5492342}, {"text": "(In reply to comment #2)\n> Ludovic\n> \n> Can you give me instructions (or a link) to how to rebuild the gloda db -\n> and what file I should put aside (I'm unix proficient - just not sure where\n> the file is, or how to do a rebuild).\n\nstop Thundebird.\nmove global-messages-db* from your profile \nThunderbird will start and reindex and recreate the db.", "bug_id": 659484, "raw_text": "(In reply to comment #2)\n> Ludovic\n> \n> Can you give me instructions (or a link) to how to rebuild the gloda db -\n> and what file I should put aside (I'm unix proficient - just not sure where\n> the file is, or how to do a rebuild).\n\nstop Thundebird.\nmove global-messages-db* from your profile \nThunderbird will start and reindex and recreate the db.", "creator": "ludovic@hirlimann.net", "tags": [], "creation_time": "2011-05-26T09:09:09Z", "attachment_id": null, "id": 5494482, "time": "2011-05-26T09:09:09Z", "author": "ludovic@hirlimann.net", "count": 3, "is_private": false}, {"time": "2011-05-26T20:42:28Z", "count": 4, "text": "Thanks Ludovic, that worked to fix it, and I have the file set aside.\n\nOne interesting thing ... The old file was 1.42Gb, the newly recreated file is 142.9 Mb, i.e. one tenth the size. I don't know if that is significant i.e. whether its a sign of innefficiency in the design or if the large size was a symptom of an error.\n\nOne relevant data point is that I created a new IMAP account (for a server I already had setup as a POP account) and moved a lot of fairly large folders of messages around - some from the POP to the IMAP account and some from POP to local folders.  This process had a lot of problems - folders that failed to copy the first time, folders that wouldn't delete and so on. So there might have been partially completed operations left in some database or other. All in all the process of going from POP to IMAP was an unnecessarily error prone experience.", "raw_text": "Thanks Ludovic, that worked to fix it, and I have the file set aside.\n\nOne interesting thing ... The old file was 1.42Gb, the newly recreated file is 142.9 Mb, i.e. one tenth the size. I don't know if that is significant i.e. whether its a sign of innefficiency in the design or if the large size was a symptom of an error.\n\nOne relevant data point is that I created a new IMAP account (for a server I already had setup as a POP account) and moved a lot of fairly large folders of messages around - some from the POP to the IMAP account and some from POP to local folders.  This process had a lot of problems - folders that failed to copy the first time, folders that wouldn't delete and so on. So there might have been partially completed operations left in some database or other. All in all the process of going from POP to IMAP was an unnecessarily error prone experience.", "creator": "mitra_lists@mitra.biz", "id": 5496112, "author": "mitra_lists@mitra.biz", "is_private": false, "bug_id": 659484, "tags": [], "creation_time": "2011-05-26T20:42:28Z", "attachment_id": null}, {"bug_id": 659484, "attachment_id": null, "creation_time": "2011-05-30T13:36:50Z", "tags": [], "id": 5501402, "author": "ludovic@hirlimann.net", "is_private": false, "text": "So what should we do in order to analyze the corrupted database and try to figure out how it got corrupted ?", "creator": "ludovic@hirlimann.net", "raw_text": "So what should we do in order to analyze the corrupted database and try to figure out how it got corrupted ?", "count": 5, "time": "2011-05-30T13:36:50Z"}, {"is_private": false, "author": "bugmail@asutherland.org", "id": 5501714, "attachment_id": null, "creation_time": "2011-05-30T17:00:50Z", "tags": [], "bug_id": 659484, "count": 6, "time": "2011-05-30T17:00:50Z", "creator": "bugmail@asutherland.org", "raw_text": "This doesn't sound like database corruption proper, although gloda's understanding of the Thunderbird mailstore certainly sounds like it became inaccurate.\n\nThe exception in question indicates that gloda found a message that matched the gloda search, but which gloda believed was resident in a folder that no longer exists.  The accountLabel getter which is used for faceting did not guard against this case, which I would consider a bug on its own.\n\nWhen I hear \"folders that wouldn't delete\", it suggests to me like they may have been deleted outside of Thunderbird, in which case gloda definitely would not receive a notification that they and their contents went away, which could definitely explain the problem.\n\nOptions to generally improve that situation are:\n- Try and notice during the indexing sweep when folders no longer exist.  This could be done by checking the list of known folders/folder URIs against what we actually find in our traversal.  If a folder is gone, perform a synthetic folder deleted notification against ourselves.\n\n- Have the query processing mechanism try and find the nsIMsgFolders for results (since it should be fast) and make sure such messages are not passed to consumers.  This would basically be a fail-safe...", "text": "This doesn't sound like database corruption proper, although gloda's understanding of the Thunderbird mailstore certainly sounds like it became inaccurate.\n\nThe exception in question indicates that gloda found a message that matched the gloda search, but which gloda believed was resident in a folder that no longer exists.  The accountLabel getter which is used for faceting did not guard against this case, which I would consider a bug on its own.\n\nWhen I hear \"folders that wouldn't delete\", it suggests to me like they may have been deleted outside of Thunderbird, in which case gloda definitely would not receive a notification that they and their contents went away, which could definitely explain the problem.\n\nOptions to generally improve that situation are:\n- Try and notice during the indexing sweep when folders no longer exist.  This could be done by checking the list of known folders/folder URIs against what we actually find in our traversal.  If a folder is gone, perform a synthetic folder deleted notification against ourselves.\n\n- Have the query processing mechanism try and find the nsIMsgFolders for results (since it should be fast) and make sure such messages are not passed to consumers.  This would basically be a fail-safe..."}, {"count": 7, "time": "2011-05-30T17:10:13Z", "text": "Andrew - the folders weren't deleted outside TB. \n\nPartly this comes down to the ever present issue of fragility in TB - i.e. its very dependent on nothing getting damaged.   I've had to Force-Quit TB three times today, my fear each time I do this is that something will get irrevocably damaged and that TB won't be able to recover. \n\nWe have lots of other examples of that - like the broken index e.g. Bug #537430 or Bug #647487", "creator": "mitra_lists@mitra.biz", "raw_text": "Andrew - the folders weren't deleted outside TB. \n\nPartly this comes down to the ever present issue of fragility in TB - i.e. its very dependent on nothing getting damaged.   I've had to Force-Quit TB three times today, my fear each time I do this is that something will get irrevocably damaged and that TB won't be able to recover. \n\nWe have lots of other examples of that - like the broken index e.g. Bug #537430 or Bug #647487", "id": 5501726, "is_private": false, "author": "mitra_lists@mitra.biz", "bug_id": 659484, "attachment_id": null, "creation_time": "2011-05-30T17:10:13Z", "tags": []}, {"bug_id": 659484, "text": "(In reply to comment #7)\n> I've had to Force-Quit TB three times today, my fear each time I do this is that something will get\n> irrevocably damaged and that TB won't be able to recover. \n\nIf you are force quitting only because of shutdown hangs or Bug 482811 - Unresponsive script timeout can cause hang - then I don't think you need to worry about folder \"fragility.", "attachment_id": null, "creation_time": "2011-05-30T17:24:15Z", "tags": [], "creator": "vseerror@lehigh.edu", "raw_text": "(In reply to comment #7)\n> I've had to Force-Quit TB three times today, my fear each time I do this is that something will get\n> irrevocably damaged and that TB won't be able to recover. \n\nIf you are force quitting only because of shutdown hangs or Bug 482811 - Unresponsive script timeout can cause hang - then I don't think you need to worry about folder \"fragility.", "id": 5501740, "is_private": false, "count": 8, "time": "2011-05-30T17:24:15Z", "author": "vseerror@lehigh.edu"}, {"count": 9, "time": "2011-08-26T12:34:34Z", "creator": "vseerror@lehigh.edu", "raw_text": "ref http://getsatisfaction.com/mozilla_messaging/topics/search_never_returns_results", "text": "ref http://getsatisfaction.com/mozilla_messaging/topics/search_never_returns_results", "author": "vseerror@lehigh.edu", "is_private": false, "id": 5680357, "attachment_id": null, "tags": [], "creation_time": "2011-08-26T12:34:34Z", "bug_id": 659484}]}}}