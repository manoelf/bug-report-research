{"bugs": {"661995": {"comments": [{"tags": [], "text": "The main event loop in the socket thread uses code that tests recursionDepth to prevent DoPollIteration() from being called recursively out of OnProcessNextEvent().\n\nhttp://mxr.mozilla.org/mozilla2.0/source/netwerk/base/src/nsSocketTransportService2.cpp#541\n\nUnfortunately, it doesn't seem to work in that combination - leading to stack traces like the one seen here: https://bugzilla.mozilla.org/show_bug.cgi?id=654201#c8 \n\nIn that trace you'll see DoPollIteration on the stack 2 times, and OnProcessNextEvent there three times. (The code intends to allow the latter to be there twice and the former to be there just once).\n\nThis issue can be worked around in the socket thread by just keeping a local semaphore instead of relying on recursionDepth.\n\nben turner helped me figure it out and said \n\n> Also, I think this goes to show how fragile it is to run events from\n> the OnProcessNextEvent callback. It's really not designed for this.", "bug_id": 661995, "attachment_id": null, "raw_text": "The main event loop in the socket thread uses code that tests recursionDepth to prevent DoPollIteration() from being called recursively out of OnProcessNextEvent().\n\nhttp://mxr.mozilla.org/mozilla2.0/source/netwerk/base/src/nsSocketTransportService2.cpp#541\n\nUnfortunately, it doesn't seem to work in that combination - leading to stack traces like the one seen here: https://bugzilla.mozilla.org/show_bug.cgi?id=654201#c8 \n\nIn that trace you'll see DoPollIteration on the stack 2 times, and OnProcessNextEvent there three times. (The code intends to allow the latter to be there twice and the former to be there just once).\n\nThis issue can be worked around in the socket thread by just keeping a local semaphore instead of relying on recursionDepth.\n\nben turner helped me figure it out and said \n\n> Also, I think this goes to show how fragile it is to run events from\n> the OnProcessNextEvent callback. It's really not designed for this.", "creator": "mcmanus@ducksong.com", "time": "2011-06-04T02:03:15Z", "creation_time": "2011-06-04T02:03:15Z", "author": "mcmanus@ducksong.com", "is_private": false, "count": 0, "id": 5512894}]}}, "comments": {}}