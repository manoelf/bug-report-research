{"bugs": {"648568": {"comments": [{"is_private": false, "attachment_id": null, "raw_text": "User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0) Gecko/20100101 Firefox/4.0\nBuild Identifier: Mozilla/5.0 (Windows NT 5.1; rv:2.0) Gecko/20100101 Firefox/4.0\n\nIf a page includes an external JavaScript file before an <img> whose src has a non-image content-type, Firefox downloads the <img> src twice. Reproducible in Firefox 3.6 and Firefox 4.\n\nSimple example:\n\n<!DOCTYPE html>\n<html>   \n<head>\n    <script type=\"text/javascript\" src=\"http://yui.yahooapis.com/combo?3.3.0/build/yui/yui-min.js&3.3.0/build/loader/loader-min.js\"></script>\n</head>\n<body>\n    <img src=\"http://www.yahoo.com/\" width=1 height=1 border=0>\n</body>\n</html>\n\nThis also shows the issue:\n\n<!DOCTYPE html>\n<html>   \n<head>\n</head>\n<body>\n    <script type=\"text/javascript\" src=\"http://yui.yahooapis.com/combo?3.3.0/build/yui/yui-min.js&3.3.0/build/loader/loader-min.js\"></script>\n    <img src=\"http://www.yahoo.com/\" width=1 height=1 border=0>\n</body>\n</html>\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Include external JS in a page\n2. Include an <img> with a src set to a non-image\n3. Load page and watch HTTP traffic\nActual Results:  \n<img> src is downloaded twice\n\nExpected Results:  \n<img> src is downloaded once\n\nThis is important because a lot of ad-tracking beacons don't use the image content-type, and this issue can cause double-counting of ads for any page where an external JavaScript is included before the beacon.", "creation_time": "2011-04-08T17:23:54Z", "bug_id": 648568, "creator": "webkit@nczonline.net", "tags": [], "author": "webkit@nczonline.net", "time": "2011-04-08T17:23:54Z", "id": 5396767, "count": 0, "text": "User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0) Gecko/20100101 Firefox/4.0\nBuild Identifier: Mozilla/5.0 (Windows NT 5.1; rv:2.0) Gecko/20100101 Firefox/4.0\n\nIf a page includes an external JavaScript file before an <img> whose src has a non-image content-type, Firefox downloads the <img> src twice. Reproducible in Firefox 3.6 and Firefox 4.\n\nSimple example:\n\n<!DOCTYPE html>\n<html>   \n<head>\n    <script type=\"text/javascript\" src=\"http://yui.yahooapis.com/combo?3.3.0/build/yui/yui-min.js&3.3.0/build/loader/loader-min.js\"></script>\n</head>\n<body>\n    <img src=\"http://www.yahoo.com/\" width=1 height=1 border=0>\n</body>\n</html>\n\nThis also shows the issue:\n\n<!DOCTYPE html>\n<html>   \n<head>\n</head>\n<body>\n    <script type=\"text/javascript\" src=\"http://yui.yahooapis.com/combo?3.3.0/build/yui/yui-min.js&3.3.0/build/loader/loader-min.js\"></script>\n    <img src=\"http://www.yahoo.com/\" width=1 height=1 border=0>\n</body>\n</html>\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Include external JS in a page\n2. Include an <img> with a src set to a non-image\n3. Load page and watch HTTP traffic\nActual Results:  \n<img> src is downloaded twice\n\nExpected Results:  \n<img> src is downloaded once\n\nThis is important because a lot of ad-tracking beacons don't use the image content-type, and this issue can cause double-counting of ads for any page where an external JavaScript is included before the beacon."}, {"attachment_id": null, "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu", "text": "Presumably what happens here is that we kick off the image preload and by the time the real image load starts we've detected that the result is not an image (I assume _that_ is what matters, not the content-type; please correct me if I'm wrong), and killed the preload, so we have to make a new request.\n\nIt might be nice to cache the \"this is not an image\" bit in imagelib (by not dropping the imgRequest from the cache just because it's not an image?).  Would improve performance, I guess.  Joe, what do you think?\n\n> This is important because a lot of ad-tracking beacons don't use the image\n> content-type, and this issue can cause double-counting of ads for any page\n> where an external JavaScript is included before the beacon.\n\nI don't think we should be constrained by that broken setup.  If we think we can get a better browsing experience for our users by making two requests for the image (or none!) we should do just that.", "count": 1, "is_private": false, "tags": [], "bug_id": 648568, "creation_time": "2011-04-08T17:47:40Z", "raw_text": "Presumably what happens here is that we kick off the image preload and by the time the real image load starts we've detected that the result is not an image (I assume _that_ is what matters, not the content-type; please correct me if I'm wrong), and killed the preload, so we have to make a new request.\n\nIt might be nice to cache the \"this is not an image\" bit in imagelib (by not dropping the imgRequest from the cache just because it's not an image?).  Would improve performance, I guess.  Joe, what do you think?\n\n> This is important because a lot of ad-tracking beacons don't use the image\n> content-type, and this issue can cause double-counting of ads for any page\n> where an external JavaScript is included before the beacon.\n\nI don't think we should be constrained by that broken setup.  If we think we can get a better browsing experience for our users by making two requests for the image (or none!) we should do just that.", "id": 5396865, "time": "2011-04-08T17:47:40Z"}, {"attachment_id": null, "is_private": false, "creator": "bzbarsky@mit.edu", "tags": [], "raw_text": "Er, ccing Joe too.  Joe, see comment 1?", "bug_id": 648568, "creation_time": "2011-04-08T17:48:06Z", "id": 5396867, "author": "bzbarsky@mit.edu", "time": "2011-04-08T17:48:06Z", "text": "Er, ccing Joe too.  Joe, see comment 1?", "count": 2}, {"attachment_id": null, "creator": "webkit@nczonline.net", "author": "webkit@nczonline.net", "text": "You could be right. I've seen two scenarios:\n\n1. A response that is missing a content-type and doesn't contain an image\n2. A response that has a non-image content-type and also doesn't contain an image\n\nI've not built out a test to see if an image served with a non-image content-type would cause the issue. \n\nFor some background: the tracking beacons used by ads are frequently included as images in the page because there's no cross-domain restriction. They sometimes return images (1x1 tracking pixels) but don't necessarily always return images since the response isn't necessary to the experience...it's only necessary that the request reaches the server for tracking.", "count": 3, "is_private": false, "raw_text": "You could be right. I've seen two scenarios:\n\n1. A response that is missing a content-type and doesn't contain an image\n2. A response that has a non-image content-type and also doesn't contain an image\n\nI've not built out a test to see if an image served with a non-image content-type would cause the issue. \n\nFor some background: the tracking beacons used by ads are frequently included as images in the page because there's no cross-domain restriction. They sometimes return images (1x1 tracking pixels) but don't necessarily always return images since the response isn't necessary to the experience...it's only necessary that the request reaches the server for tracking.", "bug_id": 648568, "creation_time": "2011-04-08T18:31:10Z", "tags": [], "time": "2011-04-08T18:31:10Z", "id": 5397025}, {"author": "bzbarsky@mit.edu", "count": 4, "text": "> I've not built out a test to see if an image served with a non-image\n> content-type would cause the issue. \n\nOK.  For <img> loads, the Content-Type header is more or less completely ignored, so all that matters is the data that was returned.", "attachment_id": null, "creator": "bzbarsky@mit.edu", "time": "2011-04-08T18:35:51Z", "id": 5397050, "is_private": false, "raw_text": "> I've not built out a test to see if an image served with a non-image\n> content-type would cause the issue. \n\nOK.  For <img> loads, the Content-Type header is more or less completely ignored, so all that matters is the data that was returned.", "creation_time": "2011-04-08T18:35:51Z", "bug_id": 648568, "tags": []}, {"author": "musicisair@yahoo.com", "time": "2011-04-08T18:37:41Z", "id": 5397058, "count": 5, "text": "If the prefetched-(non)image's cache expiration hasn't expired by the time the\nreal <img /> load starts the \"image\" should probably NOT be downloaded again.\nIf it has expired or has no expiration directive the (non)image SHOULD be\nredownloaded; as the contents of the url may have changed in brief interim\nbetween the prefetch and load-start. Right?", "is_private": false, "attachment_id": null, "raw_text": "If the prefetched-(non)image's cache expiration hasn't expired by the time the\nreal <img /> load starts the \"image\" should probably NOT be downloaded again.\nIf it has expired or has no expiration directive the (non)image SHOULD be\nredownloaded; as the contents of the url may have changed in brief interim\nbetween the prefetch and load-start. Right?", "bug_id": 648568, "creation_time": "2011-04-08T18:37:41Z", "creator": "musicisair@yahoo.com", "tags": []}, {"text": "David, once we discover that the data is not an image we close the connection.  So the non-image data never gets cached in its entirety.", "count": 6, "author": "bzbarsky@mit.edu", "creator": "bzbarsky@mit.edu", "attachment_id": null, "time": "2011-04-08T19:37:39Z", "id": 5397221, "raw_text": "David, once we discover that the data is not an image we close the connection.  So the non-image data never gets cached in its entirety.", "creation_time": "2011-04-08T19:37:39Z", "bug_id": 648568, "tags": [], "is_private": false}, {"is_private": false, "tags": [], "creation_time": "2011-04-12T06:04:00Z", "bug_id": 648568, "raw_text": "I think that caching a non-image is just fine, actually! I'm also 100% certain that it will require some changes in the notifications sent by imagelib, because we never assume we're going to keep in-error images around.", "id": 5402927, "time": "2011-04-12T06:04:00Z", "attachment_id": null, "creator": "joe@drew.ca", "author": "joe@drew.ca", "text": "I think that caching a non-image is just fine, actually! I'm also 100% certain that it will require some changes in the notifications sent by imagelib, because we never assume we're going to keep in-error images around.", "count": 7}, {"text": "Hey, guys.  I'm poking you about figuring out what we want to do here.  Maybe nothing is the right answer, but I'd like some forward progress and ownership.  Thanks!", "count": 8, "author": "blizzard@mozilla.com", "creator": "blizzard@mozilla.com", "attachment_id": null, "id": 5496660, "time": "2011-05-27T00:15:34Z", "tags": [], "creation_time": "2011-05-27T00:15:34Z", "bug_id": 648568, "raw_text": "Hey, guys.  I'm poking you about figuring out what we want to do here.  Maybe nothing is the right answer, but I'd like some forward progress and ownership.  Thanks!", "is_private": false}, {"time": "2011-05-27T01:06:13Z", "id": 5496727, "bug_id": 648568, "creation_time": "2011-05-27T01:06:13Z", "raw_text": "There's no figuring out to do.  We need to do what comment 1 suggested and comment 7 agreed with.\n\nAs for ownership... we need someone other than Joe working in imagelib.  Can you make that happen?", "tags": [], "is_private": false, "text": "There's no figuring out to do.  We need to do what comment 1 suggested and comment 7 agreed with.\n\nAs for ownership... we need someone other than Joe working in imagelib.  Can you make that happen?", "count": 9, "author": "bzbarsky@mit.edu", "creator": "bzbarsky@mit.edu", "attachment_id": null}, {"creator": "blizzard@mozilla.com", "attachment_id": null, "count": 10, "text": "Let me see what I can do. :)", "author": "blizzard@mozilla.com", "tags": [], "bug_id": 648568, "creation_time": "2011-05-27T22:38:25Z", "raw_text": "Let me see what I can do. :)", "is_private": false, "id": 5499037, "time": "2011-05-27T22:38:25Z"}, {"time": "2011-06-11T09:14:18Z", "id": 5526543, "creation_time": "2011-06-11T09:14:18Z", "bug_id": 648568, "raw_text": "I'd like to add another variation of this bug:\neven if the image-tag is part of the external javascript, it is loaded twice:\ndocument.write('<img src=\"http://www.yahoo.com\" width=\"1\" height=\"1\">')\n\nBut if the image-tag in the external script is coded this way, it is loaded only once:\ndocument.write(unescape('%3Cscript') + ' type=\"text/javascript\">');\ndocument.write('document.write(\\'<img src=\"http://www.yahoo.com\" width=\"1\" height=\"1\">\\');');\ndocument.write(unescape('%3C%2Fscript>'));", "tags": [], "is_private": false, "text": "I'd like to add another variation of this bug:\neven if the image-tag is part of the external javascript, it is loaded twice:\ndocument.write('<img src=\"http://www.yahoo.com\" width=\"1\" height=\"1\">')\n\nBut if the image-tag in the external script is coded this way, it is loaded only once:\ndocument.write(unescape('%3Cscript') + ' type=\"text/javascript\">');\ndocument.write('document.write(\\'<img src=\"http://www.yahoo.com\" width=\"1\" height=\"1\">\\');');\ndocument.write(unescape('%3C%2Fscript>'));", "count": 11, "author": "mozilla@s351287797.online.de", "creator": "mozilla@s351287797.online.de", "attachment_id": null}, {"author": "mozilla@s351287797.online.de", "count": 12, "text": "and it also happens, if the src-url is a non-image, that redirects to an image (e.g. in those tracking-pixels)", "attachment_id": null, "creator": "mozilla@s351287797.online.de", "time": "2011-06-11T09:18:24Z", "id": 5526545, "is_private": false, "bug_id": 648568, "creation_time": "2011-06-11T09:18:24Z", "raw_text": "and it also happens, if the src-url is a non-image, that redirects to an image (e.g. in those tracking-pixels)", "tags": []}, {"text": "*** Bug 694326 has been marked as a duplicate of this bug. ***", "count": 13, "author": "bzbarsky@mit.edu", "creator": "bzbarsky@mit.edu", "attachment_id": null, "id": 5780779, "time": "2011-10-13T18:40:08Z", "tags": [], "bug_id": 648568, "creation_time": "2011-10-13T18:40:08Z", "raw_text": "", "is_private": false}, {"attachment_id": null, "is_private": false, "creator": "joe@drew.ca", "tags": [], "raw_text": "", "bug_id": 648568, "creation_time": "2012-01-20T22:11:01Z", "id": 5996799, "author": "joe@drew.ca", "time": "2012-01-20T22:11:01Z", "count": 14, "text": "*** Bug 654401 has been marked as a duplicate of this bug. ***"}, {"count": 15, "text": "*** Bug 760826 has been marked as a duplicate of this bug. ***", "author": "bzbarsky@mit.edu", "time": "2012-06-26T15:49:26Z", "id": 6423706, "raw_text": "", "creation_time": "2012-06-26T15:49:26Z", "bug_id": 648568, "creator": "bzbarsky@mit.edu", "tags": [], "is_private": false, "attachment_id": null}]}}, "comments": {}}