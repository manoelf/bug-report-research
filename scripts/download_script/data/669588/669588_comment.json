{"comments": {}, "bugs": {"669588": {"comments": [{"count": 0, "is_private": false, "tags": [], "id": 5576031, "bug_id": 669588, "raw_text": "Another patch I found in my queue.\n\nThe original idea here was to drop nsCStringArray from nsMsgOfflineImapOperation. However I very quickly realised that with all the char*s around it would be better to swap those to ns(A)CString and hence update the interfaces as well.\n\nI went for AUTF8String as although this interface isn't currently used in js, you never know. I think for URIs this is definitely appropriate (see spec attribute on nsIURI), for the keywords I'm not quite sure if we allow them to be UTF8 or not, so I went with UTF8 for now.", "creation_time": "2011-07-06T11:30:30Z", "text": "Created attachment 544192\nThe fix\n\nAnother patch I found in my queue.\n\nThe original idea here was to drop nsCStringArray from nsMsgOfflineImapOperation. However I very quickly realised that with all the char*s around it would be better to swap those to ns(A)CString and hence update the interfaces as well.\n\nI went for AUTF8String as although this interface isn't currently used in js, you never know. I think for URIs this is definitely appropriate (see spec attribute on nsIURI), for the keywords I'm not quite sure if we allow them to be UTF8 or not, so I went with UTF8 for now.", "attachment_id": 544192, "time": "2011-07-06T11:30:30Z", "creator": "standard8@mozilla.com", "author": "standard8@mozilla.com"}, {"id": 5576390, "tags": [], "is_private": false, "count": 1, "bug_id": 669588, "creation_time": "2011-07-06T15:06:25Z", "raw_text": "keywords are imap-mod utf7, not utf8.", "time": "2011-07-06T15:06:25Z", "attachment_id": 544192, "text": "Comment on attachment 544192\nThe fix\n\nkeywords are imap-mod utf7, not utf8.", "author": "mozilla@davidbienvenu.org", "creator": "mozilla@davidbienvenu.org"}, {"time": "2011-07-06T15:42:13Z", "attachment_id": 544192, "text": "Comment on attachment 544192\nThe fix\n\nlooks good, other than the utf8string - I'd rather not have people think the keywords are utf8.", "raw_text": "looks good, other than the utf8string - I'd rather not have people think the keywords are utf8.", "creation_time": "2011-07-06T15:42:13Z", "bug_id": 669588, "id": 5576464, "tags": [], "count": 2, "is_private": false, "author": "mozilla@davidbienvenu.org", "creator": "mozilla@davidbienvenu.org"}, {"raw_text": ">+    PR_LOG(IMAPOffline, PR_LOG_ALWAYS, (\"msg id %x SetDestinationFolderURI to %s\", m_messageKey, nsCString(aDestinationFolderURI).get()));\n>+  m_moveDestination = aDestinationFolderURI;\n>+  return m_mdb->SetProperty(m_mdbRow, PROP_MOVE_DEST_FOLDER_URI, nsCString(aDestinationFolderURI).get());\nPlease use PromiseFlatCString(aDestinationFolderURI).get()\n\n>+  return m_mdb->SetProperty(m_mdbRow, PROP_SRC_FOLDER_URI,\n>+                            nsCString(aSourceFolderURI).get());\nDitto.\n\n>-nsresult nsMsgOfflineImapOperation::AddKeyword(const char *aKeyword, nsCString &addList, const char *addProp,\n>+nsresult nsMsgOfflineImapOperation::AddKeyword(const nsACString &aKeyword, nsCString &addList, const char *addProp,\n>                                                nsCString &removeList, const char *removeProp)\nAddKeyword contains calls to nsDependentCString(aKeyword). Because aKeyword is now an nsACString these should be replaced with PromiseFlatCString. (The fact that it compiles is a bug; I'm waiting for reviews...)", "creation_time": "2011-07-06T20:30:18Z", "attachment_id": 544192, "time": "2011-07-06T20:30:18Z", "text": "Comment on attachment 544192\nThe fix\n\n>+    PR_LOG(IMAPOffline, PR_LOG_ALWAYS, (\"msg id %x SetDestinationFolderURI to %s\", m_messageKey, nsCString(aDestinationFolderURI).get()));\n>+  m_moveDestination = aDestinationFolderURI;\n>+  return m_mdb->SetProperty(m_mdbRow, PROP_MOVE_DEST_FOLDER_URI, nsCString(aDestinationFolderURI).get());\nPlease use PromiseFlatCString(aDestinationFolderURI).get()\n\n>+  return m_mdb->SetProperty(m_mdbRow, PROP_SRC_FOLDER_URI,\n>+                            nsCString(aSourceFolderURI).get());\nDitto.\n\n>-nsresult nsMsgOfflineImapOperation::AddKeyword(const char *aKeyword, nsCString &addList, const char *addProp,\n>+nsresult nsMsgOfflineImapOperation::AddKeyword(const nsACString &aKeyword, nsCString &addList, const char *addProp,\n>                                                nsCString &removeList, const char *removeProp)\nAddKeyword contains calls to nsDependentCString(aKeyword). Because aKeyword is now an nsACString these should be replaced with PromiseFlatCString. (The fact that it compiles is a bug; I'm waiting for reviews...)", "id": 5577247, "count": 3, "is_private": false, "tags": [], "bug_id": 669588, "author": "neil@httl.net", "creator": "neil@httl.net"}, {"bug_id": 669588, "count": 4, "is_private": false, "tags": [], "id": 5577316, "creator": "neil@httl.net", "text": "Comment on attachment 544192\nThe fix\n\n>-    copyDests.Append(curDest->get());\n>+    copyDests.Append(m_copyDestinations[i].get());\nNot sure why this used get() before but it's unnecessary.\n\n> /* attribute long numberOfCopies; */\nunsigned long\n\n>-  nsCString *copyDest = m_copyDestinations.CStringAt(copyIndex);\n>+  retval = m_copyDestinations[copyIndex];\nCStringAt is technically safe, although it asserts for out-of-range indices. [] is not safe. As this is a scriptable method...", "time": "2011-07-06T20:51:55Z", "attachment_id": 544192, "author": "neil@httl.net", "raw_text": ">-    copyDests.Append(curDest->get());\n>+    copyDests.Append(m_copyDestinations[i].get());\nNot sure why this used get() before but it's unnecessary.\n\n> /* attribute long numberOfCopies; */\nunsigned long\n\n>-  nsCString *copyDest = m_copyDestinations.CStringAt(copyIndex);\n>+  retval = m_copyDestinations[copyIndex];\nCStringAt is technically safe, although it asserts for out-of-range indices. [] is not safe. As this is a scriptable method...", "creation_time": "2011-07-06T20:51:55Z"}, {"id": 5766083, "tags": [], "count": 5, "is_private": false, "bug_id": 669588, "creation_time": "2011-10-07T10:55:28Z", "raw_text": "Dropping nsCString array as that's happening in bug 686189.", "attachment_id": null, "time": "2011-10-07T10:55:28Z", "text": "Dropping nsCString array as that's happening in bug 686189.", "author": "standard8@mozilla.com", "creator": "standard8@mozilla.com"}]}}}