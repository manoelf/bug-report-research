{"comments": {}, "bugs": {"691255": {"comments": [{"author": "bugzilla@twinql.com", "creator": "bugzilla@twinql.com", "attachment_id": null, "time": "2011-10-03T07:03:18Z", "text": "************************************************************\n* Call to xpconnect wrapped JSObject produced this error:  *\n[Exception... \"'[JavaScript Error: \"attempt to run compile-and-go script on a cleared scope\" {file: \"chrome://browser/content/aboutSessionRestore.js\" line: 277}]' when calling method: [nsITreeView::setTree]\"  nsresult: \"0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS)\"  location: \"native frame :: <unknown filename> :: <TOP_LEVEL> :: line 0\"  data: yes]\n************************************************************", "creation_time": "2011-10-03T07:03:18Z", "raw_text": "************************************************************\n* Call to xpconnect wrapped JSObject produced this error:  *\n[Exception... \"'[JavaScript Error: \"attempt to run compile-and-go script on a cleared scope\" {file: \"chrome://browser/content/aboutSessionRestore.js\" line: 277}]' when calling method: [nsITreeView::setTree]\"  nsresult: \"0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS)\"  location: \"native frame :: <unknown filename> :: <TOP_LEVEL> :: line 0\"  data: yes]\n************************************************************", "bug_id": 691255, "id": 5753517, "is_private": false, "count": 0, "tags": []}, {"raw_text": "Was this just during a restore following a crash or was about:sessionrestore opened under other some other condition (tests maybe)?\n\nThat's not new and I think Brendan said at some point that this is bug 635548 and is actually harmless and can be ignored. But it's been a few months", "creation_time": "2011-10-05T22:42:56Z", "author": "paul@oshannessy.com", "attachment_id": null, "time": "2011-10-05T22:42:56Z", "creator": "paul@oshannessy.com", "text": "Was this just during a restore following a crash or was about:sessionrestore opened under other some other condition (tests maybe)?\n\nThat's not new and I think Brendan said at some point that this is bug 635548 and is actually harmless and can be ignored. But it's been a few months", "id": 5761909, "tags": [], "count": 1, "is_private": false, "bug_id": 691255}, {"creator": "bugzilla@twinql.com", "text": "This was a test profile relaunch after either a quit or a Ctrl-C in the controlling terminal. Sometimes either of those will cause an \"oops\" session restore to appear on relaunch.\n\nI didn't open about:sessionrestore manually.", "time": "2011-10-05T22:48:08Z", "attachment_id": null, "author": "bugzilla@twinql.com", "creation_time": "2011-10-05T22:48:08Z", "raw_text": "This was a test profile relaunch after either a quit or a Ctrl-C in the controlling terminal. Sometimes either of those will cause an \"oops\" session restore to appear on relaunch.\n\nI didn't open about:sessionrestore manually.", "bug_id": 691255, "count": 2, "is_private": false, "tags": [], "id": 5761922}, {"author": "paul@oshannessy.com", "creator": "paul@oshannessy.com", "attachment_id": null, "time": "2011-12-07T23:10:20Z", "text": "dbaron mentioned this in bug 614335 - it has to do with the treeview, specifically treeview.setTree.\n\nI did some more investigation today and it only happens when we overwrite the state of the about:sessionrestore tab. We do that by deleting all the sessionhistory, so maybe we're not triggering teardown code for the tree?\n\nNeil, do you have any ideas what might be happening here? setTree is getting called after the treeview no longer exists presumably. I tried adding dump()s in setTree, but it's only called with BoxObjects, so maybe those failing calls aren't even getting into the body?\n\nIf you need to repro, run the b-c mochitest browser/components/sessionstore/test/browser/browser_467409-backslashplosion.js (take out the ignoreAllUncaughtExceptions() line to make sure the exceptions are reported).", "raw_text": "dbaron mentioned this in bug 614335 - it has to do with the treeview, specifically treeview.setTree.\n\nI did some more investigation today and it only happens when we overwrite the state of the about:sessionrestore tab. We do that by deleting all the sessionhistory, so maybe we're not triggering teardown code for the tree?\n\nNeil, do you have any ideas what might be happening here? setTree is getting called after the treeview no longer exists presumably. I tried adding dump()s in setTree, but it's only called with BoxObjects, so maybe those failing calls aren't even getting into the body?\n\nIf you need to repro, run the b-c mochitest browser/components/sessionstore/test/browser/browser_467409-backslashplosion.js (take out the ignoreAllUncaughtExceptions() line to make sure the exceptions are reported).", "creation_time": "2011-12-07T23:10:20Z", "bug_id": 691255, "id": 5898864, "is_private": false, "count": 3, "tags": []}, {"text": "Created attachment 580479\nbacktrace\n\nThis is from a breakpoint set where the cleared scope error comes from.\n\nnsTreeBoxObject::Clear is on the stack (at mView->SetTree(nsnull)) so I think my theory is substantiated.", "time": "2011-12-09T19:29:09Z", "attachment_id": 580479, "creation_time": "2011-12-09T19:29:09Z", "raw_text": "This is from a breakpoint set where the cleared scope error comes from.\n\nnsTreeBoxObject::Clear is on the stack (at mView->SetTree(nsnull)) so I think my theory is substantiated.", "bug_id": 691255, "tags": [], "count": 4, "is_private": false, "id": 5904904, "creator": "paul@oshannessy.com", "author": "paul@oshannessy.com"}, {"raw_text": "The treeview still exists at that point. The error occurs while trying to clear it out and uninitialize/destroy the box object.\n\nI'm assuming that this is the session restore page (that displays the tree of pages to restore) being unloaded and replaced with some page to restore. Presumably, the error occurs because the window scope has already been disconnected.\n\nCurrently box objects are removed near the end of nsDocument's destructor, but perhaps the box objects should be cleared earlier during Destroy. But I don't really know.", "creation_time": "2011-12-09T20:38:21Z", "attachment_id": null, "time": "2011-12-09T20:38:21Z", "text": "The treeview still exists at that point. The error occurs while trying to clear it out and uninitialize/destroy the box object.\n\nI'm assuming that this is the session restore page (that displays the tree of pages to restore) being unloaded and replaced with some page to restore. Presumably, the error occurs because the window scope has already been disconnected.\n\nCurrently box objects are removed near the end of nsDocument's destructor, but perhaps the box objects should be cleared earlier during Destroy. But I don't really know.", "id": 5905098, "is_private": false, "count": 5, "tags": [], "bug_id": 691255, "author": "enndeakin@gmail.com", "creator": "enndeakin@gmail.com"}]}}}