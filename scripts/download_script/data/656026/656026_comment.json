{"comments": {}, "bugs": {"656026": {"comments": [{"bug_id": 656026, "attachment_id": null, "tags": [], "creation_time": "2011-05-10T15:38:02Z", "id": 5459700, "is_private": false, "author": "bkaull@yahoo-inc.com", "text": "User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_7) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.65 Safari/534.24\nBuild Identifier: Firefox 4.0.1\n\nThe issue I'm seeing is that, in FF4, programmatically setting focus between cross domain frames doesn't appear to work properly.  The .focus() call on the element doesn't throw an error and additional keypress events are executed on the element that was just given focus (or at least .focus() was called on it).  However, visually, the focus has not changed, and the focused element isn't properly firing the onFocus event.\n\nIn the message list for Yahoo Mail, we rely on the onFocus event to fire when we programmatically set focus on an element in the list.\n\nI've created a simple test case here to demonstrate the issue:\nhttp://kaull.com/top.html\n\nTry this page in both FF3 (or Chrome) and FF4 to see the difference.\n\nI have found that if I call .blur() on the document.activeElement before sending the postMessage that will focus on the other side, things work properly.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. See the sample page for an example.\n\nActual Results:  \nThe focused element was not visually focused and did not fire a focus event, yet it received keypress events\n\nExpected Results:  \nThe focused element should have visual focus and fire a focus event.", "creator": "bkaull@yahoo-inc.com", "raw_text": "User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_7) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.65 Safari/534.24\nBuild Identifier: Firefox 4.0.1\n\nThe issue I'm seeing is that, in FF4, programmatically setting focus between cross domain frames doesn't appear to work properly.  The .focus() call on the element doesn't throw an error and additional keypress events are executed on the element that was just given focus (or at least .focus() was called on it).  However, visually, the focus has not changed, and the focused element isn't properly firing the onFocus event.\n\nIn the message list for Yahoo Mail, we rely on the onFocus event to fire when we programmatically set focus on an element in the list.\n\nI've created a simple test case here to demonstrate the issue:\nhttp://kaull.com/top.html\n\nTry this page in both FF3 (or Chrome) and FF4 to see the difference.\n\nI have found that if I call .blur() on the document.activeElement before sending the postMessage that will focus on the other side, things work properly.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. See the sample page for an example.\n\nActual Results:  \nThe focused element was not visually focused and did not fire a focus event, yet it received keypress events\n\nExpected Results:  \nThe focused element should have visual focus and fire a focus event.", "count": 0, "time": "2011-05-10T15:38:02Z"}, {"time": "2011-05-10T15:57:17Z", "count": 1, "raw_text": "To clarify, I don't see this issue with FF3, but do see it with 4.0.1 as well as these 2 builds:\n - firefox-6.0a1.en-US.mac.dmg\t10-May-2011 06:04\t 34M\n - http://releases.mozilla.org/pub/mozilla.org/firefox/releases/5.0b1/mac/en-US/ --  Firefox 5.0b1.dmg                                  28-Apr-2011 01:54", "creator": "bkaull@yahoo-inc.com", "text": "To clarify, I don't see this issue with FF3, but do see it with 4.0.1 as well as these 2 builds:\n - firefox-6.0a1.en-US.mac.dmg\t10-May-2011 06:04\t 34M\n - http://releases.mozilla.org/pub/mozilla.org/firefox/releases/5.0b1/mac/en-US/ --  Firefox 5.0b1.dmg                                  28-Apr-2011 01:54", "is_private": false, "author": "bkaull@yahoo-inc.com", "id": 5459741, "creation_time": "2011-05-10T15:57:17Z", "tags": [], "attachment_id": null, "bug_id": 656026}, {"attachment_id": null, "creation_time": "2011-05-10T17:33:07Z", "tags": [], "bug_id": 656026, "is_private": false, "author": "dveditz@mozilla.com", "id": 5460006, "creator": "dveditz@mozilla.com", "raw_text": "According to console log messages focus -does- get transfered back out to the parent (though not visually), and then gets stuck there. The child frame is spitting out the \"child focus\" message after falling .focus(), but events keep going to the top frame. Visually the focus ring appears to be in the child.\n\n[10:23:50.442] \"parent key down\"\n[10:23:50.459] \"child focus\"\n[10:23:54.263] \"child key down\"\n[10:23:54.280] \"parent focus\"\n[10:23:55.935] \"parent key down\"\n[10:23:55.953] \"child focus\"\n--\n[10:24:02.230] \"parent key down\"\n[10:24:02.242] \"child focus\"", "text": "According to console log messages focus -does- get transfered back out to the parent (though not visually), and then gets stuck there. The child frame is spitting out the \"child focus\" message after falling .focus(), but events keep going to the top frame. Visually the focus ring appears to be in the child.\n\n[10:23:50.442] \"parent key down\"\n[10:23:50.459] \"child focus\"\n[10:23:54.263] \"child key down\"\n[10:23:54.280] \"parent focus\"\n[10:23:55.935] \"parent key down\"\n[10:23:55.953] \"child focus\"\n--\n[10:24:02.230] \"parent key down\"\n[10:24:02.242] \"child focus\"", "count": 2, "time": "2011-05-10T17:33:07Z"}, {"is_private": false, "author": "dveditz@mozilla.com", "time": "2011-05-10T17:38:07Z", "count": 3, "id": 5460020, "creation_time": "2011-05-10T17:38:07Z", "tags": [], "attachment_id": null, "raw_text": "We may have done this as a security precaution, so cross-site frames cannot steal focus and maybe steal a password surreptitiously. bug 552255 was like that but we fixed that one in 3.6.4", "creator": "dveditz@mozilla.com", "bug_id": 656026, "text": "We may have done this as a security precaution, so cross-site frames cannot steal focus and maybe steal a password surreptitiously. bug 552255 was like that but we fixed that one in 3.6.4"}, {"text": "Of course, if it were a security precaution then letting the cross-site child frame set focus the first time means it's broken.", "creator": "dveditz@mozilla.com", "raw_text": "Of course, if it were a security precaution then letting the cross-site child frame set focus the first time means it's broken.", "count": 4, "time": "2011-05-10T17:41:23Z", "bug_id": 656026, "attachment_id": null, "tags": [], "creation_time": "2011-05-10T17:41:23Z", "id": 5460028, "is_private": false, "author": "dveditz@mozilla.com"}, {"id": 5485938, "count": 5, "time": "2011-05-23T08:05:37Z", "author": "mozilla@ahlblom.eu", "is_private": false, "text": "Last good nightly: 2009-12-11 First bad nightly: 2009-12-12\n\nPushlog: http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=9af2a428dcb1&tochange=d379a17cbf8f\n\nThe first bad revision is:\nchangeset:   35609:a8f46161c891\nuser:        Masayuki Nakano <masayuki@d-toybox.com>\ndate:        Sat Dec 12 14:17:40 2009 +0900\nsummary:     Bug 125282 Webpage-JS can steal focus from URLbar / chrome r=enndeakin\n\nhttp://hg.mozilla.org/mozilla-central/rev/a8f46161c891", "bug_id": 656026, "creator": "mozilla@ahlblom.eu", "raw_text": "Last good nightly: 2009-12-11 First bad nightly: 2009-12-12\n\nPushlog: http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=9af2a428dcb1&tochange=d379a17cbf8f\n\nThe first bad revision is:\nchangeset:   35609:a8f46161c891\nuser:        Masayuki Nakano <masayuki@d-toybox.com>\ndate:        Sat Dec 12 14:17:40 2009 +0900\nsummary:     Bug 125282 Webpage-JS can steal focus from URLbar / chrome r=enndeakin\n\nhttp://hg.mozilla.org/mozilla-central/rev/a8f46161c891", "attachment_id": null, "creation_time": "2011-05-23T08:05:37Z", "tags": []}, {"author": "bzbarsky@mit.edu", "is_private": false, "id": 5487034, "attachment_id": null, "creation_time": "2011-05-23T18:09:30Z", "tags": [], "bug_id": 656026, "count": 6, "time": "2011-05-23T18:09:30Z", "creator": "bzbarsky@mit.edu", "raw_text": "Masayuki-san, can you take a look please?", "text": "Masayuki-san, can you take a look please?"}, {"raw_text": "Oops, I forgot to work on the regressions. This bug is fixed by the patch for bug 604289. But I don't create some tests for very complex cases. I think I should separate the patches and land them for simple cases.", "creator": "masayuki@d-toybox.com", "creation_time": "2011-05-24T07:13:25Z", "tags": [], "attachment_id": null, "text": "Oops, I forgot to work on the regressions. This bug is fixed by the patch for bug 604289. But I don't create some tests for very complex cases. I think I should separate the patches and land them for simple cases.", "bug_id": 656026, "time": "2011-05-24T07:13:25Z", "author": "masayuki@d-toybox.com", "count": 7, "is_private": false, "id": 5488527}, {"id": 6160477, "time": "2012-03-21T22:12:48Z", "author": "tjmart1@uky.edu", "count": 8, "is_private": false, "text": "I still see this bug in recent Nightly builds.\n\nAlso, seems like the current situation is actually the worst possible from a security context!  Keystrokes are still captured by the cross domain frame, but there is no visual indication that this will happen.", "bug_id": 656026, "raw_text": "I still see this bug in recent Nightly builds.\n\nAlso, seems like the current situation is actually the worst possible from a security context!  Keystrokes are still captured by the cross domain frame, but there is no visual indication that this will happen.", "creator": "tjmart1@uky.edu", "tags": [], "creation_time": "2012-03-21T22:12:48Z", "attachment_id": null}, {"id": 9390991, "author": "sachzky@gmail.com", "is_private": false, "bug_id": 656026, "tags": [], "creation_time": "2014-10-02T00:05:46Z", "attachment_id": null, "time": "2014-10-02T00:05:46Z", "count": 9, "text": "I believe this bug is still present in Firefox 32.0.3, or at least something very similar. If focus is on an input element in a child iframe (in a different domain) and the parent iframe tries to focus an input, it will appear as though focus is still within the iframe, however the parent iframe will receive keyboard events. Additionally, clicking on the input in the child iframe will have no effect, and focus will still remain with the parent.\n\nHere is a small sample illustrating the issue. Click the \"Go\" button, then quickly place focus in the iframe's input, wait the 2 seconds, and start typing. You should see the text apper in the parent's input.\n\n\nindex.html:\n\n<html>\n  <head>\n    \n  </head>\n  <body>\n    <input id=\"outer\" type=\"text\" onkeypress=\"\"></input>\n    <iframe id=\"frame\" src=\"http://<some other domain>/firefoxIframeFocus/frame.html\"></iframe>\n    <button onclick=\"go()\">Go</button>\n    <div id=\"output\"></div>\n\n    <script type=\"text/javascript\" src=\"index.js\"></script>\n  </body>\n</html>\n\n\n\nframe.html:\n\n<html>\n  <head>\n    <script type=\"text/javascript\" src=\"index.js\"></script>\n  </head>\n  <body>\n    <input id=\"inner\" type=\"text\"></input>\n  </body>\n</html>\n\n\n\nindex.js:\n\ndocument.getElementById(\"outer\").onkeypress = function(evt) {\n  var out = document.getElementById(\"output\");\n  out.innerHTML = out.innerHTML + evt.key;\n}\n\nfunction go() {\n  setTimeout(function() {document.getElementById(\"outer\").focus();}, 2000);\n}", "raw_text": "I believe this bug is still present in Firefox 32.0.3, or at least something very similar. If focus is on an input element in a child iframe (in a different domain) and the parent iframe tries to focus an input, it will appear as though focus is still within the iframe, however the parent iframe will receive keyboard events. Additionally, clicking on the input in the child iframe will have no effect, and focus will still remain with the parent.\n\nHere is a small sample illustrating the issue. Click the \"Go\" button, then quickly place focus in the iframe's input, wait the 2 seconds, and start typing. You should see the text apper in the parent's input.\n\n\nindex.html:\n\n<html>\n  <head>\n    \n  </head>\n  <body>\n    <input id=\"outer\" type=\"text\" onkeypress=\"\"></input>\n    <iframe id=\"frame\" src=\"http://<some other domain>/firefoxIframeFocus/frame.html\"></iframe>\n    <button onclick=\"go()\">Go</button>\n    <div id=\"output\"></div>\n\n    <script type=\"text/javascript\" src=\"index.js\"></script>\n  </body>\n</html>\n\n\n\nframe.html:\n\n<html>\n  <head>\n    <script type=\"text/javascript\" src=\"index.js\"></script>\n  </head>\n  <body>\n    <input id=\"inner\" type=\"text\"></input>\n  </body>\n</html>\n\n\n\nindex.js:\n\ndocument.getElementById(\"outer\").onkeypress = function(evt) {\n  var out = document.getElementById(\"output\");\n  out.innerHTML = out.innerHTML + evt.key;\n}\n\nfunction go() {\n  setTimeout(function() {document.getElementById(\"outer\").focus();}, 2000);\n}", "creator": "sachzky@gmail.com"}, {"bug_id": 656026, "attachment_id": null, "tags": [], "creation_time": "2018-06-29T04:58:35Z", "id": 13436633, "author": "bug-husbandry-bot@mozilla.bugs", "is_private": false, "text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1472046\n\nMove all DOM bugs that haven\u2019t been updated in more than 3 years and has no one currently assigned to P5.\n\nIf you have questions, please contact :mdaly.", "creator": "bug-husbandry-bot@mozilla.bugs", "raw_text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1472046\n\nMove all DOM bugs that haven\u2019t been updated in more than 3 years and has no one currently assigned to P5.\n\nIf you have questions, please contact :mdaly.", "count": 10, "time": "2018-06-29T04:58:35Z"}, {"bug_id": 656026, "tags": [], "creation_time": "2019-04-11T13:28:27Z", "attachment_id": null, "id": 14048597, "author": "Marco.Stahl@acrolinx.com", "is_private": false, "text": "This bug is still present in Firefox version 66.0.2 (tested on Linux and Windows).\n\n### Situation:\nAn element in a child iframe is focused and the parent frame (from a different domain) tries to \"steal\" the focus back to one of it's own textareas.\n\n### Unexpected Result:\nThe \"focused\" textarea in the parent iframe is only \"partially\" focused. \n\"Partially focused\" means, it's possible to type but there is no visual indication that the textarea is focused (no cursor, no visible selection, no focus border).", "raw_text": "This bug is still present in Firefox version 66.0.2 (tested on Linux and Windows).\n\n### Situation:\nAn element in a child iframe is focused and the parent frame (from a different domain) tries to \"steal\" the focus back to one of it's own textareas.\n\n### Unexpected Result:\nThe \"focused\" textarea in the parent iframe is only \"partially\" focused. \n\"Partially focused\" means, it's possible to type but there is no visual indication that the textarea is focused (no cursor, no visible selection, no focus border).", "creator": "Marco.Stahl@acrolinx.com", "time": "2019-04-11T13:28:27Z", "count": 11}, {"tags": [], "creation_time": "2019-04-13T00:35:27Z", "attachment_id": null, "raw_text": "Well, if I rewrite the patch of bug 604289, we could fix this soon. But I gave up to fix that since I didn't have a time to write automated test of that.", "creator": "masayuki@d-toybox.com", "bug_id": 656026, "text": "Well, if I rewrite the patch of bug 604289, we could fix this soon. But I gave up to fix that since I didn't have a time to write automated test of that.", "is_private": false, "time": "2019-04-13T00:35:27Z", "author": "masayuki@d-toybox.com", "count": 12, "id": 14052087}, {"count": 13, "time": "2019-04-13T01:21:13Z", "creator": "bzbarsky@mit.edu", "raw_text": "Is there some way to fix this, with automated test, without fixing that bug?  Or even just fix that bug and at least write a test for this one in the process?", "text": "Is there some way to fix this, with automated test, without fixing that bug?  Or even just fix that bug and at least write a test for this one in the process?", "is_private": false, "author": "bzbarsky@mit.edu", "id": 14052111, "attachment_id": null, "tags": [], "creation_time": "2019-04-13T01:21:13Z", "bug_id": 656026}]}}}