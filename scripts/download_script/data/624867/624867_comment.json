{"comments": {}, "bugs": {"624867": {"comments": [{"author": "pwalton@mozilla.com", "count": 0, "creator": "pwalton@mozilla.com", "raw_text": "MaybeGC() gets called on every 20th script execution, causing jank in the Flight of the Navigator demo. I've created a patch to remove this call.", "attachment_id": null, "tags": [], "text": "MaybeGC() gets called on every 20th script execution, causing jank in the Flight of the Navigator demo. I've created a patch to remove this call.", "id": 5191691, "bug_id": 624867, "creation_time": "2011-01-11T22:46:52Z", "is_private": false, "time": "2011-01-11T22:46:52Z"}, {"tags": [], "id": 5191704, "is_private": false, "author": "pwalton@mozilla.com", "count": 1, "text": "Created attachment 502945\nProposed patch.\n\nProposed patch attached. Baking on try server.", "bug_id": 624867, "creation_time": "2011-01-11T22:50:03Z", "time": "2011-01-11T22:50:03Z", "creator": "pwalton@mozilla.com", "raw_text": "Proposed patch attached. Baking on try server.", "attachment_id": 502945}, {"tags": [], "text": "After this, do we only do full gc if there is cycle collection with gc?\n(Note, it is possibly to run scripts without causing any cycle collections)\n\nIs it possible to have cross compartment wrappers or something which need to be \ncollected occasionally using something like MaybeGC()?", "id": 5191881, "bug_id": 624867, "creation_time": "2011-01-11T23:44:33Z", "time": "2011-01-11T23:44:33Z", "is_private": false, "author": "bugs@pettay.fi", "count": 2, "creator": "bugs@pettay.fi", "raw_text": "After this, do we only do full gc if there is cycle collection with gc?\n(Note, it is possibly to run scripts without causing any cycle collections)\n\nIs it possible to have cross compartment wrappers or something which need to be \ncollected occasionally using something like MaybeGC()?", "attachment_id": null}, {"is_private": false, "time": "2011-01-12T17:14:30Z", "creation_time": "2011-01-12T17:14:30Z", "id": 5193754, "bug_id": 624867, "tags": [], "text": "(In reply to comment #2)\n> After this, do we only do full gc if there is cycle collection with gc?\n> (Note, it is possibly to run scripts without causing any cycle collections)\n\nMaybeGC() can call either, depending on some logic in the JSAPI: http://mxr.mozilla.org/mozilla-central/source/js/src/jsgc.cpp#1825\n\n> Is it possible to have cross compartment wrappers or something which need to be \n> collected occasionally using something like MaybeGC()?\n\nYeah, although the JS engine will call it automatically if it needs to I believe (although it's slower).", "creator": "pwalton@mozilla.com", "raw_text": "(In reply to comment #2)\n> After this, do we only do full gc if there is cycle collection with gc?\n> (Note, it is possibly to run scripts without causing any cycle collections)\n\nMaybeGC() can call either, depending on some logic in the JSAPI: http://mxr.mozilla.org/mozilla-central/source/js/src/jsgc.cpp#1825\n\n> Is it possible to have cross compartment wrappers or something which need to be \n> collected occasionally using something like MaybeGC()?\n\nYeah, although the JS engine will call it automatically if it needs to I believe (although it's slower).", "attachment_id": null, "count": 3, "author": "pwalton@mozilla.com"}, {"is_private": false, "tags": [], "id": 5194314, "author": "pwalton@mozilla.com", "count": 4, "creation_time": "2011-01-12T19:47:09Z", "time": "2011-01-12T19:47:09Z", "text": "No notable regressions on tp4. Going to send to tracemonkey.", "bug_id": 624867, "creator": "pwalton@mozilla.com", "raw_text": "No notable regressions on tp4. Going to send to tracemonkey.", "attachment_id": null}, {"creator": "matjk7@gmail.com", "raw_text": "This landed a while ago:\nhttp://hg.mozilla.org/tracemonkey/rev/d1adb7b245bd\nhttp://hg.mozilla.org/mozilla-central/rev/d1adb7b245bd", "attachment_id": null, "bug_id": 624867, "text": "This landed a while ago:\nhttp://hg.mozilla.org/tracemonkey/rev/d1adb7b245bd\nhttp://hg.mozilla.org/mozilla-central/rev/d1adb7b245bd", "time": "2011-01-19T00:47:54Z", "creation_time": "2011-01-19T00:47:54Z", "count": 5, "author": "matjk7@gmail.com", "id": 5209233, "tags": [], "is_private": false}, {"id": 5223346, "bug_id": 624867, "tags": [], "text": "http://hg.mozilla.org/mozilla-central/rev/d1adb7b245bd", "is_private": false, "time": "2011-01-24T22:48:24Z", "creation_time": "2011-01-24T22:48:24Z", "count": 6, "author": "jdemooij@mozilla.com", "creator": "jdemooij@mozilla.com", "raw_text": "http://hg.mozilla.org/mozilla-central/rev/d1adb7b245bd", "attachment_id": null}, {"creation_time": "2011-01-25T03:17:42Z", "time": "2011-01-25T03:17:42Z", "text": "Backed out in http://hg.mozilla.org/mozilla-central/rev/f28ee131df7a\n\nWas causing SunSpider regressions.", "bug_id": 624867, "raw_text": "Backed out in http://hg.mozilla.org/mozilla-central/rev/f28ee131df7a\n\nWas causing SunSpider regressions.", "creator": "pwalton@mozilla.com", "attachment_id": null, "is_private": false, "tags": [], "id": 5224207, "author": "pwalton@mozilla.com", "count": 7}, {"count": 8, "author": "bugs@pettay.fi", "attachment_id": null, "raw_text": "So, could this cause the regression because these MaybeGC calls happen usually\nwhen we aren't running javascript, but just right after that,\nfor example right after the function which was run because of some timeout.\nNow, if we take explicit MaybeGC calls out, GC may run more often while\nwe're running the tests.\n\nI wonder if we could change (mNumEvaluations > 20). That 20 has been there\nforever. Also, could we perhaps explicitly do \"compartment only gc\" more often\nand then call MaybeGC every now and then?\n\n/me still has no idea how to explicitly call only compartment gc.", "creator": "bugs@pettay.fi", "bug_id": 624867, "id": 5246908, "text": "So, could this cause the regression because these MaybeGC calls happen usually\nwhen we aren't running javascript, but just right after that,\nfor example right after the function which was run because of some timeout.\nNow, if we take explicit MaybeGC calls out, GC may run more often while\nwe're running the tests.\n\nI wonder if we could change (mNumEvaluations > 20). That 20 has been there\nforever. Also, could we perhaps explicitly do \"compartment only gc\" more often\nand then call MaybeGC every now and then?\n\n/me still has no idea how to explicitly call only compartment gc.", "tags": [], "is_private": false, "time": "2011-02-02T12:18:05Z", "creation_time": "2011-02-02T12:18:05Z"}, {"count": 9, "author": "gal@uci.edu", "id": 5247882, "tags": [], "is_private": false, "attachment_id": null, "creator": "gal@uci.edu", "raw_text": "I can make an api for you.", "bug_id": 624867, "text": "I can make an api for you.", "time": "2011-02-02T19:07:54Z", "creation_time": "2011-02-02T19:07:54Z"}, {"creation_time": "2011-02-02T21:15:57Z", "time": "2011-02-02T21:15:57Z", "is_private": false, "text": "Andreas, that would be great. Could you post a patch to this bug perhaps?\nI could at least play with such API a bit to see if we can improve responsiveness.\n\nI'm also trying to figure out how the MaybeGC in nsJSContext::ScriptEvaluated\nworks with MaybeGC call in nsJSContext::DOMOperationCallback.\nIf it was just documented somewhere when OperationCallback is actually called...", "tags": [], "bug_id": 624867, "id": 5248307, "attachment_id": null, "creator": "bugs@pettay.fi", "raw_text": "Andreas, that would be great. Could you post a patch to this bug perhaps?\nI could at least play with such API a bit to see if we can improve responsiveness.\n\nI'm also trying to figure out how the MaybeGC in nsJSContext::ScriptEvaluated\nworks with MaybeGC call in nsJSContext::DOMOperationCallback.\nIf it was just documented somewhere when OperationCallback is actually called...", "author": "bugs@pettay.fi", "count": 10}, {"creator": "bugs@pettay.fi", "raw_text": "Just trying out something;\nsunspider seems to trigger compartment gc occasionally, but\nfor some reason FOTN doesn't (or if it does, it happens very rarely).\nPosted to tryserver to see if this regresses sunspider.\n\nhumph, want to try FOTN with this?", "attachment_id": 509760, "creation_time": "2011-02-04T15:13:53Z", "time": "2011-02-04T15:13:53Z", "text": "Created attachment 509760\nmaybecompartmentgc\n\nJust trying out something;\nsunspider seems to trigger compartment gc occasionally, but\nfor some reason FOTN doesn't (or if it does, it happens very rarely).\nPosted to tryserver to see if this regresses sunspider.\n\nhumph, want to try FOTN with this?", "bug_id": 624867, "author": "bugs@pettay.fi", "count": 11, "is_private": false, "tags": [], "id": 5255123}, {"raw_text": "Patrick, do you have any other ideas how to fix this - I mean, how to cause\nless GC, or faster GC?", "creator": "bugs@pettay.fi", "attachment_id": null, "time": "2011-02-04T15:17:08Z", "creation_time": "2011-02-04T15:17:08Z", "bug_id": 624867, "text": "Patrick, do you have any other ideas how to fix this - I mean, how to cause\nless GC, or faster GC?", "count": 12, "author": "bugs@pettay.fi", "is_private": false, "id": 5255132, "tags": []}, {"bug_id": 624867, "id": 5255321, "text": "smaug, break on js_GC and walk up the stack to see what heuristic triggered that GC. That should tell us why it doesn't hit faster compartment GCs.", "tags": [], "is_private": false, "time": "2011-02-04T16:39:02Z", "creation_time": "2011-02-04T16:39:02Z", "count": 13, "author": "gal@uci.edu", "attachment_id": null, "raw_text": "smaug, break on js_GC and walk up the stack to see what heuristic triggered that GC. That should tell us why it doesn't hit faster compartment GCs.", "creator": "gal@uci.edu"}, {"is_private": false, "id": 5257860, "tags": [], "count": 14, "author": "david.humphrey@senecacollege.ca", "time": "2011-02-05T19:16:02Z", "creation_time": "2011-02-05T19:16:02Z", "bug_id": 624867, "text": "I ran Olli's try server build and compared to trunk with FOTN, and on trunk I see micro-pauses every so often, which I assume are gc.  With this build I got at least 6 world-stopping pauses that lasted a second or so, and really froze the main thread.\n\nI also tried on our new demo, but it has pretty different run-time characteristics than FOTN.  In it I noticed a few large pauses I didn't recognize, too, but I'm less confident to say that they are the result of this patch.", "raw_text": "I ran Olli's try server build and compared to trunk with FOTN, and on trunk I see micro-pauses every so often, which I assume are gc.  With this build I got at least 6 world-stopping pauses that lasted a second or so, and really froze the main thread.\n\nI also tried on our new demo, but it has pretty different run-time characteristics than FOTN.  In it I noticed a few large pauses I didn't recognize, too, but I'm less confident to say that they are the result of this patch.", "creator": "david.humphrey@senecacollege.ca", "attachment_id": null}, {"attachment_id": null, "creator": "bugs@pettay.fi", "raw_text": "(In reply to comment #14)\n> I ran Olli's try server build and compared to trunk with FOTN, and on trunk I\n> see micro-pauses every so often, which I assume are gc.  With this build I got\n> at least 6 world-stopping pauses that lasted a second or so, and really froze\n> the main thread.\nUm, that sounds bad.\n\nAndreas, Patrick, do you have any ideas how to improve gc scheduling\nwithout regressing perf tests?", "bug_id": 624867, "text": "(In reply to comment #14)\n> I ran Olli's try server build and compared to trunk with FOTN, and on trunk I\n> see micro-pauses every so often, which I assume are gc.  With this build I got\n> at least 6 world-stopping pauses that lasted a second or so, and really froze\n> the main thread.\nUm, that sounds bad.\n\nAndreas, Patrick, do you have any ideas how to improve gc scheduling\nwithout regressing perf tests?", "time": "2011-02-07T11:39:02Z", "creation_time": "2011-02-07T11:39:02Z", "count": 15, "author": "bugs@pettay.fi", "id": 5259792, "tags": [], "is_private": false}, {"tags": [], "id": 5274996, "is_private": false, "author": "grantgalitz@gmail.com", "count": 16, "text": "Any GC differences with Ubuntu? I'm seeing horrible GC pauses still with my own projects specifically unique to Ubuntu (10.10 x64).", "bug_id": 624867, "creation_time": "2011-02-12T18:17:01Z", "time": "2011-02-12T18:17:01Z", "raw_text": "Any GC differences with Ubuntu? I'm seeing horrible GC pauses still with my own projects specifically unique to Ubuntu (10.10 x64).", "creator": "grantgalitz@gmail.com", "attachment_id": null}, {"creator": "pwalton@mozilla.com", "raw_text": "(In reply to comment #16)\n> Any GC differences with Ubuntu? I'm seeing horrible GC pauses still with my own\n> projects specifically unique to Ubuntu (10.10 x64).\n\nThe code is the same across platforms. Are you generating a lot of garbage? There isn't much we can do at the moment if you're actually generating a lot of garbage.\n\nIncidentally, this bug is largely resolved for me with Andreas' patch to revamp the GC heuristics.", "attachment_id": null, "count": 17, "author": "pwalton@mozilla.com", "is_private": false, "time": "2011-02-12T18:23:16Z", "creation_time": "2011-02-12T18:23:16Z", "id": 5275001, "bug_id": 624867, "tags": [], "text": "(In reply to comment #16)\n> Any GC differences with Ubuntu? I'm seeing horrible GC pauses still with my own\n> projects specifically unique to Ubuntu (10.10 x64).\n\nThe code is the same across platforms. Are you generating a lot of garbage? There isn't much we can do at the moment if you're actually generating a lot of garbage.\n\nIncidentally, this bug is largely resolved for me with Andreas' patch to revamp the GC heuristics."}, {"id": 5275005, "tags": [], "is_private": false, "count": 18, "author": "grantgalitz@gmail.com", "bug_id": 624867, "text": "I think my GC problem that only happens with Firefox 4 on Ubuntu 10.10 x64 is related to scaling the canvas. I think there's some serious GC problem with nearest-neighbor scaling via the Mozilla CSS extension -moz-crisp-edges unique to Firefox on Ubuntu.", "time": "2011-02-12T18:26:38Z", "creation_time": "2011-02-12T18:26:38Z", "raw_text": "I think my GC problem that only happens with Firefox 4 on Ubuntu 10.10 x64 is related to scaling the canvas. I think there's some serious GC problem with nearest-neighbor scaling via the Mozilla CSS extension -moz-crisp-edges unique to Firefox on Ubuntu.", "creator": "grantgalitz@gmail.com", "attachment_id": null}, {"attachment_id": null, "creator": "grantgalitz@gmail.com", "raw_text": "Here's the trouble line in my CSS file: https://github.com/grantgalitz/GameBoy-Online/blob/master/css/GameBoy.css.php#L260", "time": "2011-02-12T18:50:53Z", "creation_time": "2011-02-12T18:50:53Z", "bug_id": 624867, "text": "Here's the trouble line in my CSS file: https://github.com/grantgalitz/GameBoy-Online/blob/master/css/GameBoy.css.php#L260", "count": 19, "author": "grantgalitz@gmail.com", "is_private": false, "id": 5275035, "tags": []}, {"id": 5275039, "tags": [], "is_private": false, "count": 20, "author": "khuey@kylehuey.com", "bug_id": 624867, "text": "Can you file a separate bug on that?  It's unlikely to be related to this.", "time": "2011-02-12T18:52:45Z", "creation_time": "2011-02-12T18:52:45Z", "attachment_id": null, "creator": "khuey@kylehuey.com", "raw_text": "Can you file a separate bug on that?  It's unlikely to be related to this."}, {"id": 5318491, "tags": [], "is_private": false, "count": 21, "author": "mbeltzner@gmail.com", "bug_id": 624867, "text": "** PRODUCT DRIVERS PLEASE NOTE **\n\nThis bug is one of 19 being moved from blocking2.0:betaN+ to blocking2.0:- as we reached the endgame of Firefox 4. The rationale for the move is:\n\n - the bug had been identified as a \"soft\" blocker which could be fixed in some follow up release\n - the bug had been identified as one requiring beta coverage, thus is not appropriate for a \".x\" stability & security release\n\nThe owner of the bug may wish to renominate for .x consideration.", "time": "2011-03-03T15:11:52Z", "creation_time": "2011-03-03T15:11:52Z", "creator": "mbeltzner@gmail.com", "raw_text": "** PRODUCT DRIVERS PLEASE NOTE **\n\nThis bug is one of 19 being moved from blocking2.0:betaN+ to blocking2.0:- as we reached the endgame of Firefox 4. The rationale for the move is:\n\n - the bug had been identified as a \"soft\" blocker which could be fixed in some follow up release\n - the bug had been identified as one requiring beta coverage, thus is not appropriate for a \".x\" stability & security release\n\nThe owner of the bug may wish to renominate for .x consideration.", "attachment_id": null}, {"text": "(er updating flag to \"-\" as per previous comment!)", "bug_id": 624867, "creation_time": "2011-03-03T15:18:38Z", "time": "2011-03-03T15:18:38Z", "raw_text": "(er updating flag to \"-\" as per previous comment!)", "creator": "mbeltzner@gmail.com", "attachment_id": null, "tags": [], "id": 5318527, "is_private": false, "author": "mbeltzner@gmail.com", "count": 22}, {"id": 5319106, "tags": [], "is_private": false, "count": 23, "author": "joe@drew.ca", "bug_id": 624867, "text": "Comment on attachment 502945\nProposed patch.\n\nWas backed out, thus is no longer approved!", "time": "2011-03-03T18:09:31Z", "creation_time": "2011-03-03T18:09:31Z", "creator": "joe@drew.ca", "raw_text": "Was backed out, thus is no longer approved!", "attachment_id": 502945}, {"is_private": false, "tags": [], "id": 5359830, "author": "ehsan.akhgari@gmail.com", "count": 24, "creation_time": "2011-03-22T15:11:24Z", "time": "2011-03-22T15:11:24Z", "text": "I wanted to land this bug on cedar, but it was not obvious which patch(es) should land.  Please submit a patch which is ready to land on cedar (or push there yourself directly).", "bug_id": 624867, "creator": "ehsan.akhgari@gmail.com", "raw_text": "I wanted to land this bug on cedar, but it was not obvious which patch(es) should land.  Please submit a patch which is ready to land on cedar (or push there yourself directly).", "attachment_id": null}]}}}