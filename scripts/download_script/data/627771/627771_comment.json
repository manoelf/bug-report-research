{"bugs": {"627771": {"comments": [{"time": "2011-01-21T17:46:31Z", "author": "themoz@tsotech.com", "attachment_id": null, "creator": "themoz@tsotech.com", "bug_id": 627771, "raw_text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10\nBuild Identifier: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10\n\nThis is wishful thinking, but please consider adding a dithering algorithm to the gradient rendering (for example, as used by -moz-linear-gradient).  The limited colors available in 24-bit \"truecolor\" cause visible banding regardless of the presence of alpha.\n\nIn Firefox, the banding is especially perceivable with vertical gradients.  This is because web content so often scrolls vertically.  The color transitions are made more recognizable when scrolling/moving the content.\n\nBug 619834 cites banding when alpha is used, but the banding exists in both cases.  Banding is perhaps more severe with alpha or affected by an unrelated bug, but that's not the matter at hand here.\n\nThe test case I am attaching shows vertical gradients and the subtle but nevertheless quite recognizable color transitions.  These are visible on Windows 7; I have not tested any other platform.  I don't know anything about the internals of Gecko's gradient rendering, but if a dithering algorithm were somehow introduced, this minor issue could be eliminated.\n\nAs an aside, weren't 30-bit or 32-bit color depths introduced in the 1990s?  It's a pity we're still stuck with 24-bit.\n\nReproducible: Always\n\nSteps to Reproduce:\nSee test case.\nActual Results:  \nOn Windows 7, visible color transitions are seen.\n\nExpected Results:  \nWith 32-bit color, the transitions would be imperceptible.  In 24-bit color, a dithering algorithm could help achieve the same result.", "tags": [], "creation_time": "2011-01-21T17:46:31Z", "is_private": false, "text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10\nBuild Identifier: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10\n\nThis is wishful thinking, but please consider adding a dithering algorithm to the gradient rendering (for example, as used by -moz-linear-gradient).  The limited colors available in 24-bit \"truecolor\" cause visible banding regardless of the presence of alpha.\n\nIn Firefox, the banding is especially perceivable with vertical gradients.  This is because web content so often scrolls vertically.  The color transitions are made more recognizable when scrolling/moving the content.\n\nBug 619834 cites banding when alpha is used, but the banding exists in both cases.  Banding is perhaps more severe with alpha or affected by an unrelated bug, but that's not the matter at hand here.\n\nThe test case I am attaching shows vertical gradients and the subtle but nevertheless quite recognizable color transitions.  These are visible on Windows 7; I have not tested any other platform.  I don't know anything about the internals of Gecko's gradient rendering, but if a dithering algorithm were somehow introduced, this minor issue could be eliminated.\n\nAs an aside, weren't 30-bit or 32-bit color depths introduced in the 1990s?  It's a pity we're still stuck with 24-bit.\n\nReproducible: Always\n\nSteps to Reproduce:\nSee test case.\nActual Results:  \nOn Windows 7, visible color transitions are seen.\n\nExpected Results:  \nWith 32-bit color, the transitions would be imperceptible.  In 24-bit color, a dithering algorithm could help achieve the same result.", "count": 0, "id": 5217180}, {"time": "2011-01-21T17:47:18Z", "attachment_id": 505838, "creator": "themoz@tsotech.com", "author": "themoz@tsotech.com", "bug_id": 627771, "raw_text": "", "creation_time": "2011-01-21T17:47:18Z", "tags": [], "text": "Created attachment 505838\nAn example with vertical gradients using both non-alpha and alpha colors", "is_private": false, "id": 5217184, "count": 1}, {"time": "2011-06-18T15:22:42Z", "attachment_id": null, "creator": "samlie888@gmail.com", "author": "samlie888@gmail.com", "bug_id": 627771, "raw_text": "Perhaps, a new css attribute which specify how much dithering to use.\n\nbackground: -moz-linear-gradient(left, #E7E7E2, #CDCDCD, dither: 20%);", "creation_time": "2011-06-18T15:22:42Z", "tags": [], "is_private": false, "text": "Perhaps, a new css attribute which specify how much dithering to use.\n\nbackground: -moz-linear-gradient(left, #E7E7E2, #CDCDCD, dither: 20%);", "count": 2, "id": 5540892}, {"raw_text": "I just noticed this on youtube's background, which uses a #555 to #333 greyscale gradient. That only yields 34 possible color stops over several 100 pixels in height, i.e. it's noticeable. Dithering certainly would help here.", "bug_id": 627771, "author": "bugzilla.mozilla.org@infinite-source.de", "attachment_id": null, "creator": "bugzilla.mozilla.org@infinite-source.de", "time": "2011-07-23T23:04:15Z", "count": 3, "id": 5609396, "text": "I just noticed this on youtube's background, which uses a #555 to #333 greyscale gradient. That only yields 34 possible color stops over several 100 pixels in height, i.e. it's noticeable. Dithering certainly would help here.", "is_private": false, "creation_time": "2011-07-23T23:04:15Z", "tags": []}, {"time": "2013-05-25T18:04:54Z", "attachment_id": null, "creator": "archil@imnadze.ge", "author": "archil@imnadze.ge", "creation_time": "2013-05-25T18:04:54Z", "tags": [], "text": "*** Bug 876125 has been marked as a duplicate of this bug. ***", "is_private": false, "bug_id": 627771, "raw_text": "", "count": 4, "id": 7463552}, {"text": "It looks like this could be beneficial for b2g memory usage.  See bug 1001455.  Is there any way to get it on the roadmap?", "is_private": false, "id": 8712613, "count": 5, "tags": [], "creation_time": "2014-04-25T18:18:26Z", "bug_id": 627771, "raw_text": "It looks like this could be beneficial for b2g memory usage.  See bug 1001455.  Is there any way to get it on the roadmap?", "time": "2014-04-25T18:18:26Z", "attachment_id": null, "author": "ben@wanderview.com", "creator": "ben@wanderview.com"}, {"tags": [], "creation_time": "2014-04-26T02:20:58Z", "id": 8714974, "count": 6, "text": "The author of madVR recently evaluated/implemented several dithering algorithms for dithering 16bit video in realtime (via GPU shaders) to 8bit.\n\nA modified form of ordered dithering called void-and-cluster was found to be trivial to parallelize (unlike various error diffusion algorithms), leaving no visible patterns (unlike ordered dithering) and without introducing too much visual noise (unlike random threshold dithering).", "is_private": false, "creator": "bugzilla.mozilla.org@infinite-source.de", "author": "bugzilla.mozilla.org@infinite-source.de", "attachment_id": null, "time": "2014-04-26T02:20:58Z", "raw_text": "The author of madVR recently evaluated/implemented several dithering algorithms for dithering 16bit video in realtime (via GPU shaders) to 8bit.\n\nA modified form of ordered dithering called void-and-cluster was found to be trivial to parallelize (unlike various error diffusion algorithms), leaving no visible patterns (unlike ordered dithering) and without introducing too much visual noise (unlike random threshold dithering).", "bug_id": 627771}, {"count": 7, "id": 8726415, "is_private": false, "text": "This sounds like the right thing to do - can we get \"product\" to ask for this and explain the benefits?  I see them, but I'm not sure I'm representative of the overall Firefox audience :)  Maybe somebody from UX?", "tags": [], "creation_time": "2014-04-29T15:45:57Z", "raw_text": "This sounds like the right thing to do - can we get \"product\" to ask for this and explain the benefits?  I see them, but I'm not sure I'm representative of the overall Firefox audience :)  Maybe somebody from UX?", "bug_id": 627771, "creator": "milaninbugzilla@gmail.com", "attachment_id": null, "author": "milaninbugzilla@gmail.com", "time": "2014-04-29T15:45:57Z"}, {"raw_text": "", "id": 11350569, "count": 8, "is_private": false, "text": "*** Bug 1007670 has been marked as a duplicate of this bug. ***", "bug_id": 627771, "author": "dbaron@dbaron.org", "attachment_id": null, "creator": "dbaron@dbaron.org", "time": "2016-04-23T18:50:11Z", "tags": [], "creation_time": "2016-04-23T18:50:11Z"}, {"time": "2017-03-24T21:45:55Z", "attachment_id": null, "creator": "dothayer@mozilla.com", "author": "dothayer@mozilla.com", "creation_time": "2017-03-24T21:45:55Z", "tags": [], "is_private": false, "bug_id": 627771, "text": "This should be resolved once webrender is enabled, per https://github.com/servo/webrender/pull/966", "id": 12176837, "count": 9, "raw_text": "This should be resolved once webrender is enabled, per https://github.com/servo/webrender/pull/966"}, {"time": "2018-04-11T10:24:38Z", "attachment_id": null, "author": "kimatg@gmail.com", "creator": "kimatg@gmail.com", "tags": [], "creation_time": "2018-04-11T10:24:38Z", "text": "What's the progress on this issue now? I can see the PR was merged last year, but I still see some banding in gradients when comparing with Safari, where gradients are flawlessly smooth. Not sure if the current rendering is the result after an improvement, or do we have more ways to go?", "is_private": false, "bug_id": 627771, "id": 13197260, "count": 10, "raw_text": "What's the progress on this issue now? I can see the PR was merged last year, but I still see some banding in gradients when comparing with Safari, where gradients are flawlessly smooth. Not sure if the current rendering is the result after an improvement, or do we have more ways to go?"}, {"time": "2018-04-11T16:21:53Z", "creator": "dothayer@mozilla.com", "attachment_id": null, "author": "dothayer@mozilla.com", "tags": [], "creation_time": "2018-04-11T16:21:53Z", "is_private": false, "bug_id": 627771, "text": "(In reply to Hansol Kim (zvuc) from comment #10)\n> What's the progress on this issue now? I can see the PR was merged last\n> year, but I still see some banding in gradients when comparing with Safari,\n> where gradients are flawlessly smooth. Not sure if the current rendering is\n> the result after an improvement, or do we have more ways to go?\n\nIt's dependent on WebRender being enabled in Firefox, which is currently still in development. If you're on Nightly, you can enable WebRender by going to about:config and setting gfx.webrender.all to true.", "count": 11, "id": 13198442, "raw_text": "(In reply to Hansol Kim (zvuc) from comment #10)\n> What's the progress on this issue now? I can see the PR was merged last\n> year, but I still see some banding in gradients when comparing with Safari,\n> where gradients are flawlessly smooth. Not sure if the current rendering is\n> the result after an improvement, or do we have more ways to go?\n\nIt's dependent on WebRender being enabled in Firefox, which is currently still in development. If you're on Nightly, you can enable WebRender by going to about:config and setting gfx.webrender.all to true."}, {"bug_id": 627771, "raw_text": "Is this still being worked on? I've turned on gfx.webrender.all on the latest Nightly version and light gradients all seem fine, but there is still very noticeable banding on dark gradients. Chrome does not have this issue.\n\nMinimal example:\n\n```\nbody, html {\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    background: radial-gradient(circle, #1D1B43, #12102C);\n}\n```", "time": "2020-02-01T13:47:15Z", "creator": "cengels@tuta.io", "author": "cengels@tuta.io", "attachment_id": null, "text": "Is this still being worked on? I've turned on gfx.webrender.all on the latest Nightly version and light gradients all seem fine, but there is still very noticeable banding on dark gradients. Chrome does not have this issue.\n\nMinimal example:\n\n```\nbody, html {\n    width: 100%;\n    height: 100%;\n    margin: 0;\n    padding: 0;\n    background: radial-gradient(circle, #1D1B43, #12102C);\n}\n```", "is_private": false, "id": 14618925, "count": 12, "tags": [], "creation_time": "2020-02-01T13:47:15Z"}, {"time": "2020-02-01T22:38:06Z", "attachment_id": null, "author": "dothayer@mozilla.com", "creator": "dothayer@mozilla.com", "bug_id": 627771, "raw_text": "(In reply to cengels from comment #12)\n> Is this still being worked on? I've turned on gfx.webrender.all on the latest Nightly version and light gradients all seem fine, but there is still very noticeable banding on dark gradients. Chrome does not have this issue.\n\nIt was recently disabled in webrender due to test failures when we started using direct composition[1]. We have some workarounds we were just recently batting around, though. I can't guarantee I can work on this in the near future but if I get any spare time I will.\n\n[1]: In case anyone needs the technical details: as I understand it, when we do direct composition, we get handed an offset into a texture atlas - however, we apply our dithering texture based on `gl_FragCoord`, which means the exact dithering offset is non-deterministic, and thus when comparing with a reference, the two things mismatch on that offset, producing a delta which exceeds our fuzziness limit. The fix _ought_ to be simply supplying and using the compositor-provided offset into the texture atlas in our shaders. Glenn can correct me on this if I got it wrong.", "tags": [], "creation_time": "2020-02-01T22:38:06Z", "text": "(In reply to cengels from comment #12)\n> Is this still being worked on? I've turned on gfx.webrender.all on the latest Nightly version and light gradients all seem fine, but there is still very noticeable banding on dark gradients. Chrome does not have this issue.\n\nIt was recently disabled in webrender due to test failures when we started using direct composition[1]. We have some workarounds we were just recently batting around, though. I can't guarantee I can work on this in the near future but if I get any spare time I will.\n\n[1]: In case anyone needs the technical details: as I understand it, when we do direct composition, we get handed an offset into a texture atlas - however, we apply our dithering texture based on `gl_FragCoord`, which means the exact dithering offset is non-deterministic, and thus when comparing with a reference, the two things mismatch on that offset, producing a delta which exceeds our fuzziness limit. The fix _ought_ to be simply supplying and using the compositor-provided offset into the texture atlas in our shaders. Glenn can correct me on this if I got it wrong.", "is_private": false, "count": 13, "id": 14619071}, {"time": "2021-10-28T00:08:06Z", "creator": "7automaton@gmail.com", "attachment_id": null, "author": "7automaton@gmail.com", "bug_id": 627771, "raw_text": "Hi,\n\nMost other major browsers have gradient support and dither gradients - they look nice and smooth on Chromium-based browsers. It would be such a time saver to be able to use gradients programmatically.\n\n- The lack of dithering is especially noticeable when fading between two colors within 15-25 brightness, in terms of HSB. Take, for instance, this linear gradient:\n\n```css\nbody {\n    background: linear-gradient(62deg, #364739, #1E2923);\n\n    /* Making the gradient continuous */\n    background-repeat: no-repeat;\n    background-attachment: fixed;\n}\n```\n\n- This bug references Windows 7, though this is reproducible on Windows 10.\n\nI'd be very grateful to see this fixed. Thanks.", "creation_time": "2021-10-28T00:08:06Z", "tags": [], "text": "Hi,\n\nMost other major browsers have gradient support and dither gradients - they look nice and smooth on Chromium-based browsers. It would be such a time saver to be able to use gradients programmatically.\n\n- The lack of dithering is especially noticeable when fading between two colors within 15-25 brightness, in terms of HSB. Take, for instance, this linear gradient:\n\n```css\nbody {\n    background: linear-gradient(62deg, #364739, #1E2923);\n\n    /* Making the gradient continuous */\n    background-repeat: no-repeat;\n    background-attachment: fixed;\n}\n```\n\n- This bug references Windows 7, though this is reproducible on Windows 10.\n\nI'd be very grateful to see this fixed. Thanks.", "is_private": false, "id": 15632417, "count": 14}, {"time": "2021-11-20T17:13:55Z", "attachment_id": null, "creator": "graef@milanoengineering.com", "author": "graef@milanoengineering.com", "bug_id": 627771, "raw_text": "This is really a disgrace. The bug was opened 11 years ago, as it seems Firefox has gotten at least one major overhaul with its rendering engine, consumer monitors now offer 10 bits per channel, HDR has become somewhat mainstream - yet here we are having color banding issues, only in Firefox.\n\nWhat compounds the issue is that modern color space awareness makes it even harder to match manually created gradient images with an included dithering to other HTML elements really hard.\n\nI made a small batch file to automatically create gradients with the necessary dithering, to at least not having to fumble around with Photoshop or GIMP:\n\n```\nmagick convert -define png:format=png64 -depth 16 xc:rgb(7.5,7.5,7.5) xc:rgb(18,18,18) xc:rgb(7.5,7.5,7.5) +append -filter Cubic -resize 2048x8! -profile sRGB.icc gradient.png\nmagick convert gradient.png -channel RGB -separate -ordered-dither o8x8,256 -colors 256 -combine -define png:format=png8 -profile sRGB.icc gradient_dithered8.png\n```\n\nHope that helps someone, until Firefox finally catches up to the rest of the browsers.", "creation_time": "2021-11-20T17:13:55Z", "tags": [], "is_private": false, "text": "This is really a disgrace. The bug was opened 11 years ago, as it seems Firefox has gotten at least one major overhaul with its rendering engine, consumer monitors now offer 10 bits per channel, HDR has become somewhat mainstream - yet here we are having color banding issues, only in Firefox.\n\nWhat compounds the issue is that modern color space awareness makes it even harder to match manually created gradient images with an included dithering to other HTML elements really hard.\n\nI made a small batch file to automatically create gradients with the necessary dithering, to at least not having to fumble around with Photoshop or GIMP:\n\n```\nmagick convert -define png:format=png64 -depth 16 xc:rgb(7.5,7.5,7.5) xc:rgb(18,18,18) xc:rgb(7.5,7.5,7.5) +append -filter Cubic -resize 2048x8! -profile sRGB.icc gradient.png\nmagick convert gradient.png -channel RGB -separate -ordered-dither o8x8,256 -colors 256 -combine -define png:format=png8 -profile sRGB.icc gradient_dithered8.png\n```\n\nHope that helps someone, until Firefox finally catches up to the rest of the browsers.", "count": 15, "id": 15664741}, {"raw_text": "I was one of the early reporters of this bug (8 years ago, bug #1007670) and this bug is one of the major reasons why I simply left firefox and I dont care if firefox users have banding now when creating my sites.\nIt's literally ignorant to add useless features, overhaul a UI 10 times even though it was totally usable... but they don't carer about the fundamentals of a web browser. Also I think most of the bugs I reported where either fixed after years or never at all (e.g. becasue it's been succeded by yet another gui overhaul). So I literally stopped reporting firefox bugs a long time ago, sorry.", "id": 15668372, "count": 16, "bug_id": 627771, "text": "I was one of the early reporters of this bug (8 years ago, bug #1007670) and this bug is one of the major reasons why I simply left firefox and I dont care if firefox users have banding now when creating my sites.\nIt's literally ignorant to add useless features, overhaul a UI 10 times even though it was totally usable... but they don't carer about the fundamentals of a web browser. Also I think most of the bugs I reported where either fixed after years or never at all (e.g. becasue it's been succeded by yet another gui overhaul). So I literally stopped reporting firefox bugs a long time ago, sorry.", "is_private": false, "tags": [], "creation_time": "2021-11-23T08:16:00Z", "creator": "nucrap@hotmail.com", "author": "nucrap@hotmail.com", "attachment_id": null, "time": "2021-11-23T08:16:00Z"}, {"tags": [], "creation_time": "2022-01-11T17:34:26Z", "text": "In my opinion it would be better to not support gradients at all than to support it without dithering. At least then authors can use a media query to use a fallback that doesn't look nasty.", "is_private": false, "count": 17, "id": 15728456, "time": "2022-01-11T17:34:26Z", "creator": "mfishe@gmail.com", "author": "mfishe@gmail.com", "attachment_id": null, "bug_id": 627771, "raw_text": "In my opinion it would be better to not support gradients at all than to support it without dithering. At least then authors can use a media query to use a fallback that doesn't look nasty."}, {"time": "2022-01-11T17:43:35Z", "attachment_id": null, "creator": "mfishe@gmail.com", "author": "mfishe@gmail.com", "bug_id": 627771, "raw_text": "Have just created an enhancement bug for that: https://bugzilla.mozilla.org/show_bug.cgi?id=1749560", "creation_time": "2022-01-11T17:43:35Z", "tags": [], "is_private": false, "text": "Have just created an enhancement bug for that: https://bugzilla.mozilla.org/show_bug.cgi?id=1749560", "id": 15728484, "count": 18}, {"count": 19, "raw_text": "After looking into this a bit more, I realise that the CSS specification did not allow dithering until December 2020. Perhaps one of the reasons this bug has not gained any traction in the last 11 years is a perceived need to adhere strictly to the spec.\n\nHowever since December 2020 (this commit: https://github.com/w3c/csswg-drafts/commit/0753dd1eb3d3dfc3784db82830380ce7c9d15989) dithering has been allowed. Other browsers have dithered since well before, if not always.\n\nDoes this change anything?", "id": 15731137, "text": "After looking into this a bit more, I realise that the CSS specification did not allow dithering until December 2020. Perhaps one of the reasons this bug has not gained any traction in the last 11 years is a perceived need to adhere strictly to the spec.\n\nHowever since December 2020 (this commit: https://github.com/w3c/csswg-drafts/commit/0753dd1eb3d3dfc3784db82830380ce7c9d15989) dithering has been allowed. Other browsers have dithered since well before, if not always.\n\nDoes this change anything?", "bug_id": 627771, "is_private": false, "attachment_id": null, "creator": "mfishe@gmail.com", "author": "mfishe@gmail.com", "time": "2022-01-13T09:20:42Z", "tags": [], "creation_time": "2022-01-13T09:20:42Z"}]}}, "comments": {}}