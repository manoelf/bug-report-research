{"comments": {}, "bugs": {"661055": {"comments": [{"bug_id": 661055, "tags": [], "is_private": false, "count": 0, "id": 5504966, "text": "The menu entry and the session restore button on about:home should indicate how many windows and tabs you end up with if you click them.\n\nSomething like \"Restore previous N tabs & M windows\" would do the trick.", "creator": "limi@mozilla.com", "author": "limi@mozilla.com", "time": "2011-06-01T00:12:22Z", "attachment_id": null, "creation_time": "2011-06-01T00:12:22Z", "raw_text": "The menu entry and the session restore button on about:home should indicate how many windows and tabs you end up with if you click them.\n\nSomething like \"Restore previous N tabs & M windows\" would do the trick."}, {"text": "Created attachment 8914121\nBug 661055 - Add restorableObjectsCount getter to SessionStore.jsm\n\nThis returns an object of the form { windows: int, tabs: int } which indicates\nthe number of windows and tabs that can be restored from the previous session.\n\nReview commit: https://reviewboard.mozilla.org/r/185442/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/185442/", "attachment_id": 8914121, "time": "2017-10-01T21:48:43Z", "raw_text": "This returns an object of the form { windows: int, tabs: int } which indicates\nthe number of windows and tabs that can be restored from the previous session.\n\nReview commit: https://reviewboard.mozilla.org/r/185442/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/185442/", "creation_time": "2017-10-01T21:48:43Z", "bug_id": 661055, "tags": ["mozreview-request"], "is_private": false, "count": 1, "id": 12717358, "creator": "moz-ian@perix.co.uk", "author": "moz-ian@perix.co.uk"}, {"creator": "moz-ian@perix.co.uk", "author": "moz-ian@perix.co.uk", "bug_id": 661055, "count": 2, "is_private": false, "tags": ["mozreview-request"], "id": 12717359, "text": "Created attachment 8914122\nBug 661055 - Display number of windows and tabs to be restored from previous session.\n\nThis replaces the labels on the Restore Previous Session menu items on the\nappMenu and History menu with a label including the count of windows and tabs\nthat will be restored.\n\nReview commit: https://reviewboard.mozilla.org/r/185444/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/185444/", "attachment_id": 8914122, "time": "2017-10-01T21:48:43Z", "raw_text": "This replaces the labels on the Restore Previous Session menu items on the\nappMenu and History menu with a label including the count of windows and tabs\nthat will be restored.\n\nReview commit: https://reviewboard.mozilla.org/r/185444/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/185444/", "creation_time": "2017-10-01T21:48:43Z"}, {"text": "So I've got an initial implementation that displays this on the menu items in the History menu and the appMenu (hamburger).  Haven't done about:home yet since the new about:home doesn't have a session restore button, and also haven't done the new hidden restore button in the tab bar that one activates by setting browser.tabs.restorebutton to 1, though at least the latter would be very easy to add (right next to where I've been modifying browser.js).", "attachment_id": null, "time": "2017-10-01T21:54:11Z", "creation_time": "2017-10-01T21:54:11Z", "raw_text": "So I've got an initial implementation that displays this on the menu items in the History menu and the appMenu (hamburger).  Haven't done about:home yet since the new about:home doesn't have a session restore button, and also haven't done the new hidden restore button in the tab bar that one activates by setting browser.tabs.restorebutton to 1, though at least the latter would be very easy to add (right next to where I've been modifying browser.js).", "bug_id": 661055, "tags": [], "count": 3, "is_private": false, "id": 12717361, "creator": "moz-ian@perix.co.uk", "author": "moz-ian@perix.co.uk"}, {"author": "mdeboer@mozilla.com", "creator": "mdeboer@mozilla.com", "bug_id": 661055, "id": 12728138, "tags": ["mozreview-review"], "count": 4, "is_private": false, "attachment_id": 8914121, "time": "2017-10-04T14:27:48Z", "text": "Comment on attachment 8914121\nBug 661055 - Add restorableObjectsCount getter to SessionStore.jsm\n\nhttps://reviewboard.mozilla.org/r/185442/#review191436\n\nf+! This looks like a very reasonable addition to me! It's only missing some documentation in docblock/ JSDoc comments and a - should be simple - unit test.\n\n::: browser/components/sessionstore/SessionStore.jsm:212\n(Diff revision 1)\n>   * This value is controlled by preference privacy.resistFingerprinting.\n>   */\n>  var gResistFingerprintingEnabled = false;\n>  \n>  this.SessionStore = {\n> +  get restorableCounts() {\n\nnit: I'd rename this to 'restorableObjectsCount'. We use the generic, abstract name 'objects' to refer to tab & window objects together elsewhere in this code.", "raw_text": "https://reviewboard.mozilla.org/r/185442/#review191436\n\nf+! This looks like a very reasonable addition to me! It's only missing some documentation in docblock/ JSDoc comments and a - should be simple - unit test.\n\n::: browser/components/sessionstore/SessionStore.jsm:212\n(Diff revision 1)\n>   * This value is controlled by preference privacy.resistFingerprinting.\n>   */\n>  var gResistFingerprintingEnabled = false;\n>  \n>  this.SessionStore = {\n> +  get restorableCounts() {\n\nnit: I'd rename this to 'restorableObjectsCount'. We use the generic, abstract name 'objects' to refer to tab & window objects together elsewhere in this code.", "creation_time": "2017-10-04T14:27:48Z"}, {"id": 12728275, "count": 5, "is_private": false, "tags": ["mozreview-review"], "bug_id": 661055, "creation_time": "2017-10-04T15:01:01Z", "raw_text": "https://reviewboard.mozilla.org/r/185444/#review191454\n\n::: browser/locales/en-US/chrome/browser/browser.properties:403\n(Diff revision 1)\n>  menuUndoCloseWindowSingleTabLabel=#1\n> +# LOCALIZATION NOTE (menuRestoreLastSession): Replaces historyRestoreLastSession.label,\n> +# and appMenuHistory.restoreSession.label from browser.dtd with counts\n> +# %1$S is the no. of windows %2$S is the windows plural form, %3$S is the number\n> +# of tabs %4$S is the tabs plural form (e.g. Restore previous 2 windows and 7 tabs)\n> +menuRestoreLastSession=Restore previous %1$S %2$S and %3$S %4$S\n\nUnfortunately, this structure may work with English and a handful of other languages, but not for all. The only way to make this work properly is not Limi's suggestion as described in comment 0, but more something like:\n\n1. Keep the 'historyRestoreLastSession.label', but perhaps move it to browser.properties and call it 'menuRestoreLastSessionLabel',\n2. Change the label to 'Restore Previous Session #1'\n3. #1 will be replaced by 'menuRestoreLastSessionCount=#1/ #2'\n4. In which #1 will be replaced by 'menuRestoreLastSessionWindowCount=#1 window;#1 windows',\n5. And #2 will be replaced by 'menuRestoreLastSessionTabCount=#1 tab;#1 tabs'.\n6. Remove the labels from the menuitem and toolbarbutton, since they're going to be overridden by the one on the command element, and the unused string(s) from browser.dtd.\n\nDoes this make sense to you? Please let me know if you have any questions!", "time": "2017-10-04T15:01:01Z", "attachment_id": 8914122, "text": "Comment on attachment 8914122\nBug 661055 - Display number of windows and tabs to be restored from previous session.\n\nhttps://reviewboard.mozilla.org/r/185444/#review191454\n\n::: browser/locales/en-US/chrome/browser/browser.properties:403\n(Diff revision 1)\n>  menuUndoCloseWindowSingleTabLabel=#1\n> +# LOCALIZATION NOTE (menuRestoreLastSession): Replaces historyRestoreLastSession.label,\n> +# and appMenuHistory.restoreSession.label from browser.dtd with counts\n> +# %1$S is the no. of windows %2$S is the windows plural form, %3$S is the number\n> +# of tabs %4$S is the tabs plural form (e.g. Restore previous 2 windows and 7 tabs)\n> +menuRestoreLastSession=Restore previous %1$S %2$S and %3$S %4$S\n\nUnfortunately, this structure may work with English and a handful of other languages, but not for all. The only way to make this work properly is not Limi's suggestion as described in comment 0, but more something like:\n\n1. Keep the 'historyRestoreLastSession.label', but perhaps move it to browser.properties and call it 'menuRestoreLastSessionLabel',\n2. Change the label to 'Restore Previous Session #1'\n3. #1 will be replaced by 'menuRestoreLastSessionCount=#1/ #2'\n4. In which #1 will be replaced by 'menuRestoreLastSessionWindowCount=#1 window;#1 windows',\n5. And #2 will be replaced by 'menuRestoreLastSessionTabCount=#1 tab;#1 tabs'.\n6. Remove the labels from the menuitem and toolbarbutton, since they're going to be overridden by the one on the command element, and the unused string(s) from browser.dtd.\n\nDoes this make sense to you? Please let me know if you have any questions!", "author": "mdeboer@mozilla.com", "creator": "mdeboer@mozilla.com"}, {"creator": "moz-ian@perix.co.uk", "author": "moz-ian@perix.co.uk", "creation_time": "2017-10-04T21:45:18Z", "raw_text": "https://reviewboard.mozilla.org/r/185444/#review191454\n\n> Unfortunately, this structure may work with English and a handful of other languages, but not for all. The only way to make this work properly is not Limi's suggestion as described in comment 0, but more something like:\n> \n> 1. Keep the 'historyRestoreLastSession.label', but perhaps move it to browser.properties and call it 'menuRestoreLastSessionLabel',\n> 2. Change the label to 'Restore Previous Session #1'\n> 3. #1 will be replaced by 'menuRestoreLastSessionCount=#1/ #2'\n> 4. In which #1 will be replaced by 'menuRestoreLastSessionWindowCount=#1 window;#1 windows',\n> 5. And #2 will be replaced by 'menuRestoreLastSessionTabCount=#1 tab;#1 tabs'.\n> 6. Remove the labels from the menuitem and toolbarbutton, since they're going to be overridden by the one on the command element, and the unused string(s) from browser.dtd.\n> \n> Does this make sense to you? Please let me know if you have any questions!\n\nMy first question is which scenarios would my current approach fail?  Are there languages that vary the order of the count and word depending on the number?  ie. could you have 'menuRestoreLastSessionTabCount=tab \\#1;\\#2 tabs' Otherwise I'd have though the ability to independently order all four of (tab|window) (word|count) would be enough.\n\nIs it not worth keeping around a default label, in case this code fails somehow and doesn't set the label?\n\nAlso when there is only one window to restore is it worth dropping the mention of window and only presenting tab count, especially as it gets merged with the existing window?", "text": "Comment on attachment 8914122\nBug 661055 - Display number of windows and tabs to be restored from previous session.\n\nhttps://reviewboard.mozilla.org/r/185444/#review191454\n\n> Unfortunately, this structure may work with English and a handful of other languages, but not for all. The only way to make this work properly is not Limi's suggestion as described in comment 0, but more something like:\n> \n> 1. Keep the 'historyRestoreLastSession.label', but perhaps move it to browser.properties and call it 'menuRestoreLastSessionLabel',\n> 2. Change the label to 'Restore Previous Session #1'\n> 3. #1 will be replaced by 'menuRestoreLastSessionCount=#1/ #2'\n> 4. In which #1 will be replaced by 'menuRestoreLastSessionWindowCount=#1 window;#1 windows',\n> 5. And #2 will be replaced by 'menuRestoreLastSessionTabCount=#1 tab;#1 tabs'.\n> 6. Remove the labels from the menuitem and toolbarbutton, since they're going to be overridden by the one on the command element, and the unused string(s) from browser.dtd.\n> \n> Does this make sense to you? Please let me know if you have any questions!\n\nMy first question is which scenarios would my current approach fail?  Are there languages that vary the order of the count and word depending on the number?  ie. could you have 'menuRestoreLastSessionTabCount=tab \\#1;\\#2 tabs' Otherwise I'd have though the ability to independently order all four of (tab|window) (word|count) would be enough.\n\nIs it not worth keeping around a default label, in case this code fails somehow and doesn't set the label?\n\nAlso when there is only one window to restore is it worth dropping the mention of window and only presenting tab count, especially as it gets merged with the existing window?", "time": "2017-10-04T21:45:18Z", "attachment_id": 8914122, "is_private": false, "count": 6, "tags": ["mozreview-review-reply"], "id": 12730054, "bug_id": 661055}, {"creator": "era+mozilla@iki.fi", "author": "era+mozilla@iki.fi", "bug_id": 661055, "tags": [], "is_private": false, "count": 7, "id": 12730996, "text": "It's not just order, it's stuff such as case inflections etc.  There's an enlightening article about the various use cases in various languages in this article (which describes a Perl solution, but the linguistic points are still striking and pertinent here): http://search.cpan.org/dist/Locale-Maketext/lib/Locale/Maketext/TPJ13.pod", "time": "2017-10-05T05:38:43Z", "attachment_id": null, "creation_time": "2017-10-05T05:38:43Z", "raw_text": "It's not just order, it's stuff such as case inflections etc.  There's an enlightening article about the various use cases in various languages in this article (which describes a Perl solution, but the linguistic points are still striking and pertinent here): http://search.cpan.org/dist/Locale-Maketext/lib/Locale/Maketext/TPJ13.pod"}, {"attachment_id": null, "time": "2017-10-05T10:06:49Z", "text": "(In reply to Ian Moody [:Kwan] from comment #6)\n> My first question is which scenarios would my current approach fail?  Are\n> there languages that vary the order of the count and word depending on the\n> number?  ie. could you have 'menuRestoreLastSessionTabCount=tab \\#1;\\#2\n> tabs' Otherwise I'd have though the ability to independently order all four\n> of (tab|window) (word|count) would be enough.\n\nI think the link that era provides is an excellent resource. We have to think of so many variations and my suggestion would cause the least amount of trouble of our l10n friends, I think.\n\n> Is it not worth keeping around a default label, in case this code fails\n> somehow and doesn't set the label?\n\nGood point, although I think that we're in a different category of trouble when this code fails, but ok. :-P\nCan you perhaps at least eliminate one of the two?\n\n> Also when there is only one window to restore is it worth dropping the\n> mention of window and only presenting tab count, especially as it gets\n> merged with the existing window?\n\nYes, I think that's a good idea.", "creation_time": "2017-10-05T10:06:49Z", "raw_text": "(In reply to Ian Moody [:Kwan] from comment #6)\n> My first question is which scenarios would my current approach fail?  Are\n> there languages that vary the order of the count and word depending on the\n> number?  ie. could you have 'menuRestoreLastSessionTabCount=tab \\#1;\\#2\n> tabs' Otherwise I'd have though the ability to independently order all four\n> of (tab|window) (word|count) would be enough.\n\nI think the link that era provides is an excellent resource. We have to think of so many variations and my suggestion would cause the least amount of trouble of our l10n friends, I think.\n\n> Is it not worth keeping around a default label, in case this code fails\n> somehow and doesn't set the label?\n\nGood point, although I think that we're in a different category of trouble when this code fails, but ok. :-P\nCan you perhaps at least eliminate one of the two?\n\n> Also when there is only one window to restore is it worth dropping the\n> mention of window and only presenting tab count, especially as it gets\n> merged with the existing window?\n\nYes, I think that's a good idea.", "bug_id": 661055, "id": 12731557, "is_private": false, "count": 8, "tags": [], "author": "mdeboer@mozilla.com", "creator": "mdeboer@mozilla.com"}, {"attachment_id": null, "time": "2017-10-05T20:08:13Z", "text": "(In reply to era+mozilla from comment #7)\n> It's not just order, it's stuff such as case inflections etc.  There's an\n> enlightening article about the various use cases in various languages in\n> this article (which describes a Perl solution, but the linguistic points are\n> still striking and pertinent here):\n> http://search.cpan.org/dist/Locale-Maketext/lib/Locale/Maketext/TPJ13.pod\n\nOh, I thought I'd handled such things by using PluralForm for \"window(s)\" and \"tab(s)\", but I guess not.  Still more to learn! Languages are hard :S\nThanks for the article!  Quite interesting, even if I don't understand half the technical terms.\n\n(In reply to Mike de Boer [:mikedeboer] from comment #8)\n> (In reply to Ian Moody [:Kwan] from comment #6)\n> > My first question is which scenarios would my current approach fail?  Are\n> > there languages that vary the order of the count and word depending on the\n> > number?  ie. could you have 'menuRestoreLastSessionTabCount=tab \\#1;\\#2\n> > tabs' Otherwise I'd have though the ability to independently order all four\n> > of (tab|window) (word|count) would be enough.\n> \n> I think the link that era provides is an excellent resource. We have to\n> think of so many variations and my suggestion would cause the least amount\n> of trouble of our l10n friends, I think.\n\nNo problem, I'll switch your suggestion.\n\n> > Is it not worth keeping around a default label, in case this code fails\n> > somehow and doesn't set the label?\n> \n> Good point, although I think that we're in a different category of trouble\n> when this code fails, but ok. :-P\n> Can you perhaps at least eliminate one of the two?\n\nSure.  I did wonder why it was duplicated in the first place.  I'll see if the original bug mentions.", "raw_text": "(In reply to era+mozilla from comment #7)\n> It's not just order, it's stuff such as case inflections etc.  There's an\n> enlightening article about the various use cases in various languages in\n> this article (which describes a Perl solution, but the linguistic points are\n> still striking and pertinent here):\n> http://search.cpan.org/dist/Locale-Maketext/lib/Locale/Maketext/TPJ13.pod\n\nOh, I thought I'd handled such things by using PluralForm for \"window(s)\" and \"tab(s)\", but I guess not.  Still more to learn! Languages are hard :S\nThanks for the article!  Quite interesting, even if I don't understand half the technical terms.\n\n(In reply to Mike de Boer [:mikedeboer] from comment #8)\n> (In reply to Ian Moody [:Kwan] from comment #6)\n> > My first question is which scenarios would my current approach fail?  Are\n> > there languages that vary the order of the count and word depending on the\n> > number?  ie. could you have 'menuRestoreLastSessionTabCount=tab \\#1;\\#2\n> > tabs' Otherwise I'd have though the ability to independently order all four\n> > of (tab|window) (word|count) would be enough.\n> \n> I think the link that era provides is an excellent resource. We have to\n> think of so many variations and my suggestion would cause the least amount\n> of trouble of our l10n friends, I think.\n\nNo problem, I'll switch your suggestion.\n\n> > Is it not worth keeping around a default label, in case this code fails\n> > somehow and doesn't set the label?\n> \n> Good point, although I think that we're in a different category of trouble\n> when this code fails, but ok. :-P\n> Can you perhaps at least eliminate one of the two?\n\nSure.  I did wonder why it was duplicated in the first place.  I'll see if the original bug mentions.", "creation_time": "2017-10-05T20:08:13Z", "bug_id": 661055, "id": 12733327, "tags": [], "is_private": false, "count": 9, "author": "moz-ian@perix.co.uk", "creator": "moz-ian@perix.co.uk"}, {"text": "(In reply to Ian Moody [:Kwan] from comment #9)\n> Sure.  I did wonder why it was duplicated in the first place.  I'll see if\n> the original bug mentions.\n\nI think I was the one who introduced that duplicate string ;-) Feel free to remove it.", "time": "2017-10-06T07:43:02Z", "attachment_id": null, "raw_text": "(In reply to Ian Moody [:Kwan] from comment #9)\n> Sure.  I did wonder why it was duplicated in the first place.  I'll see if\n> the original bug mentions.\n\nI think I was the one who introduced that duplicate string ;-) Feel free to remove it.", "creation_time": "2017-10-06T07:43:02Z", "bug_id": 661055, "is_private": false, "count": 10, "tags": [], "id": 12734385, "creator": "mdeboer@mozilla.com", "author": "mdeboer@mozilla.com"}, {"author": "moz-ian@perix.co.uk", "creator": "moz-ian@perix.co.uk", "time": "2017-12-14T21:48:48Z", "attachment_id": 8936936, "text": "Created attachment 8936936\ntest WIP\n\nReview commit: https://reviewboard.mozilla.org/r/207624/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/207624/", "raw_text": "Review commit: https://reviewboard.mozilla.org/r/207624/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/207624/", "creation_time": "2017-12-14T21:48:48Z", "bug_id": 661055, "id": 12919168, "tags": ["mozreview-request"], "count": 11, "is_private": false}, {"creator": "moz-ian@perix.co.uk", "author": "moz-ian@perix.co.uk", "raw_text": "Review request updated; see interdiff: https://reviewboard.mozilla.org/r/185442/diff/1-2/", "creation_time": "2017-12-14T21:48:48Z", "text": "Comment on attachment 8914121\nBug 661055 - Add restorableObjectsCount getter to SessionStore.jsm\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/185442/diff/1-2/", "attachment_id": 8914121, "time": "2017-12-14T21:48:48Z", "count": 12, "is_private": false, "tags": ["mozreview-request"], "id": 12919169, "bug_id": 661055}, {"bug_id": 661055, "id": 12919170, "is_private": false, "count": 13, "tags": ["mozreview-request"], "time": "2017-12-14T21:48:48Z", "attachment_id": 8914122, "text": "Comment on attachment 8914122\nBug 661055 - Display number of windows and tabs to be restored from previous session.\n\nReview request updated; see interdiff: https://reviewboard.mozilla.org/r/185444/diff/1-2/", "creation_time": "2017-12-14T21:48:48Z", "raw_text": "Review request updated; see interdiff: https://reviewboard.mozilla.org/r/185444/diff/1-2/", "author": "moz-ian@perix.co.uk", "creator": "moz-ian@perix.co.uk"}, {"author": "moz-ian@perix.co.uk", "creator": "moz-ian@perix.co.uk", "creation_time": "2017-12-14T21:52:01Z", "raw_text": "Sorry for the lag, I got a bit stuck on the test, and then distracted by other things.\n\nI'm afraid I can't figure out how to get SessionStore initialised so that the function works, so I'm looking for some pointers.\n\nI see that you're on PTO at the moment though so I'll wait to needinfo you until after it's over.", "time": "2017-12-14T21:52:01Z", "attachment_id": null, "text": "Sorry for the lag, I got a bit stuck on the test, and then distracted by other things.\n\nI'm afraid I can't figure out how to get SessionStore initialised so that the function works, so I'm looking for some pointers.\n\nI see that you're on PTO at the moment though so I'll wait to needinfo you until after it's over.", "id": 12919179, "is_private": false, "count": 14, "tags": [], "bug_id": 661055}, {"creator": "mdeboer@mozilla.com", "author": "mdeboer@mozilla.com", "tags": [], "is_private": false, "count": 15, "id": 12978928, "bug_id": 661055, "raw_text": "Hi Ian! I can see why you can't get the test to work: SessionStore.jsm initialization relies on various browser-specific mechanics to be present and running, which means that you have to write a browser-chrome test instead of an xpcshell test.\n\nYou can find many examples of this type of test in the 'browser/components/sessionstore/test/' folder - they're all prefixed with 'browser_', like 'browser_capabilities.js'.\nI recommend checking a couple of these test (the most recently added ones, for example) and use them as a starting point for your own unit test.", "creation_time": "2018-01-18T12:43:08Z", "text": "Hi Ian! I can see why you can't get the test to work: SessionStore.jsm initialization relies on various browser-specific mechanics to be present and running, which means that you have to write a browser-chrome test instead of an xpcshell test.\n\nYou can find many examples of this type of test in the 'browser/components/sessionstore/test/' folder - they're all prefixed with 'browser_', like 'browser_capabilities.js'.\nI recommend checking a couple of these test (the most recently added ones, for example) and use them as a starting point for your own unit test.", "time": "2018-01-18T12:43:08Z", "attachment_id": null}]}}}