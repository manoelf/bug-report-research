{"bugs": {"668827": {"comments": [{"author": "rocketraman@gmail.com", "time": "2011-07-01T15:47:53Z", "creation_time": "2011-07-01T15:47:53Z", "creator": "rocketraman@gmail.com", "id": 5569649, "count": 0, "is_private": false, "tags": [], "text": "User Agent: Mozilla/5.0 (X11; Linux i686 (x86_64)) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/13.0.782.32 Safari/535.1\n\nSteps to reproduce:\n\nI have received an S/MIME message from a correspondent.\n\n\nActual results:\n\nI was able to open the S/MIME message in Outlook but not in Thunderbird.\n\nThunderbird incorrectly produced the message:\n\n\"Thunderbird cannot decrypt this message. The sender encrypted this message to you using one of your digital certificates, however Thunderbird was not able to find this certificate and corresponding private key. Possible solutions: ...\"\n\nThe decryption key and certificate are definitely available in the certificate store.\n\nI decrypted the message using openssl:\n\n\nopenssl smime -decrypt -in smime_email.eml -inform SMIME \\\n  -recip ramancert.pem -inkey raman.pem > decrypted.bin\n\nI noted in the decrypted.bin file that reason Thunderbird was not able to show the message was that the sender has incorrectly formatted the S/MIME message by adding the RFC822 headers above the MIME Content-Type declaration.\n\n\nExpected results:\n\nOutlook does open this incorrectly formatted message correctly (they seem to be following Postel's Law about being liberal in accepting incoming data), and since many vendors use Outlook for testing, Thunderbird should probably also be tolerant enough to accept this data.\n\nAt the very least, Thunderbird should not incorrectly show the \"Thunderbird was not able to find this certificate and corresponding private key.\" message, since it is not correct. Thunderbird should, if it cannot parse the data, at least show a relevant message to that affect. Something like:\n\n\"Thunderbird was able to decrypt the email but the decrypted data was not valid. The decrypted data is attached. Please contact the sender and ask them to verify that the sending system is correctly formatting the encrypted email. The attached data may be helpful in debugging the issue.\"", "bug_id": 668827, "raw_text": "User Agent: Mozilla/5.0 (X11; Linux i686 (x86_64)) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/13.0.782.32 Safari/535.1\n\nSteps to reproduce:\n\nI have received an S/MIME message from a correspondent.\n\n\nActual results:\n\nI was able to open the S/MIME message in Outlook but not in Thunderbird.\n\nThunderbird incorrectly produced the message:\n\n\"Thunderbird cannot decrypt this message. The sender encrypted this message to you using one of your digital certificates, however Thunderbird was not able to find this certificate and corresponding private key. Possible solutions: ...\"\n\nThe decryption key and certificate are definitely available in the certificate store.\n\nI decrypted the message using openssl:\n\n\nopenssl smime -decrypt -in smime_email.eml -inform SMIME \\\n  -recip ramancert.pem -inkey raman.pem > decrypted.bin\n\nI noted in the decrypted.bin file that reason Thunderbird was not able to show the message was that the sender has incorrectly formatted the S/MIME message by adding the RFC822 headers above the MIME Content-Type declaration.\n\n\nExpected results:\n\nOutlook does open this incorrectly formatted message correctly (they seem to be following Postel's Law about being liberal in accepting incoming data), and since many vendors use Outlook for testing, Thunderbird should probably also be tolerant enough to accept this data.\n\nAt the very least, Thunderbird should not incorrectly show the \"Thunderbird was not able to find this certificate and corresponding private key.\" message, since it is not correct. Thunderbird should, if it cannot parse the data, at least show a relevant message to that affect. Something like:\n\n\"Thunderbird was able to decrypt the email but the decrypted data was not valid. The decrypted data is attached. Please contact the sender and ask them to verify that the sending system is correctly formatting the encrypted email. The attached data may be helpful in debugging the issue.\"", "attachment_id": null}, {"bug_id": 668827, "text": "How many certificates do you have in your certificate store ?\n\nWe very recently changed the way we where looking for certs , does it work better if you use https://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-earlybird/ ?", "tags": [], "attachment_id": null, "raw_text": "How many certificates do you have in your certificate store ?\n\nWe very recently changed the way we where looking for certs , does it work better if you use https://ftp.mozilla.org/pub/mozilla.org/thunderbird/nightly/latest-earlybird/ ?", "time": "2011-07-05T09:32:34Z", "creation_time": "2011-07-05T09:32:34Z", "creator": "ludovic@hirlimann.net", "author": "ludovic@hirlimann.net", "id": 5573562, "count": 1, "is_private": false}, {"bug_id": 668827, "text": "It does not work with the earlybird as of today: http://img811.imageshack.us/img811/10/kde3.png\n\nNote again though that, despite the error message, the issue is NOT that Thunderbird cannot find the certificate. Thunderbird CAN find the certificate and I believe it does successfully decrypt the message, as is evidenced by being able to successfully read other S/MIME emails sent to this address.\n\nTherefore the message that Thunderbird is unable to find the key/certificate and decrypt the message is wrong -- in actuality Thunderbird is simply unable to parse the decrypted data since it does not conform to the RFC specification and it seems to fall back to the same error message. I can send the decrypted S/MIME data privately if it would help.\n\nSo as per my original report there are two aspects to this bug:\n\n1) The message that Thunderbird cannot find the certificate is incorrect. See the original report for a suggested improvement.\n\n2) The MIME parser for the decrypted S/MIME data does not tolerate incorrectly formatted messages, even though Outlook does handle the same incorrect message.", "tags": [], "raw_text": "It does not work with the earlybird as of today: http://img811.imageshack.us/img811/10/kde3.png\n\nNote again though that, despite the error message, the issue is NOT that Thunderbird cannot find the certificate. Thunderbird CAN find the certificate and I believe it does successfully decrypt the message, as is evidenced by being able to successfully read other S/MIME emails sent to this address.\n\nTherefore the message that Thunderbird is unable to find the key/certificate and decrypt the message is wrong -- in actuality Thunderbird is simply unable to parse the decrypted data since it does not conform to the RFC specification and it seems to fall back to the same error message. I can send the decrypted S/MIME data privately if it would help.\n\nSo as per my original report there are two aspects to this bug:\n\n1) The message that Thunderbird cannot find the certificate is incorrect. See the original report for a suggested improvement.\n\n2) The MIME parser for the decrypted S/MIME data does not tolerate incorrectly formatted messages, even though Outlook does handle the same incorrect message.", "attachment_id": null, "author": "rocketraman@gmail.com", "creator": "rocketraman@gmail.com", "time": "2011-07-05T14:54:25Z", "creation_time": "2011-07-05T14:54:25Z", "is_private": false, "id": 5573890, "count": 2}, {"time": "2011-07-05T14:56:20Z", "creation_time": "2011-07-05T14:56:20Z", "creator": "ludovic@hirlimann.net", "author": "ludovic@hirlimann.net", "id": 5573893, "count": 3, "is_private": false, "bug_id": 668827, "text": "Can we get a test message or at least the mime structure of said message ?", "tags": [], "attachment_id": null, "raw_text": "Can we get a test message or at least the mime structure of said message ?"}, {"bug_id": 668827, "text": "Created attachment 543958\nFirst decrypted message", "tags": [], "raw_text": "", "attachment_id": 543958, "author": "rocketraman@gmail.com", "time": "2011-07-05T15:36:03Z", "creation_time": "2011-07-05T15:36:03Z", "creator": "rocketraman@gmail.com", "id": 5573981, "count": 4, "is_private": false}, {"author": "rocketraman@gmail.com", "time": "2011-07-05T15:37:00Z", "creation_time": "2011-07-05T15:37:00Z", "creator": "rocketraman@gmail.com", "id": 5573984, "count": 5, "is_private": false, "bug_id": 668827, "text": "Created attachment 543961\nSecond decrypted message\n\nI have attached two decrypted messages (decrypted-1.bin and decrypted-2.bin) with the sender obfuscated to protect their identity -- from embarassment due to their poor technology, mostly, but since they are one of my clients... :)\n\nThe main change I made is to replace their attached certificate with a placeholder, and any reference to their names or domain name or IP addresses was replaced with \"xxx\"'s.\n\nI see the following issues with their data in decrypted-1.bin:\n\n1) They have RFC822 headers at the top of the message.\n\n2) There is some binary junk within those RFC822 headers.\n\n3) The MIME part that contains their cert doesn't declare any Content-Type.\n\nOutlook parses this and displays it correctly.\n\ndecrypted-2.bin seems even more messed up, since the MIME parts don't even appear to be correctly separated with a boundary. However, again, somehow Outlook does parse this and display this email correctly.\n\nTo be honest, it would be great if Thunderbird could parse these (since Outlook does), but I wouldn't be surprised if you decide not to. However, as per my original report, at the very least the error message should not be that the key could not be found.", "tags": [], "raw_text": "I have attached two decrypted messages (decrypted-1.bin and decrypted-2.bin) with the sender obfuscated to protect their identity -- from embarassment due to their poor technology, mostly, but since they are one of my clients... :)\n\nThe main change I made is to replace their attached certificate with a placeholder, and any reference to their names or domain name or IP addresses was replaced with \"xxx\"'s.\n\nI see the following issues with their data in decrypted-1.bin:\n\n1) They have RFC822 headers at the top of the message.\n\n2) There is some binary junk within those RFC822 headers.\n\n3) The MIME part that contains their cert doesn't declare any Content-Type.\n\nOutlook parses this and displays it correctly.\n\ndecrypted-2.bin seems even more messed up, since the MIME parts don't even appear to be correctly separated with a boundary. However, again, somehow Outlook does parse this and display this email correctly.\n\nTo be honest, it would be great if Thunderbird could parse these (since Outlook does), but I wouldn't be surprised if you decide not to. However, as per my original report, at the very least the error message should not be that the key could not be found.", "attachment_id": 543961}, {"attachment_id": null, "raw_text": "Content-Type: application/x-pkcs7-mime;\n        name=\"smime.p7m\"\nContent-Transfer-Encoding: binary\nContent-Disposition: attachment;\n        filename=\"smime.p7m\"", "bug_id": 668827, "text": "Content-Type: application/x-pkcs7-mime;\n        name=\"smime.p7m\"\nContent-Transfer-Encoding: binary\nContent-Disposition: attachment;\n        filename=\"smime.p7m\"", "tags": [], "is_private": false, "count": 6, "id": 5573997, "creator": "ludovic@hirlimann.net", "creation_time": "2011-07-05T15:41:03Z", "time": "2011-07-05T15:41:03Z", "author": "ludovic@hirlimann.net"}]}}, "comments": {}}