{"comments": {}, "bugs": {"691038": {"comments": [{"creation_time": "2011-10-01T12:47:17Z", "time": "2011-10-01T12:47:17Z", "creator": "rogerfgay@isr.nu", "author": "rogerfgay@isr.nu", "count": 0, "id": 5751797, "is_private": false, "tags": [], "bug_id": 691038, "text": "User Agent: Mozilla/5.0 (Windows NT 6.0; WOW64) AppleWebKit/535.5 (KHTML, like Gecko) Chrome/16.0.891.0 Safari/535.5\n\nSteps to reproduce:\n\nI have seen this bug in beta 7 and 8. Those are the only Firefox browsers that support version 8 websockets that I've tried so far.\n\nRan the following websocket test page: http://isr.nu/ws/WebSocketTest.htm\n\nThe page is public, and other people are running it too, on a variety of browsers. I'm running the default server shown on the page.\n\n\nActual results:\n\nOn close, Firefox throws an error related to the message sent with close. The ERROR is reported by printing ERROR to the web page.\n\n\nExpected results:\n\nThe page is designed to print the close message. It should have printed the close message instead of the ERROR message.", "attachment_id": null, "raw_text": "User Agent: Mozilla/5.0 (Windows NT 6.0; WOW64) AppleWebKit/535.5 (KHTML, like Gecko) Chrome/16.0.891.0 Safari/535.5\n\nSteps to reproduce:\n\nI have seen this bug in beta 7 and 8. Those are the only Firefox browsers that support version 8 websockets that I've tried so far.\n\nRan the following websocket test page: http://isr.nu/ws/WebSocketTest.htm\n\nThe page is public, and other people are running it too, on a variety of browsers. I'm running the default server shown on the page.\n\n\nActual results:\n\nOn close, Firefox throws an error related to the message sent with close. The ERROR is reported by printing ERROR to the web page.\n\n\nExpected results:\n\nThe page is designed to print the close message. It should have printed the close message instead of the ERROR message."}, {"count": 1, "id": 5752125, "is_private": false, "author": "John99-bugs@live.co.uk", "creation_time": "2011-10-01T20:47:09Z", "time": "2011-10-01T20:47:09Z", "creator": "John99-bugs@live.co.uk", "raw_text": "I am not sure I see any problem with that page. Have you tried firefox in safe mode ?\n\nWhen I try the page you mention if I try the button on the top left hand side saying \n> Close Connection\nthe response in the right Hand Side of the test page is \n> NOT CONNECTED \nwhich displays in red.", "attachment_id": null, "bug_id": 691038, "text": "I am not sure I see any problem with that page. Have you tried firefox in safe mode ?\n\nWhen I try the page you mention if I try the button on the top left hand side saying \n> Close Connection\nthe response in the right Hand Side of the test page is \n> NOT CONNECTED \nwhich displays in red.", "tags": []}, {"id": 5752215, "count": 2, "is_private": false, "creation_time": "2011-10-01T22:43:27Z", "time": "2011-10-01T22:43:27Z", "creator": "rogerfgay@isr.nu", "author": "rogerfgay@isr.nu", "attachment_id": null, "raw_text": "You have to connect before you can close.", "text": "You have to connect before you can close.", "bug_id": 691038, "tags": []}, {"attachment_id": null, "raw_text": "Latest version of the protocol (hybi-17) clarifies closing handshake. The \"bye\" message that was sent by the server was invalid. Server now responds immediately with a closing handshake and the test was repeated. Firefox does not throw an error.\n\nSending a \"bye\" text message after receiving a close request from the browser is invalid.", "tags": [], "bug_id": 691038, "text": "Latest version of the protocol (hybi-17) clarifies closing handshake. The \"bye\" message that was sent by the server was invalid. Server now responds immediately with a closing handshake and the test was repeated. Firefox does not throw an error.\n\nSending a \"bye\" text message after receiving a close request from the browser is invalid.", "is_private": false, "count": 3, "id": 5752586, "creator": "rogerfgay@isr.nu", "time": "2011-10-02T10:40:36Z", "creation_time": "2011-10-02T10:40:36Z", "author": "rogerfgay@isr.nu"}, {"author": "rogerfgay@isr.nu", "creator": "rogerfgay@isr.nu", "creation_time": "2011-10-02T14:06:42Z", "time": "2011-10-02T14:06:42Z", "is_private": false, "id": 5752723, "count": 4, "bug_id": 691038, "text": "I'm reopening this. After several hours of one-ended analysis (I work with server code) I discovered that the Firefox error is not thrown when the /reason/ code (ref. section 5.5.1. of hybi-17 quoted below) is returned along with the close frame. This is not required by the standard and appears to be an error in the Firefox code.\n\nNote that the /reason/ code is optional and the standard does not specify any particular processing of the reason code.\n\n   Following the 2-byte integer the body MAY contain UTF-8\n   encoded data with value /reason/, the interpretation of which is not\n   defined by this specification.\n\n5.5.1.  Close\n\n   The Close frame contains an opcode of 0x8.\n\n   The Close frame MAY contain a body (the \"application data\" portion of\n   the frame) that indicates a reason for closing, such as an endpoint\n   shutting down, an endpoint having received a frame too large, or an\n   endpoint having received a frame that does not conform to the format\n   expected by the other endpoint.  If there is a body, the first two\n   bytes of the body MUST be a 2-byte unsigned integer (in network byte\n   order) representing a status code with value /code/ defined in\n   Section 7.4.  Following the 2-byte integer the body MAY contain UTF-8\n   encoded data with value /reason/, the interpretation of which is not\n   defined by this specification.  This data is not necessarily human\n   readable, but may be useful for debugging or passing information\n   relevant to the script that opened the connection.  As the data is\n   not guaranteed to be human readable, clients MUST NOT show it to end\n   users.\n\n   Close frames sent from client to server must be masked as per\n   Section 5.3.\n\n   The application MUST NOT send any more data frames after sending a\n   close frame.", "tags": [], "raw_text": "I'm reopening this. After several hours of one-ended analysis (I work with server code) I discovered that the Firefox error is not thrown when the /reason/ code (ref. section 5.5.1. of hybi-17 quoted below) is returned along with the close frame. This is not required by the standard and appears to be an error in the Firefox code.\n\nNote that the /reason/ code is optional and the standard does not specify any particular processing of the reason code.\n\n   Following the 2-byte integer the body MAY contain UTF-8\n   encoded data with value /reason/, the interpretation of which is not\n   defined by this specification.\n\n5.5.1.  Close\n\n   The Close frame contains an opcode of 0x8.\n\n   The Close frame MAY contain a body (the \"application data\" portion of\n   the frame) that indicates a reason for closing, such as an endpoint\n   shutting down, an endpoint having received a frame too large, or an\n   endpoint having received a frame that does not conform to the format\n   expected by the other endpoint.  If there is a body, the first two\n   bytes of the body MUST be a 2-byte unsigned integer (in network byte\n   order) representing a status code with value /code/ defined in\n   Section 7.4.  Following the 2-byte integer the body MAY contain UTF-8\n   encoded data with value /reason/, the interpretation of which is not\n   defined by this specification.  This data is not necessarily human\n   readable, but may be useful for debugging or passing information\n   relevant to the script that opened the connection.  As the data is\n   not guaranteed to be human readable, clients MUST NOT show it to end\n   users.\n\n   Close frames sent from client to server must be masked as per\n   Section 5.3.\n\n   The application MUST NOT send any more data frames after sending a\n   close frame.", "attachment_id": null}, {"author": "rogerfgay@isr.nu", "creator": "rogerfgay@isr.nu", "creation_time": "2011-10-02T14:09:11Z", "time": "2011-10-02T14:09:11Z", "is_private": false, "count": 5, "id": 5752724, "text": "Firefox appears to send an optional non-human readable code in the application data that must be returned by the server, else Firefox throws an error.", "bug_id": 691038, "tags": [], "raw_text": "Firefox appears to send an optional non-human readable code in the application data that must be returned by the server, else Firefox throws an error.", "attachment_id": null}, {"author": "mcmanus@ducksong.com", "creation_time": "2011-10-02T14:30:49Z", "time": "2011-10-02T14:30:49Z", "creator": "mcmanus@ducksong.com", "id": 5752756, "count": 6, "is_private": false, "tags": [], "bug_id": 691038, "text": "Roger is it fair to sum things up by saying that you claim:\n\n\"firefox generates a javascript onerror() event when receiving a close frame without a reason code\".\n\nIf that is accurate, have you tested when this close is sent on half-open session vs a fully open session?\n\nIf this is not an accurate summary, please help me understand. If that is accurate, I can test it out.\n\nAlso, while I don't think there is a difference in this case, draft-17 is not relevant to this implementation which uses draft-10. Please cite onlythe appropriate document to avoid confusion.", "raw_text": "Roger is it fair to sum things up by saying that you claim:\n\n\"firefox generates a javascript onerror() event when receiving a close frame without a reason code\".\n\nIf that is accurate, have you tested when this close is sent on half-open session vs a fully open session?\n\nIf this is not an accurate summary, please help me understand. If that is accurate, I can test it out.\n\nAlso, while I don't think there is a difference in this case, draft-17 is not relevant to this implementation which uses draft-10. Please cite onlythe appropriate document to avoid confusion.", "attachment_id": null}, {"bug_id": 691038, "text": "I think your description is accurate. I stopped it from happening only after unmasking the /reason/ code received from Firefox and then returning the same reason code. The session is fully open and messages can continue to pass no matter how many times the error occurs. (My server doesn't close on such errors right now - it's better for a dev version I think, although I know I'll have to change it.)\n\nGood point about the hybi revision. I click on the link at websocket.org because they keep it up to date. Seemed to me that a later version would provide clarification if anything. Hybi-10 also says that the codes are optional. \nhttp://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-10#section-4.5", "tags": [], "attachment_id": null, "raw_text": "I think your description is accurate. I stopped it from happening only after unmasking the /reason/ code received from Firefox and then returning the same reason code. The session is fully open and messages can continue to pass no matter how many times the error occurs. (My server doesn't close on such errors right now - it's better for a dev version I think, although I know I'll have to change it.)\n\nGood point about the hybi revision. I click on the link at websocket.org because they keep it up to date. Seemed to me that a later version would provide clarification if anything. Hybi-10 also says that the codes are optional. \nhttp://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-10#section-4.5", "creator": "rogerfgay@isr.nu", "time": "2011-10-02T15:53:42Z", "creation_time": "2011-10-02T15:53:42Z", "author": "rogerfgay@isr.nu", "is_private": false, "id": 5752806, "count": 7}, {"raw_text": "Just to be clear, yes: \"firefox generates a javascript onerror() event when receiving a close frame without a reason code\". Extending this claim, only a specific reason code seems to satisfy Firefox. That is described in my last post. Firefox is only satisfied if it receives back the same (cryptic - human unreadable) reason code (after unmasking) that it sent.", "attachment_id": null, "tags": [], "text": "Just to be clear, yes: \"firefox generates a javascript onerror() event when receiving a close frame without a reason code\". Extending this claim, only a specific reason code seems to satisfy Firefox. That is described in my last post. Firefox is only satisfied if it receives back the same (cryptic - human unreadable) reason code (after unmasking) that it sent.", "bug_id": 691038, "is_private": false, "count": 8, "id": 5753584, "author": "rogerfgay@isr.nu", "creator": "rogerfgay@isr.nu", "time": "2011-10-03T07:52:22Z", "creation_time": "2011-10-03T07:52:22Z"}, {"count": 9, "id": 12658228, "is_private": false, "author": "bug-husbandry-bot@mozilla.bugs", "time": "2017-09-13T18:37:09Z", "creation_time": "2017-09-13T18:37:09Z", "creator": "bug-husbandry-bot@mozilla.bugs", "raw_text": "Bulk change to priority: https://bugzilla.mozilla.org/show_bug.cgi?id=1399258", "attachment_id": null, "tags": [], "text": "Bulk change to priority: https://bugzilla.mozilla.org/show_bug.cgi?id=1399258", "bug_id": 691038}, {"attachment_id": null, "raw_text": "Bulk change to priority: https://bugzilla.mozilla.org/show_bug.cgi?id=1399258", "text": "Bulk change to priority: https://bugzilla.mozilla.org/show_bug.cgi?id=1399258", "bug_id": 691038, "tags": [], "is_private": false, "count": 10, "id": 12659779, "creator": "bug-husbandry-bot@mozilla.bugs", "creation_time": "2017-09-13T18:49:12Z", "time": "2017-09-13T18:49:12Z", "author": "bug-husbandry-bot@mozilla.bugs"}]}}}