{"comments": {}, "bugs": {"652225": {"comments": [{"tags": [], "raw_text": "User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0) Gecko/20100101 Firefox/4.0\n\nI've posted about this a while ago on MozillaZine; nobody seemed to have any ideas, but you can find what little discussion there was (as well as my previous description) there:\n\nhttp://forums.mozillazine.org/viewtopic.php?f=9&t=2163197\n\nEssentially the problem as far as i can tell is this: The combination of relative font sizes (ems or percentages) and line-heights which are non-equal to font-size causes Firefox to exhibit inconsistent positioning behaviour.\n\nThree specific places i've encountered this:\n\n1. Using a background-image as a bullet in an unordered list, the bullet images occasionally appear 1 pixel too high or too low.\n\n2. Using a span inside a header (h2) which has borders, the span text occasionally appears 1 pixel too high.\n\n3. Using a background-image as an anchor (link) icon, the icons occasionally appear 1 pixel too high or too low.\n\nI understand that when Firefox encounters fractional pixel sizes, as will often be the case when using relative font sizes, it must round them up or down. The thing that makes this seem like a bug, though, is that the rounding appears to be completely inconsistent: The examples i've described above occur even when the contents of each element are precisely the same, and when the defined and computed styles of each element are precisely the same.\n\nI have uploaded a test page which illustrates the third example (anchor icons) to Dropbox:\n\nhttp://dl.dropbox.com/u/702860/misc/ff-rounding-errors/test.html\n\nYou can see the same thing on any Wikipedia page that has external links, such as:\n\nhttp://en.wikipedia.org/wiki/Scaffold_%28programming%29#External_links\n\nYou can also see screenshots of the above, as well as example #2, in the MozillaZine thread i've linked.\n\nSome additional notes:\n\n- This *might* be Mac-specific \u2014\u00a0i have not been able to reproduce it on Windows 7. I was able to have a Mac-using friend reproduce it on his machine. (We are both on Snow Leopard.)\n\n- Contrary to what i indicated in the MozillaZine thread, i have since been able to reproduce this with fonts other than Helvetica. So, although Helvetica does seem particularly prone to this error, it is not font-specific.\n\n- This does not occur (as far as i can determine) when whole pixel sizes are used; only when relative or fractional sizes are used.\n\n- This does not occur (as far as i can determine) when the line-height is not specified or is equal to the font-size.\n\n- This occurs in both Firefox 3.6.x and Firefox 4.0.1.\n\n- This does not occur in Chrome, Safari, or Opera. (I also have not seen it in IE8, but i have done very little testing there, so i don't think it's conclusive.)\n\nReproducible: Sometimes\n\nSteps to Reproduce:\nSee above\nActual Results:  \nChild elements and/or CSS background-images are positioned inconsistently.\n\nExpected Results:  \nAll elements that have the same content and the same computed style should have the same appearance.\n\nSorry if this is in the wrong section or whatever; i remain forever confused by Bugzilla :(", "bug_id": 652225, "creation_time": "2011-04-22T21:42:08Z", "is_private": false, "id": 5427110, "time": "2011-04-22T21:42:08Z", "creator": "okdana+bugzilla@gmail.com", "attachment_id": null, "count": 0, "text": "User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0) Gecko/20100101 Firefox/4.0\n\nI've posted about this a while ago on MozillaZine; nobody seemed to have any ideas, but you can find what little discussion there was (as well as my previous description) there:\n\nhttp://forums.mozillazine.org/viewtopic.php?f=9&t=2163197\n\nEssentially the problem as far as i can tell is this: The combination of relative font sizes (ems or percentages) and line-heights which are non-equal to font-size causes Firefox to exhibit inconsistent positioning behaviour.\n\nThree specific places i've encountered this:\n\n1. Using a background-image as a bullet in an unordered list, the bullet images occasionally appear 1 pixel too high or too low.\n\n2. Using a span inside a header (h2) which has borders, the span text occasionally appears 1 pixel too high.\n\n3. Using a background-image as an anchor (link) icon, the icons occasionally appear 1 pixel too high or too low.\n\nI understand that when Firefox encounters fractional pixel sizes, as will often be the case when using relative font sizes, it must round them up or down. The thing that makes this seem like a bug, though, is that the rounding appears to be completely inconsistent: The examples i've described above occur even when the contents of each element are precisely the same, and when the defined and computed styles of each element are precisely the same.\n\nI have uploaded a test page which illustrates the third example (anchor icons) to Dropbox:\n\nhttp://dl.dropbox.com/u/702860/misc/ff-rounding-errors/test.html\n\nYou can see the same thing on any Wikipedia page that has external links, such as:\n\nhttp://en.wikipedia.org/wiki/Scaffold_%28programming%29#External_links\n\nYou can also see screenshots of the above, as well as example #2, in the MozillaZine thread i've linked.\n\nSome additional notes:\n\n- This *might* be Mac-specific \u2014\u00a0i have not been able to reproduce it on Windows 7. I was able to have a Mac-using friend reproduce it on his machine. (We are both on Snow Leopard.)\n\n- Contrary to what i indicated in the MozillaZine thread, i have since been able to reproduce this with fonts other than Helvetica. So, although Helvetica does seem particularly prone to this error, it is not font-specific.\n\n- This does not occur (as far as i can determine) when whole pixel sizes are used; only when relative or fractional sizes are used.\n\n- This does not occur (as far as i can determine) when the line-height is not specified or is equal to the font-size.\n\n- This occurs in both Firefox 3.6.x and Firefox 4.0.1.\n\n- This does not occur in Chrome, Safari, or Opera. (I also have not seen it in IE8, but i have done very little testing there, so i don't think it's conclusive.)\n\nReproducible: Sometimes\n\nSteps to Reproduce:\nSee above\nActual Results:  \nChild elements and/or CSS background-images are positioned inconsistently.\n\nExpected Results:  \nAll elements that have the same content and the same computed style should have the same appearance.\n\nSorry if this is in the wrong section or whatever; i remain forever confused by Bugzilla :(", "author": "okdana+bugzilla@gmail.com"}, {"is_private": false, "attachment_id": null, "creator": "bzbarsky@mit.edu", "tags": [], "raw_text": "So is the issue that you're seeing that the image ends up looking misaligned with respect to the _text_ or that the spacing between the lines is not consistent?\n\nIt's possible that we pixel-snap images but don't pixel-snap text....", "bug_id": 652225, "creation_time": "2011-04-23T01:17:22Z", "id": 5427563, "author": "bzbarsky@mit.edu", "time": "2011-04-23T01:17:22Z", "count": 1, "text": "So is the issue that you're seeing that the image ends up looking misaligned with respect to the _text_ or that the spacing between the lines is not consistent?\n\nIt's possible that we pixel-snap images but don't pixel-snap text...."}, {"count": 2, "text": "Well, now that you mention it... both. :/\n\nI'm attaching two images:\n\n(1) wikitest.png \u2014 A blown-up screenshot of the Wikipedia page i linked earlier. In this one, there is a consistent (but still undesirable, i think) pattern: Each line alternates distance between text, and each line alternates distance between images.\n\n(2) mytest.png \u2014\u00a0A blown-up screenshot of a modified version of the test page i linked earlier. This time, there is less of a pattern. Only one line of text is off \u2014 but *two* images are off.\n\nNote that the computed style (as reported by Firebug) is exactly the same for every line.\n\nTo my very untrained eyes it sort of seems like Firefox is maybe saying, OK, there are 6 lines, each one has a line-height of 19.2px, so this list needs to be a total of 6*19.2 pixels tall \u2014\u00a0how can i divide this total height into integer distances and still get as close to 6*19.2 as possible?\n\nPerhaps the image mis-positioning is just a side-effect of that?\n\n(WebKit, meanwhile, puts every list item the same distance apart, which, to me, is the expected behaviour.)", "author": "okdana+bugzilla@gmail.com", "time": "2011-04-23T02:21:33Z", "id": 5427635, "raw_text": "Well, now that you mention it... both. :/\n\nI'm attaching two images:\n\n(1) wikitest.png \u2014 A blown-up screenshot of the Wikipedia page i linked earlier. In this one, there is a consistent (but still undesirable, i think) pattern: Each line alternates distance between text, and each line alternates distance between images.\n\n(2) mytest.png \u2014\u00a0A blown-up screenshot of a modified version of the test page i linked earlier. This time, there is less of a pattern. Only one line of text is off \u2014 but *two* images are off.\n\nNote that the computed style (as reported by Firebug) is exactly the same for every line.\n\nTo my very untrained eyes it sort of seems like Firefox is maybe saying, OK, there are 6 lines, each one has a line-height of 19.2px, so this list needs to be a total of 6*19.2 pixels tall \u2014\u00a0how can i divide this total height into integer distances and still get as close to 6*19.2 as possible?\n\nPerhaps the image mis-positioning is just a side-effect of that?\n\n(WebKit, meanwhile, puts every list item the same distance apart, which, to me, is the expected behaviour.)", "creation_time": "2011-04-23T02:21:33Z", "bug_id": 652225, "creator": "okdana+bugzilla@gmail.com", "tags": [], "is_private": false, "attachment_id": null}, {"creator": "okdana+bugzilla@gmail.com", "attachment_id": 527904, "text": "Created attachment 527904\nblown-up Wikipedia screenshot, with annotations", "count": 3, "author": "okdana+bugzilla@gmail.com", "raw_text": "", "bug_id": 652225, "creation_time": "2011-04-23T02:22:05Z", "tags": [], "is_private": false, "time": "2011-04-23T02:22:05Z", "id": 5427636}, {"id": 5427637, "time": "2011-04-23T02:22:32Z", "is_private": false, "tags": [], "bug_id": 652225, "creation_time": "2011-04-23T02:22:32Z", "raw_text": "", "author": "okdana+bugzilla@gmail.com", "text": "Created attachment 527905\nblown-up test page screenshot, with annotations", "count": 4, "attachment_id": 527905, "creator": "okdana+bugzilla@gmail.com"}, {"tags": [], "creator": "bzbarsky@mit.edu", "bug_id": 652225, "creation_time": "2011-04-23T03:07:30Z", "raw_text": "> To my very untrained eyes it sort of seems like Firefox is maybe saying\n\nThat's more or less what happens, yes.\n\nIn contrast, WebKit rounds to integer pixel lengths much more eagerly, with the result that it can end up with seams at the ends.  So does Opera.  I'll attach a testcase that shows that pretty clearly.\n\nThere's no way to avoid either one problem or the other, so we just have to pick our poison.", "is_private": false, "attachment_id": null, "text": "> To my very untrained eyes it sort of seems like Firefox is maybe saying\n\nThat's more or less what happens, yes.\n\nIn contrast, WebKit rounds to integer pixel lengths much more eagerly, with the result that it can end up with seams at the ends.  So does Opera.  I'll attach a testcase that shows that pretty clearly.\n\nThere's no way to avoid either one problem or the other, so we just have to pick our poison.", "count": 5, "id": 5427655, "time": "2011-04-23T03:07:30Z", "author": "bzbarsky@mit.edu"}, {"id": 5427657, "time": "2011-04-23T03:08:30Z", "tags": [], "bug_id": 652225, "creation_time": "2011-04-23T03:08:30Z", "raw_text": "", "is_private": false, "count": 6, "text": "Created attachment 527908\nTestcase that shows red seam in WebKit and Opera", "author": "bzbarsky@mit.edu", "creator": "bzbarsky@mit.edu", "attachment_id": 527908}, {"is_private": false, "creation_time": "2011-04-23T03:12:15Z", "bug_id": 652225, "raw_text": "In particular, last I checked, WebKit actually converts styles to integer numbers of pixels at parse time.  Which means that in my testcase it's using a line-height of 19px.  This is all kinds of broken with transforms (consider a length of 0.25px scaled up by a factor of 400; this comes out as a length of 0 in WebKit and Opera but a length of 100px in Gecko).", "tags": [], "time": "2011-04-23T03:12:15Z", "id": 5427659, "attachment_id": null, "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu", "count": 7, "text": "In particular, last I checked, WebKit actually converts styles to integer numbers of pixels at parse time.  Which means that in my testcase it's using a line-height of 19px.  This is all kinds of broken with transforms (consider a length of 0.25px scaled up by a factor of 400; this comes out as a length of 0 in WebKit and Opera but a length of 100px in Gecko)."}, {"text": "I am not informed enough to really understand the general implications beyond what you've described, so i will take your word that it's the better system in general. :)\n\nI am confused as to why the background images are not pushed up (or down) with the text, though. The browser-default bullets seem to line up with the text in each example; however, if you have a custom bullet (defined with a background-image) that is, e.g., set to appear 0.5em from the top, one might assume that it will always appear 0.5em from the top regardless of what the height of the line is.\n\nDoes doing it another way introduce some sort of problem?", "count": 8, "author": "okdana+bugzilla@gmail.com", "creator": "okdana+bugzilla@gmail.com", "attachment_id": null, "id": 5427812, "time": "2011-04-23T09:06:09Z", "tags": [], "creation_time": "2011-04-23T09:06:09Z", "bug_id": 652225, "raw_text": "I am not informed enough to really understand the general implications beyond what you've described, so i will take your word that it's the better system in general. :)\n\nI am confused as to why the background images are not pushed up (or down) with the text, though. The browser-default bullets seem to line up with the text in each example; however, if you have a custom bullet (defined with a background-image) that is, e.g., set to appear 0.5em from the top, one might assume that it will always appear 0.5em from the top regardless of what the height of the line is.\n\nDoes doing it another way introduce some sort of problem?", "is_private": false}, {"bug_id": 652225, "creation_time": "2011-04-28T03:59:49Z", "raw_text": "> I am confused as to why the background images are not pushed up (or down) with\n> the text, though. \n\nYeah, me too.  That's why the bug is still open. ;)", "tags": [], "is_private": false, "time": "2011-04-28T03:59:49Z", "id": 5436472, "creator": "bzbarsky@mit.edu", "attachment_id": null, "text": "> I am confused as to why the background images are not pushed up (or down) with\n> the text, though. \n\nYeah, me too.  That's why the bug is still open. ;)", "count": 9, "author": "bzbarsky@mit.edu"}, {"raw_text": "Also see bug 442139.", "bug_id": 652225, "creation_time": "2017-08-24T02:40:22Z", "tags": [], "is_private": false, "time": "2017-08-24T02:40:22Z", "id": 12594349, "creator": "dbaron@dbaron.org", "attachment_id": null, "count": 10, "text": "Also see bug 442139.", "author": "dbaron@dbaron.org"}]}}}