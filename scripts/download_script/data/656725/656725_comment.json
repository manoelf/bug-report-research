{"comments": {}, "bugs": {"656725": {"comments": [{"attachment_id": null, "is_private": false, "time": "2011-05-12T19:50:30Z", "author": "honzab.moz@firemni.cz", "creation_time": "2011-05-12T19:50:30Z", "text": "Initially in Firefox 4.0 I had opened about 100 tabs.  Mostly mozilla pages (bugs/crash reports).  I got announcement about an update to 4.0.1.  I applied the update.  After restart I was just able to close the \"Welcome to Firefox 4\" page and then Firefox froze with 100% CPU load.\n\nI managed to attach a debugger, load symbols and open the correct sources.\n\nI saw two methods called from PresShell::FlushPendingNotifications that were doing a job but took about a minute to exit, each:\nmFrameConstructor->CreateNeededFrames() \nmFrameConstructor->ProcessPendingRestyles()\n\nCalled for a document with URL https://crash-stats.mozilla.com/report/list?product=Firefox&query_search=signature&query_type=contains&query=nsHtml5Tokenizer%3A%3AstateLoop&reason_type=contains&date=05%2F04%2F2011%2007%3A10%3A19&range_value=4&range_unit=weeks&hang_type=any&process_type=any&do_query=1&signature=nsHtml5Tokenizer%3A%3AstateLoop%28int%2C%20unsigned%20short%2C%20int%2C%20unsigned%20short%2A%2C%20int%2C%20int%2C%20int%29\n\nFor other documents the hang was not happening.\n\nNot sure if only the first two calls, but I assume that all calls to these methods from FlushPendingNotifications had this problem.\n\n\nI have seen following stack traces:\n\n>\txul.dll!SelectorMatches(RuleProcessorData & data={...}, nsCSSSelector * aSelector=0x33e34580, NodeMatchContext & aNodeMatchContext={...}, TreeMatchContext & aTreeMatchContext={...}, int * const aDependence=0x00000000)  Line 1660\tC++\n \txul.dll!SelectorMatchesTree(RuleProcessorData & aPrevData={...}, nsCSSSelector * aSelector=0x0033be30, TreeMatchContext & aTreeMatchContext={...}, int aLookForRelevantLink=1)  Line 2311 + 0x12 bytes\tC++\n \txul.dll!ContentEnumFunc(nsICSSStyleRule * aRule=, nsCSSSelector * aSelector=, void * aData=)  Line 2363 + 0x1c bytes\tC++\n \txul.dll!RuleHash::EnumerateAllRules(int aNameSpace=84, nsIAtom * aTag=0x0033be08, nsIAtom * aID=0x128ec390, const nsAttrValue * aClassList=0x69e5b9e7, void (nsICSSStyleRule *, nsCSSSelector *, void *)* aFunc=0x69e6fca7, RuleProcessorData * aData=0x00000019)  Line 674\tC++\n \txul.dll!nsHTMLStyleSheet::RulesMatching(ElementRuleProcessorData * aData=)  Line 269\tC++\n \txul.dll!nsStyleSet::FileRules(int (nsIStyleRuleProcessor *, void *)* aCollectorFunc=, void * aData=, nsIContent * aContent=, nsRuleWalker * aRuleWalker=0x00000000)  Line 621 + 0x8 bytes\tC++\n \txul.dll!nsStyleSet::ResolveStyleFor(mozilla::dom::Element * aElement=0x836a0040, nsStyleContext * aParentContext=0x4b7d8d30)  Line 776\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState={...}, nsIContent * aContent=0x8369fcc0, nsStyleContext * aStyleContext=0x4b7d8d30, nsIFrame * aFrame=0x84407798, const int aCanHaveGeneratedContent=1, nsFrameItems & aFrameItems={...}, const int aAllowBlockStyles=0, PendingBinding * aPendingBinding=0x00000000)  Line 9630 + 0x121 bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructTableRow(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsIFrame * aParentFrame=0x84395e00, const nsStyleDisplay * aDisplay=0x11b389e0, nsFrameItems & aFrameItems={...}, nsIFrame * * aNewFrame=0x0033bfe4)  Line 1994\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x84395e00, nsFrameItems & aFrameItems={...})  Line 3723 + 0x1c bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x84395e00, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x84395e00, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsFrame::Init(nsIContent * aContent=0x69e41f03, nsIFrame * aParent=0x5b5311d0, nsIFrame * aPrevInFlow=0x5562dbe0)  Line 371 + 0x2 bytes\tC++\n \txul.dll!nsContainerFrame::Init(nsIContent * aContent=, nsIFrame * aParent=, nsIFrame * aPrevInFlow=)  Line 102 + 0x14 bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x84393af8, nsFrameItems & aFrameItems={...})  Line 3821\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x84393af8, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x84393af8, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructTable(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsIFrame * aParentFrame=0x84393a28, const nsStyleDisplay * aDisplay=0x11b36f58, nsFrameItems & aFrameItems={...}, nsIFrame * * aNewFrame=0x0033c3ec)  Line 1937 + 0x1c bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x84393a28, nsFrameItems & aFrameItems={...})  Line 3723 + 0x1c bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x84393a28, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x84393a28, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState & aState={...}, const nsStyleDisplay * aDisplay=0x0033c6f4, nsIContent * aContent=0x54d83680, nsIFrame * aParentFrame=0x8437d2f0, nsIFrame * aContentParentFrame=0x8437d2f0, nsStyleContext * aStyleContext=0x243c84f0, nsIFrame * * aNewFrame=0x0033c6a4, nsFrameItems & aFrameItems={...}, int aAbsPosContainer=0, PendingBinding * aPendingBinding=0x00000000)  Line 10698\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x8437d2f0, nsFrameItems & aFrameItems={...})  Line 3724\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x8437d2f0, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x8437d2f0, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState & aState={...}, const nsStyleDisplay * aDisplay=0x0033c9ac, nsIContent * aContent=0x54cb9380, nsIFrame * aParentFrame=0x8437d0b0, nsIFrame * aContentParentFrame=0x8437d0b0, nsStyleContext * aStyleContext=0x1126b580, nsIFrame * * aNewFrame=0x0033c95c, nsFrameItems & aFrameItems={...}, int aAbsPosContainer=0, PendingBinding * aPendingBinding=0x00000000)  Line 10698\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x8437d0b0, nsFrameItems & aFrameItems={...})  Line 3724\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x8437d0b0, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x8437d0b0, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState & aState={...}, const nsStyleDisplay * aDisplay=0x0033cc64, nsIContent * aContent=0x54cb9100, nsIFrame * aParentFrame=0x8437d040, nsIFrame * aContentParentFrame=0x8437d040, nsStyleContext * aStyleContext=0x50a03078, nsIFrame * * aNewFrame=0x0033cc14, nsFrameItems & aFrameItems={...}, int aAbsPosContainer=0, PendingBinding * aPendingBinding=0x00000000)  Line 10698\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x8437d040, nsFrameItems & aFrameItems={...})  Line 3724\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x8437d040, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x8437d040, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \tplds4.dll!PL_ArenaAllocate(PLArenaPool * pool=0x0033cd60, unsigned int nb=1)  Line 225 + 0x7 bytes\tC\n \txul.dll!nsStyleContext::DoGetStyleDisplay(int aComputeData=1024)  Line 95 + 0x23 bytes\tC++\n \txul.dll!nsBlockFrame::IsFrameOfType(unsigned int aFlags=2073869160)  Line 205\tC++\n \txul.dll!nsStyleContext::DoGetStyleContent(int aComputeData=3396304)  Line 105 + 0x15 bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState & aState=, const nsStyleDisplay * aDisplay=, nsIContent * aContent=, nsIFrame * aParentFrame=, nsIFrame * aContentParentFrame=, nsStyleContext * aStyleContext=, nsIFrame * * aNewFrame=, nsFrameItems & aFrameItems=, int aAbsPosContainer=, PendingBinding * aPendingBinding=)  Line 10698\tC++\n \txul.dll!SearchTable(PLDHashTable * table=0x00000019, const void * key=0x128ec390, unsigned int keyHash=1776690130, PLDHashOperator op=311346064)  Line 439 + 0x9 bytes\tC\n \txul.dll!PL_DHashTableOperate(PLDHashTable * table=0x00000000, const void * key=0x00000000, PLDHashOperator op=824781184)  Line 625 + 0x9 bytes\tC\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem=, nsFrameConstructorState & aState=, nsIFrame * aParentFrame=, nsFrameItems & aFrameItems=)  Line 3724\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x8437be70, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x8437be70, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState & aState={...}, const nsStyleDisplay * aDisplay=0x0033d1d4, nsIContent * aContent=0x549ffe00, nsIFrame * aParentFrame=0x31190d80, nsIFrame * aContentParentFrame=0x31190d80, nsStyleContext * aStyleContext=0x834d7700, nsIFrame * * aNewFrame=0x0033d184, nsFrameItems & aFrameItems={...}, int aAbsPosContainer=1, PendingBinding * aPendingBinding=0x00000000)  Line 10698\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x31190d80, nsFrameItems & aFrameItems={...})  Line 3724\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x31190d80, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x31190d80, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ContentAppended(nsIContent * aContainer=, nsIContent * aFirstNewContent=, int aAllowLazyConstruction=)  Line 6688\tC++\n \txul.dll!nsCSSFrameConstructor::CreateNeededFrames(nsIContent * aContent=0x18e9ab00)  Line 6341 + 0x12 bytes\tC++\n \txul.dll!nsCSSFrameConstructor::CreateNeededFrames(nsIContent * aContent=0x1b391650)  Line 6351 + 0xa bytes\tC++\n \txul.dll!PresShell::FlushPendingNotifications(mozFlushType aType=Flush_Style)  Line 4884 + 0x26 bytes\tC++\n \txul.dll!nsRefreshDriver::Notify(nsITimer * __formal=0x53ea9080)  Line 307\tC++\n \txul.dll!nsTimerImpl::Fire()  Line 429\tC++\n \txul.dll!nsTimerEvent::Run()  Line 519\tC++\n \txul.dll!nsThread::ProcessNextEvent(int mayWait=0, int * result=0x0033d528)  Line 633 + 0x5 bytes\tC++\n \txul.dll!mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate * aDelegate=0x0063f3c0)  Line 110 + 0x29 bytes\tC++\n \txul.dll!MessageLoop::RunInternal()  Line 219 + 0x9 bytes\tC++\n \txul.dll!MessageLoop::RunHandler()  Line 203\tC++\n \tmozcrt19.dll!_VEC_memzero(void * dst=0x00000001, int val=3405056, int len=0)  + 0x36 bytes\tC\n \txul.dll!MessageLoop::Run()  Line 177\tC++\n \t00000004()\t\n--------------------------------------------------------------\n  \nAnd:\n\n\n>\txul.dll!SelectorMatchesTree(RuleProcessorData & aPrevData={...}, nsCSSSelector * aSelector=0x11497188, TreeMatchContext & aTreeMatchContext={...}, int aLookForRelevantLink=0x00000001)  Line 2282 + 0x2 bytes\tC++\n \txul.dll!ContentEnumFunc(nsICSSStyleRule * aRule=, nsCSSSelector * aSelector=, void * aData=)  Line 2363 + 0x1c bytes\tC++\n \txul.dll!RuleHash::EnumerateAllRules(int aNameSpace=0x00000054, nsIAtom * aTag=0x0033c3b0, nsIAtom * aID=0x128ec390, const nsAttrValue * aClassList=0x69e5b9e7, void (nsICSSStyleRule *, nsCSSSelector *, void *)* aFunc=0x69e6fca7, RuleProcessorData * aData=0x00000019)  Line 674\tC++\n \txul.dll!nsHTMLStyleSheet::RulesMatching(ElementRuleProcessorData * aData=)  Line 269\tC++\n \txul.dll!nsStyleSet::FileRules(int (nsIStyleRuleProcessor *, void *)* aCollectorFunc=, void * aData=, nsIContent * aContent=, nsRuleWalker * aRuleWalker=0x00000000)  Line 621 + 0x8 bytes\tC++\n \txul.dll!nsStyleSet::ResolveStyleFor(mozilla::dom::Element * aElement=0x26dde680, nsStyleContext * aParentContext=0x4b7d8f10)  Line 776\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x4ce8a568, nsIContent * aParentContent=0x26d6ac00, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1217 + 0x14 bytes\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x4ce885d0, nsIContent * aParentContent=0x7871b8c0, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x23a60f08, nsIContent * aParentContent=0x77944600, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x23a5ec20, nsIContent * aParentContent=0x77944580, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x23a5ebc0, nsIContent * aParentContent=0x77944580, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  + 0x2f191c bytes\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x23a5eb50, nsIContent * aParentContent=0x40a725c0, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x4cd7d778, nsIContent * aParentContent=0x40a72340, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x4cd7d358, nsIContent * aParentContent=0x40a72280, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x4cd7b010, nsIContent * aParentContent=0x40a72080, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x2481dce8, nsIContent * aParentContent=0x18e9ab00, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x31190d80, nsIContent * aParentContent=0x1b391650, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x31190a18, nsIContent * aParentContent=0x00000000, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ComputeStyleChangeFor(nsIFrame * aFrame=0x31190a18, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, mozilla::css::RestyleTracker & aRestyleTracker={...}, int aRestyleDescendants=0x00000001)  Line 1605\tC++\n \txul.dll!mozilla::css::RestyleTracker::ProcessRestyles()  Line 240 + 0x6c bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessPendingRestyles()  Line 11681\tC++\n \txul.dll!PresShell::FlushPendingNotifications(mozFlushType aType=Flush_InterruptibleLayout)  Line 4886\tC++\n \txul.dll!nsGfxScrollFrameInner::AsyncScrollPortEvent::Run()  Line 2517\tC++\n \txul.dll!nsThread::ProcessNextEvent(int mayWait=0x00000000, int * result=0x0033d528)  Line 639\tC++\n \txul.dll!mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate * aDelegate=0x0063f3c0)  Line 110 + 0x29 bytes\tC++\n \txul.dll!MessageLoop::RunInternal()  Line 219 + 0x9 bytes\tC++\n \txul.dll!MessageLoop::RunHandler()  Line 203\tC++\n \tmozcrt19.dll!_VEC_memzero(void * dst=0x00000001, int val=0x0033f500, int len=0x00000000)  + 0x36 bytes\tC\n \txul.dll!MessageLoop::Run()  Line 177\tC++\n \t00000004()\t\n---------------------------------------------------------\n\nFor root call of nsFrameManager::ReResolveStyleContext that was causing this hang argument aFrame was not changing, as well as aPresContext, aPresContext was holding a ref to a document with the URL above.\n\nUnreproducible after restart but I have backup of the profile (backup while I was experiencing this bug during run) and I can try to reproduce with it.", "id": 5466315, "raw_text": "Initially in Firefox 4.0 I had opened about 100 tabs.  Mostly mozilla pages (bugs/crash reports).  I got announcement about an update to 4.0.1.  I applied the update.  After restart I was just able to close the \"Welcome to Firefox 4\" page and then Firefox froze with 100% CPU load.\n\nI managed to attach a debugger, load symbols and open the correct sources.\n\nI saw two methods called from PresShell::FlushPendingNotifications that were doing a job but took about a minute to exit, each:\nmFrameConstructor->CreateNeededFrames() \nmFrameConstructor->ProcessPendingRestyles()\n\nCalled for a document with URL https://crash-stats.mozilla.com/report/list?product=Firefox&query_search=signature&query_type=contains&query=nsHtml5Tokenizer%3A%3AstateLoop&reason_type=contains&date=05%2F04%2F2011%2007%3A10%3A19&range_value=4&range_unit=weeks&hang_type=any&process_type=any&do_query=1&signature=nsHtml5Tokenizer%3A%3AstateLoop%28int%2C%20unsigned%20short%2C%20int%2C%20unsigned%20short%2A%2C%20int%2C%20int%2C%20int%29\n\nFor other documents the hang was not happening.\n\nNot sure if only the first two calls, but I assume that all calls to these methods from FlushPendingNotifications had this problem.\n\n\nI have seen following stack traces:\n\n>\txul.dll!SelectorMatches(RuleProcessorData & data={...}, nsCSSSelector * aSelector=0x33e34580, NodeMatchContext & aNodeMatchContext={...}, TreeMatchContext & aTreeMatchContext={...}, int * const aDependence=0x00000000)  Line 1660\tC++\n \txul.dll!SelectorMatchesTree(RuleProcessorData & aPrevData={...}, nsCSSSelector * aSelector=0x0033be30, TreeMatchContext & aTreeMatchContext={...}, int aLookForRelevantLink=1)  Line 2311 + 0x12 bytes\tC++\n \txul.dll!ContentEnumFunc(nsICSSStyleRule * aRule=, nsCSSSelector * aSelector=, void * aData=)  Line 2363 + 0x1c bytes\tC++\n \txul.dll!RuleHash::EnumerateAllRules(int aNameSpace=84, nsIAtom * aTag=0x0033be08, nsIAtom * aID=0x128ec390, const nsAttrValue * aClassList=0x69e5b9e7, void (nsICSSStyleRule *, nsCSSSelector *, void *)* aFunc=0x69e6fca7, RuleProcessorData * aData=0x00000019)  Line 674\tC++\n \txul.dll!nsHTMLStyleSheet::RulesMatching(ElementRuleProcessorData * aData=)  Line 269\tC++\n \txul.dll!nsStyleSet::FileRules(int (nsIStyleRuleProcessor *, void *)* aCollectorFunc=, void * aData=, nsIContent * aContent=, nsRuleWalker * aRuleWalker=0x00000000)  Line 621 + 0x8 bytes\tC++\n \txul.dll!nsStyleSet::ResolveStyleFor(mozilla::dom::Element * aElement=0x836a0040, nsStyleContext * aParentContext=0x4b7d8d30)  Line 776\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState={...}, nsIContent * aContent=0x8369fcc0, nsStyleContext * aStyleContext=0x4b7d8d30, nsIFrame * aFrame=0x84407798, const int aCanHaveGeneratedContent=1, nsFrameItems & aFrameItems={...}, const int aAllowBlockStyles=0, PendingBinding * aPendingBinding=0x00000000)  Line 9630 + 0x121 bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructTableRow(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsIFrame * aParentFrame=0x84395e00, const nsStyleDisplay * aDisplay=0x11b389e0, nsFrameItems & aFrameItems={...}, nsIFrame * * aNewFrame=0x0033bfe4)  Line 1994\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x84395e00, nsFrameItems & aFrameItems={...})  Line 3723 + 0x1c bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x84395e00, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x84395e00, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsFrame::Init(nsIContent * aContent=0x69e41f03, nsIFrame * aParent=0x5b5311d0, nsIFrame * aPrevInFlow=0x5562dbe0)  Line 371 + 0x2 bytes\tC++\n \txul.dll!nsContainerFrame::Init(nsIContent * aContent=, nsIFrame * aParent=, nsIFrame * aPrevInFlow=)  Line 102 + 0x14 bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x84393af8, nsFrameItems & aFrameItems={...})  Line 3821\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x84393af8, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x84393af8, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructTable(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsIFrame * aParentFrame=0x84393a28, const nsStyleDisplay * aDisplay=0x11b36f58, nsFrameItems & aFrameItems={...}, nsIFrame * * aNewFrame=0x0033c3ec)  Line 1937 + 0x1c bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x84393a28, nsFrameItems & aFrameItems={...})  Line 3723 + 0x1c bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x84393a28, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x84393a28, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState & aState={...}, const nsStyleDisplay * aDisplay=0x0033c6f4, nsIContent * aContent=0x54d83680, nsIFrame * aParentFrame=0x8437d2f0, nsIFrame * aContentParentFrame=0x8437d2f0, nsStyleContext * aStyleContext=0x243c84f0, nsIFrame * * aNewFrame=0x0033c6a4, nsFrameItems & aFrameItems={...}, int aAbsPosContainer=0, PendingBinding * aPendingBinding=0x00000000)  Line 10698\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x8437d2f0, nsFrameItems & aFrameItems={...})  Line 3724\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x8437d2f0, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x8437d2f0, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState & aState={...}, const nsStyleDisplay * aDisplay=0x0033c9ac, nsIContent * aContent=0x54cb9380, nsIFrame * aParentFrame=0x8437d0b0, nsIFrame * aContentParentFrame=0x8437d0b0, nsStyleContext * aStyleContext=0x1126b580, nsIFrame * * aNewFrame=0x0033c95c, nsFrameItems & aFrameItems={...}, int aAbsPosContainer=0, PendingBinding * aPendingBinding=0x00000000)  Line 10698\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x8437d0b0, nsFrameItems & aFrameItems={...})  Line 3724\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x8437d0b0, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x8437d0b0, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState & aState={...}, const nsStyleDisplay * aDisplay=0x0033cc64, nsIContent * aContent=0x54cb9100, nsIFrame * aParentFrame=0x8437d040, nsIFrame * aContentParentFrame=0x8437d040, nsStyleContext * aStyleContext=0x50a03078, nsIFrame * * aNewFrame=0x0033cc14, nsFrameItems & aFrameItems={...}, int aAbsPosContainer=0, PendingBinding * aPendingBinding=0x00000000)  Line 10698\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x8437d040, nsFrameItems & aFrameItems={...})  Line 3724\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x8437d040, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x8437d040, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \tplds4.dll!PL_ArenaAllocate(PLArenaPool * pool=0x0033cd60, unsigned int nb=1)  Line 225 + 0x7 bytes\tC\n \txul.dll!nsStyleContext::DoGetStyleDisplay(int aComputeData=1024)  Line 95 + 0x23 bytes\tC++\n \txul.dll!nsBlockFrame::IsFrameOfType(unsigned int aFlags=2073869160)  Line 205\tC++\n \txul.dll!nsStyleContext::DoGetStyleContent(int aComputeData=3396304)  Line 105 + 0x15 bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState & aState=, const nsStyleDisplay * aDisplay=, nsIContent * aContent=, nsIFrame * aParentFrame=, nsIFrame * aContentParentFrame=, nsStyleContext * aStyleContext=, nsIFrame * * aNewFrame=, nsFrameItems & aFrameItems=, int aAbsPosContainer=, PendingBinding * aPendingBinding=)  Line 10698\tC++\n \txul.dll!SearchTable(PLDHashTable * table=0x00000019, const void * key=0x128ec390, unsigned int keyHash=1776690130, PLDHashOperator op=311346064)  Line 439 + 0x9 bytes\tC\n \txul.dll!PL_DHashTableOperate(PLDHashTable * table=0x00000000, const void * key=0x00000000, PLDHashOperator op=824781184)  Line 625 + 0x9 bytes\tC\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem=, nsFrameConstructorState & aState=, nsIFrame * aParentFrame=, nsFrameItems & aFrameItems=)  Line 3724\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x8437be70, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x8437be70, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessChildren(nsFrameConstructorState & aState=, nsIContent * aContent=, nsStyleContext * aStyleContext=, nsIFrame * aFrame=, const int aCanHaveGeneratedContent=, nsFrameItems & aFrameItems=, const int aAllowBlockStyles=, PendingBinding * aPendingBinding=)  Line 9646\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructBlock(nsFrameConstructorState & aState={...}, const nsStyleDisplay * aDisplay=0x0033d1d4, nsIContent * aContent=0x549ffe00, nsIFrame * aParentFrame=0x31190d80, nsIFrame * aContentParentFrame=0x31190d80, nsStyleContext * aStyleContext=0x834d7700, nsIFrame * * aNewFrame=0x0033d184, nsFrameItems & aFrameItems={...}, int aAbsPosContainer=1, PendingBinding * aPendingBinding=0x00000000)  Line 10698\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x31190d80, nsFrameItems & aFrameItems={...})  Line 3724\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x31190d80, nsFrameItems & aFrameItems={...})  Line 5493\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x31190d80, nsFrameItems & aFrameItems={...})  Line 9530\tC++\n \txul.dll!nsCSSFrameConstructor::ContentAppended(nsIContent * aContainer=, nsIContent * aFirstNewContent=, int aAllowLazyConstruction=)  Line 6688\tC++\n \txul.dll!nsCSSFrameConstructor::CreateNeededFrames(nsIContent * aContent=0x18e9ab00)  Line 6341 + 0x12 bytes\tC++\n \txul.dll!nsCSSFrameConstructor::CreateNeededFrames(nsIContent * aContent=0x1b391650)  Line 6351 + 0xa bytes\tC++\n \txul.dll!PresShell::FlushPendingNotifications(mozFlushType aType=Flush_Style)  Line 4884 + 0x26 bytes\tC++\n \txul.dll!nsRefreshDriver::Notify(nsITimer * __formal=0x53ea9080)  Line 307\tC++\n \txul.dll!nsTimerImpl::Fire()  Line 429\tC++\n \txul.dll!nsTimerEvent::Run()  Line 519\tC++\n \txul.dll!nsThread::ProcessNextEvent(int mayWait=0, int * result=0x0033d528)  Line 633 + 0x5 bytes\tC++\n \txul.dll!mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate * aDelegate=0x0063f3c0)  Line 110 + 0x29 bytes\tC++\n \txul.dll!MessageLoop::RunInternal()  Line 219 + 0x9 bytes\tC++\n \txul.dll!MessageLoop::RunHandler()  Line 203\tC++\n \tmozcrt19.dll!_VEC_memzero(void * dst=0x00000001, int val=3405056, int len=0)  + 0x36 bytes\tC\n \txul.dll!MessageLoop::Run()  Line 177\tC++\n \t00000004()\t\n--------------------------------------------------------------\n  \nAnd:\n\n\n>\txul.dll!SelectorMatchesTree(RuleProcessorData & aPrevData={...}, nsCSSSelector * aSelector=0x11497188, TreeMatchContext & aTreeMatchContext={...}, int aLookForRelevantLink=0x00000001)  Line 2282 + 0x2 bytes\tC++\n \txul.dll!ContentEnumFunc(nsICSSStyleRule * aRule=, nsCSSSelector * aSelector=, void * aData=)  Line 2363 + 0x1c bytes\tC++\n \txul.dll!RuleHash::EnumerateAllRules(int aNameSpace=0x00000054, nsIAtom * aTag=0x0033c3b0, nsIAtom * aID=0x128ec390, const nsAttrValue * aClassList=0x69e5b9e7, void (nsICSSStyleRule *, nsCSSSelector *, void *)* aFunc=0x69e6fca7, RuleProcessorData * aData=0x00000019)  Line 674\tC++\n \txul.dll!nsHTMLStyleSheet::RulesMatching(ElementRuleProcessorData * aData=)  Line 269\tC++\n \txul.dll!nsStyleSet::FileRules(int (nsIStyleRuleProcessor *, void *)* aCollectorFunc=, void * aData=, nsIContent * aContent=, nsRuleWalker * aRuleWalker=0x00000000)  Line 621 + 0x8 bytes\tC++\n \txul.dll!nsStyleSet::ResolveStyleFor(mozilla::dom::Element * aElement=0x26dde680, nsStyleContext * aParentContext=0x4b7d8f10)  Line 776\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x4ce8a568, nsIContent * aParentContent=0x26d6ac00, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1217 + 0x14 bytes\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x4ce885d0, nsIContent * aParentContent=0x7871b8c0, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x23a60f08, nsIContent * aParentContent=0x77944600, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x23a5ec20, nsIContent * aParentContent=0x77944580, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x23a5ebc0, nsIContent * aParentContent=0x77944580, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  + 0x2f191c bytes\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x23a5eb50, nsIContent * aParentContent=0x40a725c0, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x4cd7d778, nsIContent * aParentContent=0x40a72340, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x4cd7d358, nsIContent * aParentContent=0x40a72280, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x4cd7b010, nsIContent * aParentContent=0x40a72080, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x2481dce8, nsIContent * aParentContent=0x18e9ab00, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x31190d80, nsIContent * aParentContent=0x1b391650, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ReResolveStyleContext(nsPresContext * aPresContext=0x0cf39400, nsIFrame * aFrame=0x31190a18, nsIContent * aParentContent=0x00000000, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, nsRestyleHint aRestyleHint=eRestyle_Subtree, mozilla::css::RestyleTracker & aRestyleTracker={...}, nsFrameManager::DesiredA11yNotifications aDesiredA11yNotifications=eSendAllNotifications, nsTArray<nsIContent *,nsTArrayDefaultAllocator> & aVisibleKidsOfHiddenElement={...})  Line 1525\tC++\n \txul.dll!nsFrameManager::ComputeStyleChangeFor(nsIFrame * aFrame=0x31190a18, nsStyleChangeList * aChangeList=0x0033cb30, nsChangeHint aMinChange=0x00000000, mozilla::css::RestyleTracker & aRestyleTracker={...}, int aRestyleDescendants=0x00000001)  Line 1605\tC++\n \txul.dll!mozilla::css::RestyleTracker::ProcessRestyles()  Line 240 + 0x6c bytes\tC++\n \txul.dll!nsCSSFrameConstructor::ProcessPendingRestyles()  Line 11681\tC++\n \txul.dll!PresShell::FlushPendingNotifications(mozFlushType aType=Flush_InterruptibleLayout)  Line 4886\tC++\n \txul.dll!nsGfxScrollFrameInner::AsyncScrollPortEvent::Run()  Line 2517\tC++\n \txul.dll!nsThread::ProcessNextEvent(int mayWait=0x00000000, int * result=0x0033d528)  Line 639\tC++\n \txul.dll!mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate * aDelegate=0x0063f3c0)  Line 110 + 0x29 bytes\tC++\n \txul.dll!MessageLoop::RunInternal()  Line 219 + 0x9 bytes\tC++\n \txul.dll!MessageLoop::RunHandler()  Line 203\tC++\n \tmozcrt19.dll!_VEC_memzero(void * dst=0x00000001, int val=0x0033f500, int len=0x00000000)  + 0x36 bytes\tC\n \txul.dll!MessageLoop::Run()  Line 177\tC++\n \t00000004()\t\n---------------------------------------------------------\n\nFor root call of nsFrameManager::ReResolveStyleContext that was causing this hang argument aFrame was not changing, as well as aPresContext, aPresContext was holding a ref to a document with the URL above.\n\nUnreproducible after restart but I have backup of the profile (backup while I was experiencing this bug during run) and I can try to reproduce with it.", "creator": "honzab.moz@firemni.cz", "tags": [], "count": 0, "bug_id": 656725}, {"author": "dx@dxzone.com.ar", "creation_time": "2016-03-15T20:20:30Z", "text": "I seem to have this issue too, at least judging by common parts of the backtrace.\n\nFirefox 44.0.2 linux x86_64. Frozen and unresponsive UI, 100% cpu usage only in the main thread, and it doesn't seem to be returning.\n\nI have no idea how to reproduce this and I don't think I will be able to, so i'm keeping this firefox frozen for as long as possible and hopefully I can get some dev to look at this.\n\nGot debug symbols, attached gdb in several points. The backtrace seems to always have FlushPendingNotifications, sometimes going to ProcessPendingRestyles or ProcessReflowCommands.\n\nOne of my backtraces:\n\n(gdb) bt\n#0  0x00007fa133dec4b6 in nsIFrame::Properties (this=0x7fa093dbcd08) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/svg/../generic/nsIFrame.h:2635\n#1  nsSVGEffects::InvalidateDirectRenderingObservers (aElement=0x7fa057feece0, aFlags=aFlags@entry=0) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/svg/nsSVGEffects.cpp:806\n#2  0x00007fa133dec574 in nsSVGEffects::InvalidateDirectRenderingObservers (aFrame=aFrame@entry=0x7fa093dbcd08, aFlags=aFlags@entry=0) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/svg/nsSVGEffects.cpp:825\n#3  0x00007fa133dbb435 in PresShell::DoReflow (this=this@entry=0x7fa0816bc400, target=0x7fa093dbcd08, target@entry=0x7fa093dbe900, aInterruptible=aInterruptible@entry=false)\n    at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/base/nsPresShell.cpp:8955\n#4  0x00007fa133dbfb4f in PresShell::ProcessReflowCommands (this=this@entry=0x7fa0816bc400, aInterruptible=false) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/base/nsPresShell.cpp:9228\n#5  0x00007fa133dbffdb in PresShell::FlushPendingNotifications (this=0x7fa0816bc400, aFlush=...) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/base/nsPresShell.cpp:4137\n#6  0x00007fa135362d57 in PresShell::FlushPendingNotifications (this=<optimized out>, aType=<optimized out>) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/base/nsPresShell.cpp:3977\n#7  0x00007fa133d21de7 in nsDocument::FlushPendingNotifications (this=0x7fa05a602000, aType=Flush_Layout) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/base/nsDocument.cpp:8251\n#8  0x00007fa134710e74 in mozilla::dom::Element::GetPrimaryFrame (this=this@entry=0x7fa072fa76d0, aType=aType@entry=Flush_Layout) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/base/Element.cpp:2106\n#9  0x00007fa13471159c in mozilla::dom::Element::GetStyledFrame (this=this@entry=0x7fa072fa76d0) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/base/Element.cpp:564\n#10 0x00007fa134e58389 in nsGenericHTMLElement::GetOffsetRect (this=0x7fa072fa76d0, aRect=...) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/html/nsGenericHTMLElement.cpp:329\n#11 0x00007fa134c6198b in nsGenericHTMLElement::OffsetHeight (this=<optimized out>) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/html/nsGenericHTMLElement.h:297\n#12 0x00007fa134c619ac in mozilla::dom::HTMLElementBinding::get_offsetHeight (cx=<optimized out>, obj=..., self=<optimized out>, args=...)\n    at /builds/slave/rel-m-rel-l64_bld-000000000000/build/obj-firefox/dom/bindings/HTMLElementBinding.cpp:1563\n#13 0x00007fa1223d4a0e in ?? ()\n#14 0x0000000000000012 in ?? ()\n#15 0x00007fff493449e0 in ?? ()\n#16 0x0000000000000000 in ?? ()\n\nAttaching the rest.", "id": 11249213, "raw_text": "I seem to have this issue too, at least judging by common parts of the backtrace.\n\nFirefox 44.0.2 linux x86_64. Frozen and unresponsive UI, 100% cpu usage only in the main thread, and it doesn't seem to be returning.\n\nI have no idea how to reproduce this and I don't think I will be able to, so i'm keeping this firefox frozen for as long as possible and hopefully I can get some dev to look at this.\n\nGot debug symbols, attached gdb in several points. The backtrace seems to always have FlushPendingNotifications, sometimes going to ProcessPendingRestyles or ProcessReflowCommands.\n\nOne of my backtraces:\n\n(gdb) bt\n#0  0x00007fa133dec4b6 in nsIFrame::Properties (this=0x7fa093dbcd08) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/svg/../generic/nsIFrame.h:2635\n#1  nsSVGEffects::InvalidateDirectRenderingObservers (aElement=0x7fa057feece0, aFlags=aFlags@entry=0) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/svg/nsSVGEffects.cpp:806\n#2  0x00007fa133dec574 in nsSVGEffects::InvalidateDirectRenderingObservers (aFrame=aFrame@entry=0x7fa093dbcd08, aFlags=aFlags@entry=0) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/svg/nsSVGEffects.cpp:825\n#3  0x00007fa133dbb435 in PresShell::DoReflow (this=this@entry=0x7fa0816bc400, target=0x7fa093dbcd08, target@entry=0x7fa093dbe900, aInterruptible=aInterruptible@entry=false)\n    at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/base/nsPresShell.cpp:8955\n#4  0x00007fa133dbfb4f in PresShell::ProcessReflowCommands (this=this@entry=0x7fa0816bc400, aInterruptible=false) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/base/nsPresShell.cpp:9228\n#5  0x00007fa133dbffdb in PresShell::FlushPendingNotifications (this=0x7fa0816bc400, aFlush=...) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/base/nsPresShell.cpp:4137\n#6  0x00007fa135362d57 in PresShell::FlushPendingNotifications (this=<optimized out>, aType=<optimized out>) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/layout/base/nsPresShell.cpp:3977\n#7  0x00007fa133d21de7 in nsDocument::FlushPendingNotifications (this=0x7fa05a602000, aType=Flush_Layout) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/base/nsDocument.cpp:8251\n#8  0x00007fa134710e74 in mozilla::dom::Element::GetPrimaryFrame (this=this@entry=0x7fa072fa76d0, aType=aType@entry=Flush_Layout) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/base/Element.cpp:2106\n#9  0x00007fa13471159c in mozilla::dom::Element::GetStyledFrame (this=this@entry=0x7fa072fa76d0) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/base/Element.cpp:564\n#10 0x00007fa134e58389 in nsGenericHTMLElement::GetOffsetRect (this=0x7fa072fa76d0, aRect=...) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/html/nsGenericHTMLElement.cpp:329\n#11 0x00007fa134c6198b in nsGenericHTMLElement::OffsetHeight (this=<optimized out>) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/html/nsGenericHTMLElement.h:297\n#12 0x00007fa134c619ac in mozilla::dom::HTMLElementBinding::get_offsetHeight (cx=<optimized out>, obj=..., self=<optimized out>, args=...)\n    at /builds/slave/rel-m-rel-l64_bld-000000000000/build/obj-firefox/dom/bindings/HTMLElementBinding.cpp:1563\n#13 0x00007fa1223d4a0e in ?? ()\n#14 0x0000000000000012 in ?? ()\n#15 0x00007fff493449e0 in ?? ()\n#16 0x0000000000000000 in ?? ()\n\nAttaching the rest.", "count": 1, "creator": "dx@dxzone.com.ar", "tags": [], "bug_id": 656725, "attachment_id": null, "is_private": false, "time": "2016-03-15T20:20:30Z"}, {"attachment_id": 8730879, "time": "2016-03-15T20:22:27Z", "is_private": false, "author": "dx@dxzone.com.ar", "bug_id": 656725, "tags": [], "count": 2, "creator": "dx@dxzone.com.ar", "raw_text": "Several gdb backtraces just attaching to random points of the busy loop.", "id": 11249221, "text": "Created attachment 8730879\nbacktraces.txt\n\nSeveral gdb backtraces just attaching to random points of the busy loop.", "creation_time": "2016-03-15T20:22:27Z"}, {"attachment_id": null, "author": "tnikkel@gmail.com", "creator": "tnikkel@gmail.com", "count": 3, "time": "2016-03-15T20:24:47Z", "tags": [], "bug_id": 656725, "creation_time": "2016-03-15T20:24:47Z", "is_private": false, "text": "If you goto the frame at nsDocument::FlushPendingNotifications then p mDocumentURI.mRawPtr->mSpec that will tell you which document is spinning.", "id": 11249229, "raw_text": "If you goto the frame at nsDocument::FlushPendingNotifications then p mDocumentURI.mRawPtr->mSpec that will tell you which document is spinning."}, {"attachment_id": null, "time": "2016-03-15T20:44:49Z", "is_private": false, "author": "dx@dxzone.com.ar", "bug_id": 656725, "tags": [], "creator": "dx@dxzone.com.ar", "count": 4, "raw_text": "(gdb) frame\n#9  0x00007fa133d21de7 in nsDocument::FlushPendingNotifications (this=0x7fa05a602000, aType=Flush_Layout) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/base/nsDocument.cpp:8251\n8251          shell->FlushPendingNotifications(aType);\n\n(gdb) p mDocumentURI.mRawPtr->mSpec\nThere is no member or method named mSpec.\n\nUhhh.\n\n(gdb) p mDocumentURI\n$4 = {<nsCOMPtr_base> = {mRawPtr = 0x7fa0a81158a0}, <No data fields>}\n(gdb) p mDocumentURI.mRawPtr\n$5 = (nsISupports *) 0x7fa0a81158a0\n(gdb) p *mDocumentURI.mRawPtr\n$6 = {_vptr.nsISupports = 0x7fa137ba31f0 <vtable for nsStandardURL+16>}\n(gdb) p mDocumentURI.mRawPtr->mSpec\nThere is no member or method named mSpec.", "id": 11249309, "text": "(gdb) frame\n#9  0x00007fa133d21de7 in nsDocument::FlushPendingNotifications (this=0x7fa05a602000, aType=Flush_Layout) at /builds/slave/rel-m-rel-l64_bld-000000000000/build/dom/base/nsDocument.cpp:8251\n8251          shell->FlushPendingNotifications(aType);\n\n(gdb) p mDocumentURI.mRawPtr->mSpec\nThere is no member or method named mSpec.\n\nUhhh.\n\n(gdb) p mDocumentURI\n$4 = {<nsCOMPtr_base> = {mRawPtr = 0x7fa0a81158a0}, <No data fields>}\n(gdb) p mDocumentURI.mRawPtr\n$5 = (nsISupports *) 0x7fa0a81158a0\n(gdb) p *mDocumentURI.mRawPtr\n$6 = {_vptr.nsISupports = 0x7fa137ba31f0 <vtable for nsStandardURL+16>}\n(gdb) p mDocumentURI.mRawPtr->mSpec\nThere is no member or method named mSpec.", "creation_time": "2016-03-15T20:44:49Z"}, {"bug_id": 656725, "tags": [], "creator": "dx@dxzone.com.ar", "count": 5, "text": "Got it:\n\n(gdb) p ((nsStandardURL *) mDocumentURI.mRawPtr)->mSpec\n$17 = {<nsACString_internal> = {mData = 0x7fa0e1c79278 \"http://www.amazon.com/Anker-Gigabit-Ethernet-Converter-Support/dp/B014ZOJX7W/ref=sr_1_2?s=electronics&ie=UTF8&qid=1458065453&sr=1-2&keywords=usb3+gigabit\", mLength = 153, mFlags = 5}, <No data fields>}\n\nSeems to be always the same after 5 checks", "creation_time": "2016-03-15T20:52:10Z", "raw_text": "Got it:\n\n(gdb) p ((nsStandardURL *) mDocumentURI.mRawPtr)->mSpec\n$17 = {<nsACString_internal> = {mData = 0x7fa0e1c79278 \"http://www.amazon.com/Anker-Gigabit-Ethernet-Converter-Support/dp/B014ZOJX7W/ref=sr_1_2?s=electronics&ie=UTF8&qid=1458065453&sr=1-2&keywords=usb3+gigabit\", mLength = 153, mFlags = 5}, <No data fields>}\n\nSeems to be always the same after 5 checks", "id": 11249331, "author": "dx@dxzone.com.ar", "time": "2016-03-15T20:52:10Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "is_private": false, "time": "2016-03-15T21:04:50Z", "author": "tnikkel@gmail.com", "raw_text": "That page doesn't hang for me. Does it hang for you if you load it in a fresh and separate profile?", "id": 11249375, "text": "That page doesn't hang for me. Does it hang for you if you load it in a fresh and separate profile?", "creation_time": "2016-03-15T21:04:50Z", "bug_id": 656725, "count": 6, "creator": "tnikkel@gmail.com", "tags": []}, {"time": "2016-03-15T21:25:31Z", "is_private": false, "attachment_id": null, "creator": "dx@dxzone.com.ar", "tags": [], "count": 7, "bug_id": 656725, "creation_time": "2016-03-15T21:25:31Z", "text": "Welp that firefox just died. OOM killed it seems. I should have generated a core dump...\n\n[954337.504270] Out of memory: Kill process 14049 (firefox) score 798 or sacrifice child\n[954337.504281] Killed process 14049 (firefox) total-vm:14869160kB, anon-rss:12980628kB, file-rss:2256kB\n\nThat looks like 12gb of RSS. I have 16gb total and it normally uses less than 4gb. I wasn't really paying attention but I think it was getting worse since the last \"continue\" i did in gdb.\n\nCan't reproduce the issue anymore after restoring the session and loading that page (which was missing from the tab list of the session manager extension)", "id": 11249447, "raw_text": "Welp that firefox just died. OOM killed it seems. I should have generated a core dump...\n\n[954337.504270] Out of memory: Kill process 14049 (firefox) score 798 or sacrifice child\n[954337.504281] Killed process 14049 (firefox) total-vm:14869160kB, anon-rss:12980628kB, file-rss:2256kB\n\nThat looks like 12gb of RSS. I have 16gb total and it normally uses less than 4gb. I wasn't really paying attention but I think it was getting worse since the last \"continue\" i did in gdb.\n\nCan't reproduce the issue anymore after restoring the session and loading that page (which was missing from the tab list of the session manager extension)", "author": "dx@dxzone.com.ar"}, {"author": "dx@dxzone.com.ar", "attachment_id": null, "raw_text": "I've managed to reproduce the issue under rr.\n\nIt's definitely that page. Not sure why it didn't happen the first time i tried, the tab just stayed in loading state for a long time without freezing.\n\nNot sure if relevant, but this appears in the console when loading that page.\n\n>JavaScript warning: http://www.amazon.com/Anker-Gigabit-Ethernet-Converter-Support/dp/B014ZOJX7W/ref=sr_1_2?s=electronics&ie=UTF8&qid=1458065453&sr=1-2&keywords=usb3+gigabit, line 2962: unreachable code after return statement\n\nAnyway, caught the thing, awaiting instructions on how to debug it.", "id": 11249600, "text": "I've managed to reproduce the issue under rr.\n\nIt's definitely that page. Not sure why it didn't happen the first time i tried, the tab just stayed in loading state for a long time without freezing.\n\nNot sure if relevant, but this appears in the console when loading that page.\n\n>JavaScript warning: http://www.amazon.com/Anker-Gigabit-Ethernet-Converter-Support/dp/B014ZOJX7W/ref=sr_1_2?s=electronics&ie=UTF8&qid=1458065453&sr=1-2&keywords=usb3+gigabit, line 2962: unreachable code after return statement\n\nAnyway, caught the thing, awaiting instructions on how to debug it.", "is_private": false, "creation_time": "2016-03-15T22:02:38Z", "bug_id": 656725, "tags": [], "count": 8, "time": "2016-03-15T22:02:38Z", "creator": "dx@dxzone.com.ar"}]}}}