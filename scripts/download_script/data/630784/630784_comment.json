{"bugs": {"630784": {"comments": [{"tags": [], "creation_time": "2011-02-02T04:58:48Z", "is_private": false, "text": "User-Agent:       Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20101209 CentOS/3.6-2.el5.centos Firefox/3.6.13\nBuild Identifier: Mozilla/5.0 (X11; Linux i686; rv:2.0b11pre) Gecko/20110201 Thunderbird/3.3a3pre\n\nIf I try to archive email with archive_keep_folder_structure=true while using an IMAP server that does not support folders containing sub-folders and messages, then Thunderbird can't create the intermediate folders in the folder path within the Archives folder, since it tries to create folders containing messages, rather then folders containing sub-folders.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Set up an account on an IMAP server that does not support folders containing sub-folders and messages (eg: dovecot 1.0.7)\n2. Find an email in a sub-folder, such as \"Clients/MyClient\"\n3. Archive the email (eg: press 'A', or select 'Message -> Archive' menu item)\nActual Results:  \nNothing happens.  Specifically:\n  * No subfolders are created from folder 'Archives';\n  * The email that is selected is not moved\n\nExpected Results:  \n1. Created folder '2011' under folder 'Archive'\n2. Created folder 'Clients' under folder '2011'\n3. Created folder 'MyClient' under folder 'Clients'\n4. Moved the selected email to the resulting folder 'MyClient'\n\nI realised that the first problem is that the Archives folder is the wrong type: it only holds messages, and therefore can not hold sub-folders.\n\nI closed Thunderbird, deleted folder 'Archives' from the server, re-created folder 'Archives' on the server as a folder that can contain sub-folders, then re-launched Thunderbird.\n\nThis time, when I tried to move the message from folder 'Clients/MyClients', Thunderbird created folder '2011' under folder 'Archives', but it was the wrong type of folder (it was a folder that contains messages).\n\nI closed Thunderbird again, deleted folder '2011' and re-created it as a folder that can contain sub-folders, then re-launched Thunderbird.\n\nThis time, when I tried to move the message from folder 'Clients/MyClients', Thunderbird created folder 'Clients' under folder 'Archives/2011', but it was the wrong type of folder (it was a folder that contains messages).", "count": 0, "id": 5245235, "time": "2011-02-02T04:58:48Z", "creator": "mozilla@msquared.id.au", "attachment_id": null, "author": "mozilla@msquared.id.au", "bug_id": 630784, "raw_text": "User-Agent:       Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20101209 CentOS/3.6-2.el5.centos Firefox/3.6.13\nBuild Identifier: Mozilla/5.0 (X11; Linux i686; rv:2.0b11pre) Gecko/20110201 Thunderbird/3.3a3pre\n\nIf I try to archive email with archive_keep_folder_structure=true while using an IMAP server that does not support folders containing sub-folders and messages, then Thunderbird can't create the intermediate folders in the folder path within the Archives folder, since it tries to create folders containing messages, rather then folders containing sub-folders.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Set up an account on an IMAP server that does not support folders containing sub-folders and messages (eg: dovecot 1.0.7)\n2. Find an email in a sub-folder, such as \"Clients/MyClient\"\n3. Archive the email (eg: press 'A', or select 'Message -> Archive' menu item)\nActual Results:  \nNothing happens.  Specifically:\n  * No subfolders are created from folder 'Archives';\n  * The email that is selected is not moved\n\nExpected Results:  \n1. Created folder '2011' under folder 'Archive'\n2. Created folder 'Clients' under folder '2011'\n3. Created folder 'MyClient' under folder 'Clients'\n4. Moved the selected email to the resulting folder 'MyClient'\n\nI realised that the first problem is that the Archives folder is the wrong type: it only holds messages, and therefore can not hold sub-folders.\n\nI closed Thunderbird, deleted folder 'Archives' from the server, re-created folder 'Archives' on the server as a folder that can contain sub-folders, then re-launched Thunderbird.\n\nThis time, when I tried to move the message from folder 'Clients/MyClients', Thunderbird created folder '2011' under folder 'Archives', but it was the wrong type of folder (it was a folder that contains messages).\n\nI closed Thunderbird again, deleted folder '2011' and re-created it as a folder that can contain sub-folders, then re-launched Thunderbird.\n\nThis time, when I tried to move the message from folder 'Clients/MyClients', Thunderbird created folder 'Clients' under folder 'Archives/2011', but it was the wrong type of folder (it was a folder that contains messages)."}, {"tags": [], "creation_time": "2011-02-03T03:09:06Z", "id": 5250515, "count": 1, "is_private": false, "text": "IMAP protocol doesn't have a way to control folder propertiey such as (a) \"folder can contain subfolder only\", (b) \"folder can contain message only\", (c) \"folder can contain both subfolders and messages\". Such property is server side attribute and is notified to IMAP client via folder attribute such as \\Noinferior(can't create/hold subfolder). And, if \\Noinferior is returned for Archives folder, Tb perhaps doesn't try to create 2011 folder under Archives and Tb tries to archive to Archives folder(possibly trunk only change yet).\n\nWhat folder attributes are returned from your server?\n\nAnd, if Server Settings/Advanced/\"Server supprts folder that contain subfolders ad messages\" is unchecked, Tb won't assume (c) \"folder can contain both subfolders and messages\".\n\nWhat is your Server Settings/Advanced setting?\n\nAnyway, get IMAP log, and check response to select command for the folders.\n> https://wiki.mozilla.org/MailNews:Logging\n> Win example : SET NSPR_LOG_MODULES=timestamp,imap:5\nIf log analysis by developers is needed, replace/remove sensitive data and remove irrelevant data to problem such as mail data from log file, and attach log file to this bug via \"Add an attachment\" link of this bug(never paste), please.", "author": "m-wada@usa.com", "attachment_id": null, "creator": "m-wada@usa.com", "time": "2011-02-03T03:09:06Z", "raw_text": "IMAP protocol doesn't have a way to control folder propertiey such as (a) \"folder can contain subfolder only\", (b) \"folder can contain message only\", (c) \"folder can contain both subfolders and messages\". Such property is server side attribute and is notified to IMAP client via folder attribute such as \\Noinferior(can't create/hold subfolder). And, if \\Noinferior is returned for Archives folder, Tb perhaps doesn't try to create 2011 folder under Archives and Tb tries to archive to Archives folder(possibly trunk only change yet).\n\nWhat folder attributes are returned from your server?\n\nAnd, if Server Settings/Advanced/\"Server supprts folder that contain subfolders ad messages\" is unchecked, Tb won't assume (c) \"folder can contain both subfolders and messages\".\n\nWhat is your Server Settings/Advanced setting?\n\nAnyway, get IMAP log, and check response to select command for the folders.\n> https://wiki.mozilla.org/MailNews:Logging\n> Win example : SET NSPR_LOG_MODULES=timestamp,imap:5\nIf log analysis by developers is needed, replace/remove sensitive data and remove irrelevant data to problem such as mail data from log file, and attach log file to this bug via \"Add an attachment\" link of this bug(never paste), please.", "bug_id": 630784}, {"tags": [], "creation_time": "2011-02-03T04:30:59Z", "id": 5250635, "count": 2, "is_private": false, "text": "(In reply to comment #1)\n> IMAP protocol doesn't have a way to control folder propertiey such as (a)\n> \"folder can contain subfolder only\", (b) \"folder can contain message only\", (c)\n> \"folder can contain both subfolders and messages\".\n\nPerhaps you are confusing folder capability with folder type?\n\nWhile it's true that an IMAP server does or does not support folders that contain both sub-folders and messages, on servers that do not support such folders, the client can tell the server which type of folder to create when it is created (ie: \"folder will contain sub-folders\" or \"folder will contain messages\").\n\nWhen Thunderbird creates the path of folders to contain the archive message (ie: Archives/2011/Clients/MyClient), if the server does not support \"subfolder+messages\" folders (as set by the user in the Advanced server settings), then Thunderbird should create \"sub-folders\" folders all the way down to the last folder, where it should create a \"messages\" folder.\n\nIf I keep going with the process that I described in my original post, by changing the folder type that Thunderbird creates from \"messages\" folder to \"sub-folders\" folder, eventually Thunderbird successfully moves the message to the subfolder in the Archives tree, immediately after it creates the last sub-folder in the path it is trying to create, because this folder is created (by Thunderbird) as a \"messages\" folder, which is what is required in order to put the message in there.\n\n> What folder attributes are returned from your server?\n\nOriginally, this:\n7 LIST \"Archives\" \"*\"\n* LIST (\\NoInferiors \\UnMarked) \"/\" \"Archives\"\n7 OK List completed.\n\nAfter I delete the Archives folder and re-create it as a \"sub-folders\" folder, this:\n2 LIST \"Archives\" \"*\"\n* LIST (\\Noselect \\HasChildren) \"/\" \"Archives\"\n2 OK List completed.\n\n> And, if Server Settings/Advanced/\"Server supprts folder that contain subfolders\n> ad messages\" is unchecked, Tb won't assume (c) \"folder can contain both\n> subfolders and messages\".\n> \n> What is your Server Settings/Advanced setting?\n\n\"Server supports folder that contains subfolders and messages\" is unchecked.\n\nI'm sure it's a simple logic error.  I suspect the following logic is simply not (yet) implemented:\n\n\"When creating a subfolder in the Archives tree to move a message to, if the server does not support folders with both sub-folders and messages, then create intermediate folders as \"sub-folder\" folders\".\n\nDoes that make sense?\n\nI suspect this to be the case because if I manually create the tree of folders as the right types of folders (eg: Archives/2011/Clients as \"sub-folders\" folders, and MyClient as a \"messages\" folder), then Thunderbird happily archives the message in the correct subfolder (Archives/2011/Clients/MyClient) as expected.\n\nI can even omit the last folder (in this example, \"MyClient\"), and Thunderbird will create that and move the archived message into it.", "author": "mozilla@msquared.id.au", "creator": "mozilla@msquared.id.au", "attachment_id": null, "time": "2011-02-03T04:30:59Z", "raw_text": "(In reply to comment #1)\n> IMAP protocol doesn't have a way to control folder propertiey such as (a)\n> \"folder can contain subfolder only\", (b) \"folder can contain message only\", (c)\n> \"folder can contain both subfolders and messages\".\n\nPerhaps you are confusing folder capability with folder type?\n\nWhile it's true that an IMAP server does or does not support folders that contain both sub-folders and messages, on servers that do not support such folders, the client can tell the server which type of folder to create when it is created (ie: \"folder will contain sub-folders\" or \"folder will contain messages\").\n\nWhen Thunderbird creates the path of folders to contain the archive message (ie: Archives/2011/Clients/MyClient), if the server does not support \"subfolder+messages\" folders (as set by the user in the Advanced server settings), then Thunderbird should create \"sub-folders\" folders all the way down to the last folder, where it should create a \"messages\" folder.\n\nIf I keep going with the process that I described in my original post, by changing the folder type that Thunderbird creates from \"messages\" folder to \"sub-folders\" folder, eventually Thunderbird successfully moves the message to the subfolder in the Archives tree, immediately after it creates the last sub-folder in the path it is trying to create, because this folder is created (by Thunderbird) as a \"messages\" folder, which is what is required in order to put the message in there.\n\n> What folder attributes are returned from your server?\n\nOriginally, this:\n7 LIST \"Archives\" \"*\"\n* LIST (\\NoInferiors \\UnMarked) \"/\" \"Archives\"\n7 OK List completed.\n\nAfter I delete the Archives folder and re-create it as a \"sub-folders\" folder, this:\n2 LIST \"Archives\" \"*\"\n* LIST (\\Noselect \\HasChildren) \"/\" \"Archives\"\n2 OK List completed.\n\n> And, if Server Settings/Advanced/\"Server supprts folder that contain subfolders\n> ad messages\" is unchecked, Tb won't assume (c) \"folder can contain both\n> subfolders and messages\".\n> \n> What is your Server Settings/Advanced setting?\n\n\"Server supports folder that contains subfolders and messages\" is unchecked.\n\nI'm sure it's a simple logic error.  I suspect the following logic is simply not (yet) implemented:\n\n\"When creating a subfolder in the Archives tree to move a message to, if the server does not support folders with both sub-folders and messages, then create intermediate folders as \"sub-folder\" folders\".\n\nDoes that make sense?\n\nI suspect this to be the case because if I manually create the tree of folders as the right types of folders (eg: Archives/2011/Clients as \"sub-folders\" folders, and MyClient as a \"messages\" folder), then Thunderbird happily archives the message in the correct subfolder (Archives/2011/Clients/MyClient) as expected.\n\nI can even omit the last folder (in this example, \"MyClient\"), and Thunderbird will create that and move the archived message into it.", "bug_id": 630784}, {"bug_id": 630784, "raw_text": "(In reply to comment #2)\n> Perhaps you are confusing folder capability with folder type?\n\nTerms I used is not accurate, but \"folder type\" you refer is perhaps attribute of folder in IMAP software like Dovecot instead of attribute of folder defined by RFC for IMAP.\n\n> Originally, this:\n> 7 LIST \"Archives\" \"*\"\n> * LIST (\\NoInferiors \\UnMarked) \"/\" \"Archives\"\n\n> \"Server supports folder that contains subfolders and messages\" is unchecked.\n\nTb didn't archive mail to Archives? (fall back to no yy/mm, no subfolder structure)\n\n> \"When creating a subfolder in the Archives tree to move a message to,\n> if the server does not support folders with both sub-folders and messages,\n> then create intermediate folders as \"sub-folder\" folders\".\n\nIf I understand IMAP well, there is no clearly-defined way to create intermediate folder in protocol named IMAP, although \"create abc/def/\" may be a way to create \"folder can hold subfolder only\" for some IMAP servers(it's create directory for such servers in some cases).\n\n> After I delete the Archives folder and re-create it as a \"sub-folders\" folder,\n> 2 LIST \"Archives\" \"*\"\n> * LIST (\\Noselect \\HasChildren) \"/\" \"Archives\"\n\nAs you say, \"create Archives/2011/Clients/MyClient\" is a good way, when mails in Clints/Myclients(\\NoInferiors and mail exists in it, so message can be held) is to be archived, if \"Server supports folder that contains subfolders and messages\" is unchecked, and if Archives is \"\\Noselect \\HasChildren\"(can hold subfolders only). \n\nHowever, any account's Archives folder can be set to the Archives folder of the IMAP server. In this case, mails can be held in both ABC and ABC/DEF, and one of \"create Archives/2011/ABC\" and \"create Archives/2011/ABC/DEF\" is issued first, then archive of other becomes impossible.\nThis kind of issues should be resolved.", "time": "2011-02-03T05:36:57Z", "author": "m-wada@usa.com", "creator": "m-wada@usa.com", "attachment_id": null, "text": "(In reply to comment #2)\n> Perhaps you are confusing folder capability with folder type?\n\nTerms I used is not accurate, but \"folder type\" you refer is perhaps attribute of folder in IMAP software like Dovecot instead of attribute of folder defined by RFC for IMAP.\n\n> Originally, this:\n> 7 LIST \"Archives\" \"*\"\n> * LIST (\\NoInferiors \\UnMarked) \"/\" \"Archives\"\n\n> \"Server supports folder that contains subfolders and messages\" is unchecked.\n\nTb didn't archive mail to Archives? (fall back to no yy/mm, no subfolder structure)\n\n> \"When creating a subfolder in the Archives tree to move a message to,\n> if the server does not support folders with both sub-folders and messages,\n> then create intermediate folders as \"sub-folder\" folders\".\n\nIf I understand IMAP well, there is no clearly-defined way to create intermediate folder in protocol named IMAP, although \"create abc/def/\" may be a way to create \"folder can hold subfolder only\" for some IMAP servers(it's create directory for such servers in some cases).\n\n> After I delete the Archives folder and re-create it as a \"sub-folders\" folder,\n> 2 LIST \"Archives\" \"*\"\n> * LIST (\\Noselect \\HasChildren) \"/\" \"Archives\"\n\nAs you say, \"create Archives/2011/Clients/MyClient\" is a good way, when mails in Clints/Myclients(\\NoInferiors and mail exists in it, so message can be held) is to be archived, if \"Server supports folder that contains subfolders and messages\" is unchecked, and if Archives is \"\\Noselect \\HasChildren\"(can hold subfolders only). \n\nHowever, any account's Archives folder can be set to the Archives folder of the IMAP server. In this case, mails can be held in both ABC and ABC/DEF, and one of \"create Archives/2011/ABC\" and \"create Archives/2011/ABC/DEF\" is issued first, then archive of other becomes impossible.\nThis kind of issues should be resolved.", "is_private": false, "count": 3, "id": 5250773, "creation_time": "2011-02-03T05:36:57Z", "tags": []}, {"bug_id": 630784, "raw_text": "(In reply to comment #3)\n> Tb didn't archive mail to Archives? (fall back to no yy/mm, no subfolder\n> structure)\n\nIf Archives is a \"messages\" folder, then it just saves the email into that without creating any subfolders, but if Archives is a \"sub-folders\" folder, then Thunderbird does actually try to create the relevant subfolders to create the path for the final folder where the message should be moved.\n\nI presume it checks that Archives does or does not have \\HasChildren or \\NoInferiors, which is probably correct behaviour.  However, it simply fails to create the correct type of subfolders while its trying to construct the rest of the path.  I've verified this by manually replacing (on the server) the \"messages\" intermediate folders that it creates with \"sub-folders\" intermediate folders; Thunderbird will then happily move the message to the leaf folder at the end of the path from \"Archives\".\n\n> > \"When creating a subfolder in the Archives tree to move a message to,\n> > if the server does not support folders with both sub-folders and messages,\n> > then create intermediate folders as \"sub-folder\" folders\".\n> \n> If I understand IMAP well, there is no clearly-defined way to create\n> intermediate folder in protocol named IMAP\n\nMy observation of Thunderbird's behaviour is that it simply creates the path one subfolder at a time until all the subfolders in the path have been created (ie: multiple commands).  Thunderbird merely needs to create \"sub-folders\" folders for non-leaf sub-folders that it creates.\n\nHere's my analysis of what Thunderbird currently does, when I tell it to archive a message in Clients/MyClient:\n\n  * Create folder \"Archives/2011\"\n  * Create folder \"Archives/2011/Clients\"\n  * Create folder \"Archives/2011/Clients/MyClient\"\n  * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n\nHere's what I think it should do, when it's archiving a message on an IMAP server that does not support folders that can contain both sub-folders and messages:\n\n  * Create folder \"Archives/2011/\" (note the trailing '/')\n  * Create folder \"Archives/2011/Clients/\" (note the trailing '/')\n  * Create folder \"Archives/2011/Clients/MyClient\"\n  * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n\nOr with IMAP servers that support the automatic creation of intermediate folders, Thunderbird could even just do this:\n\n  * Create folder \"Archives/2011/Clients/MyClient\"\n  * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n\nI know that Dovecot 1.0.7 supports it; perhaps that could be configurable?\n\n> However, any account's Archives folder can be set to the Archives folder of the\n> IMAP server. In this case, mails can be held in both ABC and ABC/DEF, and one\n> of \"create Archives/2011/ABC\" and \"create Archives/2011/ABC/DEF\" is issued\n> first, then archive of other becomes impossible.\n> This kind of issues should be resolved.\n\nThat's a good point.  I'd like to know what percentage of people would archive from an account that supports \"sub-folders and messages together\" to an account that does not support \"sub-folders and messages together\".  I would expect it to be relatively low.\n\nPerhaps in that case a sub-folder could be created for the purpose?  For example, archive a message in ABC/DEF by moving it to Archives/2011/ABC/DEF/Messages; this would allow you to archive a message in ABC by moving it to Archives/2011/ABC/Messages.\n\nI think it's a bit ugly, but it would probably work well enough...  Maybe make it configurable?", "time": "2011-02-03T06:50:49Z", "attachment_id": null, "author": "mozilla@msquared.id.au", "creator": "mozilla@msquared.id.au", "text": "(In reply to comment #3)\n> Tb didn't archive mail to Archives? (fall back to no yy/mm, no subfolder\n> structure)\n\nIf Archives is a \"messages\" folder, then it just saves the email into that without creating any subfolders, but if Archives is a \"sub-folders\" folder, then Thunderbird does actually try to create the relevant subfolders to create the path for the final folder where the message should be moved.\n\nI presume it checks that Archives does or does not have \\HasChildren or \\NoInferiors, which is probably correct behaviour.  However, it simply fails to create the correct type of subfolders while its trying to construct the rest of the path.  I've verified this by manually replacing (on the server) the \"messages\" intermediate folders that it creates with \"sub-folders\" intermediate folders; Thunderbird will then happily move the message to the leaf folder at the end of the path from \"Archives\".\n\n> > \"When creating a subfolder in the Archives tree to move a message to,\n> > if the server does not support folders with both sub-folders and messages,\n> > then create intermediate folders as \"sub-folder\" folders\".\n> \n> If I understand IMAP well, there is no clearly-defined way to create\n> intermediate folder in protocol named IMAP\n\nMy observation of Thunderbird's behaviour is that it simply creates the path one subfolder at a time until all the subfolders in the path have been created (ie: multiple commands).  Thunderbird merely needs to create \"sub-folders\" folders for non-leaf sub-folders that it creates.\n\nHere's my analysis of what Thunderbird currently does, when I tell it to archive a message in Clients/MyClient:\n\n  * Create folder \"Archives/2011\"\n  * Create folder \"Archives/2011/Clients\"\n  * Create folder \"Archives/2011/Clients/MyClient\"\n  * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n\nHere's what I think it should do, when it's archiving a message on an IMAP server that does not support folders that can contain both sub-folders and messages:\n\n  * Create folder \"Archives/2011/\" (note the trailing '/')\n  * Create folder \"Archives/2011/Clients/\" (note the trailing '/')\n  * Create folder \"Archives/2011/Clients/MyClient\"\n  * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n\nOr with IMAP servers that support the automatic creation of intermediate folders, Thunderbird could even just do this:\n\n  * Create folder \"Archives/2011/Clients/MyClient\"\n  * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n\nI know that Dovecot 1.0.7 supports it; perhaps that could be configurable?\n\n> However, any account's Archives folder can be set to the Archives folder of the\n> IMAP server. In this case, mails can be held in both ABC and ABC/DEF, and one\n> of \"create Archives/2011/ABC\" and \"create Archives/2011/ABC/DEF\" is issued\n> first, then archive of other becomes impossible.\n> This kind of issues should be resolved.\n\nThat's a good point.  I'd like to know what percentage of people would archive from an account that supports \"sub-folders and messages together\" to an account that does not support \"sub-folders and messages together\".  I would expect it to be relatively low.\n\nPerhaps in that case a sub-folder could be created for the purpose?  For example, archive a message in ABC/DEF by moving it to Archives/2011/ABC/DEF/Messages; this would allow you to archive a message in ABC by moving it to Archives/2011/ABC/Messages.\n\nI think it's a bit ugly, but it would probably work well enough...  Maybe make it configurable?", "is_private": false, "id": 5250852, "count": 4, "creation_time": "2011-02-03T06:50:49Z", "tags": []}, {"id": 5250914, "count": 5, "is_private": false, "text": "(In reply to comment #4)\n> Here's what I think it should do, when it's archiving a message on an IMAP\n> server that does not support folders that can contain both sub-folders and\n> messages:\n>   * Create folder \"Archives/2011/\" (note the trailing '/')\n>   * Create folder \"Archives/2011/Clients/\" (note the trailing '/')\n>   * Create folder \"Archives/2011/Clients/MyClient\"\n>   * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n\nSome servers support it, and Tb issues such create command if trailing slash is specified upon manual creation of an IMAP folder. But Bug 301714 occurs after successuful create request. Some manual actions are required to subscribe and use the created folder as you want.\nDoes your server create folder XXX of \"\\Noselect \\HasChildren\" when you request Tb to create XXX/(with trailing slash)?\n\nProblem in this method is;\nThere is no way to know server's behaviour is as you want or not, via CAPABILITY response, LIST response etc., and there is no garantee that any server behaves same. In some IMAP servers, it merely works as expected simply because \"/\" is file path delimiter of file system at server and directry is created if \"/\" is specified at last position.\nAnd, needless to say, existence of Bug 301714.\n\n> * Create folder \"Archives/2011/Clients/MyClient\"\n> * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n> I know that Dovecot 1.0.7 supports it; (snip)\n\nGmail IMAP also accepts it, and creates Archives/2011 and Archives/2011/Client as folder of \\Noselect (Grayed out at folder pane. Gmail Label of Archives/2011 and Archives/2011/Client is not created. Gmail Label of Archives/2011/Clients/MyClient only is created in addition to Gmail Label of Archives.)\n\n> perhaps that could be configurable?\n\nConfiguarable at server? At Tb?\nAt Tb, \"don't create parent folders, create lowest folder only by a craete command with full path\" is better optional, because user can uncheck \"Server supports folder that contains subfolders and messages\" by his mistake.\nAnd the option should work only when \"Server supports folder that contains subfolders and messages\" is unchecked and Archives folder has attribute of \\Noselect and doesn't have \\Noinferior.\n\n> I would expect it to be relatively low.\n\nEven if low possibility, appropriate error message or warning is mandatory, because user can enable or disable any option and user can choose any existent folder of any account as archive folder at Copies&Folders UI.\n\nConfirming, by your IMAP log.", "tags": [], "creation_time": "2011-02-03T07:52:02Z", "raw_text": "(In reply to comment #4)\n> Here's what I think it should do, when it's archiving a message on an IMAP\n> server that does not support folders that can contain both sub-folders and\n> messages:\n>   * Create folder \"Archives/2011/\" (note the trailing '/')\n>   * Create folder \"Archives/2011/Clients/\" (note the trailing '/')\n>   * Create folder \"Archives/2011/Clients/MyClient\"\n>   * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n\nSome servers support it, and Tb issues such create command if trailing slash is specified upon manual creation of an IMAP folder. But Bug 301714 occurs after successuful create request. Some manual actions are required to subscribe and use the created folder as you want.\nDoes your server create folder XXX of \"\\Noselect \\HasChildren\" when you request Tb to create XXX/(with trailing slash)?\n\nProblem in this method is;\nThere is no way to know server's behaviour is as you want or not, via CAPABILITY response, LIST response etc., and there is no garantee that any server behaves same. In some IMAP servers, it merely works as expected simply because \"/\" is file path delimiter of file system at server and directry is created if \"/\" is specified at last position.\nAnd, needless to say, existence of Bug 301714.\n\n> * Create folder \"Archives/2011/Clients/MyClient\"\n> * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n> I know that Dovecot 1.0.7 supports it; (snip)\n\nGmail IMAP also accepts it, and creates Archives/2011 and Archives/2011/Client as folder of \\Noselect (Grayed out at folder pane. Gmail Label of Archives/2011 and Archives/2011/Client is not created. Gmail Label of Archives/2011/Clients/MyClient only is created in addition to Gmail Label of Archives.)\n\n> perhaps that could be configurable?\n\nConfiguarable at server? At Tb?\nAt Tb, \"don't create parent folders, create lowest folder only by a craete command with full path\" is better optional, because user can uncheck \"Server supports folder that contains subfolders and messages\" by his mistake.\nAnd the option should work only when \"Server supports folder that contains subfolders and messages\" is unchecked and Archives folder has attribute of \\Noselect and doesn't have \\Noinferior.\n\n> I would expect it to be relatively low.\n\nEven if low possibility, appropriate error message or warning is mandatory, because user can enable or disable any option and user can choose any existent folder of any account as archive folder at Copies&Folders UI.\n\nConfirming, by your IMAP log.", "bug_id": 630784, "author": "m-wada@usa.com", "creator": "m-wada@usa.com", "attachment_id": null, "time": "2011-02-03T07:52:02Z"}, {"count": 6, "id": 5253727, "text": "(In reply to comment #5)\n\n> >   * Create folder \"Archives/2011/\" (note the trailing '/')\n> >   * Create folder \"Archives/2011/Clients/\" (note the trailing '/')\n> >   * Create folder \"Archives/2011/Clients/MyClient\"\n> >   * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n> \n> Some servers support it, and Tb issues such create command if trailing slash is\n> specified upon manual creation of an IMAP folder. But Bug 301714 occurs after\n> successuful create request. Some manual actions are required to subscribe and\n> use the created folder as you want.\n\nIn the case of the IMAP server that I'm using, I've not found this to be a problem; the \"sub-folders\" folder can't be selected anyway.\n\n> Does your server create folder XXX of \"\\Noselect \\HasChildren\" when you request\n> Tb to create XXX/(with trailing slash)?\n\nYes, that is correct.\n\n> Problem in this method is;\n> There is no way to know server's behaviour is as you want or not, via\n> CAPABILITY response, LIST response etc., and there is no garantee that any\n> server behaves same. In some IMAP servers, it merely works as expected simply\n> because \"/\" is file path delimiter of file system at server and directry is\n> created if \"/\" is specified at last position.\n\nAnywhere that I say \"/\", I mean \"heirarchy separator character\", which can be determined via 'LIST \"\" \"\"'.\n\nUnless I'm missing some other server behaviour you are referring to?\n\n> > * Create folder \"Archives/2011/Clients/MyClient\"\n> > * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n> > I know that Dovecot 1.0.7 supports it; perhaps that could be configurable?\n> \n> Configuarable at server? At Tb?\n\nSorry, I meant at Thunderbird.  By \"could be configurable\", I meant \"could be made configurable (at Thunderbird)\".\n\n> At Tb, \"don't create parent folders, create lowest folder only by a craete\n> command with full path\" is better optional, because user can uncheck \"Server\n> supports folder that contains subfolders and messages\" by his mistake.\n> And the option should work only when \"Server supports folder that contains\n> subfolders and messages\" is unchecked and Archives folder has attribute of\n> \\Noselect and doesn't have \\Noinferior.\n\nIt might be better to create the intermediate folders manually (as Thunderbird currently seems to try to do, but with the heirarchy separator character appended), since the IMAP spec (RFC 3501, sect 6.3.3) only indicates that the server SHOULD create intermediate folders (not that the server MUST create intermediate folders).\n\nAlso, it should be safe to append the heirarchy separator character even on servers that don't require it, since the spec says \"Server implementations that do not require this declaration [of intent to create sub-folders, by appending the heirarchy separator character] MUST ignore the declaration.\"\n\n> > I would expect it to be relatively low.\n> \n> Even if low possibility, appropriate error message or warning is mandatory,\n> because user can enable or disable any option and user can choose any existent\n> folder of any account as archive folder at Copies&Folders UI.\n\nFunny you should mention \"appropriate error message\": I was confused when I initially came across this issue, because Thunderbird did not issue a warning or error message when it failed to archive my message; Thunderbird just silently did not move the message.  (At least it did not lose the message...)", "is_private": false, "tags": [], "creation_time": "2011-02-04T04:02:19Z", "raw_text": "(In reply to comment #5)\n\n> >   * Create folder \"Archives/2011/\" (note the trailing '/')\n> >   * Create folder \"Archives/2011/Clients/\" (note the trailing '/')\n> >   * Create folder \"Archives/2011/Clients/MyClient\"\n> >   * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n> \n> Some servers support it, and Tb issues such create command if trailing slash is\n> specified upon manual creation of an IMAP folder. But Bug 301714 occurs after\n> successuful create request. Some manual actions are required to subscribe and\n> use the created folder as you want.\n\nIn the case of the IMAP server that I'm using, I've not found this to be a problem; the \"sub-folders\" folder can't be selected anyway.\n\n> Does your server create folder XXX of \"\\Noselect \\HasChildren\" when you request\n> Tb to create XXX/(with trailing slash)?\n\nYes, that is correct.\n\n> Problem in this method is;\n> There is no way to know server's behaviour is as you want or not, via\n> CAPABILITY response, LIST response etc., and there is no garantee that any\n> server behaves same. In some IMAP servers, it merely works as expected simply\n> because \"/\" is file path delimiter of file system at server and directry is\n> created if \"/\" is specified at last position.\n\nAnywhere that I say \"/\", I mean \"heirarchy separator character\", which can be determined via 'LIST \"\" \"\"'.\n\nUnless I'm missing some other server behaviour you are referring to?\n\n> > * Create folder \"Archives/2011/Clients/MyClient\"\n> > * Move message from \"Clients/MyClient\" to \"Archives/2011/Clients/MyClient\"\n> > I know that Dovecot 1.0.7 supports it; perhaps that could be configurable?\n> \n> Configuarable at server? At Tb?\n\nSorry, I meant at Thunderbird.  By \"could be configurable\", I meant \"could be made configurable (at Thunderbird)\".\n\n> At Tb, \"don't create parent folders, create lowest folder only by a craete\n> command with full path\" is better optional, because user can uncheck \"Server\n> supports folder that contains subfolders and messages\" by his mistake.\n> And the option should work only when \"Server supports folder that contains\n> subfolders and messages\" is unchecked and Archives folder has attribute of\n> \\Noselect and doesn't have \\Noinferior.\n\nIt might be better to create the intermediate folders manually (as Thunderbird currently seems to try to do, but with the heirarchy separator character appended), since the IMAP spec (RFC 3501, sect 6.3.3) only indicates that the server SHOULD create intermediate folders (not that the server MUST create intermediate folders).\n\nAlso, it should be safe to append the heirarchy separator character even on servers that don't require it, since the spec says \"Server implementations that do not require this declaration [of intent to create sub-folders, by appending the heirarchy separator character] MUST ignore the declaration.\"\n\n> > I would expect it to be relatively low.\n> \n> Even if low possibility, appropriate error message or warning is mandatory,\n> because user can enable or disable any option and user can choose any existent\n> folder of any account as archive folder at Copies&Folders UI.\n\nFunny you should mention \"appropriate error message\": I was confused when I initially came across this issue, because Thunderbird did not issue a warning or error message when it failed to archive my message; Thunderbird just silently did not move the message.  (At least it did not lose the message...)", "bug_id": 630784, "attachment_id": null, "author": "mozilla@msquared.id.au", "creator": "mozilla@msquared.id.au", "time": "2011-02-04T04:02:19Z"}, {"bug_id": 630784, "raw_text": "Limitations of this patch's functionality:\n\n  * The Archives folder must already be a \"sub-folders\" folder;\n  * If archive_granularity>0:\n      the Archives folder must contain the correct year sub-folder(s),\n      and it/they must be a \"sub-folders\" folder;\n  * If archive_granularity>1:\n      the Archives folder must contain the correct year sub-folder(s),\n      and month sub-folder(s), and they must be \"sub-folders\" folders.\n\nThe code that creates the year and/or month sub-folders will probably also need to be modified to create them as \"sub-folders\" folders.  It would probably be similar logic as for the sub-folders that reflect the message's origin, but I notice the code to create the year and month sub-folders are somewhat different from the code to create the sub-folders to reflect the message's origin.\n\nNote that I copied code for determining what type of folders are supported directly from mail/base/content/folderPane.js; I think this code might just use the flag that the user set in regard to dual-use folders.  Perhaps it might be better to actually ask the server itself, but I'm not sure how to go about that.\n\nI tested this as follows:\n\n  * Created \"Archives/2011/\" (note trailing '/')\n  * Archived an email in \"Clients/MyClient\"\n\nThunderbird responded as follows:\n\n  * Created \"Archives/2011/Clients/\" (trailing slash)\n  * Created \"Archives/2011/Clients/MyClients\" (no trailing slash)\n  * Moved the message to \"Archives/2011/Clients/MyClients\"", "time": "2011-02-09T04:02:32Z", "attachment_id": 510927, "creator": "mozilla@msquared.id.au", "author": "mozilla@msquared.id.au", "text": "Created attachment 510927\nCreate \"sub-folders\" folders for intermediate folders when archive_keep_folder_structure=true\n\nLimitations of this patch's functionality:\n\n  * The Archives folder must already be a \"sub-folders\" folder;\n  * If archive_granularity>0:\n      the Archives folder must contain the correct year sub-folder(s),\n      and it/they must be a \"sub-folders\" folder;\n  * If archive_granularity>1:\n      the Archives folder must contain the correct year sub-folder(s),\n      and month sub-folder(s), and they must be \"sub-folders\" folders.\n\nThe code that creates the year and/or month sub-folders will probably also need to be modified to create them as \"sub-folders\" folders.  It would probably be similar logic as for the sub-folders that reflect the message's origin, but I notice the code to create the year and month sub-folders are somewhat different from the code to create the sub-folders to reflect the message's origin.\n\nNote that I copied code for determining what type of folders are supported directly from mail/base/content/folderPane.js; I think this code might just use the flag that the user set in regard to dual-use folders.  Perhaps it might be better to actually ask the server itself, but I'm not sure how to go about that.\n\nI tested this as follows:\n\n  * Created \"Archives/2011/\" (note trailing '/')\n  * Archived an email in \"Clients/MyClient\"\n\nThunderbird responded as follows:\n\n  * Created \"Archives/2011/Clients/\" (trailing slash)\n  * Created \"Archives/2011/Clients/MyClients\" (no trailing slash)\n  * Moved the message to \"Archives/2011/Clients/MyClients\"", "is_private": false, "id": 5265361, "count": 7, "creation_time": "2011-02-09T04:02:32Z", "tags": []}, {"is_private": false, "text": "Just a small note that the patch attached in comment #7 will also need to be revised to use the proper hierarchy separator rather than just a hard-coded \"/\".", "bug_id": 630784, "raw_text": "Just a small note that the patch attached in comment #7 will also need to be revised to use the proper hierarchy separator rather than just a hard-coded \"/\".", "count": 8, "id": 5449457, "time": "2011-05-04T20:58:26Z", "creator": "MidSpeck@hotmail.com", "author": "MidSpeck@hotmail.com", "attachment_id": null, "creation_time": "2011-05-04T20:58:26Z", "tags": []}, {"id": 5453099, "count": 9, "is_private": false, "text": "(In reply to comment #8)\n> Just a small note that the patch attached in comment #7 will also need to be\n> revised to use the proper hierarchy separator rather than just a hard-coded\n> \"/\".\n\nMsquarad could you do that ? Sorry for missing the pacth in february.", "tags": [], "creation_time": "2011-05-06T10:27:51Z", "raw_text": "(In reply to comment #8)\n> Just a small note that the patch attached in comment #7 will also need to be\n> revised to use the proper hierarchy separator rather than just a hard-coded\n> \"/\".\n\nMsquarad could you do that ? Sorry for missing the pacth in february.", "bug_id": 630784, "author": "ludovic@hirlimann.net", "attachment_id": null, "creator": "ludovic@hirlimann.net", "time": "2011-05-06T10:27:51Z"}, {"bug_id": 630784, "raw_text": "Patches don't go anywhere if they don't get reviews. Review requested.", "time": "2011-05-06T10:29:18Z", "attachment_id": null, "creator": "ludovic@hirlimann.net", "author": "ludovic@hirlimann.net", "is_private": false, "text": "Patches don't go anywhere if they don't get reviews. Review requested.", "id": 5453102, "count": 10, "tags": [], "creation_time": "2011-05-06T10:29:18Z"}, {"raw_text": "It seems wrong that this code should need to have to know about dual use folders. Perhaps we could add a new method or argument that says we're creating an intermediate folder, and the imap code could know to check for dual use folders and append the '/' automatically.", "bug_id": 630784, "creator": "mozilla@davidbienvenu.org", "author": "mozilla@davidbienvenu.org", "attachment_id": 510927, "time": "2011-05-09T21:58:12Z", "count": 11, "id": 5458220, "is_private": false, "text": "Comment on attachment 510927\nCreate \"sub-folders\" folders for intermediate folders when archive_keep_folder_structure=true\n\nIt seems wrong that this code should need to have to know about dual use folders. Perhaps we could add a new method or argument that says we're creating an intermediate folder, and the imap code could know to check for dual use folders and append the '/' automatically.", "creation_time": "2011-05-09T21:58:12Z", "tags": []}, {"creation_time": "2012-07-31T09:39:04Z", "tags": [], "creator": "lukefilewalker@gmx.net", "attachment_id": null, "author": "lukefilewalker@gmx.net", "time": "2012-07-31T09:39:04Z", "raw_text": "Hi\n\nIs this the same bug like in \"Bug 697706\"? \n\nIf yes, there is a patch in first post. How can i \"install\" this patch?", "id": 6519652, "count": 12, "is_private": false, "text": "Hi\n\nIs this the same bug like in \"Bug 697706\"? \n\nIf yes, there is a patch in first post. How can i \"install\" this patch?", "bug_id": 630784}, {"creation_time": "2012-09-04T14:51:25Z", "tags": [], "id": 6607386, "count": 13, "text": "(In reply to Luke Filewalker from comment #12)\n> Hi\n> \n> Is this the same bug like in \"Bug 697706\"? \n\nI don't think so.\n\n> If yes, there is a patch in first post. How can i \"install\" this patch?\n\nYou will need to compile the sources of thunderbird as explained at https://developer.mozilla.org/en-US/docs/Simple_Thunderbird_build\n\n\n\n(In reply to David :Bienvenu from comment #11)\n> Comment on attachment 510927\n> Create \"sub-folders\" folders for intermediate folders when\n> archive_keep_folder_structure=true\n> \n> It seems wrong that this code should need to have to know about dual use\n> folders. Perhaps we could add a new method or argument that says we're\n> creating an intermediate folder, and the imap code could know to check for\n> dual use folders and append the '/' automatically.\n\nI guess a new patch is needed ...", "is_private": false, "attachment_id": null, "author": "ludovic@hirlimann.net", "creator": "ludovic@hirlimann.net", "time": "2012-09-04T14:51:25Z", "raw_text": "(In reply to Luke Filewalker from comment #12)\n> Hi\n> \n> Is this the same bug like in \"Bug 697706\"? \n\nI don't think so.\n\n> If yes, there is a patch in first post. How can i \"install\" this patch?\n\nYou will need to compile the sources of thunderbird as explained at https://developer.mozilla.org/en-US/docs/Simple_Thunderbird_build\n\n\n\n(In reply to David :Bienvenu from comment #11)\n> Comment on attachment 510927\n> Create \"sub-folders\" folders for intermediate folders when\n> archive_keep_folder_structure=true\n> \n> It seems wrong that this code should need to have to know about dual use\n> folders. Perhaps we could add a new method or argument that says we're\n> creating an intermediate folder, and the imap code could know to check for\n> dual use folders and append the '/' automatically.\n\nI guess a new patch is needed ...", "bug_id": 630784}, {"time": "2017-06-23T12:46:25Z", "creator": "Lukas.Ruf@lpr.ch", "author": "Lukas.Ruf@lpr.ch", "attachment_id": null, "bug_id": 630784, "raw_text": "With latest Thunderbird released that is connected to dovecot via IMAP I suffer from the same problem as the original poster a couple of years ago.\n\nIs there anyhwere a patch that I can apply easily to fix this problem?  Otherwise, how can I support?\n\nThanks\n\nLukas", "creation_time": "2017-06-23T12:46:25Z", "tags": [], "text": "With latest Thunderbird released that is connected to dovecot via IMAP I suffer from the same problem as the original poster a couple of years ago.\n\nIs there anyhwere a patch that I can apply easily to fix this problem?  Otherwise, how can I support?\n\nThanks\n\nLukas", "is_private": false, "count": 14, "id": 12424839}]}}, "comments": {}}