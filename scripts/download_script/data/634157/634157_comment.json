{"comments": {}, "bugs": {"634157": {"comments": [{"time": "2011-02-15T02:30:46Z", "tags": [], "is_private": false, "bug_id": 634157, "raw_text": "User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0b11) Gecko/20100101 Firefox/4.0b11\nBuild Identifier: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.11) Gecko/20110212 Shredder/3.0.6\n\nReference:http://forums.mozillazine.org/viewtopic.php?t=459442&highlight=\n\nSome special Chinese GB2312 character in mail subject show wrong.\n\nReproducible: Always\n\nSteps to Reproduce:\n1.compose a new mail\n2.type Chinese character \"\u5e94\u8058\" in subject\n3.send the mail\n\nCharacter encoding sets to \"Chinese Simplified (GB2312)\"\nActual Results:  \nsubject:\u04e6\u01b8\n\nExpected Results:  \nsubject:\u5e94\u8058\n\nThe reason has been found now. Because GB2312 and UTF-8 have conflicts in some characters. Such as \u5e94\uff0cGB2312 code is \"d3a6\", and \"d3a6\" is \u04e6 in UTF-8.\n\nnsUTF8ConverterService::ConvertStringToUTF8(const nsACString &aString, \n                                            const char *aCharset, \n                                            PRBool aSkipCheck, \n                                            nsACString &aUTF8String)\n{\n  // return if ASCII only or valid UTF-8 providing that the ASCII/UTF-8\n  // check is requested. It may not be asked for if a caller suspects\n  // that the input is in non-ASCII 7bit charset (ISO-2022-xx, HZ) or \n  // it's in a charset other than UTF-8 that can be mistaken for UTF-8.\n  if (!aSkipCheck && (IsASCII(aString) || IsUTF8(aString))) {\n    aUTF8String = aString;\n    return NS_OK;\n  }\n\nWhen handle a GB2312 subject such as \"\u5e94\", aSkipCheck value will be false. And IsUTF8 will true because of the conflict. All have to do now is just skip check operation if aCharset is \"GB2312\".", "count": 0, "text": "User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0b11) Gecko/20100101 Firefox/4.0b11\nBuild Identifier: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.11) Gecko/20110212 Shredder/3.0.6\n\nReference:http://forums.mozillazine.org/viewtopic.php?t=459442&highlight=\n\nSome special Chinese GB2312 character in mail subject show wrong.\n\nReproducible: Always\n\nSteps to Reproduce:\n1.compose a new mail\n2.type Chinese character \"\u5e94\u8058\" in subject\n3.send the mail\n\nCharacter encoding sets to \"Chinese Simplified (GB2312)\"\nActual Results:  \nsubject:\u04e6\u01b8\n\nExpected Results:  \nsubject:\u5e94\u8058\n\nThe reason has been found now. Because GB2312 and UTF-8 have conflicts in some characters. Such as \u5e94\uff0cGB2312 code is \"d3a6\", and \"d3a6\" is \u04e6 in UTF-8.\n\nnsUTF8ConverterService::ConvertStringToUTF8(const nsACString &aString, \n                                            const char *aCharset, \n                                            PRBool aSkipCheck, \n                                            nsACString &aUTF8String)\n{\n  // return if ASCII only or valid UTF-8 providing that the ASCII/UTF-8\n  // check is requested. It may not be asked for if a caller suspects\n  // that the input is in non-ASCII 7bit charset (ISO-2022-xx, HZ) or \n  // it's in a charset other than UTF-8 that can be mistaken for UTF-8.\n  if (!aSkipCheck && (IsASCII(aString) || IsUTF8(aString))) {\n    aUTF8String = aString;\n    return NS_OK;\n  }\n\nWhen handle a GB2312 subject such as \"\u5e94\", aSkipCheck value will be false. And IsUTF8 will true because of the conflict. All have to do now is just skip check operation if aCharset is \"GB2312\".", "creator": "dongdongdeng@hotmail.com", "id": 5278885, "attachment_id": null, "author": "dongdongdeng@hotmail.com", "creation_time": "2011-02-15T02:30:46Z"}, {"bug_id": 634157, "count": 1, "time": "2011-02-21T13:33:05Z", "creator": "ludovic@hirlimann.net", "author": "ludovic@hirlimann.net", "raw_text": "Would you like to make a patch ?", "tags": [], "is_private": false, "creation_time": "2011-02-21T13:33:05Z", "text": "Would you like to make a patch ?", "attachment_id": null, "id": 5294003}, {"count": 2, "raw_text": "Confirmed with next builds.\n> Tb 3.1.7 on Win-XP\n> Mozilla/5.0 (Windows NT 5.1; rv:2.0b12pre) Gecko/20110220 Thunderbird/3.3a3pre\n\nMessage header only issue such as Subject: which is RFC2047 encoded using GB2312.\nNo problem in message body text. \nNeedless to say, problem also occurs with GB18030, because it's super set of GB2312.", "bug_id": 634157, "is_private": false, "tags": [], "time": "2011-02-21T16:17:32Z", "creation_time": "2011-02-21T16:17:32Z", "author": "m-wada@usa.com", "attachment_id": null, "id": 5294209, "text": "Confirmed with next builds.\n> Tb 3.1.7 on Win-XP\n> Mozilla/5.0 (Windows NT 5.1; rv:2.0b12pre) Gecko/20110220 Thunderbird/3.3a3pre\n\nMessage header only issue such as Subject: which is RFC2047 encoded using GB2312.\nNo problem in message body text. \nNeedless to say, problem also occurs with GB18030, because it's super set of GB2312.", "creator": "m-wada@usa.com"}, {"count": 3, "bug_id": 634157, "raw_text": "mozilla\\netwerk\\mime\\src\\nsMIMEHeaderParamImpl.cpp\nnsresult DecodeRFC2047Str(const char *aHeader, const char *aDefaultCharset, \n                          PRBool aOverrideCharset, nsACString &aResult)\n{\n  // ... patch...\n}", "tags": [], "is_private": false, "time": "2011-02-22T08:01:17Z", "creation_time": "2011-02-22T08:01:17Z", "author": "dongdongdeng@hotmail.com", "text": "Created attachment 514146\nPatch to nsMIMEHeaderParamImpl.cpp\n\nmozilla\\netwerk\\mime\\src\\nsMIMEHeaderParamImpl.cpp\nnsresult DecodeRFC2047Str(const char *aHeader, const char *aDefaultCharset, \n                          PRBool aOverrideCharset, nsACString &aResult)\n{\n  // ... patch...\n}", "creator": "dongdongdeng@hotmail.com", "id": 5295354, "attachment_id": 514146}, {"creation_time": "2011-02-22T08:58:30Z", "author": "ludovic@hirlimann.net", "text": "(In reply to comment #3)\n> Created attachment 514146 [details]\n> Patch to nsMIMEHeaderParamImpl.cpp\n> \n> mozilla\\netwerk\\mime\\src\\nsMIMEHeaderParamImpl.cpp\n> nsresult DecodeRFC2047Str(const char *aHeader, const char *aDefaultCharset, \n>                           PRBool aOverrideCharset, nsACString &aResult)\n> {\n>   // ... patch...\n> }\n\nThank you for the patch. Could you provide  a hg diff instead of this (see our documentation at https://developer.mozilla.org/en/Creating_a_patch ) ?", "creator": "ludovic@hirlimann.net", "attachment_id": null, "id": 5295390, "count": 4, "bug_id": 634157, "raw_text": "(In reply to comment #3)\n> Created attachment 514146 [details]\n> Patch to nsMIMEHeaderParamImpl.cpp\n> \n> mozilla\\netwerk\\mime\\src\\nsMIMEHeaderParamImpl.cpp\n> nsresult DecodeRFC2047Str(const char *aHeader, const char *aDefaultCharset, \n>                           PRBool aOverrideCharset, nsACString &aResult)\n> {\n>   // ... patch...\n> }\n\nThank you for the patch. Could you provide  a hg diff instead of this (see our documentation at https://developer.mozilla.org/en/Creating_a_patch ) ?", "tags": [], "is_private": false, "time": "2011-02-22T08:58:30Z"}, {"author": "ludovic@hirlimann.net", "creator": "ludovic@hirlimann.net", "count": 5, "bug_id": 634157, "time": "2011-02-22T09:01:06Z", "creation_time": "2011-02-22T09:01:06Z", "text": "Comment on attachment 514146\nPatch to nsMIMEHeaderParamImpl.cpp\n\nHonzab does this sounds reasonable ?", "attachment_id": 514146, "id": 5295391, "raw_text": "Honzab does this sounds reasonable ?", "tags": [], "is_private": false}, {"count": 6, "bug_id": 634157, "raw_text": "The documentation makes it sound like it's the caller's responsibility to set aSkipCheck accordingly, no?", "tags": [], "is_private": false, "time": "2011-02-22T18:12:58Z", "creation_time": "2011-02-22T18:12:58Z", "author": "bzbarsky@mit.edu", "creator": "bzbarsky@mit.edu", "text": "The documentation makes it sound like it's the caller's responsibility to set aSkipCheck accordingly, no?", "attachment_id": null, "id": 5296151}, {"author": "dongdongdeng@hotmail.com", "id": 5297629, "attachment_id": 514384, "text": "Created attachment 514384\nPatch to nsMIMEHeaderParamImpl.cpp", "creator": "dongdongdeng@hotmail.com", "creation_time": "2011-02-23T02:01:37Z", "is_private": false, "tags": [], "time": "2011-02-23T02:01:37Z", "count": 7, "raw_text": "", "bug_id": 634157}, {"creation_time": "2011-02-23T02:02:41Z", "author": "dongdongdeng@hotmail.com", "attachment_id": null, "id": 5297632, "text": "Maybe, caller should know the characters need check or not.", "creator": "dongdongdeng@hotmail.com", "count": 8, "raw_text": "Maybe, caller should know the characters need check or not.", "bug_id": 634157, "is_private": false, "tags": [], "time": "2011-02-23T02:02:41Z"}, {"time": "2011-02-23T22:16:45Z", "is_private": false, "tags": [], "raw_text": "So, we are actually going to make (enhance) a blacklist of character encodings that must skip the check because IsUTF8() doesn't properly work for them (there are ambiguities).  I think it is OK.  \n\nWe should just create another macro (or rename - and then enhance - IS_7BIT_NON_ASCII_CHARSET [1] to something more general, like SKIP_CHECK_FOR_CHARSET or so) and list all the charsets we find ambiguous there.  There are more calls to ConvertStringToUTF8 that could suffer from this as well, this would fix them all.\n\nPlease let someone else that knows this code better to review/feedback to decide whether it's OK to change all calls (my proposal) or just the one (proposed in the patch).\n\n[1] http://hg.mozilla.org/mozilla-central/annotate/88752f2b3088/netwerk/mime/nsMIMEHeaderParamImpl.cpp#l70", "bug_id": 634157, "count": 9, "id": 5299957, "attachment_id": 514146, "creator": "honzab.moz@firemni.cz", "text": "Comment on attachment 514146\nPatch to nsMIMEHeaderParamImpl.cpp\n\nSo, we are actually going to make (enhance) a blacklist of character encodings that must skip the check because IsUTF8() doesn't properly work for them (there are ambiguities).  I think it is OK.  \n\nWe should just create another macro (or rename - and then enhance - IS_7BIT_NON_ASCII_CHARSET [1] to something more general, like SKIP_CHECK_FOR_CHARSET or so) and list all the charsets we find ambiguous there.  There are more calls to ConvertStringToUTF8 that could suffer from this as well, this would fix them all.\n\nPlease let someone else that knows this code better to review/feedback to decide whether it's OK to change all calls (my proposal) or just the one (proposed in the patch).\n\n[1] http://hg.mozilla.org/mozilla-central/annotate/88752f2b3088/netwerk/mime/nsMIMEHeaderParamImpl.cpp#l70", "author": "honzab.moz@firemni.cz", "creation_time": "2011-02-23T22:16:45Z"}, {"time": "2011-02-23T22:20:56Z", "count": 10, "bug_id": 634157, "author": "honzab.moz@firemni.cz", "creator": "honzab.moz@firemni.cz", "tags": [], "is_private": false, "raw_text": "BTW, interesting is that setting GB2312 on a new message, copy-pasting the subject from the description and adding Czech letters '\u011b\u0161\u010d' to it leads to encoding the subject string with UTF-8.  All is then displayed correctly, in UTF-8.", "text": "BTW, interesting is that setting GB2312 on a new message, copy-pasting the subject from the description and adding Czech letters '\u011b\u0161\u010d' to it leads to encoding the subject string with UTF-8.  All is then displayed correctly, in UTF-8.", "id": 5299976, "attachment_id": null, "creation_time": "2011-02-23T22:20:56Z"}, {"creator": "bzbarsky@mit.edu", "text": "I like Honza's suggestion.", "attachment_id": null, "id": 5299978, "author": "bzbarsky@mit.edu", "creation_time": "2011-02-23T22:22:31Z", "time": "2011-02-23T22:22:31Z", "tags": [], "is_private": false, "bug_id": 634157, "raw_text": "I like Honza's suggestion.", "count": 11}, {"id": 5301197, "attachment_id": null, "text": "(In reply to comment #9)\n> We should just create another macro (or rename - and then enhance -\n> IS_7BIT_NON_ASCII_CHARSET [1] to something more general, like\n> SKIP_CHECK_FOR_CHARSET or so) and list all the charsets we find ambiguous\n> there.  There are more calls to ConvertStringToUTF8 that could suffer from this\n> as well, this would fix them all.\n\ndongdongdeng@hotmail.com would you be up fro modifying your patch the way Honza is proposing ?\n \n> Please let someone else that knows this code better to review/feedback to\n> decide whether it's OK to change all calls (my proposal) or just the one\n> (proposed in the patch).\n\nWho would that be ?", "creation_time": "2011-02-24T10:04:32Z", "is_private": false, "tags": [], "raw_text": "(In reply to comment #9)\n> We should just create another macro (or rename - and then enhance -\n> IS_7BIT_NON_ASCII_CHARSET [1] to something more general, like\n> SKIP_CHECK_FOR_CHARSET or so) and list all the charsets we find ambiguous\n> there.  There are more calls to ConvertStringToUTF8 that could suffer from this\n> as well, this would fix them all.\n\ndongdongdeng@hotmail.com would you be up fro modifying your patch the way Honza is proposing ?\n \n> Please let someone else that knows this code better to review/feedback to\n> decide whether it's OK to change all calls (my proposal) or just the one\n> (proposed in the patch).\n\nWho would that be ?", "author": "ludovic@hirlimann.net", "creator": "ludovic@hirlimann.net", "time": "2011-02-24T10:04:32Z", "count": 12, "bug_id": 634157}, {"raw_text": "> Who would that be ?\n\nMe.  And I did just that in comment 11.", "bug_id": 634157, "count": 13, "time": "2011-02-24T13:04:50Z", "is_private": false, "tags": [], "creation_time": "2011-02-24T13:04:50Z", "id": 5301319, "attachment_id": null, "creator": "bzbarsky@mit.edu", "text": "> Who would that be ?\n\nMe.  And I did just that in comment 11.", "author": "bzbarsky@mit.edu"}, {"time": "2011-02-25T07:28:44Z", "bug_id": 634157, "count": 14, "creator": "dongdongdeng@hotmail.com", "author": "dongdongdeng@hotmail.com", "is_private": false, "tags": [], "raw_text": "(In reply to comment #12)\n> (In reply to comment #9)\n> > We should just create another macro (or rename - and then enhance -\n> > IS_7BIT_NON_ASCII_CHARSET [1] to something more general, like\n> > SKIP_CHECK_FOR_CHARSET or so) and list all the charsets we find ambiguous\n> > there.  There are more calls to ConvertStringToUTF8 that could suffer from this\n> > as well, this would fix them all.\n> \n> dongdongdeng@hotmail.com would you be up fro modifying your patch the way Honza\n> is proposing ?\n\nIf so, ConvertStringToUTF8 has to be modified.", "attachment_id": null, "id": 5303614, "text": "(In reply to comment #12)\n> (In reply to comment #9)\n> > We should just create another macro (or rename - and then enhance -\n> > IS_7BIT_NON_ASCII_CHARSET [1] to something more general, like\n> > SKIP_CHECK_FOR_CHARSET or so) and list all the charsets we find ambiguous\n> > there.  There are more calls to ConvertStringToUTF8 that could suffer from this\n> > as well, this would fix them all.\n> \n> dongdongdeng@hotmail.com would you be up fro modifying your patch the way Honza\n> is proposing ?\n\nIf so, ConvertStringToUTF8 has to be modified.", "creation_time": "2011-02-25T07:28:44Z"}, {"attachment_id": 515006, "id": 5303615, "text": "Created attachment 515006\nPatch to nsUTF8ConverterService.cpp", "creation_time": "2011-02-25T07:29:48Z", "is_private": false, "tags": [], "raw_text": "", "creator": "dongdongdeng@hotmail.com", "author": "dongdongdeng@hotmail.com", "time": "2011-02-25T07:29:48Z", "bug_id": 634157, "count": 15}, {"tags": [], "is_private": false, "raw_text": "Sorry for the lag here....\n\nIf we're going to take this approach, then:\n\n1)  Please name the macro SKIP_UTF8_CHECK_FOR_CHARSET.\n2)  Document the behavior in the IDL.\n3)  Remove the now-unnecessary IS_7BIT_NON_ASCII_CHARSET from\n    nsMimeHeaderParamImpl.", "text": "Comment on attachment 515006\nPatch to nsUTF8ConverterService.cpp\n\nSorry for the lag here....\n\nIf we're going to take this approach, then:\n\n1)  Please name the macro SKIP_UTF8_CHECK_FOR_CHARSET.\n2)  Document the behavior in the IDL.\n3)  Remove the now-unnecessary IS_7BIT_NON_ASCII_CHARSET from\n    nsMimeHeaderParamImpl.", "id": 5524363, "attachment_id": 515006, "creation_time": "2011-06-10T06:43:35Z", "time": "2011-06-10T06:43:35Z", "bug_id": 634157, "count": 16, "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu"}, {"author": "zetka@volny.cz", "creator": "zetka@volny.cz", "text": "I have opened bug which seems to be similar to this, see Bug 673135. In subject with czech chars word dest (s with hook) displays in subject with Chinese chars..", "attachment_id": null, "id": 5606669, "creation_time": "2011-07-22T10:00:45Z", "tags": [], "is_private": false, "time": "2011-07-22T10:00:45Z", "count": 17, "bug_id": 634157, "raw_text": "I have opened bug which seems to be similar to this, see Bug 673135. In subject with czech chars word dest (s with hook) displays in subject with Chinese chars.."}, {"count": 18, "raw_text": "Bulk change to priority: https://bugzilla.mozilla.org/show_bug.cgi?id=1399258", "bug_id": 634157, "is_private": false, "tags": [], "time": "2017-09-13T18:38:14Z", "creation_time": "2017-09-13T18:38:14Z", "author": "bug-husbandry-bot@mozilla.bugs", "attachment_id": null, "id": 12658458, "creator": "bug-husbandry-bot@mozilla.bugs", "text": "Bulk change to priority: https://bugzilla.mozilla.org/show_bug.cgi?id=1399258"}]}}}