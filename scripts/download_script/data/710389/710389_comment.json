{"bugs": {"710389": {"comments": [{"is_private": false, "creation_time": "2011-12-13T21:55:23Z", "bug_id": 710389, "id": 5913492, "count": 0, "text": "Created attachment 581419\nTest case HTML\n\nWith the given document, a call to PeekOffset on the div's frame with this structure:\n\nnsPeekOffsetStruct pos;\npos.SetData(eSelectWord, eDirPrevious, 0, 0, true, false, true, false, eStartWord);\n\nreturns an mContentOffset of 60, when the expected value is 0.", "author": "eitan@monotonous.org", "creator": "eitan@monotonous.org", "tags": [], "raw_text": "With the given document, a call to PeekOffset on the div's frame with this structure:\n\nnsPeekOffsetStruct pos;\npos.SetData(eSelectWord, eDirPrevious, 0, 0, true, false, true, false, eStartWord);\n\nreturns an mContentOffset of 60, when the expected value is 0.", "attachment_id": 581419, "time": "2011-12-13T21:55:23Z"}, {"attachment_id": 581421, "raw_text": "SeekPos() erroneously adjusts the offset to -1 which is later interpreted as a last-char offset.\n\nThis patch removes whitespace-only content nodes from calculation of offset. This is totally a shot in the dark, since I am not familiar with how whitespace-only nodes are generally treated.", "time": "2011-12-13T22:02:13Z", "tags": [], "author": "eitan@monotonous.org", "count": 1, "text": "Created attachment 581421\nPossible fix\n\nSeekPos() erroneously adjusts the offset to -1 which is later interpreted as a last-char offset.\n\nThis patch removes whitespace-only content nodes from calculation of offset. This is totally a shot in the dark, since I am not familiar with how whitespace-only nodes are generally treated.", "creator": "eitan@monotonous.org", "is_private": false, "creation_time": "2011-12-13T22:02:13Z", "bug_id": 710389, "id": 5913519}, {"bug_id": 710389, "id": 5913550, "is_private": false, "creation_time": "2011-12-13T22:08:55Z", "creator": "eitan@monotonous.org", "author": "eitan@monotonous.org", "text": "Created attachment 581425\nPossible fix\n\nJust a slight re-order", "count": 2, "tags": [], "time": "2011-12-13T22:08:55Z", "attachment_id": 581425, "raw_text": "Just a slight re-order"}, {"author": "tbsaunde+mozbugs@tbsaunde.org", "count": 3, "text": "Comment on attachment 581425\nPossible fix\n\n\n>@@ -2950,8 +2950,14 @@ static FrameContentRange GetRangeForFrame(nsIFrame* aFrame) {\n>     parent  = content->GetParent();\n>     if (parent) {\n>       PRInt32 beginOffset = parent->IndexOf(content);\n>-      if (beginOffset >= 0)\n\nwe usually use 8 lines of context (-U8 for most diffs).  Since you look like your using git I'd recomend using bholley's  version of git-bz.", "creator": "tbsaunde+mozbugs@tbsaunde.org", "is_private": false, "creation_time": "2011-12-14T04:42:24Z", "id": 5914609, "bug_id": 710389, "attachment_id": 581425, "raw_text": "\n>@@ -2950,8 +2950,14 @@ static FrameContentRange GetRangeForFrame(nsIFrame* aFrame) {\n>     parent  = content->GetParent();\n>     if (parent) {\n>       PRInt32 beginOffset = parent->IndexOf(content);\n>-      if (beginOffset >= 0)\n\nwe usually use 8 lines of context (-U8 for most diffs).  Since you look like your using git I'd recomend using bholley's  version of git-bz.", "time": "2011-12-14T04:42:24Z", "tags": []}, {"bug_id": 710389, "id": 5921232, "author": "tbsaunde+mozbugs@tbsaunde.org", "text": "Eitan says this was discovered when using nsIAccessibleText, but mochitest-a11y doesn't seem to cover it.", "count": 4, "time": "2011-12-16T07:44:43Z", "raw_text": "Eitan says this was discovered when using nsIAccessibleText, but mochitest-a11y doesn't seem to cover it.", "is_private": false, "creation_time": "2011-12-16T07:44:43Z", "creator": "tbsaunde+mozbugs@tbsaunde.org", "tags": [], "attachment_id": null}, {"time": "2011-12-21T22:49:54Z", "raw_text": "I'd really rather roc look at this.", "attachment_id": 581425, "tags": [], "creator": "ehsan.akhgari@gmail.com", "text": "Comment on attachment 581425\nPossible fix\n\nI'd really rather roc look at this.", "count": 5, "author": "ehsan.akhgari@gmail.com", "id": 5933845, "bug_id": 710389, "creation_time": "2011-12-21T22:49:54Z", "is_private": false}, {"id": 5933916, "bug_id": 710389, "is_private": false, "creation_time": "2011-12-21T23:13:40Z", "creator": "roc@ocallahan.org", "author": "roc@ocallahan.org", "count": 6, "text": "(In reply to Eitan Isaacson [:eeejay] from comment #1)\n> SeekPos() erroneously adjusts the offset to -1 which is later interpreted as\n> a last-char offset.\n\nSeekPos doesn't exist, what did you mean there? This sounds like a plausible explanation but I'd like to hear it in more detail :-). I suspect your patch isn't the correct fix for the bug.", "tags": [], "time": "2011-12-21T23:13:40Z", "attachment_id": null, "raw_text": "(In reply to Eitan Isaacson [:eeejay] from comment #1)\n> SeekPos() erroneously adjusts the offset to -1 which is later interpreted as\n> a last-char offset.\n\nSeekPos doesn't exist, what did you mean there? This sounds like a plausible explanation but I'd like to hear it in more detail :-). I suspect your patch isn't the correct fix for the bug."}, {"tags": [], "time": "2011-12-21T23:33:06Z", "raw_text": "Yeah, what is SeekPos??\nThe offending line is here[1]. If the given offset is 0, and the frame's content has siblings to the left of it, they get subtracted from 0, and things go wrong. Specifically when a sibling has no text.\n\n1. http://hg.mozilla.org/mozilla-central/file/803c353ee693/layout/generic/nsFrame.cpp#l5811", "attachment_id": null, "bug_id": 710389, "id": 5933956, "is_private": false, "creation_time": "2011-12-21T23:33:06Z", "creator": "eitan@monotonous.org", "text": "Yeah, what is SeekPos??\nThe offending line is here[1]. If the given offset is 0, and the frame's content has siblings to the left of it, they get subtracted from 0, and things go wrong. Specifically when a sibling has no text.\n\n1. http://hg.mozilla.org/mozilla-central/file/803c353ee693/layout/generic/nsFrame.cpp#l5811", "count": 7, "author": "eitan@monotonous.org"}, {"count": 8, "text": "I think the problem with that line is that aPos->mStartOffset is assumed to be within the frame's content node, whereas GetRangeForFrame can return a node that's not the frame's content node, so subtracting one offset from the other doesn't make sense when they're in different nodes.", "author": "roc@ocallahan.org", "id": 5933991, "bug_id": 710389, "time": "2011-12-21T23:44:27Z", "raw_text": "I think the problem with that line is that aPos->mStartOffset is assumed to be within the frame's content node, whereas GetRangeForFrame can return a node that's not the frame's content node, so subtracting one offset from the other doesn't make sense when they're in different nodes.", "creator": "roc@ocallahan.org", "is_private": false, "creation_time": "2011-12-21T23:44:27Z", "attachment_id": null, "tags": []}, {"time": "2011-12-24T06:32:36Z", "raw_text": "> Eitan says this was discovered when using nsIAccessibleText\n\nIs it nsHyperTextAccessible::GetRelativeOffset we're talking about?\nPerhaps it should do what nsFrame::PeekBackwardAndForward does and move forward\none character first?\nhttp://mxr.mozilla.org/mozilla-central/source/layout/generic/nsFrame.cpp#2642", "attachment_id": null, "tags": [], "creator": "MatsPalmgren_bugz@use.startmail.com", "count": 9, "text": "> Eitan says this was discovered when using nsIAccessibleText\n\nIs it nsHyperTextAccessible::GetRelativeOffset we're talking about?\nPerhaps it should do what nsFrame::PeekBackwardAndForward does and move forward\none character first?\nhttp://mxr.mozilla.org/mozilla-central/source/layout/generic/nsFrame.cpp#2642", "author": "MatsPalmgren_bugz@use.startmail.com", "bug_id": 710389, "id": 5938377, "creation_time": "2011-12-24T06:32:36Z", "is_private": false}, {"creation_time": "2013-08-01T16:48:05Z", "is_private": false, "bug_id": 710389, "id": 7702418, "count": 10, "text": "Comment on attachment 581425\nPossible fix\n\nRemoving review flag, since it is not going to happen :)", "author": "eitan@monotonous.org", "creator": "eitan@monotonous.org", "tags": [], "raw_text": "Removing review flag, since it is not going to happen :)", "attachment_id": 581425, "time": "2013-08-01T16:48:05Z"}]}}, "comments": {}}