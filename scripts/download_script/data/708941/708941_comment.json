{"bugs": {"708941": {"comments": [{"tags": [], "bug_id": 708941, "text": "\"From - ...\" line at top of mail data is merged with \"From ...\" line which is Unix Mbox mail separator of offline-store file by each Compact of IMAP folder of offline-use=on, and the merged line is used as new Unix Mbox mail separator.\nSo, \"From - ...\" lines at top of mail data is decreased by one upon each Compact until non \"From ...\" line appears in mail data. \n\nEven if \"From - ...\" line at top of mail data is wrong message header and is garbage generated by upload of wrong mail data, this is data loss in offline-store file. \n\nThis bug produces \"mail data length decrease in offline-store file\" by each Compact of IMAP folder of offline-use=on.\nEven though mail data length in offline-store file is always kept correctly after Compact, this kind of activity can easily produce unwanted/accidental problems in other components.\nI think \"dicard of wrong From ... lines in message header upon fetch\" is better action.\n\nThis is spin-off of bug 697635 comment #6 and bug 668482 comment #7.\nChecked with Tb 8. With Tb 7, same View/Message Source display result as Tb 8 was observed by same IMAP older, same mail data, same test procedure, altough offline-store content was nt checked.\nSome IMAP server reject wrong \"From ...\" line in message header. So, Gmail IMAP is used for test, because Gmail IMAP accepts the wrong message header.\n\n[Steps to reproduce]\n\n(0) Copy local mail folder file which contains data of one mail only as .eml file, and increase \"From: - ...\" lines to observe phenomenon easily.\nSample .eml file content.\n> From - Sat Jan 01 01:02:03 2011\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n> X-UIDL: abcdefghijklmn\n> X-Mozilla-Status: 0001\n> X-Mozilla-Status2: 00000000\n> X-Mozilla-Keys: $label1\n>(snip)\n\n(1) Drag&Drop the .eml file to thread pane of an IMAP account folder(offline-use=on). This is import of .eml file by Drag&Drop.\nContent of offline-store file.\n> From \n> From - Sat Jan 01 01:02:03 2011\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jun 01 ...\" .\n\n(2) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Sat Jan 01 01:02:03 2011\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jun 02 ...\".\n\n(3) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jun 03 ...\".\n\n(4) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jun 04 ...\".\n\n(5) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"X-Account-Key: account9\".\n\n(6) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From \n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"X-Account-Key: account9\".\n\n(7) Repair Folder of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Fri Dec 09 12:13:15 2011\n> X-Mozilla-Status: 0001\n> X-Mozilla-Status2: 00000000\n> From - Sat Jan 01 01:02:03 2011\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jan 01 ...\".\n\n(8) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Sat Jan 01 01:02:03 2011\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jan 02 ...\".\nSame as step (2).\n\nNote:\nBecause IMAP offline-store file of Tb, there is no need of \"escaping of From line\". \"Rebuild-Index on local mail folder file\" will never be invoked by Tb on offline-store file. Rebuil-Index related problem happens only when user used the offline-store file as local mail folder file(==used as ordinal Unix Mbox format mail data file).", "attachment_id": null, "raw_text": "\"From - ...\" line at top of mail data is merged with \"From ...\" line which is Unix Mbox mail separator of offline-store file by each Compact of IMAP folder of offline-use=on, and the merged line is used as new Unix Mbox mail separator.\nSo, \"From - ...\" lines at top of mail data is decreased by one upon each Compact until non \"From ...\" line appears in mail data. \n\nEven if \"From - ...\" line at top of mail data is wrong message header and is garbage generated by upload of wrong mail data, this is data loss in offline-store file. \n\nThis bug produces \"mail data length decrease in offline-store file\" by each Compact of IMAP folder of offline-use=on.\nEven though mail data length in offline-store file is always kept correctly after Compact, this kind of activity can easily produce unwanted/accidental problems in other components.\nI think \"dicard of wrong From ... lines in message header upon fetch\" is better action.\n\nThis is spin-off of bug 697635 comment #6 and bug 668482 comment #7.\nChecked with Tb 8. With Tb 7, same View/Message Source display result as Tb 8 was observed by same IMAP older, same mail data, same test procedure, altough offline-store content was nt checked.\nSome IMAP server reject wrong \"From ...\" line in message header. So, Gmail IMAP is used for test, because Gmail IMAP accepts the wrong message header.\n\n[Steps to reproduce]\n\n(0) Copy local mail folder file which contains data of one mail only as .eml file, and increase \"From: - ...\" lines to observe phenomenon easily.\nSample .eml file content.\n> From - Sat Jan 01 01:02:03 2011\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n> X-UIDL: abcdefghijklmn\n> X-Mozilla-Status: 0001\n> X-Mozilla-Status2: 00000000\n> X-Mozilla-Keys: $label1\n>(snip)\n\n(1) Drag&Drop the .eml file to thread pane of an IMAP account folder(offline-use=on). This is import of .eml file by Drag&Drop.\nContent of offline-store file.\n> From \n> From - Sat Jan 01 01:02:03 2011\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jun 01 ...\" .\n\n(2) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Sat Jan 01 01:02:03 2011\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jun 02 ...\".\n\n(3) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jun 03 ...\".\n\n(4) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jun 04 ...\".\n\n(5) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"X-Account-Key: account9\".\n\n(6) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From \n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"X-Account-Key: account9\".\n\n(7) Repair Folder of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Fri Dec 09 12:13:15 2011\n> X-Mozilla-Status: 0001\n> X-Mozilla-Status2: 00000000\n> From - Sat Jan 01 01:02:03 2011\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jan 01 ...\".\n\n(8) Compact of the IMAP folder of offline-use=on.\nContent of offline-store file.\n> From - Sat Jan 01 01:02:03 2011\n> From - Sat Jan 02 01:02:03 2011\n> From - Sat Jan 03 01:02:03 2011\n> From - Sat Jan 04 01:02:03 2011\n> X-Account-Key: account9\n>(snip)\nView/Message Source shows lines from \"From - Sat Jan 02 ...\".\nSame as step (2).\n\nNote:\nBecause IMAP offline-store file of Tb, there is no need of \"escaping of From line\". \"Rebuild-Index on local mail folder file\" will never be invoked by Tb on offline-store file. Rebuil-Index related problem happens only when user used the offline-store file as local mail folder file(==used as ordinal Unix Mbox format mail data file).", "creation_time": "2011-12-09T03:29:01Z", "time": "2011-12-09T03:29:01Z", "creator": "m-wada@usa.com", "author": "m-wada@usa.com", "count": 0, "id": 5903228, "is_private": false}, {"attachment_id": null, "raw_text": "Phenomnon seems next. \n\nWhen Compact of IMAP offline-use=on folder, Tb removes separator part, and Tb adds \"From \" line before mail data as new separator(or new place holder).\nBut if mail data starts with \"From ...\" line, Tb doesn't add \"From \" line before mail data, and Tb uses the first \"From ...\" line of mail data as new separator(or new place holder).", "tags": [], "bug_id": 708941, "text": "Phenomnon seems next. \n\nWhen Compact of IMAP offline-use=on folder, Tb removes separator part, and Tb adds \"From \" line before mail data as new separator(or new place holder).\nBut if mail data starts with \"From ...\" line, Tb doesn't add \"From \" line before mail data, and Tb uses the first \"From ...\" line of mail data as new separator(or new place holder).", "count": 1, "id": 5914157, "is_private": false, "creation_time": "2011-12-14T00:35:12Z", "time": "2011-12-14T00:35:12Z", "creator": "m-wada@usa.com", "author": "m-wada@usa.com"}]}}, "comments": {}}