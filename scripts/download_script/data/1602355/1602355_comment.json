{"comments": {}, "bugs": {"1602355": {"comments": [{"is_private": false, "time": "2019-12-09T08:35:21Z", "id": 14535184, "raw_text": "User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0\n\nSteps to reproduce:\n\nI wanted to compile firefox-72.0-beta3 on linux with thin lto enabled, using gcc. \n\n\nActual results:\n\nThe build fails in configure, as seems that the linker doesn't understand -import-instr-limit: \n\n0:11.14 checking what kind of list files are supported by the linker... configure: error: Couldn't find one that works\n0:11.15 DEBUG: <truncated - see config.log for full output>\n0:11.15 DEBUG: configure:10778: /usr/bin/x86_64-pc-linux-gnu-g++ -o conftest -march=znver1 -pipe -flifetime-dse=1 -Wno-psabi -Wno-class-memaccess -Wno-int-in-bool-context -Wno-multistatement-macros -Wno-maybe-uninitialized -Wno-deprecated-declarations -fno-exceptions -fno-strict-aliasing -fno-rtti -ffunction-sections -fdata-sections -fno-exceptions -fno-math-errno -pthread -lpthread -Wl,-O1 -Wl,--as-needed -Wl,-rpath=/usr/lib64/firefox,--enable-new-dtags -Wl,--compress-debug-sections=zlib -fuse-ld=gold -Wl,-z,noexecstack -Wl,-z,text -Wl,-z,relro -Wl,-z,nocopyreloc -Wl,-Bsymbolic-functions -Wl,--icf=safe conftest.C -ldl 1>&5\n0:11.15 DEBUG: configure:10864: checking for -pipe support\n0:11.15 DEBUG: configure:10891: checking what kind of list files are supported by the linker\n0:11.15 DEBUG: configure:10896: /usr/bin/x86_64-pc-linux-gnu-gcc -std=gnu99 -o conftest.o -c -flto -flifetime-dse=1 -march=znver1 -pipe -fno-strict-aliasing -ffunction-sections -fdata-sections -fno-math-errno -pthread -fPIC -pipe conftest.c 1>&5\n0:11.15 DEBUG: configure:10903: /usr/bin/x86_64-pc-linux-gnu-gcc -std=gnu99 -o conftest -flto=12 -flifetime-dse=1 -Wl,-plugin-opt=-import-instr-limit=10 -lpthread -Wl,-O1 -Wl,--as-needed -Wl,-rpath=/usr/lib64/firefox,--enable-new-dtags -Wl,--compress-debug-sections=zlib -fuse-ld=gold -Wl,-z,noexecstack -Wl,-z,text -Wl,-z,relro -Wl,-z,nocopyreloc -Wl,-Bsymbolic-functions -Wl,--icf=safe conftest.list -ldl 1>&5\n0:11.15 DEBUG: x86_64-pc-linux-gnu-gcc: error: unrecognized command line option '-import-instr-limit=10'\n0:11.15 DEBUG: lto-wrapper: fatal error: /usr/bin/x86_64-pc-linux-gnu-gcc returned 1 exit status\n0:11.15 DEBUG: compilation terminated.\n0:11.15 DEBUG: /usr/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../../../x86_64-pc-linux-gnu/bin/ld.gold: fatal error: lto-wrapper failed\n0:11.15 DEBUG: collect2: error: ld returned 1 exit status\n0:11.15 DEBUG: configure:10907: /usr/bin/x86_64-pc-linux-gnu-gcc -std=gnu99 -o conftest -flto=12 -flifetime-dse=1 -Wl,-plugin-opt=-import-instr-limit=10 -lpthread -Wl,-O1 -Wl,--as-needed -Wl,-rpath=/usr/lib64/firefox,--enable-new-dtags -Wl,--compress-debug-sections=zlib -fuse-ld=gold -Wl,-z,noexecstack -Wl,-z,text -Wl,-z,relro -Wl,-z,nocopyreloc -Wl,-Bsymbolic-functions -Wl,--icf=safe -Wl,-filelist,conftest.list -ldl 1>&5\n0:11.15 DEBUG: /usr/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../../../x86_64-pc-linux-gnu/bin/ld.gold: fatal error: -f/--auxiliary may not be used without -shared\n0:11.15 DEBUG: collect2: error: ld returned 1 exit status\n0:11.15 DEBUG: configure:10909: /usr/bin/x86_64-pc-linux-gnu-gcc -std=gnu99 -o conftest -flto=12 -flifetime-dse=1 -Wl,-plugin-opt=-import-instr-limit=10 -lpthread -Wl,-O1 -Wl,--as-needed -Wl,-rpath=/usr/lib64/firefox,--enable-new-dtags -Wl,--compress-debug-sections=zlib -fuse-ld=gold -Wl,-z,noexecstack -Wl,-z,text -Wl,-z,relro -Wl,-z,nocopyreloc -Wl,-Bsymbolic-functions -Wl,--icf=safe @conftest.list -ldl 1>&5\n0:11.15 DEBUG: x86_64-pc-linux-gnu-gcc: error: unrecognized command line option '-import-instr-limit=10'\n0:11.15 DEBUG: lto-wrapper: fatal error: /usr/bin/x86_64-pc-linux-gnu-gcc returned 1 exit status\n0:11.15 DEBUG: compilation terminated.\n0:11.15 DEBUG: /usr/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../../../x86_64-pc-linux-gnu/bin/ld.gold: fatal error: lto-wrapper failed\n0:11.15 DEBUG: collect2: error: ld returned 1 exit status\n0:11.15 DEBUG: configure: error: Couldn't find one that works\n0:11.15 ERROR: old-configure failed\n0:11.19 *** Fix above errors and then restart with\n0:11.19 \"./mach build\"\n0:11.19 gmake: *** [client.mk:115: configure] Error 1\n\n -import-instr-limit is llvm/clang specific, hence the gcc linker fails to understand that input. \n\n\nExpected results:\n\n-import-instr-limit should only be used for llvm/clang based compile", "bug_id": 1602355, "tags": [], "creator": "herrtimson@yahoo.de", "text": "User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0\n\nSteps to reproduce:\n\nI wanted to compile firefox-72.0-beta3 on linux with thin lto enabled, using gcc. \n\n\nActual results:\n\nThe build fails in configure, as seems that the linker doesn't understand -import-instr-limit: \n\n0:11.14 checking what kind of list files are supported by the linker... configure: error: Couldn't find one that works\n0:11.15 DEBUG: <truncated - see config.log for full output>\n0:11.15 DEBUG: configure:10778: /usr/bin/x86_64-pc-linux-gnu-g++ -o conftest -march=znver1 -pipe -flifetime-dse=1 -Wno-psabi -Wno-class-memaccess -Wno-int-in-bool-context -Wno-multistatement-macros -Wno-maybe-uninitialized -Wno-deprecated-declarations -fno-exceptions -fno-strict-aliasing -fno-rtti -ffunction-sections -fdata-sections -fno-exceptions -fno-math-errno -pthread -lpthread -Wl,-O1 -Wl,--as-needed -Wl,-rpath=/usr/lib64/firefox,--enable-new-dtags -Wl,--compress-debug-sections=zlib -fuse-ld=gold -Wl,-z,noexecstack -Wl,-z,text -Wl,-z,relro -Wl,-z,nocopyreloc -Wl,-Bsymbolic-functions -Wl,--icf=safe conftest.C -ldl 1>&5\n0:11.15 DEBUG: configure:10864: checking for -pipe support\n0:11.15 DEBUG: configure:10891: checking what kind of list files are supported by the linker\n0:11.15 DEBUG: configure:10896: /usr/bin/x86_64-pc-linux-gnu-gcc -std=gnu99 -o conftest.o -c -flto -flifetime-dse=1 -march=znver1 -pipe -fno-strict-aliasing -ffunction-sections -fdata-sections -fno-math-errno -pthread -fPIC -pipe conftest.c 1>&5\n0:11.15 DEBUG: configure:10903: /usr/bin/x86_64-pc-linux-gnu-gcc -std=gnu99 -o conftest -flto=12 -flifetime-dse=1 -Wl,-plugin-opt=-import-instr-limit=10 -lpthread -Wl,-O1 -Wl,--as-needed -Wl,-rpath=/usr/lib64/firefox,--enable-new-dtags -Wl,--compress-debug-sections=zlib -fuse-ld=gold -Wl,-z,noexecstack -Wl,-z,text -Wl,-z,relro -Wl,-z,nocopyreloc -Wl,-Bsymbolic-functions -Wl,--icf=safe conftest.list -ldl 1>&5\n0:11.15 DEBUG: x86_64-pc-linux-gnu-gcc: error: unrecognized command line option '-import-instr-limit=10'\n0:11.15 DEBUG: lto-wrapper: fatal error: /usr/bin/x86_64-pc-linux-gnu-gcc returned 1 exit status\n0:11.15 DEBUG: compilation terminated.\n0:11.15 DEBUG: /usr/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../../../x86_64-pc-linux-gnu/bin/ld.gold: fatal error: lto-wrapper failed\n0:11.15 DEBUG: collect2: error: ld returned 1 exit status\n0:11.15 DEBUG: configure:10907: /usr/bin/x86_64-pc-linux-gnu-gcc -std=gnu99 -o conftest -flto=12 -flifetime-dse=1 -Wl,-plugin-opt=-import-instr-limit=10 -lpthread -Wl,-O1 -Wl,--as-needed -Wl,-rpath=/usr/lib64/firefox,--enable-new-dtags -Wl,--compress-debug-sections=zlib -fuse-ld=gold -Wl,-z,noexecstack -Wl,-z,text -Wl,-z,relro -Wl,-z,nocopyreloc -Wl,-Bsymbolic-functions -Wl,--icf=safe -Wl,-filelist,conftest.list -ldl 1>&5\n0:11.15 DEBUG: /usr/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../../../x86_64-pc-linux-gnu/bin/ld.gold: fatal error: -f/--auxiliary may not be used without -shared\n0:11.15 DEBUG: collect2: error: ld returned 1 exit status\n0:11.15 DEBUG: configure:10909: /usr/bin/x86_64-pc-linux-gnu-gcc -std=gnu99 -o conftest -flto=12 -flifetime-dse=1 -Wl,-plugin-opt=-import-instr-limit=10 -lpthread -Wl,-O1 -Wl,--as-needed -Wl,-rpath=/usr/lib64/firefox,--enable-new-dtags -Wl,--compress-debug-sections=zlib -fuse-ld=gold -Wl,-z,noexecstack -Wl,-z,text -Wl,-z,relro -Wl,-z,nocopyreloc -Wl,-Bsymbolic-functions -Wl,--icf=safe @conftest.list -ldl 1>&5\n0:11.15 DEBUG: x86_64-pc-linux-gnu-gcc: error: unrecognized command line option '-import-instr-limit=10'\n0:11.15 DEBUG: lto-wrapper: fatal error: /usr/bin/x86_64-pc-linux-gnu-gcc returned 1 exit status\n0:11.15 DEBUG: compilation terminated.\n0:11.15 DEBUG: /usr/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../../../x86_64-pc-linux-gnu/bin/ld.gold: fatal error: lto-wrapper failed\n0:11.15 DEBUG: collect2: error: ld returned 1 exit status\n0:11.15 DEBUG: configure: error: Couldn't find one that works\n0:11.15 ERROR: old-configure failed\n0:11.19 *** Fix above errors and then restart with\n0:11.19 \"./mach build\"\n0:11.19 gmake: *** [client.mk:115: configure] Error 1\n\n -import-instr-limit is llvm/clang specific, hence the gcc linker fails to understand that input. \n\n\nExpected results:\n\n-import-instr-limit should only be used for llvm/clang based compile", "count": 0, "attachment_id": null, "author": "herrtimson@yahoo.de", "creation_time": "2019-12-09T08:35:21Z"}, {"creation_time": "2019-12-09T08:40:24Z", "text": "this was introduced by the patch from https://bugzilla.mozilla.org/show_bug.cgi?id=1592981\n\nreverting this patch makes it all work, again. \n\nso, this needs to be reworked, to be llvm/clang specific", "count": 1, "attachment_id": null, "author": "herrtimson@yahoo.de", "creator": "herrtimson@yahoo.de", "tags": [], "raw_text": "this was introduced by the patch from https://bugzilla.mozilla.org/show_bug.cgi?id=1592981\n\nreverting this patch makes it all work, again. \n\nso, this needs to be reworked, to be llvm/clang specific", "bug_id": 1602355, "time": "2019-12-09T08:40:24Z", "id": 14535196, "is_private": false}, {"creator": "away@bugmail.cc", "author": "away@bugmail.cc", "count": 2, "text": "Created attachment 9114554\nFix GCC LTO build break\n\nGCC doesn't understand the `import-instr-limit` option.", "attachment_id": 9114554, "creation_time": "2019-12-09T14:50:08Z", "is_private": false, "id": 14535965, "time": "2019-12-09T14:50:08Z", "raw_text": "GCC doesn't understand the `import-instr-limit` option.", "bug_id": 1602355, "tags": []}, {"tags": [], "raw_text": "Pushed by dmajor@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/360910f1a154\nFix GCC LTO build break r=froydnj", "bug_id": 1602355, "is_private": false, "id": 14536048, "time": "2019-12-09T15:19:48Z", "creation_time": "2019-12-09T15:19:48Z", "author": "pulsebot@bots.tld", "text": "Pushed by dmajor@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/360910f1a154\nFix GCC LTO build break r=froydnj", "attachment_id": null, "count": 3, "creator": "pulsebot@bots.tld"}, {"creation_time": "2019-12-09T17:58:15Z", "tags": [], "author": "herrtimson@yahoo.de", "attachment_id": null, "count": 4, "text": "I tested the patch locally, configure was successfull with CC=gcc CXX=g++\n\nit should be available with beta5\n\nyou take care of fixing this for mozilla central as well?", "raw_text": "I tested the patch locally, configure was successfull with CC=gcc CXX=g++\n\nit should be available with beta5\n\nyou take care of fixing this for mozilla central as well?", "bug_id": 1602355, "creator": "herrtimson@yahoo.de", "is_private": false, "id": 14536569, "time": "2019-12-09T17:58:15Z"}, {"bug_id": 1602355, "raw_text": "The patch should be automatically merged to mozilla-central in a few hours.", "is_private": false, "id": 14536597, "time": "2019-12-09T18:08:21Z", "tags": [], "creator": "away@bugmail.cc", "creation_time": "2019-12-09T18:08:21Z", "author": "away@bugmail.cc", "count": 5, "text": "The patch should be automatically merged to mozilla-central in a few hours.", "attachment_id": null}, {"is_private": false, "time": "2019-12-09T21:54:38Z", "id": 14537197, "raw_text": "https://hg.mozilla.org/mozilla-central/rev/360910f1a154", "bug_id": 1602355, "tags": ["bugherder"], "creator": "nbeleuzu@mozilla.com", "text": "https://hg.mozilla.org/mozilla-central/rev/360910f1a154", "attachment_id": null, "count": 6, "author": "nbeleuzu@mozilla.com", "creation_time": "2019-12-09T21:54:38Z"}, {"is_private": false, "id": 14547049, "time": "2019-12-15T12:17:39Z", "raw_text": "Can this please be backported to firefox-72.0 beta branch? I thought it had been fixed there first, and later uplifted to the master branch, but turns out it's been done the other way around and the fix is now missing in the firefox-72.0 beta branch. Thanks.", "bug_id": 1602355, "tags": [], "creator": "herrtimson@yahoo.de", "author": "herrtimson@yahoo.de", "text": "Can this please be backported to firefox-72.0 beta branch? I thought it had been fixed there first, and later uplifted to the master branch, but turns out it's been done the other way around and the fix is now missing in the firefox-72.0 beta branch. Thanks.", "attachment_id": null, "count": 7, "creation_time": "2019-12-15T12:17:39Z"}, {"tags": [], "author": "away@bugmail.cc", "attachment_id": 9114554, "count": 8, "text": "Comment on attachment 9114554\nFix GCC LTO build break\n\n### Beta/Release Uplift Approval Request\n* **User impact if declined**: Build breaks in some non-Mozilla configurations\n* **Is this code covered by automated tests?**: No\n* **Has the fix been verified in Nightly?**: No\n* **Needs manual test from QE?**: No\n* **If yes, steps to reproduce**: \n* **List of other uplifts needed**: None\n* **Risk to taking this patch**: Low\n* **Why is the change risky/not risky? (and alternatives if risky)**: Does not affect official builds\n* **String changes made/needed**: no", "creation_time": "2019-12-16T15:10:37Z", "is_private": false, "id": 14549713, "time": "2019-12-16T15:10:37Z", "creator": "away@bugmail.cc", "raw_text": "### Beta/Release Uplift Approval Request\n* **User impact if declined**: Build breaks in some non-Mozilla configurations\n* **Is this code covered by automated tests?**: No\n* **Has the fix been verified in Nightly?**: No\n* **Needs manual test from QE?**: No\n* **If yes, steps to reproduce**: \n* **List of other uplifts needed**: None\n* **Risk to taking this patch**: Low\n* **Why is the change risky/not risky? (and alternatives if risky)**: Does not affect official builds\n* **String changes made/needed**: no", "bug_id": 1602355}, {"tags": [], "id": 14551906, "time": "2019-12-17T14:56:49Z", "is_private": false, "raw_text": "essentially npotb, approved for 72.0b8.", "bug_id": 1602355, "author": "jcristau@mozilla.com", "attachment_id": 9114554, "text": "Comment on attachment 9114554\nFix GCC LTO build break\n\nessentially npotb, approved for 72.0b8.", "count": 9, "creation_time": "2019-12-17T14:56:49Z", "creator": "jcristau@mozilla.com"}, {"creation_time": "2019-12-18T02:59:22Z", "text": "https://hg.mozilla.org/releases/mozilla-beta/rev/1b7e1ccbe3eb", "attachment_id": null, "count": 10, "author": "aiakab@mozilla.com", "creator": "aiakab@mozilla.com", "tags": ["bugherder", "uplift"], "bug_id": 1602355, "raw_text": "https://hg.mozilla.org/releases/mozilla-beta/rev/1b7e1ccbe3eb", "time": "2019-12-18T02:59:22Z", "id": 14553591, "is_private": false}, {"tags": [], "is_private": false, "id": 14555922, "time": "2019-12-19T09:20:32Z", "bug_id": 1602355, "raw_text": "fixed in 72.0beta8, thank you! :-)", "author": "herrtimson@yahoo.de", "count": 11, "text": "fixed in 72.0beta8, thank you! :-)", "attachment_id": null, "creation_time": "2019-12-19T09:20:32Z", "creator": "herrtimson@yahoo.de"}]}}}