{"comments": {}, "bugs": {"714241": {"comments": [{"id": 5946566, "attachment_id": null, "raw_text": "This is a regression of bug 368250, affecting 4.2 and trunk.\n\nWhen run as non-root, collectstats.pl complains loudly because of newly introduced chown/chmod calls:\n\n./data/mining: Failed to change ownership: Operation not permitted\n./data/mining: Failed to change permissions: Operation not permitted\n./data/mining: Failed to change ownership: Operation not permitted\n./data/mining: Failed to change permissions: Operation not permitted\n./data/mining/ProductA: Failed to change ownership: Operation not permitted\n./data/mining/ProductA: Failed to change permissions: Operation not permitted\n./data/mining/ProductB: Failed to change ownership: Operation not permitted\n./data/mining/ProductB: Failed to change permissions: Operation not permitted\n...\n\nThese messages clobber cronmail, which is a nuisance. The stats still get collected, though.", "creation_time": "2011-12-30T08:53:52Z", "author": "wurblzap@gmail.com", "text": "This is a regression of bug 368250, affecting 4.2 and trunk.\n\nWhen run as non-root, collectstats.pl complains loudly because of newly introduced chown/chmod calls:\n\n./data/mining: Failed to change ownership: Operation not permitted\n./data/mining: Failed to change permissions: Operation not permitted\n./data/mining: Failed to change ownership: Operation not permitted\n./data/mining: Failed to change permissions: Operation not permitted\n./data/mining/ProductA: Failed to change ownership: Operation not permitted\n./data/mining/ProductA: Failed to change permissions: Operation not permitted\n./data/mining/ProductB: Failed to change ownership: Operation not permitted\n./data/mining/ProductB: Failed to change permissions: Operation not permitted\n...\n\nThese messages clobber cronmail, which is a nuisance. The stats still get collected, though.", "tags": [], "time": "2011-12-30T08:53:52Z", "is_private": false, "creator": "wurblzap@gmail.com", "bug_id": 714241, "count": 0}, {"bug_id": 714241, "count": 1, "text": "Note.\nThis occurs when installed as root, set web server account in localconfig.\nSome directory in data which should be in 660 have permission in 600.\n\n# occurs from 4.1.2 or so.", "time": "2011-12-30T09:04:00Z", "tags": [], "creation_time": "2011-12-30T09:04:00Z", "author": "shimono@bug-ja.org", "is_private": false, "creator": "shimono@bug-ja.org", "id": 5946569, "raw_text": "Note.\nThis occurs when installed as root, set web server account in localconfig.\nSome directory in data which should be in 660 have permission in 600.\n\n# occurs from 4.1.2 or so.", "attachment_id": null}, {"attachment_id": 628622, "raw_text": "This fixes things.\n\nTested scenarios:\n - no webservergroup, collectstats.pl run by root\n - webservergroup defined, collectstats.pl run by root anyway\n - webservergroup defined, collectstats.pl run by a user of the webservergroup", "id": 6351321, "creator": "wurblzap@gmail.com", "is_private": false, "count": 2, "author": "wurblzap@gmail.com", "creation_time": "2012-05-31T08:22:12Z", "tags": [], "bug_id": 714241, "time": "2012-05-31T08:22:12Z", "text": "Created attachment 628622\nPatch\n\nThis fixes things.\n\nTested scenarios:\n - no webservergroup, collectstats.pl run by root\n - webservergroup defined, collectstats.pl run by root anyway\n - webservergroup defined, collectstats.pl run by a user of the webservergroup"}, {"count": 3, "is_private": false, "creator": "LpSolit@gmail.com", "text": "One question from mkanat on IRC: how does this code behave when suexec is enabled?", "tags": [], "time": "2012-06-09T13:11:11Z", "bug_id": 714241, "creation_time": "2012-06-09T13:11:11Z", "author": "LpSolit@gmail.com", "raw_text": "One question from mkanat on IRC: how does this code behave when suexec is enabled?", "attachment_id": null, "id": 6377797}, {"creator": "wurblzap@gmail.com", "is_private": false, "count": 4, "author": "wurblzap@gmail.com", "creation_time": "2012-06-10T20:40:14Z", "tags": [], "time": "2012-06-10T20:40:14Z", "bug_id": 714241, "text": "I can't test with suexec, but from my understanding this should be exactly equal to the third mentioned scenario.", "attachment_id": null, "raw_text": "I can't test with suexec, but from my understanding this should be exactly equal to the third mentioned scenario.", "id": 6379084}, {"count": 5, "bug_id": 714241, "raw_text": ">=== modified file 'collectstats.pl'\n\n>+umask 0022;\n\nTo be sure, if a file is created with this umask, the file won't be writable by the webserver group, right? In that case, how do you plan to update the file the next time collectstats.pl is executed?\n\n\n> if (!-d $dir) {\n>+    die 'Run checksetup.pl as ' . ROOT_USER .\n>+        \" before running collectstats.pl for the first time.\\n\";\n> }\n\nThis bothers me. Imagine that you don't have root access at all, and there is no way to get an admin to execute checksetup.pl for you (e.g. on a remote server shared between many users, all with restricted privileges); in that case, you would be unable to run this script at all.", "attachment_id": 628622, "id": 6381204, "is_private": false, "creator": "LpSolit@gmail.com", "text": "Comment on attachment 628622\nPatch\n\n>=== modified file 'collectstats.pl'\n\n>+umask 0022;\n\nTo be sure, if a file is created with this umask, the file won't be writable by the webserver group, right? In that case, how do you plan to update the file the next time collectstats.pl is executed?\n\n\n> if (!-d $dir) {\n>+    die 'Run checksetup.pl as ' . ROOT_USER .\n>+        \" before running collectstats.pl for the first time.\\n\";\n> }\n\nThis bothers me. Imagine that you don't have root access at all, and there is no way to get an admin to execute checksetup.pl for you (e.g. on a remote server shared between many users, all with restricted privileges); in that case, you would be unable to run this script at all.", "time": "2012-06-11T19:26:05Z", "tags": [], "creation_time": "2012-06-11T19:26:05Z", "author": "LpSolit@gmail.com"}, {"bug_id": 714241, "count": 6, "id": 6386107, "raw_text": "(In reply to Fr\u00e9d\u00e9ric Buclin from comment #5)\n> >+umask 0022;\n> \n> To be sure, if a file is created with this umask, the file won't be writable\n> by the webserver group, right? In that case, how do you plan to update the\n> file the next time collectstats.pl is executed?\n\nThe data/mining/ directory has its flags set to 02770, so it'll be created as belonging to the webserver group.\n\n> > if (!-d $dir) {\n> >+    die 'Run checksetup.pl as ' . ROOT_USER .\n> >+        \" before running collectstats.pl for the first time.\\n\";\n> > }\n> \n> This bothers me. Imagine that you don't have root access at all, and there\n> is no way to get an admin to execute checksetup.pl for you (e.g. on a remote\n> server shared between many users, all with restricted privileges); in that\n> case, you would be unable to run this script at all.\n\nIf you want, I can drop the ROOT_USER part of this sentence. Or, I can write \"... or as a member of the webservergroup...\", but I think this is confusing. With this patch, checksetup.pl doesn't need more root access than before. You can run checksetup.pl as the same regular user who extracted Bugzilla from its .tar.gz, and the data/mining/ will be created, so you'll be fine.", "attachment_id": null, "text": "(In reply to Fr\u00e9d\u00e9ric Buclin from comment #5)\n> >+umask 0022;\n> \n> To be sure, if a file is created with this umask, the file won't be writable\n> by the webserver group, right? In that case, how do you plan to update the\n> file the next time collectstats.pl is executed?\n\nThe data/mining/ directory has its flags set to 02770, so it'll be created as belonging to the webserver group.\n\n> > if (!-d $dir) {\n> >+    die 'Run checksetup.pl as ' . ROOT_USER .\n> >+        \" before running collectstats.pl for the first time.\\n\";\n> > }\n> \n> This bothers me. Imagine that you don't have root access at all, and there\n> is no way to get an admin to execute checksetup.pl for you (e.g. on a remote\n> server shared between many users, all with restricted privileges); in that\n> case, you would be unable to run this script at all.\n\nIf you want, I can drop the ROOT_USER part of this sentence. Or, I can write \"... or as a member of the webservergroup...\", but I think this is confusing. With this patch, checksetup.pl doesn't need more root access than before. You can run checksetup.pl as the same regular user who extracted Bugzilla from its .tar.gz, and the data/mining/ will be created, so you'll be fine.", "tags": [], "time": "2012-06-12T23:54:53Z", "creation_time": "2012-06-12T23:54:53Z", "author": "wurblzap@gmail.com", "is_private": false, "creator": "wurblzap@gmail.com"}, {"creation_time": "2012-06-26T14:29:35Z", "author": "LpSolit@gmail.com", "text": "Comment on attachment 628622\nPatch\n\nThe existing code, including Bugzilla 3.x, sets permissions to 640:\n\n-rw-r----- 1 root apache  290 oct 25  2010 TestProduct\n\nWith your patch applied, checksetup.pl sets permissions to 660:\n\n-rw-rw---- 1 root apache 150K jun 26 15:58 TestProduct\n\nBut with your patch applied, collectstats.pl sets permissions to 644 for newly created products, which is inconsistent with what checksetup.pl does:\n\n-rw-r--r-- 1 root apache  318 jun 26 16:19 Pulpo\n\nAlso, with permissions set to 644, a user being in the webserver group cannot write to the files. So it looks like the umask should be set to 0017 instead of 0022. Do you agree with that?\n\n\nWhile you are on it, do not forget to fix the confusing comment about ROOT_USER.", "bug_id": 714241, "time": "2012-06-26T14:29:35Z", "tags": [], "is_private": false, "creator": "LpSolit@gmail.com", "count": 7, "id": 6423401, "attachment_id": 628622, "raw_text": "The existing code, including Bugzilla 3.x, sets permissions to 640:\n\n-rw-r----- 1 root apache  290 oct 25  2010 TestProduct\n\nWith your patch applied, checksetup.pl sets permissions to 660:\n\n-rw-rw---- 1 root apache 150K jun 26 15:58 TestProduct\n\nBut with your patch applied, collectstats.pl sets permissions to 644 for newly created products, which is inconsistent with what checksetup.pl does:\n\n-rw-r--r-- 1 root apache  318 jun 26 16:19 Pulpo\n\nAlso, with permissions set to 644, a user being in the webserver group cannot write to the files. So it looks like the umask should be set to 0017 instead of 0022. Do you agree with that?\n\n\nWhile you are on it, do not forget to fix the confusing comment about ROOT_USER."}, {"raw_text": "Same root cause as bug 511340?", "attachment_id": null, "id": 8777973, "count": 8, "creator": "LpSolit@gmail.com", "is_private": false, "tags": [], "time": "2014-05-11T18:37:52Z", "bug_id": 714241, "text": "Same root cause as bug 511340?", "author": "LpSolit@gmail.com", "creation_time": "2014-05-11T18:37:52Z"}, {"count": 9, "bug_id": 714241, "is_private": false, "creator": "wurblzap@gmail.com", "text": "It's a very related issue, I'd say. In both cases, a non-root user tries to chmod/chown other users' files.", "time": "2014-05-28T09:13:05Z", "tags": [], "creation_time": "2014-05-28T09:13:05Z", "author": "wurblzap@gmail.com", "raw_text": "It's a very related issue, I'd say. In both cases, a non-root user tries to chmod/chown other users' files.", "attachment_id": null, "id": 8850228}, {"creator": "LpSolit@gmail.com", "is_private": false, "count": 10, "author": "LpSolit@gmail.com", "creation_time": "2015-08-06T15:25:00Z", "bug_id": 714241, "time": "2015-08-06T15:25:00Z", "tags": [], "text": "Bugzilla 4.4 is now restricted to security fixes only.", "attachment_id": null, "raw_text": "Bugzilla 4.4 is now restricted to security fixes only.", "id": 10586278}]}}}