{"comments": {}, "bugs": {"676736": {"comments": [{"attachment_id": null, "raw_text": "see the patch in bug 660206 and https://bugzilla.mozilla.org/show_bug.cgi?id=660206#c20 for an approach to fix this, practically right now creating a nsIconChannel in xpcshell on Linux fails badly, thus changing components to deal with icon channels causes xpcshell failures, we should avoid at least that.\n\nScope of this bug is to take the icon channel part of the patch in that bug, add the missing part suggested by karlt in the comment, and write a small xpcshell test that creates a nsIconChannel, to check it doesn't fail/crash badly.", "tags": [], "text": "see the patch in bug 660206 and https://bugzilla.mozilla.org/show_bug.cgi?id=660206#c20 for an approach to fix this, practically right now creating a nsIconChannel in xpcshell on Linux fails badly, thus changing components to deal with icon channels causes xpcshell failures, we should avoid at least that.\n\nScope of this bug is to take the icon channel part of the patch in that bug, add the missing part suggested by karlt in the comment, and write a small xpcshell test that creates a nsIconChannel, to check it doesn't fail/crash badly.", "bug_id": 676736, "is_private": false, "count": 0, "id": 5634865, "creator": "mak@mozilla.com", "creation_time": "2011-08-05T00:49:50Z", "time": "2011-08-05T00:49:50Z", "author": "mak@mozilla.com"}, {"time": "2011-08-11T03:30:22Z", "creation_time": "2011-08-11T03:30:22Z", "creator": "jaws@mozilla.com", "author": "jaws@mozilla.com", "id": 5646848, "count": 1, "is_private": false, "bug_id": 676736, "text": "Created attachment 552293\nPatch for bug 676736\n\nThis patch was submitted to tryserver and passed all xpcshell tests on Linux:\nhttp://tbpl.mozilla.org/?tree=Try&rev=63610d480335", "tags": [], "attachment_id": 552293, "raw_text": "This patch was submitted to tryserver and passed all xpcshell tests on Linux:\nhttp://tbpl.mozilla.org/?tree=Try&rev=63610d480335"}, {"creator": "mak@mozilla.com", "time": "2011-08-16T15:17:02Z", "creation_time": "2011-08-16T15:17:02Z", "author": "mak@mozilla.com", "is_private": false, "count": 2, "id": 5657060, "tags": [], "text": "Comment on attachment 552293\nPatch for bug 676736\n\nReview of attachment 552293:\n-----------------------------------------------------------------\n\nYou should merge here the changes in the patch in bug 660206 (esp now that it has been wontfixed), excluded the changes to nsIFaviconService.idl.  That way we invoke g_type_init before this one, Karlt pointed out gdk3 will require that.\n\nDoes this actually fixes the original issue we had with tests in bug 564916? did you try to push them together and see if the problem is gone?\n\n::: toolkit/components/places/tests/unit/test_moz-icon_throws_on_linux.js\n@@ +1,5 @@\n> +/* vim:set ts=2 sw=2 sts=2 et: */\n> +/* ***** BEGIN LICENSE BLOCK *****\n> + * Any copyright is dedicated to the Public Domain.\n> + * http://creativecommons.org/publicdomain/zero/1.0/\n> + * ***** END LICENSE BLOCK ***** */\n\nthe right license block is this one http://www.mozilla.org/MPL/boilerplate-1.1/pd-c\n\n::: toolkit/components/places/tests/unit/xpcshell.ini\n@@ +71,5 @@\n>  [test_livemarkService_getLivemarkIdForFeedURI.js]\n>  [test_markpageas.js]\n>  [test_moz-anno_favicon_mime_type.js]\n> +[test_moz-icon_throws_on_linux.js]\n> +run-if = os == 'linux'\n\nWhile the test may be fine for our specific needs, it should rather be a libpr0n test (modules\\libpr0n\\test\\unit) and not depend on Places, it should manually create a channel to an icon (something like Services.io.newChannelFromURI may be enough, modules/libpr0n/test/unit/async_load_tests.js does something similar).", "bug_id": 676736, "attachment_id": 552293, "raw_text": "Review of attachment 552293:\n-----------------------------------------------------------------\n\nYou should merge here the changes in the patch in bug 660206 (esp now that it has been wontfixed), excluded the changes to nsIFaviconService.idl.  That way we invoke g_type_init before this one, Karlt pointed out gdk3 will require that.\n\nDoes this actually fixes the original issue we had with tests in bug 564916? did you try to push them together and see if the problem is gone?\n\n::: toolkit/components/places/tests/unit/test_moz-icon_throws_on_linux.js\n@@ +1,5 @@\n> +/* vim:set ts=2 sw=2 sts=2 et: */\n> +/* ***** BEGIN LICENSE BLOCK *****\n> + * Any copyright is dedicated to the Public Domain.\n> + * http://creativecommons.org/publicdomain/zero/1.0/\n> + * ***** END LICENSE BLOCK ***** */\n\nthe right license block is this one http://www.mozilla.org/MPL/boilerplate-1.1/pd-c\n\n::: toolkit/components/places/tests/unit/xpcshell.ini\n@@ +71,5 @@\n>  [test_livemarkService_getLivemarkIdForFeedURI.js]\n>  [test_markpageas.js]\n>  [test_moz-anno_favicon_mime_type.js]\n> +[test_moz-icon_throws_on_linux.js]\n> +run-if = os == 'linux'\n\nWhile the test may be fine for our specific needs, it should rather be a libpr0n test (modules\\libpr0n\\test\\unit) and not depend on Places, it should manually create a channel to an icon (something like Services.io.newChannelFromURI may be enough, modules/libpr0n/test/unit/async_load_tests.js does something similar)."}, {"time": "2011-09-20T05:28:07Z", "creation_time": "2011-09-20T05:28:07Z", "creator": "jaws@mozilla.com", "author": "jaws@mozilla.com", "count": 3, "id": 5724890, "is_private": false, "text": "Unassigning as I haven't been working on this and don't think I will have time to pick it back up.", "bug_id": 676736, "tags": [], "attachment_id": null, "raw_text": "Unassigning as I haven't been working on this and don't think I will have time to pick it back up."}]}}}