{"bugs": {"1630961": {"comments": [{"creator": "jcoppeard@mozilla.com", "time": "2020-04-17T13:41:05Z", "tags": [], "creation_time": "2020-04-17T13:41:05Z", "count": 0, "raw_text": "In preparation for tackling bug 1627039, here are some scheduling and sweeping tidyups.", "bug_id": 1630961, "is_private": false, "text": "In preparation for tackling bug 1627039, here are some scheduling and sweeping tidyups.", "attachment_id": null, "id": 14761449, "author": "jcoppeard@mozilla.com"}, {"text": "Created attachment 9141263\nBug 1630961 - Remove INCREMENTAL_TOO_SLOW GC trigger as this case is also handled elsewhere r?sfink\n\n\nThis is checkd in the allocator on every allocation, but we also check this when we allocate a new arena in maybeAllocTriggerZoneGC. It's possible that this one will hit first if background sweeping reduces the heap threshold after the last arena was allocated, but this doesn't really make any difference.", "count": 1, "creation_time": "2020-04-17T13:57:07Z", "author": "jcoppeard@mozilla.com", "id": 14761486, "attachment_id": 9141263, "raw_text": "\nThis is checkd in the allocator on every allocation, but we also check this when we allocate a new arena in maybeAllocTriggerZoneGC. It's possible that this one will hit first if background sweeping reduces the heap threshold after the last arena was allocated, but this doesn't really make any difference.", "creator": "jcoppeard@mozilla.com", "time": "2020-04-17T13:57:07Z", "is_private": false, "bug_id": 1630961, "tags": []}, {"text": "Created attachment 9141264\nBug 1630961 - Remove unused heurisitic to delaying GCs that may cause resets r?sfink\n\n\nA while back we added a heuristic to delay a GC if it would cause a reset (bug 1367455), but it was turned off after it caused a performance regression and hasn't been reenabled since.\n\nTelemetry shows that that only 0.2% of GCs get reset anyway so we should probably just remove this.\n\nDepends on D71328", "attachment_id": 9141264, "author": "jcoppeard@mozilla.com", "id": 14761490, "is_private": false, "bug_id": 1630961, "creation_time": "2020-04-17T13:58:07Z", "count": 2, "raw_text": "\nA while back we added a heuristic to delay a GC if it would cause a reset (bug 1367455), but it was turned off after it caused a performance regression and hasn't been reenabled since.\n\nTelemetry shows that that only 0.2% of GCs get reset anyway so we should probably just remove this.\n\nDepends on D71328", "time": "2020-04-17T13:58:07Z", "creator": "jcoppeard@mozilla.com", "tags": []}, {"is_private": false, "bug_id": 1630961, "text": "Created attachment 9141265\nBug 1630961 - Don't free LIFO data in background sweep task as this already happens in the background free task r?sfink\n\n\nI think I meant to do this when I added the separate GCRuntime::freeTask, but as it stands both this and sweepTask try and free the LIFO data. This is unnecessary.\n\nDepends on D71329", "id": 14761493, "author": "jcoppeard@mozilla.com", "attachment_id": 9141265, "creator": "jcoppeard@mozilla.com", "time": "2020-04-17T13:58:47Z", "tags": [], "count": 3, "creation_time": "2020-04-17T13:58:47Z", "raw_text": "\nI think I meant to do this when I added the separate GCRuntime::freeTask, but as it stands both this and sweepTask try and free the LIFO data. This is unnecessary.\n\nDepends on D71329"}, {"raw_text": "\nThe reason this didn't pass before is that the sweep task may be started for every group of zones, so a single instance finishing doesn't mean that we've finished sweeping all zones, and there may be more arenas to sweep in this case.\n\nDepends on D71330", "count": 4, "creation_time": "2020-04-17T13:59:14Z", "tags": [], "creator": "jcoppeard@mozilla.com", "time": "2020-04-17T13:59:14Z", "author": "jcoppeard@mozilla.com", "id": 14761495, "attachment_id": 9141267, "text": "Created attachment 9141267\nBug 1630961 - Assert background sweeping has finished in incremental collections where possible r?sfink\n\n\nThe reason this didn't pass before is that the sweep task may be started for every group of zones, so a single instance finishing doesn't mean that we've finished sweeping all zones, and there may be more arenas to sweep in this case.\n\nDepends on D71330", "bug_id": 1630961, "is_private": false}, {"text": "Pushed by jcoppeard@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/4ec83f8bd505\nRemove INCREMENTAL_TOO_SLOW GC trigger as this case is also handled elsewhere r=sfink\nhttps://hg.mozilla.org/integration/autoland/rev/0aab8dc843cd\nRemove unused heurisitic to delaying GCs that may cause resets r=sfink\nhttps://hg.mozilla.org/integration/autoland/rev/b17ee0161ec7\nDon't free LIFO data in background sweep task as this already happens in the background free task r=sfink\nhttps://hg.mozilla.org/integration/autoland/rev/004bab704062\nAssert background sweeping has finished in incremental collections where possible r=sfink", "attachment_id": null, "author": "pulsebot@bots.tld", "id": 14763201, "is_private": false, "bug_id": 1630961, "creation_time": "2020-04-18T08:28:56Z", "count": 5, "raw_text": "Pushed by jcoppeard@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/4ec83f8bd505\nRemove INCREMENTAL_TOO_SLOW GC trigger as this case is also handled elsewhere r=sfink\nhttps://hg.mozilla.org/integration/autoland/rev/0aab8dc843cd\nRemove unused heurisitic to delaying GCs that may cause resets r=sfink\nhttps://hg.mozilla.org/integration/autoland/rev/b17ee0161ec7\nDon't free LIFO data in background sweep task as this already happens in the background free task r=sfink\nhttps://hg.mozilla.org/integration/autoland/rev/004bab704062\nAssert background sweeping has finished in incremental collections where possible r=sfink", "time": "2020-04-18T08:28:56Z", "creator": "pulsebot@bots.tld", "tags": []}, {"bug_id": 1630961, "is_private": false, "attachment_id": null, "author": "csabou@mozilla.com", "id": 14763553, "text": "https://hg.mozilla.org/mozilla-central/rev/4ec83f8bd505\nhttps://hg.mozilla.org/mozilla-central/rev/0aab8dc843cd\nhttps://hg.mozilla.org/mozilla-central/rev/b17ee0161ec7\nhttps://hg.mozilla.org/mozilla-central/rev/004bab704062", "tags": ["bugherder"], "creator": "csabou@mozilla.com", "time": "2020-04-19T09:18:29Z", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/4ec83f8bd505\nhttps://hg.mozilla.org/mozilla-central/rev/0aab8dc843cd\nhttps://hg.mozilla.org/mozilla-central/rev/b17ee0161ec7\nhttps://hg.mozilla.org/mozilla-central/rev/004bab704062", "creation_time": "2020-04-19T09:18:29Z", "count": 6}]}}, "comments": {}}