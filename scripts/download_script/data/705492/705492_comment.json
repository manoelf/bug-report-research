{"comments": {}, "bugs": {"705492": {"comments": [{"count": 0, "bug_id": 705492, "attachment_id": null, "raw_text": "User Agent: Mozilla/5.0 (Ubuntu; X11; Linux x86_64; rv:8.0) Gecko/20100101 Firefox/8.0\nBuild ID: 20111115183813\n\nSteps to reproduce:\n\ni fill the content of a frame with document.write from within another frame.\n\nwhen you log in into the guest account on www.spacetrace.org, you see a message frame at the bottom, that is filled from within the small iframe on top of the message frame per document.write().\n\nthe page load indicator doesent stop spinning, although the page i fully loaded\n\n\nActual results:\n\npage doesent stop loading and CPU usage goes up to 100%\n\n\nExpected results:\n\nnot so much CPU usage and page should be loaded after some seconds", "id": 5873932, "creator": "mozilla@spacetrace.org", "is_private": false, "author": "mozilla@spacetrace.org", "creation_time": "2011-11-26T23:35:51Z", "tags": [], "time": "2011-11-26T23:35:51Z", "text": "User Agent: Mozilla/5.0 (Ubuntu; X11; Linux x86_64; rv:8.0) Gecko/20100101 Firefox/8.0\nBuild ID: 20111115183813\n\nSteps to reproduce:\n\ni fill the content of a frame with document.write from within another frame.\n\nwhen you log in into the guest account on www.spacetrace.org, you see a message frame at the bottom, that is filled from within the small iframe on top of the message frame per document.write().\n\nthe page load indicator doesent stop spinning, although the page i fully loaded\n\n\nActual results:\n\npage doesent stop loading and CPU usage goes up to 100%\n\n\nExpected results:\n\nnot so much CPU usage and page should be loaded after some seconds"}, {"raw_text": "i use FF8 on ubuntu 11.10", "attachment_id": null, "id": 5873934, "count": 1, "creator": "mozilla@spacetrace.org", "is_private": false, "bug_id": 705492, "time": "2011-11-26T23:39:27Z", "tags": [], "text": "i use FF8 on ubuntu 11.10", "author": "mozilla@spacetrace.org", "creation_time": "2011-11-26T23:39:27Z"}, {"creation_time": "2011-11-26T23:51:28Z", "author": "bugs@pettay.fi", "text": "> the page load indicator doesent stop spinning, although the page i fully loaded\nwell, if you're still writing to the document using document.write, it isn't fully loaded.\n\n\nI don't see high cpu usage using Nightly on Linux. Profiling seems to show painting taking some time.", "tags": [], "bug_id": 705492, "time": "2011-11-26T23:51:28Z", "is_private": false, "creator": "bugs@pettay.fi", "count": 2, "id": 5873937, "attachment_id": null, "raw_text": "> the page load indicator doesent stop spinning, although the page i fully loaded\nwell, if you're still writing to the document using document.write, it isn't fully loaded.\n\n\nI don't see high cpu usage using Nightly on Linux. Profiling seems to show painting taking some time."}, {"id": 5873959, "attachment_id": null, "raw_text": "yes, the page takes a while, but then its done after some 20 seconds.\n\nbut it doesent stop spinning loading, though.\n\ndocument write is only used once and then nothing should happen.\n\nif i press ESC it stops loading and the CPU goes down to some 20%", "creation_time": "2011-11-27T01:02:44Z", "author": "mozilla@spacetrace.org", "text": "yes, the page takes a while, but then its done after some 20 seconds.\n\nbut it doesent stop spinning loading, though.\n\ndocument write is only used once and then nothing should happen.\n\nif i press ESC it stops loading and the CPU goes down to some 20%", "tags": [], "time": "2011-11-27T01:02:44Z", "bug_id": 705492, "is_private": false, "creator": "mozilla@spacetrace.org", "count": 3}, {"text": "i tried the nightly buld and its the same:\n\nit doesent stop loading.\n\nyou i close all the subframes with the red buttons, it still has high CPU.\n\nThen when i press the green refresh button of the message screen iframe the loading stops and the CPU goes down 20% less", "bug_id": 705492, "time": "2011-11-27T01:10:58Z", "tags": [], "creation_time": "2011-11-27T01:10:58Z", "author": "mozilla@spacetrace.org", "count": 4, "is_private": false, "creator": "mozilla@spacetrace.org", "id": 5873965, "raw_text": "i tried the nightly buld and its the same:\n\nit doesent stop loading.\n\nyou i close all the subframes with the red buttons, it still has high CPU.\n\nThen when i press the green refresh button of the message screen iframe the loading stops and the CPU goes down 20% less", "attachment_id": null}, {"count": 5, "is_private": false, "creator": "mounir@lamouri.fr", "text": "Did you try with a fresh profile or with all extensions disabled?", "time": "2011-11-27T14:00:15Z", "bug_id": 705492, "tags": [], "creation_time": "2011-11-27T14:00:15Z", "author": "mounir@lamouri.fr", "raw_text": "Did you try with a fresh profile or with all extensions disabled?", "attachment_id": null, "id": 5874222}, {"count": 6, "bug_id": 705492, "creator": "mozilla@spacetrace.org", "is_private": false, "time": "2011-11-27T17:06:21Z", "tags": [], "text": "no, but i am sure, you did, and it's the same: the page doesent stop loading and your CPU goes up 20% or so.\nif you press ESC it goes down again.\n\nit is the same everywhere on all firefoxes, i ever tested\n\nthe question is: \nwhat is firefox calculating there ? and other browsers like chrome dont?", "author": "mozilla@spacetrace.org", "creation_time": "2011-11-27T17:06:21Z", "raw_text": "no, but i am sure, you did, and it's the same: the page doesent stop loading and your CPU goes up 20% or so.\nif you press ESC it goes down again.\n\nit is the same everywhere on all firefoxes, i ever tested\n\nthe question is: \nwhat is firefox calculating there ? and other browsers like chrome dont?", "attachment_id": null, "id": 5874319}, {"id": 5876279, "attachment_id": null, "raw_text": "This bug needs useful steps to reproduce....", "creation_time": "2011-11-28T19:02:11Z", "author": "bzbarsky@mit.edu", "text": "This bug needs useful steps to reproduce....", "bug_id": 705492, "time": "2011-11-28T19:02:11Z", "tags": [], "is_private": false, "creator": "bzbarsky@mit.edu", "count": 7}, {"is_private": false, "creator": "mozilla@spacetrace.org", "creation_time": "2011-11-29T00:56:52Z", "author": "mozilla@spacetrace.org", "text": "steps are:\n1. open www.spacetrace.org\n2. log in as guest\n3. see top: much cpu-load\n4. press ESC\n5. see top: less CPU-load\n\nthe question is: what is it, that is stopped by ESC, and that is causing 20% CPU. something in the messages-frame at the bottom in the middle.", "tags": [], "time": "2011-11-29T00:56:52Z", "attachment_id": null, "raw_text": "steps are:\n1. open www.spacetrace.org\n2. log in as guest\n3. see top: much cpu-load\n4. press ESC\n5. see top: less CPU-load\n\nthe question is: what is it, that is stopped by ESC, and that is causing 20% CPU. something in the messages-frame at the bottom in the middle.", "id": 5877575, "count": 8, "bug_id": 705492}, {"id": 5877608, "raw_text": "> 2. log in as guest  \n\nSo username \"guest\" and password also \"guest\"?  Thank you!\n\n> what is it, that is stopped by ESC, and that is causing 20% CPU. \n\nPainting.  Of both the throbber being animated in the tab and the various animated images in the page itself (which ESC also stops, if you note).\n\nThe CPU load does mostly go away if I window[6].document.close() on the page; I'm not sure whether it really costs us that much to animate the throbber or whether it's some interaction with the in-page animated content causing the invalidation area to balloon.", "attachment_id": null, "text": "> 2. log in as guest  \n\nSo username \"guest\" and password also \"guest\"?  Thank you!\n\n> what is it, that is stopped by ESC, and that is causing 20% CPU. \n\nPainting.  Of both the throbber being animated in the tab and the various animated images in the page itself (which ESC also stops, if you note).\n\nThe CPU load does mostly go away if I window[6].document.close() on the page; I'm not sure whether it really costs us that much to animate the throbber or whether it's some interaction with the in-page animated content causing the invalidation area to balloon.", "tags": [], "time": "2011-11-29T01:05:22Z", "bug_id": 705492, "creation_time": "2011-11-29T01:05:22Z", "author": "bzbarsky@mit.edu", "count": 9, "is_private": false, "creator": "bzbarsky@mit.edu"}, {"id": 5878140, "attachment_id": null, "raw_text": "guestlogin is a link on the startpage\n\nso can you confirm this bug?\n\nchrome isnt showing this behaviour. there is no reason, why the loading should continue and use so much CPU for nothing", "creation_time": "2011-11-29T08:04:40Z", "author": "mozilla@spacetrace.org", "text": "guestlogin is a link on the startpage\n\nso can you confirm this bug?\n\nchrome isnt showing this behaviour. there is no reason, why the loading should continue and use so much CPU for nothing", "time": "2011-11-29T08:04:40Z", "tags": [], "bug_id": 705492, "is_private": false, "creator": "mozilla@spacetrace.org", "count": 10}, {"count": 11, "creator": "tnikkel@gmail.com", "is_private": false, "tags": [], "time": "2011-11-29T08:23:52Z", "bug_id": 705492, "text": "Looks like we invalidate reasonable bounds, the throbber in the tab, and the two throbbers on the page. Sometimes this means (on my Ubuntu machine) we get a paint event with one large rect containing all three of these (the OS must fluff out the region to its bounds).\n\nWhats the deal with the page never finishing loading but in Chrome it does; is that a bug in Firefox or in the page?", "author": "tnikkel@gmail.com", "creation_time": "2011-11-29T08:23:52Z", "raw_text": "Looks like we invalidate reasonable bounds, the throbber in the tab, and the two throbbers on the page. Sometimes this means (on my Ubuntu machine) we get a paint event with one large rect containing all three of these (the OS must fluff out the region to its bounds).\n\nWhats the deal with the page never finishing loading but in Chrome it does; is that a bug in Firefox or in the page?", "attachment_id": null, "id": 5878168}, {"id": 5878201, "attachment_id": null, "raw_text": "If you do document.write and never document.close() to close the \"stream\", Firefox has\ntraditionally interpret that as the page is still loading.", "author": "bugs@pettay.fi", "creation_time": "2011-11-29T08:51:38Z", "time": "2011-11-29T08:51:38Z", "bug_id": 705492, "tags": [], "text": "If you do document.write and never document.close() to close the \"stream\", Firefox has\ntraditionally interpret that as the page is still loading.", "creator": "bugs@pettay.fi", "is_private": false, "count": 12}, {"author": "bzbarsky@mit.edu", "creation_time": "2011-11-29T09:04:48Z", "tags": [], "bug_id": 705492, "time": "2011-11-29T09:04:48Z", "text": "Ruben, the loading should continue, imo; the page opened a document and hasn't closed it.  In any case, there are existing discussions about that beheavior.\n\nBut I agree it shouldn't take as much CPU as it seems to to paint the throbber and the animations.", "creator": "bzbarsky@mit.edu", "is_private": false, "count": 13, "id": 5878223, "attachment_id": null, "raw_text": "Ruben, the loading should continue, imo; the page opened a document and hasn't closed it.  In any case, there are existing discussions about that beheavior.\n\nBut I agree it shouldn't take as much CPU as it seems to to paint the throbber and the animations."}, {"count": 14, "bug_id": 705492, "is_private": false, "creator": "mozilla@spacetrace.org", "creation_time": "2011-11-29T10:34:19Z", "author": "mozilla@spacetrace.org", "text": "so the loading thing is a philosophical thing. ok.\n\nbut do you say, that just the throbber animation graphic in the tab is using 20% of my CPU?\n\nthat would definitely be a bug!\n\nif not, then a page that is filled with document.write() but not closed with document.close() uses 20% of my CPU? just for waiting for more input? (there is nothing more written after the start)\n\ni will provide a special login, that doesent have all the graphics later today.\ni guess it still uses a lot of CPU", "tags": [], "time": "2011-11-29T10:34:19Z", "attachment_id": null, "raw_text": "so the loading thing is a philosophical thing. ok.\n\nbut do you say, that just the throbber animation graphic in the tab is using 20% of my CPU?\n\nthat would definitely be a bug!\n\nif not, then a page that is filled with document.write() but not closed with document.close() uses 20% of my CPU? just for waiting for more input? (there is nothing more written after the start)\n\ni will provide a special login, that doesent have all the graphics later today.\ni guess it still uses a lot of CPU", "id": 5878376}, {"is_private": false, "creator": "mozilla@spacetrace.org", "count": 15, "creation_time": "2011-11-29T11:43:21Z", "author": "mozilla@spacetrace.org", "text": "i provided a page without all the surrounding stuff for you with an extra parameter:\nsteps are:\n1. open www.spacetrace.org\n2. log in as guest (use the link \"Guest Access\" on top)\n3. add \"&nostyle=1\" to the resulting url\n4. see top: much cpu-load\n5. press ESC\n6. see top: less CPU-load", "tags": [], "bug_id": 705492, "time": "2011-11-29T11:43:21Z", "attachment_id": null, "raw_text": "i provided a page without all the surrounding stuff for you with an extra parameter:\nsteps are:\n1. open www.spacetrace.org\n2. log in as guest (use the link \"Guest Access\" on top)\n3. add \"&nostyle=1\" to the resulting url\n4. see top: much cpu-load\n5. press ESC\n6. see top: less CPU-load", "id": 5878452}, {"id": 5878766, "raw_text": "i located the bug in firefox:\nthis small html page uses 20% CPU:\n<html><body>\n<iframe name=\"a\"></iframe>\n<script>\na.document.write('test')\n</script>\n</html></body>", "attachment_id": null, "text": "i located the bug in firefox:\nthis small html page uses 20% CPU:\n<html><body>\n<iframe name=\"a\"></iframe>\n<script>\na.document.write('test')\n</script>\n</html></body>", "tags": [], "time": "2011-11-29T14:35:41Z", "bug_id": 705492, "creation_time": "2011-11-29T14:35:41Z", "author": "mozilla@spacetrace.org", "count": 16, "is_private": false, "creator": "mozilla@spacetrace.org"}, {"text": "Created attachment 577595\ntestcase html page, that produces the error", "bug_id": 705492, "tags": [], "time": "2011-11-29T14:36:44Z", "creation_time": "2011-11-29T14:36:44Z", "author": "mozilla@spacetrace.org", "count": 17, "is_private": false, "creator": "mozilla@spacetrace.org", "id": 5878769, "raw_text": "", "attachment_id": 577595}, {"count": 18, "bug_id": 705492, "attachment_id": null, "raw_text": "> but do you say, that just the throbber animation graphic in the tab is using 20% of my\n> CPU?\n\nI don't know about yours, but it's using 20% of _my_ CPU.  The time is definitely all spent in painting according to my profiler; as you say the unclosed document is just waiting for input, which doesn't involve any CPU usage.\n\nAnd yes, I think this is totally broken.  ccing some imagelib folks too.", "id": 5879393, "creator": "bzbarsky@mit.edu", "is_private": false, "author": "bzbarsky@mit.edu", "creation_time": "2011-11-29T19:01:24Z", "time": "2011-11-29T19:01:24Z", "tags": [], "text": "> but do you say, that just the throbber animation graphic in the tab is using 20% of my\n> CPU?\n\nI don't know about yours, but it's using 20% of _my_ CPU.  The time is definitely all spent in painting according to my profiler; as you say the unclosed document is just waiting for input, which doesn't involve any CPU usage.\n\nAnd yes, I think this is totally broken.  ccing some imagelib folks too."}, {"id": 5879591, "attachment_id": null, "raw_text": "Hmm... I actually don't see an increase in CPU with these pages, on the latest nightly. I'm at (consistently) about 20% CPU usage with the latest nightly, while it's running. \n\nI'll try FF8, as that was the case where this appears more broken, and see if I can replicate this.", "author": "jaywir3@gmail.com", "creation_time": "2011-11-29T19:52:14Z", "bug_id": 705492, "time": "2011-11-29T19:52:14Z", "tags": [], "text": "Hmm... I actually don't see an increase in CPU with these pages, on the latest nightly. I'm at (consistently) about 20% CPU usage with the latest nightly, while it's running. \n\nI'll try FF8, as that was the case where this appears more broken, and see if I can replicate this.", "creator": "jaywir3@gmail.com", "is_private": false, "count": 19}, {"attachment_id": null, "raw_text": "(In reply to Scott Johnson (:jwir3) from comment #19)\n> Hmm... I actually don't see an increase in CPU with these pages, on the\n> latest nightly. I'm at (consistently) about 20% CPU usage with the latest\n> nightly, while it's running. \n\nLet me rephrase, because I don't think I was clear before. What I meant was that my *SYSTEM* was consistently at 20% CPU usage all the time. When I run Nightly on the example that you gave, the throbber does indeed continue, but the highest CPU usage (for FF only) I see is 16% on initial load of the page, then it drops to 8% for a few seconds, then to 0%.\n\nWith the spacetrace example, it does consistently stay at 16%. So, there is probably a problem on that page that I can't replicate with the testcase you gave.", "id": 5879628, "creator": "jaywir3@gmail.com", "is_private": false, "count": 20, "author": "jaywir3@gmail.com", "creation_time": "2011-11-29T20:01:04Z", "time": "2011-11-29T20:01:04Z", "bug_id": 705492, "tags": [], "text": "(In reply to Scott Johnson (:jwir3) from comment #19)\n> Hmm... I actually don't see an increase in CPU with these pages, on the\n> latest nightly. I'm at (consistently) about 20% CPU usage with the latest\n> nightly, while it's running. \n\nLet me rephrase, because I don't think I was clear before. What I meant was that my *SYSTEM* was consistently at 20% CPU usage all the time. When I run Nightly on the example that you gave, the throbber does indeed continue, but the highest CPU usage (for FF only) I see is 16% on initial load of the page, then it drops to 8% for a few seconds, then to 0%.\n\nWith the spacetrace example, it does consistently stay at 16%. So, there is probably a problem on that page that I can't replicate with the testcase you gave."}, {"id": 6075036, "attachment_id": null, "raw_text": "the problem still exists in FF10\nwith the test-case page:\nhttps://bug705492.bugzilla.mozilla.org/attachment.cgi?id=577595\n\nisnt this easy to fix?\n\nit seems, that the loading-indicator uses so much CPU\n\non my other Laptop the CPU stays at 15% until i press ESC, then it goes down to 0%", "author": "mozilla@spacetrace.org", "creation_time": "2012-02-19T19:59:22Z", "tags": [], "time": "2012-02-19T19:59:22Z", "text": "the problem still exists in FF10\nwith the test-case page:\nhttps://bug705492.bugzilla.mozilla.org/attachment.cgi?id=577595\n\nisnt this easy to fix?\n\nit seems, that the loading-indicator uses so much CPU\n\non my other Laptop the CPU stays at 15% until i press ESC, then it goes down to 0%", "creator": "mozilla@spacetrace.org", "is_private": false, "bug_id": 705492, "count": 21}, {"id": 6081537, "raw_text": "That does seem a little high for CPU usage for one small animation. We should profile to see where we are spending that time.", "attachment_id": null, "text": "That does seem a little high for CPU usage for one small animation. We should profile to see where we are spending that time.", "time": "2012-02-22T06:56:13Z", "tags": [], "bug_id": 705492, "creation_time": "2012-02-22T06:56:13Z", "author": "tnikkel@gmail.com", "count": 22, "is_private": false, "creator": "tnikkel@gmail.com"}, {"text": "the problem still exists in FF13", "time": "2012-06-13T03:19:14Z", "bug_id": 705492, "tags": [], "creation_time": "2012-06-13T03:19:14Z", "author": "mozilla@spacetrace.org", "count": 23, "is_private": false, "creator": "mozilla@spacetrace.org", "id": 6386503, "raw_text": "the problem still exists in FF13", "attachment_id": null}]}}}