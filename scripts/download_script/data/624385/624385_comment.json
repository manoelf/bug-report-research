{"bugs": {"624385": {"comments": [{"is_private": false, "bug_id": 624385, "raw_text": "User-Agent:       Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20101203 SUSE/3.6.13-0.2.1 Firefox/3.6.13\nBuild Identifier: \n\nWhile buildling libmozgnome with mainline GCC and link time optimization and profile generation, we get:\n/abuild/jh/trunk-install/bin/g++ -fpermissive -O3 -flto=24 -fuse-linker-plugin\n-fprofile-generate  -fno-rtti -fno-exceptions -Wall -Wpointer-arith\n-Woverloaded-virtual -Wsynth -Wno-ctor-dtor-privacy -Wno-non-virtual-dtor\n-Wcast-align -Wno-invalid-offsetof -Wno-variadic-macros -Werror=return-type\n-pedantic -Wno-long-long -fno-strict-aliasing -fshort-wchar -pthread -pipe \n-DNDEBUG -DTRIMMED -g   -I/usr/include/glib-2.0 -I/usr/lib64/glib-2.0/include  \n-I/usr/include/gtk-2.0 -I/usr/include/glib-2.0 -I/usr/lib64/glib-2.0/include\n-I/usr/include/dbus-1.0 -I/usr/lib64/dbus-1.0/include\n-I/usr/lib64/gtk-2.0/include -I/usr/include/atk-1.0 -I/usr/include/cairo\n-I/usr/include/pango-1.0 -I/usr/include/pixman-1 -I/usr/include/freetype2\n-I/usr/include/libpng12   -I/usr/include/gtk-2.0 -I/usr/lib64/gtk-2.0/include\n-I/usr/include/atk-1.0 -I/usr/include/cairo -I/usr/include/pango-1.0\n-I/usr/include/glib-2.0 -I/usr/lib64/glib-2.0/include -I/usr/include/pixman-1\n-I/usr/include/freetype2 -I/usr/include/libpng12\n-I/usr/include/gtk-unix-print-2.0    -fPIC -shared -Wl,-z,defs\n-Wl,-h,libmozgnome.so -o libmozgnome.so  nsGnomeModule.o nsAlertsService.o\nnsAlertsIconListener.o     -lpthread   \n-Wl,-rpath-link,/abuild/jh/build-mozilla-new8-prof/dist/bin\n-Wl,-rpath-link,/usr/local/lib\n/abuild/jh/build-mozilla-new8-prof/dist/lib/libxpcomglue_s.a\n-L/abuild/jh/build-mozilla-new8-prof/dist/bin -lxpcom -lmozalloc\n-L/abuild/jh/build-mozilla-new8-prof/dist/bin -lxpcom -lmozalloc\n-L/abuild/jh/build-mozilla-new8-prof/dist/lib -lplds4 -lplc4 -lnspr4 -lpthread\n-ldl   -lgobject-2.0 -lglib-2.0   -L/lib64 -lnotify -lgtk-x11-2.0 -ldbus-glib-1\n-lgdk-x11-2.0 -latk-1.0 -lgio-2.0 -lpangoft2-1.0 -lgdk_pixbuf-2.0\n-lpangocairo-1.0 -lcairo -lpango-1.0 -lfreetype -lz -lfontconfig -lgmodule-2.0\n-ldbus-1 -lgobject-2.0 -lglib-2.0     -Wl,--version-script\n-Wl,/abuild/jh/mozilla-central2/mozilla-central/build/unix/gnu-ld-scripts/components-version-script\n-Wl,-Bsymbolic -ldl    \n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxUnknownSurface::~gfxUnknownSurface():../../../dist/include/gfxASurface.h:247:\nerror: undefined reference to 'vtable for gfxASurface'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxUnknownSurface::~gfxUnknownSurface():../../../dist/include/gfxASurface.h:248:\nerror: undefined reference to 'gfxASurface::RecordMemoryFreed()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxUnknownSurface::~gfxUnknownSurface():../../../dist/include/gfxASurface.h:247:\nerror: undefined reference to 'vtable for gfxASurface'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxUnknownSurface::~gfxUnknownSurface():../../../dist/include/gfxASurface.h:248:\nerror: undefined reference to 'gfxASurface::RecordMemoryFreed()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxASurface::~gfxASurface():../../../dist/include/gfxASurface.h:247: error:\nundefined reference to 'vtable for gfxASurface'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxASurface::~gfxASurface():../../../dist/include/gfxASurface.h:248: error:\nundefined reference to 'gfxASurface::RecordMemoryFreed()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxASurface::~gfxASurface():../../../dist/include/gfxASurface.h:247: error:\nundefined reference to 'vtable for gfxASurface'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxASurface::~gfxASurface():../../../dist/include/gfxASurface.h:248: error:\nundefined reference to 'gfxASurface::RecordMemoryFreed()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x10):\nerror: undefined reference to 'gfxASurface::BeginPrinting(nsAString const&,\nnsAString const&)'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x18):\nerror: undefined reference to 'gfxASurface::EndPrinting()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x20):\nerror: undefined reference to 'gfxASurface::AbortPrinting()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x28):\nerror: undefined reference to 'gfxASurface::BeginPage()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x30):\nerror: undefined reference to 'gfxASurface::EndPage()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x38):\nerror: undefined reference to 'gfxASurface::Finish()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x40):\nerror: undefined reference to\n'gfxASurface::CreateSimilarSurface(gfxASurface::gfxContentType, gfxIntSize\nconst&)'\n\n\nthe reason is that libmozgnome implemenetaiton include gfxAsurface, uses it in C++ standard sense but rely on fact that it is fully optimized out since it is not linked with its implementation.\nFor complex reasons this fails in this configuration: GCC keeps virtual functions for possible devirutalization around and there is difficult iteraction in between COMDAT, linker plugin and profiling instrumentation that renders the function neccesary.\n\nWhile this is also missed optimization problem in GCC, I think this code is not strictly valid.\n\nReproducible: Always", "text": "User-Agent:       Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20101203 SUSE/3.6.13-0.2.1 Firefox/3.6.13\nBuild Identifier: \n\nWhile buildling libmozgnome with mainline GCC and link time optimization and profile generation, we get:\n/abuild/jh/trunk-install/bin/g++ -fpermissive -O3 -flto=24 -fuse-linker-plugin\n-fprofile-generate  -fno-rtti -fno-exceptions -Wall -Wpointer-arith\n-Woverloaded-virtual -Wsynth -Wno-ctor-dtor-privacy -Wno-non-virtual-dtor\n-Wcast-align -Wno-invalid-offsetof -Wno-variadic-macros -Werror=return-type\n-pedantic -Wno-long-long -fno-strict-aliasing -fshort-wchar -pthread -pipe \n-DNDEBUG -DTRIMMED -g   -I/usr/include/glib-2.0 -I/usr/lib64/glib-2.0/include  \n-I/usr/include/gtk-2.0 -I/usr/include/glib-2.0 -I/usr/lib64/glib-2.0/include\n-I/usr/include/dbus-1.0 -I/usr/lib64/dbus-1.0/include\n-I/usr/lib64/gtk-2.0/include -I/usr/include/atk-1.0 -I/usr/include/cairo\n-I/usr/include/pango-1.0 -I/usr/include/pixman-1 -I/usr/include/freetype2\n-I/usr/include/libpng12   -I/usr/include/gtk-2.0 -I/usr/lib64/gtk-2.0/include\n-I/usr/include/atk-1.0 -I/usr/include/cairo -I/usr/include/pango-1.0\n-I/usr/include/glib-2.0 -I/usr/lib64/glib-2.0/include -I/usr/include/pixman-1\n-I/usr/include/freetype2 -I/usr/include/libpng12\n-I/usr/include/gtk-unix-print-2.0    -fPIC -shared -Wl,-z,defs\n-Wl,-h,libmozgnome.so -o libmozgnome.so  nsGnomeModule.o nsAlertsService.o\nnsAlertsIconListener.o     -lpthread   \n-Wl,-rpath-link,/abuild/jh/build-mozilla-new8-prof/dist/bin\n-Wl,-rpath-link,/usr/local/lib\n/abuild/jh/build-mozilla-new8-prof/dist/lib/libxpcomglue_s.a\n-L/abuild/jh/build-mozilla-new8-prof/dist/bin -lxpcom -lmozalloc\n-L/abuild/jh/build-mozilla-new8-prof/dist/bin -lxpcom -lmozalloc\n-L/abuild/jh/build-mozilla-new8-prof/dist/lib -lplds4 -lplc4 -lnspr4 -lpthread\n-ldl   -lgobject-2.0 -lglib-2.0   -L/lib64 -lnotify -lgtk-x11-2.0 -ldbus-glib-1\n-lgdk-x11-2.0 -latk-1.0 -lgio-2.0 -lpangoft2-1.0 -lgdk_pixbuf-2.0\n-lpangocairo-1.0 -lcairo -lpango-1.0 -lfreetype -lz -lfontconfig -lgmodule-2.0\n-ldbus-1 -lgobject-2.0 -lglib-2.0     -Wl,--version-script\n-Wl,/abuild/jh/mozilla-central2/mozilla-central/build/unix/gnu-ld-scripts/components-version-script\n-Wl,-Bsymbolic -ldl    \n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxUnknownSurface::~gfxUnknownSurface():../../../dist/include/gfxASurface.h:247:\nerror: undefined reference to 'vtable for gfxASurface'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxUnknownSurface::~gfxUnknownSurface():../../../dist/include/gfxASurface.h:248:\nerror: undefined reference to 'gfxASurface::RecordMemoryFreed()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxUnknownSurface::~gfxUnknownSurface():../../../dist/include/gfxASurface.h:247:\nerror: undefined reference to 'vtable for gfxASurface'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxUnknownSurface::~gfxUnknownSurface():../../../dist/include/gfxASurface.h:248:\nerror: undefined reference to 'gfxASurface::RecordMemoryFreed()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxASurface::~gfxASurface():../../../dist/include/gfxASurface.h:247: error:\nundefined reference to 'vtable for gfxASurface'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxASurface::~gfxASurface():../../../dist/include/gfxASurface.h:248: error:\nundefined reference to 'gfxASurface::RecordMemoryFreed()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxASurface::~gfxASurface():../../../dist/include/gfxASurface.h:247: error:\nundefined reference to 'vtable for gfxASurface'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\ngfxASurface::~gfxASurface():../../../dist/include/gfxASurface.h:248: error:\nundefined reference to 'gfxASurface::RecordMemoryFreed()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x10):\nerror: undefined reference to 'gfxASurface::BeginPrinting(nsAString const&,\nnsAString const&)'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x18):\nerror: undefined reference to 'gfxASurface::EndPrinting()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x20):\nerror: undefined reference to 'gfxASurface::AbortPrinting()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x28):\nerror: undefined reference to 'gfxASurface::BeginPage()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x30):\nerror: undefined reference to 'gfxASurface::EndPage()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x38):\nerror: undefined reference to 'gfxASurface::Finish()'\n/abuild/jh/trunk-install/lib/gcc/x86_64-unknown-linux-gnu/4.6.0/../../../../x86_64-unknown-linux-gnu/bin/ld:\n/abuild/jh/tmp//cc0wLUAb.ltrans0.ltrans.o: in function\n_ZTV17gfxUnknownSurface.local.39.3126:cc0wLUAb.ltrans0.o(.data.rel.ro+0x40):\nerror: undefined reference to\n'gfxASurface::CreateSimilarSurface(gfxASurface::gfxContentType, gfxIntSize\nconst&)'\n\n\nthe reason is that libmozgnome implemenetaiton include gfxAsurface, uses it in C++ standard sense but rely on fact that it is fully optimized out since it is not linked with its implementation.\nFor complex reasons this fails in this configuration: GCC keeps virtual functions for possible devirutalization around and there is difficult iteraction in between COMDAT, linker plugin and profiling instrumentation that renders the function neccesary.\n\nWhile this is also missed optimization problem in GCC, I think this code is not strictly valid.\n\nReproducible: Always", "id": 5186994, "attachment_id": null, "creator": "jh@suse.cz", "time": "2011-01-10T16:38:15Z", "author": "jh@suse.cz", "creation_time": "2011-01-10T16:38:15Z", "count": 0, "tags": []}, {"text": "This comes from toolkit/system/gnome/nsAlertsIconListener.cpp including imgIContainer.h, in turn including gfxImageSurface.h, in turn including gfxASurface.h.", "is_private": false, "bug_id": 624385, "raw_text": "This comes from toolkit/system/gnome/nsAlertsIconListener.cpp including imgIContainer.h, in turn including gfxImageSurface.h, in turn including gfxASurface.h.", "creator": "mh+mozilla@glandium.org", "id": 5187043, "attachment_id": null, "creation_time": "2011-01-10T16:57:24Z", "count": 1, "time": "2011-01-10T16:57:24Z", "author": "mh+mozilla@glandium.org", "tags": []}]}}, "comments": {}}