{"bugs": {"678324": {"comments": [{"attachment_id": null, "raw_text": "User Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:8.0a1) Gecko/20110811 Firefox/8.0a1\nBuild ID: 20110811030759\n\nSteps to reproduce:\n\nLoad the attached ICC profile in Firefox v8.0a1, and enable color management for *all* graphics (not just tagged images). Then switch the gfx.color_management.rendering_intent flag between its possible values (-1 through 3), restarting the browser after every change.\n\nTest image is attached as well, to identify what profile type is being used.\n\n\nActual results:\n\ngfx.color_management.enablev4: false\ngfx.color_management.rendering_intent: *any value*\nResult: Always uses matrix+TRC (tone response curve), result is that the front ball appears brownish.\n\ngfx.color_management.enablev4: true\ngfx.color_management.rendering_intent: *any value*\nResult: Always uses the A2B0 table (perceptual) mode, regardless of setting.\n\n\nExpected results:\n\nExpected output is to use the appropriate rendering intent based on the flag's setting:\n\nIf set to 1 or 3 (colorimetric), the image should be dominated by a green color with pink highlights and bits of yellow. In the mode 1 the white point should be adjusted as well but this isn't as easily noticeable.\n\nIf set to 0 (perceptual), the image should be dominated by a red color with cyan highlights and bits of green.\n\nI don't know how it should behave for 2.", "id": 5648334, "creator": "Smorpg@gmail.com", "is_private": false, "count": 0, "author": "Smorpg@gmail.com", "creation_time": "2011-08-11T19:36:41Z", "time": "2011-08-11T19:36:41Z", "bug_id": 678324, "tags": [], "text": "User Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:8.0a1) Gecko/20110811 Firefox/8.0a1\nBuild ID: 20110811030759\n\nSteps to reproduce:\n\nLoad the attached ICC profile in Firefox v8.0a1, and enable color management for *all* graphics (not just tagged images). Then switch the gfx.color_management.rendering_intent flag between its possible values (-1 through 3), restarting the browser after every change.\n\nTest image is attached as well, to identify what profile type is being used.\n\n\nActual results:\n\ngfx.color_management.enablev4: false\ngfx.color_management.rendering_intent: *any value*\nResult: Always uses matrix+TRC (tone response curve), result is that the front ball appears brownish.\n\ngfx.color_management.enablev4: true\ngfx.color_management.rendering_intent: *any value*\nResult: Always uses the A2B0 table (perceptual) mode, regardless of setting.\n\n\nExpected results:\n\nExpected output is to use the appropriate rendering intent based on the flag's setting:\n\nIf set to 1 or 3 (colorimetric), the image should be dominated by a green color with pink highlights and bits of yellow. In the mode 1 the white point should be adjusted as well but this isn't as easily noticeable.\n\nIf set to 0 (perceptual), the image should be dominated by a red color with cyan highlights and bits of green.\n\nI don't know how it should behave for 2."}, {"count": 1, "bug_id": 678324, "attachment_id": 552474, "raw_text": "", "id": 5648353, "is_private": false, "creator": "Smorpg@gmail.com", "creation_time": "2011-08-11T19:45:39Z", "author": "Smorpg@gmail.com", "text": "Created attachment 552474\nTest case", "tags": [], "time": "2011-08-11T19:45:39Z"}, {"attachment_id": 552475, "raw_text": "", "id": 5648356, "is_private": false, "creator": "Smorpg@gmail.com", "count": 2, "creation_time": "2011-08-11T19:46:29Z", "author": "Smorpg@gmail.com", "text": "Created attachment 552475\nICC profile for demonstration purposes", "time": "2011-08-11T19:46:29Z", "bug_id": 678324, "tags": []}, {"time": "2011-08-11T19:48:31Z", "bug_id": 678324, "tags": [], "text": "*** Bug 675303 has been marked as a duplicate of this bug. ***", "author": "b56girard@gmail.com", "creation_time": "2011-08-11T19:48:31Z", "count": 3, "creator": "b56girard@gmail.com", "is_private": false, "id": 5648361, "raw_text": "", "attachment_id": null}, {"is_private": false, "creator": "b56girard@gmail.com", "count": 4, "creation_time": "2011-08-11T19:56:08Z", "author": "b56girard@gmail.com", "text": "I don't have time to look at this at the moment but we would take a patch. Willing to help out if someone wants to look at this.\n\nRelevant source files:\ngfx/qcms/transform.c <-- A2B table selected\ngfx/qcms/chain.c     <-- A2B table selected\ngfx/qcms/iccread.c   <-- A2B tables parsed\ngfx/qcms/qcms.h      <-- Rendering intent selected\n\nSee the ICC v4 specification for more information on rendering intents.", "tags": [], "bug_id": 678324, "time": "2011-08-11T19:56:08Z", "attachment_id": null, "raw_text": "I don't have time to look at this at the moment but we would take a patch. Willing to help out if someone wants to look at this.\n\nRelevant source files:\ngfx/qcms/transform.c <-- A2B table selected\ngfx/qcms/chain.c     <-- A2B table selected\ngfx/qcms/iccread.c   <-- A2B tables parsed\ngfx/qcms/qcms.h      <-- Rendering intent selected\n\nSee the ICC v4 specification for more information on rendering intents.", "id": 5648378}, {"text": "I'm going to get this. It's my first bug, I don't know if it will take long :/", "time": "2011-08-18T21:10:39Z", "bug_id": 678324, "tags": [], "creation_time": "2011-08-18T21:10:39Z", "author": "alonso12345@hotmail.com", "count": 5, "is_private": false, "creator": "alonso12345@hotmail.com", "id": 5663695, "raw_text": "I'm going to get this. It's my first bug, I don't know if it will take long :/", "attachment_id": null}, {"id": 5666328, "attachment_id": null, "raw_text": "Let me know if you have any questions, this patch is important for improving our color management support. The idea is that currently the intent parameters is mostly ignored and we will want to use it to select the right A2B table.", "creation_time": "2011-08-19T20:57:59Z", "author": "b56girard@gmail.com", "text": "Let me know if you have any questions, this patch is important for improving our color management support. The idea is that currently the intent parameters is mostly ignored and we will want to use it to select the right A2B table.", "time": "2011-08-19T20:57:59Z", "tags": [], "is_private": false, "creator": "b56girard@gmail.com", "bug_id": 678324, "count": 6}, {"bug_id": 678324, "count": 7, "id": 5667360, "raw_text": "I have various questions. Some I think they are a little bit evident, but I prefer to ask.\n1)\tI need to use the variable that contains the rendering intent that is currently using firefox.\nIn the about:config appears as (gfx.color_management.rendering_intent) but I can't use it in ICCread.c \u00bfThere is a way to use it in there or I'm totally wrong and the variable has another name?\n\n2)\tIf the tag for the intent currently selected in firefox is not present in the file, what intent it's assumed to be used? The profile intent?\n\n3)\tThe code in ICCread seems to try to get all info of the tables for the profile, also when it's possible that it's no needed. When I start coding what is best that I do, read all possible data or get only the tables that the intent is going to use?\n\n4)\tShould I add in the qcms_profile struct  A2B1, A2B2, B2A1, B2A2 variables or use the A2B0 B2A0 to store the tables although they don't correspond to that tables? If I'm correct it's only necessary a pair. (for example, store in the A2B0 the A2B2 table).\n\n5)\tIn transform.c I don't know what I have to do exactly, if something is to be done. The only reference to tables that I found is for not use precache.", "attachment_id": null, "time": "2011-08-20T17:18:59Z", "tags": [], "text": "I have various questions. Some I think they are a little bit evident, but I prefer to ask.\n1)\tI need to use the variable that contains the rendering intent that is currently using firefox.\nIn the about:config appears as (gfx.color_management.rendering_intent) but I can't use it in ICCread.c \u00bfThere is a way to use it in there or I'm totally wrong and the variable has another name?\n\n2)\tIf the tag for the intent currently selected in firefox is not present in the file, what intent it's assumed to be used? The profile intent?\n\n3)\tThe code in ICCread seems to try to get all info of the tables for the profile, also when it's possible that it's no needed. When I start coding what is best that I do, read all possible data or get only the tables that the intent is going to use?\n\n4)\tShould I add in the qcms_profile struct  A2B1, A2B2, B2A1, B2A2 variables or use the A2B0 B2A0 to store the tables although they don't correspond to that tables? If I'm correct it's only necessary a pair. (for example, store in the A2B0 the A2B2 table).\n\n5)\tIn transform.c I don't know what I have to do exactly, if something is to be done. The only reference to tables that I found is for not use precache.", "author": "alonso12345@hotmail.com", "creation_time": "2011-08-20T17:18:59Z", "creator": "alonso12345@hotmail.com", "is_private": false}, {"id": 5667425, "attachment_id": null, "raw_text": "2) I would assume so, yes\n\n3,4) You should be fine just loading the correct table since firefox doesn't reload color management settings until you restart the browser either way. Probably best to rename it A2B and B2A instead of A2B0 to prevent confusion.", "creation_time": "2011-08-20T18:53:45Z", "author": "Smorpg@gmail.com", "text": "2) I would assume so, yes\n\n3,4) You should be fine just loading the correct table since firefox doesn't reload color management settings until you restart the browser either way. Probably best to rename it A2B and B2A instead of A2B0 to prevent confusion.", "time": "2011-08-20T18:53:45Z", "bug_id": 678324, "tags": [], "is_private": false, "creator": "Smorpg@gmail.com", "count": 8}, {"id": 5667435, "attachment_id": null, "raw_text": "You can find the ICCv4 specification here:\n\n(In reply to JordiM from comment #7)\n> I have various questions. Some I think they are a little bit evident, but I\n> prefer to ask.\n> 1)\tI need to use the variable that contains the rendering intent that is\n> currently using firefox.\n> In the about:config appears as (gfx.color_management.rendering_intent) but I\n> can't use it in ICCread.c \u00bfThere is a way to use it in there or I'm totally\n> wrong and the variable has another name?\n> \nThe variable is passed through to 'qcms_transform_create' in qcms already but it's ignored.  You can use the following to trace exactly how it is read and passed to qcms by searching string and identifier:\nhttp://mxr.mozilla.org/mozilla-central/\n\n> 2)\tIf the tag for the intent currently selected in firefox is not present in\n> the file, what intent it's assumed to be used? The profile intent?\n> \n\nI think it should default to perceptual. You might section 6.2 and table 21 useful in the ICC spec.\n\n> 3)\tThe code in ICCread seems to try to get all info of the tables for the\n> profile, also when it's possible that it's no needed. When I start coding\n> what is best that I do, read all possible data or get only the tables that\n> the intent is going to use?\n> \nI think for now we want iccread to read the entire profile and not make any assumption about how it will be used. You are correct that we can end up reading some tags that will not be used.\n\n> 4)\tShould I add in the qcms_profile struct  A2B1, A2B2, B2A1, B2A2 variables\n> or use the A2B0 B2A0 to store the tables although they don't correspond to\n> that tables? If I'm correct it's only necessary a pair. (for example, store\n> in the A2B0 the A2B2 table).\n> \n\nI would store them all.\n\n> 5)\tIn transform.c I don't know what I have to do exactly, if something is to\n> be done. The only reference to tables that I found is for not use precache.\n\nIf we read all the tables then we will need to select the correct table in transform.c.", "creation_time": "2011-08-20T19:10:09Z", "author": "b56girard@gmail.com", "text": "You can find the ICCv4 specification here:\n\n(In reply to JordiM from comment #7)\n> I have various questions. Some I think they are a little bit evident, but I\n> prefer to ask.\n> 1)\tI need to use the variable that contains the rendering intent that is\n> currently using firefox.\n> In the about:config appears as (gfx.color_management.rendering_intent) but I\n> can't use it in ICCread.c \u00bfThere is a way to use it in there or I'm totally\n> wrong and the variable has another name?\n> \nThe variable is passed through to 'qcms_transform_create' in qcms already but it's ignored.  You can use the following to trace exactly how it is read and passed to qcms by searching string and identifier:\nhttp://mxr.mozilla.org/mozilla-central/\n\n> 2)\tIf the tag for the intent currently selected in firefox is not present in\n> the file, what intent it's assumed to be used? The profile intent?\n> \n\nI think it should default to perceptual. You might section 6.2 and table 21 useful in the ICC spec.\n\n> 3)\tThe code in ICCread seems to try to get all info of the tables for the\n> profile, also when it's possible that it's no needed. When I start coding\n> what is best that I do, read all possible data or get only the tables that\n> the intent is going to use?\n> \nI think for now we want iccread to read the entire profile and not make any assumption about how it will be used. You are correct that we can end up reading some tags that will not be used.\n\n> 4)\tShould I add in the qcms_profile struct  A2B1, A2B2, B2A1, B2A2 variables\n> or use the A2B0 B2A0 to store the tables although they don't correspond to\n> that tables? If I'm correct it's only necessary a pair. (for example, store\n> in the A2B0 the A2B2 table).\n> \n\nI would store them all.\n\n> 5)\tIn transform.c I don't know what I have to do exactly, if something is to\n> be done. The only reference to tables that I found is for not use precache.\n\nIf we read all the tables then we will need to select the correct table in transform.c.", "tags": [], "time": "2011-08-20T19:10:09Z", "bug_id": 678324, "is_private": false, "creator": "b56girard@gmail.com", "count": 9}, {"bug_id": 678324, "count": 10, "id": 5670181, "raw_text": "I have done a lot of modifications in the ICCread.c, basically change how to access the tags, because I found it very inefficient if all the tags of the standard must be checked. \nBefore, it created a tag list, and with a search function was checking the signatures and when the tag was found the data was added in the profile. Now it reads a tag and puts the data in the profile.\n\nI don't have any problem with the code, but I paste it so you can take a look if you want. (It's not completed yet)\nqcmsint.h: http://pastebin.com/peSEGYWh (only new variables in the profile)\nICCread.c: http://pastebin.com/4gvpzV6r (I have to quit the find_tag function. It's not used anymore)\n\nMy problem is when it\u2019s time to test what I have done.\nI'm pretty sure that what I have works well, but I have to check it manually with a debugger. There is a test suite or something that performs an automatic test for this part of code?\n\nI found this web but I don't know if any of this test check the ICC parsing:\nhttps://developer.mozilla.org/en/Mozilla_automated_testing\n\nIf no one of these covers it, what I should read to make my own tests?", "attachment_id": null, "time": "2011-08-22T21:06:05Z", "tags": [], "text": "I have done a lot of modifications in the ICCread.c, basically change how to access the tags, because I found it very inefficient if all the tags of the standard must be checked. \nBefore, it created a tag list, and with a search function was checking the signatures and when the tag was found the data was added in the profile. Now it reads a tag and puts the data in the profile.\n\nI don't have any problem with the code, but I paste it so you can take a look if you want. (It's not completed yet)\nqcmsint.h: http://pastebin.com/peSEGYWh (only new variables in the profile)\nICCread.c: http://pastebin.com/4gvpzV6r (I have to quit the find_tag function. It's not used anymore)\n\nMy problem is when it\u2019s time to test what I have done.\nI'm pretty sure that what I have works well, but I have to check it manually with a debugger. There is a test suite or something that performs an automatic test for this part of code?\n\nI found this web but I don't know if any of this test check the ICC parsing:\nhttps://developer.mozilla.org/en/Mozilla_automated_testing\n\nIf no one of these covers it, what I should read to make my own tests?", "author": "alonso12345@hotmail.com", "creation_time": "2011-08-22T21:06:05Z", "creator": "alonso12345@hotmail.com", "is_private": false}, {"raw_text": "Can you post a patch so that I can easily see what changes you've done. If you've made you changes under mozilla-central/gfx you should be able to use |hg diff . > file.patch| and attach that to the bug.\n\nIf you're working on changes unrelated to these issues please file a separate bug explaining what you think the issue is.\n\nWe don't have a regression test suite icc profile but we have considered adding one. I have some test that I run offline but I don't have a package to provide for that at this time.", "attachment_id": null, "id": 5670232, "is_private": false, "creator": "b56girard@gmail.com", "text": "Can you post a patch so that I can easily see what changes you've done. If you've made you changes under mozilla-central/gfx you should be able to use |hg diff . > file.patch| and attach that to the bug.\n\nIf you're working on changes unrelated to these issues please file a separate bug explaining what you think the issue is.\n\nWe don't have a regression test suite icc profile but we have considered adding one. I have some test that I run offline but I don't have a package to provide for that at this time.", "tags": [], "time": "2011-08-22T21:14:53Z", "creation_time": "2011-08-22T21:14:53Z", "author": "b56girard@gmail.com", "count": 11, "bug_id": 678324}, {"bug_id": 678324, "count": 12, "tags": [], "time": "2011-08-23T10:02:02Z", "text": "Created attachment 555059\nModified ICCread.c parsing. Profile extended.", "author": "alonso12345@hotmail.com", "creation_time": "2011-08-23T10:02:02Z", "creator": "alonso12345@hotmail.com", "is_private": false, "id": 5671555, "raw_text": "", "attachment_id": 555059}, {"id": 5671571, "attachment_id": null, "raw_text": "Uploaded patch. I only modified files in gfx/qcms.\n\nThe changes are related to the bug. I needed to read more tags for the ICC-absolute intent, and I don't know if more are needed. Because of these I though I needed a better way to add new tags in the parsing, instead the one that was present (and also will come in handy to make the standard full compliant to read all tags in another bug).", "creation_time": "2011-08-23T10:14:25Z", "author": "alonso12345@hotmail.com", "text": "Uploaded patch. I only modified files in gfx/qcms.\n\nThe changes are related to the bug. I needed to read more tags for the ICC-absolute intent, and I don't know if more are needed. Because of these I though I needed a better way to add new tags in the parsing, instead the one that was present (and also will come in handy to make the standard full compliant to read all tags in another bug).", "time": "2011-08-23T10:14:25Z", "bug_id": 678324, "tags": [], "is_private": false, "creator": "alonso12345@hotmail.com", "count": 13}, {"count": 14, "is_private": false, "creator": "alonso12345@hotmail.com", "text": "Created attachment 556691\nrendering intent for V4\n\nNew patch and new problems. This patch allows to use the rendering intents, but only works if gfx.color_management.enablev4 is true. Also absolute and media-color are the same.I have to figure out how to apply the whitepointTag in the transforms to achieve the absolute rendering. Any Idea on this?\n\nThe renderings are \"working\" in images but not in the browser.\nExample: \nUse the profile attached to the bug and put mode 1 in color management, 0 to rendering intent and enable v4.\nVisit this website: http://www.tomasjonsson.eu/colortests/colortest-xhtml.html\n(The first 8 colors should be the same).\nTry any other rendering, the colors will not be the same for all.\nI don't have any idea why this happens. I thought that the system was made for all, images and browser. Again, any idea?", "time": "2011-08-29T22:36:25Z", "bug_id": 678324, "tags": [], "creation_time": "2011-08-29T22:36:25Z", "author": "alonso12345@hotmail.com", "raw_text": "New patch and new problems. This patch allows to use the rendering intents, but only works if gfx.color_management.enablev4 is true. Also absolute and media-color are the same.I have to figure out how to apply the whitepointTag in the transforms to achieve the absolute rendering. Any Idea on this?\n\nThe renderings are \"working\" in images but not in the browser.\nExample: \nUse the profile attached to the bug and put mode 1 in color management, 0 to rendering intent and enable v4.\nVisit this website: http://www.tomasjonsson.eu/colortests/colortest-xhtml.html\n(The first 8 colors should be the same).\nTry any other rendering, the colors will not be the same for all.\nI don't have any idea why this happens. I thought that the system was made for all, images and browser. Again, any idea?", "attachment_id": 556691, "id": 5686329}, {"count": 15, "is_private": false, "creator": "Smorpg@gmail.com", "text": "(In reply to JordiM from comment #14)\n> Created attachment 556691\n> rendering intent for V4\n> \n> New patch and new problems. This patch allows to use the rendering intents,\n> but only works if gfx.color_management.enablev4 is true. Also absolute and\n> media-color are the same.I have to figure out how to apply the whitepointTag\n> in the transforms to achieve the absolute rendering. Any Idea on this?\n\nThe white point transformation should only be done for relative colorimetric - absolute should leave the white point unchanged.\n\n> The renderings are \"working\" in images but not in the browser.\n> Example: \n> Use the profile attached to the bug and put mode 1 in color management, 0 to\n> rendering intent and enable v4.\n> Visit this website:\n> http://www.tomasjonsson.eu/colortests/colortest-xhtml.html\n> (The first 8 colors should be the same).\n> Try any other rendering, the colors will not be the same for all.\n> I don't have any idea why this happens. I thought that the system was made\n> for all, images and browser. Again, any idea?\n\nThey should look different in any rendering intent other than \u201cabsolute colorimetric\u201d, because perceptual / relative modes apply transformations that are dependent on the source gamut as well. Only in absolute colorimetric mode should they truly be the same.", "tags": [], "time": "2011-08-29T22:42:17Z", "bug_id": 678324, "creation_time": "2011-08-29T22:42:17Z", "author": "Smorpg@gmail.com", "raw_text": "(In reply to JordiM from comment #14)\n> Created attachment 556691\n> rendering intent for V4\n> \n> New patch and new problems. This patch allows to use the rendering intents,\n> but only works if gfx.color_management.enablev4 is true. Also absolute and\n> media-color are the same.I have to figure out how to apply the whitepointTag\n> in the transforms to achieve the absolute rendering. Any Idea on this?\n\nThe white point transformation should only be done for relative colorimetric - absolute should leave the white point unchanged.\n\n> The renderings are \"working\" in images but not in the browser.\n> Example: \n> Use the profile attached to the bug and put mode 1 in color management, 0 to\n> rendering intent and enable v4.\n> Visit this website:\n> http://www.tomasjonsson.eu/colortests/colortest-xhtml.html\n> (The first 8 colors should be the same).\n> Try any other rendering, the colors will not be the same for all.\n> I don't have any idea why this happens. I thought that the system was made\n> for all, images and browser. Again, any idea?\n\nThey should look different in any rendering intent other than \u201cabsolute colorimetric\u201d, because perceptual / relative modes apply transformations that are dependent on the source gamut as well. Only in absolute colorimetric mode should they truly be the same.", "attachment_id": null, "id": 5686347}, {"bug_id": 678324, "count": 16, "id": 5686369, "attachment_id": null, "raw_text": "(In reply to JordiM from comment #14)\n> Created attachment 556691\n> rendering intent for V4\n> \n> New patch and new problems. This patch allows to use the rendering intents,\n> but only works if gfx.color_management.enablev4 is true. \nWe're keeping the new changes behind this preference because further testing and security review is required before enabling this feature.\n\n> Also absolute and\n> media-color are the same.I have to figure out how to apply the whitepointTag\n> in the transforms to achieve the absolute rendering. Any Idea on this?\n> \nIf I remember correctly the whitepoint is adjusted using a chromatic adaption matrix. I wrote the code but it didn't appear to improve the results. The transformation happens here:\nhttp://mxr.mozilla.org/mozilla-central/source/gfx/qcms/chain.c#916\n\n> The renderings are \"working\" in images but not in the browser.\n\nThat's expected, we only apply color management for image decoding. Certain OS like OS X will apply color management to other areas automatically using their color management system.", "creation_time": "2011-08-29T22:49:18Z", "author": "b56girard@gmail.com", "text": "(In reply to JordiM from comment #14)\n> Created attachment 556691\n> rendering intent for V4\n> \n> New patch and new problems. This patch allows to use the rendering intents,\n> but only works if gfx.color_management.enablev4 is true. \nWe're keeping the new changes behind this preference because further testing and security review is required before enabling this feature.\n\n> Also absolute and\n> media-color are the same.I have to figure out how to apply the whitepointTag\n> in the transforms to achieve the absolute rendering. Any Idea on this?\n> \nIf I remember correctly the whitepoint is adjusted using a chromatic adaption matrix. I wrote the code but it didn't appear to improve the results. The transformation happens here:\nhttp://mxr.mozilla.org/mozilla-central/source/gfx/qcms/chain.c#916\n\n> The renderings are \"working\" in images but not in the browser.\n\nThat's expected, we only apply color management for image decoding. Certain OS like OS X will apply color management to other areas automatically using their color management system.", "time": "2011-08-29T22:49:18Z", "tags": [], "is_private": false, "creator": "b56girard@gmail.com"}, {"attachment_id": null, "raw_text": "I think that I'm right about the use of white point to get the absolute intent.\nIn section 9.2.25 says that the mediaWhiteTag is used to generate the ICC-absolute.\nIn 6.3.2 there are formulas to obtain ICC-absolute with media-relative and media white point.\n\nBenWa, I think your code it has nothing to do with the intents. The chromatic adapt tag it's only necessary to adjust illumination to D50 if the illumination is another one and used always (if the tag is present, obviously) regardless of the intent.\n\nI'm working to get V2 and absolute intent working.\nThanks for the answers.", "id": 5687427, "creator": "alonso12345@hotmail.com", "is_private": false, "author": "alonso12345@hotmail.com", "creation_time": "2011-08-30T12:08:06Z", "time": "2011-08-30T12:08:06Z", "tags": [], "text": "I think that I'm right about the use of white point to get the absolute intent.\nIn section 9.2.25 says that the mediaWhiteTag is used to generate the ICC-absolute.\nIn 6.3.2 there are formulas to obtain ICC-absolute with media-relative and media white point.\n\nBenWa, I think your code it has nothing to do with the intents. The chromatic adapt tag it's only necessary to adjust illumination to D50 if the illumination is another one and used always (if the tag is present, obviously) regardless of the intent.\n\nI'm working to get V2 and absolute intent working.\nThanks for the answers.", "count": 17, "bug_id": 678324}, {"id": 5687633, "attachment_id": null, "raw_text": "(In reply to JordiM from comment #17)\n> I think that I'm right about the use of white point to get the absolute\n> intent.\n> In section 9.2.25 says that the mediaWhiteTag is used to generate the\n> ICC-absolute.\n> In 6.3.2 there are formulas to obtain ICC-absolute with media-relative and\n> media white point.\n> \n> BenWa, I think your code it has nothing to do with the intents. The\n> chromatic adapt tag it's only necessary to adjust illumination to D50 if the\n> illumination is another one and used always (if the tag is present,\n> obviously) regardless of the intent.\n> \n\nThat's right, it is for the illumination.\n\nJordiM, Jeff and I are happy with the patches you're working on. Your patch is already 100 KB and does refactoring that is outside the description of this bug. qcms changes also have the burden of requiring throughout review because of security concerns. It would make the review process significantly faster if you can split up the changes into smaller patch such as the refactoring to the tag parsing and changes to support intent and any other logical changes. I had made the same mistake when adding my changes to support CLUTs and the review took very long. Changes that don't relate directly to color intents can be handled in a separate bug that can be flagged as |blocking| this bug if the change is required for color intent (or the patch is based upon it). \n\nLet me know if you need any help with splitting up the patches. Mercurial queue is a great tool for this but how you do it is up to personal preference:\nhttp://mercurial.selenic.com/wiki/MqExtension\nhttp://mercurial.selenic.com/wiki/MqTutorial", "author": "b56girard@gmail.com", "creation_time": "2011-08-30T14:08:39Z", "bug_id": 678324, "tags": [], "time": "2011-08-30T14:08:39Z", "text": "(In reply to JordiM from comment #17)\n> I think that I'm right about the use of white point to get the absolute\n> intent.\n> In section 9.2.25 says that the mediaWhiteTag is used to generate the\n> ICC-absolute.\n> In 6.3.2 there are formulas to obtain ICC-absolute with media-relative and\n> media white point.\n> \n> BenWa, I think your code it has nothing to do with the intents. The\n> chromatic adapt tag it's only necessary to adjust illumination to D50 if the\n> illumination is another one and used always (if the tag is present,\n> obviously) regardless of the intent.\n> \n\nThat's right, it is for the illumination.\n\nJordiM, Jeff and I are happy with the patches you're working on. Your patch is already 100 KB and does refactoring that is outside the description of this bug. qcms changes also have the burden of requiring throughout review because of security concerns. It would make the review process significantly faster if you can split up the changes into smaller patch such as the refactoring to the tag parsing and changes to support intent and any other logical changes. I had made the same mistake when adding my changes to support CLUTs and the review took very long. Changes that don't relate directly to color intents can be handled in a separate bug that can be flagged as |blocking| this bug if the change is required for color intent (or the patch is based upon it). \n\nLet me know if you need any help with splitting up the patches. Mercurial queue is a great tool for this but how you do it is up to personal preference:\nhttp://mercurial.selenic.com/wiki/MqExtension\nhttp://mercurial.selenic.com/wiki/MqTutorial", "creator": "b56girard@gmail.com", "is_private": false, "count": 18}, {"is_private": false, "creator": "alonso12345@hotmail.com", "count": 19, "creation_time": "2011-09-07T17:19:40Z", "author": "alonso12345@hotmail.com", "text": "Created attachment 558866\nRendering intent for V4 whiteout ICCread modifications\n\nSorry for so long time without any response.\nI tried to do the part of the absolute intent and I had some troubles making the patch.\nFinally I couldn't get the absolute intent working as it's expected so I decided to make the patch without it (media-relative and absolute intent return the same image in this patch).\nI made a new bug for the tag parsing (blocking this) because it reads tags necessary for the intents and the media white point for future improvement.\nThe patch added in this bug works only if V4 is active. I also tried to do for V2 but I can't :/", "tags": [], "time": "2011-09-07T17:19:40Z", "bug_id": 678324, "attachment_id": 558866, "raw_text": "Sorry for so long time without any response.\nI tried to do the part of the absolute intent and I had some troubles making the patch.\nFinally I couldn't get the absolute intent working as it's expected so I decided to make the patch without it (media-relative and absolute intent return the same image in this patch).\nI made a new bug for the tag parsing (blocking this) because it reads tags necessary for the intents and the media white point for future improvement.\nThe patch added in this bug works only if V4 is active. I also tried to do for V2 but I can't :/", "id": 5705252}, {"attachment_id": 558866, "raw_text": "Review of attachment 558866:\n-----------------------------------------------------------------\n\nTook a quick look. This patch looks great. We will need to fix the spacing (see my other review comment for a suggestion on how to fix this).\n\n::: gfx/qcms/chain.c\n@@ +747,5 @@\n> +            }\n> +            break;\n> +    }\n> +    \n> +    if (in->A2B0) {\n\nSince this isn't in its own case we could end up chaining the transform of the above A2B1/2 and A2B0. Is this intended? If not this should be moved up into its own case.\n\nWe should also define the default case as well as QCMS_INTENT_DEFAULT/QCMS_INTENT_PERCEPTUAL to be explicit about what should happen in these cases.\n\n@@ +848,5 @@\n> +            }\n> +            break;\n> +    }\n> +    \n> +    if (out->B2A0) {\n\nLikewise", "id": 5723117, "creator": "b56girard@gmail.com", "is_private": false, "author": "b56girard@gmail.com", "creation_time": "2011-09-19T15:45:52Z", "time": "2011-09-19T15:45:52Z", "tags": [], "text": "Comment on attachment 558866\nRendering intent for V4 whiteout ICCread modifications\n\nReview of attachment 558866:\n-----------------------------------------------------------------\n\nTook a quick look. This patch looks great. We will need to fix the spacing (see my other review comment for a suggestion on how to fix this).\n\n::: gfx/qcms/chain.c\n@@ +747,5 @@\n> +            }\n> +            break;\n> +    }\n> +    \n> +    if (in->A2B0) {\n\nSince this isn't in its own case we could end up chaining the transform of the above A2B1/2 and A2B0. Is this intended? If not this should be moved up into its own case.\n\nWe should also define the default case as well as QCMS_INTENT_DEFAULT/QCMS_INTENT_PERCEPTUAL to be explicit about what should happen in these cases.\n\n@@ +848,5 @@\n> +            }\n> +            break;\n> +    }\n> +    \n> +    if (out->B2A0) {\n\nLikewise", "count": 20, "bug_id": 678324}, {"attachment_id": null, "raw_text": "I know it's a little bit confusing but the code it's intended to be like is.\nFirst, it's not possible to chain A2B1/2 with A2B0 because all transforms have their own return. \nThe only way to reach A2B0 is by having a perceptual rendering intent or because the selected rendering intent is not available in the ICC profile.\nAbout the perceptual intent outside the switch/case statement we can discuss.\nI put a comment about this \u201c//Perceptual intent is after the switch in order to preserve tag priority usage described in ICC.1:2004-10 clause 8.10\u201d\nIf I putted the perceptual intent inside the switch, then I ought to duplicate the perceptual code after to comply with the standard. \nI decided that I didn't want repeated code, so I put it outside and didn't use the default case in order that the perceptual intent in the switch does nothing. The result is that if the rendering intent is 0 (perceptual), the switch does nothing and goes to A2B0 (perceptual intent). If the rendering intent is not correct (default case) also goes to A2B0, which I think it should be the thing to do if the rendering is incorrect.\nIf you want I can put the cases explicit, but we will have the A2B0 code three times. I think this could be a little bit confusing.", "id": 5724319, "creator": "alonso12345@hotmail.com", "is_private": false, "author": "alonso12345@hotmail.com", "creation_time": "2011-09-19T22:56:11Z", "tags": [], "time": "2011-09-19T22:56:11Z", "text": "I know it's a little bit confusing but the code it's intended to be like is.\nFirst, it's not possible to chain A2B1/2 with A2B0 because all transforms have their own return. \nThe only way to reach A2B0 is by having a perceptual rendering intent or because the selected rendering intent is not available in the ICC profile.\nAbout the perceptual intent outside the switch/case statement we can discuss.\nI put a comment about this \u201c//Perceptual intent is after the switch in order to preserve tag priority usage described in ICC.1:2004-10 clause 8.10\u201d\nIf I putted the perceptual intent inside the switch, then I ought to duplicate the perceptual code after to comply with the standard. \nI decided that I didn't want repeated code, so I put it outside and didn't use the default case in order that the perceptual intent in the switch does nothing. The result is that if the rendering intent is 0 (perceptual), the switch does nothing and goes to A2B0 (perceptual intent). If the rendering intent is not correct (default case) also goes to A2B0, which I think it should be the thing to do if the rendering is incorrect.\nIf you want I can put the cases explicit, but we will have the A2B0 code three times. I think this could be a little bit confusing.", "count": 21, "bug_id": 678324}, {"text": "(In reply to JordiM from comment #21)\n\nYou're absolutely right. I skipped over the return statements. I would suggest adding:\ncase (QCMS_INTENT_DEFAULT):\n  break;\n\njust so that it's clear that the intent is meant to fall through. Your reference to 8.10 is correct. Style nit for comment, add a space after '//'.\n\nThis patch looks great!", "time": "2011-09-22T18:26:03Z", "tags": [], "bug_id": 678324, "creation_time": "2011-09-22T18:26:03Z", "author": "b56girard@gmail.com", "count": 22, "is_private": false, "creator": "b56girard@gmail.com", "id": 5731466, "raw_text": "(In reply to JordiM from comment #21)\n\nYou're absolutely right. I skipped over the return statements. I would suggest adding:\ncase (QCMS_INTENT_DEFAULT):\n  break;\n\njust so that it's clear that the intent is meant to fall through. Your reference to 8.10 is correct. Style nit for comment, add a space after '//'.\n\nThis patch looks great!", "attachment_id": null}, {"text": "Created attachment 562775\nRndering intent patch\n\nAdded the default case and changed the spaces to tabs.", "bug_id": 678324, "tags": [], "time": "2011-09-27T15:40:36Z", "creation_time": "2011-09-27T15:40:36Z", "author": "alonso12345@hotmail.com", "count": 23, "is_private": false, "creator": "alonso12345@hotmail.com", "id": 5740274, "raw_text": "Added the default case and changed the spaces to tabs.", "attachment_id": 562775}]}}, "comments": {}}