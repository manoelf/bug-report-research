{"comments": {}, "bugs": {"671275": {"comments": [{"attachment_id": null, "raw_text": "Right now we treat \"link\" and \"visited\" as two content states.  This is a holdover from the days when we needed to restyle on visited state changes.\n\nAt this point, we only need to restyle when going from \"not link\" to either link or visited (or vice versa).  On a change from link to visited, we only need to repaint the element and its descendants (and possibly some following siblings if ~ or + combinators are in use).  In particular, we do NOT have to reresolve style, because we have already resolved both the not-visited and the visited style context.\n\nIn the short term, we could do this by simply hacking nsCSSFrameConstructor::ContentStateChanged to special-case the link and visited states, I think, though the following siblings case may need some more work.  Longer-term, I'm not quite sure that we want to use states for :link and :visited.", "bug_id": 671275, "text": "Right now we treat \"link\" and \"visited\" as two content states.  This is a holdover from the days when we needed to restyle on visited state changes.\n\nAt this point, we only need to restyle when going from \"not link\" to either link or visited (or vice versa).  On a change from link to visited, we only need to repaint the element and its descendants (and possibly some following siblings if ~ or + combinators are in use).  In particular, we do NOT have to reresolve style, because we have already resolved both the not-visited and the visited style context.\n\nIn the short term, we could do this by simply hacking nsCSSFrameConstructor::ContentStateChanged to special-case the link and visited states, I think, though the following siblings case may need some more work.  Longer-term, I'm not quite sure that we want to use states for :link and :visited.", "tags": [], "id": 5588963, "count": 0, "is_private": false, "time": "2011-07-13T15:06:55Z", "creation_time": "2011-07-13T15:06:55Z", "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu"}, {"author": "bzbarsky@mit.edu", "creation_time": "2011-07-13T15:12:37Z", "time": "2011-07-13T15:12:37Z", "creator": "bzbarsky@mit.edu", "count": 1, "id": 5588969, "is_private": false, "tags": [], "text": "I guess one issue is that the style context does have a NS_STYLE_RELEVANT_LINK_VISITED bit.  So we do want to change the style context, but we just want to flip this bit and do nothing else (e.g. we can copy over all the structs from the old style context, can copy the if-visited style contexts, etc.\n\nThis is sort of like style context reparenting, actually, but with us passing in the above bit explicitly.", "bug_id": 671275, "raw_text": "I guess one issue is that the style context does have a NS_STYLE_RELEVANT_LINK_VISITED bit.  So we do want to change the style context, but we just want to flip this bit and do nothing else (e.g. we can copy over all the structs from the old style context, can copy the if-visited style contexts, etc.\n\nThis is sort of like style context reparenting, actually, but with us passing in the above bit explicitly.", "attachment_id": null}]}}}