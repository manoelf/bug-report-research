{"comments": {}, "bugs": {"627594": {"comments": [{"is_private": false, "text": "Created attachment 505627\nTest case demonstrating problem\n\nSee the attached test case.\n\nThe <circle>'s cx attribute is defined as 50%, i.e. 50% of the viewport which is initially 100px. If we query the value of the cx attribute in user units we get 50.\n\nAfter updating the <svg> element's width attribute to 200px and querying the value of the cx attribute we still get 50 user units.\n\nHowever, after a reflow we get 100 user units.\n\ni.e. Expected output:\n<svg> width=100px, 50%=50\n<svg> width=200px, 50%=100\nforce redraw...\n<svg> width=200px, 50%=100\n\nActual output:\n<svg> width=100px, 50%=50\n<svg> width=200px, 50%=50\nforce redraw...\n<svg> width=200px, 50%=100\n\nThe problem is that in this case where we have no viewbox, we are using nsSVGSVGElement's mViewportWidth member to determine the viewport size:\nhttp://mxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGSVGElement.cpp#1130\n\nThis member, however, is not updated until we do a reflow:\nhttp://mxr.mozilla.org/mozilla-central/source/layout/svg/base/src/nsSVGOuterSVGFrame.cpp#371\n\nWe should update this value immediately.\n\nInterop:\nWebKit: as expected (above)\nOpera: fails to update value at all", "id": 5215631, "time": "2011-01-21T01:44:53Z", "creator": "brian@birchill.co.jp", "creation_time": "2011-01-21T01:44:53Z", "raw_text": "See the attached test case.\n\nThe <circle>'s cx attribute is defined as 50%, i.e. 50% of the viewport which is initially 100px. If we query the value of the cx attribute in user units we get 50.\n\nAfter updating the <svg> element's width attribute to 200px and querying the value of the cx attribute we still get 50 user units.\n\nHowever, after a reflow we get 100 user units.\n\ni.e. Expected output:\n<svg> width=100px, 50%=50\n<svg> width=200px, 50%=100\nforce redraw...\n<svg> width=200px, 50%=100\n\nActual output:\n<svg> width=100px, 50%=50\n<svg> width=200px, 50%=50\nforce redraw...\n<svg> width=200px, 50%=100\n\nThe problem is that in this case where we have no viewbox, we are using nsSVGSVGElement's mViewportWidth member to determine the viewport size:\nhttp://mxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGSVGElement.cpp#1130\n\nThis member, however, is not updated until we do a reflow:\nhttp://mxr.mozilla.org/mozilla-central/source/layout/svg/base/src/nsSVGOuterSVGFrame.cpp#371\n\nWe should update this value immediately.\n\nInterop:\nWebKit: as expected (above)\nOpera: fails to update value at all", "count": 0, "tags": [], "author": "brian@birchill.co.jp", "attachment_id": 505627, "bug_id": 627594}, {"raw_text": "So basically what we have is:\n\n  document.documentElement.setAttribute('width', '...');\n  var val = childCircle.cx.baseValue.value;\n\nwhere the 'cx' attribute is a percentage value. To get that to return the correct value we will either need to reflow synchronously under the setAttribute, or else flush the pending reflow under the .value getter.\n\nReflowing under the setAttribute doesn't seem to be too desirable since it will in some cases mean we do more reflows than necessary. Flushing reflow when necessary under the .value getter is slightly concerning in that it means we could reflow under a SMIL sample (as pointed out by Brian on IRC). It's definitely bad to flush reflow under a paint, but is in bad under a SMIL sample?", "count": 1, "author": "jwatt@jwatt.org", "tags": [], "bug_id": 627594, "attachment_id": null, "time": "2011-02-01T02:48:45Z", "id": 5241791, "text": "So basically what we have is:\n\n  document.documentElement.setAttribute('width', '...');\n  var val = childCircle.cx.baseValue.value;\n\nwhere the 'cx' attribute is a percentage value. To get that to return the correct value we will either need to reflow synchronously under the setAttribute, or else flush the pending reflow under the .value getter.\n\nReflowing under the setAttribute doesn't seem to be too desirable since it will in some cases mean we do more reflows than necessary. Flushing reflow when necessary under the .value getter is slightly concerning in that it means we could reflow under a SMIL sample (as pointed out by Brian on IRC). It's definitely bad to flush reflow under a paint, but is in bad under a SMIL sample?", "is_private": false, "creator": "jwatt@jwatt.org", "creation_time": "2011-02-01T02:48:45Z"}]}}}