{"bugs": {"662096": {"comments": [{"bug_id": 662096, "id": 5513622, "is_private": false, "creation_time": "2011-06-04T22:39:23Z", "creator": "kairo@kairo.at", "author": "kairo@kairo.at", "text": "To be able to fix bug 633715 correctly in SeaMonkey, we need to get Data Manager off of using the callback on switchToTabHavingURI - and I have a variant working on my add-on version now that does that, using observer notifications.", "count": 0, "tags": [], "time": "2011-06-04T22:39:23Z", "attachment_id": null, "raw_text": "To be able to fix bug 633715 correctly in SeaMonkey, we need to get Data Manager off of using the callback on switchToTabHavingURI - and I have a variant working on my add-on version now that does that, using observer notifications."}, {"time": "2011-06-05T00:04:05Z", "raw_text": "Here's a patch that does it, using observer notifications to communicate between the browser and the Data Manager.\nThis also contains a test fix, as once I had done the changes, I couldn't get the test to run cleanly - it ended up calling the next view via toDataManager() when the last one hadn't shut down yet. I fixed that with having another notification be sent when shutting down and catching that before trying to launch another one.", "attachment_id": 537394, "tags": [], "creator": "kairo@kairo.at", "count": 1, "text": "Created attachment 537394\nv1: use notifiers to communicate\n\nHere's a patch that does it, using observer notifications to communicate between the browser and the Data Manager.\nThis also contains a test fix, as once I had done the changes, I couldn't get the test to run cleanly - it ended up calling the next view via toDataManager() when the last one hadn't shut down yet. I fixed that with having another notification be sent when shutting down and catching that before trying to launch another one.", "author": "kairo@kairo.at", "bug_id": 662096, "id": 5513684, "creation_time": "2011-06-05T00:04:05Z", "is_private": false}, {"tags": [], "time": "2011-06-09T20:09:07Z", "attachment_id": 537394, "raw_text": "I think Neil has a better understanding on how observers work and whether there is a simpler way of doing this, so passing review request across.", "id": 5523135, "bug_id": 662096, "creation_time": "2011-06-09T20:09:07Z", "is_private": false, "creator": "iannbugzilla@gmail.com", "author": "iannbugzilla@gmail.com", "count": 2, "text": "Comment on attachment 537394\nv1: use notifiers to communicate\n\nI think Neil has a better understanding on how observers work and whether there is a simpler way of doing this, so passing review request across."}, {"author": "neil@httl.net", "count": 3, "text": "Comment on attachment 537394\nv1: use notifiers to communicate\n\n>+    Services.obs.notifyObservers(window, \"dataman-exists\", \"\");\n>+    Services.obs.addObserver(this, \"dataman-exist-request\", false);\nCorrect is to only notify dataman-exists when requested.\n\n>+  Services.obs.addObserver(function loadview(aSubject, aTopic, aData) {\n>+    Services.obs.notifyObservers(null, \"dataman-loadview\", aView);\n>+    Services.obs.removeObserver(loadview, \"dataman-exists\");\n>+  }, \"dataman-exists\", false);\n>+  Services.obs.notifyObservers(null, \"dataman-exist-request\", \"\");\nThe point of the ping-pong protocol used by the Add-on Manager is to find the \"nearest\" tab that already has about:addons loaded (although it occurs to me that it doesn't seem to favour the current tab which perhaps it should). If you're not going to do that then there's no point implementing the ping-pong. In fact this code is worse because if the data manager is open in multiple tabs it will cause each of them to switch view once per open instance.\n\n>+  switchToTabHavingURI(\"about:data\", true);\nNo view gets selected in this case...", "creator": "neil@httl.net", "is_private": false, "creation_time": "2011-06-12T16:39:41Z", "bug_id": 662096, "id": 5527713, "attachment_id": 537394, "raw_text": ">+    Services.obs.notifyObservers(window, \"dataman-exists\", \"\");\n>+    Services.obs.addObserver(this, \"dataman-exist-request\", false);\nCorrect is to only notify dataman-exists when requested.\n\n>+  Services.obs.addObserver(function loadview(aSubject, aTopic, aData) {\n>+    Services.obs.notifyObservers(null, \"dataman-loadview\", aView);\n>+    Services.obs.removeObserver(loadview, \"dataman-exists\");\n>+  }, \"dataman-exists\", false);\n>+  Services.obs.notifyObservers(null, \"dataman-exist-request\", \"\");\nThe point of the ping-pong protocol used by the Add-on Manager is to find the \"nearest\" tab that already has about:addons loaded (although it occurs to me that it doesn't seem to favour the current tab which perhaps it should). If you're not going to do that then there's no point implementing the ping-pong. In fact this code is worse because if the data manager is open in multiple tabs it will cause each of them to switch view once per open instance.\n\n>+  switchToTabHavingURI(\"about:data\", true);\nNo view gets selected in this case...", "time": "2011-06-12T16:39:41Z", "tags": []}, {"creation_time": "2011-08-06T21:43:45Z", "is_private": false, "bug_id": 662096, "id": 5637811, "author": "kairo@kairo.at", "count": 4, "text": "(In reply to neil@parkwaycc.co.uk from comment #3)\n> >+    Services.obs.notifyObservers(window, \"dataman-exists\", \"\");\n> >+    Services.obs.addObserver(this, \"dataman-exist-request\", false);\n> Correct is to only notify dataman-exists when requested.\n\nBut then we would never notify if a new Data Manager tab is opened - see below.\n\n> If you're not going to do that then there's no point implementing\n> the ping-pong.\n\nThen what should I do instead?\n\n> In fact this code is worse because if the data manager is\n> open in multiple tabs it will cause each of them to switch view once per\n> open instance.\n\nAnd why is that a problem? That only happens if a user forces it in some way by manually entering about:data in the url bar - we never open multiple dataman instances ourselves.\n\n> >+  switchToTabHavingURI(\"about:data\", true);\n> No view gets selected in this case...\n\nBut it does. At least in the automated and manual tests.", "creator": "kairo@kairo.at", "tags": [], "attachment_id": null, "raw_text": "(In reply to neil@parkwaycc.co.uk from comment #3)\n> >+    Services.obs.notifyObservers(window, \"dataman-exists\", \"\");\n> >+    Services.obs.addObserver(this, \"dataman-exist-request\", false);\n> Correct is to only notify dataman-exists when requested.\n\nBut then we would never notify if a new Data Manager tab is opened - see below.\n\n> If you're not going to do that then there's no point implementing\n> the ping-pong.\n\nThen what should I do instead?\n\n> In fact this code is worse because if the data manager is\n> open in multiple tabs it will cause each of them to switch view once per\n> open instance.\n\nAnd why is that a problem? That only happens if a user forces it in some way by manually entering about:data in the url bar - we never open multiple dataman instances ourselves.\n\n> >+  switchToTabHavingURI(\"about:data\", true);\n> No view gets selected in this case...\n\nBut it does. At least in the automated and manual tests.", "time": "2011-08-06T21:43:45Z"}, {"attachment_id": null, "raw_text": "Unassigning myself, I'm not working on Data Manager any more.", "time": "2016-01-13T15:15:01Z", "tags": [], "author": "kairo@kairo.at", "text": "Unassigning myself, I'm not working on Data Manager any more.", "count": 5, "creator": "kairo@kairo.at", "creation_time": "2016-01-13T15:15:01Z", "is_private": false, "id": 11072549, "bug_id": 662096}]}}, "comments": {}}