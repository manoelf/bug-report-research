{"bugs": {"1637292": {"comments": [{"tags": [], "creator": "jklukas@mozilla.com", "time": "2020-05-12T15:38:11Z", "raw_text": "We saw yesterday that we are getting some pings with document types like the following:\n\n```\nhealth'\nhealth]]>><\nhealth\"\nevent]]>><\n```\n\nWe were expecting these to fail with `SchemaNotFoundException` but these are making it further in the pipeline and instead failing as `DuplicateIdException`.", "creation_time": "2020-05-12T15:38:11Z", "count": 0, "bug_id": 1637292, "is_private": false, "attachment_id": null, "author": "jklukas@mozilla.com", "id": 14814445, "text": "We saw yesterday that we are getting some pings with document types like the following:\n\n```\nhealth'\nhealth]]>><\nhealth\"\nevent]]>><\n```\n\nWe were expecting these to fail with `SchemaNotFoundException` but these are making it further in the pipeline and instead failing as `DuplicateIdException`."}, {"bug_id": 1637292, "is_private": false, "author": "jklukas@mozilla.com", "id": 14814462, "attachment_id": null, "text": "Looking more carefully at how we check schema existence, it looks like [the `docTypeExists` method normalizes namespace and doctype before performing the lookup](https://github.com/mozilla/gcp-ingestion/blob/7454ddada7a9ad8032b1849ee1e8fa5aa9d6afbe/ingestion-core/src/main/java/com/mozilla/telemetry/ingestion/core/schema/SchemaStore.java#L61-L70) which is intended mostly to handle making sure we can handle both `_` and `-` interchangeably. But it looks like it strips trailing punctuation, so the variants above all get normalized to real ping names, so they're valid.\n\nThis is probably fine and not worth changing the behavior. It does reveal some sloppiness about how we handle casing variants (`SchemaStore` indexes everything with the normalized snake-case names, even though the original files are required to have proper kebab-case names in their paths).", "tags": [], "time": "2020-05-12T15:45:17Z", "creator": "jklukas@mozilla.com", "raw_text": "Looking more carefully at how we check schema existence, it looks like [the `docTypeExists` method normalizes namespace and doctype before performing the lookup](https://github.com/mozilla/gcp-ingestion/blob/7454ddada7a9ad8032b1849ee1e8fa5aa9d6afbe/ingestion-core/src/main/java/com/mozilla/telemetry/ingestion/core/schema/SchemaStore.java#L61-L70) which is intended mostly to handle making sure we can handle both `_` and `-` interchangeably. But it looks like it strips trailing punctuation, so the variants above all get normalized to real ping names, so they're valid.\n\nThis is probably fine and not worth changing the behavior. It does reveal some sloppiness about how we handle casing variants (`SchemaStore` indexes everything with the normalized snake-case names, even though the original files are required to have proper kebab-case names in their paths).", "count": 1, "creation_time": "2020-05-12T15:45:17Z"}]}}, "comments": {}}