{"comments": {}, "bugs": {"1638233": {"comments": [{"attachment_id": 9149249, "creator": "asdfghrbljzmkd@outlook.com", "creation_time": "2020-05-15T04:44:34Z", "text": "Created attachment 9149249\nDark theme\n\nUser Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\n\nSteps to reproduce:\n\nLaunched TB 77 Beta with a fresh profile, and added one of my email addresses.\n\nSystem is Xubuntu 20.04, tested with Adwaita/Adwaita Dark themes.\n\n\nActual results:\n\nIcons in side pane are barely visible (dark blue on black)\n\n\nExpected results:\n\nIcons should be visible (maybe light blue for dark systems themes?)\n\nUnrelated, but not sure if it's worth a new bug report or if it's already known, but the color in the active tab is missing until you switch tabs.", "id": 14821926, "time": "2020-05-15T04:44:34Z", "raw_text": "User Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\n\nSteps to reproduce:\n\nLaunched TB 77 Beta with a fresh profile, and added one of my email addresses.\n\nSystem is Xubuntu 20.04, tested with Adwaita/Adwaita Dark themes.\n\n\nActual results:\n\nIcons in side pane are barely visible (dark blue on black)\n\n\nExpected results:\n\nIcons should be visible (maybe light blue for dark systems themes?)\n\nUnrelated, but not sure if it's worth a new bug report or if it's already known, but the color in the active tab is missing until you switch tabs.", "is_private": false, "count": 0, "tags": ["str"], "bug_id": 1638233, "author": "asdfghrbljzmkd@outlook.com"}, {"time": "2020-05-15T04:45:27Z", "raw_text": "Image of light theme (icons are visible).", "is_private": false, "count": 1, "bug_id": 1638233, "tags": [], "author": "asdfghrbljzmkd@outlook.com", "attachment_id": 9149250, "creator": "asdfghrbljzmkd@outlook.com", "creation_time": "2020-05-15T04:45:27Z", "text": "Created attachment 9149250\nLight theme (icons are visible)\n\nImage of light theme (icons are visible).", "id": 14821928}, {"bug_id": 1638233, "tags": [], "is_private": false, "count": 2, "author": "asdfghrbljzmkd@outlook.com", "time": "2020-05-15T04:50:08Z", "raw_text": "", "text": "Created attachment 9149251\nTab showing color after switching active tab once", "id": 14821929, "attachment_id": 9149251, "creator": "asdfghrbljzmkd@outlook.com", "creation_time": "2020-05-15T04:50:08Z"}, {"bug_id": 1638233, "tags": [], "count": 3, "is_private": false, "author": "richard.marti@gmail.com", "time": "2020-06-08T13:41:36Z", "raw_text": "This comes from https://searchfox.org/comm-central/rev/af886b93f1a520cb98cb6c0e3eda612a1caf2560/mail/themes/shared/mail/folderPane.css#6. It's a light black colour for light backgrounds. But Linux themes and Windows high contrast themes can have dark backgrounds without trigger [lwt-tree-brighttext]. I think we should only use a opacity here to make the icons less dark/light.\n\nWhat do you think, Alessandro?", "text": "This comes from https://searchfox.org/comm-central/rev/af886b93f1a520cb98cb6c0e3eda612a1caf2560/mail/themes/shared/mail/folderPane.css#6. It's a light black colour for light backgrounds. But Linux themes and Windows high contrast themes can have dark backgrounds without trigger [lwt-tree-brighttext]. I think we should only use a opacity here to make the icons less dark/light.\n\nWhat do you think, Alessandro?", "id": 14869428, "creator": "richard.marti@gmail.com", "attachment_id": null, "creation_time": "2020-06-08T13:41:36Z"}, {"creator": "alessandro@thunderbird.net", "attachment_id": null, "creation_time": "2020-06-08T17:11:47Z", "id": 14869976, "text": "> I think we should only use a opacity here to make the icons less dark/light.\n\nI'm not sure that would be a good solution as we risk to lose too much contrast and the user won't be able to use the colors he wants with a fixed imposed opacity below 0.8\n\nHow are we handling the text color? Can we implement CSS variations in order to cover every scenario?", "time": "2020-06-08T17:11:47Z", "raw_text": "> I think we should only use a opacity here to make the icons less dark/light.\n\nI'm not sure that would be a good solution as we risk to lose too much contrast and the user won't be able to use the colors he wants with a fixed imposed opacity below 0.8\n\nHow are we handling the text color? Can we implement CSS variations in order to cover every scenario?", "tags": [], "bug_id": 1638233, "is_private": false, "count": 4, "author": "alessandro@thunderbird.net"}, {"raw_text": "We use on trees the system colour `-moz-FieldText`.", "time": "2020-06-08T17:19:48Z", "author": "richard.marti@gmail.com", "bug_id": 1638233, "tags": [], "is_private": false, "count": 5, "creation_time": "2020-06-08T17:19:48Z", "attachment_id": null, "creator": "richard.marti@gmail.com", "id": 14869994, "text": "We use on trees the system colour `-moz-FieldText`."}, {"id": 14870005, "text": "On toolbars we detect the text colour through toolbarIconColor.js. Maybe something similar could be possible for the tree.", "creation_time": "2020-06-08T17:25:03Z", "attachment_id": null, "creator": "richard.marti@gmail.com", "author": "richard.marti@gmail.com", "tags": [], "bug_id": 1638233, "count": 6, "is_private": false, "raw_text": "On toolbars we detect the text colour through toolbarIconColor.js. Maybe something similar could be possible for the tree.", "time": "2020-06-08T17:25:03Z"}, {"raw_text": "I see that the status of this bug is still unconfirmed. I can confirm that this bug still exist in Thunderbird 78.0 on Linux (Ubuntu with Adwaita dark).", "time": "2020-07-20T22:15:37Z", "author": "madsrh@gmail.com", "bug_id": 1638233, "tags": [], "count": 7, "is_private": false, "creation_time": "2020-07-20T22:15:37Z", "creator": "madsrh@gmail.com", "attachment_id": null, "text": "I see that the status of this bug is still unconfirmed. I can confirm that this bug still exist in Thunderbird 78.0 on Linux (Ubuntu with Adwaita dark).", "id": 14947627}, {"raw_text": "Richard, is this something you might be able to tackle?", "time": "2020-07-20T22:23:07Z", "author": "alessandro@thunderbird.net", "tags": [], "bug_id": 1638233, "is_private": false, "count": 8, "creation_time": "2020-07-20T22:23:07Z", "creator": "alessandro@thunderbird.net", "attachment_id": null, "id": 14947635, "text": "Richard, is this something you might be able to tackle?"}, {"id": 14949610, "text": "*** Bug 1654352 has been marked as a duplicate of this bug. ***", "creator": "richard.marti@gmail.com", "attachment_id": null, "creation_time": "2020-07-21T18:44:11Z", "count": 9, "is_private": false, "bug_id": 1638233, "tags": [], "author": "richard.marti@gmail.com", "time": "2020-07-21T18:44:11Z", "raw_text": ""}, {"creation_time": "2020-07-23T18:33:12Z", "creator": "richard.marti@gmail.com", "attachment_id": null, "id": 14953514, "text": "I tried it but wasn't successful.", "raw_text": "I tried it but wasn't successful.", "time": "2020-07-23T18:33:12Z", "author": "richard.marti@gmail.com", "tags": [], "bug_id": 1638233, "count": 10, "is_private": false}, {"author": "alessandro@thunderbird.net", "count": 11, "is_private": false, "tags": [], "bug_id": 1638233, "raw_text": "I'll get a stab at this.", "time": "2020-07-23T18:50:05Z", "text": "I'll get a stab at this.", "id": 14953537, "creation_time": "2020-07-23T18:50:05Z", "creator": "alessandro@thunderbird.net", "attachment_id": null}, {"id": 14954082, "text": "Created attachment 9165800\nScreenshot from 2020-07-23 17-22-53.png\n\nThe issue goes a little bit deeper as also some parts of the calendar are not properly styled.\n\nThe quick solution would be to tell the user to go to the Add-ons section and select the dark theme, but we should that automatically.\nI have a dirty patch we could use as a starting point, which tackles also bug 1592210.", "creator": "alessandro@thunderbird.net", "attachment_id": 9165800, "creation_time": "2020-07-24T00:30:18Z", "is_private": false, "count": 12, "bug_id": 1638233, "tags": [], "author": "alessandro@thunderbird.net", "time": "2020-07-24T00:30:18Z", "raw_text": "The issue goes a little bit deeper as also some parts of the calendar are not properly styled.\n\nThe quick solution would be to tell the user to go to the Add-ons section and select the dark theme, but we should that automatically.\nI have a dirty patch we could use as a starting point, which tackles also bug 1592210."}, {"text": "Created attachment 9165802\n1638233-folders-dark.diff\n\nThis is more a proof of concept than an actual patch.\n\nWe currently have a method in the `ThemeVariableMap.jsm` which runs at startup and whenever a theme is changed.\nhttps://searchfox.org/comm-central/rev/eb69eff3ca16509af6cf8f2dd29be396bebbc14d/mail/base/modules/ThemeVariableMap.jsm#162\n\nWe could use it and check for the colour contrast of the first toolbar we pick.\nThere's a small problem sometimes where the method runs before the entire UI switched back to light, therefore failing the contrast check and still returning a dark UI.\n\nI think, and this is just speculation, that we might improve this approach by forcing a theme switch to the dark variation in case the user has the default theme selected, in order to cover these scenarios:\n\n- The OS has a dark theme -> the theme is on default (not edited by the user) -> we add the `brighttext` attribute and the `ui.systemUsesDarkTheme`.\n- The OS has a dark theme -> the theme is not default (edited by the user) -> we don't do anything.\n- The user switches from default to dark -> we add the `brighttext` attribute and the `ui.systemUsesDarkTheme`.\n\nThoughts?\n\nP.S.: I noticed that the observer in the `toolbarIconColor.js` basically runs on every window interaction (clicks, window drag, resize, etc.). We should look into that and limit it as I don't think that's good for performance.", "id": 14954088, "creation_time": "2020-07-24T00:52:26Z", "attachment_id": 9165802, "creator": "alessandro@thunderbird.net", "author": "alessandro@thunderbird.net", "is_private": false, "count": 13, "tags": [], "bug_id": 1638233, "raw_text": "This is more a proof of concept than an actual patch.\n\nWe currently have a method in the `ThemeVariableMap.jsm` which runs at startup and whenever a theme is changed.\nhttps://searchfox.org/comm-central/rev/eb69eff3ca16509af6cf8f2dd29be396bebbc14d/mail/base/modules/ThemeVariableMap.jsm#162\n\nWe could use it and check for the colour contrast of the first toolbar we pick.\nThere's a small problem sometimes where the method runs before the entire UI switched back to light, therefore failing the contrast check and still returning a dark UI.\n\nI think, and this is just speculation, that we might improve this approach by forcing a theme switch to the dark variation in case the user has the default theme selected, in order to cover these scenarios:\n\n- The OS has a dark theme -> the theme is on default (not edited by the user) -> we add the `brighttext` attribute and the `ui.systemUsesDarkTheme`.\n- The OS has a dark theme -> the theme is not default (edited by the user) -> we don't do anything.\n- The user switches from default to dark -> we add the `brighttext` attribute and the `ui.systemUsesDarkTheme`.\n\nThoughts?\n\nP.S.: I noticed that the observer in the `toolbarIconColor.js` basically runs on every window interaction (clicks, window drag, resize, etc.). We should look into that and limit it as I don't think that's good for performance.", "time": "2020-07-24T00:52:26Z"}, {"raw_text": "Great that it changes the ui.systemUsesDarkTheme depending on the theme.\n\nBut there are issues:\n- with the default Ubuntu theme, which has dark menu/tab toolbars but the rest light, it uses the dark setting.\n- opening the AB or the Composer shows errors and it resets to light.", "time": "2020-07-24T09:39:10Z", "author": "richard.marti@gmail.com", "bug_id": 1638233, "tags": [], "is_private": false, "count": 14, "creation_time": "2020-07-24T09:39:10Z", "creator": "richard.marti@gmail.com", "attachment_id": 9165802, "id": 14954512, "text": "Comment on attachment 9165802\n1638233-folders-dark.diff\n\nGreat that it changes the ui.systemUsesDarkTheme depending on the theme.\n\nBut there are issues:\n- with the default Ubuntu theme, which has dark menu/tab toolbars but the rest light, it uses the dark setting.\n- opening the AB or the Composer shows errors and it resets to light."}, {"creation_time": "2020-07-24T18:25:13Z", "raw_text": "> with the default Ubuntu theme, which has dark menu/tab toolbars but the rest light, it uses the dark setting.\n\nWe need an element that we can safely use to detect the color, do you have anything in mind?\n\n> opening the AB or the Composer shows errors and it resets to light.\n\nAh, I guess that method runs for every new window that is opened, which it shouldn't. Could we detect if we're dealing with the main window or a dialog?", "creator": "alessandro@thunderbird.net", "attachment_id": null, "time": "2020-07-24T18:25:13Z", "id": 14955296, "text": "> with the default Ubuntu theme, which has dark menu/tab toolbars but the rest light, it uses the dark setting.\n\nWe need an element that we can safely use to detect the color, do you have anything in mind?\n\n> opening the AB or the Composer shows errors and it resets to light.\n\nAh, I guess that method runs for every new window that is opened, which it shouldn't. Could we detect if we're dealing with the main window or a dialog?", "author": "alessandro@thunderbird.net", "is_private": false, "count": 15, "bug_id": 1638233, "tags": []}, {"time": "2020-07-24T21:09:58Z", "raw_text": "(In reply to Alessandro Castellani (:aleca) from comment #15)\n> > with the default Ubuntu theme, which has dark menu/tab toolbars but the rest light, it uses the dark setting.\n> \n> We need an element that we can safely use to detect the color, do you have anything in mind?\n\nMaybe we should use the #folderTree. Check a toolbar text colour could be dangerous because when a dark LW-theme is active, the toolbar text could be light but the normal TB content uses still black text. The only toolbar we could use would be the #folderPane-toolbar but this isn't always shown. Also the window itself can't be used because of the LW-themes applying to it.", "bug_id": 1638233, "tags": [], "count": 16, "is_private": false, "author": "richard.marti@gmail.com", "creator": "richard.marti@gmail.com", "attachment_id": null, "creation_time": "2020-07-24T21:09:58Z", "text": "(In reply to Alessandro Castellani (:aleca) from comment #15)\n> > with the default Ubuntu theme, which has dark menu/tab toolbars but the rest light, it uses the dark setting.\n> \n> We need an element that we can safely use to detect the color, do you have anything in mind?\n\nMaybe we should use the #folderTree. Check a toolbar text colour could be dangerous because when a dark LW-theme is active, the toolbar text could be light but the normal TB content uses still black text. The only toolbar we could use would be the #folderPane-toolbar but this isn't always shown. Also the window itself can't be used because of the LW-themes applying to it.", "id": 14955555}, {"bug_id": 1638233, "tags": [], "is_private": false, "count": 17, "author": "alessandro@thunderbird.net", "time": "2020-07-27T18:57:35Z", "raw_text": "Here's another try for this.\nI did a bunch of changes, so here's a recap of the reasons why I implemented those things:\n\n**Remove extra calls**\nI explored the code a bit more thoroughly and discovered that the `inferFromText()` was getting called multiple times.\nFrom here: https://searchfox.org/mozilla-central/rev/c6676771df58c6e0098574bc6b11517acbf264cf/toolkit/components/extensions/parent/ext-theme.js#398\nAnd here: https://searchfox.org/comm-central/rev/caacc41c6d79e8e4015698bd23a60dbc5a957f1c/mail/base/content/msgMail3PaneWindow.js#2004\n\nIf I'm not wrong, all those calls are not necessary since we're relying on the `\"lightweight-theme-styling-update\"` observer triggered from the `ext-theme.js`.\nI removed the extra call and I don't see any UI regression, but I might have missed something.\n\n**Prevent unnecessary attribute changes**\nThe `inferFromText()` method runs a lot, like at every click, move, resize, or window opening, and it runs 2 or 3 times for every call (I'm still trying to understand why and if I can prevent that).\nI implemented a  `kCurrentColor` variable to store the most recent color from the main tabmail. If that color didn't change since the last time we called this method, I don't thing we should run it again because, hopefully, nothing changed and we don't need to update the attributes on all our toolbars.\n\n**Switching to `ui.systemUsesDarkTheme`**\nI'm using the `ThemeVariableMap.jsm` to detect the current color and update the attributes accordingly.\nThe `processColor()` method runs only at startup, or when a new window is opened, so if the user changes the OS theme to a dark theme, he'll need to restart TB to see all the changes properly applying.\n\nThis is not necessary if the user changes the TB built-in theme to Dark, fixing bug 1592210.\n\nLet me know if you find anything sketchy, or if the performance gets affected by these changes.", "text": "Created attachment 9166371\n1638233-folders-dark.diff\n\nHere's another try for this.\nI did a bunch of changes, so here's a recap of the reasons why I implemented those things:\n\n**Remove extra calls**\nI explored the code a bit more thoroughly and discovered that the `inferFromText()` was getting called multiple times.\nFrom here: https://searchfox.org/mozilla-central/rev/c6676771df58c6e0098574bc6b11517acbf264cf/toolkit/components/extensions/parent/ext-theme.js#398\nAnd here: https://searchfox.org/comm-central/rev/caacc41c6d79e8e4015698bd23a60dbc5a957f1c/mail/base/content/msgMail3PaneWindow.js#2004\n\nIf I'm not wrong, all those calls are not necessary since we're relying on the `\"lightweight-theme-styling-update\"` observer triggered from the `ext-theme.js`.\nI removed the extra call and I don't see any UI regression, but I might have missed something.\n\n**Prevent unnecessary attribute changes**\nThe `inferFromText()` method runs a lot, like at every click, move, resize, or window opening, and it runs 2 or 3 times for every call (I'm still trying to understand why and if I can prevent that).\nI implemented a  `kCurrentColor` variable to store the most recent color from the main tabmail. If that color didn't change since the last time we called this method, I don't thing we should run it again because, hopefully, nothing changed and we don't need to update the attributes on all our toolbars.\n\n**Switching to `ui.systemUsesDarkTheme`**\nI'm using the `ThemeVariableMap.jsm` to detect the current color and update the attributes accordingly.\nThe `processColor()` method runs only at startup, or when a new window is opened, so if the user changes the OS theme to a dark theme, he'll need to restart TB to see all the changes properly applying.\n\nThis is not necessary if the user changes the TB built-in theme to Dark, fixing bug 1592210.\n\nLet me know if you find anything sketchy, or if the performance gets affected by these changes.", "id": 14959082, "creator": "alessandro@thunderbird.net", "attachment_id": 9166371, "creation_time": "2020-07-27T18:57:35Z"}, {"raw_text": "Work very good except when changing from a dark/light theme to a LW-theme. Then it uses the `ui.systemUsesDarkTheme` that the other theme has set before and not the system default. After a TB restart it's correct again.\n\nAnd when I change under Linux the system theme from bright to dark, the colours change but not `ui.systemUsesDarkTheme`.", "creation_time": "2020-07-27T20:38:19Z", "attachment_id": 9166371, "creator": "richard.marti@gmail.com", "time": "2020-07-27T20:38:19Z", "id": 14959257, "text": "Comment on attachment 9166371\n1638233-folders-dark.diff\n\nWork very good except when changing from a dark/light theme to a LW-theme. Then it uses the `ui.systemUsesDarkTheme` that the other theme has set before and not the system default. After a TB restart it's correct again.\n\nAnd when I change under Linux the system theme from bright to dark, the colours change but not `ui.systemUsesDarkTheme`.", "author": "richard.marti@gmail.com", "is_private": false, "count": 18, "tags": [], "bug_id": 1638233}, {"time": "2020-07-27T20:58:43Z", "raw_text": "Yeah, that's a limitation of this implementation, as I wrote in comment 17:\n> if the user changes the OS theme to a dark theme, he'll need to restart TB to see all the changes properly applying.\n\nI'm not sure if I can find a way to let it update dynamically without restart and without hogging the performance.", "count": 19, "is_private": false, "tags": [], "bug_id": 1638233, "author": "alessandro@thunderbird.net", "attachment_id": null, "creator": "alessandro@thunderbird.net", "creation_time": "2020-07-27T20:58:43Z", "id": 14959288, "text": "Yeah, that's a limitation of this implementation, as I wrote in comment 17:\n> if the user changes the OS theme to a dark theme, he'll need to restart TB to see all the changes properly applying.\n\nI'm not sure if I can find a way to let it update dynamically without restart and without hogging the performance."}, {"text": "It's not so bad when a restart is needed. I don't think, changing the system theme is a regularly thing the user does.", "id": 14959298, "attachment_id": null, "creator": "richard.marti@gmail.com", "creation_time": "2020-07-27T21:04:17Z", "tags": [], "bug_id": 1638233, "is_private": false, "count": 20, "author": "richard.marti@gmail.com", "time": "2020-07-27T21:04:17Z", "raw_text": "It's not so bad when a restart is needed. I don't think, changing the system theme is a regularly thing the user does."}, {"text": "Comment on attachment 9166371\n1638233-folders-dark.diff\n\nReview of attachment 9166371:\n-----------------------------------------------------------------\n\nThis change looks okay to me, although my understanding of the code around it is a bit limited.\n\n::: mail/base/modules/ThemeVariableMap.jsm\n@@ +175,5 @@\n> +          if (!tabmail) {\n> +            return null;\n> +          }\n> +\n> +          let rgb = element.ownerDocument.ownerGlobal[0]\n\nThis is weird.\n\n1. You should probably use `tabmail` instead of `element`, although that would be the same because we know they're in the same document.\n2. `.ownerDocument.ownerGlobal` is the same as just `.ownerGlobal`.\n3. The `[0]` means you're actually using a *different* window from the one containing tabmail \u2013 the content of the first iframe inside it. I'm a little surprised that works.", "id": 14960032, "attachment_id": 9166371, "creator": "geoff@thunderbird.net", "creation_time": "2020-07-28T10:32:22Z", "tags": [], "bug_id": 1638233, "is_private": false, "count": 21, "author": "geoff@thunderbird.net", "time": "2020-07-28T10:32:22Z", "raw_text": "Review of attachment 9166371:\n-----------------------------------------------------------------\n\nThis change looks okay to me, although my understanding of the code around it is a bit limited.\n\n::: mail/base/modules/ThemeVariableMap.jsm\n@@ +175,5 @@\n> +          if (!tabmail) {\n> +            return null;\n> +          }\n> +\n> +          let rgb = element.ownerDocument.ownerGlobal[0]\n\nThis is weird.\n\n1. You should probably use `tabmail` instead of `element`, although that would be the same because we know they're in the same document.\n2. `.ownerDocument.ownerGlobal` is the same as just `.ownerGlobal`.\n3. The `[0]` means you're actually using a *different* window from the one containing tabmail \u2013 the content of the first iframe inside it. I'm a little surprised that works."}, {"id": 14961165, "text": "Created attachment 9166660\n1638233-folders-dark.diff\n\nThanks for the review.\nI still have 1 issue I'm not sure how to solve.\n\nSwitching from the built-in TB dark theme to default, doesn't properly update the `ui.systemUsesDarkTheme`, since the UI colors are updated slightly after the `processColor()` finished running, so it still detects the previous color scheme.\nI'm not sure this is an acceptable behaviour.\n\nThe theme fixes itself after a restart.", "creation_time": "2020-07-28T19:58:37Z", "attachment_id": 9166660, "creator": "alessandro@thunderbird.net", "author": "alessandro@thunderbird.net", "tags": [], "bug_id": 1638233, "count": 22, "is_private": false, "raw_text": "Thanks for the review.\nI still have 1 issue I'm not sure how to solve.\n\nSwitching from the built-in TB dark theme to default, doesn't properly update the `ui.systemUsesDarkTheme`, since the UI colors are updated slightly after the `processColor()` finished running, so it still detects the previous color scheme.\nI'm not sure this is an acceptable behaviour.\n\nThe theme fixes itself after a restart.", "time": "2020-07-28T19:58:37Z"}, {"id": 14961805, "text": "Comment on attachment 9166660\n1638233-folders-dark.diff\n\nI think, we can go with this because it is already a big improvement and deal with this issue in a follow-up bug. It would be great when we can eliminate the issue. A workaround would be when going from dark theme to default to use the light theme and then switch to default theme.", "attachment_id": 9166660, "creator": "richard.marti@gmail.com", "creation_time": "2020-07-29T08:24:23Z", "is_private": false, "count": 23, "tags": [], "bug_id": 1638233, "author": "richard.marti@gmail.com", "time": "2020-07-29T08:24:23Z", "raw_text": "I think, we can go with this because it is already a big improvement and deal with this issue in a follow-up bug. It would be great when we can eliminate the issue. A workaround would be when going from dark theme to default to use the light theme and then switch to default theme."}, {"time": "2020-07-29T09:34:56Z", "raw_text": "(In reply to Alessandro Castellani (:aleca) from comment #22)\n> Switching from the built-in TB dark theme to default, doesn't properly update the `ui.systemUsesDarkTheme`, since the UI colors are updated slightly after the `processColor()` finished running, so it still detects the previous color scheme.\n\nIf I understand correctly, what it boils down to is trying to find the CSS value of `-moz-dialogtext`. Is there some other way to do this? One way would be to find an element or property that doesn't change with the theme, but there may be some less hacky way.\n\n(In reply to Richard Marti (:Paenglab) from comment #23)\n> A workaround would be when going from dark theme to\n> default to use the light theme and then switch to default theme.\n\nI think this effectively happens if you disable the current theme to go back to the default, as opposed to enabling the default. Which is a bit weird and probably not at all useful, but I thought I'd mention it.", "count": 24, "is_private": false, "bug_id": 1638233, "tags": [], "author": "geoff@thunderbird.net", "creator": "geoff@thunderbird.net", "attachment_id": null, "creation_time": "2020-07-29T09:34:56Z", "id": 14961867, "text": "(In reply to Alessandro Castellani (:aleca) from comment #22)\n> Switching from the built-in TB dark theme to default, doesn't properly update the `ui.systemUsesDarkTheme`, since the UI colors are updated slightly after the `processColor()` finished running, so it still detects the previous color scheme.\n\nIf I understand correctly, what it boils down to is trying to find the CSS value of `-moz-dialogtext`. Is there some other way to do this? One way would be to find an element or property that doesn't change with the theme, but there may be some less hacky way.\n\n(In reply to Richard Marti (:Paenglab) from comment #23)\n> A workaround would be when going from dark theme to\n> default to use the light theme and then switch to default theme.\n\nI think this effectively happens if you disable the current theme to go back to the default, as opposed to enabling the default. Which is a bit weird and probably not at all useful, but I thought I'd mention it."}, {"creator": "geoff@thunderbird.net", "attachment_id": 9166660, "time": "2020-07-29T09:35:38Z", "creation_time": "2020-07-29T09:35:38Z", "raw_text": "I agree with Richard. Might as well ship this and tackle the other problem later.", "is_private": false, "count": 25, "bug_id": 1638233, "tags": [], "id": 14961868, "text": "Comment on attachment 9166660\n1638233-folders-dark.diff\n\nI agree with Richard. Might as well ship this and tackle the other problem later.", "author": "geoff@thunderbird.net"}, {"author": "alessandro@thunderbird.net", "count": 26, "is_private": false, "bug_id": 1638233, "tags": [], "raw_text": "", "time": "2020-07-29T16:49:17Z", "id": 14962525, "text": "*** Bug 1592210 has been marked as a duplicate of this bug. ***", "creation_time": "2020-07-29T16:49:17Z", "creator": "alessandro@thunderbird.net", "attachment_id": null}, {"id": 14962529, "text": "All right, thanks for the feedback.\n\n> I think this effectively happens if you disable the current theme to go back to the default.\n\nCorrect, when disabling the dark theme, TB first switches to light and then to default. We could force the same workflow when a user selects default.\n\n> If I understand correctly, what it boils down to is trying to find the CSS value of -moz-dialogtext. Is there some other way to do this? One way would be to find an element or property that doesn't change with the theme, but there may be some less hacky way.\n\nI tried to find a way but I couldn't, probably due to my lack of knowledge of this area.", "creation_time": "2020-07-29T16:51:39Z", "creator": "alessandro@thunderbird.net", "attachment_id": null, "author": "alessandro@thunderbird.net", "tags": [], "bug_id": 1638233, "count": 27, "is_private": false, "raw_text": "All right, thanks for the feedback.\n\n> I think this effectively happens if you disable the current theme to go back to the default.\n\nCorrect, when disabling the dark theme, TB first switches to light and then to default. We could force the same workflow when a user selects default.\n\n> If I understand correctly, what it boils down to is trying to find the CSS value of -moz-dialogtext. Is there some other way to do this? One way would be to find an element or property that doesn't change with the theme, but there may be some less hacky way.\n\nI tried to find a way but I couldn't, probably due to my lack of knowledge of this area.", "time": "2020-07-29T16:51:39Z"}, {"raw_text": "Since this issue affects 78, should we uplift?\nMaybe we should let it sit on beta for a while and keep an eye on for any regression, and use the time to explore improvements.", "time": "2020-07-29T16:52:54Z", "author": "alessandro@thunderbird.net", "is_private": false, "count": 28, "bug_id": 1638233, "tags": [], "creation_time": "2020-07-29T16:52:54Z", "creator": "alessandro@thunderbird.net", "attachment_id": null, "text": "Since this issue affects 78, should we uplift?\nMaybe we should let it sit on beta for a while and keep an eye on for any regression, and use the time to explore improvements.", "id": 14962532}, {"attachment_id": null, "creator": "asdfghrbljzmkd@outlook.com", "creation_time": "2020-07-29T18:13:47Z", "id": 14962656, "text": "IMO this definitely needs uplift as it's a regression from the previous ESR, breaking TB out-of-the-box for many users (myself included).", "time": "2020-07-29T18:13:47Z", "raw_text": "IMO this definitely needs uplift as it's a regression from the previous ESR, breaking TB out-of-the-box for many users (myself included).", "count": 29, "is_private": false, "tags": [], "bug_id": 1638233, "author": "asdfghrbljzmkd@outlook.com"}, {"creator": "alessandro@thunderbird.net", "attachment_id": null, "creation_time": "2020-07-29T18:15:11Z", "text": "As a temporary workaround you can set the Theme to dark, until this patch lands in the next release.", "id": 14962658, "time": "2020-07-29T18:15:11Z", "raw_text": "As a temporary workaround you can set the Theme to dark, until this patch lands in the next release.", "tags": [], "bug_id": 1638233, "is_private": false, "count": 30, "author": "alessandro@thunderbird.net"}, {"id": 14963624, "text": "Pushed by geoff@darktrojan.net:\nhttps://hg.mozilla.org/comm-central/rev/eb5bf594244d\nFix default color of folder icons with Adwaita Dark theme. r=darktrojan", "creation_time": "2020-07-30T10:17:12Z", "attachment_id": null, "creator": "pulsebot@bots.tld", "author": "pulsebot@bots.tld", "tags": [], "bug_id": 1638233, "count": 31, "is_private": false, "raw_text": "Pushed by geoff@darktrojan.net:\nhttps://hg.mozilla.org/comm-central/rev/eb5bf594244d\nFix default color of folder icons with Adwaita Dark theme. r=darktrojan", "time": "2020-07-30T10:17:12Z"}, {"id": 14965465, "text": "*** Bug 1656460 has been marked as a duplicate of this bug. ***", "creator": "richard.marti@gmail.com", "attachment_id": null, "creation_time": "2020-07-31T11:46:41Z", "tags": [], "bug_id": 1638233, "is_private": false, "count": 32, "author": "richard.marti@gmail.com", "time": "2020-07-31T11:46:41Z", "raw_text": ""}, {"bug_id": 1638233, "tags": [], "count": 33, "is_private": false, "author": "mkmelin+mozilla@iki.fi", "time": "2020-08-12T06:46:53Z", "raw_text": "", "text": "*** Bug 1658233 has been marked as a duplicate of this bug. ***", "id": 14985825, "attachment_id": null, "creator": "mkmelin+mozilla@iki.fi", "creation_time": "2020-08-12T06:46:53Z"}, {"creator": "richard.marti@gmail.com", "attachment_id": null, "creation_time": "2020-08-12T20:56:41Z", "text": "Alessandro, do you plan to uplift this bug.", "id": 14986872, "time": "2020-08-12T20:56:41Z", "raw_text": "Alessandro, do you plan to uplift this bug.", "is_private": false, "count": 34, "tags": [], "bug_id": 1638233, "author": "richard.marti@gmail.com"}, {"id": 14987263, "text": "He's away this and next week, but yes we should uplift.", "attachment_id": null, "creator": "mkmelin+mozilla@iki.fi", "creation_time": "2020-08-13T06:22:35Z", "count": 35, "is_private": false, "tags": [], "bug_id": 1638233, "author": "mkmelin+mozilla@iki.fi", "time": "2020-08-13T06:22:35Z", "raw_text": "He's away this and next week, but yes we should uplift."}, {"text": "Comment on attachment 9166660\n1638233-folders-dark.diff\n\n[Approval Request Comment]\nUser impact if declined: some parts of the openpgp UI unreadable, see bug 1658695 too", "id": 14987556, "creation_time": "2020-08-13T11:51:34Z", "attachment_id": 9166660, "creator": "mkmelin+mozilla@iki.fi", "author": "mkmelin+mozilla@iki.fi", "bug_id": 1638233, "tags": [], "count": 36, "is_private": false, "raw_text": "[Approval Request Comment]\nUser impact if declined: some parts of the openpgp UI unreadable, see bug 1658695 too", "time": "2020-08-13T11:51:34Z"}, {"id": 14987560, "text": "*** Bug 1658695 has been marked as a duplicate of this bug. ***", "author": "mkmelin+mozilla@iki.fi", "is_private": false, "count": 37, "bug_id": 1638233, "tags": [], "creation_time": "2020-08-13T11:52:27Z", "raw_text": "", "creator": "mkmelin+mozilla@iki.fi", "attachment_id": null, "time": "2020-08-13T11:52:27Z"}, {"time": "2020-08-13T22:37:04Z", "raw_text": "[Triage Comment]\nApproved for beta\nApproved for esr78 \n\nBecause this hasn't gone through beta - we need this explicitly tested with 78 candidate when it becomes available - will post on tb-planning (CCing some likely suspects)", "bug_id": 1638233, "tags": [], "count": 38, "is_private": false, "author": "vseerror@lehigh.edu", "creator": "vseerror@lehigh.edu", "attachment_id": 9166660, "creation_time": "2020-08-13T22:37:04Z", "text": "Comment on attachment 9166660\n1638233-folders-dark.diff\n\n[Triage Comment]\nApproved for beta\nApproved for esr78 \n\nBecause this hasn't gone through beta - we need this explicitly tested with 78 candidate when it becomes available - will post on tb-planning (CCing some likely suspects)", "id": 14988441}, {"creation_time": "2020-08-13T23:42:04Z", "creator": "rob@thunderbird.net", "attachment_id": null, "id": 14988484, "text": "Thunderbird 78.2.0:\nhttps://hg.mozilla.org/releases/comm-esr78/rev/32f2ba79db84", "raw_text": "Thunderbird 78.2.0:\nhttps://hg.mozilla.org/releases/comm-esr78/rev/32f2ba79db84", "time": "2020-08-13T23:42:04Z", "author": "rob@thunderbird.net", "bug_id": 1638233, "tags": ["bugherder", "uplift"], "is_private": false, "count": 39}, {"author": "rob@thunderbird.net", "tags": ["bugherder", "uplift"], "bug_id": 1638233, "is_private": false, "count": 40, "raw_text": "Thunderbird 80.0b4:\nhttps://hg.mozilla.org/releases/comm-beta/rev/cd54d39be1c8", "time": "2020-08-14T16:20:39Z", "text": "Thunderbird 80.0b4:\nhttps://hg.mozilla.org/releases/comm-beta/rev/cd54d39be1c8", "id": 14989339, "creation_time": "2020-08-14T16:20:39Z", "attachment_id": null, "creator": "rob@thunderbird.net"}, {"time": "2020-08-18T00:49:13Z", "raw_text": "I updated my TB 80.0b3 to 80.0b4 on Ubuntu 18.04.5 LTS with the Adwaita OS theme.\nChanged the TB Dark theme I prefer to the Default theme.\nRestarted Thunderbird.\nOpened Tweaks and changed to the Adwaita Dark theme.\nTB 80.0b4 looked like the reporter's screenshot in the bug description.\nRestarted TB 80.0b4 and all returned to looking good.\n\nI think I was beginning to test this in the release candidate when I discovered the other theme bugs I filed and quit testing.\nWill test again with the 78.2.0 rc.", "is_private": false, "count": 41, "bug_id": 1638233, "tags": [], "author": "wls220spring@gmail.com", "attachment_id": null, "creator": "wls220spring@gmail.com", "creation_time": "2020-08-18T00:49:13Z", "text": "I updated my TB 80.0b3 to 80.0b4 on Ubuntu 18.04.5 LTS with the Adwaita OS theme.\nChanged the TB Dark theme I prefer to the Default theme.\nRestarted Thunderbird.\nOpened Tweaks and changed to the Adwaita Dark theme.\nTB 80.0b4 looked like the reporter's screenshot in the bug description.\nRestarted TB 80.0b4 and all returned to looking good.\n\nI think I was beginning to test this in the release candidate when I discovered the other theme bugs I filed and quit testing.\nWill test again with the 78.2.0 rc.", "id": 14993679}, {"time": "2020-08-18T23:09:32Z", "raw_text": "Dark theme looks OK on the build sent out via the mailing list (about window reports \"78.2.0\"). \nHigh contrast theme looks fine too.\n(This is running under Gnome on Debian, switching the \"Applications\" appearance via gnome-tweaks)\n\nThere was an issue where switching between themes while Thunderbird was running left it a little confused - like the background colours changed, but a bunch of the icons and text seemed wrong.\nWorked fine when you switch themes while thunderbird isn't running.\n\n(all a bit alien to an I3 user like me :-) Themes and desktops are usually just things that happen to other people)\n\nHope this is what you were looking for - let me know if not and I can try some other stuff.", "bug_id": 1638233, "tags": [], "count": 42, "is_private": false, "author": "benc@thunderbird.net", "creator": "benc@thunderbird.net", "attachment_id": 9170817, "creation_time": "2020-08-18T23:09:32Z", "text": "Created attachment 9170817\ndebian-gnome-adwaita-dark.png\n\nDark theme looks OK on the build sent out via the mailing list (about window reports \"78.2.0\"). \nHigh contrast theme looks fine too.\n(This is running under Gnome on Debian, switching the \"Applications\" appearance via gnome-tweaks)\n\nThere was an issue where switching between themes while Thunderbird was running left it a little confused - like the background colours changed, but a bunch of the icons and text seemed wrong.\nWorked fine when you switch themes while thunderbird isn't running.\n\n(all a bit alien to an I3 user like me :-) Themes and desktops are usually just things that happen to other people)\n\nHope this is what you were looking for - let me know if not and I can try some other stuff.", "id": 14995506}, {"time": "2020-08-18T23:12:36Z", "raw_text": "Oh - forgot to mention that the message display pane seems unaffected by theme changes. I guess HTML emails would be problematic, but I'd have thought text emails would follow the theme (ie light text on dark background).", "count": 43, "is_private": false, "tags": [], "bug_id": 1638233, "author": "benc@thunderbird.net", "attachment_id": null, "creator": "benc@thunderbird.net", "creation_time": "2020-08-18T23:12:36Z", "text": "Oh - forgot to mention that the message display pane seems unaffected by theme changes. I guess HTML emails would be problematic, but I'd have thought text emails would follow the theme (ie light text on dark background).", "id": 14995509}, {"attachment_id": null, "creator": "richard.marti@gmail.com", "creation_time": "2020-08-19T07:48:21Z", "id": 14995836, "text": "The dark message display was reverted because of too much issues with HTML messages. Differ between plain text and HTML messages would also lead to reactions to: \"Why are some messages dark and others not?\" for users that don't understand the difference between plain and HTML.", "time": "2020-08-19T07:48:21Z", "raw_text": "The dark message display was reverted because of too much issues with HTML messages. Differ between plain text and HTML messages would also lead to reactions to: \"Why are some messages dark and others not?\" for users that don't understand the difference between plain and HTML.", "count": 44, "is_private": false, "bug_id": 1638233, "tags": [], "author": "richard.marti@gmail.com"}, {"time": "2020-08-19T08:02:40Z", "attachment_id": null, "creator": "mkmelin+mozilla@iki.fi", "raw_text": "Yes, a better solution for the message pane is tracked in bug 1657833.", "creation_time": "2020-08-19T08:02:40Z", "tags": [], "bug_id": 1638233, "is_private": false, "count": 45, "id": 14995845, "text": "Yes, a better solution for the message pane is tracked in bug 1657833.", "author": "mkmelin+mozilla@iki.fi"}, {"author": "wls220spring@gmail.com", "id": 14999983, "text": "The Folder Pane icons are still not visible with the Thunderbird Default theme, then just applying the Adwaita-dark operating system theme with Thunderbird  open using:\n\nName \tThunderbird\nVersion \t78.2.0\nBuild ID \t20200814165000\n\nAlso TB 80.0b5.\n\nA restart of Thunderbird and they become visible.\n\nSwitching back to my default Adwaita theme with Thunderbird open, I lost all Folder pane and Thread Pane content and had to restart to recover the content.\nAppears to work fine if you change operating system themes with Thunderbird closed.", "bug_id": 1638233, "tags": [], "count": 46, "is_private": false, "creation_time": "2020-08-21T16:33:12Z", "raw_text": "The Folder Pane icons are still not visible with the Thunderbird Default theme, then just applying the Adwaita-dark operating system theme with Thunderbird  open using:\n\nName \tThunderbird\nVersion \t78.2.0\nBuild ID \t20200814165000\n\nAlso TB 80.0b5.\n\nA restart of Thunderbird and they become visible.\n\nSwitching back to my default Adwaita theme with Thunderbird open, I lost all Folder pane and Thread Pane content and had to restart to recover the content.\nAppears to work fine if you change operating system themes with Thunderbird closed.", "time": "2020-08-21T16:33:12Z", "attachment_id": null, "creator": "wls220spring@gmail.com"}, {"time": "2020-08-22T17:20:37Z", "raw_text": "Based on the results in comment 46 I'm going to reopen this bug.\n\nI still see the same testing the current 78.2.0 release candidate build (20200821101218) on Ubuntu 18.04.5 LTS.", "is_private": false, "count": 47, "bug_id": 1638233, "tags": [], "author": "wls220spring@gmail.com", "attachment_id": null, "creator": "wls220spring@gmail.com", "creation_time": "2020-08-22T17:20:37Z", "id": 15000831, "text": "Based on the results in comment 46 I'm going to reopen this bug.\n\nI still see the same testing the current 78.2.0 release candidate build (20200821101218) on Ubuntu 18.04.5 LTS."}, {"raw_text": "(In reply to WaltS48 [:walts48] from comment #47)\n> Based on the results in comment 46 I'm going to reopen this bug.\n> \n> I still see the same testing the current 78.2.0 release candidate build (20200821101218) on Ubuntu 18.04.5 LTS.\n\nThis has been reported in comment 22, in this quote:\n\n> Switching from the built-in TB dark theme to default, doesn't properly update the ui.systemUsesDarkTheme, since the UI colors are updated slightly after the processColor() finished running, so it still detects the previous color scheme.\nI'm not sure this is an acceptable behaviour.\nThe theme fixes itself after a restart.\n\nBoth Geoff and Richard approved this and it's an expected behaviour that will be fixed in a follow up bug.", "time": "2020-08-24T15:55:33Z", "author": "alessandro@thunderbird.net", "count": 48, "is_private": false, "tags": [], "bug_id": 1638233, "creation_time": "2020-08-24T15:55:33Z", "creator": "alessandro@thunderbird.net", "attachment_id": null, "id": 15003194, "text": "(In reply to WaltS48 [:walts48] from comment #47)\n> Based on the results in comment 46 I'm going to reopen this bug.\n> \n> I still see the same testing the current 78.2.0 release candidate build (20200821101218) on Ubuntu 18.04.5 LTS.\n\nThis has been reported in comment 22, in this quote:\n\n> Switching from the built-in TB dark theme to default, doesn't properly update the ui.systemUsesDarkTheme, since the UI colors are updated slightly after the processColor() finished running, so it still detects the previous color scheme.\nI'm not sure this is an acceptable behaviour.\nThe theme fixes itself after a restart.\n\nBoth Geoff and Richard approved this and it's an expected behaviour that will be fixed in a follow up bug."}]}}}