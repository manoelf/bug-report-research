{"comments": {}, "bugs": {"686096": {"comments": [{"tags": [], "text": "On attempt to create IPC channel from Content off-main-thread to Chrom Main thread using TestOpens.cpp example with some modifications causing full block of Chrome process.", "bug_id": 686096, "raw_text": "On attempt to create IPC channel from Content off-main-thread to Chrom Main thread using TestOpens.cpp example with some modifications causing full block of Chrome process.", "attachment_id": null, "author": "romaxa@gmail.com", "creation_time": "2011-09-10T05:50:56Z", "time": "2011-09-10T05:50:56Z", "creator": "romaxa@gmail.com", "count": 0, "id": 5712334, "is_private": false}, {"count": 1, "id": 5712341, "is_private": false, "creation_time": "2011-09-10T05:56:39Z", "time": "2011-09-10T05:56:39Z", "creator": "romaxa@gmail.com", "author": "romaxa@gmail.com", "attachment_id": 559659, "raw_text": "can't reproduce it with testOpens, seems like problem with surrounding environment.", "tags": [], "text": "Created attachment 559659\nPatch witch reproduce the problem\n\ncan't reproduce it with testOpens, seems like problem with surrounding environment.", "bug_id": 686096}, {"attachment_id": null, "raw_text": "Same problem happe when I'm trying to OpenChannel from Plugin-main-thread...\n\n#0  0xb7786424 in __kernel_vsyscall ()\n#1  0xb775d20a in __pthread_cond_wait (cond=0xb14d36c4, mutex=0xb14c52e0) at pthread_cond_wait.c:153\n#2  0xb5033a2b in PR_WaitCondVar (cvar=0xb14d36c0, timeout=4294967295)\n    at nsprpub/pr/src/pthreads/ptsynch.c:417\n#3  0xb6acff6b in mozilla::CondVar::Wait (this=0xb14b2624, interval=4294967295)\n    at obj-build-qt-ds/xpcom/build/BlockingResourceBase.cpp:373\n#4  0xb68dc041 in Wait (this=0xb14b2608, aTransport=0xb14aeb98, aIOLoop=0xb13ff0e0, aSide=mozilla::ipc::AsyncChannel::Child)\n    at ../../dist/include/mozilla/Monitor.h:80\n#5  mozilla::ipc::AsyncChannel::Open (this=0xb14b2608, aTransport=0xb14aeb98, aIOLoop=0xb13ff0e0, aSide=mozilla::ipc::AsyncChannel::Child)\n    at ipc/glue/AsyncChannel.cpp:171\n#6  0xb69c8e5e in mozilla::plugins::PBridgeCompositorPluginChild::Open (this=0xb14b2600, aTransport=0xb14aeb98, aOtherProcess=4088, \n    aThread=0xb13ff0e0, aSide=mozilla::ipc::AsyncChannel::Child)\n    at obj-build-qt-ds/ipc/ipdl/PBridgeCompositorPluginChild.cpp:89\n#7  0xb68c4b9f in mozilla::plugins::PluginModuleChild::AllocPBridgeCompositorPlugin (this=0xb1432c18, transport=0xb14aeb98, otherProcess=4088)\n    at dom/plugins/ipc/PluginModuleChild.cpp:1958\n#8  0xb69c66b4 in mozilla::plugins::PPluginModuleChild::OnMessageReceived (this=0xb1432c18, __msg=...)\n    at obj-build-qt-ds/ipc/ipdl/PPluginModuleChild.cpp:812\n#9  0xb68dd3dd in mozilla::ipc::AsyncChannel::OnDispatchMessage (this=0xb1432c20, msg=...)\n    at ipc/glue/AsyncChannel.cpp:294\n#10 0xb68e8cb6 in mozilla::ipc::RPCChannel::OnMaybeDequeueOne (this=0xb1432c20)", "tags": [], "bug_id": 686096, "text": "Same problem happe when I'm trying to OpenChannel from Plugin-main-thread...\n\n#0  0xb7786424 in __kernel_vsyscall ()\n#1  0xb775d20a in __pthread_cond_wait (cond=0xb14d36c4, mutex=0xb14c52e0) at pthread_cond_wait.c:153\n#2  0xb5033a2b in PR_WaitCondVar (cvar=0xb14d36c0, timeout=4294967295)\n    at nsprpub/pr/src/pthreads/ptsynch.c:417\n#3  0xb6acff6b in mozilla::CondVar::Wait (this=0xb14b2624, interval=4294967295)\n    at obj-build-qt-ds/xpcom/build/BlockingResourceBase.cpp:373\n#4  0xb68dc041 in Wait (this=0xb14b2608, aTransport=0xb14aeb98, aIOLoop=0xb13ff0e0, aSide=mozilla::ipc::AsyncChannel::Child)\n    at ../../dist/include/mozilla/Monitor.h:80\n#5  mozilla::ipc::AsyncChannel::Open (this=0xb14b2608, aTransport=0xb14aeb98, aIOLoop=0xb13ff0e0, aSide=mozilla::ipc::AsyncChannel::Child)\n    at ipc/glue/AsyncChannel.cpp:171\n#6  0xb69c8e5e in mozilla::plugins::PBridgeCompositorPluginChild::Open (this=0xb14b2600, aTransport=0xb14aeb98, aOtherProcess=4088, \n    aThread=0xb13ff0e0, aSide=mozilla::ipc::AsyncChannel::Child)\n    at obj-build-qt-ds/ipc/ipdl/PBridgeCompositorPluginChild.cpp:89\n#7  0xb68c4b9f in mozilla::plugins::PluginModuleChild::AllocPBridgeCompositorPlugin (this=0xb1432c18, transport=0xb14aeb98, otherProcess=4088)\n    at dom/plugins/ipc/PluginModuleChild.cpp:1958\n#8  0xb69c66b4 in mozilla::plugins::PPluginModuleChild::OnMessageReceived (this=0xb1432c18, __msg=...)\n    at obj-build-qt-ds/ipc/ipdl/PPluginModuleChild.cpp:812\n#9  0xb68dd3dd in mozilla::ipc::AsyncChannel::OnDispatchMessage (this=0xb1432c20, msg=...)\n    at ipc/glue/AsyncChannel.cpp:294\n#10 0xb68e8cb6 in mozilla::ipc::RPCChannel::OnMaybeDequeueOne (this=0xb1432c20)", "is_private": false, "id": 5718257, "count": 2, "creator": "romaxa@gmail.com", "time": "2011-09-15T07:35:38Z", "creation_time": "2011-09-15T07:35:38Z", "author": "romaxa@gmail.com"}, {"tags": [], "text": "This stack shows the plugin thread waiting on a \"channel-connected\" notification from the compositor (AsyncChannel::OnChannelConnected).  For some reason, that notification is either being received and lost, or not received at all.  Could find out which with a bit of logging.  I don't have any guesses about what might be causing this.", "bug_id": 686096, "attachment_id": null, "raw_text": "This stack shows the plugin thread waiting on a \"channel-connected\" notification from the compositor (AsyncChannel::OnChannelConnected).  For some reason, that notification is either being received and lost, or not received at all.  Could find out which with a bit of logging.  I don't have any guesses about what might be causing this.", "creation_time": "2011-09-15T08:06:02Z", "time": "2011-09-15T08:06:02Z", "creator": "cjones.bugs@gmail.com", "author": "cjones.bugs@gmail.com", "id": 5718266, "count": 3, "is_private": false}, {"attachment_id": null, "raw_text": "Also I see in the same process OnChannelOpened, after exit from OnChannelOpened I receive only\nMaybeInterceptSpecialIOMessage routeID:2147483647, type:1703945\n\nand after that no any messages in that thread, in test App I don't see that", "tags": [], "text": "Also I see in the same process OnChannelOpened, after exit from OnChannelOpened I receive only\nMaybeInterceptSpecialIOMessage routeID:2147483647, type:1703945\n\nand after that no any messages in that thread, in test App I don't see that", "bug_id": 686096, "is_private": false, "id": 5718298, "count": 4, "creator": "romaxa@gmail.com", "creation_time": "2011-09-15T08:50:05Z", "time": "2011-09-15T08:50:05Z", "author": "romaxa@gmail.com"}, {"author": "romaxa@gmail.com", "creator": "romaxa@gmail.com", "creation_time": "2011-09-15T10:15:45Z", "time": "2011-09-15T10:15:45Z", "is_private": false, "count": 5, "id": 5718359, "tags": [], "bug_id": 686096, "text": "I was able to open Channel with this trick.\nInstead of opening PluginCompositorParent channel from ContentParent::Alloc, I did send Message from PluginParent to ContentParent right after opening bridge, and only in that message I opening PluginCompositorParent channel, then it works...", "raw_text": "I was able to open Channel with this trick.\nInstead of opening PluginCompositorParent channel from ContentParent::Alloc, I did send Message from PluginParent to ContentParent right after opening bridge, and only in that message I opening PluginCompositorParent channel, then it works...", "attachment_id": null}, {"author": "romaxa@gmail.com", "creator": "romaxa@gmail.com", "time": "2011-09-15T20:57:33Z", "creation_time": "2011-09-15T20:57:33Z", "is_private": false, "id": 5719209, "count": 6, "tags": [], "text": "Ok, I've found where is the problem...\nContentParentAllocPBridge trying open channel and wait until channel established, and the same time blocking ContentChildAllocPBridge, that is why we never get connected message...\n\nI did some trick which is sending async message to ContentParent right before opening channel on child process side, that is how Parent And Child get's connected approximately at the same time.", "bug_id": 686096, "raw_text": "Ok, I've found where is the problem...\nContentParentAllocPBridge trying open channel and wait until channel established, and the same time blocking ContentChildAllocPBridge, that is why we never get connected message...\n\nI did some trick which is sending async message to ContentParent right before opening channel on child process side, that is how Parent And Child get's connected approximately at the same time.", "attachment_id": null}, {"creator": "cjones.bugs@gmail.com", "time": "2011-09-20T01:55:50Z", "creation_time": "2011-09-20T01:55:50Z", "author": "cjones.bugs@gmail.com", "is_private": false, "id": 5724673, "count": 7, "text": "Are you only able to reproduce this in Qt or can you also reproduce in desktop-gtk2/elsewhere?  My guess would be an event-loop bug (missed notification), but a race condition in the IPDL logic is possible.", "bug_id": 686096, "tags": [], "attachment_id": null, "raw_text": "Are you only able to reproduce this in Qt or can you also reproduce in desktop-gtk2/elsewhere?  My guess would be an event-loop bug (missed notification), but a race condition in the IPDL logic is possible."}, {"raw_text": "Unanswered question.", "attachment_id": 559659, "bug_id": 686096, "text": "Comment on attachment 559659\nPatch witch reproduce the problem\n\nUnanswered question.", "tags": [], "is_private": false, "count": 8, "id": 5924264, "author": "cjones.bugs@gmail.com", "creator": "cjones.bugs@gmail.com", "creation_time": "2011-12-17T11:29:50Z", "time": "2011-12-17T11:29:50Z"}]}}}