{"bugs": {"630890": {"comments": [{"count": 0, "author": "teyang@cisco.com", "attachment_id": null, "raw_text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.6 NET_mmhpset ( .NET CLR 3.5.30729)\nBuild Identifier: Crash in CERT_FindUserCertsByUsage using corrupt cert8.db file\n\nOur application crashes when calling CERT_FindUserCertsByUsage and the root cause seems to be a corrupt cert8.db file in the Firefox profile directory. If the cert8.db file is deleted then relaunching the application does not result in the crash anymore. Reports from users seem to indicate that the corruption might have occur during a Firefox update.\n\nFirefox also seems to crash with a corrupt cert8.db file when trying to access the certificate management tool under preferences(Firefox->preferences->Advanced->Encryption->View Certificates)\n\nBelow is part of a stack trace from a crash:\n\n0 libnssdbm3.dylib 0x017613ff legacy_SetCryptFunctions + 17111\n1 libnssdbm3.dylib 0x0175ffc3 legacy_SetCryptFunctions + 11931\n2 libnssdbm3.dylib 0x017602d7 legacy_SetCryptFunctions + 12719\n3 libnssdbm3.dylib 0x0175c036 0x1751000 + 45110\n4 libsoftokn3.dylib 0x0171b57b C_GetFunctionList + 69340\n5 libsoftokn3.dylib 0x01707d4f NSC_ModuleDBFunc + 2710\n6 libsoftokn3.dylib 0x0170b53d C_GetFunctionList + 3742\n7 libnss3.dylib 0x0064c8bf nss_DumpCertificateCacheInfo + 9229\n8 libnss3.dylib 0x006464ae CERT_EncodeInfoAccessExtension + 12038\n9 libnss3.dylib 0x00608ce8 CERT_GetCertNicknames + 144\n10 libnss3.dylib 0x00609834 CERT_FindUserCertsByUsage + 33\n.................0x001442c8 CNSSCertificate::GetStoreType() + 3432\n\n\n\nReproducible: Always\n\nSteps to Reproduce:\n1.Place the attached cert8.db file into a Firefox profile\n2.Open up Firefox and access the certificate management tool\n3.Firefox will crash\nActual Results:  \nApplication trying to access user certificates will crash\n\nExpected Results:  \nNSS should not be crashing if the certificate database file is corrupted and instead should report such users back or handle it nicely somehow", "creator": "teyang@cisco.com", "bug_id": 630890, "id": 5247468, "text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.6 NET_mmhpset ( .NET CLR 3.5.30729)\nBuild Identifier: Crash in CERT_FindUserCertsByUsage using corrupt cert8.db file\n\nOur application crashes when calling CERT_FindUserCertsByUsage and the root cause seems to be a corrupt cert8.db file in the Firefox profile directory. If the cert8.db file is deleted then relaunching the application does not result in the crash anymore. Reports from users seem to indicate that the corruption might have occur during a Firefox update.\n\nFirefox also seems to crash with a corrupt cert8.db file when trying to access the certificate management tool under preferences(Firefox->preferences->Advanced->Encryption->View Certificates)\n\nBelow is part of a stack trace from a crash:\n\n0 libnssdbm3.dylib 0x017613ff legacy_SetCryptFunctions + 17111\n1 libnssdbm3.dylib 0x0175ffc3 legacy_SetCryptFunctions + 11931\n2 libnssdbm3.dylib 0x017602d7 legacy_SetCryptFunctions + 12719\n3 libnssdbm3.dylib 0x0175c036 0x1751000 + 45110\n4 libsoftokn3.dylib 0x0171b57b C_GetFunctionList + 69340\n5 libsoftokn3.dylib 0x01707d4f NSC_ModuleDBFunc + 2710\n6 libsoftokn3.dylib 0x0170b53d C_GetFunctionList + 3742\n7 libnss3.dylib 0x0064c8bf nss_DumpCertificateCacheInfo + 9229\n8 libnss3.dylib 0x006464ae CERT_EncodeInfoAccessExtension + 12038\n9 libnss3.dylib 0x00608ce8 CERT_GetCertNicknames + 144\n10 libnss3.dylib 0x00609834 CERT_FindUserCertsByUsage + 33\n.................0x001442c8 CNSSCertificate::GetStoreType() + 3432\n\n\n\nReproducible: Always\n\nSteps to Reproduce:\n1.Place the attached cert8.db file into a Firefox profile\n2.Open up Firefox and access the certificate management tool\n3.Firefox will crash\nActual Results:  \nApplication trying to access user certificates will crash\n\nExpected Results:  \nNSS should not be crashing if the certificate database file is corrupted and instead should report such users back or handle it nicely somehow", "tags": [], "time": "2011-02-02T17:21:55Z", "is_private": false, "creation_time": "2011-02-02T17:21:55Z"}, {"attachment_id": 509132, "raw_text": "Placing this cert8.db file into the Firefox profile directory will cause a crash when trying to access user certificate in code", "creator": "teyang@cisco.com", "count": 1, "author": "teyang@cisco.com", "is_private": false, "time": "2011-02-02T17:26:56Z", "creation_time": "2011-02-02T17:26:56Z", "bug_id": 630890, "id": 5247482, "text": "Created attachment 509132\ncorrupt cert8.db file cauing crash\n\nPlacing this cert8.db file into the Firefox profile directory will cause a crash when trying to access user certificate in code", "tags": []}, {"author": "wtc@google.com", "count": 2, "is_private": false, "tags": [], "id": 5250855, "attachment_id": null, "creator": "wtc@google.com", "raw_text": "Bob, could you take a look at this crash?", "creation_time": "2011-02-03T06:52:28Z", "time": "2011-02-03T06:52:28Z", "text": "Bob, could you take a look at this crash?", "bug_id": 630890}, {"creation_time": "2011-02-03T09:24:42Z", "time": "2011-02-03T09:24:42Z", "text": "Sounds like the reporter has an application that is attempting to \"share\" \nFirefox's cert8.db file.  Of course, that is not supported for cert8, and \nis KNOWN to cause corruption of cert8.  That's why we developed cert9.\nIt's shareable.  \n\nI'll run NSS 3.11's cert DB analyzer on this file ... sometime in the next \nweek ... I hope.", "bug_id": 630890, "raw_text": "Sounds like the reporter has an application that is attempting to \"share\" \nFirefox's cert8.db file.  Of course, that is not supported for cert8, and \nis KNOWN to cause corruption of cert8.  That's why we developed cert9.\nIt's shareable.  \n\nI'll run NSS 3.11's cert DB analyzer on this file ... sometime in the next \nweek ... I hope.", "creator": "nelson@bolyard.me", "attachment_id": null, "is_private": false, "tags": [], "id": 5250998, "author": "nelson@bolyard.me", "count": 3}]}}, "comments": {}}