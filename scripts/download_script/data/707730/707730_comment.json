{"comments": {}, "bugs": {"707730": {"comments": [{"attachment_id": null, "raw_text": "User Agent: Mozilla/5.0 (Ubuntu; X11; Linux x86_64; rv:8.0) Gecko/20100101 Firefox/8.0\nBuild ID: 20111115183813\n\nSteps to reproduce:\n\n1) Create a virtual folder which is stored as sub-folder of an IMAP account\n2) Select some criteria (doesn't matter)\n3) Give this folder a name like \"just a stupid name\" which includes (!) spaces\n4) Close thunderbird and restart (sometimes two restarts are needed)\n\nOS: Linux (Ubuntu 11.10), KDE 4.7.x, English Language, German Keyboard\n\n\n\n\nActual results:\n\n- The folder list shows two identical search folders next to each other. Both are fully functional and working. \n- Deleting one of the two folders leads to the other showing a folder icon (and not the smart folder icon) and not being functional anymore,\n- Deleting the corresponding *.msf file for the virtual folder in ./.mozilla-thunderbird/profile/ImapMail/account fixes this issue up to the next restart. Then it is back to 2 identical folders again.\n\nOn the same  setup without major upgrades in between I used this method (saved search folders with spaces in the name) before without problems. The problems started with version 6 (5?) or so. Or some minor upgrade / package upgrade / whatever.\n\nOS: Linux (Ubuntu 11.10), KDE 4.7.x, English Language, German Keyboard\n\n\nExpected results:\n\nA single folder, of course.", "bug_id": 707730, "text": "User Agent: Mozilla/5.0 (Ubuntu; X11; Linux x86_64; rv:8.0) Gecko/20100101 Firefox/8.0\nBuild ID: 20111115183813\n\nSteps to reproduce:\n\n1) Create a virtual folder which is stored as sub-folder of an IMAP account\n2) Select some criteria (doesn't matter)\n3) Give this folder a name like \"just a stupid name\" which includes (!) spaces\n4) Close thunderbird and restart (sometimes two restarts are needed)\n\nOS: Linux (Ubuntu 11.10), KDE 4.7.x, English Language, German Keyboard\n\n\n\n\nActual results:\n\n- The folder list shows two identical search folders next to each other. Both are fully functional and working. \n- Deleting one of the two folders leads to the other showing a folder icon (and not the smart folder icon) and not being functional anymore,\n- Deleting the corresponding *.msf file for the virtual folder in ./.mozilla-thunderbird/profile/ImapMail/account fixes this issue up to the next restart. Then it is back to 2 identical folders again.\n\nOn the same  setup without major upgrades in between I used this method (saved search folders with spaces in the name) before without problems. The problems started with version 6 (5?) or so. Or some minor upgrade / package upgrade / whatever.\n\nOS: Linux (Ubuntu 11.10), KDE 4.7.x, English Language, German Keyboard\n\n\nExpected results:\n\nA single folder, of course.", "tags": [], "is_private": false, "id": 5893110, "count": 0, "creator": "list@incunabulum.de", "creation_time": "2011-12-05T17:41:26Z", "time": "2011-12-05T17:41:26Z", "author": "list@incunabulum.de"}, {"is_private": false, "count": 1, "id": 5896438, "author": "m-wada@usa.com", "creator": "m-wada@usa.com", "creation_time": "2011-12-07T03:09:42Z", "time": "2011-12-07T03:09:42Z", "raw_text": "Is space in name actually relevant to main problem?\n\nWith Tb 8, next pheomenon was observed with Yahoo! IMAP(no namespace, delimiter=\"/\").\n(0) No automatic mail check, to prohibit automatic server connection after\n    restart. Folder view = All Folders, to avoid Unified Folders relevant issues.\n(1) Create virtual folder named VF1, access the VF1. VF1.msf is used.\n(2) Rename VF1 to VF2. VF2.msf is created. Content of VF2.msf is normal.\n    VF1.msf remains. VF1.msf looks created as .msf file folder for IMAP folder\n    after rename of VF1.msf to VF2.msf, without creation request to server.\n(3) Click IMAP account, to prohibit server access at next restart.\n(4) Terminate Tb.\n(5) Restart Tb => VF1 is shown as ordinal IMAP folder at folder pane.\n(6) Click Inbox => Connection to server is established.\n    Because IMAP folder of VF1 doesn't exist at server, VF1 disappears from\n    folder pane, and garbage VF1.msf is erased.\n\nIf VF1 is clicked at step (5), Tb looks to request \"select VF1\", and error occurs because VF1 doesn't exist, and VF1 is removed, and VF1.msf is erased.\n\nIf rename is executed multiple times at step (2), multiple garbage folders for old names are shown in folder pane at step (5).\n\nIf namespace is used and/or delimiter=\".\", and if multiple space chars is used in name, problem like bug 561688(closed as incomplete) may happen at step (5), if garbage folder is clicked at step (5).\nSee dependency tree for meta Bug 124287 with \"Show Resolved\".\n> https://bugzilla.mozilla.org/showdependencytree.cgi?id=124287&hide_resolved=0 \nBug 561688", "attachment_id": null, "bug_id": 707730, "text": "Is space in name actually relevant to main problem?\n\nWith Tb 8, next pheomenon was observed with Yahoo! IMAP(no namespace, delimiter=\"/\").\n(0) No automatic mail check, to prohibit automatic server connection after\n    restart. Folder view = All Folders, to avoid Unified Folders relevant issues.\n(1) Create virtual folder named VF1, access the VF1. VF1.msf is used.\n(2) Rename VF1 to VF2. VF2.msf is created. Content of VF2.msf is normal.\n    VF1.msf remains. VF1.msf looks created as .msf file folder for IMAP folder\n    after rename of VF1.msf to VF2.msf, without creation request to server.\n(3) Click IMAP account, to prohibit server access at next restart.\n(4) Terminate Tb.\n(5) Restart Tb => VF1 is shown as ordinal IMAP folder at folder pane.\n(6) Click Inbox => Connection to server is established.\n    Because IMAP folder of VF1 doesn't exist at server, VF1 disappears from\n    folder pane, and garbage VF1.msf is erased.\n\nIf VF1 is clicked at step (5), Tb looks to request \"select VF1\", and error occurs because VF1 doesn't exist, and VF1 is removed, and VF1.msf is erased.\n\nIf rename is executed multiple times at step (2), multiple garbage folders for old names are shown in folder pane at step (5).\n\nIf namespace is used and/or delimiter=\".\", and if multiple space chars is used in name, problem like bug 561688(closed as incomplete) may happen at step (5), if garbage folder is clicked at step (5).\nSee dependency tree for meta Bug 124287 with \"Show Resolved\".\n> https://bugzilla.mozilla.org/showdependencytree.cgi?id=124287&hide_resolved=0 \nBug 561688", "tags": []}, {"is_private": false, "count": 2, "id": 5896687, "author": "m-wada@usa.com", "creator": "m-wada@usa.com", "creation_time": "2011-12-07T06:30:31Z", "time": "2011-12-07T06:30:31Z", "raw_text": "Did you put space at end of search folder name?\n\nIf space is put at end of name, next occurred.\n(1) create \"VF\"                        : VF.msf          is used\n(2) rename \"VF\" to \"VF \"(single space) : VF099b929f5.msf is used\n(3) rename \"VF \" to \"VF  \"(two spaces) : VF ec833565.msf is used\nIn (1) and (2), \"space at end of name\" is hashed in filename.\nIn virtualFolders.dat, space is escaped by %20(VF%20, VF%20%20)\n\nIf Tb is restarted in this situation, three \"VF\" for user appears.\n  \"VF  \" : search folder,            VF%20%20,  VF ec833565.msf \n  \"VF\"   : non-existnt imap folder,  VF,        VF.msf\n  \"VF \"  : non-existnt imap folder,  VF%20,     VF099b929f5.msf\n\nEven after rename of \"VF  \"(two spaces) to \"no space name\" such as VF1 and several restarts of Tb is executeds, file of VF ec833565.msf was not deleted.\nThis may be relevant to next.\n(a) If space is put at search folder creation time, Tb rejects it (reason = recognized char).\n(b) However, Tb accepts it when rename of search folder.\nNon deleted VF ec833565.msf may be a result of mismatch between (a) and (b).", "attachment_id": null, "tags": [], "text": "Did you put space at end of search folder name?\n\nIf space is put at end of name, next occurred.\n(1) create \"VF\"                        : VF.msf          is used\n(2) rename \"VF\" to \"VF \"(single space) : VF099b929f5.msf is used\n(3) rename \"VF \" to \"VF  \"(two spaces) : VF ec833565.msf is used\nIn (1) and (2), \"space at end of name\" is hashed in filename.\nIn virtualFolders.dat, space is escaped by %20(VF%20, VF%20%20)\n\nIf Tb is restarted in this situation, three \"VF\" for user appears.\n  \"VF  \" : search folder,            VF%20%20,  VF ec833565.msf \n  \"VF\"   : non-existnt imap folder,  VF,        VF.msf\n  \"VF \"  : non-existnt imap folder,  VF%20,     VF099b929f5.msf\n\nEven after rename of \"VF  \"(two spaces) to \"no space name\" such as VF1 and several restarts of Tb is executeds, file of VF ec833565.msf was not deleted.\nThis may be relevant to next.\n(a) If space is put at search folder creation time, Tb rejects it (reason = recognized char).\n(b) However, Tb accepts it when rename of search folder.\nNon deleted VF ec833565.msf may be a result of mismatch between (a) and (b).", "bug_id": 707730}, {"raw_text": "list@incunabulum.de(bug opener), can you show us actual search folder name you typed upon search folder creation, actual search folder name in virtualFolders.dat, and actual file name in Tb's local directory for the IMAP account?", "attachment_id": null, "text": "list@incunabulum.de(bug opener), can you show us actual search folder name you typed upon search folder creation, actual search folder name in virtualFolders.dat, and actual file name in Tb's local directory for the IMAP account?", "bug_id": 707730, "tags": [], "is_private": false, "id": 5896692, "count": 3, "author": "m-wada@usa.com", "creator": "m-wada@usa.com", "creation_time": "2011-12-07T06:37:25Z", "time": "2011-12-07T06:37:25Z"}, {"tags": [], "bug_id": 707730, "text": "Wada,\n\nI can confirm your statement in comment #1 regarding an existing (stale) msf file after renaming a search folder and restarting TB which leads to the msf generating a non-functional folder which claims to be an IMAP folder which it isn't.\n\nRegarding comment #2:\n- No, there is no space in the search folder name and my problems happens without any renaming going on. But I think I saw something similar regarding escaped and unescaped representation in virtualfolders.dat, the msf-files etc while trying to find out what happens and how to reproduce the bug.\n\nRegarding comment #3:\n- The  search folder (created for testing) is named \"bla bla\" and was created as \"bla bla\". It has not been renamed!\n\nIn virtualfolders.dat I have two entries (partially cleaned for privacy purposed) as follows:\n\nuri=imap://[removed]/bla bla\n...\nsearchOnline=false\n\nuri=imap://[removed]/bla%20bla\n...\nsearchOnline=false\n\nThe msf file is named: \n\"bla bla.msf\" and contains (amongst others) the following statement:\n<(80=1)(83=bla bla)(84=8000024)(85=ALL)(86=0)>\n\n-", "attachment_id": null, "raw_text": "Wada,\n\nI can confirm your statement in comment #1 regarding an existing (stale) msf file after renaming a search folder and restarting TB which leads to the msf generating a non-functional folder which claims to be an IMAP folder which it isn't.\n\nRegarding comment #2:\n- No, there is no space in the search folder name and my problems happens without any renaming going on. But I think I saw something similar regarding escaped and unescaped representation in virtualfolders.dat, the msf-files etc while trying to find out what happens and how to reproduce the bug.\n\nRegarding comment #3:\n- The  search folder (created for testing) is named \"bla bla\" and was created as \"bla bla\". It has not been renamed!\n\nIn virtualfolders.dat I have two entries (partially cleaned for privacy purposed) as follows:\n\nuri=imap://[removed]/bla bla\n...\nsearchOnline=false\n\nuri=imap://[removed]/bla%20bla\n...\nsearchOnline=false\n\nThe msf file is named: \n\"bla bla.msf\" and contains (amongst others) the following statement:\n<(80=1)(83=bla bla)(84=8000024)(85=ALL)(86=0)>\n\n-", "time": "2011-12-07T16:42:04Z", "creation_time": "2011-12-07T16:42:04Z", "creator": "list@incunabulum.de", "author": "list@incunabulum.de", "id": 5897463, "count": 4, "is_private": false}, {"count": 5, "id": 5897877, "is_private": false, "author": "m-wada@usa.com", "creation_time": "2011-12-07T18:42:18Z", "time": "2011-12-07T18:42:18Z", "creator": "m-wada@usa.com", "raw_text": "(In reply to list from comment #4)\n> In virtualfolders.dat I have two entries \n> uri=imap://[removed]/bla bla\n> uri=imap://[removed]/bla%20bla\n\nI couldn't see \"uri=imap://bla bla\" in virualFolders.dat by search folder creation named \"bla bla\" via New/Saved Search... etc. by Tb 8 on Win. I could see \"uri=imap://bla%20bla\" only in virtualFolders.dat. (I checked with Yahoo!'s IMAP account.)\n\nEven when I manually/intentionally added entry of \"uri=imap://bla bla\" in addition to existent/valid \"uri=imap://bla%20bla\", entry of \"uri=imap://bla bla\" was once shown after restart of Tb as \"bla bla\" at folder pane in addition to \"bla bla\" by \"uri=imap://bla%20bla\", but it was removed sooner or later after one or some restarts of Tb.\n\nAnother problem is found.\n(1) Create search folder named \"bla bla\" under an IMAP account.\n    => \"bla bla.msf\" is uesed. uri=imap://bla%20bla in virtualFolders.dat.\n(2) Create IMAP folder named \"bla bla\".\n    => IMAP folder named \"bla bla\" is normaly created.\n       Used file is \"bla bla-1.msf\" (phenomeon of bug 520437 comment #7)\n       So, two \"bla bla\" is shown at folder pane.\nIf search folder creation, same name as existent IMAP folder is rejected by Tb. Duplication check of IMAP folder name doen't seem to look existent virtual folder(search folder) names.\n\n\"uri=imap://bla bla\" of virtualFolders.dat in your case looks for me garbage by old Tb.\nWhen was the \"uri=imap://bla bla\" of virtualFolders.dat created in your environment?\nDo you have IMAP folder named \"bla bla\" at server?\n\nBy the way, phenomenon I saw by single rename and/or multiple rename of search folder is perhaps relevant to bug 450059.", "attachment_id": null, "tags": [], "bug_id": 707730, "text": "(In reply to list from comment #4)\n> In virtualfolders.dat I have two entries \n> uri=imap://[removed]/bla bla\n> uri=imap://[removed]/bla%20bla\n\nI couldn't see \"uri=imap://bla bla\" in virualFolders.dat by search folder creation named \"bla bla\" via New/Saved Search... etc. by Tb 8 on Win. I could see \"uri=imap://bla%20bla\" only in virtualFolders.dat. (I checked with Yahoo!'s IMAP account.)\n\nEven when I manually/intentionally added entry of \"uri=imap://bla bla\" in addition to existent/valid \"uri=imap://bla%20bla\", entry of \"uri=imap://bla bla\" was once shown after restart of Tb as \"bla bla\" at folder pane in addition to \"bla bla\" by \"uri=imap://bla%20bla\", but it was removed sooner or later after one or some restarts of Tb.\n\nAnother problem is found.\n(1) Create search folder named \"bla bla\" under an IMAP account.\n    => \"bla bla.msf\" is uesed. uri=imap://bla%20bla in virtualFolders.dat.\n(2) Create IMAP folder named \"bla bla\".\n    => IMAP folder named \"bla bla\" is normaly created.\n       Used file is \"bla bla-1.msf\" (phenomeon of bug 520437 comment #7)\n       So, two \"bla bla\" is shown at folder pane.\nIf search folder creation, same name as existent IMAP folder is rejected by Tb. Duplication check of IMAP folder name doen't seem to look existent virtual folder(search folder) names.\n\n\"uri=imap://bla bla\" of virtualFolders.dat in your case looks for me garbage by old Tb.\nWhen was the \"uri=imap://bla bla\" of virtualFolders.dat created in your environment?\nDo you have IMAP folder named \"bla bla\" at server?\n\nBy the way, phenomenon I saw by single rename and/or multiple rename of search folder is perhaps relevant to bug 450059."}, {"author": "list@incunabulum.de", "creator": "list@incunabulum.de", "creation_time": "2011-12-07T19:23:58Z", "time": "2011-12-07T19:23:58Z", "is_private": false, "count": 6, "id": 5898024, "text": "(In reply to WADA from comment #5)\n> I couldn't see \"uri=imap://bla bla\" in virualFolders.dat by search folder\n> creation named \"bla bla\" via New/Saved Search... etc. by Tb 8 on Win. I\n> could see \"uri=imap://bla%20bla\" only in virtualFolders.dat. (I checked with\n> Yahoo!'s IMAP account.)\n\nDid you restart TB? Without a restart, I can only see one entry in virtualFolders.dat. After the restart, the second entry is there, too. This is with TB 8 on Linux (Ubuntu 11.10 package). This is reproduceable here. \n\nImap-Server is courier mail.\n\n\n> If search folder creation, same name as existent IMAP folder is rejected by\n> Tb. Duplication check of IMAP folder name doen't seem to look existent\n> virtual folder(search folder) names.\n\nHow should TB behave? For me, a imap folder is different to a search folder. Therefore, there should be the option to have a search folder and an imap folder of identical name in the same parent folder.\n\n> \"uri=imap://bla bla\" of virtualFolders.dat in your case looks for me garbage\n> by old Tb.\n> When was the \"uri=imap://bla bla\" of virtualFolders.dat created in your\n> environment?\n\nSorry, no. I specifically created this folder for testing purposes just today while writing comment #4. This folder name has never (!) been used anywhere in my TB installation at anytime before. Never. \nTo clarify: Before I created a single search folder, the virtualFolders.dat did not contain a \"uri=imap://bla bla\" statement. This statement was created after creating the search folder was created. Possible after or during the restart.\n\n> Do you have IMAP folder named \"bla bla\" at server?\nNo. And never had.", "bug_id": 707730, "tags": [], "raw_text": "(In reply to WADA from comment #5)\n> I couldn't see \"uri=imap://bla bla\" in virualFolders.dat by search folder\n> creation named \"bla bla\" via New/Saved Search... etc. by Tb 8 on Win. I\n> could see \"uri=imap://bla%20bla\" only in virtualFolders.dat. (I checked with\n> Yahoo!'s IMAP account.)\n\nDid you restart TB? Without a restart, I can only see one entry in virtualFolders.dat. After the restart, the second entry is there, too. This is with TB 8 on Linux (Ubuntu 11.10 package). This is reproduceable here. \n\nImap-Server is courier mail.\n\n\n> If search folder creation, same name as existent IMAP folder is rejected by\n> Tb. Duplication check of IMAP folder name doen't seem to look existent\n> virtual folder(search folder) names.\n\nHow should TB behave? For me, a imap folder is different to a search folder. Therefore, there should be the option to have a search folder and an imap folder of identical name in the same parent folder.\n\n> \"uri=imap://bla bla\" of virtualFolders.dat in your case looks for me garbage\n> by old Tb.\n> When was the \"uri=imap://bla bla\" of virtualFolders.dat created in your\n> environment?\n\nSorry, no. I specifically created this folder for testing purposes just today while writing comment #4. This folder name has never (!) been used anywhere in my TB installation at anytime before. Never. \nTo clarify: Before I created a single search folder, the virtualFolders.dat did not contain a \"uri=imap://bla bla\" statement. This statement was created after creating the search folder was created. Possible after or during the restart.\n\n> Do you have IMAP folder named \"bla bla\" at server?\nNo. And never had.", "attachment_id": null}, {"time": "2011-12-08T05:21:48Z", "creation_time": "2011-12-08T05:21:48Z", "creator": "m-wada@usa.com", "author": "m-wada@usa.com", "id": 5899764, "count": 7, "is_private": false, "bug_id": 707730, "text": "(In reply to list from comment #6)\n> Did you restart TB?\n> Without a restart, I can only see one entry in virtualFolders.dat.\n\nYes. I restarted several times and checked virtualFolders.dat many times.\n\nI could observe \"uri=imap://.../bla bla\" only by next intentional panacea.dat corruption.\nNote: \"Show only subscribed folders\" is disabled in this test. I don't know it's relevant to phenomenon or not.\n(1) Normal/online IMAP access, with \"uri=imap://.../bla%20bla\" and \"bla bla.msf\", without phenomena of bug 698321, bug 701688, bug 707446, and bug 520437.\n(2) Terminate Tb.\n(3) Delete panacea.dat (rename panacea.dat to panacea.dat-Bkup)\n   (Inbox=>...\\Inbox.msf, Trash=>...\\Trash.msf, bla bla=>bla bla.msf, are lost) \n(4) Restart Tb with offline mode, to prohibit server access upon restart of Tb.\n      thunderbid.exe -offline -p \"profile_name\"\n    => Two search folders of \"bla bla\" at folder pane\n       This is a variant of phenomenon in [Test-B] in bug 701688 comment #14.\n       It looks; (i) One is from \"bla bla.msf\" file whose content is search\n       folder, which is found by scan of local directory due to loss of\n       panacea.dat data. (ii) Another is from \"uri=imap://.../bla%20bla\" in\n       virtualFolders.dat and existent file of \"bla bla.msf\".\n    => No \"uri=imap://.../bla bla\" yet\n(5) Terminate Tb.\n    => \"uri=imap://.../bla bla\" was written to virtualFolders.dat \n       in addition to valid \"uri=imap://.../bla%20bla\".\n   \"uri=imap://.../bla bla\" is perhaps created by (i) in step (4).\n   If created via UI, space in \"uri=...\" is eascaped by %20 as expected.\n   But if virtualFolders.dat content is recovered from existent .msf file\n   for search folder, space in file name(name of search folder) is not escaped\n   by %20 upon creation of \"uri=...\" string.\n(6) Restart Tb with offline mode, to prohibit server access upon restart of Tb.\n      thunderbid.exe -offline -p \"profile_name\"\n    => Still \"uri=imap://.../bla bla\" and valid \"uri=imap://.../bla%20bla\"\n    => Single search folders of \"bla bla\" only at folder pane.\n(7) Go online mode by File/Offline, uncheck \"Work Offline\",\n    click the IMAP account, and click Inbox to open IMAP folder.\n    => Server connection is established.\n    => \"uri=imap://.../bla bla\" was removed from virtualFolders.dat\n       Valid \"uri=imap://.../bla%20bla\" only remained.\n\nI think that above step (5) can explain reason why restart of Tb is needed to see \"uri=imap://.../bla bla\" in your case.\n  \nNote:\nBecause suffix in file name happens by above test(phenomena of bug 698321, bug 701688, bug 707446, and bug 520437), following steps is needed to clean up garbages.\n(8) Delete panacea.dat, rename panacea.dat-Bkup to panacea.dat\n   (Inbox=>...\\Inbox.msf, Trash=>...\\Trash.msf, ... , are recovered) \n(9) Restart Tb with offline mode, to prohibit server access upon restart of Tb,\n      thunderbid.exe -offline -p \"profile_name\"\n    and go Work Online mode, \n    and open Inbox by click of Inbox to force server connection.\n    Because Inbox=>...\\Inbox.msf in panacea.dat, and because folder like Inbox-N\n    doesn't exist at IMAP server, files like Inbox-N.msf is deleted by Tb.\n    Directories like Inbox-N.sbd perhaps should be deleted manually.", "tags": [], "attachment_id": null, "raw_text": "(In reply to list from comment #6)\n> Did you restart TB?\n> Without a restart, I can only see one entry in virtualFolders.dat.\n\nYes. I restarted several times and checked virtualFolders.dat many times.\n\nI could observe \"uri=imap://.../bla bla\" only by next intentional panacea.dat corruption.\nNote: \"Show only subscribed folders\" is disabled in this test. I don't know it's relevant to phenomenon or not.\n(1) Normal/online IMAP access, with \"uri=imap://.../bla%20bla\" and \"bla bla.msf\", without phenomena of bug 698321, bug 701688, bug 707446, and bug 520437.\n(2) Terminate Tb.\n(3) Delete panacea.dat (rename panacea.dat to panacea.dat-Bkup)\n   (Inbox=>...\\Inbox.msf, Trash=>...\\Trash.msf, bla bla=>bla bla.msf, are lost) \n(4) Restart Tb with offline mode, to prohibit server access upon restart of Tb.\n      thunderbid.exe -offline -p \"profile_name\"\n    => Two search folders of \"bla bla\" at folder pane\n       This is a variant of phenomenon in [Test-B] in bug 701688 comment #14.\n       It looks; (i) One is from \"bla bla.msf\" file whose content is search\n       folder, which is found by scan of local directory due to loss of\n       panacea.dat data. (ii) Another is from \"uri=imap://.../bla%20bla\" in\n       virtualFolders.dat and existent file of \"bla bla.msf\".\n    => No \"uri=imap://.../bla bla\" yet\n(5) Terminate Tb.\n    => \"uri=imap://.../bla bla\" was written to virtualFolders.dat \n       in addition to valid \"uri=imap://.../bla%20bla\".\n   \"uri=imap://.../bla bla\" is perhaps created by (i) in step (4).\n   If created via UI, space in \"uri=...\" is eascaped by %20 as expected.\n   But if virtualFolders.dat content is recovered from existent .msf file\n   for search folder, space in file name(name of search folder) is not escaped\n   by %20 upon creation of \"uri=...\" string.\n(6) Restart Tb with offline mode, to prohibit server access upon restart of Tb.\n      thunderbid.exe -offline -p \"profile_name\"\n    => Still \"uri=imap://.../bla bla\" and valid \"uri=imap://.../bla%20bla\"\n    => Single search folders of \"bla bla\" only at folder pane.\n(7) Go online mode by File/Offline, uncheck \"Work Offline\",\n    click the IMAP account, and click Inbox to open IMAP folder.\n    => Server connection is established.\n    => \"uri=imap://.../bla bla\" was removed from virtualFolders.dat\n       Valid \"uri=imap://.../bla%20bla\" only remained.\n\nI think that above step (5) can explain reason why restart of Tb is needed to see \"uri=imap://.../bla bla\" in your case.\n  \nNote:\nBecause suffix in file name happens by above test(phenomena of bug 698321, bug 701688, bug 707446, and bug 520437), following steps is needed to clean up garbages.\n(8) Delete panacea.dat, rename panacea.dat-Bkup to panacea.dat\n   (Inbox=>...\\Inbox.msf, Trash=>...\\Trash.msf, ... , are recovered) \n(9) Restart Tb with offline mode, to prohibit server access upon restart of Tb,\n      thunderbid.exe -offline -p \"profile_name\"\n    and go Work Online mode, \n    and open Inbox by click of Inbox to force server connection.\n    Because Inbox=>...\\Inbox.msf in panacea.dat, and because folder like Inbox-N\n    doesn't exist at IMAP server, files like Inbox-N.msf is deleted by Tb.\n    Directories like Inbox-N.sbd perhaps should be deleted manually."}, {"bug_id": 707730, "text": "To see from where the non-escaped string is generated, checked with search folder name=\"ABC DEF<pqr>\" for which hashing in file name is used.\n\nsearch folder name  : \"ABC DEF<pqr>\"        (no quote)\nused .msf file name : \"ABC DEFb613412b.msf\" (no quote)\ncontent in \"ABC DEFb613412b.msf\"    \n> <(80=1)(92=ABC DEF<pqr>)(84=8000024)(85=AND (subject,contains,mail\\))\n>  (86=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/INBOX)(87=0)\n>  (88\nvalid virtualFolders.dat entry :\n  uri=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/ABC%20DEF%3Cpqr%3E\ngarbled virtualFolders.dat entry :\n  uri=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/ABC DEFb613412b\n\nUnescaped entry is generated from file name(simply .msf is removed.)", "tags": [], "attachment_id": null, "raw_text": "To see from where the non-escaped string is generated, checked with search folder name=\"ABC DEF<pqr>\" for which hashing in file name is used.\n\nsearch folder name  : \"ABC DEF<pqr>\"        (no quote)\nused .msf file name : \"ABC DEFb613412b.msf\" (no quote)\ncontent in \"ABC DEFb613412b.msf\"    \n> <(80=1)(92=ABC DEF<pqr>)(84=8000024)(85=AND (subject,contains,mail\\))\n>  (86=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/INBOX)(87=0)\n>  (88\nvalid virtualFolders.dat entry :\n  uri=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/ABC%20DEF%3Cpqr%3E\ngarbled virtualFolders.dat entry :\n  uri=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/ABC DEFb613412b\n\nUnescaped entry is generated from file name(simply .msf is removed.)", "creation_time": "2011-12-08T06:24:32Z", "time": "2011-12-08T06:24:32Z", "creator": "m-wada@usa.com", "author": "m-wada@usa.com", "count": 8, "id": 5899835, "is_private": false}, {"attachment_id": null, "raw_text": "(In addition to comment #8)\nOnce next entries were created in virtualFolders.dat by Tb,\n valid virtualFolders.dat entry :\n (a) uri=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/ABC%20DEF%3Cpqr%3E\n garbled virtualFolders.dat entry :\n (b) uri=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/ABC DEFb613412b\nnext two search folders were shown at folder pane by ordinal restart of Tb.\n (A) search folder : \"ABC DEF<pqr>\"    no quote, unescaped format of (a)\n (B) search folder : \"ABC DEFb613412b\" no quote, unescaped format of (b)\n\nWhen search rule is changed at \"ABC DEFb613412b\", serach rule of \"ABC DEF<pqr>\" is also changed as you say.\nBoth search folders uses same .msf file.\n> content in \"ABC DEFb613412b.msf\"    \n> > <(80=1)(92=ABC DEF<pqr>)(84=8000024)(85=AND (subject,contains,mail\\))\n> >  (86=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/INBOX)(87=0)\n> >  (88\n(a) uri=imap:// ... /ABC%20DEF%3Cpqr%3E\n         unescape => ABC DEF<pqr>\n         => folder access => hashing due to illegale file chars\n         => converted to ABC DEFb613412b => use ABC DEFb613412b.msf\n(b) uri=imap:// ... /ABC DEFb613412b\n         unescape => still ABC DEFb613412b\n         => folder access => no special chars => use ABC DEFb613412b.msf\n\nWhy unescaped uri=imap://... was created in your environment is still unclear, but unescaped uri=imap://... was actually created in your environment, and I could see phenomenon after unescped uri=imap://... was created by Tb.\nConfirming.", "text": "(In addition to comment #8)\nOnce next entries were created in virtualFolders.dat by Tb,\n valid virtualFolders.dat entry :\n (a) uri=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/ABC%20DEF%3Cpqr%3E\n garbled virtualFolders.dat entry :\n (b) uri=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/ABC DEFb613412b\nnext two search folders were shown at folder pane by ordinal restart of Tb.\n (A) search folder : \"ABC DEF<pqr>\"    no quote, unescaped format of (a)\n (B) search folder : \"ABC DEFb613412b\" no quote, unescaped format of (b)\n\nWhen search rule is changed at \"ABC DEFb613412b\", serach rule of \"ABC DEF<pqr>\" is also changed as you say.\nBoth search folders uses same .msf file.\n> content in \"ABC DEFb613412b.msf\"    \n> > <(80=1)(92=ABC DEF<pqr>)(84=8000024)(85=AND (subject,contains,mail\\))\n> >  (86=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/INBOX)(87=0)\n> >  (88\n(a) uri=imap:// ... /ABC%20DEF%3Cpqr%3E\n         unescape => ABC DEF<pqr>\n         => folder access => hashing due to illegale file chars\n         => converted to ABC DEFb613412b => use ABC DEFb613412b.msf\n(b) uri=imap:// ... /ABC DEFb613412b\n         unescape => still ABC DEFb613412b\n         => folder access => no special chars => use ABC DEFb613412b.msf\n\nWhy unescaped uri=imap://... was created in your environment is still unclear, but unescaped uri=imap://... was actually created in your environment, and I could see phenomenon after unescped uri=imap://... was created by Tb.\nConfirming.", "bug_id": 707730, "tags": [], "is_private": false, "count": 9, "id": 5899909, "creator": "m-wada@usa.com", "time": "2011-12-08T07:24:44Z", "creation_time": "2011-12-08T07:24:44Z", "author": "m-wada@usa.com"}, {"time": "2011-12-08T07:56:11Z", "creation_time": "2011-12-08T07:56:11Z", "creator": "m-wada@usa.com", "author": "m-wada@usa.com", "id": 5899936, "count": 10, "is_private": false, "tags": [], "text": "If rename of search folder, problem of \"two identical search folder\" of this bug doesn't occur. Phenomenon is \"valid(after rename) search folder\" and \"garbled IMAP folder\" after restart of Tb until normal IMAP server access.\n\n(1) Search folder : ABC DEF<pqr>, msf=ABC DEFb613412b.msf, uri= /ABC%20DEF%3Cpqr%3E\n(2) Rename to ABC GHI<pqr>, msf=ABC GHIaee9f26c.msf, uri= /ABC%20GHI%3Cpqr%3E. Garbled file of ABC DEFb613412b.msf is created by Tb. Content is ordinal .msf.\n(3) Restart Tb. Server access is not done just after restart(-offline, no automatic new mail check, or IMAP folder is not selected upon termination, etc.)\n   => IMAP folder of \"ABC DEFb613412b\" is shown at folder pane.\n(4) Click Inbox => IMAP folder of \"ABC DEFb613412b\" dissappears and \"ABC DEFb613412b.msf\" is erased by Tb, because such IMAP folder doesn't exist at server.", "bug_id": 707730, "attachment_id": null, "raw_text": "If rename of search folder, problem of \"two identical search folder\" of this bug doesn't occur. Phenomenon is \"valid(after rename) search folder\" and \"garbled IMAP folder\" after restart of Tb until normal IMAP server access.\n\n(1) Search folder : ABC DEF<pqr>, msf=ABC DEFb613412b.msf, uri= /ABC%20DEF%3Cpqr%3E\n(2) Rename to ABC GHI<pqr>, msf=ABC GHIaee9f26c.msf, uri= /ABC%20GHI%3Cpqr%3E. Garbled file of ABC DEFb613412b.msf is created by Tb. Content is ordinal .msf.\n(3) Restart Tb. Server access is not done just after restart(-offline, no automatic new mail check, or IMAP folder is not selected upon termination, etc.)\n   => IMAP folder of \"ABC DEFb613412b\" is shown at folder pane.\n(4) Click Inbox => IMAP folder of \"ABC DEFb613412b\" dissappears and \"ABC DEFb613412b.msf\" is erased by Tb, because such IMAP folder doesn't exist at server."}, {"creator": "m-wada@usa.com", "creation_time": "2011-12-08T08:30:43Z", "time": "2011-12-08T08:30:43Z", "author": "m-wada@usa.com", "is_private": false, "id": 5899996, "count": 11, "tags": [], "bug_id": 707730, "text": "(In addition to comment #10)\nGarbled \"ABC DEFb613412b.msf\" is somehow not deleted Tb sometimes, although I saw deletion by Tb sometimes.\nIt may depend on .msf content.\n(i) msf is created as file for folder name of \"ABC DEF<pqr>\" by Tb.\nFollowing line is seen in .msf, because file name != folder name.\n> <(80=1)(81=ABC%20DEF%3Cpqr%3E)>\n(ii) msf is created as file for folder name of \"ABC DEFb613412b\" by Tb.\nBecause file name = folder name, folder name data is not written in .msf by Tb.\n\"Not automatically deleted\" may be phenomenon on above (i).", "attachment_id": null, "raw_text": "(In addition to comment #10)\nGarbled \"ABC DEFb613412b.msf\" is somehow not deleted Tb sometimes, although I saw deletion by Tb sometimes.\nIt may depend on .msf content.\n(i) msf is created as file for folder name of \"ABC DEF<pqr>\" by Tb.\nFollowing line is seen in .msf, because file name != folder name.\n> <(80=1)(81=ABC%20DEF%3Cpqr%3E)>\n(ii) msf is created as file for folder name of \"ABC DEFb613412b\" by Tb.\nBecause file name = folder name, folder name data is not written in .msf by Tb.\n\"Not automatically deleted\" may be phenomenon on above (i)."}, {"author": "list@incunabulum.de", "creator": "list@incunabulum.de", "creation_time": "2011-12-08T18:32:41Z", "time": "2011-12-08T18:32:41Z", "is_private": false, "id": 5901293, "count": 12, "bug_id": 707730, "text": "Wada, \n\nthanks for looking into it in such detail. Comment #9 seems to nail the behavior spot on. Oherwise your detailed observations have more or less lost me.\n\nIs there anything else that I can do to help clarify this issue? If so, please ask.", "tags": [], "raw_text": "Wada, \n\nthanks for looking into it in such detail. Comment #9 seems to nail the behavior spot on. Oherwise your detailed observations have more or less lost me.\n\nIs there anything else that I can do to help clarify this issue? If so, please ask.", "attachment_id": null}, {"is_private": false, "id": 5903262, "count": 13, "creator": "m-wada@usa.com", "time": "2011-12-09T04:04:11Z", "creation_time": "2011-12-09T04:04:11Z", "author": "m-wada@usa.com", "attachment_id": null, "raw_text": "(In addition to comment #9)\nEven if uri=imap:// ... /ABC DEFb613412b is generated by Tb, it is replaced by uri=imap:// ... /ABC%20DEFb613412b sooner or later(by property update, termination of Tb, ...). This is true even on manually crafted uri=imap:// ... /ABC DEF%3Cpqr%3E. /ABC DEF%3Cpqr%3E is replaced by ABC%20DEF%3Cpqr%3E sooner or later by Tb. And, even if both of escaped version and unescaped verson is written manually, unescaped verson is removed by Tb sooner or later.\n\nThese are applicable to uri=imap:// ... /bla bla. When this bug's uri=imap:// ... /bla bla and uri=imap:// ... /bla%20bla case, uri=imap:// ... /bla bla is removed sooner or later, because \"/bla bla\" == \"/bla%20bla\" after unescape. And, duplicated \"bla bla\" disappears from folder pane after restart of Tb, even if duplicated \"bla bla\" is shown by this bug.\n\nIn contrast to it, because enescaped /ABC%20DEF%3Cpqr%3E != unescaped /ABC%20DEFb613412b, both \"ABC DEF<pqr>\" and \"ABC DEFb613412b\" are shown at folder pane forever, unless /ABC DEFb613412b or /ABC%20DEFb613412b is deleted by user or by Tb(effect of bug 705080).", "text": "(In addition to comment #9)\nEven if uri=imap:// ... /ABC DEFb613412b is generated by Tb, it is replaced by uri=imap:// ... /ABC%20DEFb613412b sooner or later(by property update, termination of Tb, ...). This is true even on manually crafted uri=imap:// ... /ABC DEF%3Cpqr%3E. /ABC DEF%3Cpqr%3E is replaced by ABC%20DEF%3Cpqr%3E sooner or later by Tb. And, even if both of escaped version and unescaped verson is written manually, unescaped verson is removed by Tb sooner or later.\n\nThese are applicable to uri=imap:// ... /bla bla. When this bug's uri=imap:// ... /bla bla and uri=imap:// ... /bla%20bla case, uri=imap:// ... /bla bla is removed sooner or later, because \"/bla bla\" == \"/bla%20bla\" after unescape. And, duplicated \"bla bla\" disappears from folder pane after restart of Tb, even if duplicated \"bla bla\" is shown by this bug.\n\nIn contrast to it, because enescaped /ABC%20DEF%3Cpqr%3E != unescaped /ABC%20DEFb613412b, both \"ABC DEF<pqr>\" and \"ABC DEFb613412b\" are shown at folder pane forever, unless /ABC DEFb613412b or /ABC%20DEFb613412b is deleted by user or by Tb(effect of bug 705080).", "bug_id": 707730, "tags": []}, {"attachment_id": null, "raw_text": "(In reply to list from comment #12)\n> Is there anything else that I can do to help clarify this issue?\n\nWhat did you do just before you saw problem of this bug?\n\nAs I said before, I could see this bug's phenomenon by intentional manual deletion of panacea.dat only.\nAnd, when I manually deleted .msf file with keeping virtualFolders.dat correct, I could always see automatic recovery by Tb(automatic re-creation of .msf file from definition in virtualFolders.dat). This is true even when I did next.\n- delete bla bla.msf,\n- put both uri=//imap: ... /bla bla and uri=//imap: ... /bla%20bla\nAfter restart of Tb, bla bla.msf is created, \"bla bla\" is shown at folder pane and is normally accecible, and only uri=//imap: ... /bla%20bla is written by termiation of Tb.\nSo, I couldn't imagine reason why uri=//imap: ... /bla bla is added by Tb in your environment.", "bug_id": 707730, "text": "(In reply to list from comment #12)\n> Is there anything else that I can do to help clarify this issue?\n\nWhat did you do just before you saw problem of this bug?\n\nAs I said before, I could see this bug's phenomenon by intentional manual deletion of panacea.dat only.\nAnd, when I manually deleted .msf file with keeping virtualFolders.dat correct, I could always see automatic recovery by Tb(automatic re-creation of .msf file from definition in virtualFolders.dat). This is true even when I did next.\n- delete bla bla.msf,\n- put both uri=//imap: ... /bla bla and uri=//imap: ... /bla%20bla\nAfter restart of Tb, bla bla.msf is created, \"bla bla\" is shown at folder pane and is normally accecible, and only uri=//imap: ... /bla%20bla is written by termiation of Tb.\nSo, I couldn't imagine reason why uri=//imap: ... /bla bla is added by Tb in your environment.", "tags": [], "count": 14, "id": 5903305, "is_private": false, "creation_time": "2011-12-09T04:29:19Z", "time": "2011-12-09T04:29:19Z", "creator": "m-wada@usa.com", "author": "m-wada@usa.com"}, {"attachment_id": null, "raw_text": "I tested with root level search folder, and I could not see this bug on root level \"bla bla\" by profile copy, so I always checked with \"delete panacea.dat\" and didn't ask you about profile copy although I thought this bug could occur by profile copy.\nI cheked with all of root level \"bla bla\", \"bla bla\" under IMAP folder, root level \"...<pqr>\", \"...<pqr>\" under IMAP folder, and I could consistently see this bug on \"bla bla\" and \"...<pqr>\" under IMAP folder by profile copy.\n\nlist@incunabulum.de, did you copy Tb's profile and started Tb with the copied profile?", "tags": [], "text": "I tested with root level search folder, and I could not see this bug on root level \"bla bla\" by profile copy, so I always checked with \"delete panacea.dat\" and didn't ask you about profile copy although I thought this bug could occur by profile copy.\nI cheked with all of root level \"bla bla\", \"bla bla\" under IMAP folder, root level \"...<pqr>\", \"...<pqr>\" under IMAP folder, and I could consistently see this bug on \"bla bla\" and \"...<pqr>\" under IMAP folder by profile copy.\n\nlist@incunabulum.de, did you copy Tb's profile and started Tb with the copied profile?", "bug_id": 707730, "count": 15, "id": 5903504, "is_private": false, "time": "2011-12-09T06:48:55Z", "creation_time": "2011-12-09T06:48:55Z", "creator": "m-wada@usa.com", "author": "m-wada@usa.com"}, {"author": "list@incunabulum.de", "time": "2011-12-09T20:47:52Z", "creation_time": "2011-12-09T20:47:52Z", "creator": "list@incunabulum.de", "id": 5905114, "count": 16, "is_private": false, "tags": [], "bug_id": 707730, "text": "What did I do just before this issue occured for the first time? \n\nWell, difficult to say. Nothing special. I specifically did not edit or manually change any file within thunderbirds profile folder or changed some other system setting (kernel, desktop setting, whatever). I probably closed thunderird, restarted the computer and later started thunderbird again. \n\nAs I thought this is only a temporary issue this is hard to remember. There might have been a thunderbird upgrade via the automated package managemet, though.\n\nUpdate:\nI just added a new user, logged in as this user, started thunderbird, added the imap account where I have problems and then created a search folder \"bla bla\" as mentioned above. Result: No duplicate folders. Not even after multiple restarts.\n\nSo, this seems to be a problem with my profile (or my personal desktop / whatever configuration) and not with TB in general.\n\nRegarding #15:\nWhat should I copy? The complete profile folder and then start the new profile via the -p option?\nOr would it be an option to create a new profile in additon to the existing one, add the problematic imap account and create the search folder there? How do I do this?", "raw_text": "What did I do just before this issue occured for the first time? \n\nWell, difficult to say. Nothing special. I specifically did not edit or manually change any file within thunderbirds profile folder or changed some other system setting (kernel, desktop setting, whatever). I probably closed thunderird, restarted the computer and later started thunderbird again. \n\nAs I thought this is only a temporary issue this is hard to remember. There might have been a thunderbird upgrade via the automated package managemet, though.\n\nUpdate:\nI just added a new user, logged in as this user, started thunderbird, added the imap account where I have problems and then created a search folder \"bla bla\" as mentioned above. Result: No duplicate folders. Not even after multiple restarts.\n\nSo, this seems to be a problem with my profile (or my personal desktop / whatever configuration) and not with TB in general.\n\nRegarding #15:\nWhat should I copy? The complete profile folder and then start the new profile via the -p option?\nOr would it be an option to create a new profile in additon to the existing one, add the problematic imap account and create the search folder there? How do I do this?", "attachment_id": null}, {"raw_text": "(In reply to list from comment #16)\n> What should I copy?\n> The complete profile folder and then start the new profile via the -p option?\n\nYes, it is what I called \"profile copy\".\n(1) Copy Tb's profile directory which has definition of \"bla bla\" to a directory.\n(2) Add the copied directory as new profile by profile manager, Create Profile/Choose Folder.\n(3) Start Tb with the new profile in offline mode to intentionally stop server connection after restart, thunderbird.exe -offline -p \"copied-profile-name\".\nYou perhaps can see duplicated \"bla bla\".\n(4) Go online mode by File/Offline/uncheck Work Ofline, and click an IMAP folder to force ordinal IMAP server access, then terminate Tb.\nYou perhaps can see \"uri= .../bla bla\" in virtualFolders.dat.\n\nIf you create serach folder named \"bla bla<bla>\" before profile directory copy, you perhaps can see duplicated \"bla bla...\" by any restart of Tb.", "attachment_id": null, "tags": [], "bug_id": 707730, "text": "(In reply to list from comment #16)\n> What should I copy?\n> The complete profile folder and then start the new profile via the -p option?\n\nYes, it is what I called \"profile copy\".\n(1) Copy Tb's profile directory which has definition of \"bla bla\" to a directory.\n(2) Add the copied directory as new profile by profile manager, Create Profile/Choose Folder.\n(3) Start Tb with the new profile in offline mode to intentionally stop server connection after restart, thunderbird.exe -offline -p \"copied-profile-name\".\nYou perhaps can see duplicated \"bla bla\".\n(4) Go online mode by File/Offline/uncheck Work Ofline, and click an IMAP folder to force ordinal IMAP server access, then terminate Tb.\nYou perhaps can see \"uri= .../bla bla\" in virtualFolders.dat.\n\nIf you create serach folder named \"bla bla<bla>\" before profile directory copy, you perhaps can see duplicated \"bla bla...\" by any restart of Tb.", "count": 17, "id": 5905570, "is_private": false, "author": "m-wada@usa.com", "time": "2011-12-09T23:23:05Z", "creation_time": "2011-12-09T23:23:05Z", "creator": "m-wada@usa.com"}, {"attachment_id": null, "raw_text": "(In reply to list from comment #4)\n> In virtualfolders.dat I have two entries (partially cleaned for privacy\n> purposed) as follows:\n> uri=imap://[removed]/bla bla\n> searchOnline=false\n> uri=imap://[removed]/bla%20bla\n> searchOnline=false\n\nWhat is characteristics of \"[removed]\" part in your case?\n\nFollowing was observed.\n(1) IMAP folder of \"A B\" uses file of \"A B-1.msf\" instead of \"A B.msf\".\n    This occurs by next on Win/NTFS;\n    (1-A) Server supports case insensitive folder name.\n          Create IMAP folder \"a b\" => \"a b.msf\" is used by Tb.\n          Create IMAP folder \"A B\" => \"A B-1.msf\" is used by Tb.\n          On Win, file of \"A B.msf\" == file of \"a b.msf\", so suffix is added.\n          If \"A b\"   is created after above, \"A b-2.msf  \" is used.\n          If \"A B-1\" is created after above, \"A B-1-1.msf\" is used.\n    (1-B) By bug 520437. \n          Create folder \"A B\", Unsubscribe \"A B\", and Subscribe \"A B\" again.\n    (1-C) Copy profile, restart Tb using copied profile in offline mode\n          (==server is unreachiable), and restart Tb again, access IMAP server.\n(2) Create search folder \"bla bla\" under IMAP folder of \"A B\".\n    => \"bla.bla.msf is created under \"a b.sbd\".\n    => uri=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/A B/bla%20bla\n(3) Create MAP folder \"Sub\" under IMAP folder of \"A B\".\n    => \"Sub.msf is created under \"A B-1.sbd\", as expected.\nIf this kind of problem exists, problem of this bug may happen.", "tags": [], "text": "(In reply to list from comment #4)\n> In virtualfolders.dat I have two entries (partially cleaned for privacy\n> purposed) as follows:\n> uri=imap://[removed]/bla bla\n> searchOnline=false\n> uri=imap://[removed]/bla%20bla\n> searchOnline=false\n\nWhat is characteristics of \"[removed]\" part in your case?\n\nFollowing was observed.\n(1) IMAP folder of \"A B\" uses file of \"A B-1.msf\" instead of \"A B.msf\".\n    This occurs by next on Win/NTFS;\n    (1-A) Server supports case insensitive folder name.\n          Create IMAP folder \"a b\" => \"a b.msf\" is used by Tb.\n          Create IMAP folder \"A B\" => \"A B-1.msf\" is used by Tb.\n          On Win, file of \"A B.msf\" == file of \"a b.msf\", so suffix is added.\n          If \"A b\"   is created after above, \"A b-2.msf  \" is used.\n          If \"A B-1\" is created after above, \"A B-1-1.msf\" is used.\n    (1-B) By bug 520437. \n          Create folder \"A B\", Unsubscribe \"A B\", and Subscribe \"A B\" again.\n    (1-C) Copy profile, restart Tb using copied profile in offline mode\n          (==server is unreachiable), and restart Tb again, access IMAP server.\n(2) Create search folder \"bla bla\" under IMAP folder of \"A B\".\n    => \"bla.bla.msf is created under \"a b.sbd\".\n    => uri=imap://boyacky%40rocketmail.com@imap.mail.yahoo.com/A B/bla%20bla\n(3) Create MAP folder \"Sub\" under IMAP folder of \"A B\".\n    => \"Sub.msf is created under \"A B-1.sbd\", as expected.\nIf this kind of problem exists, problem of this bug may happen.", "bug_id": 707730, "count": 18, "id": 5906117, "is_private": false, "creation_time": "2011-12-10T06:41:26Z", "time": "2011-12-10T06:41:26Z", "creator": "m-wada@usa.com", "author": "m-wada@usa.com"}, {"author": "m-wada@usa.com", "time": "2011-12-10T07:52:21Z", "creation_time": "2011-12-10T07:52:21Z", "creator": "m-wada@usa.com", "id": 5906199, "count": 19, "is_private": false, "text": "FYI. I've opened bug 709449 for phenomenon of comment #18.", "bug_id": 707730, "tags": [], "raw_text": "FYI. I've opened bug 709449 for phenomenon of comment #18.", "attachment_id": null}, {"author": "m-wada@usa.com", "creation_time": "2011-12-11T06:59:35Z", "time": "2011-12-11T06:59:35Z", "creator": "m-wada@usa.com", "id": 5906991, "count": 20, "is_private": false, "text": "Quick summary.\n\nThis bug's phenomenon is;\n  (A1) Unescaped Search folder name  : ABC DEF<pqr>\n  (A2) Escaped Search folder name    : ABC%20DEF%3Cpqr%3E\n  (B1) Unescaped msf file name       : ABC DEFb613412b\n  (B2) Escaped msf file name         : ABC%20DEFb613412b\n(1) If (B1) != (A2), search folder named (A1) and (B1) is shown at folder pane upon restart, and \"uri with enescaped (B1)\" is written to virtualFolders.dat in addition to proper/escaped \"uri with (A2)\".\nIf \"bla bla\", (A1)==(B1), so duplicated search folder is shown at folder pane.\n(2) \"uri with enescaped (B1)\" is replaced by correct \"uri with escaped (B2)\" sooner or later.\n(3-1) If (B2) == (A2), only single \"uri with (A2)==(B2)\" is kept in virtualFolders.dat, and only single search folder of (A1)==(B1) is shown at folder pane after restart.\n(3-2) If (B2) != (A2), both \"uri with (A2)\" and \"uri with (B2)\" are kept in virtualFolders.dat, and both search folder of (A1) and (B1) are shown at folder pane forever, and same (B1).msf file is shared by search folder of (A1) and (B1).\n\n(i) Ordinal ascii folder\n    (A1)=foo  ==  (A2)=foo == (B1)=foo ==  (B2)=foo \n    (B1) == (A2) : This bug doesn't occur\n    (B2) == (A2) : Irrelevant   \n(ii) escaped string != unecaped string(e.g. space)\n    (A1)=x y != (A2)=x%20y, (B1)=x y != (B2)=x%20y\n    (B1) != (A2) : This bug can occur\n    (B2) == (A2) : Duplicated search folder disappears fter restart   \n(iii) hashed file name is used for msf file due to special chars\n    without char needs to escape\n      (A1)=x+special == (A2)=x+special, (B1)=x+hash == (B2)=x+hash\n    with chars need to escape\n      (A1)=x+special != (A2)=esc(x+special), (B1)=x+hash != (B2)=esc(x+hash)\n    (B1) != (A2) : This bug can occur\n    (B2) != (A2) : Multiple search folders remain, with sharing same (B1).msf.\n\nThis bug's phenomenon can be produced by;\n(a) Use of copied profile.\n    Absolute path of .msf for folder in panaca.dat is wrong in copied profile.\n(b) Delete of panacea.dat.\n    Pointer to .msf file for search folder doesn't exist in panacea.dat.\nWhy this bug occurs in ordinal use of Tb is not found yet.", "bug_id": 707730, "tags": [], "raw_text": "Quick summary.\n\nThis bug's phenomenon is;\n  (A1) Unescaped Search folder name  : ABC DEF<pqr>\n  (A2) Escaped Search folder name    : ABC%20DEF%3Cpqr%3E\n  (B1) Unescaped msf file name       : ABC DEFb613412b\n  (B2) Escaped msf file name         : ABC%20DEFb613412b\n(1) If (B1) != (A2), search folder named (A1) and (B1) is shown at folder pane upon restart, and \"uri with enescaped (B1)\" is written to virtualFolders.dat in addition to proper/escaped \"uri with (A2)\".\nIf \"bla bla\", (A1)==(B1), so duplicated search folder is shown at folder pane.\n(2) \"uri with enescaped (B1)\" is replaced by correct \"uri with escaped (B2)\" sooner or later.\n(3-1) If (B2) == (A2), only single \"uri with (A2)==(B2)\" is kept in virtualFolders.dat, and only single search folder of (A1)==(B1) is shown at folder pane after restart.\n(3-2) If (B2) != (A2), both \"uri with (A2)\" and \"uri with (B2)\" are kept in virtualFolders.dat, and both search folder of (A1) and (B1) are shown at folder pane forever, and same (B1).msf file is shared by search folder of (A1) and (B1).\n\n(i) Ordinal ascii folder\n    (A1)=foo  ==  (A2)=foo == (B1)=foo ==  (B2)=foo \n    (B1) == (A2) : This bug doesn't occur\n    (B2) == (A2) : Irrelevant   \n(ii) escaped string != unecaped string(e.g. space)\n    (A1)=x y != (A2)=x%20y, (B1)=x y != (B2)=x%20y\n    (B1) != (A2) : This bug can occur\n    (B2) == (A2) : Duplicated search folder disappears fter restart   \n(iii) hashed file name is used for msf file due to special chars\n    without char needs to escape\n      (A1)=x+special == (A2)=x+special, (B1)=x+hash == (B2)=x+hash\n    with chars need to escape\n      (A1)=x+special != (A2)=esc(x+special), (B1)=x+hash != (B2)=esc(x+hash)\n    (B1) != (A2) : This bug can occur\n    (B2) != (A2) : Multiple search folders remain, with sharing same (B1).msf.\n\nThis bug's phenomenon can be produced by;\n(a) Use of copied profile.\n    Absolute path of .msf for folder in panaca.dat is wrong in copied profile.\n(b) Delete of panacea.dat.\n    Pointer to .msf file for search folder doesn't exist in panacea.dat.\nWhy this bug occurs in ordinal use of Tb is not found yet.", "attachment_id": null}, {"time": "2011-12-11T16:07:04Z", "creation_time": "2011-12-11T16:07:04Z", "creator": "list@incunabulum.de", "author": "list@incunabulum.de", "id": 5907220, "count": 21, "is_private": false, "text": "Regarding comment #18:\n\n> What is characteristics of \"[removed]\" part in your case?\n\nThe virtualfolders.dat entry looks as follows:\nuri=imap://cz%40somename.de@mail.somedomain.de/bla bla\nscope=imap://cz%40somename.de@mail.somedomainde/INBOX\nterms=ALL\nsearchOnline=false\n\nBut I don't think that this is the problem in my case as the parent folder of the search is just the mailbox directoy mail.somedomain.de. Due to multiple accounts, there are also mail.somedomain.de-1, mail.somedomain-2.de etc.\n\nAnd I can't access bug 709449. Access denied. But thanks for looking into this into such great detail. Thank you.\n\nToday, I did some experiments as well on my machine (linux, english language, german keyboard).\n\n1) Current user, current profile -> search folder with space shown twice\n2) New user, new empy profile -> search folder is shown only once\n3) current user, new profile -> search folder only shown once\n4) current user, copy of current profile -> search folder is shown twice\n\nSo, I somehow corrupted my profile (as it seems) which lead to search folders being shown twice. The panacea.dat lists the correct paths to the profile, though. \n\nAny clues how to decorrupt / fix my profile=", "bug_id": 707730, "tags": [], "attachment_id": null, "raw_text": "Regarding comment #18:\n\n> What is characteristics of \"[removed]\" part in your case?\n\nThe virtualfolders.dat entry looks as follows:\nuri=imap://cz%40somename.de@mail.somedomain.de/bla bla\nscope=imap://cz%40somename.de@mail.somedomainde/INBOX\nterms=ALL\nsearchOnline=false\n\nBut I don't think that this is the problem in my case as the parent folder of the search is just the mailbox directoy mail.somedomain.de. Due to multiple accounts, there are also mail.somedomain.de-1, mail.somedomain-2.de etc.\n\nAnd I can't access bug 709449. Access denied. But thanks for looking into this into such great detail. Thank you.\n\nToday, I did some experiments as well on my machine (linux, english language, german keyboard).\n\n1) Current user, current profile -> search folder with space shown twice\n2) New user, new empy profile -> search folder is shown only once\n3) current user, new profile -> search folder only shown once\n4) current user, copy of current profile -> search folder is shown twice\n\nSo, I somehow corrupted my profile (as it seems) which lead to search folders being shown twice. The panacea.dat lists the correct paths to the profile, though. \n\nAny clues how to decorrupt / fix my profile="}, {"author": "m-wada@usa.com", "time": "2011-12-11T17:13:40Z", "creation_time": "2011-12-11T17:13:40Z", "creator": "m-wada@usa.com", "count": 22, "id": 5907290, "is_private": false, "text": "> And I can't access bug 709449. Access denied.\n\nSorry, I seems to have set as \"Secutity bug\" by my mitake when I opened that bug.  As that bug had fortunately \"Reporter/CC member can view\" flag=on setting by default, I added you in CC list of that bug.", "bug_id": 707730, "tags": [], "raw_text": "> And I can't access bug 709449. Access denied.\n\nSorry, I seems to have set as \"Secutity bug\" by my mitake when I opened that bug.  As that bug had fortunately \"Reporter/CC member can view\" flag=on setting by default, I added you in CC list of that bug.", "attachment_id": null}, {"raw_text": "(In reply to list from comment #21)\n> The virtualfolders.dat entry looks as follows:\n> uri=imap://cz%40somename.de@mail.somedomain.de/bla bla\n> scope=imap://cz%40somename.de@mail.somedomainde/INBOX\n\nOnly root level folder is releant to your search folder.\nIf so, next may be relevant.\n  When Subscribe is requested, mail.somedomain.de.msf is created.\n  After subscribe, this file can't be deleted,. After restart of Tb,\n  this file can be deleted durig Tb is running, unless subscribe is requested. \nThis indicates local directory of mail.somedomain.de is internaly accessed as if mail folder by Tb. Error while subscribe relevant process(lsub command process etc.) may cause temporary loss of files for mail folders.\nAnd, temporary loss of file for parent folder of a search folder may cause temporary loss of file for the search folder.\n\nNew observation.\nIf \"x y z\", \"X y z\", \"X Y z\", \"X Y Z\" is created in this order, \"x y z.msf\", \"X y z-1.msf\", \"X Y z-2.msf\", \"X Y Z-3.msf is used respectively.\nHowever, if these files are deleted or parent .sbd is deleted, .msf file are re-created after server access(after lsub, list).\nAs list or lsub response is usually alphabetic order, \"X Y Z.msf\", \"X Y z-1.msf\", \"X y z-2.msf\", \"x y z-3.msf\" is created for \"X Y Z\", \"X Y z\", \"X y z\", \"x y z\" respectively.\nBecause \"X y z-1.msf\" and \"X Y z-1.msf\" is same file in Win's file system, if some files are restored from backup, wrong file can be accessed, even if \"profile copy\" or \"delete of panacea.dat\" is not executed.\n\nManual .msf file deletion, .msf file copy, .sbd directory deletion etc. may be a cause of problem like this bug. Interfere by anti-virus software, auto-backup software, read-open of .msf file usually, may be also a cause of problem like ths bug, because it causes failure of write-open of .msf file by Tb.\n\nAnyway, please define search folder like \"A B<C>\" in your daily use profile. Because both of \"A B<C>\" and \"A B357de86d\" appears if problem occurs again, and \"A B357de86d\" won't be removed unless you delete \"uri=imap: .../A%20B357de86d\" from virtualFolders.dat, you'll be aware of this bug always if this bug will happen again.", "attachment_id": null, "bug_id": 707730, "text": "(In reply to list from comment #21)\n> The virtualfolders.dat entry looks as follows:\n> uri=imap://cz%40somename.de@mail.somedomain.de/bla bla\n> scope=imap://cz%40somename.de@mail.somedomainde/INBOX\n\nOnly root level folder is releant to your search folder.\nIf so, next may be relevant.\n  When Subscribe is requested, mail.somedomain.de.msf is created.\n  After subscribe, this file can't be deleted,. After restart of Tb,\n  this file can be deleted durig Tb is running, unless subscribe is requested. \nThis indicates local directory of mail.somedomain.de is internaly accessed as if mail folder by Tb. Error while subscribe relevant process(lsub command process etc.) may cause temporary loss of files for mail folders.\nAnd, temporary loss of file for parent folder of a search folder may cause temporary loss of file for the search folder.\n\nNew observation.\nIf \"x y z\", \"X y z\", \"X Y z\", \"X Y Z\" is created in this order, \"x y z.msf\", \"X y z-1.msf\", \"X Y z-2.msf\", \"X Y Z-3.msf is used respectively.\nHowever, if these files are deleted or parent .sbd is deleted, .msf file are re-created after server access(after lsub, list).\nAs list or lsub response is usually alphabetic order, \"X Y Z.msf\", \"X Y z-1.msf\", \"X y z-2.msf\", \"x y z-3.msf\" is created for \"X Y Z\", \"X Y z\", \"X y z\", \"x y z\" respectively.\nBecause \"X y z-1.msf\" and \"X Y z-1.msf\" is same file in Win's file system, if some files are restored from backup, wrong file can be accessed, even if \"profile copy\" or \"delete of panacea.dat\" is not executed.\n\nManual .msf file deletion, .msf file copy, .sbd directory deletion etc. may be a cause of problem like this bug. Interfere by anti-virus software, auto-backup software, read-open of .msf file usually, may be also a cause of problem like ths bug, because it causes failure of write-open of .msf file by Tb.\n\nAnyway, please define search folder like \"A B<C>\" in your daily use profile. Because both of \"A B<C>\" and \"A B357de86d\" appears if problem occurs again, and \"A B357de86d\" won't be removed unless you delete \"uri=imap: .../A%20B357de86d\" from virtualFolders.dat, you'll be aware of this bug always if this bug will happen again.", "tags": [], "id": 5907628, "count": 23, "is_private": false, "author": "m-wada@usa.com", "time": "2011-12-12T00:26:43Z", "creation_time": "2011-12-12T00:26:43Z", "creator": "m-wada@usa.com"}, {"raw_text": "FYI. I've opened bug 709637 for issue of comment #20.", "attachment_id": null, "tags": [], "bug_id": 707730, "text": "FYI. I've opened bug 709637 for issue of comment #20.", "id": 5907722, "count": 24, "is_private": false, "author": "m-wada@usa.com", "time": "2011-12-12T02:00:03Z", "creation_time": "2011-12-12T02:00:03Z", "creator": "m-wada@usa.com"}, {"author": "m-wada@usa.com", "time": "2011-12-13T01:59:10Z", "creation_time": "2011-12-13T01:59:10Z", "creator": "m-wada@usa.com", "id": 5911041, "count": 25, "is_private": false, "tags": [], "bug_id": 707730, "text": "Simpler way to reproduce this bug's phenomenon.\n(1) Terminate Tb, (a) copy .msf file for an active search folder to \"bla bla.msf\", (b) manually add \"uri=imap:// ...\" entry for \"bla bla\" in virtualFolders.dat.\n(2) Restart Tb => two \"bla bla\" are shown. both uses same \"bla bla.msf\".\n(3) Restart Tb => only one \"bla bla\" is shown.\n(4) virtualFolders.dat entry is changed to single \"uri=imap:// ... /bla%20bla\" only sooner or later.\n\nIf \"uri=imap:// ... /bla%20bla\" is manually added, new entry of \"uri=imap:// ... /bla bla\" is seen after termination of Tb. \nIf \"uri=imap:// ... /bla bla\" is manually added, this entry remains after termination of Tb.\nIn both cases, duplicated \"bla bla\" is shown.\n\nIn this test case, both of next happens at same time.\n(i) Recovery of unknown search folder from existent/valid .msf file for sarch folder. Search folder name is .msf file name, and search rule is obtained from .msf file content. In this process, it looks that escaping of folder name is not done when entry is added to virtualFolders.dat.\n(ii) Re-creation of .msf file for search folder defined in virtualFolders.dat when .msf file for the search folder is unknown or not found.\nI think it's same in \"copied profile use\" case and \"panacea.dat delete\" case.\n\nIn this test case, following were observed during testing.\n(1) duplicated search folder named \"bla bla\"\n    => sooner or later, changd to single \"bla bla\"\n(2) single search folder named \"bla%20bla\"\n    => sooner or later, changd to expected \"bla bla\"\n(3) single IMAP folder(non-existent) named \"bla%20bla\"\n    => disappers after server access, because non-existent folder\nPhenomenon looks to depend on copied .msf file content and remained garbage data in panacea.dat file which is relevant to \"bla bla.msf\", \"bla bla\", and \"bla%20bla\".", "raw_text": "Simpler way to reproduce this bug's phenomenon.\n(1) Terminate Tb, (a) copy .msf file for an active search folder to \"bla bla.msf\", (b) manually add \"uri=imap:// ...\" entry for \"bla bla\" in virtualFolders.dat.\n(2) Restart Tb => two \"bla bla\" are shown. both uses same \"bla bla.msf\".\n(3) Restart Tb => only one \"bla bla\" is shown.\n(4) virtualFolders.dat entry is changed to single \"uri=imap:// ... /bla%20bla\" only sooner or later.\n\nIf \"uri=imap:// ... /bla%20bla\" is manually added, new entry of \"uri=imap:// ... /bla bla\" is seen after termination of Tb. \nIf \"uri=imap:// ... /bla bla\" is manually added, this entry remains after termination of Tb.\nIn both cases, duplicated \"bla bla\" is shown.\n\nIn this test case, both of next happens at same time.\n(i) Recovery of unknown search folder from existent/valid .msf file for sarch folder. Search folder name is .msf file name, and search rule is obtained from .msf file content. In this process, it looks that escaping of folder name is not done when entry is added to virtualFolders.dat.\n(ii) Re-creation of .msf file for search folder defined in virtualFolders.dat when .msf file for the search folder is unknown or not found.\nI think it's same in \"copied profile use\" case and \"panacea.dat delete\" case.\n\nIn this test case, following were observed during testing.\n(1) duplicated search folder named \"bla bla\"\n    => sooner or later, changd to single \"bla bla\"\n(2) single search folder named \"bla%20bla\"\n    => sooner or later, changd to expected \"bla bla\"\n(3) single IMAP folder(non-existent) named \"bla%20bla\"\n    => disappers after server access, because non-existent folder\nPhenomenon looks to depend on copied .msf file content and remained garbage data in panacea.dat file which is relevant to \"bla bla.msf\", \"bla bla\", and \"bla%20bla\".", "attachment_id": null}, {"author": "rvtol@isolution.nl", "creation_time": "2016-05-01T08:38:55Z", "time": "2016-05-01T08:38:55Z", "creator": "rvtol@isolution.nl", "id": 11372381, "count": 26, "is_private": false, "tags": [], "text": "I have the same issue, with folder names like '@pete'.", "bug_id": 707730, "raw_text": "I have the same issue, with folder names like '@pete'.", "attachment_id": null}]}}}