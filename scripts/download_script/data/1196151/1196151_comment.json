{"bugs": {"1196151": {"comments": [{"count": 0, "time": "2015-08-19T08:22:09Z", "creation_time": "2015-08-19T08:22:09Z", "id": 10634259, "raw_text": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36\n\nSteps to reproduce:\n\n1. Register a custom protocol handler using navigator.registerProtocolHandler.\n2. Set an iframe's src to a URI of the custom protocol.\n\nAttached repro.zip which creates these conditions. To use it:\n\n1. Serve on localhost:8000 (eg. python -m SimpleHTTPServer 8000).\n2. Navigate to http://localhost:8000. A bar appears at the top; click Add Application to add the site as a handler for \"web+foo\" links.\n3. Click \"click here\". A dialog appears, asking which application to use. Choose Protocol Handler Test.\n\n\nActual results:\n\nThe handler page (\"I just handled the protocol\") opens in a new tab.\n\n\nExpected results:\n\nThe handler page (\"I just handled the protocol\") appears inside the iframe.\n\nNote: The spec [1] says \"In the case of a registered handler being used, the algorithm will be reinvoked with a new URL to handle the request.\" I take this to mean that when an iframe navigates to a registered protocol handler, it should calculate the new URL and then redirect the page within the iframe, not create a new top-level browsing context.\n\n[1] https://html.spec.whatwg.org/multipage/browsers.html#navigate\n\nWorks correctly in Google Chrome 46.", "attachment_id": 8649727, "creator": "mgiuca@chromium.org", "tags": [], "is_private": false, "bug_id": 1196151, "author": "mgiuca@chromium.org", "text": "Created attachment 8649727\nRepro site.\n\nUser Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36\n\nSteps to reproduce:\n\n1. Register a custom protocol handler using navigator.registerProtocolHandler.\n2. Set an iframe's src to a URI of the custom protocol.\n\nAttached repro.zip which creates these conditions. To use it:\n\n1. Serve on localhost:8000 (eg. python -m SimpleHTTPServer 8000).\n2. Navigate to http://localhost:8000. A bar appears at the top; click Add Application to add the site as a handler for \"web+foo\" links.\n3. Click \"click here\". A dialog appears, asking which application to use. Choose Protocol Handler Test.\n\n\nActual results:\n\nThe handler page (\"I just handled the protocol\") opens in a new tab.\n\n\nExpected results:\n\nThe handler page (\"I just handled the protocol\") appears inside the iframe.\n\nNote: The spec [1] says \"In the case of a registered handler being used, the algorithm will be reinvoked with a new URL to handle the request.\" I take this to mean that when an iframe navigates to a registered protocol handler, it should calculate the new URL and then redirect the page within the iframe, not create a new top-level browsing context.\n\n[1] https://html.spec.whatwg.org/multipage/browsers.html#navigate\n\nWorks correctly in Google Chrome 46."}, {"bug_id": 1196151, "tags": [], "is_private": false, "text": "Note: The reason I want to do this is because I found this old Mozilla blog post by Austin King [1] and wanted to try out the technique there (create an iframe with a registered protocol, then postMessage to it, allowing communication to an unknown site selected by the user). This doesn't work in Firefox because the site doesn't open in the iframe. So I am a bit confused (maybe this actually was working in Firefox in 2010).\n\n[1] https://blog.mozilla.org/webdev/2010/07/26/registerprotocolhandler-enhancing-the-federated-web/", "author": "mgiuca@chromium.org", "time": "2015-08-20T01:27:46Z", "creation_time": "2015-08-20T01:27:46Z", "id": 10638204, "count": 1, "attachment_id": null, "creator": "mgiuca@chromium.org", "raw_text": "Note: The reason I want to do this is because I found this old Mozilla blog post by Austin King [1] and wanted to try out the technique there (create an iframe with a registered protocol, then postMessage to it, allowing communication to an unknown site selected by the user). This doesn't work in Firefox because the site doesn't open in the iframe. So I am a bit confused (maybe this actually was working in Firefox in 2010).\n\n[1] https://blog.mozilla.org/webdev/2010/07/26/registerprotocolhandler-enhancing-the-federated-web/"}, {"is_private": false, "attachment_id": 8650237, "creator": "mgiuca@chromium.org", "raw_text": "Out of curiosity, I downloaded Firefox 4.0.1 (April 2011) and tested my repro case. It works, so this has regressed at some point in the last four years.", "time": "2015-08-20T01:58:14Z", "creation_time": "2015-08-20T01:58:14Z", "text": "Created attachment 8650237\nScreenshot of test case working in Firefox 4.0.1\n\nOut of curiosity, I downloaded Firefox 4.0.1 (April 2011) and tested my repro case. It works, so this has regressed at some point in the last four years.", "author": "mgiuca@chromium.org", "bug_id": 1196151, "tags": [], "id": 10638258, "count": 2}, {"is_private": false, "time": "2015-10-14T05:32:39Z", "creation_time": "2015-10-14T05:32:39Z", "raw_text": "Hmm, this seems to work in Firefox 41.0.1. (I'm a bit confused because although I didn't note it in the bug report, I'm sure I would have tested FF 41 before going back to FF 4.) However, it still doesn't work in Nightly 43 or 44. So I think this is a recent regression after all.", "attachment_id": null, "creator": "mgiuca@chromium.org", "tags": [], "bug_id": 1196151, "author": "mgiuca@chromium.org", "text": "Hmm, this seems to work in Firefox 41.0.1. (I'm a bit confused because although I didn't note it in the bug report, I'm sure I would have tested FF 41 before going back to FF 4.) However, it still doesn't work in Nightly 43 or 44. So I think this is a recent regression after all.", "count": 3, "id": 10836170}, {"attachment_id": null, "creator": "mblaney@gmail.com", "raw_text": "Hi Matt, I'm seeing the same problem on Firefox 52.2.0, but only on Linux. Did you get any further with it?\n\nMalcolm", "time": "2017-07-12T03:43:01Z", "id": 12465672, "creation_time": "2017-07-12T03:43:01Z", "count": 4, "text": "Hi Matt, I'm seeing the same problem on Firefox 52.2.0, but only on Linux. Did you get any further with it?\n\nMalcolm", "author": "mblaney@gmail.com", "bug_id": 1196151, "tags": [], "is_private": false}, {"author": "mgiuca@chromium.org", "text": "Hi Malcolm,\n\nNo I haven't looked at this recently. Note that I was using Linux when I tried it in 2015.", "tags": [], "is_private": false, "bug_id": 1196151, "raw_text": "Hi Malcolm,\n\nNo I haven't looked at this recently. Note that I was using Linux when I tried it in 2015.", "creator": "mgiuca@chromium.org", "attachment_id": null, "count": 5, "creation_time": "2017-07-12T03:54:14Z", "id": 12465679, "time": "2017-07-12T03:54:14Z"}, {"count": 6, "id": 13454276, "author": "greg@unrelenting.technology", "text": "This is still broken :(\n\nRunning Nightly on FreeBSD here. After the page opens in the tab, the e10s process where that happened seems to become frozen, some tabs become non-interactive.\n\nWorks fine in Chromium still.\n\nBTW, This exact technique is actually used in \"production\" by webactions/indie-config https://indieweb.org/indie-config which is a protocol that lets others' websites configure reply/like/repost buttons by loading a frame from your website (iframe src=\"web+action:load\").", "tags": [], "bug_id": 1196151, "raw_text": "This is still broken :(\n\nRunning Nightly on FreeBSD here. After the page opens in the tab, the e10s process where that happened seems to become frozen, some tabs become non-interactive.\n\nWorks fine in Chromium still.\n\nBTW, This exact technique is actually used in \"production\" by webactions/indie-config https://indieweb.org/indie-config which is a protocol that lets others' websites configure reply/like/repost buttons by loading a frame from your website (iframe src=\"web+action:load\").", "attachment_id": null, "creator": "greg@unrelenting.technology", "time": "2018-07-06T22:32:17Z", "creation_time": "2018-07-06T22:32:17Z", "is_private": false}, {"tags": [], "bug_id": 1196151, "author": "martijn.personal+bugzilla@gmail.com", "text": "I was discussing this with Tantek last weekend, in context of indie-config, and the behaviour described by the original bug is unchanged in Firefox Nightly 68.0a1 (2019-05-07) (64-bit) on macOS. CCing him here.", "count": 7, "id": 14102813, "is_private": false, "time": "2019-05-07T14:27:17Z", "creation_time": "2019-05-07T14:27:17Z", "raw_text": "I was discussing this with Tantek last weekend, in context of indie-config, and the behaviour described by the original bug is unchanged in Firefox Nightly 68.0a1 (2019-05-07) (64-bit) on macOS. CCing him here.", "attachment_id": null, "creator": "martijn.personal+bugzilla@gmail.com"}, {"count": 8, "id": 14804711, "tags": [], "bug_id": 1196151, "author": "gijskruitbosch+bugs@gmail.com", "text": "I think I have a fix for this.", "creation_time": "2020-05-08T14:11:15Z", "time": "2020-05-08T14:11:15Z", "raw_text": "I think I have a fix for this.", "creator": "gijskruitbosch+bugs@gmail.com", "attachment_id": null, "is_private": false}, {"is_private": false, "time": "2020-05-08T17:05:04Z", "creation_time": "2020-05-08T17:05:04Z", "attachment_id": 9146844, "creator": "gijskruitbosch+bugs@gmail.com", "raw_text": "", "bug_id": 1196151, "tags": [], "text": "Created attachment 9146844\nBug 1196151 - use BrowsingContext for external helper app handling of protocols, r?mattwoodrow", "author": "gijskruitbosch+bugs@gmail.com", "id": 14805080, "count": 9}, {"author": "gijskruitbosch+bugs@gmail.com", "text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=25e3d86183895102355cd06e91a22646f3cc44e0", "tags": [], "bug_id": 1196151, "count": 10, "id": 14806717, "is_private": false, "raw_text": "https://treeherder.mozilla.org/#/jobs?repo=try&revision=25e3d86183895102355cd06e91a22646f3cc44e0", "creator": "gijskruitbosch+bugs@gmail.com", "attachment_id": null, "creation_time": "2020-05-10T09:42:04Z", "time": "2020-05-10T09:42:04Z"}, {"tags": [], "bug_id": 1196151, "author": "gijskruitbosch+bugs@gmail.com", "text": "Created attachment 9147092\nBug 1196151 - use browsing contexts for urifixupinfo's consumer property, r?mak", "count": 11, "id": 14806718, "is_private": false, "time": "2020-05-10T09:43:11Z", "creation_time": "2020-05-10T09:43:11Z", "raw_text": "", "attachment_id": 9147092, "creator": "gijskruitbosch+bugs@gmail.com"}, {"is_private": false, "raw_text": "\n\nDepends on D74434", "creator": "gijskruitbosch+bugs@gmail.com", "attachment_id": 9147093, "creation_time": "2020-05-10T09:45:30Z", "time": "2020-05-10T09:45:30Z", "author": "gijskruitbosch+bugs@gmail.com", "text": "Created attachment 9147093\nBug 1196151 - avoid loading mailto: and other standard schemes into frames, r?nika\n\n\n\nDepends on D74434", "tags": [], "bug_id": 1196151, "count": 12, "id": 14806720}, {"attachment_id": null, "creator": "gijskruitbosch+bugs@gmail.com", "raw_text": "(In reply to :Gijs (he/him) from comment #10)\n> https://treeherder.mozilla.org/#/jobs?repo=try&revision=25e3d86183895102355cd06e91a22646f3cc44e0\n\nHm, missed some sites due to writing the patch on Windows, and I've realized that we need to keep windowcontext around in order to get the correct dialogparent; otherwise some download-related code breaks.\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=783beb80f01ab6f617f61f2607f1caeeebe50787", "time": "2020-05-10T22:56:55Z", "creation_time": "2020-05-10T22:56:55Z", "is_private": false, "id": 14806976, "count": 13, "text": "(In reply to :Gijs (he/him) from comment #10)\n> https://treeherder.mozilla.org/#/jobs?repo=try&revision=25e3d86183895102355cd06e91a22646f3cc44e0\n\nHm, missed some sites due to writing the patch on Windows, and I've realized that we need to keep windowcontext around in order to get the correct dialogparent; otherwise some download-related code breaks.\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=783beb80f01ab6f617f61f2607f1caeeebe50787", "author": "gijskruitbosch+bugs@gmail.com", "bug_id": 1196151, "tags": []}, {"creation_time": "2020-05-13T15:05:36Z", "time": "2020-05-13T15:05:36Z", "creator": "pulsebot@bots.tld", "attachment_id": null, "raw_text": "Pushed by gijskruitbosch@gmail.com:\nhttps://hg.mozilla.org/integration/autoland/rev/e945168c87aa\nuse browsing contexts for urifixupinfo's consumer property, r=mak\nhttps://hg.mozilla.org/integration/autoland/rev/d6c5410fc285\nuse BrowsingContext for external helper app handling of protocols, r=mattwoodrow\nhttps://hg.mozilla.org/integration/autoland/rev/0c7811dc2ea9\navoid loading mailto: and other standard schemes into frames, r=nika", "is_private": false, "id": 14816896, "count": 14, "bug_id": 1196151, "tags": [], "text": "Pushed by gijskruitbosch@gmail.com:\nhttps://hg.mozilla.org/integration/autoland/rev/e945168c87aa\nuse browsing contexts for urifixupinfo's consumer property, r=mak\nhttps://hg.mozilla.org/integration/autoland/rev/d6c5410fc285\nuse BrowsingContext for external helper app handling of protocols, r=mattwoodrow\nhttps://hg.mozilla.org/integration/autoland/rev/0c7811dc2ea9\navoid loading mailto: and other standard schemes into frames, r=nika", "author": "pulsebot@bots.tld"}, {"attachment_id": null, "creator": "cbrindusan@mozilla.com", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/e945168c87aa\nhttps://hg.mozilla.org/mozilla-central/rev/d6c5410fc285\nhttps://hg.mozilla.org/mozilla-central/rev/0c7811dc2ea9", "time": "2020-05-13T21:48:44Z", "creation_time": "2020-05-13T21:48:44Z", "id": 14817911, "count": 15, "text": "https://hg.mozilla.org/mozilla-central/rev/e945168c87aa\nhttps://hg.mozilla.org/mozilla-central/rev/d6c5410fc285\nhttps://hg.mozilla.org/mozilla-central/rev/0c7811dc2ea9", "author": "cbrindusan@mozilla.com", "bug_id": 1196151, "tags": ["bugherder"], "is_private": false}, {"count": 16, "id": 15002846, "creation_time": "2020-08-24T12:39:16Z", "time": "2020-08-24T12:39:16Z", "raw_text": "", "creator": "annevk@annevk.nl", "attachment_id": null, "tags": [], "is_private": false, "bug_id": 1196151, "author": "annevk@annevk.nl", "text": "*** Bug 646552 has been marked as a duplicate of this bug. ***"}]}}, "comments": {}}