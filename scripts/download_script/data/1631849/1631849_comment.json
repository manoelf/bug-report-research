{"comments": {}, "bugs": {"1631849": {"comments": [{"creator": "fbertsch@mozilla.com", "creation_time": "2020-04-21T17:05:50Z", "author": "fbertsch@mozilla.com", "id": 14769757, "text": "During the investigation of bug 1631530, it seemed to come out that we no longer need the `pioneer_study` ping to be ingested. Sarah Bird confirmed that we still need the existing data, however. This bug is for:\n- Removing the `pioneer_study` ping from MPS\n- Ending ingestion of said pings\n- Retaining existing `pioneer_study` datasets for some time period\n\nRequesting confirmation from rweiss and Sarah Bird for this. Is the above correct?", "raw_text": "During the investigation of bug 1631530, it seemed to come out that we no longer need the `pioneer_study` ping to be ingested. Sarah Bird confirmed that we still need the existing data, however. This bug is for:\n- Removing the `pioneer_study` ping from MPS\n- Ending ingestion of said pings\n- Retaining existing `pioneer_study` datasets for some time period\n\nRequesting confirmation from rweiss and Sarah Bird for this. Is the above correct?", "is_private": false, "time": "2020-04-21T17:05:50Z", "attachment_id": null, "count": 0, "bug_id": 1631849, "tags": []}, {"creation_time": "2020-04-21T17:28:49Z", "author": "birdsarah@mozilla.com", "id": 14769805, "creator": "birdsarah@mozilla.com", "is_private": false, "raw_text": "I believe this is correct, but I'd like to push the confirmation from my side up to :mlopatka.", "text": "I believe this is correct, but I'd like to push the confirmation from my side up to :mlopatka.", "time": "2020-04-21T17:28:49Z", "attachment_id": null, "tags": [], "bug_id": 1631849, "count": 1}, {"id": 14769828, "author": "whd@mozilla.com", "text": "(In reply to Frank Bertsch [:frank] from comment #0)\n\n> - Removing the `pioneer_study` ping from MPS\n\nThis can be probably be done safely since we explicitly ignore these in both [MSG](https://github.com/mozilla/mozilla-schema-generator/blob/master/bin/schema_generator.sh#L82) and [ops infra](https://github.com/mozilla-services/cloudops-infra/blob/master/projects/data-shared/tf/modules/bigquery/generate_tfjson.sh#L71). Only the decoder attempts to do anything pioneer-study related in GCP, and that's largely an oversight (pioneer v1 is unsupported on GCP).\n\n> - Ending ingestion of said pings\n\nTo be explicit, I think this means making existing pioneer study data emit `UnwantedDataException`s in the decoder. We'll want to be careful about this, depending on the amount of overlap the pathing has with fortchoming pioneer studies.\n\n> - Retaining existing `pioneer_study` datasets for some time period\n\nFrom previous discussions with :sbird et al., these are currently retained indefinitely in AWS and we have no plans to delete this data.", "raw_text": "(In reply to Frank Bertsch [:frank] from comment #0)\n\n> - Removing the `pioneer_study` ping from MPS\n\nThis can be probably be done safely since we explicitly ignore these in both [MSG](https://github.com/mozilla/mozilla-schema-generator/blob/master/bin/schema_generator.sh#L82) and [ops infra](https://github.com/mozilla-services/cloudops-infra/blob/master/projects/data-shared/tf/modules/bigquery/generate_tfjson.sh#L71). Only the decoder attempts to do anything pioneer-study related in GCP, and that's largely an oversight (pioneer v1 is unsupported on GCP).\n\n> - Ending ingestion of said pings\n\nTo be explicit, I think this means making existing pioneer study data emit `UnwantedDataException`s in the decoder. We'll want to be careful about this, depending on the amount of overlap the pathing has with fortchoming pioneer studies.\n\n> - Retaining existing `pioneer_study` datasets for some time period\n\nFrom previous discussions with :sbird et al., these are currently retained indefinitely in AWS and we have no plans to delete this data.", "is_private": false, "attachment_id": null, "bug_id": 1631849, "creator": "whd@mozilla.com", "creation_time": "2020-04-21T17:38:10Z", "time": "2020-04-21T17:38:10Z", "count": 2, "tags": []}, {"count": 3, "tags": [], "time": "2020-04-21T17:41:02Z", "creator": "fbertsch@mozilla.com", "creation_time": "2020-04-21T17:41:02Z", "bug_id": 1631849, "attachment_id": null, "raw_text": "> This can be probably be done safely since we explicitly ignore these in both [MSG](https://github.com/mozilla/mozilla-schema-generator/blob/master/bin/schema_generator.sh#L82) and [ops infra](https://github.com/mozilla-services/cloudops-infra/blob/master/projects/data-shared/tf/modules/bigquery/generate_tfjson.sh#L71). Only the decoder attempts to do anything pioneer-study related in GCP, and that's largely an oversight (pioneer v1 is unsupported on GCP).\n\nI wanted to be sure we're looking at the right thing, we are looking at the [`telemetry/pioneer-study`](https://github.com/mozilla-services/mozilla-pipeline-schemas/blob/master/schemas/telemetry/pioneer-study/pioneer-study.4.schema.json) doctype pings. Looks like those two places are ignoring the `pioneer-study` _namespace_.", "text": "> This can be probably be done safely since we explicitly ignore these in both [MSG](https://github.com/mozilla/mozilla-schema-generator/blob/master/bin/schema_generator.sh#L82) and [ops infra](https://github.com/mozilla-services/cloudops-infra/blob/master/projects/data-shared/tf/modules/bigquery/generate_tfjson.sh#L71). Only the decoder attempts to do anything pioneer-study related in GCP, and that's largely an oversight (pioneer v1 is unsupported on GCP).\n\nI wanted to be sure we're looking at the right thing, we are looking at the [`telemetry/pioneer-study`](https://github.com/mozilla-services/mozilla-pipeline-schemas/blob/master/schemas/telemetry/pioneer-study/pioneer-study.4.schema.json) doctype pings. Looks like those two places are ignoring the `pioneer-study` _namespace_.", "is_private": false, "id": 14769833, "author": "fbertsch@mozilla.com"}, {"creation_time": "2020-04-21T17:49:05Z", "creator": "whd@mozilla.com", "tags": [], "count": 4, "time": "2020-04-21T17:49:05Z", "is_private": false, "raw_text": "> I wanted to be sure we're looking at the right thing, we are looking at the telemetry/pioneer-study doctype pings. Looks like those two places are ignoring the pioneer-study namespace.\n\nThis is the envelope schema which we probably should have been ignoring as well, but weren't. Deleting this may be more complicated, depending on how we implement v2 (bug #1615086 and bug #1628539).", "text": "> I wanted to be sure we're looking at the right thing, we are looking at the telemetry/pioneer-study doctype pings. Looks like those two places are ignoring the pioneer-study namespace.\n\nThis is the envelope schema which we probably should have been ignoring as well, but weren't. Deleting this may be more complicated, depending on how we implement v2 (bug #1615086 and bug #1628539).", "id": 14769849, "author": "whd@mozilla.com", "bug_id": 1631849, "attachment_id": null}, {"attachment_id": null, "bug_id": 1631849, "author": "fbertsch@mozilla.com", "id": 14769870, "is_private": false, "raw_text": "> This is the envelope schema which we probably should have been ignoring as well, but weren't. Deleting this may be more complicated, depending on how we implement v2 (bug #1615086 and bug #1628539).\n\nAnthony, can you chime in here about the v2 implementation? Is there something preventing us from removing the current `pioneer_study` schema and ending ingestion?", "text": "> This is the envelope schema which we probably should have been ignoring as well, but weren't. Deleting this may be more complicated, depending on how we implement v2 (bug #1615086 and bug #1628539).\n\nAnthony, can you chime in here about the v2 implementation? Is there something preventing us from removing the current `pioneer_study` schema and ending ingestion?", "time": "2020-04-21T17:56:39Z", "tags": [], "count": 5, "creation_time": "2020-04-21T17:56:39Z", "creator": "fbertsch@mozilla.com"}, {"bug_id": 1631849, "count": 6, "tags": [], "time": "2020-04-21T20:24:12Z", "attachment_id": null, "text": "I'm not completely certain on the schema of the v2 envelope; it's possible that we reuse the schema for the envelope. It's also just as easy to create a new schema with a different name, so I'm not against removing it.", "raw_text": "I'm not completely certain on the schema of the v2 envelope; it's possible that we reuse the schema for the envelope. It's also just as easy to create a new schema with a different name, so I'm not against removing it.", "is_private": false, "creator": "amiyaguchi@mozilla.com", "author": "amiyaguchi@mozilla.com", "creation_time": "2020-04-21T20:24:12Z", "id": 14770158}, {"count": 7, "tags": [], "time": "2020-04-22T05:26:24Z", "creator": "rweiss@mozilla.com", "creation_time": "2020-04-22T05:26:24Z", "bug_id": 1631849, "attachment_id": null, "text": "I'm reconciling this work against some other Pioneer v1-related decommissioning.  It is correct that there are no plans to ship future studies on v1, and it is also correct that those existing v1 datasets are still in use.  Are the two open questions thus: 1) what needs to be decided to prevent complications with v2?  2) what are existing v1 resources that can be eliminated/spun down without destroying v1 datasets or preventing future access to v1 datasets?", "raw_text": "I'm reconciling this work against some other Pioneer v1-related decommissioning.  It is correct that there are no plans to ship future studies on v1, and it is also correct that those existing v1 datasets are still in use.  Are the two open questions thus: 1) what needs to be decided to prevent complications with v2?  2) what are existing v1 resources that can be eliminated/spun down without destroying v1 datasets or preventing future access to v1 datasets?", "is_private": false, "id": 14770938, "author": "rweiss@mozilla.com"}, {"creation_time": "2020-04-22T14:09:08Z", "creator": "fbertsch@mozilla.com", "tags": [], "count": 8, "time": "2020-04-22T14:09:08Z", "is_private": false, "raw_text": "1) what needs to be decided to prevent complications with v2? \nWe should version v2 separately to avoid any complications. Anthony says there's nothing preventing us from removing v1 from the pipeline. Whether there could be downstream complications is something I doubt, but I'm also not completely aware of how those datasets are used.\n\n2) what are existing v1 resources that can be eliminated/spun down without destroying v1 datasets or preventing future access to v1 datasets?\nMy plan was to not touch the AWS resources, and simply remove pioneer v1 from GCP infra. Since we're not ingesting any of it it sounds like that shouldn't be a big deal. :whd, are we also good to remove the `pioneer_study` namespace? Will that complicate any access to v1 datasets on AWS?", "text": "1) what needs to be decided to prevent complications with v2? \nWe should version v2 separately to avoid any complications. Anthony says there's nothing preventing us from removing v1 from the pipeline. Whether there could be downstream complications is something I doubt, but I'm also not completely aware of how those datasets are used.\n\n2) what are existing v1 resources that can be eliminated/spun down without destroying v1 datasets or preventing future access to v1 datasets?\nMy plan was to not touch the AWS resources, and simply remove pioneer v1 from GCP infra. Since we're not ingesting any of it it sounds like that shouldn't be a big deal. :whd, are we also good to remove the `pioneer_study` namespace? Will that complicate any access to v1 datasets on AWS?", "author": "fbertsch@mozilla.com", "id": 14771698, "bug_id": 1631849, "attachment_id": null}, {"text": "> We should version v2 separately to avoid any complications. \n\nThis is complicated by the fact that pioneer uses the telemetry transport and therefore is pinned to version 4. We previously had an [internal identifier](https://github.com/mozilla-services/mozilla-pipeline-schemas/blob/master/schemas/telemetry/pioneer-study/pioneer-study.4.schema.json#L82) for versioning schemas in pioneer. :amiyaguchi is looking into this and in particular what the new wrapper schema should look like.\n\nBy my current understanding, assuming we re-use `pioneer-study` as the telemetry `docType`, v1 pings will be routed to the v2 infra and fail to decode in the new pioneer decoder. We wouldn't need to do anything else but we could also throw an `UnwantedDataException` if we wanted to. If we use a different `docType` for pioneer v2 we still need to figure out internal versioning, but we wouldn't have any complications WRT v1 (we would want to flag pioneer v1 data sent to telemetry as unwanted data however).\n\n> My plan was to not touch the AWS resources, and simply remove pioneer v1 from GCP infra. Since we're not ingesting any of it it sounds like that shouldn't be a big deal. \n\nThis is indeed not a big deal. Bug #1590211 represents the remaining AWS resources and we're leaving that as-is for now.\n\n> :whd, are we also good to remove the pioneer_study namespace? Will that complicate any access to v1 datasets on AWS?\n\nWe're good to remove the schemas under the `pioneer-study` directory (it's not a GCP-compliant namespace) and that won't complicate v1 access. We may re-use that directory as a proper namespace for v2.", "raw_text": "> We should version v2 separately to avoid any complications. \n\nThis is complicated by the fact that pioneer uses the telemetry transport and therefore is pinned to version 4. We previously had an [internal identifier](https://github.com/mozilla-services/mozilla-pipeline-schemas/blob/master/schemas/telemetry/pioneer-study/pioneer-study.4.schema.json#L82) for versioning schemas in pioneer. :amiyaguchi is looking into this and in particular what the new wrapper schema should look like.\n\nBy my current understanding, assuming we re-use `pioneer-study` as the telemetry `docType`, v1 pings will be routed to the v2 infra and fail to decode in the new pioneer decoder. We wouldn't need to do anything else but we could also throw an `UnwantedDataException` if we wanted to. If we use a different `docType` for pioneer v2 we still need to figure out internal versioning, but we wouldn't have any complications WRT v1 (we would want to flag pioneer v1 data sent to telemetry as unwanted data however).\n\n> My plan was to not touch the AWS resources, and simply remove pioneer v1 from GCP infra. Since we're not ingesting any of it it sounds like that shouldn't be a big deal. \n\nThis is indeed not a big deal. Bug #1590211 represents the remaining AWS resources and we're leaving that as-is for now.\n\n> :whd, are we also good to remove the pioneer_study namespace? Will that complicate any access to v1 datasets on AWS?\n\nWe're good to remove the schemas under the `pioneer-study` directory (it's not a GCP-compliant namespace) and that won't complicate v1 access. We may re-use that directory as a proper namespace for v2.", "is_private": false, "id": 14772210, "author": "whd@mozilla.com", "bug_id": 1631849, "attachment_id": null, "creator": "whd@mozilla.com", "creation_time": "2020-04-22T17:07:31Z", "count": 9, "tags": [], "time": "2020-04-22T17:07:31Z"}, {"creator": "mlopatka@mozilla.com", "creation_time": "2020-04-22T20:39:10Z", "count": 10, "tags": [], "time": "2020-04-22T20:39:10Z", "raw_text": "Acknowledged. Everything in the bug [description](https://bugzilla.mozilla.org/show_bug.cgi?id=1631849#c0) accurately aligns with our world view.  \nNo blockers from my team to proceed with blocking `pioneer_study` pings from ingestion for outstanding v1 studies.", "text": "Acknowledged. Everything in the bug [description](https://bugzilla.mozilla.org/show_bug.cgi?id=1631849#c0) accurately aligns with our world view.  \nNo blockers from my team to proceed with blocking `pioneer_study` pings from ingestion for outstanding v1 studies.", "is_private": false, "id": 14772639, "author": "mlopatka@mozilla.com", "bug_id": 1631849, "attachment_id": null}, {"creation_time": "2020-04-24T18:35:53Z", "creator": "amiyaguchi@mozilla.com", "tags": [], "count": 11, "time": "2020-04-24T18:35:53Z", "is_private": false, "raw_text": "Having looked over [`telemetry/pioneer-study/pioneer-study.4.schema.json`](https://github.com/mozilla-services/mozilla-pipeline-schemas/blob/master/schemas/telemetry/pioneer-study/pioneer-study.4.schema.json), I think we should re-use the schema. This would shift responsibility of handling the old, unwanted pings to the pioneer decoder. which would effectively reject all of the v1 pings. Once pioneer-study pings are routed to the separate pioneer decoder, the telemetry pipeline will no longer be populating the `telemetry.pioneer_study` tables.\n\nConsider using a new schema e.g. `pioneer-envelope` for the v2 project. The telemetry decoder would continue to process `pioneer-study` pings before they are filtered out. The schema could be removed and the table removed, but we would also have an empty table for `pioneer-envelope` unless we bake in some logic to avoid creating the table. From the perspective of the pioneer decoder, using either schema doesn't matter.\n\nReusing the schema saves a bit of effort since the schema serves the needs of v2, aside from an additional `schemaNamespace` field necessary for routing. Old pings can be rejected in the pioneer-specific decoder by requiring this new field, perhaps wrapping the validation exception into an `UnwantedDataException` if it makes sense. Once the pings are rerouted, we can still mark the ping as unwanted data and delete the old table because the `pioneer-study` schema is a meta-schema that shouldn't have a decoded/live table.", "text": "Having looked over [`telemetry/pioneer-study/pioneer-study.4.schema.json`](https://github.com/mozilla-services/mozilla-pipeline-schemas/blob/master/schemas/telemetry/pioneer-study/pioneer-study.4.schema.json), I think we should re-use the schema. This would shift responsibility of handling the old, unwanted pings to the pioneer decoder. which would effectively reject all of the v1 pings. Once pioneer-study pings are routed to the separate pioneer decoder, the telemetry pipeline will no longer be populating the `telemetry.pioneer_study` tables.\n\nConsider using a new schema e.g. `pioneer-envelope` for the v2 project. The telemetry decoder would continue to process `pioneer-study` pings before they are filtered out. The schema could be removed and the table removed, but we would also have an empty table for `pioneer-envelope` unless we bake in some logic to avoid creating the table. From the perspective of the pioneer decoder, using either schema doesn't matter.\n\nReusing the schema saves a bit of effort since the schema serves the needs of v2, aside from an additional `schemaNamespace` field necessary for routing. Old pings can be rejected in the pioneer-specific decoder by requiring this new field, perhaps wrapping the validation exception into an `UnwantedDataException` if it makes sense. Once the pings are rerouted, we can still mark the ping as unwanted data and delete the old table because the `pioneer-study` schema is a meta-schema that shouldn't have a decoded/live table.", "id": 14776966, "author": "amiyaguchi@mozilla.com", "bug_id": 1631849, "attachment_id": null}, {"attachment_id": 9143234, "bug_id": 1631849, "id": 14777357, "author": "pulgasaur@mozilla.bugs", "raw_text": "", "text": "Created attachment 9143234\nLink to GitHub pull-request: https://github.com/mozilla-services/mozilla-pipeline-schemas/pull/532", "is_private": false, "time": "2020-04-24T21:02:54Z", "count": 12, "tags": [], "creator": "pulgasaur@mozilla.bugs", "creation_time": "2020-04-24T21:02:54Z"}, {"tags": [], "count": 13, "time": "2020-04-27T13:24:55Z", "creation_time": "2020-04-27T13:24:55Z", "creator": "fbertsch@mozilla.com", "bug_id": 1631849, "attachment_id": null, "is_private": false, "text": "Moving to a P1 since Anthony has started this work.", "raw_text": "Moving to a P1 since Anthony has started this work.", "author": "fbertsch@mozilla.com", "id": 14781516}, {"is_private": false, "raw_text": "I've removed all of the old study schemas and update the `telemetry.pioneer-study` schema to include a new column that will start to reject v1 pings. We cannot remove the old tables until the pings are marked specifically as unwanted data or rerouted into the separate pioneer decoder, at least as far as I know.", "text": "I've removed all of the old study schemas and update the `telemetry.pioneer-study` schema to include a new column that will start to reject v1 pings. We cannot remove the old tables until the pings are marked specifically as unwanted data or rerouted into the separate pioneer decoder, at least as far as I know.", "creation_time": "2020-04-27T18:35:24Z", "author": "amiyaguchi@mozilla.com", "id": 14782287, "creator": "amiyaguchi@mozilla.com", "tags": [], "count": 14, "bug_id": 1631849, "time": "2020-04-27T18:35:24Z", "attachment_id": null}, {"bug_id": 1631849, "attachment_id": 9147817, "is_private": false, "raw_text": "", "text": "Created attachment 9147817\nLink to GitHub pull-request: https://github.com/mozilla/gcp-ingestion/pull/1291", "id": 14815662, "author": "pulgasaur@mozilla.bugs", "tags": [], "count": 15, "time": "2020-05-12T23:02:10Z", "creation_time": "2020-05-12T23:02:10Z", "creator": "pulgasaur@mozilla.bugs"}]}}}