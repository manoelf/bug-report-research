{"comments": {}, "bugs": {"669251": {"comments": [{"author": "cam@mcc.id.au", "creation_time": "2011-07-05T04:52:20Z", "time": "2011-07-05T04:52:20Z", "tags": [], "text": "There are some mochitests that open another window, or load another document in an <iframe>, and they load SimpleTest.js into that other window.  If calls to ok(), is(), etc. are made from that other window, then the results of these won't get logged properly.  The SimpleTest.js in that other window thinks it is being run as a standalone test (because it can't find its parent runner) and thus just dump()s the test results out.  It also doesn't know what the current test URL is, resulting in output like \"TEST-UNEXPECTED-FAIL |  | message\" if the ok/is call fails.\n\nTests with separate windows/documents that do things correctly include code like\n\n  var ok = window.opener.ok;\n  var is = window.opener.is;\n\nor\n\n  var ok = window.parent.ok;\n  var is = window.parent.is;\n\nto import the functions it needs from the main test window.\n\nWe should probably forbid SimpleTest.js from being included in secondary windows, and fix the remaining tests up that do this to explicitly import window.parent.ok etc.", "creator": "cam@mcc.id.au", "is_private": false, "id": 5573348, "attachment_id": null, "raw_text": "There are some mochitests that open another window, or load another document in an <iframe>, and they load SimpleTest.js into that other window.  If calls to ok(), is(), etc. are made from that other window, then the results of these won't get logged properly.  The SimpleTest.js in that other window thinks it is being run as a standalone test (because it can't find its parent runner) and thus just dump()s the test results out.  It also doesn't know what the current test URL is, resulting in output like \"TEST-UNEXPECTED-FAIL |  | message\" if the ok/is call fails.\n\nTests with separate windows/documents that do things correctly include code like\n\n  var ok = window.opener.ok;\n  var is = window.opener.is;\n\nor\n\n  var ok = window.parent.ok;\n  var is = window.parent.is;\n\nto import the functions it needs from the main test window.\n\nWe should probably forbid SimpleTest.js from being included in secondary windows, and fix the remaining tests up that do this to explicitly import window.parent.ok etc.", "bug_id": 669251, "count": 0}, {"bug_id": 669251, "count": 1, "id": 5573364, "attachment_id": null, "raw_text": "The bug 668471 error is an example of this happening, since file_SpecialPowersFrame1.html doesn't use the parent test_SpecialPowersExtension2.html's version of is().\n\nTwo other alternatives:\n  * make SimpleTest.js look to see if window.opener.SimpleTest or\n    window.parent.SimpleTest exist and automatically do the import of the\n    public SimpleTest.* functions\n  * create a separate SimpleTestForSecondaryWindow.js that unconditionally does\n    an import like this", "creation_time": "2011-07-05T05:05:43Z", "author": "cam@mcc.id.au", "text": "The bug 668471 error is an example of this happening, since file_SpecialPowersFrame1.html doesn't use the parent test_SpecialPowersExtension2.html's version of is().\n\nTwo other alternatives:\n  * make SimpleTest.js look to see if window.opener.SimpleTest or\n    window.parent.SimpleTest exist and automatically do the import of the\n    public SimpleTest.* functions\n  * create a separate SimpleTestForSecondaryWindow.js that unconditionally does\n    an import like this", "tags": [], "time": "2011-07-05T05:05:43Z", "is_private": false, "creator": "cam@mcc.id.au"}, {"author": "cam@mcc.id.au", "creation_time": "2011-11-08T05:32:09Z", "bug_id": 669251, "time": "2011-11-08T05:32:09Z", "tags": [], "text": "Not working on this at the moment.  My preferred solution is the \"make SimpleTest.js look to see if ...\" one, since that kind of searching for the TestRunner object is already being done at the top of SimpleTest.js.", "creator": "cam@mcc.id.au", "is_private": false, "count": 2, "id": 5833273, "attachment_id": null, "raw_text": "Not working on this at the moment.  My preferred solution is the \"make SimpleTest.js look to see if ...\" one, since that kind of searching for the TestRunner object is already being done at the top of SimpleTest.js."}]}}}