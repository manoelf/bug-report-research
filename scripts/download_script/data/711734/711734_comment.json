{"bugs": {"711734": {"comments": [{"author": "asa@mozilla.com", "creator": "asa@mozilla.com", "creation_time": "2011-12-17T19:00:24Z", "time": "2011-12-17T19:00:24Z", "is_private": false, "id": 5924622, "count": 0, "bug_id": 711734, "text": "Slow SQL Statements on Main Thread\n\nHits: 1  Total Time (ms): 392\n\nStatement: \nSELECT value, ROUND( timesUsed / MAX(1.0, (lastUsed - firstUsed) / :timeGroupingSize) * MAX(1.0, :maxTimeGroupings - (:now - lastUsed) / :timeGroupingSize) * MAX(1.0, :agedWeight * (firstUsed < :expiryDate)) / :bucketSize , 3) AS frecency, 1 AS boundaryBonuses FROM moz_formhistory WHERE fieldname=:fieldname AND (value LIKE :valuePrefix ESCAPE '/') ORDER BY ROUND(frecency * boundaryBonuses) DESC, UPPER(value) ASC", "tags": [], "raw_text": "Slow SQL Statements on Main Thread\n\nHits: 1  Total Time (ms): 392\n\nStatement: \nSELECT value, ROUND( timesUsed / MAX(1.0, (lastUsed - firstUsed) / :timeGroupingSize) * MAX(1.0, :maxTimeGroupings - (:now - lastUsed) / :timeGroupingSize) * MAX(1.0, :agedWeight * (firstUsed < :expiryDate)) / :bucketSize , 3) AS frecency, 1 AS boundaryBonuses FROM moz_formhistory WHERE fieldname=:fieldname AND (value LIKE :valuePrefix ESCAPE '/') ORDER BY ROUND(frecency * boundaryBonuses) DESC, UPPER(value) ASC", "attachment_id": null}, {"creator": "henry.fai.hang.chan@gmail.com", "time": "2011-12-20T13:47:37Z", "creation_time": "2011-12-20T13:47:37Z", "author": "henry.fai.hang.chan@gmail.com", "tags": [], "text": "Hits\tTotal Time (ms)\tStatement\n2\t472\tSELECT h.id, h.url, IFNULL(b.title, h.title), h.rev_host, h.visit_count, h.last_visit_date, f.url, null, b.id, b.dateAdded, b.lastModified, b.parent, null, h.frecency, b.position, b.type, b.fk, b.guid FROM moz_bookmarks b LEFT JOIN moz_places h ON b.fk = h.id LEFT JOIN moz_favicons f ON h.favicon_id = f.id WHERE b.parent = :parent ORDER BY b.position ASC\n1\t152\tDELETE FROM moz_bookmarks WHERE parent IN (:parent)\n2\t661\tINSERT OR IGNORE INTO moz_places (url, title, rev_host, hidden, typed, frecency, guid) VALUES (:page_url, :page_title, :rev_host, :hidden, :typed, :frecency, GENERATE_GUID())", "bug_id": 711734, "is_private": false, "attachment_id": null, "count": 1, "id": 5929355, "raw_text": "Hits\tTotal Time (ms)\tStatement\n2\t472\tSELECT h.id, h.url, IFNULL(b.title, h.title), h.rev_host, h.visit_count, h.last_visit_date, f.url, null, b.id, b.dateAdded, b.lastModified, b.parent, null, h.frecency, b.position, b.type, b.fk, b.guid FROM moz_bookmarks b LEFT JOIN moz_places h ON b.fk = h.id LEFT JOIN moz_favicons f ON h.favicon_id = f.id WHERE b.parent = :parent ORDER BY b.position ASC\n1\t152\tDELETE FROM moz_bookmarks WHERE parent IN (:parent)\n2\t661\tINSERT OR IGNORE INTO moz_places (url, title, rev_host, hidden, typed, frecency, guid) VALUES (:page_url, :page_title, :rev_host, :hidden, :typed, :frecency, GENERATE_GUID())"}, {"tags": [], "text": "(In reply to henry.fai.hang.chan from comment #1)\n> Hits\tTotal Time (ms)\tStatement\n> 2\t472\tSELECT h.id, h.url, IFNULL(b.title, h.title), h.rev_host,\n> h.visit_count, h.last_visit_date, f.url, null, b.id, b.dateAdded,\n> b.lastModified, b.parent, null, h.frecency, b.position, b.type, b.fk, b.guid\n> FROM moz_bookmarks b LEFT JOIN moz_places h ON b.fk = h.id LEFT JOIN\n> moz_favicons f ON h.favicon_id = f.id WHERE b.parent = :parent ORDER BY\n> b.position ASC\n\nThis is a query populating a bookmarks view (toolbar/Library), do you have many bookmarks or tags?\n\n> 1\t152\tDELETE FROM moz_bookmarks WHERE parent IN (:parent)\n\nRemoval of a bookmarks folder, maybe hitting a checkpoint (if it was a pretty large folder)\n\n> 2\t661\tINSERT OR IGNORE INTO moz_places (url, title, rev_host, hidden, typed,\n> frecency, guid) VALUES (:page_url, :page_title, :rev_host, :hidden, :typed,\n> :frecency, GENERATE_GUID())\n\nlikely creation of a bookmark, maybe hitting a checkpoint", "bug_id": 711734, "attachment_id": null, "raw_text": "(In reply to henry.fai.hang.chan from comment #1)\n> Hits\tTotal Time (ms)\tStatement\n> 2\t472\tSELECT h.id, h.url, IFNULL(b.title, h.title), h.rev_host,\n> h.visit_count, h.last_visit_date, f.url, null, b.id, b.dateAdded,\n> b.lastModified, b.parent, null, h.frecency, b.position, b.type, b.fk, b.guid\n> FROM moz_bookmarks b LEFT JOIN moz_places h ON b.fk = h.id LEFT JOIN\n> moz_favicons f ON h.favicon_id = f.id WHERE b.parent = :parent ORDER BY\n> b.position ASC\n\nThis is a query populating a bookmarks view (toolbar/Library), do you have many bookmarks or tags?\n\n> 1\t152\tDELETE FROM moz_bookmarks WHERE parent IN (:parent)\n\nRemoval of a bookmarks folder, maybe hitting a checkpoint (if it was a pretty large folder)\n\n> 2\t661\tINSERT OR IGNORE INTO moz_places (url, title, rev_host, hidden, typed,\n> frecency, guid) VALUES (:page_url, :page_title, :rev_host, :hidden, :typed,\n> :frecency, GENERATE_GUID())\n\nlikely creation of a bookmark, maybe hitting a checkpoint", "creator": "mak@mozilla.com", "creation_time": "2011-12-20T13:57:05Z", "time": "2011-12-20T13:57:05Z", "author": "mak@mozilla.com", "is_private": false, "id": 5929378, "count": 2}, {"creator": "mak@mozilla.com", "time": "2011-12-20T14:01:57Z", "creation_time": "2011-12-20T14:01:57Z", "author": "mak@mozilla.com", "is_private": false, "id": 5929390, "count": 3, "bug_id": 711734, "text": "(In reply to Marco Bonardo [:mak] from comment #2)\n> > 1\t152\tDELETE FROM moz_bookmarks WHERE parent IN (:parent)\n> \n> Removal of a bookmarks folder, maybe hitting a checkpoint (if it was a\n> pretty large folder)\n\nActually this may even just be a livemark updating.", "tags": [], "attachment_id": null, "raw_text": "(In reply to Marco Bonardo [:mak] from comment #2)\n> > 1\t152\tDELETE FROM moz_bookmarks WHERE parent IN (:parent)\n> \n> Removal of a bookmarks folder, maybe hitting a checkpoint (if it was a\n> pretty large folder)\n\nActually this may even just be a livemark updating."}, {"count": 4, "id": 5929394, "is_private": false, "time": "2011-12-20T14:03:48Z", "creation_time": "2011-12-20T14:03:48Z", "creator": "mak@mozilla.com", "author": "mak@mozilla.com", "attachment_id": null, "raw_text": "(In reply to Asa Dotzler [:asa] from comment #0)\n> SELECT value, ROUND( timesUsed / MAX(1.0, (lastUsed - firstUsed) /\n> :timeGroupingSize) * MAX(1.0, :maxTimeGroupings - (:now - lastUsed) /\n> :timeGroupingSize) * MAX(1.0, :agedWeight * (firstUsed < :expiryDate)) /\n> :bucketSize , 3) AS frecency, 1 AS boundaryBonuses FROM moz_formhistory\n> WHERE fieldname=:fieldname AND (value LIKE :valuePrefix ESCAPE '/') ORDER BY\n> ROUND(frecency * boundaryBonuses) DESC, UPPER(value) ASC\n\nThis is form history, I'm not surprised it may be slow considering the ordering, it can't use an index. formhistory is being rewritten to be async in bug 566746, that will just move the problem to another thread, though.", "bug_id": 711734, "text": "(In reply to Asa Dotzler [:asa] from comment #0)\n> SELECT value, ROUND( timesUsed / MAX(1.0, (lastUsed - firstUsed) /\n> :timeGroupingSize) * MAX(1.0, :maxTimeGroupings - (:now - lastUsed) /\n> :timeGroupingSize) * MAX(1.0, :agedWeight * (firstUsed < :expiryDate)) /\n> :bucketSize , 3) AS frecency, 1 AS boundaryBonuses FROM moz_formhistory\n> WHERE fieldname=:fieldname AND (value LIKE :valuePrefix ESCAPE '/') ORDER BY\n> ROUND(frecency * boundaryBonuses) DESC, UPPER(value) ASC\n\nThis is form history, I'm not surprised it may be slow considering the ordering, it can't use an index. formhistory is being rewritten to be async in bug 566746, that will just move the problem to another thread, though.", "tags": []}, {"attachment_id": null, "raw_text": "(In reply to Marco Bonardo [:mak] from comment #2)\n> (In reply to henry.fai.hang.chan from comment #1)\n> > Hits\tTotal Time (ms)\tStatement\n> > 2\t472\tSELECT h.id, h.url, IFNULL(b.title, h.title), h.rev_host,\n> > h.visit_count, h.last_visit_date, f.url, null, b.id, b.dateAdded,\n> > b.lastModified, b.parent, null, h.frecency, b.position, b.type, b.fk, b.guid\n> > FROM moz_bookmarks b LEFT JOIN moz_places h ON b.fk = h.id LEFT JOIN\n> > moz_favicons f ON h.favicon_id = f.id WHERE b.parent = :parent ORDER BY\n> > b.position ASC\n> \n> This is a query populating a bookmarks view (toolbar/Library), do you have\n> many bookmarks or tags?\n\n149 in unsorted, is that a lot?", "tags": [], "bug_id": 711734, "text": "(In reply to Marco Bonardo [:mak] from comment #2)\n> (In reply to henry.fai.hang.chan from comment #1)\n> > Hits\tTotal Time (ms)\tStatement\n> > 2\t472\tSELECT h.id, h.url, IFNULL(b.title, h.title), h.rev_host,\n> > h.visit_count, h.last_visit_date, f.url, null, b.id, b.dateAdded,\n> > b.lastModified, b.parent, null, h.frecency, b.position, b.type, b.fk, b.guid\n> > FROM moz_bookmarks b LEFT JOIN moz_places h ON b.fk = h.id LEFT JOIN\n> > moz_favicons f ON h.favicon_id = f.id WHERE b.parent = :parent ORDER BY\n> > b.position ASC\n> \n> This is a query populating a bookmarks view (toolbar/Library), do you have\n> many bookmarks or tags?\n\n149 in unsorted, is that a lot?", "is_private": false, "count": 5, "id": 5934811, "creator": "henry.fai.hang.chan@gmail.com", "time": "2011-12-22T10:46:35Z", "creation_time": "2011-12-22T10:46:35Z", "author": "henry.fai.hang.chan@gmail.com"}, {"author": "mak@mozilla.com", "creator": "mak@mozilla.com", "time": "2011-12-22T12:48:48Z", "creation_time": "2011-12-22T12:48:48Z", "is_private": false, "id": 5934969, "count": 6, "tags": [], "text": "(In reply to henry.fai.hang.chan from comment #5)\n> 149 in unsorted, is that a lot?\n\nno, it's not.", "bug_id": 711734, "raw_text": "(In reply to henry.fai.hang.chan from comment #5)\n> 149 in unsorted, is that a lot?\n\nno, it's not.", "attachment_id": null}]}}, "comments": {}}