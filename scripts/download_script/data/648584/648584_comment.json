{"bugs": {"648584": {"comments": [{"raw_text": "If I view unread only threaded, and delete the last message in the view, I get an assertion about writing to an invalid nsTArray index, in nsMsgThreadedDBView::RemoveByIndex. It's easy enough to fix the assertion, but the code isn't quite right in general so I should fix that as well.\n\nIn Thunderbird, it's easy enough to get in this situation by clicking the unread widget in the quick filter bar, while in threaded mode.", "is_private": false, "tags": [], "creation_time": "2011-04-08T17:56:36Z", "attachment_id": null, "id": 5396900, "text": "If I view unread only threaded, and delete the last message in the view, I get an assertion about writing to an invalid nsTArray index, in nsMsgThreadedDBView::RemoveByIndex. It's easy enough to fix the assertion, but the code isn't quite right in general so I should fix that as well.\n\nIn Thunderbird, it's easy enough to get in this situation by clicking the unread widget in the quick filter bar, while in threaded mode.", "count": 0, "bug_id": 648584, "time": "2011-04-08T17:56:36Z", "author": "mozilla@davidbienvenu.org", "creator": "mozilla@davidbienvenu.org"}, {"author": "mozilla@davidbienvenu.org", "creator": "mozilla@davidbienvenu.org", "time": "2011-04-08T19:31:56Z", "count": 1, "bug_id": 648584, "text": "Created attachment 524707\nproposed fix\n\nThis fixes the issue by looking a the headers of the expanded thread in unread only view, and promoting the first child, if any, to level 0, and if there are two or more children, marking the first child as a thread with children. This fixes the assertion, and fixes some edge cases where not all the messages in the thread are unread.", "attachment_id": 524707, "id": 5397207, "creation_time": "2011-04-08T19:31:56Z", "tags": [], "is_private": false, "raw_text": "This fixes the issue by looking a the headers of the expanded thread in unread only view, and promoting the first child, if any, to level 0, and if there are two or more children, marking the first child as a thread with children. This fixes the assertion, and fixes some edge cases where not all the messages in the thread are unread."}, {"count": 2, "bug_id": 648584, "raw_text": "Sorry, I'm not sure what the STR are, when you say the last message in the view, does this mean there is only one message in the view, and if so is it a collapsed thread, or does it mean it is the bottommost message in the view, and if so is it a collapsed thread or is it the bottommost message of an expanded thread?", "tags": [], "is_private": false, "time": "2011-04-08T22:01:58Z", "creation_time": "2011-04-08T22:01:58Z", "author": "neil@httl.net", "creator": "neil@httl.net", "text": "Sorry, I'm not sure what the STR are, when you say the last message in the view, does this mean there is only one message in the view, and if so is it a collapsed thread, or does it mean it is the bottommost message in the view, and if so is it a collapsed thread or is it the bottommost message of an expanded thread?", "attachment_id": null, "id": 5397624}, {"id": 5397656, "attachment_id": null, "text": "bottommost message in the view, in an expanded thread. In TB, you can use the quick filter bar to see this:\n\nmark both messages in a folder & thread as unread.\nIn threaded mode, quick on the \"unread\" button in the quick filter bar.\n\nDelete the top most message, then the next message.\n\nI think you can do the same thing in SM with view | messages, unread instead of clicking the quick filter bar.", "creation_time": "2011-04-08T22:14:16Z", "is_private": false, "tags": [], "raw_text": "bottommost message in the view, in an expanded thread. In TB, you can use the quick filter bar to see this:\n\nmark both messages in a folder & thread as unread.\nIn threaded mode, quick on the \"unread\" button in the quick filter bar.\n\nDelete the top most message, then the next message.\n\nI think you can do the same thing in SM with view | messages, unread instead of clicking the quick filter bar.", "author": "mozilla@davidbienvenu.org", "creator": "mozilla@davidbienvenu.org", "time": "2011-04-08T22:14:16Z", "count": 3, "bug_id": 648584}, {"is_private": false, "tags": [], "raw_text": "(In reply to comment #3)\n> bottommost message in the view, in an expanded thread. In TB, you can use the\n> quick filter bar to see this:\n> \n> mark both messages in a folder & thread as unread.\n> In threaded mode, quick on the \"unread\" button in the quick filter bar.\n> \n> Delete the top most message, then the next message.\n> \n> I think you can do the same thing in SM with view | messages, unread instead of\n> clicking the quick filter bar.\nSorry, I was unable to reproduce the assertion in SeaMonkey either with view | messages | unread or view | threads | unread. I had one unread thread in the folder, and I tried deleting the messages starting from the bottom, and I tried deleting the messages starting from the top.", "id": 5400324, "attachment_id": null, "text": "(In reply to comment #3)\n> bottommost message in the view, in an expanded thread. In TB, you can use the\n> quick filter bar to see this:\n> \n> mark both messages in a folder & thread as unread.\n> In threaded mode, quick on the \"unread\" button in the quick filter bar.\n> \n> Delete the top most message, then the next message.\n> \n> I think you can do the same thing in SM with view | messages, unread instead of\n> clicking the quick filter bar.\nSorry, I was unable to reproduce the assertion in SeaMonkey either with view | messages | unread or view | threads | unread. I had one unread thread in the folder, and I tried deleting the messages starting from the bottom, and I tried deleting the messages starting from the top.", "creation_time": "2011-04-11T14:44:07Z", "time": "2011-04-11T14:44:07Z", "bug_id": 648584, "count": 4, "creator": "neil@httl.net", "author": "neil@httl.net"}, {"bug_id": 648584, "count": 5, "time": "2011-04-11T22:13:07Z", "creator": "mozilla@davidbienvenu.org", "author": "mozilla@davidbienvenu.org", "raw_text": "(In reply to comment #4)\n\n> Sorry, I was unable to reproduce the assertion in SeaMonkey either with view |\n> messages | unread or view | threads | unread. I had one unread thread in the\n> folder, and I tried deleting the messages starting from the bottom, and I tried\n> deleting the messages starting from the top.\n\nI couldn't get SM to trigger the assertion either, using the various view options. I'll see if I can find any fancier way to get SM to execute this code.", "is_private": false, "tags": [], "creation_time": "2011-04-11T22:13:07Z", "attachment_id": null, "id": 5401844, "text": "(In reply to comment #4)\n\n> Sorry, I was unable to reproduce the assertion in SeaMonkey either with view |\n> messages | unread or view | threads | unread. I had one unread thread in the\n> folder, and I tried deleting the messages starting from the bottom, and I tried\n> deleting the messages starting from the top.\n\nI couldn't get SM to trigger the assertion either, using the various view options. I'll see if I can find any fancier way to get SM to execute this code."}, {"bug_id": 648584, "raw_text": "Do you see this assertion?", "count": 6, "time": "2013-06-26T17:06:08Z", "tags": [], "is_private": false, "creation_time": "2013-06-26T17:06:08Z", "creator": "vseerror@lehigh.edu", "text": "Do you see this assertion?", "attachment_id": null, "id": 7577140, "author": "vseerror@lehigh.edu"}, {"raw_text": "Assuming that these are the STR:\n\n1) in random (local) folder, have two messages belonging to same thread\n2) mark both unread (M), and defocus to ensure that they don't get auto-marked-read while you're testing (or set auto-mark-read-delay higher)\n3) switch to threaded view (from column header thread column header)\n4) open error console, clear it\n5) Show quick filter, and then (quickly):\n- click on unread filter button on qfb (to show only unread)\n- select first msg, press [del]\n- press [del] again to delete 2nd msg (so that msg pane is now empty)\n6) recheck error console\n\nwfm with those steps for me on WinXP/ TB17/ TB Trunk:\n\nActual Result = Expected Result\n- msgs correctly deleted (and recoverable by undo)\n- no assertion found in error console (stays blank, with view on ALL errors)", "is_private": false, "tags": [], "creation_time": "2013-06-26T19:58:33Z", "attachment_id": null, "id": 7578138, "text": "Assuming that these are the STR:\n\n1) in random (local) folder, have two messages belonging to same thread\n2) mark both unread (M), and defocus to ensure that they don't get auto-marked-read while you're testing (or set auto-mark-read-delay higher)\n3) switch to threaded view (from column header thread column header)\n4) open error console, clear it\n5) Show quick filter, and then (quickly):\n- click on unread filter button on qfb (to show only unread)\n- select first msg, press [del]\n- press [del] again to delete 2nd msg (so that msg pane is now empty)\n6) recheck error console\n\nwfm with those steps for me on WinXP/ TB17/ TB Trunk:\n\nActual Result = Expected Result\n- msgs correctly deleted (and recoverable by undo)\n- no assertion found in error console (stays blank, with view on ALL errors)", "bug_id": 648584, "count": 7, "time": "2013-06-26T19:58:33Z", "creator": "bugzilla2007@duellmann24.net", "author": "bugzilla2007@duellmann24.net"}, {"time": "2013-06-26T20:16:10Z", "tags": [], "is_private": false, "bug_id": 648584, "raw_text": "Not sure. While trying to reproduce I get this in the console:\nWARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80520015: file /var/SSD/TB-hg/mailnews/local/src/nsMsgBrkMBoxStore.cpp, line 902\nJavaScript error: chrome://messenger/content/mailWindowOverlay.js, line 3037: NS_ERROR_FILE_ACCESS_DENIED: Component returned failure code: 0x80520015 (NS_ERROR_FILE_ACCESS_DENIED) [nsIMsgFolder.markMessagesRead]\nThis happens when the last message changes from unread to read. Not sure if that is related. But I couldn't see any \"assertion\".", "count": 8, "creator": "acelists@atlas.sk", "text": "Not sure. While trying to reproduce I get this in the console:\nWARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80520015: file /var/SSD/TB-hg/mailnews/local/src/nsMsgBrkMBoxStore.cpp, line 902\nJavaScript error: chrome://messenger/content/mailWindowOverlay.js, line 3037: NS_ERROR_FILE_ACCESS_DENIED: Component returned failure code: 0x80520015 (NS_ERROR_FILE_ACCESS_DENIED) [nsIMsgFolder.markMessagesRead]\nThis happens when the last message changes from unread to read. Not sure if that is related. But I couldn't see any \"assertion\".", "id": 7578216, "attachment_id": null, "author": "acelists@atlas.sk", "creation_time": "2013-06-26T20:16:10Z"}, {"time": "2014-08-31T13:21:07Z", "bug_id": 648584, "count": 9, "creator": "vseerror@lehigh.edu", "author": "vseerror@lehigh.edu", "tags": [], "is_private": false, "raw_text": "rsx, can you also verify the assertion no longer happens in SM?\n\nI wonder if the patch is regardless still needed.", "text": "rsx, can you also verify the assertion no longer happens in SM?\n\nI wonder if the patch is regardless still needed.", "id": 9252297, "attachment_id": null, "creation_time": "2014-08-31T13:21:07Z"}, {"count": 10, "raw_text": "removing review request pending further investigation", "bug_id": 648584, "is_private": false, "tags": [], "time": "2014-08-31T13:22:16Z", "creation_time": "2014-08-31T13:22:16Z", "author": "vseerror@lehigh.edu", "attachment_id": 524707, "id": 9252298, "text": "Comment on attachment 524707\nproposed fix\n\nremoving review request pending further investigation", "creator": "vseerror@lehigh.edu"}, {"author": "rsx11m.pub@gmail.com", "creator": "rsx11m.pub@gmail.com", "count": 11, "bug_id": 648584, "time": "2014-10-02T23:31:54Z", "creation_time": "2014-10-02T23:31:54Z", "id": 9396913, "attachment_id": null, "text": "I'm not sure if I applied the STR correctly, but I don't see this issue or any assertions in SeaMonkey (neither Windows nor Linux) either. It has to be kept in mind though that the qfb implementation of SM is different than the TB one, thus may not trigger the problem.\n\nI'd read \"the code isn't quite right in general so I should fix that as well\" that it might be worth revisiting the patch anyway, despite the lack of an assertion, given that \"something\" is apparently wrong with the way how the code currently is written in that function (and the patch would also simplify the existing code).\n\nThe patch in attachment 524707 has slightly bitrotted but still applies after accounting for bug 579517 (s/PRUint32/uint32_t) and bug 776630 (s/nsnull/nullptr).", "raw_text": "I'm not sure if I applied the STR correctly, but I don't see this issue or any assertions in SeaMonkey (neither Windows nor Linux) either. It has to be kept in mind though that the qfb implementation of SM is different than the TB one, thus may not trigger the problem.\n\nI'd read \"the code isn't quite right in general so I should fix that as well\" that it might be worth revisiting the patch anyway, despite the lack of an assertion, given that \"something\" is apparently wrong with the way how the code currently is written in that function (and the patch would also simplify the existing code).\n\nThe patch in attachment 524707 has slightly bitrotted but still applies after accounting for bug 579517 (s/PRUint32/uint32_t) and bug 776630 (s/nsnull/nullptr).", "is_private": false, "tags": []}]}}, "comments": {}}