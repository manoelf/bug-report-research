{"bugs": {"634235": {"comments": [{"count": 0, "time": "2011-02-15T12:17:53Z", "text": "User-Agent:       Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.10 (maverick) Firefox/3.6.13\nBuild Identifier: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.10 (maverick) Firefox/3.6.13\n\nAs a certification authority we issue certificates with ocsp support.\nWhile visiting a web site that installed a certificate issued by us, Firefox (3.6.13) gives the following error. (Note:The option \"When an OCSP server connection fails, treat the certificate as invalid\" is checked in validation part of firefox)\n\n----------------------\nhttps://mail.kamusm.gov.tr\n\nSecure Connection Failed\nAn error occurred during a connection to mail.kamusm.gov.tr.\nImproperly formatted time string.\n(Error code: sec_error_invalid_time)\n---------------------\n\nOther browsers (Opera, IE, Chrome) validates our OCSP response without a problem.\n\nReproducible: Always\n\nSteps to Reproduce:\nEdit-Preferences-Advanced-Encryption-Validation\nActivate the option \"When an OCSP server connection fails, treat the certificate as invalid\" then visit https://mail.kamusm.gov.tr", "creator": "hasust@gmail.com", "raw_text": "User-Agent:       Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.10 (maverick) Firefox/3.6.13\nBuild Identifier: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.13) Gecko/20101206 Ubuntu/10.10 (maverick) Firefox/3.6.13\n\nAs a certification authority we issue certificates with ocsp support.\nWhile visiting a web site that installed a certificate issued by us, Firefox (3.6.13) gives the following error. (Note:The option \"When an OCSP server connection fails, treat the certificate as invalid\" is checked in validation part of firefox)\n\n----------------------\nhttps://mail.kamusm.gov.tr\n\nSecure Connection Failed\nAn error occurred during a connection to mail.kamusm.gov.tr.\nImproperly formatted time string.\n(Error code: sec_error_invalid_time)\n---------------------\n\nOther browsers (Opera, IE, Chrome) validates our OCSP response without a problem.\n\nReproducible: Always\n\nSteps to Reproduce:\nEdit-Preferences-Advanced-Encryption-Validation\nActivate the option \"When an OCSP server connection fails, treat the certificate as invalid\" then visit https://mail.kamusm.gov.tr", "id": 5279493, "author": "hasust@gmail.com", "is_private": false, "bug_id": 634235, "attachment_id": null, "tags": [], "creation_time": "2011-02-15T12:17:53Z"}, {"time": "2011-02-15T17:11:14Z", "author": "mozbgz@velox.ch", "count": 1, "is_private": false, "id": 5280005, "raw_text": "(In reply to comment #0)\n> Improperly formatted time string.\n> (Error code: sec_error_invalid_time)\n\nThis detection (by NSS, to which I'm moving this entry) is correct, actually.\n\nThe OCSP replies from ocspsslv3.kamusm.gov.tr include producedAt and thisUpdate fields with improperly encoded GeneralizedTime values, such as\n\n  20110215165500.494Z\n\nX.680 (11/08) states, in clause 46.3:\n\n\"... 3) a decimal fraction of a minute if seconds are omitted, or a decimal fraction of an hour if minutes and seconds are omitted...\"\n\nI.e., you can't specify the time of day including the seconds (\"165500\"), while at the same time including a fractional part (\".494\" - with GeneralizedTime there's no option for specifying microseconds).\n\nThis needs to be fixed at the OCSP responder -> resolving as INVALID.", "creator": "mozbgz@velox.ch", "creation_time": "2011-02-15T17:11:14Z", "tags": [], "attachment_id": null, "text": "(In reply to comment #0)\n> Improperly formatted time string.\n> (Error code: sec_error_invalid_time)\n\nThis detection (by NSS, to which I'm moving this entry) is correct, actually.\n\nThe OCSP replies from ocspsslv3.kamusm.gov.tr include producedAt and thisUpdate fields with improperly encoded GeneralizedTime values, such as\n\n  20110215165500.494Z\n\nX.680 (11/08) states, in clause 46.3:\n\n\"... 3) a decimal fraction of a minute if seconds are omitted, or a decimal fraction of an hour if minutes and seconds are omitted...\"\n\nI.e., you can't specify the time of day including the seconds (\"165500\"), while at the same time including a fractional part (\".494\" - with GeneralizedTime there's no option for specifying microseconds).\n\nThis needs to be fixed at the OCSP responder -> resolving as INVALID.", "bug_id": 634235}, {"count": 2, "time": "2011-02-16T07:45:56Z", "creator": "hasust@gmail.com", "raw_text": "If you check X.680 (11/08), in clause 46.3, sample Case b) \"19851106210627.3Z\" is given as a correct encoding. \n\nAlso clause 46.3 item a-2) says that  \"a string representing the time of day to an accuracy of one hour, one minute, one second, or fractions of a second (to any degree of accuracy)\"\n\nTherefore we think our encoding is conformant to the standard.", "text": "If you check X.680 (11/08), in clause 46.3, sample Case b) \"19851106210627.3Z\" is given as a correct encoding. \n\nAlso clause 46.3 item a-2) says that  \"a string representing the time of day to an accuracy of one hour, one minute, one second, or fractions of a second (to any degree of accuracy)\"\n\nTherefore we think our encoding is conformant to the standard.", "author": "hasust@gmail.com", "is_private": false, "id": 5282410, "attachment_id": null, "creation_time": "2011-02-16T07:45:56Z", "tags": [], "bug_id": 634235}, {"creator": "mozbgz@velox.ch", "raw_text": "(In reply to comment #2)\n> Also clause 46.3 item a-2) says that  \"a string representing the time of day to\n> an accuracy of one hour, one minute, one second, or fractions of a second (to\n> any degree of accuracy)\"\n> \n> Therefore we think our encoding is conformant to the standard.\n\nAh, indeed. I was misreading example b) when I checked yesterday. This seems to be a limitation of the current implementation of DER_GeneralizedTimeToTime (http://mxr.mozilla.org/mozilla/source/security/nss/lib/util/dertime.c#230) - I think right now it is assuming that all GeneralizedTime values also use the \"profile\" defined in RFC 5280, section 4.1.2.5.2.\n\nRFC 2560 doesn't put specific restrictions on the format for thisUpdate, nextUpdate, and producedAt, that's true. RFC 5019 (Lightweight OCSP Profile), section 2.2.4, on the other hand, does. But even if DER_GeneralizedTimeToTime() should probably be adapted, making your responder compliant with the date format in RFC 5019 as well is probably the better short/midterm fix.", "attachment_id": null, "creation_time": "2011-02-16T08:42:58Z", "tags": [], "text": "(In reply to comment #2)\n> Also clause 46.3 item a-2) says that  \"a string representing the time of day to\n> an accuracy of one hour, one minute, one second, or fractions of a second (to\n> any degree of accuracy)\"\n> \n> Therefore we think our encoding is conformant to the standard.\n\nAh, indeed. I was misreading example b) when I checked yesterday. This seems to be a limitation of the current implementation of DER_GeneralizedTimeToTime (http://mxr.mozilla.org/mozilla/source/security/nss/lib/util/dertime.c#230) - I think right now it is assuming that all GeneralizedTime values also use the \"profile\" defined in RFC 5280, section 4.1.2.5.2.\n\nRFC 2560 doesn't put specific restrictions on the format for thisUpdate, nextUpdate, and producedAt, that's true. RFC 5019 (Lightweight OCSP Profile), section 2.2.4, on the other hand, does. But even if DER_GeneralizedTimeToTime() should probably be adapted, making your responder compliant with the date format in RFC 5019 as well is probably the better short/midterm fix.", "bug_id": 634235, "count": 3, "author": "mozbgz@velox.ch", "time": "2011-02-16T08:42:58Z", "is_private": false, "id": 5282477}, {"raw_text": "RFC 3280, to which we claim confirmancee, says:\n\n4.1.2.5.2  GeneralizedTime\n\n   The generalized time type, GeneralizedTime, is a standard ASN.1 type\n   for variable precision representation of time.  Optionally, the\n   GeneralizedTime field can include a representation of the time\n   differential between local and Greenwich Mean Time.\n\n   For the purposes of this profile, GeneralizedTime values MUST be\n   expressed Greenwich Mean Time (Zulu) and MUST include seconds (i.e.,\n   times are YYYYMMDDHHMMSSZ), even where the number of seconds is zero.\n   GeneralizedTime values MUST NOT include fractional seconds.\n\nNote that last paragraph well.  It MUST include seconds, and it MUST NOT \ninclude fractional seconds.", "creator": "nelson@bolyard.me", "creation_time": "2011-02-16T08:44:32Z", "tags": [], "attachment_id": null, "text": "RFC 3280, to which we claim confirmancee, says:\n\n4.1.2.5.2  GeneralizedTime\n\n   The generalized time type, GeneralizedTime, is a standard ASN.1 type\n   for variable precision representation of time.  Optionally, the\n   GeneralizedTime field can include a representation of the time\n   differential between local and Greenwich Mean Time.\n\n   For the purposes of this profile, GeneralizedTime values MUST be\n   expressed Greenwich Mean Time (Zulu) and MUST include seconds (i.e.,\n   times are YYYYMMDDHHMMSSZ), even where the number of seconds is zero.\n   GeneralizedTime values MUST NOT include fractional seconds.\n\nNote that last paragraph well.  It MUST include seconds, and it MUST NOT \ninclude fractional seconds.", "bug_id": 634235, "author": "nelson@bolyard.me", "time": "2011-02-16T08:44:32Z", "count": 4, "is_private": false, "id": 5282480}, {"id": 5282490, "is_private": false, "time": "2011-02-16T08:50:04Z", "author": "mozbgz@velox.ch", "count": 5, "bug_id": 634235, "text": "(In reply to comment #4)\n> Note that last paragraph well.  It MUST include seconds, and it MUST NOT \n> include fractional seconds.\n\nYes, I know (it's the same in RFC 5280). But as noted in comment 3, RFC 2560 is relevant here - and I would assume that NSS also claims conformance to that one.", "creation_time": "2011-02-16T08:50:04Z", "tags": [], "attachment_id": null, "raw_text": "(In reply to comment #4)\n> Note that last paragraph well.  It MUST include seconds, and it MUST NOT \n> include fractional seconds.\n\nYes, I know (it's the same in RFC 5280). But as noted in comment 3, RFC 2560 is relevant here - and I would assume that NSS also claims conformance to that one.", "creator": "mozbgz@velox.ch"}, {"text": "In the context of OCSP responses, RFCs 3280 and 5280 and authoritative.\nI agree that there could be contexts, other than those related to PKIX, \nin which it would be desirable to support fractional seconds and/or minutes,\nwhich NSS does not.  But NSS's present choice of support is a deliberate \ndecision, and hence not a bug. Conssequently, this report is, at best, a \n\"request for enhancement\".  A request that, IMO, is likely to be denied \n(e.g WONT FIX).  But in any case, for Certificates, CRLs and OCSP, it's \nclear that RFC 3280/5280 is authoritative.", "bug_id": 634235, "raw_text": "In the context of OCSP responses, RFCs 3280 and 5280 and authoritative.\nI agree that there could be contexts, other than those related to PKIX, \nin which it would be desirable to support fractional seconds and/or minutes,\nwhich NSS does not.  But NSS's present choice of support is a deliberate \ndecision, and hence not a bug. Conssequently, this report is, at best, a \n\"request for enhancement\".  A request that, IMO, is likely to be denied \n(e.g WONT FIX).  But in any case, for Certificates, CRLs and OCSP, it's \nclear that RFC 3280/5280 is authoritative.", "creator": "nelson@bolyard.me", "creation_time": "2011-02-16T09:07:34Z", "tags": [], "attachment_id": null, "id": 5282512, "time": "2011-02-16T09:07:34Z", "author": "nelson@bolyard.me", "count": 6, "is_private": false}]}}, "comments": {}}