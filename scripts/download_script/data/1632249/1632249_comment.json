{"comments": {}, "bugs": {"1632249": {"comments": [{"creation_time": "2020-04-22T18:26:56Z", "creator": "jgilbert@mozilla.com", "time": "2020-04-22T18:26:56Z", "tags": [], "count": 0, "author": "jgilbert@mozilla.com", "id": 14772376, "is_private": false, "text": "One of the deep assumptions of in-process-webgl was about how backbuffers were presented to the compositor. Out-of-process breaks many assumptions, so we need to rework our approach here.", "raw_text": "One of the deep assumptions of in-process-webgl was about how backbuffers were presented to the compositor. Out-of-process breaks many assumptions, so we need to rework our approach here.", "attachment_id": null, "bug_id": 1632249}, {"author": "jgilbert@mozilla.com", "id": 14816323, "text": "Created attachment 9147917\nBug 1632249 - Support compositing out-of-process WebGL.\n\n* Majorly simplity CanvasRenderer\n* Replace GLScreenBuffer with trivial GLSwapChain\n* Use descriptor structs so that future SharedSurface changes aren't so painful\n  to propagate\n* Mortgage/strip out more OffscreenCanvas code for now", "raw_text": "* Majorly simplity CanvasRenderer\n* Replace GLScreenBuffer with trivial GLSwapChain\n* Use descriptor structs so that future SharedSurface changes aren't so painful\n  to propagate\n* Mortgage/strip out more OffscreenCanvas code for now", "is_private": false, "attachment_id": 9147917, "bug_id": 1632249, "creator": "jgilbert@mozilla.com", "creation_time": "2020-05-13T09:50:45Z", "time": "2020-05-13T09:50:45Z", "count": 1, "tags": []}, {"creation_time": "2020-05-13T17:56:38Z", "creator": "jgilbert@mozilla.com", "time": "2020-05-13T17:56:38Z", "tags": [], "count": 2, "id": 14817396, "author": "jgilbert@mozilla.com", "is_private": false, "raw_text": "Not bad for a first try run: https://treeherder.mozilla.org/#/jobs?repo=try&revision=dfa2ccabd9d5c4a5a18ab97dba32e44878feb5ed", "text": "Not bad for a first try run: https://treeherder.mozilla.org/#/jobs?repo=try&revision=dfa2ccabd9d5c4a5a18ab97dba32e44878feb5ed", "attachment_id": null, "bug_id": 1632249}, {"creator": "jgilbert@mozilla.com", "creation_time": "2020-05-15T00:52:55Z", "count": 3, "tags": [], "time": "2020-05-15T00:52:55Z", "raw_text": "Mochitests green: https://treeherder.mozilla.org/#/jobs?repo=try&revision=e85cfc88c3886da2672d5550aec8c2f224e438c3", "text": "Mochitests green: https://treeherder.mozilla.org/#/jobs?repo=try&revision=e85cfc88c3886da2672d5550aec8c2f224e438c3", "is_private": false, "author": "jgilbert@mozilla.com", "id": 14821739, "bug_id": 1632249, "attachment_id": null}, {"attachment_id": null, "bug_id": 1632249, "author": "jgilbert@mozilla.com", "id": 14821748, "raw_text": "Talos motionmark-gl runs look good too, though the reftests should show some breakage still.", "text": "Talos motionmark-gl runs look good too, though the reftests should show some breakage still.", "is_private": false, "time": "2020-05-15T00:59:55Z", "count": 4, "tags": [], "creator": "jgilbert@mozilla.com", "creation_time": "2020-05-15T00:59:55Z"}, {"author": "jgilbert@mozilla.com", "id": 14832647, "is_private": false, "raw_text": "Win10 WR R2 is thei only new failure I see:\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=976eadf185158bd80d2d8175d54478354e40c5cd\n\nvs merge-base:\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=02e94d1d140b542c41ccc49d640f74ab56f4bb5c\n\n\nI haven't been able to repro it locally on my machines so far. Possible speculative fix by reverting supposedly-unrelated change:\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=c13242b6f855e55f7c6a2c0beaca53266960f098", "text": "Win10 WR R2 is thei only new failure I see:\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=976eadf185158bd80d2d8175d54478354e40c5cd\n\nvs merge-base:\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=02e94d1d140b542c41ccc49d640f74ab56f4bb5c\n\n\nI haven't been able to repro it locally on my machines so far. Possible speculative fix by reverting supposedly-unrelated change:\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=c13242b6f855e55f7c6a2c0beaca53266960f098", "attachment_id": null, "bug_id": 1632249, "creation_time": "2020-05-20T07:13:08Z", "creator": "jgilbert@mozilla.com", "time": "2020-05-20T07:13:08Z", "tags": [], "count": 5}, {"author": "jgilbert@mozilla.com", "id": 14861108, "raw_text": "", "text": "Created attachment 9153914\nBug 1632249 - WebXR compositing fixes.", "is_private": false, "attachment_id": 9153914, "bug_id": 1632249, "creator": "jgilbert@mozilla.com", "creation_time": "2020-06-03T17:59:24Z", "time": "2020-06-03T17:59:24Z", "count": 6, "tags": []}, {"text": "Created attachment 9154214\nBug 1632249 - Create a separate WebGLContext::PresentInto function for WebXR.", "raw_text": "", "is_private": false, "author": "mortimergoro@gmail.com", "id": 14862984, "bug_id": 1632249, "attachment_id": 9154214, "creator": "mortimergoro@gmail.com", "creation_time": "2020-06-04T15:16:02Z", "count": 7, "tags": [], "time": "2020-06-04T15:16:02Z"}, {"attachment_id": 9154599, "bug_id": 1632249, "author": "mortimergoro@gmail.com", "id": 14865605, "is_private": false, "raw_text": "\nSome hack to add pooling and measure performance on Android. Not refactored for production yet.", "text": "Created attachment 9154599\nBug 1632249 - Enable WebGL SwapChain pooling on Android. Use a separate SwapChain for WebVR.\n\n\nSome hack to add pooling and measure performance on Android. Not refactored for production yet.", "time": "2020-06-05T16:17:53Z", "tags": [], "count": 8, "creation_time": "2020-06-05T16:17:53Z", "creator": "mortimergoro@gmail.com"}, {"creation_time": "2020-06-08T20:34:33Z", "author": "jgilbert@mozilla.com", "id": 14870395, "creator": "jgilbert@mozilla.com", "is_private": false, "raw_text": "", "text": "Created attachment 9155101\nBug 1632249 - NON_PREMULT TextureClient iff NON_PREMULT CanvasClient.", "attachment_id": 9155101, "time": "2020-06-08T20:34:33Z", "tags": [], "count": 9, "bug_id": 1632249}, {"creator": "pulsebot@bots.tld", "id": 14870461, "creation_time": "2020-06-08T21:00:55Z", "author": "pulsebot@bots.tld", "raw_text": "Pushed by jgilbert@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/bbfe23c61add\nSupport compositing out-of-process WebGL. r=handyman,lsalzman,nical,geckoview-reviewers,agi,imanol\nhttps://hg.mozilla.org/integration/autoland/rev/16d84439756f\nWebXR compositing fixes. r=imanol\nhttps://hg.mozilla.org/integration/autoland/rev/9ff26bcc580c\nCreate a separate WebGLContext::PresentInto function for WebXR. r=jgilbert\nhttps://hg.mozilla.org/integration/autoland/rev/cdaa8a4e9e36\nNON_PREMULT TextureClient iff NON_PREMULT CanvasClient. r=handyman", "text": "Pushed by jgilbert@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/bbfe23c61add\nSupport compositing out-of-process WebGL. r=handyman,lsalzman,nical,geckoview-reviewers,agi,imanol\nhttps://hg.mozilla.org/integration/autoland/rev/16d84439756f\nWebXR compositing fixes. r=imanol\nhttps://hg.mozilla.org/integration/autoland/rev/9ff26bcc580c\nCreate a separate WebGLContext::PresentInto function for WebXR. r=jgilbert\nhttps://hg.mozilla.org/integration/autoland/rev/cdaa8a4e9e36\nNON_PREMULT TextureClient iff NON_PREMULT CanvasClient. r=handyman", "is_private": false, "attachment_id": null, "time": "2020-06-08T21:00:55Z", "bug_id": 1632249, "count": 10, "tags": []}, {"creator": "jgilbert@mozilla.com", "creation_time": "2020-06-09T00:28:28Z", "count": 11, "tags": [], "time": "2020-06-09T00:28:28Z", "raw_text": "> /builds/worker/checkouts/gecko/gfx/gl/SharedSurface.cpp:141:1: error: control reaches end of non-void function [-Werror=return-type]\n\nOld compilers don't realize the switch being exhaustive means the\nfunction always returns, which we workaround here.", "text": "Created attachment 9155158\nBug 1632249 - Fix Bb failures.\n\n> /builds/worker/checkouts/gecko/gfx/gl/SharedSurface.cpp:141:1: error: control reaches end of non-void function [-Werror=return-type]\n\nOld compilers don't realize the switch being exhaustive means the\nfunction always returns, which we workaround here.", "is_private": false, "id": 14870775, "author": "jgilbert@mozilla.com", "bug_id": 1632249, "attachment_id": 9155158}, {"bug_id": 1632249, "attachment_id": null, "text": "Backed out 4 changesets (bug 1632249) for Build bustages and mda failures. CLOSED TREE \n\nLogs:\n\nBuild bustage:\nhttps://treeherder.mozilla.org/logviewer.html#/jobs?job_id=305552636&repo=autoland&lineNumber=21981\n\nmda:\nhttps://treeherder.mozilla.org/logviewer.html#/jobs?job_id=305555857&repo=autoland&lineNumber=2255\n\nPush with failures:\nhttps://treeherder.mozilla.org/#/jobs?repo=autoland&group_state=expanded&selectedTaskRun=eTPqevlfS9e-aV7lYo6v3g-0&revision=cdaa8a4e9e366ad041b429a8f5bd0b9b259d4722\n\nBackout:\nhttps://hg.mozilla.org/integration/autoland/rev/4b54c176764ecb8e0c9576687087d4c75bd1da4f", "raw_text": "Backed out 4 changesets (bug 1632249) for Build bustages and mda failures. CLOSED TREE \n\nLogs:\n\nBuild bustage:\nhttps://treeherder.mozilla.org/logviewer.html#/jobs?job_id=305552636&repo=autoland&lineNumber=21981\n\nmda:\nhttps://treeherder.mozilla.org/logviewer.html#/jobs?job_id=305555857&repo=autoland&lineNumber=2255\n\nPush with failures:\nhttps://treeherder.mozilla.org/#/jobs?repo=autoland&group_state=expanded&selectedTaskRun=eTPqevlfS9e-aV7lYo6v3g-0&revision=cdaa8a4e9e366ad041b429a8f5bd0b9b259d4722\n\nBackout:\nhttps://hg.mozilla.org/integration/autoland/rev/4b54c176764ecb8e0c9576687087d4c75bd1da4f", "is_private": false, "id": 14870785, "author": "dluca@mozilla.com", "count": 12, "tags": [], "time": "2020-06-09T00:46:57Z", "creator": "dluca@mozilla.com", "creation_time": "2020-06-09T00:46:57Z"}, {"is_private": false, "raw_text": "", "text": "Created attachment 9155489\nBug 1632249 - Mark mCapturedFrameInvalidated even if mIsCanvasDirty.", "creation_time": "2020-06-10T01:10:14Z", "author": "jgilbert@mozilla.com", "id": 14873218, "creator": "jgilbert@mozilla.com", "tags": [], "bug_id": 1632249, "count": 13, "attachment_id": 9155489, "time": "2020-06-10T01:10:14Z"}, {"time": "2020-06-10T22:23:27Z", "attachment_id": null, "bug_id": 1632249, "count": 14, "tags": [], "creator": "pulsebot@bots.tld", "author": "pulsebot@bots.tld", "id": 14875207, "creation_time": "2020-06-10T22:23:27Z", "text": "Pushed by jgilbert@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/dd00e2da3a0f\nSupport compositing out-of-process WebGL. r=handyman,lsalzman,nical,geckoview-reviewers,agi,imanol\nhttps://hg.mozilla.org/integration/autoland/rev/6e9a89ead3a5\nWebXR compositing fixes. r=imanol\nhttps://hg.mozilla.org/integration/autoland/rev/71ad2ed8e9ba\nCreate a separate WebGLContext::PresentInto function for WebXR. r=jgilbert\nhttps://hg.mozilla.org/integration/autoland/rev/b15d91e64a25\nNON_PREMULT TextureClient iff NON_PREMULT CanvasClient. r=handyman\nhttps://hg.mozilla.org/integration/autoland/rev/04f5127c85d5\nFix Bb failures. r=gw\nhttps://hg.mozilla.org/integration/autoland/rev/c93972b05d4f\nMark mCapturedFrameInvalidated even if mIsCanvasDirty. r=handyman", "raw_text": "Pushed by jgilbert@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/dd00e2da3a0f\nSupport compositing out-of-process WebGL. r=handyman,lsalzman,nical,geckoview-reviewers,agi,imanol\nhttps://hg.mozilla.org/integration/autoland/rev/6e9a89ead3a5\nWebXR compositing fixes. r=imanol\nhttps://hg.mozilla.org/integration/autoland/rev/71ad2ed8e9ba\nCreate a separate WebGLContext::PresentInto function for WebXR. r=jgilbert\nhttps://hg.mozilla.org/integration/autoland/rev/b15d91e64a25\nNON_PREMULT TextureClient iff NON_PREMULT CanvasClient. r=handyman\nhttps://hg.mozilla.org/integration/autoland/rev/04f5127c85d5\nFix Bb failures. r=gw\nhttps://hg.mozilla.org/integration/autoland/rev/c93972b05d4f\nMark mCapturedFrameInvalidated even if mIsCanvasDirty. r=handyman", "is_private": false}, {"tags": [], "count": 15, "time": "2020-06-10T23:49:02Z", "creation_time": "2020-06-10T23:49:02Z", "creator": "malexandru@mozilla.com", "bug_id": 1632249, "attachment_id": null, "is_private": false, "raw_text": "Backed out 6 changesets for causing bustages in CanvasRenderingContext2D.cpp\n\nBackout link: https://hg.mozilla.org/integration/autoland/rev/c7dbcbcbb07745ad124640bc639c86a251c66300\n\nPush with failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&group_state=expanded&resultStatus=pending%2Crunning%2Csuccess%2Ctestfailed%2Cbusted%2Cexception%2Crunnable&searchStr=hazard&tochange=c7dbcbcbb07745ad124640bc639c86a251c66300&fromchange=c93972b05d4f105953213185bd4e0da2403dedd1&selectedTaskRun=KgnTCag0TbKBqMwBK4cSDA-0\n\nFailure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=305867365&repo=autoland&lineNumber=34974", "text": "Backed out 6 changesets for causing bustages in CanvasRenderingContext2D.cpp\n\nBackout link: https://hg.mozilla.org/integration/autoland/rev/c7dbcbcbb07745ad124640bc639c86a251c66300\n\nPush with failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&group_state=expanded&resultStatus=pending%2Crunning%2Csuccess%2Ctestfailed%2Cbusted%2Cexception%2Crunnable&searchStr=hazard&tochange=c7dbcbcbb07745ad124640bc639c86a251c66300&fromchange=c93972b05d4f105953213185bd4e0da2403dedd1&selectedTaskRun=KgnTCag0TbKBqMwBK4cSDA-0\n\nFailure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=305867365&repo=autoland&lineNumber=34974", "author": "malexandru@mozilla.com", "id": 14875300}, {"creation_time": "2020-06-11T06:37:51Z", "creator": "jgilbert@mozilla.com", "tags": [], "count": 16, "time": "2020-06-11T06:37:51Z", "is_private": false, "raw_text": "", "text": "Created attachment 9155863\nBug 1632249 - Remove unused var g2DContextLayerUserData.", "author": "jgilbert@mozilla.com", "id": 14875661, "bug_id": 1632249, "attachment_id": 9155863}, {"attachment_id": null, "bug_id": 1632249, "author": "pulsebot@bots.tld", "id": 14875663, "raw_text": "Pushed by jgilbert@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/204b899f436d\nSupport compositing out-of-process WebGL. r=handyman,lsalzman,nical,geckoview-reviewers,agi,imanol\nhttps://hg.mozilla.org/integration/autoland/rev/7c94d37c446e\nWebXR compositing fixes. r=imanol\nhttps://hg.mozilla.org/integration/autoland/rev/073302d26c5e\nCreate a separate WebGLContext::PresentInto function for WebXR. r=jgilbert\nhttps://hg.mozilla.org/integration/autoland/rev/6f19f43e0a0b\nNON_PREMULT TextureClient iff NON_PREMULT CanvasClient. r=handyman\nhttps://hg.mozilla.org/integration/autoland/rev/64fbb616a0f3\nFix Bb failures. r=gw\nhttps://hg.mozilla.org/integration/autoland/rev/d5b7fe789001\nMark mCapturedFrameInvalidated even if mIsCanvasDirty. r=handyman\nhttps://hg.mozilla.org/integration/autoland/rev/4ff99aab3ee8\nRemove unused var g2DContextLayerUserData.", "text": "Pushed by jgilbert@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/204b899f436d\nSupport compositing out-of-process WebGL. r=handyman,lsalzman,nical,geckoview-reviewers,agi,imanol\nhttps://hg.mozilla.org/integration/autoland/rev/7c94d37c446e\nWebXR compositing fixes. r=imanol\nhttps://hg.mozilla.org/integration/autoland/rev/073302d26c5e\nCreate a separate WebGLContext::PresentInto function for WebXR. r=jgilbert\nhttps://hg.mozilla.org/integration/autoland/rev/6f19f43e0a0b\nNON_PREMULT TextureClient iff NON_PREMULT CanvasClient. r=handyman\nhttps://hg.mozilla.org/integration/autoland/rev/64fbb616a0f3\nFix Bb failures. r=gw\nhttps://hg.mozilla.org/integration/autoland/rev/d5b7fe789001\nMark mCapturedFrameInvalidated even if mIsCanvasDirty. r=handyman\nhttps://hg.mozilla.org/integration/autoland/rev/4ff99aab3ee8\nRemove unused var g2DContextLayerUserData.", "is_private": false, "time": "2020-06-11T06:40:08Z", "count": 17, "tags": [], "creator": "pulsebot@bots.tld", "creation_time": "2020-06-11T06:40:08Z"}, {"is_private": false, "text": "https://hg.mozilla.org/mozilla-central/rev/204b899f436d\nhttps://hg.mozilla.org/mozilla-central/rev/7c94d37c446e\nhttps://hg.mozilla.org/mozilla-central/rev/073302d26c5e\nhttps://hg.mozilla.org/mozilla-central/rev/6f19f43e0a0b\nhttps://hg.mozilla.org/mozilla-central/rev/64fbb616a0f3\nhttps://hg.mozilla.org/mozilla-central/rev/d5b7fe789001\nhttps://hg.mozilla.org/mozilla-central/rev/4ff99aab3ee8", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/204b899f436d\nhttps://hg.mozilla.org/mozilla-central/rev/7c94d37c446e\nhttps://hg.mozilla.org/mozilla-central/rev/073302d26c5e\nhttps://hg.mozilla.org/mozilla-central/rev/6f19f43e0a0b\nhttps://hg.mozilla.org/mozilla-central/rev/64fbb616a0f3\nhttps://hg.mozilla.org/mozilla-central/rev/d5b7fe789001\nhttps://hg.mozilla.org/mozilla-central/rev/4ff99aab3ee8", "id": 14875841, "author": "abutkovits@mozilla.com", "bug_id": 1632249, "attachment_id": null, "creation_time": "2020-06-11T09:41:30Z", "creator": "abutkovits@mozilla.com", "tags": ["bugherder"], "count": 18, "time": "2020-06-11T09:41:30Z"}, {"text": "Backed out 7 changesets (Bug 1632249) for Gtest perma chrash in [@ mozilla::BlockingResourceBase::CheckAcquir\n\nBackout: https://hg.mozilla.org/integration/autoland/rev/3a722303e8853eb8b88422f151d3d12dfd6234bc\n\nFailure push:  https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=4ff99aab3ee8bc2310e49d8db7032b5ede0490e2\n\nFailure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=305961758&repo=autoland&lineNumber=26464", "raw_text": "Backed out 7 changesets (Bug 1632249) for Gtest perma chrash in [@ mozilla::BlockingResourceBase::CheckAcquir\n\nBackout: https://hg.mozilla.org/integration/autoland/rev/3a722303e8853eb8b88422f151d3d12dfd6234bc\n\nFailure push:  https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=4ff99aab3ee8bc2310e49d8db7032b5ede0490e2\n\nFailure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=305961758&repo=autoland&lineNumber=26464", "is_private": false, "creator": "ccoroiu@mozilla.com", "creation_time": "2020-06-11T16:59:06Z", "author": "ccoroiu@mozilla.com", "id": 14876657, "count": 19, "bug_id": 1632249, "tags": [], "attachment_id": null, "time": "2020-06-11T16:59:06Z"}, {"attachment_id": 9156115, "bug_id": 1632249, "id": 14877442, "author": "jgilbert@mozilla.com", "is_private": false, "text": "Created attachment 9156115\nBug 1632249 - Replace GLContextProvider::CreateOffscreen with GLContext::CreateOffscreenDefaultFb.", "raw_text": "", "time": "2020-06-11T23:22:03Z", "tags": [], "count": 20, "creation_time": "2020-06-11T23:22:03Z", "creator": "jgilbert@mozilla.com"}, {"creation_time": "2020-06-12T00:14:44Z", "creator": "mstange.moz@gmail.com", "time": "2020-06-12T00:14:44Z", "tags": [], "count": 21, "id": 14877504, "author": "mstange.moz@gmail.com", "is_private": false, "raw_text": "It seems that this patch set severely regresses macOS WebGL performance - it causes WebGL to use readback in the content process.\nThe patch set made it into the current Nightly. I discovered this because my virtu-allhands experience was not great.", "text": "It seems that this patch set severely regresses macOS WebGL performance - it causes WebGL to use readback in the content process.\nThe patch set made it into the current Nightly. I discovered this because my virtu-allhands experience was not great.", "attachment_id": null, "bug_id": 1632249}, {"time": "2020-06-12T06:34:06Z", "attachment_id": null, "bug_id": 1632249, "count": 22, "tags": [], "creator": "aryx.bugmail@gmx-topmail.de", "creation_time": "2020-06-12T06:34:06Z", "id": 14877907, "author": "aryx.bugmail@gmx-topmail.de", "raw_text": "Backout merged: https://hg.mozilla.org/mozilla-central/rev/3a722303e885", "text": "Backout merged: https://hg.mozilla.org/mozilla-central/rev/3a722303e885", "is_private": false}, {"text": "(In reply to Markus Stange [:mstange] from comment #21)\n> It seems that this patch set severely regresses macOS WebGL performance - it causes WebGL to use readback in the content process.\n> The patch set made it into the current Nightly. I discovered this because my virtu-allhands experience was not great.\n\nIt appears to have the same effect on Android, too, by making us use a `SharedSurface_Basic` instead of a `SharedSurface_SurfaceTexture`. It appears we now select the `SurfaceFactory` type based on the \"preferred texture type\", which is basic on android. Setting `gfx.use-surfacetexture-textures = true` makes us use SurfaceTextures for canvas again, and it appears to work fine. However, we don't want to do that as it makes us use SurfaceTextures for painted content. We need to distinguish between the preferred texture type for CPU-painted content and for GPU canvas.", "raw_text": "(In reply to Markus Stange [:mstange] from comment #21)\n> It seems that this patch set severely regresses macOS WebGL performance - it causes WebGL to use readback in the content process.\n> The patch set made it into the current Nightly. I discovered this because my virtu-allhands experience was not great.\n\nIt appears to have the same effect on Android, too, by making us use a `SharedSurface_Basic` instead of a `SharedSurface_SurfaceTexture`. It appears we now select the `SurfaceFactory` type based on the \"preferred texture type\", which is basic on android. Setting `gfx.use-surfacetexture-textures = true` makes us use SurfaceTextures for canvas again, and it appears to work fine. However, we don't want to do that as it makes us use SurfaceTextures for painted content. We need to distinguish between the preferred texture type for CPU-painted content and for GPU canvas.", "is_private": false, "creator": "jnicol@mozilla.com", "id": 14878378, "creation_time": "2020-06-12T11:16:51Z", "author": "jnicol@mozilla.com", "bug_id": 1632249, "count": 23, "tags": [], "time": "2020-06-12T11:16:51Z", "attachment_id": null}, {"id": 14878701, "author": "ryanvm@gmail.com", "text": "FYI, we also saw a Nightly [@ mozilla::layers::CanvasClient::UseTexture ] crash spike that looks related to this bug:\nhttps://crash-stats.mozilla.org/report/index/28b7aa44-07a7-4bb2-ab95-7e2130200612", "raw_text": "FYI, we also saw a Nightly [@ mozilla::layers::CanvasClient::UseTexture ] crash spike that looks related to this bug:\nhttps://crash-stats.mozilla.org/report/index/28b7aa44-07a7-4bb2-ab95-7e2130200612", "is_private": false, "attachment_id": null, "bug_id": 1632249, "creator": "ryanvm@gmail.com", "creation_time": "2020-06-12T14:34:45Z", "time": "2020-06-12T14:34:45Z", "count": 24, "tags": []}, {"creator": "jgilbert@mozilla.com", "creation_time": "2020-06-14T19:37:15Z", "time": "2020-06-14T19:37:15Z", "count": 25, "tags": [], "id": 14880714, "author": "jgilbert@mozilla.com", "raw_text": "", "text": "Created attachment 9156587\nBug 1632249 - Determine webgl's layers::TextureType in Present.", "is_private": false, "attachment_id": 9156587, "bug_id": 1632249}, {"time": "2020-06-15T00:33:03Z", "count": 26, "tags": [], "creator": "jgilbert@mozilla.com", "creation_time": "2020-06-15T00:33:03Z", "attachment_id": 9156600, "bug_id": 1632249, "id": 14880791, "author": "jgilbert@mozilla.com", "text": "Created attachment 9156600\nBug 1632249 - Check weakptr value before deref in gl::Texture/Renderbuffer.", "raw_text": "", "is_private": false}, {"creator": "jgilbert@mozilla.com", "creation_time": "2020-06-15T07:24:19Z", "time": "2020-06-15T07:24:19Z", "count": 27, "tags": [], "author": "jgilbert@mozilla.com", "id": 14882401, "text": "Created attachment 9156641\nBug 1632249 - Disable now-failing DXGL test for now.", "raw_text": "", "is_private": false, "attachment_id": 9156641, "bug_id": 1632249}, {"creator": "pulsebot@bots.tld", "creation_time": "2020-06-15T18:28:18Z", "time": "2020-06-15T18:28:18Z", "count": 28, "tags": [], "id": 14883375, "author": "pulsebot@bots.tld", "raw_text": "Pushed by jgilbert@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/16c5dd2cfd60\nSupport compositing out-of-process WebGL. r=handyman,lsalzman,nical,geckoview-reviewers,agi,imanol\nhttps://hg.mozilla.org/integration/autoland/rev/0b191b707750\nWebXR compositing fixes. r=imanol\nhttps://hg.mozilla.org/integration/autoland/rev/4cda148ef28f\nCreate a separate WebGLContext::PresentInto function for WebXR. r=jgilbert\nhttps://hg.mozilla.org/integration/autoland/rev/fd4a74ec97a5\nNON_PREMULT TextureClient iff NON_PREMULT CanvasClient. r=handyman\nhttps://hg.mozilla.org/integration/autoland/rev/8f0fb988dc5a\nFix Bb failures. r=gw\nhttps://hg.mozilla.org/integration/autoland/rev/2739940a4fb7\nMark mCapturedFrameInvalidated even if mIsCanvasDirty. r=handyman\nhttps://hg.mozilla.org/integration/autoland/rev/e326157c5af9\nRemove unused var g2DContextLayerUserData.\nhttps://hg.mozilla.org/integration/autoland/rev/8439f89e170b\nReplace GLContextProvider::CreateOffscreen with GLContext::CreateOffscreenDefaultFb. r=lsalzman\nhttps://hg.mozilla.org/integration/autoland/rev/05896dbeb434\nDetermine webgl's layers::TextureType in Present. r=lsalzman\nhttps://hg.mozilla.org/integration/autoland/rev/832f39c3b02c\nCheck weakptr value before deref in gl::Texture/Renderbuffer. r=lsalzman\nhttps://hg.mozilla.org/integration/autoland/rev/567a8768593e\nDisable now-failing DXGL test for now.", "text": "Pushed by jgilbert@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/16c5dd2cfd60\nSupport compositing out-of-process WebGL. r=handyman,lsalzman,nical,geckoview-reviewers,agi,imanol\nhttps://hg.mozilla.org/integration/autoland/rev/0b191b707750\nWebXR compositing fixes. r=imanol\nhttps://hg.mozilla.org/integration/autoland/rev/4cda148ef28f\nCreate a separate WebGLContext::PresentInto function for WebXR. r=jgilbert\nhttps://hg.mozilla.org/integration/autoland/rev/fd4a74ec97a5\nNON_PREMULT TextureClient iff NON_PREMULT CanvasClient. r=handyman\nhttps://hg.mozilla.org/integration/autoland/rev/8f0fb988dc5a\nFix Bb failures. r=gw\nhttps://hg.mozilla.org/integration/autoland/rev/2739940a4fb7\nMark mCapturedFrameInvalidated even if mIsCanvasDirty. r=handyman\nhttps://hg.mozilla.org/integration/autoland/rev/e326157c5af9\nRemove unused var g2DContextLayerUserData.\nhttps://hg.mozilla.org/integration/autoland/rev/8439f89e170b\nReplace GLContextProvider::CreateOffscreen with GLContext::CreateOffscreenDefaultFb. r=lsalzman\nhttps://hg.mozilla.org/integration/autoland/rev/05896dbeb434\nDetermine webgl's layers::TextureType in Present. r=lsalzman\nhttps://hg.mozilla.org/integration/autoland/rev/832f39c3b02c\nCheck weakptr value before deref in gl::Texture/Renderbuffer. r=lsalzman\nhttps://hg.mozilla.org/integration/autoland/rev/567a8768593e\nDisable now-failing DXGL test for now.", "is_private": false, "attachment_id": null, "bug_id": 1632249}, {"bug_id": 1632249, "attachment_id": null, "is_private": false, "raw_text": "https://hg.mozilla.org/mozilla-central/rev/16c5dd2cfd60\nhttps://hg.mozilla.org/mozilla-central/rev/0b191b707750\nhttps://hg.mozilla.org/mozilla-central/rev/4cda148ef28f\nhttps://hg.mozilla.org/mozilla-central/rev/fd4a74ec97a5\nhttps://hg.mozilla.org/mozilla-central/rev/8f0fb988dc5a\nhttps://hg.mozilla.org/mozilla-central/rev/2739940a4fb7\nhttps://hg.mozilla.org/mozilla-central/rev/e326157c5af9\nhttps://hg.mozilla.org/mozilla-central/rev/8439f89e170b\nhttps://hg.mozilla.org/mozilla-central/rev/05896dbeb434\nhttps://hg.mozilla.org/mozilla-central/rev/832f39c3b02c\nhttps://hg.mozilla.org/mozilla-central/rev/567a8768593e", "text": "https://hg.mozilla.org/mozilla-central/rev/16c5dd2cfd60\nhttps://hg.mozilla.org/mozilla-central/rev/0b191b707750\nhttps://hg.mozilla.org/mozilla-central/rev/4cda148ef28f\nhttps://hg.mozilla.org/mozilla-central/rev/fd4a74ec97a5\nhttps://hg.mozilla.org/mozilla-central/rev/8f0fb988dc5a\nhttps://hg.mozilla.org/mozilla-central/rev/2739940a4fb7\nhttps://hg.mozilla.org/mozilla-central/rev/e326157c5af9\nhttps://hg.mozilla.org/mozilla-central/rev/8439f89e170b\nhttps://hg.mozilla.org/mozilla-central/rev/05896dbeb434\nhttps://hg.mozilla.org/mozilla-central/rev/832f39c3b02c\nhttps://hg.mozilla.org/mozilla-central/rev/567a8768593e", "id": 14883720, "author": "btara@mozilla.com", "tags": ["bugherder"], "count": 29, "time": "2020-06-15T21:50:27Z", "creation_time": "2020-06-15T21:50:27Z", "creator": "btara@mozilla.com"}, {"time": "2020-06-16T06:51:17Z", "tags": [], "count": 30, "creation_time": "2020-06-16T06:51:17Z", "creator": "aionescu@mozilla.com", "attachment_id": null, "bug_id": 1632249, "id": 14884200, "author": "aionescu@mozilla.com", "is_private": false, "text": "(In reply to Pulsebot from comment #17)\n> https://hg.mozilla.org/integration/autoland/rev/c93972b05d4f\n> Mark mCapturedFrameInvalidated even if mIsCanvasDirty. r=handyman\n\n== Change summary for alert #26188 (as of Thu, 11 Jun 2020 21:41:47 GMT) ==\n\nRegressions:\n\n 221%  glterrain macosx1014-64-shippable opt e10s stylo     2.92 -> 9.39\n\nFor up to date results, see: https://treeherder.mozilla.org/perf.html#/alerts?id=26188", "raw_text": "(In reply to Pulsebot from comment #17)\n> https://hg.mozilla.org/integration/autoland/rev/c93972b05d4f\n> Mark mCapturedFrameInvalidated even if mIsCanvasDirty. r=handyman\n\n== Change summary for alert #26188 (as of Thu, 11 Jun 2020 21:41:47 GMT) ==\n\nRegressions:\n\n 221%  glterrain macosx1014-64-shippable opt e10s stylo     2.92 -> 9.39\n\nFor up to date results, see: https://treeherder.mozilla.org/perf.html#/alerts?id=26188"}, {"attachment_id": null, "bug_id": 1632249, "author": "aionescu@mozilla.com", "id": 14884203, "is_private": false, "text": "(In reply to Alexandru Michis [:malexandru] from comment #15)\n> Backed out 6 changesets for causing bustages in CanvasRenderingContext2D.cpp\n> \n> Backout link: https://hg.mozilla.org/integration/autoland/rev/c7dbcbcbb07745ad124640bc639c86a251c66300\n\n== Change summary for alert #26230 (as of Tue, 16 Jun 2020 03:43:13 GMT) ==\n\nImprovements:\n\n  35%  glterrain macosx1014-64-shippable opt e10s stylo     4.58 -> 2.96\n\nFor up to date results, see: https://treeherder.mozilla.org/perf.html#/alerts?id=26230", "raw_text": "(In reply to Alexandru Michis [:malexandru] from comment #15)\n> Backed out 6 changesets for causing bustages in CanvasRenderingContext2D.cpp\n> \n> Backout link: https://hg.mozilla.org/integration/autoland/rev/c7dbcbcbb07745ad124640bc639c86a251c66300\n\n== Change summary for alert #26230 (as of Tue, 16 Jun 2020 03:43:13 GMT) ==\n\nImprovements:\n\n  35%  glterrain macosx1014-64-shippable opt e10s stylo     4.58 -> 2.96\n\nFor up to date results, see: https://treeherder.mozilla.org/perf.html#/alerts?id=26230", "time": "2020-06-16T06:55:22Z", "tags": [], "count": 31, "creation_time": "2020-06-16T06:55:22Z", "creator": "aionescu@mozilla.com"}, {"time": "2020-06-17T15:25:53Z", "count": 32, "tags": [], "creator": "aionescu@mozilla.com", "creation_time": "2020-06-17T15:25:53Z", "attachment_id": null, "bug_id": 1632249, "id": 14887243, "author": "aionescu@mozilla.com", "raw_text": "deleted", "text": "deleted", "is_private": false}]}}}