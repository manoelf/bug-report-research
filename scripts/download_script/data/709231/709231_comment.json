{"bugs": {"709231": {"comments": [{"bug_id": 709231, "count": 0, "id": 5904946, "attachment_id": null, "raw_text": "I'm fixing some issues in my students' tests for the Mouse Lock api, which uses the new fullscreen api in all the tests.  I'm hitting the following, which is causing me to crash:\n\n###!!! ASSERTION: Should be full-screen doc: 'doc->IsFullScreenDoc()', file /Users/dave/repos/mozilla-central/content/base/src/nsDocument.cpp, line 8604\nnsDocument::RestorePreviousFullScreenState()+0x0000016F [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x006FC4EF]\nnsDocument::MozCancelFullScreen()+0x00000037 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x006E0005]\nNS_InvokeByIndex_P+0x0000030E [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x017E0A35]\nCallMethodHelper::Invoke()+0x00000064 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105D3EC]\nCallMethodHelper::Call()+0x0000011B [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105FDCD]\nXPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode)+0x000002E0 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105927C]\nXPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*)+0x00000258 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01065215]\njs::CallJSNative(JSContext*, int (*)(JSContext*, unsigned int, JS::Value*), js::CallArgs const&)+0x0000006E [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D680AE]\njs::InvokeKernel(JSContext*, js::CallArgs, js::MaybeConstruct)+0x00000237 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65627]\njs::Interpret(JSContext*, js::StackFrame*, js::InterpMode)+0x0000C731 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D58DF8]\njs::RunScript(JSContext*, JSScript*, js::StackFrame*)+0x00000140 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D64FD1]\njs::InvokeKernel(JSContext*, js::CallArgs, js::MaybeConstruct)+0x00000316 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65706]\njs::Invoke(JSContext*, js::InvokeArgsGuard&, js::MaybeConstruct)+0x0000005B [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01CBFA4F]\njs::Invoke(JSContext*, JS::Value const&, JS::Value const&, unsigned int, JS::Value*, JS::Value*)+0x0000011C [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65B26]\nJS_CallFunctionValue+0x000001C3 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01C87FA2]\nnsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*)+0x000012BC [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0104D264]\nnsXPCWrappedJS::CallMethod(unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*)+0x0000013C [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01043F54]\nPrepareAndDispatch+0x0000051A [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x017E2074]\n###!!! ASSERTION: You can't dereference a NULL nsCOMPtr with operator->().: 'mRawPtr != 0', file ../../../dist/include/nsCOMPtr.h, line 846\nnsCOMPtr<nsIDocument>::operator->() const+0x0000003D [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x00268E79]\nnsDocument::RestorePreviousFullScreenState()+0x000002A1 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x006FC621]\nnsDocument::MozCancelFullScreen()+0x00000037 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x006E0005]\nnsHTMLDocument::MozCancelFullScreen()+0x00000015 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0097837B]\nNS_InvokeByIndex_P+0x0000030E [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x017E0A35]\nCallMethodHelper::Invoke()+0x00000064 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105D3EC]\nCallMethodHelper::Call()+0x0000011B [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105FDCD]\nXPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode)+0x000002E0 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105927C]\nXPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*)+0x00000258 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01065215]\njs::CallJSNative(JSContext*, int (*)(JSContext*, unsigned int, JS::Value*), js::CallArgs const&)+0x0000006E [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D680AE]\njs::InvokeKernel(JSContext*, js::CallArgs, js::MaybeConstruct)+0x00000237 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65627]\njs::Interpret(JSContext*, js::StackFrame*, js::InterpMode)+0x0000C731 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D58DF8]\njs::RunScript(JSContext*, JSScript*, js::StackFrame*)+0x00000140 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D64FD1]\njs::InvokeKernel(JSContext*, js::CallArgs, js::MaybeConstruct)+0x00000316 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65706]\njs::Invoke(JSContext*, js::InvokeArgsGuard&, js::MaybeConstruct)+0x0000005B [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01CBFA4F]\njs::Invoke(JSContext*, JS::Value const&, JS::Value const&, unsigned int, JS::Value*, JS::Value*)+0x0000011C [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65B26]\nJS_CallFunctionValue+0x000001C3 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01C87FA2]\nnsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*)+0x000012BC [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0104D264]\nnsXPCWrappedJS::CallMethod(unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*)+0x0000013C [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01043F54]\nPrepareAndDispatch+0x0000051A [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x017E2074]\nTEST-UNEXPECTED-FAIL | /tests/dom/tests/mochitest/mouselock/test_FullScreenHarness.html | Exited with code 1 during test run\n\nThe code that's doing this essential is doing:\n\n* open a child window\n* go fullscreen in child window, do some things\n* end the test like this:\n  document.mozCancelFullScreen();\n  nextTest(); // calls back into window.opener to start a new test\n\nWhen I change their code so that nextTest() waits for a mozfullscreenchange event, it doesn't crash.  What might be happening here is that another window may have fullscreen by the time this one is going out of fullscreen, and for some reason this null pointer dereference happens.\n\nI'm not 100% sure yet, but filing now while I see it happening.", "creation_time": "2011-12-09T19:40:07Z", "author": "david.humphrey@senecacollege.ca", "text": "I'm fixing some issues in my students' tests for the Mouse Lock api, which uses the new fullscreen api in all the tests.  I'm hitting the following, which is causing me to crash:\n\n###!!! ASSERTION: Should be full-screen doc: 'doc->IsFullScreenDoc()', file /Users/dave/repos/mozilla-central/content/base/src/nsDocument.cpp, line 8604\nnsDocument::RestorePreviousFullScreenState()+0x0000016F [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x006FC4EF]\nnsDocument::MozCancelFullScreen()+0x00000037 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x006E0005]\nNS_InvokeByIndex_P+0x0000030E [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x017E0A35]\nCallMethodHelper::Invoke()+0x00000064 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105D3EC]\nCallMethodHelper::Call()+0x0000011B [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105FDCD]\nXPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode)+0x000002E0 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105927C]\nXPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*)+0x00000258 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01065215]\njs::CallJSNative(JSContext*, int (*)(JSContext*, unsigned int, JS::Value*), js::CallArgs const&)+0x0000006E [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D680AE]\njs::InvokeKernel(JSContext*, js::CallArgs, js::MaybeConstruct)+0x00000237 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65627]\njs::Interpret(JSContext*, js::StackFrame*, js::InterpMode)+0x0000C731 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D58DF8]\njs::RunScript(JSContext*, JSScript*, js::StackFrame*)+0x00000140 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D64FD1]\njs::InvokeKernel(JSContext*, js::CallArgs, js::MaybeConstruct)+0x00000316 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65706]\njs::Invoke(JSContext*, js::InvokeArgsGuard&, js::MaybeConstruct)+0x0000005B [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01CBFA4F]\njs::Invoke(JSContext*, JS::Value const&, JS::Value const&, unsigned int, JS::Value*, JS::Value*)+0x0000011C [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65B26]\nJS_CallFunctionValue+0x000001C3 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01C87FA2]\nnsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*)+0x000012BC [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0104D264]\nnsXPCWrappedJS::CallMethod(unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*)+0x0000013C [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01043F54]\nPrepareAndDispatch+0x0000051A [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x017E2074]\n###!!! ASSERTION: You can't dereference a NULL nsCOMPtr with operator->().: 'mRawPtr != 0', file ../../../dist/include/nsCOMPtr.h, line 846\nnsCOMPtr<nsIDocument>::operator->() const+0x0000003D [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x00268E79]\nnsDocument::RestorePreviousFullScreenState()+0x000002A1 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x006FC621]\nnsDocument::MozCancelFullScreen()+0x00000037 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x006E0005]\nnsHTMLDocument::MozCancelFullScreen()+0x00000015 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0097837B]\nNS_InvokeByIndex_P+0x0000030E [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x017E0A35]\nCallMethodHelper::Invoke()+0x00000064 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105D3EC]\nCallMethodHelper::Call()+0x0000011B [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105FDCD]\nXPCWrappedNative::CallMethod(XPCCallContext&, XPCWrappedNative::CallMode)+0x000002E0 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0105927C]\nXPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*)+0x00000258 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01065215]\njs::CallJSNative(JSContext*, int (*)(JSContext*, unsigned int, JS::Value*), js::CallArgs const&)+0x0000006E [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D680AE]\njs::InvokeKernel(JSContext*, js::CallArgs, js::MaybeConstruct)+0x00000237 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65627]\njs::Interpret(JSContext*, js::StackFrame*, js::InterpMode)+0x0000C731 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D58DF8]\njs::RunScript(JSContext*, JSScript*, js::StackFrame*)+0x00000140 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D64FD1]\njs::InvokeKernel(JSContext*, js::CallArgs, js::MaybeConstruct)+0x00000316 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65706]\njs::Invoke(JSContext*, js::InvokeArgsGuard&, js::MaybeConstruct)+0x0000005B [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01CBFA4F]\njs::Invoke(JSContext*, JS::Value const&, JS::Value const&, unsigned int, JS::Value*, JS::Value*)+0x0000011C [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01D65B26]\nJS_CallFunctionValue+0x000001C3 [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01C87FA2]\nnsXPCWrappedJSClass::CallMethod(nsXPCWrappedJS*, unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*)+0x000012BC [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x0104D264]\nnsXPCWrappedJS::CallMethod(unsigned short, XPTMethodDescriptor const*, nsXPTCMiniVariant*)+0x0000013C [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x01043F54]\nPrepareAndDispatch+0x0000051A [/Users/dave/repos/mozilla-central/objdir-debug/dist/NightlyDebug.app/Contents/MacOS/XUL +0x017E2074]\nTEST-UNEXPECTED-FAIL | /tests/dom/tests/mochitest/mouselock/test_FullScreenHarness.html | Exited with code 1 during test run\n\nThe code that's doing this essential is doing:\n\n* open a child window\n* go fullscreen in child window, do some things\n* end the test like this:\n  document.mozCancelFullScreen();\n  nextTest(); // calls back into window.opener to start a new test\n\nWhen I change their code so that nextTest() waits for a mozfullscreenchange event, it doesn't crash.  What might be happening here is that another window may have fullscreen by the time this one is going out of fullscreen, and for some reason this null pointer dereference happens.\n\nI'm not 100% sure yet, but filing now while I see it happening.", "time": "2011-12-09T19:40:07Z", "tags": [], "is_private": false, "creator": "david.humphrey@senecacollege.ca"}, {"attachment_id": null, "raw_text": "David, any chance you could attach a crash test for what you're seeing here? Or does this require a full mochitest instance to trigger? If you have a mochitest that's \"incorrec\" but triggers this that could be useful too. Thanks!", "id": 5948180, "is_private": false, "creator": "jstenback+bmo@gmail.com", "count": 1, "creation_time": "2011-12-31T07:49:32Z", "author": "jstenback+bmo@gmail.com", "text": "David, any chance you could attach a crash test for what you're seeing here? Or does this require a full mochitest instance to trigger? If you have a mochitest that's \"incorrec\" but triggers this that could be useful too. Thanks!", "time": "2011-12-31T07:49:32Z", "tags": [], "bug_id": 709231}, {"author": "david.humphrey@senecacollege.ca", "creation_time": "2011-12-31T17:07:29Z", "time": "2011-12-31T17:07:29Z", "tags": [], "bug_id": 709231, "text": "Correct, this is mochitest-only for me.  I'll try to reproduce and get a crash test when I'm back from holidays in Jan.", "creator": "david.humphrey@senecacollege.ca", "is_private": false, "count": 2, "id": 5948474, "attachment_id": null, "raw_text": "Correct, this is mochitest-only for me.  I'll try to reproduce and get a crash test when I'm back from holidays in Jan."}, {"raw_text": "(In reply to David Humphrey (:humph) from comment #2)\n> Correct, this is mochitest-only for me.  I'll try to reproduce and get a\n> crash test when I'm back from holidays in Jan.\n\nDid this ever work out? See also: bug 728962.", "attachment_id": null, "id": 6383079, "creator": "gijskruitbosch+bugs@gmail.com", "is_private": false, "tags": [], "time": "2012-06-12T08:25:36Z", "text": "(In reply to David Humphrey (:humph) from comment #2)\n> Correct, this is mochitest-only for me.  I'll try to reproduce and get a\n> crash test when I'm back from holidays in Jan.\n\nDid this ever work out? See also: bug 728962.", "author": "gijskruitbosch+bugs@gmail.com", "creation_time": "2012-06-12T08:25:36Z", "count": 3, "bug_id": 709231}, {"count": 4, "creator": "bug-husbandry-bot@mozilla.bugs", "is_private": false, "tags": [], "bug_id": 709231, "time": "2018-06-29T04:48:46Z", "text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1472046\n\nMove all DOM bugs that haven\u2019t been updated in more than 3 years and has no one currently assigned to P5.\n\nIf you have questions, please contact :mdaly.", "author": "bug-husbandry-bot@mozilla.bugs", "creation_time": "2018-06-29T04:48:46Z", "raw_text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1472046\n\nMove all DOM bugs that haven\u2019t been updated in more than 3 years and has no one currently assigned to P5.\n\nIf you have questions, please contact :mdaly.", "attachment_id": null, "id": 13435939}]}}, "comments": {}}