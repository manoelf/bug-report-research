{"bugs": {"1634064": {"comments": [{"count": 0, "is_private": false, "raw_text": "For end to end testing, we need to be able to tag our pings in a way that makes it easy to tell if some ping was generated in automation or not, for the same application id.\n\nThis might also be used by the perf team to run Fenix on CI and submit tagged telemetry to our pipeline, in order to capture telemetry from builds on CI.", "time": "2020-04-29T14:54:36Z", "creation_time": "2020-04-29T14:54:36Z", "text": "For end to end testing, we need to be able to tag our pings in a way that makes it easy to tell if some ping was generated in automation or not, for the same application id.\n\nThis might also be used by the perf team to run Fenix on CI and submit tagged telemetry to our pipeline, in order to capture telemetry from builds on CI.", "author": "alessio.placitelli@gmail.com", "tags": [], "creator": "alessio.placitelli@gmail.com", "attachment_id": null, "id": 14786310, "bug_id": 1634064}, {"count": 1, "raw_text": "WIP: https://docs.google.com/document/d/1Ov5N5_vTRmogZklfWK6nI-lRN2W2dmqgOvuayi4ReBk/edit#", "text": "WIP: https://docs.google.com/document/d/1Ov5N5_vTRmogZklfWK6nI-lRN2W2dmqgOvuayi4ReBk/edit#", "creation_time": "2020-05-05T13:40:16Z", "time": "2020-05-05T13:40:16Z", "is_private": false, "creator": "alessio.placitelli@gmail.com", "attachment_id": null, "author": "alessio.placitelli@gmail.com", "tags": [], "bug_id": 1634064, "id": 14797809}, {"raw_text": "Chris, Raphael and Mike, would you kindly review the proposal in comment 1?", "time": "2020-05-05T14:11:12Z", "is_private": false, "count": 2, "bug_id": 1634064, "id": 14797871, "creator": "alessio.placitelli@gmail.com", "creation_time": "2020-05-05T14:11:12Z", "text": "Chris, Raphael and Mike, would you kindly review the proposal in comment 1?", "attachment_id": null, "author": "alessio.placitelli@gmail.com", "tags": []}, {"count": 3, "is_private": false, "raw_text": "Whoops, I forgot about Frank :-) Can you kindly review the proposal in comment 1?", "creation_time": "2020-05-05T14:12:20Z", "text": "Whoops, I forgot about Frank :-) Can you kindly review the proposal in comment 1?", "time": "2020-05-05T14:12:20Z", "author": "alessio.placitelli@gmail.com", "tags": [], "creator": "alessio.placitelli@gmail.com", "attachment_id": null, "id": 14797873, "bug_id": 1634064}, {"bug_id": 1634064, "id": 14801245, "creator": "chutten@mozilla.com", "attachment_id": null, "author": "chutten@mozilla.com", "tags": [], "raw_text": "Feedback provided in the document. Tracking it there.", "creation_time": "2020-05-06T20:21:39Z", "time": "2020-05-06T20:21:39Z", "text": "Feedback provided in the document. Tracking it there.", "is_private": false, "count": 4}, {"bug_id": 1634064, "id": 14801370, "creator": "fbertsch@mozilla.com", "time": "2020-05-06T21:34:06Z", "raw_text": "Also added feedback in doc.", "is_private": false, "count": 5, "attachment_id": null, "tags": [], "author": "fbertsch@mozilla.com", "creation_time": "2020-05-06T21:34:06Z", "text": "Also added feedback in doc."}, {"raw_text": "Read the doc -- I basically agree with :chutten and :frank's concerns, so looking forward to reading v2 :)", "text": "Read the doc -- I basically agree with :chutten and :frank's concerns, so looking forward to reading v2 :)", "creation_time": "2020-05-07T13:13:52Z", "time": "2020-05-07T13:13:52Z", "is_private": false, "count": 6, "bug_id": 1634064, "id": 14802474, "creator": "mdroettboom@mozilla.com", "attachment_id": null, "author": "mdroettboom@mozilla.com", "tags": []}, {"is_private": false, "raw_text": "Feedback provided in the document.", "time": "2020-05-11T08:31:50Z", "creation_time": "2020-05-11T08:31:50Z", "text": "Feedback provided in the document.", "count": 7, "id": 14808894, "bug_id": 1634064, "author": "rpierzina@mozilla.com", "tags": [], "creator": "rpierzina@mozilla.com", "attachment_id": null}, {"author": "alessio.placitelli@gmail.com", "tags": [], "creator": "alessio.placitelli@gmail.com", "attachment_id": null, "id": 14833725, "bug_id": 1634064, "count": 8, "is_private": false, "raw_text": "Hey Frank, Raphael, Mike\n\nI went over [this document](https://docs.google.com/document/d/1Ov5N5_vTRmogZklfWK6nI-lRN2W2dmqgOvuayi4ReBk/edit?ts=5eb413d2#) again and would appreciate your feedback on it.\n\n@Frank, I've changed the parts on the SDK side after our last meeting, but it's unclear to me if we plan on doing something on the pipeline/data views. Nothing is strictly required for Raphael's use-case, because burnham currently sends stuff to its own tables, but things may be different in the future when released applications will be tested.", "text": "Hey Frank, Raphael, Mike\n\nI went over [this document](https://docs.google.com/document/d/1Ov5N5_vTRmogZklfWK6nI-lRN2W2dmqgOvuayi4ReBk/edit?ts=5eb413d2#) again and would appreciate your feedback on it.\n\n@Frank, I've changed the parts on the SDK side after our last meeting, but it's unclear to me if we plan on doing something on the pipeline/data views. Nothing is strictly required for Raphael's use-case, because burnham currently sends stuff to its own tables, but things may be different in the future when released applications will be tested.", "creation_time": "2020-05-20T15:30:52Z", "time": "2020-05-20T15:30:52Z"}, {"bug_id": 1634064, "id": 14835575, "creator": "mdroettboom@mozilla.com", "attachment_id": null, "author": "mdroettboom@mozilla.com", "tags": [], "raw_text": "Read through.  Only had one minor and mostly ignorable comment.", "text": "Read through.  Only had one minor and mostly ignorable comment.", "creation_time": "2020-05-21T14:08:21Z", "time": "2020-05-21T14:08:21Z", "is_private": false, "count": 9}, {"count": 10, "is_private": false, "text": "Hey Alessio, I added my suggestions to the document.", "creation_time": "2020-05-27T08:25:28Z", "time": "2020-05-27T08:25:28Z", "raw_text": "Hey Alessio, I added my suggestions to the document.", "tags": [], "author": "rpierzina@mozilla.com", "attachment_id": null, "creator": "rpierzina@mozilla.com", "id": 14845808, "bug_id": 1634064}, {"id": 14857537, "bug_id": 1634064, "tags": [], "author": "rpierzina@mozilla.com", "attachment_id": null, "creator": "rpierzina@mozilla.com", "is_private": false, "text": "Hi Alessio, I just added a new section to the document describing two concerns around tagging on Android and testing the staging Data Platform.", "time": "2020-06-02T09:20:22Z", "creation_time": "2020-06-02T09:20:22Z", "raw_text": "Hi Alessio, I just added a new section to the document describing two concerns around tagging on Android and testing the staging Data Platform.", "count": 11}, {"attachment_id": null, "tags": [], "author": "alessio.placitelli@gmail.com", "text": "Ok, the proposal was reviewed. This is now ready for implementation.", "creation_time": "2020-06-16T12:50:12Z", "bug_id": 1634064, "id": 14884731, "creator": "alessio.placitelli@gmail.com", "time": "2020-06-16T12:50:12Z", "raw_text": "Ok, the proposal was reviewed. This is now ready for implementation.", "is_private": false, "count": 12}, {"creator": "alessio.placitelli@gmail.com", "attachment_id": null, "author": "alessio.placitelli@gmail.com", "tags": [], "bug_id": 1634064, "id": 14937978, "count": 13, "raw_text": "This is stuck again: we need to find a way to enable tagging for tests running on Android, since we can't necessarily use the glean debug activity to run tests on CI.\n\nThe reason why we can't use the `GleanDebugActivity` is that some perf tests require to be launched with a _specific_ activity, if we launch them with the `GleanDebugActivity` they will fail. Unfortunately, we can't set environment variables on Android devices (apparently, that's not a thing on Android!), so we need to work around this problem.\n\nOne potential solution we found is to enable starting other activities after executing the GleanDebugActivity.  This would mean, for example, executing the tests as:\n\n> `adb shell am start -n [applicationId]/mozilla.telemetry.glean.debug.GleanDebugActivity --es tagPings automation --es nextActivity PerfTestActivity`\n\nMichael, would this be helpful?", "time": "2020-07-15T07:22:32Z", "text": "This is stuck again: we need to find a way to enable tagging for tests running on Android, since we can't necessarily use the glean debug activity to run tests on CI.\n\nThe reason why we can't use the `GleanDebugActivity` is that some perf tests require to be launched with a _specific_ activity, if we launch them with the `GleanDebugActivity` they will fail. Unfortunately, we can't set environment variables on Android devices (apparently, that's not a thing on Android!), so we need to work around this problem.\n\nOne potential solution we found is to enable starting other activities after executing the GleanDebugActivity.  This would mean, for example, executing the tests as:\n\n> `adb shell am start -n [applicationId]/mozilla.telemetry.glean.debug.GleanDebugActivity --es tagPings automation --es nextActivity PerfTestActivity`\n\nMichael, would this be helpful?", "creation_time": "2020-07-15T07:22:32Z", "is_private": false}, {"text": "Hey Andrew, I have a few questions with respect to bug 1648183 comment 7, since I believe I found a solution :-)\n\nYou said:\n\n(In reply to Andrew Creskey [:acreskey] [he/him] from comment #7)\n> (In reply to Alessio Placitelli [:Dexter] from comment #6)\n> > (In reply to Andrew Creskey [:acreskey] [he/him] from comment #5)\n> > > As far as I can tell, it won't be possible for us to set an environment variable that can be read on the android device.\n> > > However we do have a hook for setting performance options in Fenix (e.g. disabling certain pop-ups which interfere with visual metrics).\n> > > We could in theory add the additional glean metric here.\n> > \n> > @Andrew, Ah. How does that work? Can you provide me a link to that piece of code?\n> > \n> :Dexter,  this is the function in fenix that prepares it for performance tests:\n> https://github.com/mozilla-mobile/fenix/blob/82facbfa00b4a701b6919d618df3ee6459bc74b7/app/src/main/java/org/mozilla/fenix/perf/Performance.kt#L26-L33\n> \n> This is enable by an additional intent argument, an example use in a new test is here:\n> https://searchfox.org/mozilla-central/rev/a87a1c3b543475276e6d57a7a80cb02f3e42b6ed/testing/performance/hooks_home_activity.py#15-17\n> \n> I don't actually see this option being passed in for the general CI performance tests, but it shouldn't be hard to add it.\n\nI think that the reason why starting the tests using the `GleanDebugActivity` has failed is that Glean [does not propagate any `extra` option](https://searchfox.org/glean/rev/258c8d2c43c37fa91b515edb216bf648d3ba6077/glean-core/android/src/main/java/mozilla/telemetry/glean/debug/GleanDebugActivity.kt#104-105) that is passed to the main Activity that gets launched, and that's why [these options](https://searchfox.org/mozilla-central/rev/a87a1c3b543475276e6d57a7a80cb02f3e42b6ed/testing/performance/hooks_home_activity.py#15-17) don't get processed and make the perf test fail when running in tagged mode.\n\nTo make sure that's the problem (and it's easily fixable on our end!), I'd need to know what the final `adb` command that start the test looks like when all these options are passed. This would also allow me to test this locally. Any chance you could help me with that or point me to who could?", "creation_time": "2020-07-16T10:21:03Z", "time": "2020-07-16T10:21:03Z", "raw_text": "Hey Andrew, I have a few questions with respect to bug 1648183 comment 7, since I believe I found a solution :-)\n\nYou said:\n\n(In reply to Andrew Creskey [:acreskey] [he/him] from comment #7)\n> (In reply to Alessio Placitelli [:Dexter] from comment #6)\n> > (In reply to Andrew Creskey [:acreskey] [he/him] from comment #5)\n> > > As far as I can tell, it won't be possible for us to set an environment variable that can be read on the android device.\n> > > However we do have a hook for setting performance options in Fenix (e.g. disabling certain pop-ups which interfere with visual metrics).\n> > > We could in theory add the additional glean metric here.\n> > \n> > @Andrew, Ah. How does that work? Can you provide me a link to that piece of code?\n> > \n> :Dexter,  this is the function in fenix that prepares it for performance tests:\n> https://github.com/mozilla-mobile/fenix/blob/82facbfa00b4a701b6919d618df3ee6459bc74b7/app/src/main/java/org/mozilla/fenix/perf/Performance.kt#L26-L33\n> \n> This is enable by an additional intent argument, an example use in a new test is here:\n> https://searchfox.org/mozilla-central/rev/a87a1c3b543475276e6d57a7a80cb02f3e42b6ed/testing/performance/hooks_home_activity.py#15-17\n> \n> I don't actually see this option being passed in for the general CI performance tests, but it shouldn't be hard to add it.\n\nI think that the reason why starting the tests using the `GleanDebugActivity` has failed is that Glean [does not propagate any `extra` option](https://searchfox.org/glean/rev/258c8d2c43c37fa91b515edb216bf648d3ba6077/glean-core/android/src/main/java/mozilla/telemetry/glean/debug/GleanDebugActivity.kt#104-105) that is passed to the main Activity that gets launched, and that's why [these options](https://searchfox.org/mozilla-central/rev/a87a1c3b543475276e6d57a7a80cb02f3e42b6ed/testing/performance/hooks_home_activity.py#15-17) don't get processed and make the perf test fail when running in tagged mode.\n\nTo make sure that's the problem (and it's easily fixable on our end!), I'd need to know what the final `adb` command that start the test looks like when all these options are passed. This would also allow me to test this locally. Any chance you could help me with that or point me to who could?", "is_private": false, "count": 14, "bug_id": 1634064, "id": 14940013, "attachment_id": null, "creator": "alessio.placitelli@gmail.com", "tags": [], "author": "alessio.placitelli@gmail.com"}, {"count": 15, "creation_time": "2020-07-16T14:58:26Z", "time": "2020-07-16T14:58:26Z", "text": "(In reply to Alessio Placitelli [:Dexter] from comment #14)\n...\n> \n> I think that the reason why starting the tests using the `GleanDebugActivity` has failed is that Glean [does not propagate any `extra` option](https://searchfox.org/glean/rev/258c8d2c43c37fa91b515edb216bf648d3ba6077/glean-core/android/src/main/java/mozilla/telemetry/glean/debug/GleanDebugActivity.kt#104-105) that is passed to the main Activity that gets launched, and that's why [these options](https://searchfox.org/mozilla-central/rev/a87a1c3b543475276e6d57a7a80cb02f3e42b6ed/testing/performance/hooks_home_activity.py#15-17) don't get processed and make the perf test fail when running in tagged mode.\n> \n> To make sure that's the problem (and it's easily fixable on our end!), I'd need to know what the final `adb` command that start the test looks like when all these options are passed. This would also allow me to test this locally. Any chance you could help me with that or point me to who could?\n\n:Dexter, yes, because we launch Fenix into various activities for performance tests, we would need to ability to tell the `GleanDebugActivity` which activity to proceed to next, as you mentioned in [Comment 13](https://bugzilla.mozilla.org/show_bug.cgi?id=1634064#c13).\n\nDepending on the test being run, there are different calls.\n\n\u2022 Browsertime pageload\nThis one boils down to this:\n` adb shell am start -d \"about:home\" -a android.intent.action.VIEW org.mozilla.fenix.nightly/org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\n\u2022\u00a0mach perftest (VIEW)\nThis is can be run from the latest mozilla-central.\nYou can customize the `android-install-apk` to be a local apk\n```./mach perftest --flavor mobile-browser --android --android-capture-logcat logcat --output artifacts --android-app-name  org.mozilla.fenix.nightly --android-activity org.mozilla.fenix.IntentReceiverActivity --android-clear-logcat  --android-perf-tuning --perfherder-metrics processLaunchToNavStart --android-install-apk https://firefox-ci-tc.services.mozilla.com/api/index/v1/task/project.mobile.fenix.v2.nightly.2020.07.16.latest/artifacts/public/build/armeabi-v7a/geckoNightly/target.apk --hooks testing/performance/hooks_applink.py --perfherder testing/performance/perftest_applink.js --browsertime-iterations 5 ```\n\nBut it also boils down to \n` adb shell am start -d {some url} -a android.intent.action.VIEW org.mozilla.fenix.nightly/org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\nFor the `MAIN` / home activity tests, they start like this:\n`adb shell am start -n org.mozilla.fenix.nightly/.App --ez performancetest true`\n\n\nAs a less disruption solution would it not be possible to set the pingTags to `automation` in this function in Fenix on launch?\nhttps://github.com/mozilla-mobile/fenix/blob/82facbfa00b4a701b6919d618df3ee6459bc74b7/app/src/main/java/org/mozilla/fenix/perf/Performance.kt#L26-L33\nOr is it already too late at that point?", "raw_text": "(In reply to Alessio Placitelli [:Dexter] from comment #14)\n...\n> \n> I think that the reason why starting the tests using the `GleanDebugActivity` has failed is that Glean [does not propagate any `extra` option](https://searchfox.org/glean/rev/258c8d2c43c37fa91b515edb216bf648d3ba6077/glean-core/android/src/main/java/mozilla/telemetry/glean/debug/GleanDebugActivity.kt#104-105) that is passed to the main Activity that gets launched, and that's why [these options](https://searchfox.org/mozilla-central/rev/a87a1c3b543475276e6d57a7a80cb02f3e42b6ed/testing/performance/hooks_home_activity.py#15-17) don't get processed and make the perf test fail when running in tagged mode.\n> \n> To make sure that's the problem (and it's easily fixable on our end!), I'd need to know what the final `adb` command that start the test looks like when all these options are passed. This would also allow me to test this locally. Any chance you could help me with that or point me to who could?\n\n:Dexter, yes, because we launch Fenix into various activities for performance tests, we would need to ability to tell the `GleanDebugActivity` which activity to proceed to next, as you mentioned in [Comment 13](https://bugzilla.mozilla.org/show_bug.cgi?id=1634064#c13).\n\nDepending on the test being run, there are different calls.\n\n\u2022 Browsertime pageload\nThis one boils down to this:\n` adb shell am start -d \"about:home\" -a android.intent.action.VIEW org.mozilla.fenix.nightly/org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\n\u2022\u00a0mach perftest (VIEW)\nThis is can be run from the latest mozilla-central.\nYou can customize the `android-install-apk` to be a local apk\n```./mach perftest --flavor mobile-browser --android --android-capture-logcat logcat --output artifacts --android-app-name  org.mozilla.fenix.nightly --android-activity org.mozilla.fenix.IntentReceiverActivity --android-clear-logcat  --android-perf-tuning --perfherder-metrics processLaunchToNavStart --android-install-apk https://firefox-ci-tc.services.mozilla.com/api/index/v1/task/project.mobile.fenix.v2.nightly.2020.07.16.latest/artifacts/public/build/armeabi-v7a/geckoNightly/target.apk --hooks testing/performance/hooks_applink.py --perfherder testing/performance/perftest_applink.js --browsertime-iterations 5 ```\n\nBut it also boils down to \n` adb shell am start -d {some url} -a android.intent.action.VIEW org.mozilla.fenix.nightly/org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\nFor the `MAIN` / home activity tests, they start like this:\n`adb shell am start -n org.mozilla.fenix.nightly/.App --ez performancetest true`\n\n\nAs a less disruption solution would it not be possible to set the pingTags to `automation` in this function in Fenix on launch?\nhttps://github.com/mozilla-mobile/fenix/blob/82facbfa00b4a701b6919d618df3ee6459bc74b7/app/src/main/java/org/mozilla/fenix/perf/Performance.kt#L26-L33\nOr is it already too late at that point?", "is_private": false, "attachment_id": null, "creator": "acreskey@mozilla.com", "tags": [], "author": "acreskey@mozilla.com", "bug_id": 1634064, "id": 14940443}, {"count": 16, "raw_text": "(In reply to Andrew Creskey [:acreskey] [he/him] from comment #15)\n> But it also boils down to \n> ` adb shell am start -d {some url} -a android.intent.action.VIEW org.mozilla.fenix.nightly/org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n> \n> For the `MAIN` / home activity tests, they start like this:\n> `adb shell am start -n org.mozilla.fenix.nightly/.App --ez performancetest true`\n\nThis is of great help! Thank you so much! \n\n> As a less disruption solution would it not be possible to set the pingTags to `automation` in this function in Fenix on launch?\n> https://github.com/mozilla-mobile/fenix/blob/82facbfa00b4a701b6919d618df3ee6459bc74b7/app/src/main/java/org/mozilla/fenix/perf/Performance.kt#L26-L33\n> Or is it already too late at that point?\n\nI'm afraid this would work for this specific class of tests, but not for other classes nor for products other than Fenix :-) \nIt's ok to fix this, I think the fact that we don't propagate intent options is a bug on the Glean SDK side.", "time": "2020-07-17T05:59:02Z", "creation_time": "2020-07-17T05:59:02Z", "text": "(In reply to Andrew Creskey [:acreskey] [he/him] from comment #15)\n> But it also boils down to \n> ` adb shell am start -d {some url} -a android.intent.action.VIEW org.mozilla.fenix.nightly/org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n> \n> For the `MAIN` / home activity tests, they start like this:\n> `adb shell am start -n org.mozilla.fenix.nightly/.App --ez performancetest true`\n\nThis is of great help! Thank you so much! \n\n> As a less disruption solution would it not be possible to set the pingTags to `automation` in this function in Fenix on launch?\n> https://github.com/mozilla-mobile/fenix/blob/82facbfa00b4a701b6919d618df3ee6459bc74b7/app/src/main/java/org/mozilla/fenix/perf/Performance.kt#L26-L33\n> Or is it already too late at that point?\n\nI'm afraid this would work for this specific class of tests, but not for other classes nor for products other than Fenix :-) \nIt's ok to fix this, I think the fact that we don't propagate intent options is a bug on the Glean SDK side.", "is_private": false, "creator": "alessio.placitelli@gmail.com", "attachment_id": null, "author": "alessio.placitelli@gmail.com", "tags": [], "bug_id": 1634064, "id": 14941946}, {"id": 14942962, "bug_id": 1634064, "creator": "pulgasaur@mozilla.bugs", "is_private": false, "time": "2020-07-17T17:22:13Z", "raw_text": "", "count": 17, "tags": [], "author": "pulgasaur@mozilla.bugs", "attachment_id": 9164405, "text": "Created attachment 9164405\nLink to GitHub pull-request: https://github.com/mozilla/glean/pull/1068", "creation_time": "2020-07-17T17:22:13Z"}, {"count": 18, "raw_text": "", "time": "2020-07-20T12:33:39Z", "is_private": false, "creator": "pulgasaur@mozilla.bugs", "bug_id": 1634064, "id": 14946439, "text": "Created attachment 9164699\nLink to GitHub pull-request: https://github.com/mozilla/glean/pull/1074", "creation_time": "2020-07-20T12:33:39Z", "attachment_id": 9164699, "author": "pulgasaur@mozilla.bugs", "tags": []}, {"count": 19, "is_private": false, "raw_text": "", "text": "Created attachment 9165011\nLink to GitHub pull-request: https://github.com/mozilla/glean/pull/1083", "time": "2020-07-21T10:13:42Z", "creation_time": "2020-07-21T10:13:42Z", "author": "pulgasaur@mozilla.bugs", "tags": [], "creator": "pulgasaur@mozilla.bugs", "attachment_id": 9165011, "id": 14948386, "bug_id": 1634064}, {"count": 20, "is_private": false, "raw_text": "(In reply to Andrew Creskey [:acreskey] [he/him] from comment #15)\n\nThe PRs in this bug were merged and we're bubbling up the updates to Fenix. It will then be possible to change the commands as follows:\n\n> \u2022 Browsertime pageload\n> This one boils down to this:\n> ` adb shell am start -d \"about:home\" -a android.intent.action.VIEW org.mozilla.fenix.nightly/org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\n` adb shell am start -d \"about:home\" -a android.intent.action.VIEW -n org.mozilla.fenix.nightly/mozilla.telemetry.glean.debug.GleanDebugActivity --esa sourceTags automation, browsertime-pageload --es startNext org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\n> \u2022\u00a0mach perftest (VIEW)\n> But it also boils down to \n> ` adb shell am start -d {some url} -a android.intent.action.VIEW org.mozilla.fenix.nightly/org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\n` adb shell am start -d {some url} -a android.intent.action.VIEW -n org.mozilla.fenix.nightly/mozilla.telemetry.glean.debug.GleanDebugActivity --esa sourceTags automation, mach-perftest --es startNext org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\n> For the `MAIN` / home activity tests, they start like this:\n> `adb shell am start -n org.mozilla.fenix.nightly/.App --ez performancetest true`\n\n`adb shell am start -n org.mozilla.fenix.nightly/mozilla.telemetry.glean.debug.GleanDebugActivity --esa sourceTags automation, main-home --es startNext .App --ez performancetest true`\n\nNote that nothing changes too much: we're only telling adb to start the GleanDebugActivity, which tags to apply and which activity to start next.\n\n@Andrew, to keep on fixing this, I need to ask you a few more questions:\n\n1. Where should the commands be changed?\n2. Are tests running only on the latest `org.mozilla.fenix.nightly`? If so, this means we should land the changes to the test runner as soon as a new Nightly is available.", "creation_time": "2020-07-21T10:45:18Z", "time": "2020-07-21T10:45:18Z", "text": "(In reply to Andrew Creskey [:acreskey] [he/him] from comment #15)\n\nThe PRs in this bug were merged and we're bubbling up the updates to Fenix. It will then be possible to change the commands as follows:\n\n> \u2022 Browsertime pageload\n> This one boils down to this:\n> ` adb shell am start -d \"about:home\" -a android.intent.action.VIEW org.mozilla.fenix.nightly/org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\n` adb shell am start -d \"about:home\" -a android.intent.action.VIEW -n org.mozilla.fenix.nightly/mozilla.telemetry.glean.debug.GleanDebugActivity --esa sourceTags automation, browsertime-pageload --es startNext org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\n> \u2022\u00a0mach perftest (VIEW)\n> But it also boils down to \n> ` adb shell am start -d {some url} -a android.intent.action.VIEW org.mozilla.fenix.nightly/org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\n` adb shell am start -d {some url} -a android.intent.action.VIEW -n org.mozilla.fenix.nightly/mozilla.telemetry.glean.debug.GleanDebugActivity --esa sourceTags automation, mach-perftest --es startNext org.mozilla.fenix.IntentReceiverActivity --ez performancetest true`\n\n> For the `MAIN` / home activity tests, they start like this:\n> `adb shell am start -n org.mozilla.fenix.nightly/.App --ez performancetest true`\n\n`adb shell am start -n org.mozilla.fenix.nightly/mozilla.telemetry.glean.debug.GleanDebugActivity --esa sourceTags automation, main-home --es startNext .App --ez performancetest true`\n\nNote that nothing changes too much: we're only telling adb to start the GleanDebugActivity, which tags to apply and which activity to start next.\n\n@Andrew, to keep on fixing this, I need to ask you a few more questions:\n\n1. Where should the commands be changed?\n2. Are tests running only on the latest `org.mozilla.fenix.nightly`? If so, this means we should land the changes to the test runner as soon as a new Nightly is available.", "author": "alessio.placitelli@gmail.com", "tags": [], "creator": "alessio.placitelli@gmail.com", "attachment_id": null, "id": 14948415, "bug_id": 1634064}, {"attachment_id": null, "creator": "acreskey@mozilla.com", "tags": [], "author": "acreskey@mozilla.com", "bug_id": 1634064, "id": 14949700, "count": 21, "time": "2020-07-21T19:26:32Z", "creation_time": "2020-07-21T19:26:32Z", "text": ":Dexter, these commands are setup in a few places:\n\n1. I _believe_ that the activity for Fenix used in the browsertime pageload tests (including the live runs that affect telemetry) is set here:\nhttps://searchfox.org/mozilla-central/rev/3b6958c26049c1e27b2790a43154caaba9f6dd4a/taskcluster/ci/test/browsertime-mobile.yml#51\nI'm not sure where the additional arguments will go (I'm not that familiar with the CI browsertime solution).\nAnd yes, I believe that these only test `org.mozilla.fenix.nightly`\ncc: davehunt\n\n2. mach perftest (VIEW)\n3. mach perftest (MAIN /Home activity)\nThese are both defined in \nhttps://searchfox.org/mozilla-central/rev/3b6958c26049c1e27b2790a43154caaba9f6dd4a/taskcluster/ci/perftest/android.yml\nThese measure time elapsed from process start to either `navigationStart` in the content process or else the HomeActivity being rendered. \nIt won't be hard to try adding the new parameters -- but if this changes the results significantly then the test isn't useful anymore.\n\nNote: tests 2 and 3 run once per day and only 14 iterations each. This seems pretty minor to me.", "raw_text": ":Dexter, these commands are setup in a few places:\n\n1. I _believe_ that the activity for Fenix used in the browsertime pageload tests (including the live runs that affect telemetry) is set here:\nhttps://searchfox.org/mozilla-central/rev/3b6958c26049c1e27b2790a43154caaba9f6dd4a/taskcluster/ci/test/browsertime-mobile.yml#51\nI'm not sure where the additional arguments will go (I'm not that familiar with the CI browsertime solution).\nAnd yes, I believe that these only test `org.mozilla.fenix.nightly`\ncc: davehunt\n\n2. mach perftest (VIEW)\n3. mach perftest (MAIN /Home activity)\nThese are both defined in \nhttps://searchfox.org/mozilla-central/rev/3b6958c26049c1e27b2790a43154caaba9f6dd4a/taskcluster/ci/perftest/android.yml\nThese measure time elapsed from process start to either `navigationStart` in the content process or else the HomeActivity being rendered. \nIt won't be hard to try adding the new parameters -- but if this changes the results significantly then the test isn't useful anymore.\n\nNote: tests 2 and 3 run once per day and only 14 iterations each. This seems pretty minor to me.", "is_private": false}, {"count": 22, "text": ":sparky can you answer the questions related to where these changes would be needed and what we're running against?\n\n:dexter would there need to be further work for any other tests running against Fenix? We also have YouTube media playback tests, resource tests, and benchmarks such as speedometer. Could we have a common tag rather than have distinct tags such as 'browsertime-pageload', 'mach-perftest', and 'main-home'? These as they are could be misleading (for example 'main-home' is also run using `mach perftest`).", "time": "2020-07-21T21:20:04Z", "creation_time": "2020-07-21T21:20:04Z", "raw_text": ":sparky can you answer the questions related to where these changes would be needed and what we're running against?\n\n:dexter would there need to be further work for any other tests running against Fenix? We also have YouTube media playback tests, resource tests, and benchmarks such as speedometer. Could we have a common tag rather than have distinct tags such as 'browsertime-pageload', 'mach-perftest', and 'main-home'? These as they are could be misleading (for example 'main-home' is also run using `mach perftest`).", "is_private": false, "attachment_id": null, "creator": "dave.hunt@gmail.com", "tags": [], "author": "dave.hunt@gmail.com", "bug_id": 1634064, "id": 14949931}, {"is_private": false, "raw_text": "(In reply to Dave Hunt [:davehunt] [he/him] \u231aBST from comment #22)\n> :dexter would there need to be further work for any other tests running against Fenix? We also have YouTube media playback tests, resource tests, and benchmarks such as speedometer.\n\nYes, any custom run of Fenix needs to be fixed.\n\n> Could we have a common tag rather than have distinct tags such as 'browsertime-pageload', 'mach-perftest', and 'main-home'? These as they are could be misleading (for example 'main-home' is also run using `mach perftest`).\n\nOh, sure! We don't need the second tag at all, we only require `automation`. Any other tag might be helpful if we want to understand which CI generated which telemetry.", "text": "(In reply to Dave Hunt [:davehunt] [he/him] \u231aBST from comment #22)\n> :dexter would there need to be further work for any other tests running against Fenix? We also have YouTube media playback tests, resource tests, and benchmarks such as speedometer.\n\nYes, any custom run of Fenix needs to be fixed.\n\n> Could we have a common tag rather than have distinct tags such as 'browsertime-pageload', 'mach-perftest', and 'main-home'? These as they are could be misleading (for example 'main-home' is also run using `mach perftest`).\n\nOh, sure! We don't need the second tag at all, we only require `automation`. Any other tag might be helpful if we want to understand which CI generated which telemetry.", "creation_time": "2020-07-22T07:32:50Z", "time": "2020-07-22T07:32:50Z", "count": 23, "id": 14950526, "bug_id": 1634064, "author": "alessio.placitelli@gmail.com", "tags": [], "creator": "alessio.placitelli@gmail.com", "attachment_id": null}, {"text": "(In reply to Andrew Creskey [:acreskey] [he/him] from comment #21)\n> Note: tests 2 and 3 run once per day and only 14 iterations each. This seems pretty minor to me.\n\nAgreed, but we'd still want to fix everything and have the cleanest possible data, unless this is a ton of work :)", "creation_time": "2020-07-22T07:33:29Z", "tags": [], "author": "alessio.placitelli@gmail.com", "attachment_id": null, "count": 24, "is_private": false, "time": "2020-07-22T07:33:29Z", "raw_text": "(In reply to Andrew Creskey [:acreskey] [he/him] from comment #21)\n> Note: tests 2 and 3 run once per day and only 14 iterations each. This seems pretty minor to me.\n\nAgreed, but we'd still want to fix everything and have the cleanest possible data, unless this is a ton of work :)", "creator": "alessio.placitelli@gmail.com", "id": 14950527, "bug_id": 1634064}, {"count": 25, "raw_text": "", "text": "Created attachment 9165318\nUpdate A-C to Glean 31.5.0", "time": "2020-07-22T08:47:54Z", "creation_time": "2020-07-22T08:47:54Z", "is_private": false, "creator": "alessio.placitelli@gmail.com", "attachment_id": 9165318, "author": "alessio.placitelli@gmail.com", "tags": [], "bug_id": 1634064, "id": 14950618}, {"is_private": false, "raw_text": "(In reply to Alessio Placitelli [:Dexter] from comment #23)\n> (In reply to Dave Hunt [:davehunt] [he/him] \u231aBST from comment #22)\n> > :dexter would there need to be further work for any other tests running against Fenix? We also have YouTube media playback tests, resource tests, and benchmarks such as speedometer.\n> \n> Yes, any custom run of Fenix needs to be fixed.\n>\n\nI'm 99% certain that we only need to modify tests that use live internet.\nSo none of the tests that run against the recorded http archives need to be changed. (Since they can't be hitting the telemetry backend due to their https proxy to mitmproxy).\n\n(In reply to Alessio Placitelli [:Dexter] from comment #24)\n> (In reply to Andrew Creskey [:acreskey] [he/him] from comment #21)\n> > Note: tests 2 and 3 run once per day and only 14 iterations each. This seems pretty minor to me.\n> \n> Agreed, but we'd still want to fix everything and have the cleanest possible data, unless this is a ton of work :)\nI can do a run with the generic perf tests (`applink` and `MAIN/Home_activity`) and the modified activity/arguments.\nMy concern (unproven!), is that launching into a different activity will significantly change the results. (We will see).\nAn alternative here is to make these test run against mitmproxy archives as well.", "text": "(In reply to Alessio Placitelli [:Dexter] from comment #23)\n> (In reply to Dave Hunt [:davehunt] [he/him] \u231aBST from comment #22)\n> > :dexter would there need to be further work for any other tests running against Fenix? We also have YouTube media playback tests, resource tests, and benchmarks such as speedometer.\n> \n> Yes, any custom run of Fenix needs to be fixed.\n>\n\nI'm 99% certain that we only need to modify tests that use live internet.\nSo none of the tests that run against the recorded http archives need to be changed. (Since they can't be hitting the telemetry backend due to their https proxy to mitmproxy).\n\n(In reply to Alessio Placitelli [:Dexter] from comment #24)\n> (In reply to Andrew Creskey [:acreskey] [he/him] from comment #21)\n> > Note: tests 2 and 3 run once per day and only 14 iterations each. This seems pretty minor to me.\n> \n> Agreed, but we'd still want to fix everything and have the cleanest possible data, unless this is a ton of work :)\nI can do a run with the generic perf tests (`applink` and `MAIN/Home_activity`) and the modified activity/arguments.\nMy concern (unproven!), is that launching into a different activity will significantly change the results. (We will see).\nAn alternative here is to make these test run against mitmproxy archives as well.", "time": "2020-07-22T13:04:02Z", "creation_time": "2020-07-22T13:04:02Z", "count": 26, "id": 14950982, "bug_id": 1634064, "author": "acreskey@mozilla.com", "tags": [], "creator": "acreskey@mozilla.com", "attachment_id": null}, {"creator": "alessio.placitelli@gmail.com", "id": 14950990, "bug_id": 1634064, "count": 27, "is_private": false, "raw_text": "(In reply to Andrew Creskey [:acreskey] [he/him] from comment #26)\n> (In reply to Alessio Placitelli [:Dexter] from comment #23)\n> > (In reply to Dave Hunt [:davehunt] [he/him] \u231aBST from comment #22)\n> > > :dexter would there need to be further work for any other tests running against Fenix? We also have YouTube media playback tests, resource tests, and benchmarks such as speedometer.\n> > \n> > Yes, any custom run of Fenix needs to be fixed.\n> >\n> \n> I'm 99% certain that we only need to modify tests that use live internet.\n> So none of the tests that run against the recorded http archives need to be changed. (Since they can't be hitting the telemetry backend due to their https proxy to mitmproxy).\n\nOh, yes, good point.\n\n> I can do a run with the generic perf tests (`applink` and `MAIN/Home_activity`) and the modified activity/arguments.\n> My concern (unproven!), is that launching into a different activity will significantly change the results. (We will see).\n\nThis is good to verify. Please keep me posted.\n\n> An alternative here is to make these test run against mitmproxy archives as well.\n\nCan you MITM the telemetry endpoint and make it just respond HTTP 200?", "time": "2020-07-22T13:12:57Z", "author": "alessio.placitelli@gmail.com", "tags": [], "attachment_id": null, "creation_time": "2020-07-22T13:12:57Z", "text": "(In reply to Andrew Creskey [:acreskey] [he/him] from comment #26)\n> (In reply to Alessio Placitelli [:Dexter] from comment #23)\n> > (In reply to Dave Hunt [:davehunt] [he/him] \u231aBST from comment #22)\n> > > :dexter would there need to be further work for any other tests running against Fenix? We also have YouTube media playback tests, resource tests, and benchmarks such as speedometer.\n> > \n> > Yes, any custom run of Fenix needs to be fixed.\n> >\n> \n> I'm 99% certain that we only need to modify tests that use live internet.\n> So none of the tests that run against the recorded http archives need to be changed. (Since they can't be hitting the telemetry backend due to their https proxy to mitmproxy).\n\nOh, yes, good point.\n\n> I can do a run with the generic perf tests (`applink` and `MAIN/Home_activity`) and the modified activity/arguments.\n> My concern (unproven!), is that launching into a different activity will significantly change the results. (We will see).\n\nThis is good to verify. Please keep me posted.\n\n> An alternative here is to make these test run against mitmproxy archives as well.\n\nCan you MITM the telemetry endpoint and make it just respond HTTP 200?"}, {"count": 28, "raw_text": "Intent arguments would need to be added here: https://searchfox.org/mozilla-central/source/testing/raptor/raptor/browsertime/android.py#74-79\nActivity changes are done where acreskey pointed to.", "time": "2020-07-23T13:35:28Z", "creation_time": "2020-07-23T13:35:28Z", "text": "Intent arguments would need to be added here: https://searchfox.org/mozilla-central/source/testing/raptor/raptor/browsertime/android.py#74-79\nActivity changes are done where acreskey pointed to.", "is_private": false, "creator": "gmierz2@outlook.com", "attachment_id": null, "author": "gmierz2@outlook.com", "tags": [], "bug_id": 1634064, "id": 14952906}, {"is_private": false, "raw_text": ":Dexter, I tried this with today's Fenix nightly (July 14th) but it would not launch the app using the `mozilla.telemetry.glean.debug.GleanDebugActivity `\n\nThis binary:\nhttps://firefox-ci-tc.services.mozilla.com/api/index/v1/task/mobile.v2.fenix.nightly.latest.armeabi-v7a/artifacts/public/build/armeabi-v7a/geckoNightly/target.apk\n\nThis command:\n`\nadb shell am start -d https://www.mozilla.org -a android.intent.action.VIEW org.mozilla.fenix/mozilla.telemetry.glean.debug.GleanDebugActivity --esa automation, mach-perftest --es startNext org.mozilla.fenix.IntentReceiverActivity --ez performancetest true\n`\n\nThis was the output:\n`\nStarting: Intent { act=android.intent.action.VIEW dat=https://www.mozilla.org/... cmp=org.mozilla.fenix/mozilla.telemetry.glean.debug.GleanDebugActivity }\n`\n(But the application was only briefly visible)\n\nadb logs here: https://paste.rs/uHr", "text": ":Dexter, I tried this with today's Fenix nightly (July 14th) but it would not launch the app using the `mozilla.telemetry.glean.debug.GleanDebugActivity `\n\nThis binary:\nhttps://firefox-ci-tc.services.mozilla.com/api/index/v1/task/mobile.v2.fenix.nightly.latest.armeabi-v7a/artifacts/public/build/armeabi-v7a/geckoNightly/target.apk\n\nThis command:\n`\nadb shell am start -d https://www.mozilla.org -a android.intent.action.VIEW org.mozilla.fenix/mozilla.telemetry.glean.debug.GleanDebugActivity --esa automation, mach-perftest --es startNext org.mozilla.fenix.IntentReceiverActivity --ez performancetest true\n`\n\nThis was the output:\n`\nStarting: Intent { act=android.intent.action.VIEW dat=https://www.mozilla.org/... cmp=org.mozilla.fenix/mozilla.telemetry.glean.debug.GleanDebugActivity }\n`\n(But the application was only briefly visible)\n\nadb logs here: https://paste.rs/uHr", "creation_time": "2020-07-24T16:45:48Z", "time": "2020-07-24T16:45:48Z", "count": 29, "id": 14955160, "bug_id": 1634064, "author": "acreskey@mozilla.com", "tags": [], "creator": "acreskey@mozilla.com", "attachment_id": null}, {"count": 30, "is_private": false, "creation_time": "2020-07-26T10:52:25Z", "text": "(In reply to Andrew Creskey [:acreskey] [he/him] from comment #29)\n> This command:\n> `\n> adb shell am start -d https://www.mozilla.org -a android.intent.action.VIEW org.mozilla.fenix/mozilla.telemetry.glean.debug.GleanDebugActivity --esa automation, mach-perftest --es startNext org.mozilla.fenix.IntentReceiverActivity --ez performancetest true\n> `\n\nSorry, my bad, I typed in the wrong commands in comment 20 (I have now fixed them). This command is missing the `-n` switch before the debug activity name and the property name for the `--esa` option. The correct command is this one:\n\n`adb shell am start -d https://www.mozilla.org -a android.intent.action.VIEW -n org.mozilla.fenix/mozilla.telemetry.glean.debug.GleanDebugActivity  --es startNext org.mozilla.fenix.IntentReceiverActivity --ez performancetest true --esa sourceTags automation, mach-perftest`\n\nYou can convince yourself this is working correctly by additionally adding a `--es debugViewTag andrew-glean-1` and then checking [in the Glean Debug View](https://debug-ping-preview.firebaseapp.com/) for `andrew-glean-1` after the app is moved to background.\n\nWould you kindly confirm this works for you?\nAny chance you might be able to help me out with the changes to the test runners?", "time": "2020-07-26T10:52:25Z", "raw_text": "(In reply to Andrew Creskey [:acreskey] [he/him] from comment #29)\n> This command:\n> `\n> adb shell am start -d https://www.mozilla.org -a android.intent.action.VIEW org.mozilla.fenix/mozilla.telemetry.glean.debug.GleanDebugActivity --esa automation, mach-perftest --es startNext org.mozilla.fenix.IntentReceiverActivity --ez performancetest true\n> `\n\nSorry, my bad, I typed in the wrong commands in comment 20 (I have now fixed them). This command is missing the `-n` switch before the debug activity name and the property name for the `--esa` option. The correct command is this one:\n\n`adb shell am start -d https://www.mozilla.org -a android.intent.action.VIEW -n org.mozilla.fenix/mozilla.telemetry.glean.debug.GleanDebugActivity  --es startNext org.mozilla.fenix.IntentReceiverActivity --ez performancetest true --esa sourceTags automation, mach-perftest`\n\nYou can convince yourself this is working correctly by additionally adding a `--es debugViewTag andrew-glean-1` and then checking [in the Glean Debug View](https://debug-ping-preview.firebaseapp.com/) for `andrew-glean-1` after the app is moved to background.\n\nWould you kindly confirm this works for you?\nAny chance you might be able to help me out with the changes to the test runners?", "tags": [], "author": "alessio.placitelli@gmail.com", "attachment_id": null, "creator": "alessio.placitelli@gmail.com", "id": 14956499, "bug_id": 1634064}, {"count": 31, "text": "Closing this as the implementation landed and is correctly working. See bug 1650798 for follow-up work to filter telemetry.", "creation_time": "2020-07-30T13:17:33Z", "time": "2020-07-30T13:17:33Z", "raw_text": "Closing this as the implementation landed and is correctly working. See bug 1650798 for follow-up work to filter telemetry.", "is_private": false, "attachment_id": null, "creator": "alessio.placitelli@gmail.com", "tags": [], "author": "alessio.placitelli@gmail.com", "bug_id": 1634064, "id": 14963891}]}}, "comments": {}}