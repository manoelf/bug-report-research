{"comments": {}, "bugs": {"683696": {"comments": [{"raw_text": "User Agent: Mozilla/5.0 (Windows NT 5.1; rv:6.0) Gecko/20100101 Firefox/6.0\nBuild ID: 20110811165603\n\nSteps to reproduce:\n\nCreate a CSS transition and react on its transitionend DOM event.\n\n\nActual results:\n\nWorks fine for foreground tab, but is never called when the tab is inactive.\n\n\nExpected results:\n\nWell, did the transition actually take place in the background tab? At least its final state can be seen, so I guess it has indeed (started and) ended somehow. So the event should really be fired, too.", "creation_time": "2011-08-31T20:21:27Z", "time": "2011-08-31T20:21:27Z", "attachment_id": null, "text": "User Agent: Mozilla/5.0 (Windows NT 5.1; rv:6.0) Gecko/20100101 Firefox/6.0\nBuild ID: 20110811165603\n\nSteps to reproduce:\n\nCreate a CSS transition and react on its transitionend DOM event.\n\n\nActual results:\n\nWorks fine for foreground tab, but is never called when the tab is inactive.\n\n\nExpected results:\n\nWell, did the transition actually take place in the background tab? At least its final state can be seen, so I guess it has indeed (started and) ended somehow. So the event should really be fired, too.", "id": 5691825, "tags": [], "is_private": false, "count": 0, "bug_id": 683696, "author": "_+bugzilla@ygoe.de", "creator": "_+bugzilla@ygoe.de"}, {"id": 5692612, "count": 1, "is_private": false, "tags": [], "bug_id": 683696, "creation_time": "2011-09-01T01:10:19Z", "raw_text": "Could you attach https://bugzilla.mozilla.org/attachment.cgi?bugid=683696&action=enter a reduced Testcase showing the Issue?", "attachment_id": null, "time": "2011-09-01T01:10:19Z", "text": "Could you attach https://bugzilla.mozilla.org/attachment.cgi?bugid=683696&action=enter a reduced Testcase showing the Issue?", "author": "xtc4uall@gmail.com", "creator": "xtc4uall@gmail.com"}, {"attachment_id": 558315, "time": "2011-09-05T18:44:07Z", "text": "Created attachment 558315\nSimple transition test (works)", "raw_text": "", "creation_time": "2011-09-05T18:44:07Z", "bug_id": 683696, "id": 5700810, "is_private": false, "count": 2, "tags": [], "author": "_+bugzilla@ygoe.de", "creator": "_+bugzilla@ygoe.de"}, {"raw_text": "", "creation_time": "2011-09-05T18:45:48Z", "attachment_id": 558316, "time": "2011-09-05T18:45:48Z", "text": "Created attachment 558316\nReal-world transition test (fails)", "id": 5700817, "tags": [], "is_private": false, "count": 3, "bug_id": 683696, "author": "_+bugzilla@ygoe.de", "creator": "_+bugzilla@ygoe.de"}, {"bug_id": 683696, "id": 5700833, "tags": [], "is_private": false, "count": 4, "attachment_id": null, "time": "2011-09-05T18:55:30Z", "text": "Hm, sorry, should have added an explanation.\n\nThe simple test is a straightforward transitionend testcase. It should be fairly easy to understand, and it works fine.\n\nThe real-world test is a simplyfied copy of my website (not public yet). It is a slideshow of several thumbnail images, here replaced with simple text. The CSS box layout is unchanged. The JavaScript functions are from my JS compatibility/toolkit layer. All (but 2) JS functions are inlined and cases for anything else than Firefox are largely removed.\n\nThe thing is, as long as the tab remains active, the four slides run though, every 6 seconds, repeating from the start. The next timeout is started as soon as a running transition has ended, so it's 6 seconds + the transition time of 1 second. But as soon as the tab is switched and the transition runs in the background, the transitionend event is not triggered and no next slide switch is scheduled. When you come back to the tab, you see the slide you left + 1, but it's dead from then on.\n\nThere's a workaround marked with [WORKAROUND] in the code, that triggers a bit after then transition should have ended and does what it should have done. Not nice but works. And there's a [TEST] code where you can easier see when the transitionend event has been triggered.\n\nI will now continue to try and find the offending difference between both testcases.", "creation_time": "2011-09-05T18:55:30Z", "raw_text": "Hm, sorry, should have added an explanation.\n\nThe simple test is a straightforward transitionend testcase. It should be fairly easy to understand, and it works fine.\n\nThe real-world test is a simplyfied copy of my website (not public yet). It is a slideshow of several thumbnail images, here replaced with simple text. The CSS box layout is unchanged. The JavaScript functions are from my JS compatibility/toolkit layer. All (but 2) JS functions are inlined and cases for anything else than Firefox are largely removed.\n\nThe thing is, as long as the tab remains active, the four slides run though, every 6 seconds, repeating from the start. The next timeout is started as soon as a running transition has ended, so it's 6 seconds + the transition time of 1 second. But as soon as the tab is switched and the transition runs in the background, the transitionend event is not triggered and no next slide switch is scheduled. When you come back to the tab, you see the slide you left + 1, but it's dead from then on.\n\nThere's a workaround marked with [WORKAROUND] in the code, that triggers a bit after then transition should have ended and does what it should have done. Not nice but works. And there's a [TEST] code where you can easier see when the transitionend event has been triggered.\n\nI will now continue to try and find the offending difference between both testcases.", "author": "_+bugzilla@ygoe.de", "creator": "_+bugzilla@ygoe.de"}, {"time": "2011-09-05T19:21:45Z", "attachment_id": 558325, "text": "Created attachment 558325\nModified real test\n\nOkay, did some more research.\n\nreal-transitiontest2.html is a simplified version of real-transitiontest.html. The slideshow layouting stuff is now removed. I could identify a timer that is required for the transition to work at all. It defers setting the transitioned value (to start the transition) for a short time (should be immediate but must be greater than 0 for unknown reasons).\n\nWhen it's set to 1000 (that's as much as a whole second!) then it also works in the background. But as soon as you set it to 900 or less, it only works in the foreground (code marked with [BUG]). In the original code it was set to 50.\n\nIs that another background timer resolution annoyance? Why is that timer required at all? Why can't it just work synchronously?", "creation_time": "2011-09-05T19:21:45Z", "raw_text": "Okay, did some more research.\n\nreal-transitiontest2.html is a simplified version of real-transitiontest.html. The slideshow layouting stuff is now removed. I could identify a timer that is required for the transition to work at all. It defers setting the transitioned value (to start the transition) for a short time (should be immediate but must be greater than 0 for unknown reasons).\n\nWhen it's set to 1000 (that's as much as a whole second!) then it also works in the background. But as soon as you set it to 900 or less, it only works in the foreground (code marked with [BUG]). In the original code it was set to 50.\n\nIs that another background timer resolution annoyance? Why is that timer required at all? Why can't it just work synchronously?", "bug_id": 683696, "id": 5700869, "is_private": false, "count": 5, "tags": [], "author": "_+bugzilla@ygoe.de", "creator": "_+bugzilla@ygoe.de"}, {"tags": [], "count": 6, "is_private": false, "id": 5701233, "bug_id": 683696, "raw_text": "David, any idea what's happening here?  If the entire transition takes place during a single refresh driver tick (both start and end) do we still fire end?  That would be my best guess for what could go wrong.", "creation_time": "2011-09-06T01:51:07Z", "text": "David, any idea what's happening here?  If the entire transition takes place during a single refresh driver tick (both start and end) do we still fire end?  That would be my best guess for what could go wrong.", "time": "2011-09-06T01:51:07Z", "attachment_id": null, "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu"}, {"raw_text": "> Well, did the transition actually take place in the background tab?\n\nI suspect no, due to bug 537143 (are background tabs display=none?). If so, that bug would have caused this bug.", "creation_time": "2012-01-11T21:51:56Z", "attachment_id": null, "time": "2012-01-11T21:51:56Z", "text": "> Well, did the transition actually take place in the background tab?\n\nI suspect no, due to bug 537143 (are background tabs display=none?). If so, that bug would have caused this bug.", "id": 5973444, "is_private": false, "count": 7, "tags": [], "bug_id": 683696, "author": "ben.bucksch@beonex.com", "creator": "ben.bucksch@beonex.com"}, {"creator": "dbaron@dbaron.org", "author": "dbaron@dbaron.org", "text": "(In reply to Ben Bucksch (:BenB) from comment #7)\n> > Well, did the transition actually take place in the background tab?\n> \n> I suspect no, due to bug 537143 (are background tabs display=none?). If so,\n> that bug would have caused this bug.\n\nNo, they're not display:none.", "attachment_id": null, "time": "2012-01-11T21:59:07Z", "creation_time": "2012-01-11T21:59:07Z", "raw_text": "(In reply to Ben Bucksch (:BenB) from comment #7)\n> > Well, did the transition actually take place in the background tab?\n> \n> I suspect no, due to bug 537143 (are background tabs display=none?). If so,\n> that bug would have caused this bug.\n\nNo, they're not display:none.", "bug_id": 683696, "tags": [], "is_private": false, "count": 8, "id": 5973471}, {"attachment_id": null, "time": "2012-05-22T21:09:08Z", "text": "I too can validate this issue. Listening for transitionend on a background tab doesn't fire.", "creation_time": "2012-05-22T21:09:08Z", "raw_text": "I too can validate this issue. Listening for transitionend on a background tab doesn't fire.", "bug_id": 683696, "id": 6328893, "tags": [], "is_private": false, "count": 9, "author": "john.reading@icrossing.com", "creator": "john.reading@icrossing.com"}, {"creator": "john.reading@icrossing.com", "author": "john.reading@icrossing.com", "bug_id": 683696, "is_private": false, "count": 10, "tags": [], "id": 6329007, "text": "Correction, this is a result of implementing the transitionEnd/dispaly:block bug workaround and the setTimeout throttling in Firefox.\n\nhttps://developer.mozilla.org/en/DOM/window.setTimeout#Inactive_tabs\n\nhttp://code.google.com/p/chromium/issues/detail?id=121340\n\nThis is a major bummer. Only setTimeout of 1001ms will work in hidden tabs.", "time": "2012-05-22T21:43:15Z", "attachment_id": null, "creation_time": "2012-05-22T21:43:15Z", "raw_text": "Correction, this is a result of implementing the transitionEnd/dispaly:block bug workaround and the setTimeout throttling in Firefox.\n\nhttps://developer.mozilla.org/en/DOM/window.setTimeout#Inactive_tabs\n\nhttp://code.google.com/p/chromium/issues/detail?id=121340\n\nThis is a major bummer. Only setTimeout of 1001ms will work in hidden tabs."}, {"bug_id": 683696, "id": 6329363, "tags": [], "count": 11, "is_private": false, "author": "john.reading@icrossing.com", "attachment_id": null, "time": "2012-05-22T23:15:33Z", "creator": "john.reading@icrossing.com", "text": "Looks like 1001 doesn't work either. Any ideas?", "raw_text": "Looks like 1001 doesn't work either. Any ideas?", "creation_time": "2012-05-22T23:15:33Z"}, {"creation_time": "2014-03-05T08:53:51Z", "raw_text": "I confirm that this but stil exists in latest Firefox 27.0.1 Mac OSX", "text": "I confirm that this but stil exists in latest Firefox 27.0.1 Mac OSX", "attachment_id": null, "time": "2014-03-05T08:53:51Z", "count": 12, "is_private": false, "tags": [], "id": 8493466, "bug_id": 683696, "creator": "soulhunter1987@post.ru", "author": "soulhunter1987@post.ru"}, {"raw_text": "(In reply to Boris Zbarsky [:bz] from comment #6)\n> David, any idea what's happening here?  If the entire transition takes place\n> during a single refresh driver tick (both start and end) do we still fire\n> end?  That would be my best guess for what could go wrong.\n\nI suspect what's happening in attachment 558325 is that there's no transition, since the \"new\" style is set before we've computed style based on the \"old\" style.  There's nothing to flush style, so we only flush style when there's a refresh driver tick.  This means that if the setTimeout that changes the style happens before we bother to compute style in the first place, then there's no transition.", "creation_time": "2015-11-04T06:50:09Z", "text": "(In reply to Boris Zbarsky [:bz] from comment #6)\n> David, any idea what's happening here?  If the entire transition takes place\n> during a single refresh driver tick (both start and end) do we still fire\n> end?  That would be my best guess for what could go wrong.\n\nI suspect what's happening in attachment 558325 is that there's no transition, since the \"new\" style is set before we've computed style based on the \"old\" style.  There's nothing to flush style, so we only flush style when there's a refresh driver tick.  This means that if the setTimeout that changes the style happens before we bother to compute style in the first place, then there's no transition.", "attachment_id": null, "time": "2015-11-04T06:50:09Z", "is_private": false, "count": 13, "tags": [], "id": 10901148, "bug_id": 683696, "creator": "dbaron@dbaron.org", "author": "dbaron@dbaron.org"}, {"is_private": false, "count": 14, "tags": [], "id": 10901151, "bug_id": 683696, "creation_time": "2015-11-04T06:50:37Z", "raw_text": "... what this really needs is bug 774655.", "text": "... what this really needs is bug 774655.", "time": "2015-11-04T06:50:37Z", "attachment_id": null, "creator": "dbaron@dbaron.org", "author": "dbaron@dbaron.org"}, {"creator": "felash@gmail.com", "author": "felash@gmail.com", "bug_id": 683696, "is_private": false, "count": 15, "tags": [], "id": 10964336, "text": "Created attachment 8691990\ntestcase-animation.html\n\nHere is a new testcase that counts how many times we fire transitionend, animationstart/end/iteration. You can try with the tab in background or not.\n\nIt's also available online at https://everlong.org/mozilla/testcase-animation.html\n\nI tried in Chrome and IE11 as well.\n\nAfter each step, we should have the following equality, when the tab is visible: \n\n  animationstart - 1 == animationend - 1 == animationiteration - 1 == setInterval == transitionend\n\n\nWhen the tab is not visible, we have some events fired, sometimes.\n\nFrom what I see:\n* transitionend is not fired if the transition is triggered while in background. It seems to be fired if the transition already started (but didn't finish) before putting the tab in background. But I'm not sure if this is always the case.\n* animationend/animationiteration generally do not fire in a background tab.\n* animationstart seems to fire _sometimes_. This is not what Chrome or IE11 do.\n\n\nSo I think that _at least_ we should be consistent, and always have animationend/animationiteration fired when animationstart is fired.\n\nThat said, this behavior is really painful for web developers, that we can't rely on animationend/transitionend events being fired.", "attachment_id": 8691990, "time": "2015-11-25T15:43:40Z", "creation_time": "2015-11-25T15:43:40Z", "raw_text": "Here is a new testcase that counts how many times we fire transitionend, animationstart/end/iteration. You can try with the tab in background or not.\n\nIt's also available online at https://everlong.org/mozilla/testcase-animation.html\n\nI tried in Chrome and IE11 as well.\n\nAfter each step, we should have the following equality, when the tab is visible: \n\n  animationstart - 1 == animationend - 1 == animationiteration - 1 == setInterval == transitionend\n\n\nWhen the tab is not visible, we have some events fired, sometimes.\n\nFrom what I see:\n* transitionend is not fired if the transition is triggered while in background. It seems to be fired if the transition already started (but didn't finish) before putting the tab in background. But I'm not sure if this is always the case.\n* animationend/animationiteration generally do not fire in a background tab.\n* animationstart seems to fire _sometimes_. This is not what Chrome or IE11 do.\n\n\nSo I think that _at least_ we should be consistent, and always have animationend/animationiteration fired when animationstart is fired.\n\nThat said, this behavior is really painful for web developers, that we can't rely on animationend/transitionend events being fired."}, {"id": 10964687, "tags": [], "is_private": false, "count": 16, "bug_id": 683696, "raw_text": "Let me be a bit clearer:  What I believe is happening here is that there isn't any transition at all, because nothing causes the \"before transition\" style to ever be computed because we're not displaying the page, so there's no style change, and thus no transition.  I believe this is as it should be.  I think this is only a problem for developers for some ways of initiating transitions, and we should really have better ways.  (I tried to propose that in the CSS WG a number of years back and it wasn't received well, but it was received better more recently.  I should probably implement something; see bug 774655.)\n\nAnything related to animation events should definitely be a different bug.", "creation_time": "2015-11-25T17:17:34Z", "author": "dbaron@dbaron.org", "time": "2015-11-25T17:17:34Z", "attachment_id": null, "creator": "dbaron@dbaron.org", "text": "Let me be a bit clearer:  What I believe is happening here is that there isn't any transition at all, because nothing causes the \"before transition\" style to ever be computed because we're not displaying the page, so there's no style change, and thus no transition.  I believe this is as it should be.  I think this is only a problem for developers for some ways of initiating transitions, and we should really have better ways.  (I tried to propose that in the CSS WG a number of years back and it wasn't received well, but it was received better more recently.  I should probably implement something; see bug 774655.)\n\nAnything related to animation events should definitely be a different bug."}, {"creator": "dbaron@dbaron.org", "author": "dbaron@dbaron.org", "creation_time": "2015-11-25T17:22:12Z", "raw_text": "I filed bug 1228024 on the animation event issues.", "text": "I filed bug 1228024 on the animation event issues.", "attachment_id": null, "time": "2015-11-25T17:22:12Z", "tags": [], "count": 17, "is_private": false, "id": 10964706, "bug_id": 683696}, {"creator": "felash@gmail.com", "author": "felash@gmail.com", "text": "I think I agree with your longterm reasoning. \n\nI also think that what you say is conform to the spec. I agree we likely don't have a \"style change\" in this case, and the spec clearly says that this is implementation-dependant.\n\nYet the spec implies that a \"style change\" event should happen quickly after a DOM change that should trigger it. For example it specifically mentions the \"screen refresh rate\". IMO this makes it clear that we're talking about very short delays between a DOM Change and a \"style change\" event. This should be clarified.\n\nMoreover, what is the value of a \"transitionend\" event if (from the web developer's point of view) its dispatching is not certain and depends on whether the user has put the tab in background ?\n\n(The spec I'm reading is https://drafts.csswg.org/css-transitions/#starting, but I see the older one at http://www.w3.org/TR/css3-transitions/#starting has the same wording here.)", "attachment_id": null, "time": "2015-11-25T18:29:31Z", "creation_time": "2015-11-25T18:29:31Z", "raw_text": "I think I agree with your longterm reasoning. \n\nI also think that what you say is conform to the spec. I agree we likely don't have a \"style change\" in this case, and the spec clearly says that this is implementation-dependant.\n\nYet the spec implies that a \"style change\" event should happen quickly after a DOM change that should trigger it. For example it specifically mentions the \"screen refresh rate\". IMO this makes it clear that we're talking about very short delays between a DOM Change and a \"style change\" event. This should be clarified.\n\nMoreover, what is the value of a \"transitionend\" event if (from the web developer's point of view) its dispatching is not certain and depends on whether the user has put the tab in background ?\n\n(The spec I'm reading is https://drafts.csswg.org/css-transitions/#starting, but I see the older one at http://www.w3.org/TR/css3-transitions/#starting has the same wording here.)", "bug_id": 683696, "count": 18, "is_private": false, "tags": [], "id": 10964969}, {"author": "brian@birchill.co.jp", "creator": "brian@birchill.co.jp", "creation_time": "2015-11-25T22:44:04Z", "raw_text": "(In reply to David Baron [:dbaron] \u231aUTC-8 from comment #16)\n> (I tried to propose\n> that in the CSS WG a number of years back and it wasn't received well, but\n> it was received better more recently.  I should probably implement\n> something; see bug 774655.)\n\nI started thinking about this here: https://drafts.csswg.org/css-transitions-2/#issue-861d9310", "time": "2015-11-25T22:44:04Z", "attachment_id": null, "text": "(In reply to David Baron [:dbaron] \u231aUTC-8 from comment #16)\n> (I tried to propose\n> that in the CSS WG a number of years back and it wasn't received well, but\n> it was received better more recently.  I should probably implement\n> something; see bug 774655.)\n\nI started thinking about this here: https://drafts.csswg.org/css-transitions-2/#issue-861d9310", "id": 10965874, "is_private": false, "count": 19, "tags": [], "bug_id": 683696}, {"author": "felash@gmail.com", "creator": "felash@gmail.com", "id": 11053689, "tags": [], "is_private": false, "count": 20, "bug_id": 683696, "creation_time": "2016-01-07T09:03:57Z", "raw_text": "Brian, sorry if it's not the right medium to comment, but shouldn't this be an animation instead of a transition ? IMO a transition should only be how we go from an initial state A to a final state B, while an animation is how we display nice things while staying at the same state A. When I look at your \"differences\" section, it seems to me that you really want an animation here.", "time": "2016-01-07T09:03:57Z", "attachment_id": null, "text": "Brian, sorry if it's not the right medium to comment, but shouldn't this be an animation instead of a transition ? IMO a transition should only be how we go from an initial state A to a final state B, while an animation is how we display nice things while staying at the same state A. When I look at your \"differences\" section, it seems to me that you really want an animation here."}, {"creation_time": "2016-01-08T00:23:29Z", "raw_text": "(In reply to Julien Wajsberg [:julienw] (PTO -> 2016) from comment #20)\n> Brian, sorry if it's not the right medium to comment, but shouldn't this be\n> an animation instead of a transition ? IMO a transition should only be how\n> we go from an initial state A to a final state B, while an animation is how\n> we display nice things while staying at the same state A. When I look at\n> your \"differences\" section, it seems to me that you really want an animation\n> here.\n\nI'm not sure what \"this\" or \"here\" refers to but regarding your description of the difference between transitions and animations I completely agree.\n\n(Regarding the issue in the spec, the background is that we have a CSSTransition interface for inspecting running transitions (already implemented in Firefox behind a pref and used by DevTools). The current best-practice seems to be that we should add constructors for all these interfaces (at least Domenic and others often push this as a way of minimizing magic in the platform).\n\nI was trying to work out what the constructor for CSSTransition should be and at the same time I happen to know there has sometimes been this desire to have an API for programmatically triggering CSS transitions. It's tempting to try to fix both at the same time but, as you can see from that issue, it might not be the best approach.\n\nBut maybe you're referring to something completely different?)", "text": "(In reply to Julien Wajsberg [:julienw] (PTO -> 2016) from comment #20)\n> Brian, sorry if it's not the right medium to comment, but shouldn't this be\n> an animation instead of a transition ? IMO a transition should only be how\n> we go from an initial state A to a final state B, while an animation is how\n> we display nice things while staying at the same state A. When I look at\n> your \"differences\" section, it seems to me that you really want an animation\n> here.\n\nI'm not sure what \"this\" or \"here\" refers to but regarding your description of the difference between transitions and animations I completely agree.\n\n(Regarding the issue in the spec, the background is that we have a CSSTransition interface for inspecting running transitions (already implemented in Firefox behind a pref and used by DevTools). The current best-practice seems to be that we should add constructors for all these interfaces (at least Domenic and others often push this as a way of minimizing magic in the platform).\n\nI was trying to work out what the constructor for CSSTransition should be and at the same time I happen to know there has sometimes been this desire to have an API for programmatically triggering CSS transitions. It's tempting to try to fix both at the same time but, as you can see from that issue, it might not be the best approach.\n\nBut maybe you're referring to something completely different?)", "attachment_id": null, "time": "2016-01-08T00:23:29Z", "tags": [], "count": 21, "is_private": false, "id": 11056839, "bug_id": 683696, "creator": "brian@birchill.co.jp", "author": "brian@birchill.co.jp"}, {"attachment_id": null, "time": "2016-01-28T07:51:24Z", "text": "Thanks Brian, this is exactly what I was referring. Thanks for the background, your task is not an easy task :)", "creation_time": "2016-01-28T07:51:24Z", "raw_text": "Thanks Brian, this is exactly what I was referring. Thanks for the background, your task is not an easy task :)", "bug_id": 683696, "id": 11115359, "tags": [], "is_private": false, "count": 22, "author": "felash@gmail.com", "creator": "felash@gmail.com"}]}}}