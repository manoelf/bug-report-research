{"bugs": {"697635": {"comments": [{"creation_time": "2011-10-27T01:17:25Z", "author": "m-wada@usa.com", "text": "\"From \" line(unix mbox mail separator) in offline-store file of IMAP folder by \"Repair Folder\" is different from one by \"Compact\".\nX-Mozilla-... header shouldn't be written in offline-store file by \"Repair Folder\".\nX-Mozilla-Keys: header should be removed from offline-store file by \"Compact\".\n\nThis can't be called \"bug of Tb\", but it may produce unwanted problems, because mail start position after \"From \", mail header part length, total mail data length, are changed by \"Compact folder\".\nI guess some phenomena in bug reports for \"corrupted mail data with IMAP\" are relevant to this offset/length change in offline-store file by Compact. \n\n(A) Offline-store file after \"Repair Folder\"\nFrom - Thu Oct 27 09:49:18 2011\nX-Mozilla-Status: 0001\nX-Mozilla-Status2: 00000000\nX-Mozilla-Keys: $label1    \nMessage-ID: <bug-xxxxxx.a.a@test.mailend>\nSubject: test mail\nFrom: a a <a.a@x.y.z>\nTo: b b <b.b@x.y.z>\nDate: Sat, 01 Jan 2011 02:03:04 +0000\nContent-Type: text/plain\nMIME-Version: 1.0\n\ntest mail\n\n(B) Offline-store file after \"Compact\"\nFrom \nX-Mozilla-Keys: $label1    \nMessage-ID: <bug-xxxxxx.a.a@test.mailend>\nSubject: mailend\nFrom: a a <a.a@x.y.z>\nTo: b b <b.b@x.y.z>\nDate: Sat, 01 Jan 2011 02:03:04 +0000\nContent-Type: text/plain\nMIME-Version: 1.0\n\ntest mail", "bug_id": 697635, "tags": [], "time": "2011-10-27T01:17:25Z", "is_private": false, "creator": "m-wada@usa.com", "count": 0, "id": 5807968, "attachment_id": null, "raw_text": "\"From \" line(unix mbox mail separator) in offline-store file of IMAP folder by \"Repair Folder\" is different from one by \"Compact\".\nX-Mozilla-... header shouldn't be written in offline-store file by \"Repair Folder\".\nX-Mozilla-Keys: header should be removed from offline-store file by \"Compact\".\n\nThis can't be called \"bug of Tb\", but it may produce unwanted problems, because mail start position after \"From \", mail header part length, total mail data length, are changed by \"Compact folder\".\nI guess some phenomena in bug reports for \"corrupted mail data with IMAP\" are relevant to this offset/length change in offline-store file by Compact. \n\n(A) Offline-store file after \"Repair Folder\"\nFrom - Thu Oct 27 09:49:18 2011\nX-Mozilla-Status: 0001\nX-Mozilla-Status2: 00000000\nX-Mozilla-Keys: $label1    \nMessage-ID: <bug-xxxxxx.a.a@test.mailend>\nSubject: test mail\nFrom: a a <a.a@x.y.z>\nTo: b b <b.b@x.y.z>\nDate: Sat, 01 Jan 2011 02:03:04 +0000\nContent-Type: text/plain\nMIME-Version: 1.0\n\ntest mail\n\n(B) Offline-store file after \"Compact\"\nFrom \nX-Mozilla-Keys: $label1    \nMessage-ID: <bug-xxxxxx.a.a@test.mailend>\nSubject: mailend\nFrom: a a <a.a@x.y.z>\nTo: b b <b.b@x.y.z>\nDate: Sat, 01 Jan 2011 02:03:04 +0000\nContent-Type: text/plain\nMIME-Version: 1.0\n\ntest mail"}, {"text": "When we compact offline stores, we update the offline message size here - http://mxr.mozilla.org/comm-central/source/mailnews/base/src/nsMsgFolderCompactor.cpp#981\n\nAnd we account for the From header here:\n\nhttp://mxr.mozilla.org/comm-central/source/mailnews/base/src/nsMsgFolderCompactor.cpp#1212\n\nSo I don't think this can be the cause of offline store corruption. We never \"reparse\" offline stores, and we sanity check each message in the offline store to make sure it starts with \"From \" before we use it.", "time": "2011-10-27T14:50:27Z", "tags": [], "creation_time": "2011-10-27T14:50:27Z", "author": "mozilla@davidbienvenu.org", "is_private": false, "creator": "mozilla@davidbienvenu.org", "id": 5808825, "raw_text": "When we compact offline stores, we update the offline message size here - http://mxr.mozilla.org/comm-central/source/mailnews/base/src/nsMsgFolderCompactor.cpp#981\n\nAnd we account for the From header here:\n\nhttp://mxr.mozilla.org/comm-central/source/mailnews/base/src/nsMsgFolderCompactor.cpp#1212\n\nSo I don't think this can be the cause of offline store corruption. We never \"reparse\" offline stores, and we sanity check each message in the offline store to make sure it starts with \"From \" before we use it.", "attachment_id": null, "bug_id": 697635, "count": 1}, {"count": 2, "creator": "Ulf.Zibis@gmx.de", "is_private": false, "bug_id": 697635, "tags": [], "time": "2011-11-30T15:03:10Z", "text": "IMO, Compact should NOT remove the time-stamp after \"From \" because:\n- received time info will be lost\n- user could run in big problems on at least some mail servers:\n-- Bug 667294\n-- Bug 668482", "author": "Ulf.Zibis@gmx.de", "creation_time": "2011-11-30T15:03:10Z", "raw_text": "IMO, Compact should NOT remove the time-stamp after \"From \" because:\n- received time info will be lost\n- user could run in big problems on at least some mail servers:\n-- Bug 667294\n-- Bug 668482", "attachment_id": null, "id": 5882036}, {"attachment_id": null, "raw_text": "(In reply to Ulf.Zibis from comment #2)\n> IMO, Compact should NOT remove the time-stamp after \"From \" because:\n> - received time info will be lost\n\nThis \"From \" line or \"From - timestmp\" line is merely a separator of mails in Unix Mbox format file, and it can be seen only by viewing of Tb's offline-store file using text editor or some tools. And, timestamp in it is changed by \"Repair Folder\" of IMAP folder of offline-use=on. I can't understand why timestamp value in separator of Unix Mbox format is so important, although timestamp in separator of Unix Mbox format is convenient in problem analysis and I hope it's kept by Compact if timestamp is continuously written by Tb.", "id": 5892272, "creator": "m-wada@usa.com", "is_private": false, "count": 3, "author": "m-wada@usa.com", "creation_time": "2011-12-05T09:37:40Z", "bug_id": 697635, "time": "2011-12-05T09:37:40Z", "tags": [], "text": "(In reply to Ulf.Zibis from comment #2)\n> IMO, Compact should NOT remove the time-stamp after \"From \" because:\n> - received time info will be lost\n\nThis \"From \" line or \"From - timestmp\" line is merely a separator of mails in Unix Mbox format file, and it can be seen only by viewing of Tb's offline-store file using text editor or some tools. And, timestamp in it is changed by \"Repair Folder\" of IMAP folder of offline-use=on. I can't understand why timestamp value in separator of Unix Mbox format is so important, although timestamp in separator of Unix Mbox format is convenient in problem analysis and I hope it's kept by Compact if timestamp is continuously written by Tb."}, {"attachment_id": null, "raw_text": "(In reply to David :Bienvenu from comment #1)\n> When we compact offline stores, we update the offline message size here -\n> And we account for the From header here:\n> So I don't think this can be the cause of offline store corruption.\n\nDavid :Bienvenu, is Tb torelant with \"From ...\" line in IMAP mail data?\nMerge of \"From \" line(as Unix Mbox mail separator by Tb) and \"From - ...\" line(as mail data line) occurs by Compact of IMAP folder of offline-use=on.\nIt looks that original separator of \"From \" line is merely replaced by \"From - timestamp\" line in mail data, so critical mail data corruption doesn't seem to happen. However, at least inconsistent display by view/message source happens(\"From - ...\" line as mail data is lost by Compact after Repair Folder).\n(See bug 668482 comment #7)", "id": 5892286, "creator": "m-wada@usa.com", "is_private": false, "author": "m-wada@usa.com", "creation_time": "2011-12-05T09:55:43Z", "time": "2011-12-05T09:55:43Z", "tags": [], "text": "(In reply to David :Bienvenu from comment #1)\n> When we compact offline stores, we update the offline message size here -\n> And we account for the From header here:\n> So I don't think this can be the cause of offline store corruption.\n\nDavid :Bienvenu, is Tb torelant with \"From ...\" line in IMAP mail data?\nMerge of \"From \" line(as Unix Mbox mail separator by Tb) and \"From - ...\" line(as mail data line) occurs by Compact of IMAP folder of offline-use=on.\nIt looks that original separator of \"From \" line is merely replaced by \"From - timestamp\" line in mail data, so critical mail data corruption doesn't seem to happen. However, at least inconsistent display by view/message source happens(\"From - ...\" line as mail data is lost by Compact after Repair Folder).\n(See bug 668482 comment #7)", "count": 4, "bug_id": 697635}, {"id": 5892663, "raw_text": "(In reply to WADA from comment #4)\n> (In reply to David :Bienvenu from comment #1)\n> > When we compact offline stores, we update the offline message size here -\n> > And we account for the From header here:\n> > So I don't think this can be the cause of offline store corruption.\n> \n> David :Bienvenu, is Tb torelant with \"From ...\" line in IMAP mail data?\nIt doesn't care - there's no parsing of IMAP offline stores, and the From line is only used for (re)parsing local message folders, not imap offline stores.\n\nI think the from date is only used if there's no actual date header in the message.", "attachment_id": null, "text": "(In reply to WADA from comment #4)\n> (In reply to David :Bienvenu from comment #1)\n> > When we compact offline stores, we update the offline message size here -\n> > And we account for the From header here:\n> > So I don't think this can be the cause of offline store corruption.\n> \n> David :Bienvenu, is Tb torelant with \"From ...\" line in IMAP mail data?\nIt doesn't care - there's no parsing of IMAP offline stores, and the From line is only used for (re)parsing local message folders, not imap offline stores.\n\nI think the from date is only used if there's no actual date header in the message.", "tags": [], "bug_id": 697635, "time": "2011-12-05T15:04:17Z", "creation_time": "2011-12-05T15:04:17Z", "author": "mozilla@davidbienvenu.org", "count": 5, "is_private": false, "creator": "mozilla@davidbienvenu.org"}, {"count": 6, "creator": "m-wada@usa.com", "is_private": false, "tags": [], "time": "2011-12-06T09:14:54Z", "bug_id": 697635, "text": "Problem when \"merge of two From lines in offline-store by Compact\" was \"loss of From lines at top part in message source after Compact\" only.\nIf multiple From lines are placed at top of uploaded mail, From lines at top part was reduced by each Compact until non From line appears as first line. However, mail end of the mail, mail start/end of following mails which is shown by View/Message Source were always correct and never affected by Compact.", "author": "m-wada@usa.com", "creation_time": "2011-12-06T09:14:54Z", "raw_text": "Problem when \"merge of two From lines in offline-store by Compact\" was \"loss of From lines at top part in message source after Compact\" only.\nIf multiple From lines are placed at top of uploaded mail, From lines at top part was reduced by each Compact until non From line appears as first line. However, mail end of the mail, mail start/end of following mails which is shown by View/Message Source were always correct and never affected by Compact.", "attachment_id": null, "id": 5894360}, {"bug_id": 697635, "count": 7, "text": "FYI.\nX-Mozilla-Keys: $label1 in comment #0 was produced by \"upload of mail from local mail folder to IMAP folder by Tb\". This problem is processed by other bug.", "time": "2011-12-09T01:36:46Z", "tags": [], "creation_time": "2011-12-09T01:36:46Z", "author": "m-wada@usa.com", "is_private": false, "creator": "m-wada@usa.com", "id": 5903028, "raw_text": "FYI.\nX-Mozilla-Keys: $label1 in comment #0 was produced by \"upload of mail from local mail folder to IMAP folder by Tb\". This problem is processed by other bug.", "attachment_id": null}, {"bug_id": 697635, "time": "2011-12-09T03:31:43Z", "tags": [], "text": "I've opeed separate bug 708941 for problem of comment #6.", "author": "m-wada@usa.com", "creation_time": "2011-12-09T03:31:43Z", "count": 8, "creator": "m-wada@usa.com", "is_private": false, "id": 5903232, "raw_text": "I've opeed separate bug 708941 for problem of comment #6.", "attachment_id": null}, {"id": 5934286, "attachment_id": null, "raw_text": "", "author": "m-wada@usa.com", "creation_time": "2011-12-22T01:34:51Z", "bug_id": 697635, "time": "2011-12-22T01:34:51Z", "tags": [], "text": "*** Bug 517837 has been marked as a duplicate of this bug. ***", "creator": "m-wada@usa.com", "is_private": false, "count": 9}]}}, "comments": {}}