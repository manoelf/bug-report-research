{"bugs": {"657394": {"comments": [{"text": "I managed to get some of the import stuff building with frozen linkage since I'm using it for a project. Note that I commented out some of the import modules because I didn't need them.\n\nI'm attaching a WIP patch in case anyone is curious. If there is any interest in getting these changes landed, I can put together a proper patch for review.", "count": 0, "author": "matthew.gertner@gmail.com", "creator": "matthew.gertner@gmail.com", "attachment_id": null, "id": 5472691, "time": "2011-05-16T17:28:42Z", "tags": [], "raw_text": "I managed to get some of the import stuff building with frozen linkage since I'm using it for a project. Note that I commented out some of the import modules because I didn't need them.\n\nI'm attaching a WIP patch in case anyone is curious. If there is any interest in getting these changes landed, I can put together a proper patch for review.", "creation_time": "2011-05-16T17:28:42Z", "bug_id": 657394, "is_private": false}, {"creator": "matthew.gertner@gmail.com", "tags": [], "raw_text": "", "creation_time": "2011-05-16T17:30:27Z", "bug_id": 657394, "attachment_id": 532680, "is_private": false, "text": "Created attachment 532680\nWIP patch", "count": 1, "id": 5472698, "author": "matthew.gertner@gmail.com", "time": "2011-05-16T17:30:27Z"}, {"text": "(In reply to comment #0)\n\n> I'm attaching a WIP patch in case anyone is curious. If there is any\n> interest in getting these changes landed, I can put together a proper patch\n> for review.\n\nYes please :-)", "count": 2, "id": 5472752, "author": "ludovic@hirlimann.net", "time": "2011-05-16T17:50:00Z", "creator": "ludovic@hirlimann.net", "tags": [], "raw_text": "(In reply to comment #0)\n\n> I'm attaching a WIP patch in case anyone is curious. If there is any\n> interest in getting these changes landed, I can put together a proper patch\n> for review.\n\nYes please :-)", "bug_id": 657394, "creation_time": "2011-05-16T17:50:00Z", "attachment_id": null, "is_private": false}, {"is_private": false, "tags": [], "raw_text": "Okay, I've cleaned up the patch, fixed a few issues and removed the irrelevant stuff. Note that this isn't for the full import tree, just for the modules that I need right now. So I've touched e.g. Eudora.", "bug_id": 657394, "creation_time": "2011-05-19T09:29:10Z", "id": 5479544, "time": "2011-05-19T09:29:10Z", "attachment_id": 533568, "creator": "matthew.gertner@gmail.com", "author": "matthew.gertner@gmail.com", "text": "Created attachment 533568\nCleaned up patch for import and related\n\nOkay, I've cleaned up the patch, fixed a few issues and removed the irrelevant stuff. Note that this isn't for the full import tree, just for the modules that I need right now. So I've touched e.g. Eudora.", "count": 3}, {"id": 5859724, "time": "2011-11-19T00:22:29Z", "is_private": false, "tags": [], "raw_text": "Well, I got there in the end... there was some bitrot so I haven't tried compiling it, although there are some obvious errors anyway.\n\n>diff -r e0a553b5ca12 mailnews/base/util/nsStopwatch.cpp\nNot really part of import...\n\n>+    aStream.Append(NS_LITERAL_STRING(\"\\n\"));\nNit: aStream.Append('\\n');\n\n>-  val.ReplaceSubstring(NS_LITERAL_STRING(\"\\x0D\\x0A\").get(),\n>-                         NS_LITERAL_STRING(\", \").get());\n>-  val.ReplaceChar( 13, ',');\n>-  val.ReplaceChar( 10, ',');\n>+  MsgReplaceSubstring(val, NS_LITERAL_STRING(\"\\x0D\\x0A\"), NS_LITERAL_STRING(\", \"));\n>+  const char set[] = { 13, 10 };\n>+  MsgReplaceChar(val, set, L',');\nset needs to be null terminated, i.e. \"\\r\\n\"\nOr you could have used MsgReplaceChar(val, 13, ',') etc.\n\n>-    val1.Right( val2, val1.Length() - idx - cnt);\n>+    val2 = StringTail( val1, val1.Length() - idx - cnt);\nNit: Perhaps val2 = Substring(val1, idx + cnt); is more readable.\n\n>-    val1.Left( temp, idx);\n>+    temp = StringHead( val1, idx);\n>     val1 = temp;\nI thought val1 = StringHead(val1, idx); but then val1.SetLength(idx); works.\n\n>-    pEntry->fileName.Right( ext, 4);\n>+    ext = StringTail(pEntry->fileName, 4);\n>     if (!ext.Equals(mbxExt))\nif (!pEntry->FileName.StringEndsWith(NS_LITERAL_CSTRING(\".mbx\")))\n\n>-  NS_CopyNativeToUnicode(nsDependentCString(prettyName), pEntry->mailName);\n>+  pEntry->mailName = NS_ConvertUTF8toUTF16(nsDependentCString(prettyName));\nI can't comment on these, except to say that UTF8 is wrong.\n\n>+  CopyASCIItoUTF16(nsCString(buffer), str);\nnsDependentCString\n\n>-    acctName.AssignASCII(defaultName);\n>+    acctName.AssignLiteral(defaultName);\nThis is just plain wrong. Fortunately it's no longer necessary.\n\n>-  NS_GetProxyForObject(NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIStringBundle),\n>+  MsgGetProxyForObject(NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIStringBundle),\n(Bitrotted.)\n\n>+    LossyCopyUTF16toASCII(nsString((PRUnichar *) pVal->Value.lpszW), val);\nnsDependentString\n\n>   while ((idx = s.Find( \"\\x0D\")) != -1) {\n>-    s.Left( t, idx);\n>+    t = StringHead( s, idx);\n>     t += \"\\\\n\";\n>-    s.Right( rt, s.Length() - idx - 1);\n>+    rt = StringTail( s, s.Length() - idx - 1);\n>     t += rt;\n>     s = t;\n>   }\n>   while ((idx = s.Find( \"\\x0A\")) != -1) {\n>-    s.Left( t, idx);\n>+    t = StringHead( s, idx);\n>     t += \"\\\\r\";\n>-    s.Right( rt, s.Length() - idx - 1);\n>+    rt = StringTail( s, s.Length() - idx - 1);\n>     t += rt;\n>     s = t;\n>   }\nIs it me or is this the same as MsgReplaceSubstring(s, \"\\x0D\", \"\\\\n\"); MsgReplaceSubstring(s, \"\\x0A\", \"\\\\r\"); ? Spot the coding error.\n\n>-        strVal.Left( t, 60);\n>+        t = StringHead( strVal, 60);\n>         strVal = t;\nstrVal.SetLength(60);\n\n>   nsCString left;\n>-  m_mimeContentType.Left( left, 10);\n>+  left = StringHead( m_mimeContentType, 10);\n>   if (left.Equals(NS_LITERAL_CSTRING(\"multipart/\"), nsCaseInsensitiveCStringComparator()))\n>     return( TRUE);\n>   return( FALSE);\nreturn StringBeginsWith(m_mimeContentType, NS_LITERAL_CSTRING(\"multipart/\"), nsCaseInsensitiveCStringComparator());\n\n>+    CopyASCIItoUTF16(nsCString(nsMsgI18NFileSystemCharset()), headerVal);\nheaderVal.AssignASCII(nsMsgI18NFileSystemCharset());\n\n>+    pMimeType = ToNewCString(NS_ConvertUTF16toUTF8(bodyType));\nNS_LossyConvertUTF16toASCII\n\n>-        if (header.LowerCaseEqualsLiteral(\"content-type:\") && val.LowerCaseEqualsLiteral(\"application/ms-tnef\"))\n>+        if (MsgLowerCaseEqualsLiteral(header, \"content-type:\") && MsgLowerCaseEqualsLiteral(val, \"application/ms-tnef\"))\n[This might not be necessary any more.]\n\n>+  LossyCopyUTF16toASCII(nsString(pName), column );\nnsDependentString\n\n>-  val.ReplaceChar( 13, ',');\n>-  val.ReplaceChar( 10, ',');\n>+  MsgReplaceSubstring(val, NS_LITERAL_STRING(\"\\x0D\\x0A\"), NS_LITERAL_STRING(\", \"));\n>+  const char set[] = { 13, 10 };\n>+  MsgReplaceChar(val, set, L',');\nDitto.\n\n>-    val1.Right( val2, val1.Length() - idx - cnt);\n>-    val1.Left( temp, idx);\n>+    val2 = StringTail( val1, val1.Length() - idx - cnt);\n>+    temp = StringHead( val1, idx);\n>     val1 = temp;\nDitto.\n\n>-    acctName.AssignASCII(defaultName);\n>+    acctName.AssignLiteral(defaultName);\nDitto.", "creation_time": "2011-11-19T00:22:29Z", "bug_id": 657394, "author": "neil@httl.net", "text": "Comment on attachment 533568\nCleaned up patch for import and related\n\nWell, I got there in the end... there was some bitrot so I haven't tried compiling it, although there are some obvious errors anyway.\n\n>diff -r e0a553b5ca12 mailnews/base/util/nsStopwatch.cpp\nNot really part of import...\n\n>+    aStream.Append(NS_LITERAL_STRING(\"\\n\"));\nNit: aStream.Append('\\n');\n\n>-  val.ReplaceSubstring(NS_LITERAL_STRING(\"\\x0D\\x0A\").get(),\n>-                         NS_LITERAL_STRING(\", \").get());\n>-  val.ReplaceChar( 13, ',');\n>-  val.ReplaceChar( 10, ',');\n>+  MsgReplaceSubstring(val, NS_LITERAL_STRING(\"\\x0D\\x0A\"), NS_LITERAL_STRING(\", \"));\n>+  const char set[] = { 13, 10 };\n>+  MsgReplaceChar(val, set, L',');\nset needs to be null terminated, i.e. \"\\r\\n\"\nOr you could have used MsgReplaceChar(val, 13, ',') etc.\n\n>-    val1.Right( val2, val1.Length() - idx - cnt);\n>+    val2 = StringTail( val1, val1.Length() - idx - cnt);\nNit: Perhaps val2 = Substring(val1, idx + cnt); is more readable.\n\n>-    val1.Left( temp, idx);\n>+    temp = StringHead( val1, idx);\n>     val1 = temp;\nI thought val1 = StringHead(val1, idx); but then val1.SetLength(idx); works.\n\n>-    pEntry->fileName.Right( ext, 4);\n>+    ext = StringTail(pEntry->fileName, 4);\n>     if (!ext.Equals(mbxExt))\nif (!pEntry->FileName.StringEndsWith(NS_LITERAL_CSTRING(\".mbx\")))\n\n>-  NS_CopyNativeToUnicode(nsDependentCString(prettyName), pEntry->mailName);\n>+  pEntry->mailName = NS_ConvertUTF8toUTF16(nsDependentCString(prettyName));\nI can't comment on these, except to say that UTF8 is wrong.\n\n>+  CopyASCIItoUTF16(nsCString(buffer), str);\nnsDependentCString\n\n>-    acctName.AssignASCII(defaultName);\n>+    acctName.AssignLiteral(defaultName);\nThis is just plain wrong. Fortunately it's no longer necessary.\n\n>-  NS_GetProxyForObject(NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIStringBundle),\n>+  MsgGetProxyForObject(NS_PROXY_TO_MAIN_THREAD, NS_GET_IID(nsIStringBundle),\n(Bitrotted.)\n\n>+    LossyCopyUTF16toASCII(nsString((PRUnichar *) pVal->Value.lpszW), val);\nnsDependentString\n\n>   while ((idx = s.Find( \"\\x0D\")) != -1) {\n>-    s.Left( t, idx);\n>+    t = StringHead( s, idx);\n>     t += \"\\\\n\";\n>-    s.Right( rt, s.Length() - idx - 1);\n>+    rt = StringTail( s, s.Length() - idx - 1);\n>     t += rt;\n>     s = t;\n>   }\n>   while ((idx = s.Find( \"\\x0A\")) != -1) {\n>-    s.Left( t, idx);\n>+    t = StringHead( s, idx);\n>     t += \"\\\\r\";\n>-    s.Right( rt, s.Length() - idx - 1);\n>+    rt = StringTail( s, s.Length() - idx - 1);\n>     t += rt;\n>     s = t;\n>   }\nIs it me or is this the same as MsgReplaceSubstring(s, \"\\x0D\", \"\\\\n\"); MsgReplaceSubstring(s, \"\\x0A\", \"\\\\r\"); ? Spot the coding error.\n\n>-        strVal.Left( t, 60);\n>+        t = StringHead( strVal, 60);\n>         strVal = t;\nstrVal.SetLength(60);\n\n>   nsCString left;\n>-  m_mimeContentType.Left( left, 10);\n>+  left = StringHead( m_mimeContentType, 10);\n>   if (left.Equals(NS_LITERAL_CSTRING(\"multipart/\"), nsCaseInsensitiveCStringComparator()))\n>     return( TRUE);\n>   return( FALSE);\nreturn StringBeginsWith(m_mimeContentType, NS_LITERAL_CSTRING(\"multipart/\"), nsCaseInsensitiveCStringComparator());\n\n>+    CopyASCIItoUTF16(nsCString(nsMsgI18NFileSystemCharset()), headerVal);\nheaderVal.AssignASCII(nsMsgI18NFileSystemCharset());\n\n>+    pMimeType = ToNewCString(NS_ConvertUTF16toUTF8(bodyType));\nNS_LossyConvertUTF16toASCII\n\n>-        if (header.LowerCaseEqualsLiteral(\"content-type:\") && val.LowerCaseEqualsLiteral(\"application/ms-tnef\"))\n>+        if (MsgLowerCaseEqualsLiteral(header, \"content-type:\") && MsgLowerCaseEqualsLiteral(val, \"application/ms-tnef\"))\n[This might not be necessary any more.]\n\n>+  LossyCopyUTF16toASCII(nsString(pName), column );\nnsDependentString\n\n>-  val.ReplaceChar( 13, ',');\n>-  val.ReplaceChar( 10, ',');\n>+  MsgReplaceSubstring(val, NS_LITERAL_STRING(\"\\x0D\\x0A\"), NS_LITERAL_STRING(\", \"));\n>+  const char set[] = { 13, 10 };\n>+  MsgReplaceChar(val, set, L',');\nDitto.\n\n>-    val1.Right( val2, val1.Length() - idx - cnt);\n>-    val1.Left( temp, idx);\n>+    val2 = StringTail( val1, val1.Length() - idx - cnt);\n>+    temp = StringHead( val1, idx);\n>     val1 = temp;\nDitto.\n\n>-    acctName.AssignASCII(defaultName);\n>+    acctName.AssignLiteral(defaultName);\nDitto.", "count": 4, "attachment_id": 533568, "creator": "neil@httl.net"}, {"text": "(In reply to comment #4)\n> Or you could have used MsgReplaceChar(val, 13, ',') etc.\nSorry, I mixed up my MsgReplaceChar versions.", "count": 5, "time": "2011-11-20T00:01:17Z", "author": "neil@httl.net", "id": 5860847, "creation_time": "2011-11-20T00:01:17Z", "bug_id": 657394, "raw_text": "(In reply to comment #4)\n> Or you could have used MsgReplaceChar(val, 13, ',') etc.\nSorry, I mixed up my MsgReplaceChar versions.", "tags": [], "creator": "neil@httl.net", "attachment_id": null, "is_private": false}, {"attachment_id": 575739, "is_private": false, "raw_text": "", "creation_time": "2011-11-20T13:59:16Z", "bug_id": 657394, "creator": "neil@httl.net", "tags": [], "author": "neil@httl.net", "time": "2011-11-20T13:59:16Z", "id": 5861219, "count": 6, "text": "Created attachment 575739\nAcceptable parts of attachment 533568"}, {"id": 5861644, "time": "2011-11-21T00:37:58Z", "tags": [], "bug_id": 657394, "creation_time": "2011-11-21T00:37:58Z", "raw_text": "This is enough to build import.dll with external linkage. However this has only been tested by compiling (both as a normal libxul build, and with other patches that allow an external linkage build to complete).", "is_private": false, "text": "Created attachment 575787\nWindows import fixes\n\nThis is enough to build import.dll with external linkage. However this has only been tested by compiling (both as a normal libxul build, and with other patches that allow an external linkage build to complete).", "count": 7, "author": "neil@httl.net", "creator": "neil@httl.net", "attachment_id": 575787}, {"attachment_id": 575787, "creator": "mozilla@davidbienvenu.org", "author": "mozilla@davidbienvenu.org", "count": 8, "text": "Comment on attachment 575787\nWindows import fixes\n\nthis did not apply cleanly at all against the trunk - do I need any other patches applied first? Or has it bit-rotted?", "is_private": false, "creation_time": "2011-11-22T20:05:59Z", "bug_id": 657394, "raw_text": "this did not apply cleanly at all against the trunk - do I need any other patches applied first? Or has it bit-rotted?", "tags": [], "time": "2011-11-22T20:05:59Z", "id": 5866202}, {"attachment_id": null, "creator": "neil@httl.net", "author": "neil@httl.net", "text": "(In reply to David :Bienvenu from comment #8)\n> (From update of attachment 575787)\n> this did not apply cleanly at all against the trunk - do I need any other\n> patches applied first? Or has it bit-rotted?\nIt might have bit-rotted, I diffed it from a tree without attachment 575739...", "count": 9, "is_private": false, "bug_id": 657394, "creation_time": "2011-11-22T23:39:10Z", "raw_text": "(In reply to David :Bienvenu from comment #8)\n> (From update of attachment 575787)\n> this did not apply cleanly at all against the trunk - do I need any other\n> patches applied first? Or has it bit-rotted?\nIt might have bit-rotted, I diffed it from a tree without attachment 575739...", "tags": [], "time": "2011-11-22T23:39:10Z", "id": 5866972}, {"raw_text": "", "creation_time": "2011-11-22T23:50:09Z", "bug_id": 657394, "creator": "neil@httl.net", "tags": [], "is_private": false, "attachment_id": 576337, "text": "Created attachment 576337\nWindows import fixes", "count": 10, "author": "neil@httl.net", "time": "2011-11-22T23:50:09Z", "id": 5867028}, {"is_private": false, "creation_time": "2011-11-23T20:45:55Z", "bug_id": 657394, "raw_text": "Pushed changeset 874d9533b2d8 to comm-central.", "tags": [], "time": "2011-11-23T20:45:55Z", "id": 5869286, "attachment_id": 575739, "creator": "neil@httl.net", "author": "neil@httl.net", "count": 11, "text": "Comment on attachment 575739\nAcceptable parts of attachment 533568\n\nPushed changeset 874d9533b2d8 to comm-central."}, {"is_private": false, "tags": [], "raw_text": "Pushed changeset 227e3ebe67b3 to comm-central.", "creation_time": "2011-11-23T20:49:13Z", "bug_id": 657394, "id": 5869294, "time": "2011-11-23T20:49:13Z", "attachment_id": 576337, "creator": "neil@httl.net", "author": "neil@httl.net", "count": 12, "text": "Comment on attachment 576337\nWindows import fixes\n\nPushed changeset 227e3ebe67b3 to comm-central."}, {"attachment_id": 577886, "creator": "jhorak@redhat.com", "author": "jhorak@redhat.com", "text": "Created attachment 577886\nimport makefile fix 1\n\nI can't build mailnews with external linkage (external libxul) due to changes to import/build/Makefile.in\nAttaching patch which solve this issue in my case.\nI'm not sure about libreg, but it is obsolete now, isn't it?", "count": 13, "is_private": false, "creation_time": "2011-11-30T08:37:36Z", "bug_id": 657394, "raw_text": "I can't build mailnews with external linkage (external libxul) due to changes to import/build/Makefile.in\nAttaching patch which solve this issue in my case.\nI'm not sure about libreg, but it is obsolete now, isn't it?", "tags": [], "time": "2011-11-30T08:37:36Z", "id": 5881489}, {"tags": [], "raw_text": "libreg is needed for comm4x import...", "bug_id": 657394, "creation_time": "2011-11-30T09:44:57Z", "is_private": false, "id": 5881558, "time": "2011-11-30T09:44:57Z", "creator": "neil@httl.net", "attachment_id": null, "count": 14, "text": "libreg is needed for comm4x import...", "author": "neil@httl.net"}, {"time": "2011-11-30T10:01:32Z", "id": 5881572, "creation_time": "2011-11-30T10:01:32Z", "bug_id": 657394, "raw_text": "(In reply to neil@parkwaycc.co.uk from comment #14)\n> libreg is needed for comm4x import...\n\nIs comm4x import still used ?", "tags": [], "is_private": false, "count": 15, "text": "(In reply to neil@parkwaycc.co.uk from comment #14)\n> libreg is needed for comm4x import...\n\nIs comm4x import still used ?", "author": "ludovic@hirlimann.net", "creator": "ludovic@hirlimann.net", "attachment_id": null}, {"time": "2011-12-17T00:22:26Z", "id": 5923681, "creation_time": "2011-12-17T00:22:26Z", "bug_id": 657394, "raw_text": "(In reply to Ludovic Hirlimann from comment #15)\n> (In reply to comment #14)\n> > libreg is needed for comm4x import...\n> \n> Is comm4x import still used ?\n\nWell, not since libreg got killed off by bug 679352 et. al.", "tags": [], "is_private": false, "text": "(In reply to Ludovic Hirlimann from comment #15)\n> (In reply to comment #14)\n> > libreg is needed for comm4x import...\n> \n> Is comm4x import still used ?\n\nWell, not since libreg got killed off by bug 679352 et. al.", "count": 16, "author": "neil@httl.net", "creator": "neil@httl.net", "attachment_id": null}, {"attachment_id": 577886, "is_private": false, "creation_time": "2011-12-17T00:28:36Z", "bug_id": 657394, "raw_text": ">-\t$(MOZDEPTH)/modules/libreg/src/$(LIB_PREFIX)mozreg_s.$(LIB_SUFFIX) \\\nObviously you don't need to remove this any more ;-)", "tags": [], "creator": "neil@httl.net", "time": "2011-12-17T00:28:36Z", "author": "neil@httl.net", "id": 5923695, "text": "Comment on attachment 577886\nimport makefile fix 1\n\n>-\t$(MOZDEPTH)/modules/libreg/src/$(LIB_PREFIX)mozreg_s.$(LIB_SUFFIX) \\\nObviously you don't need to remove this any more ;-)", "count": 17}, {"tags": [], "creator": "ludovic@hirlimann.net", "bug_id": 657394, "creation_time": "2015-09-25T12:50:24Z", "raw_text": "Removing myslef on all the bugs I'm cced on. Please NI me if you need something on MailNews Core bugs from me.", "is_private": false, "attachment_id": null, "count": 18, "text": "Removing myslef on all the bugs I'm cced on. Please NI me if you need something on MailNews Core bugs from me.", "id": 10776436, "time": "2015-09-25T12:50:24Z", "author": "ludovic@hirlimann.net"}]}}, "comments": {}}