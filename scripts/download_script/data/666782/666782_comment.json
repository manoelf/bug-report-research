{"comments": {}, "bugs": {"666782": {"comments": [{"author": "colinwg@wtixfm.com", "creation_time": "2011-06-23T22:34:26Z", "time": "2011-06-23T22:34:26Z", "creator": "colinwg@wtixfm.com", "count": 0, "id": 5552634, "is_private": false, "tags": [], "text": "User-Agent:       Mozilla/5.0 (Windows NT 5.0; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: Mozilla/5.0 (Windows NT 5.0; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\n\nPrior 3.x - When in private browsing, Firefox did not update the table in moz_places when going to a website while in private browsing.\n\nNow 4.x - Firefox updates the favicon_id when visiting any website.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Manually enter a bookmark into the list, someplace you've never been before, but one which you're pretty certain has a favicon.\nOR:\nUse SQLite Manager extension, open the places.sqlite database from your profile folder. Optionally, create a copy of the profile to preserve your current profile. Execute the following two commands:\nDELETE FROM moz_favicons WHERE id>0\nUPDATE moz_places SET favicon_id='' WHERE favicon_id>0\n\n2. Exit Firefox and then start it new. Verify that the newly entered bookmark does not have a favicon. (Or if you executed the above SQL's, that NONE of them have favicon's.)\n\n3. Enter private browsing, visit the newly entered bookmark, (or browse your current bookmarks, especially ones which you know have favicons if you executed the SQL statements). Exit the browser. Restart Firefox, favicon's will be next to all the places you've visited that didn't have favicon's before.\n\nActual Results:  \nFavicons are saved.\n\nExpected Results:  \nFavicons should not be updated when in private browsing.\n\nI specifically use private browsing on quite a few site even though I don't need to just to keep this from happening.", "bug_id": 666782, "raw_text": "User-Agent:       Mozilla/5.0 (Windows NT 5.0; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: Mozilla/5.0 (Windows NT 5.0; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\n\nPrior 3.x - When in private browsing, Firefox did not update the table in moz_places when going to a website while in private browsing.\n\nNow 4.x - Firefox updates the favicon_id when visiting any website.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Manually enter a bookmark into the list, someplace you've never been before, but one which you're pretty certain has a favicon.\nOR:\nUse SQLite Manager extension, open the places.sqlite database from your profile folder. Optionally, create a copy of the profile to preserve your current profile. Execute the following two commands:\nDELETE FROM moz_favicons WHERE id>0\nUPDATE moz_places SET favicon_id='' WHERE favicon_id>0\n\n2. Exit Firefox and then start it new. Verify that the newly entered bookmark does not have a favicon. (Or if you executed the above SQL's, that NONE of them have favicon's.)\n\n3. Enter private browsing, visit the newly entered bookmark, (or browse your current bookmarks, especially ones which you know have favicons if you executed the SQL statements). Exit the browser. Restart Firefox, favicon's will be next to all the places you've visited that didn't have favicon's before.\n\nActual Results:  \nFavicons are saved.\n\nExpected Results:  \nFavicons should not be updated when in private browsing.\n\nI specifically use private browsing on quite a few site even though I don't need to just to keep this from happening.", "attachment_id": null}, {"author": "mak@mozilla.com", "time": "2011-06-23T22:49:01Z", "creation_time": "2011-06-23T22:49:01Z", "creator": "mak@mozilla.com", "count": 1, "id": 5552676, "is_private": false, "tags": [], "bug_id": 666782, "text": "Hm, it's possible we store favicons for bookmarks, for sure we don't update anything that is not bookmarked. I'm confirming since it's worth investigation, and adding a test.\n\nI suppose we don't want that. Ehsan?", "raw_text": "Hm, it's possible we store favicons for bookmarks, for sure we don't update anything that is not bookmarked. I'm confirming since it's worth investigation, and adding a test.\n\nI suppose we don't want that. Ehsan?", "attachment_id": null}, {"bug_id": 666782, "text": "(In reply to comment #1)\n> Hm, it's possible we store favicons for bookmarks, for sure we don't update\n> anything that is not bookmarked. I'm confirming since it's worth investigation,\n> and adding a test.\n\nYeah, that indeed sounds like a problem.  I've looked into this code before, but my memory is dusty.  Could you please point me to the place where we store favicons in places?", "tags": [], "attachment_id": null, "raw_text": "(In reply to comment #1)\n> Hm, it's possible we store favicons for bookmarks, for sure we don't update\n> anything that is not bookmarked. I'm confirming since it's worth investigation,\n> and adding a test.\n\nYeah, that indeed sounds like a problem.  I've looked into this code before, but my memory is dusty.  Could you please point me to the place where we store favicons in places?", "time": "2011-06-24T18:05:27Z", "creation_time": "2011-06-24T18:05:27Z", "creator": "ehsan.akhgari@gmail.com", "author": "ehsan.akhgari@gmail.com", "id": 5554452, "count": 2, "is_private": false}, {"attachment_id": null, "is_private": false, "count": 3, "id": 5555310, "raw_text": "the problem is that we have the pb check in SetFaviconUrlForPageInternal, that is invoked by SetFaviconUrlForPage (the internal method may be removed indeed), but the new async method, SetAndLoadFaviconForPage, doesn't pass anymore by that internal method.\n\nSo I think we should merge SetFaviconUrlForPageInternal and SetFaviconUrlForPage, and add the check to SetAndLoadFaviconForPage.\nNot sure about SetFaviconData, SetFaviconDataFromDataURL, since these can only be invoked by add-ons, not by navigation.", "creator": "mak@mozilla.com", "time": "2011-06-24T22:46:56Z", "creation_time": "2011-06-24T22:46:56Z", "author": "mak@mozilla.com", "bug_id": 666782, "text": "the problem is that we have the pb check in SetFaviconUrlForPageInternal, that is invoked by SetFaviconUrlForPage (the internal method may be removed indeed), but the new async method, SetAndLoadFaviconForPage, doesn't pass anymore by that internal method.\n\nSo I think we should merge SetFaviconUrlForPageInternal and SetFaviconUrlForPage, and add the check to SetAndLoadFaviconForPage.\nNot sure about SetFaviconData, SetFaviconDataFromDataURL, since these can only be invoked by add-ons, not by navigation.", "tags": []}, {"text": "Note the official plan is to make SetFaviconUrlForPage async through the new code and completely kill the internal method, but we may take the faster path here though.", "bug_id": 666782, "tags": [], "attachment_id": null, "raw_text": "Note the official plan is to make SetFaviconUrlForPage async through the new code and completely kill the internal method, but we may take the faster path here though.", "time": "2011-06-24T22:54:38Z", "creation_time": "2011-06-24T22:54:38Z", "creator": "mak@mozilla.com", "author": "mak@mozilla.com", "id": 5555334, "count": 4, "is_private": false}, {"raw_text": "taking, let me see what I can do, I could directly go the official plan if doesn't take more than a couple days.", "attachment_id": null, "tags": [], "text": "taking, let me see what I can do, I could directly go the official plan if doesn't take more than a couple days.", "bug_id": 666782, "is_private": false, "id": 5555336, "count": 5, "author": "mak@mozilla.com", "creator": "mak@mozilla.com", "creation_time": "2011-06-24T22:55:24Z", "time": "2011-06-24T22:55:24Z"}, {"tags": [], "bug_id": 666782, "text": "Hm, you know what, we also have a test that ensures explicitly that we STORE favicons for bookmarks in pb mode. I guess that's because we allow to store bookmarks in pb mode by design.\n\nSo this is sort of a redesign of what we want or we don't want to allow.\nBtw, I'm going to make the patch and we can decide direction.", "raw_text": "Hm, you know what, we also have a test that ensures explicitly that we STORE favicons for bookmarks in pb mode. I guess that's because we allow to store bookmarks in pb mode by design.\n\nSo this is sort of a redesign of what we want or we don't want to allow.\nBtw, I'm going to make the patch and we can decide direction.", "attachment_id": null, "author": "mak@mozilla.com", "creator": "mak@mozilla.com", "creation_time": "2011-06-28T23:30:42Z", "time": "2011-06-28T23:30:42Z", "is_private": false, "count": 6, "id": 5563298}, {"tags": [], "text": "notice that, once fixed, users will be able to add bookmarks, but those will retain the blank icon till the bookmark is loaded once ot of pb, that may be a problem for users in persistent pb mode.", "bug_id": 666782, "raw_text": "notice that, once fixed, users will be able to add bookmarks, but those will retain the blank icon till the bookmark is loaded once ot of pb, that may be a problem for users in persistent pb mode.", "attachment_id": null, "author": "mak@mozilla.com", "creator": "mak@mozilla.com", "creation_time": "2011-06-28T23:32:04Z", "time": "2011-06-28T23:32:04Z", "is_private": false, "id": 5563304, "count": 7}, {"count": 8, "id": 5563317, "is_private": false, "author": "mak@mozilla.com", "time": "2011-06-28T23:37:43Z", "creation_time": "2011-06-28T23:37:43Z", "creator": "mak@mozilla.com", "raw_text": "Indeed, I'm starting thinking we should wontfix this bug.\n\nSince you have a bookmark, it's pretty clear that sometimes you will visit it, or you already did, so the icon does not add any interesting private information that I don't know already. It can at a maximum tell me if you already visited or will visit that page, but doesn't matter, even if you have not visited it, I expect you will do, otherwise it would not be a bookmark.\nIf we fix this persistent PB mode will lose all bookmarks favicons, without any way to get those back. This is a much worse functionality loss.", "attachment_id": null, "tags": [], "text": "Indeed, I'm starting thinking we should wontfix this bug.\n\nSince you have a bookmark, it's pretty clear that sometimes you will visit it, or you already did, so the icon does not add any interesting private information that I don't know already. It can at a maximum tell me if you already visited or will visit that page, but doesn't matter, even if you have not visited it, I expect you will do, otherwise it would not be a bookmark.\nIf we fix this persistent PB mode will lose all bookmarks favicons, without any way to get those back. This is a much worse functionality loss.", "bug_id": 666782}, {"attachment_id": null, "raw_text": "Correct me if I'm wrong, but I think if you bookmark a page that you have loaded, you'll get a favicon in places for the bookmark, but if you bookmark a page that you have not loaded (for example using the New Bookmark command), you won't get a favicon entry, right?  If that is the case, the presence of the favicon can leak information about whether you've really visited the page or not.\n\nAlso, why would this be an issue in permanent PB mode?  I assume that we use the places favicon table as some sort of a cache, right?  We should still be able to load and display the icon from the web, we should just avoid writing it to the places db.  is that correct?", "tags": [], "bug_id": 666782, "text": "Correct me if I'm wrong, but I think if you bookmark a page that you have loaded, you'll get a favicon in places for the bookmark, but if you bookmark a page that you have not loaded (for example using the New Bookmark command), you won't get a favicon entry, right?  If that is the case, the presence of the favicon can leak information about whether you've really visited the page or not.\n\nAlso, why would this be an issue in permanent PB mode?  I assume that we use the places favicon table as some sort of a cache, right?  We should still be able to load and display the icon from the web, we should just avoid writing it to the places db.  is that correct?", "id": 5565366, "count": 9, "is_private": false, "creation_time": "2011-06-29T20:06:50Z", "time": "2011-06-29T20:06:50Z", "creator": "ehsan.akhgari@gmail.com", "author": "ehsan.akhgari@gmail.com"}, {"id": 5565418, "count": 10, "is_private": false, "author": "mak@mozilla.com", "time": "2011-06-29T20:27:41Z", "creation_time": "2011-06-29T20:27:41Z", "creator": "mak@mozilla.com", "raw_text": "(In reply to comment #9)\n> Correct me if I'm wrong, but I think if you bookmark a page that you have\n> loaded, you'll get a favicon in places for the bookmark, but if you bookmark\n> a page that you have not loaded (for example using the New Bookmark\n> command), you won't get a favicon entry, right?\n\nright.\n\n> If that is the case, the\n> presence of the favicon can leak information about whether you've really\n> visited the page or not.\n\nYes, it's weak information though (comment 8). That said, if we want to fix it I'm fine with that choice, but doesn't sound like a privacy-blocker. Initially I thought this was a bad regression to be fixed in time for FF7, but it's not even a regression.\n\n> Also, why would this be an issue in permanent PB mode?  I assume that we use\n> the places favicon table as some sort of a cache, right?  We should still be\n> able to load and display the icon from the web, we should just avoid writing\n> it to the places db.  is that correct?\n\nYes and no, the moz-anno:favicon: protocol used to show icons on bookmarks reads from the database, but does not fallback to network, if the icon is not found.  So as things are now, if we don't store the icon in the database we get all blank icons on all bookmarks.\nWhat is needed to work as a cache is a bypassing protocol, that hits the database and if the icon is not there goes through the network (and eventually caches it, if we are not in PB mode). That is bug 573638.", "attachment_id": null, "tags": [], "text": "(In reply to comment #9)\n> Correct me if I'm wrong, but I think if you bookmark a page that you have\n> loaded, you'll get a favicon in places for the bookmark, but if you bookmark\n> a page that you have not loaded (for example using the New Bookmark\n> command), you won't get a favicon entry, right?\n\nright.\n\n> If that is the case, the\n> presence of the favicon can leak information about whether you've really\n> visited the page or not.\n\nYes, it's weak information though (comment 8). That said, if we want to fix it I'm fine with that choice, but doesn't sound like a privacy-blocker. Initially I thought this was a bad regression to be fixed in time for FF7, but it's not even a regression.\n\n> Also, why would this be an issue in permanent PB mode?  I assume that we use\n> the places favicon table as some sort of a cache, right?  We should still be\n> able to load and display the icon from the web, we should just avoid writing\n> it to the places db.  is that correct?\n\nYes and no, the moz-anno:favicon: protocol used to show icons on bookmarks reads from the database, but does not fallback to network, if the icon is not found.  So as things are now, if we don't store the icon in the database we get all blank icons on all bookmarks.\nWhat is needed to work as a cache is a bypassing protocol, that hits the database and if the icon is not there goes through the network (and eventually caches it, if we are not in PB mode). That is bug 573638.", "bug_id": 666782}, {"creator": "ehsan.akhgari@gmail.com", "time": "2011-06-29T21:14:39Z", "creation_time": "2011-06-29T21:14:39Z", "author": "ehsan.akhgari@gmail.com", "is_private": false, "id": 5565549, "count": 11, "tags": [], "bug_id": 666782, "text": "(In reply to comment #10)\n> (In reply to comment #9)\n> > Correct me if I'm wrong, but I think if you bookmark a page that you have\n> > loaded, you'll get a favicon in places for the bookmark, but if you bookmark\n> > a page that you have not loaded (for example using the New Bookmark\n> > command), you won't get a favicon entry, right?\n> \n> right.\n> \n> > If that is the case, the\n> > presence of the favicon can leak information about whether you've really\n> > visited the page or not.\n> \n> Yes, it's weak information though (comment 8). That said, if we want to fix it\n> I'm fine with that choice, but doesn't sound like a privacy-blocker. Initially\n> I thought this was a bad regression to be fixed in time for FF7, but it's not\n> even a regression.\n\nIt is still an information leakage...\n\n> > Also, why would this be an issue in permanent PB mode?  I assume that we use\n> > the places favicon table as some sort of a cache, right?  We should still be\n> > able to load and display the icon from the web, we should just avoid writing\n> > it to the places db.  is that correct?\n> \n> Yes and no, the moz-anno:favicon: protocol used to show icons on bookmarks\n> reads from the database, but does not fallback to network, if the icon is not\n> found.  So as things are now, if we don't store the icon in the database we get\n> all blank icons on all bookmarks.\n> What is needed to work as a cache is a bypassing protocol, that hits the\n> database and if the icon is not there goes through the network (and eventually\n> caches it, if we are not in PB mode). That is bug 573638.\n\nHow hard would doing that be?", "attachment_id": null, "raw_text": "(In reply to comment #10)\n> (In reply to comment #9)\n> > Correct me if I'm wrong, but I think if you bookmark a page that you have\n> > loaded, you'll get a favicon in places for the bookmark, but if you bookmark\n> > a page that you have not loaded (for example using the New Bookmark\n> > command), you won't get a favicon entry, right?\n> \n> right.\n> \n> > If that is the case, the\n> > presence of the favicon can leak information about whether you've really\n> > visited the page or not.\n> \n> Yes, it's weak information though (comment 8). That said, if we want to fix it\n> I'm fine with that choice, but doesn't sound like a privacy-blocker. Initially\n> I thought this was a bad regression to be fixed in time for FF7, but it's not\n> even a regression.\n\nIt is still an information leakage...\n\n> > Also, why would this be an issue in permanent PB mode?  I assume that we use\n> > the places favicon table as some sort of a cache, right?  We should still be\n> > able to load and display the icon from the web, we should just avoid writing\n> > it to the places db.  is that correct?\n> \n> Yes and no, the moz-anno:favicon: protocol used to show icons on bookmarks\n> reads from the database, but does not fallback to network, if the icon is not\n> found.  So as things are now, if we don't store the icon in the database we get\n> all blank icons on all bookmarks.\n> What is needed to work as a cache is a bypassing protocol, that hits the\n> database and if the icon is not there goes through the network (and eventually\n> caches it, if we are not in PB mode). That is bug 573638.\n\nHow hard would doing that be?"}, {"attachment_id": null, "raw_text": "(In reply to comment #11)\n> > What is needed to work as a cache is a bypassing protocol, that hits the\n> > database and if the icon is not there goes through the network (and eventually\n> > caches it, if we are not in PB mode). That is bug 573638.\n> \n> How hard would doing that be?\n\nI never tried, my ideas was to redirect the channel to a network channel, but when I asked someone told me it was hard to do.  Then I had no time to investigate it further.\nIt may be useful for a lot of stuff like aeropeek, jumplists, Panorama and so on. A possible problem though, is that in persistent PB mode, or any other situations where favicons are missing, opening the history sidebar would fire a huge amount of network requests to fetch missing icons. It may be the same for bookmarks sidebar, bookmarks toolbar, or any other Places view with lots of entries.", "text": "(In reply to comment #11)\n> > What is needed to work as a cache is a bypassing protocol, that hits the\n> > database and if the icon is not there goes through the network (and eventually\n> > caches it, if we are not in PB mode). That is bug 573638.\n> \n> How hard would doing that be?\n\nI never tried, my ideas was to redirect the channel to a network channel, but when I asked someone told me it was hard to do.  Then I had no time to investigate it further.\nIt may be useful for a lot of stuff like aeropeek, jumplists, Panorama and so on. A possible problem though, is that in persistent PB mode, or any other situations where favicons are missing, opening the history sidebar would fire a huge amount of network requests to fetch missing icons. It may be the same for bookmarks sidebar, bookmarks toolbar, or any other Places view with lots of entries.", "bug_id": 666782, "tags": [], "id": 5565580, "count": 12, "is_private": false, "time": "2011-06-29T21:27:06Z", "creation_time": "2011-06-29T21:27:06Z", "creator": "mak@mozilla.com", "author": "mak@mozilla.com"}, {"is_private": false, "id": 5565619, "count": 13, "author": "ehsan.akhgari@gmail.com", "creator": "ehsan.akhgari@gmail.com", "creation_time": "2011-06-29T21:38:09Z", "time": "2011-06-29T21:38:09Z", "raw_text": "(In reply to comment #12)\n> (In reply to comment #11)\n> > > What is needed to work as a cache is a bypassing protocol, that hits the\n> > > database and if the icon is not there goes through the network (and eventually\n> > > caches it, if we are not in PB mode). That is bug 573638.\n> > \n> > How hard would doing that be?\n> \n> I never tried, my ideas was to redirect the channel to a network channel, but\n> when I asked someone told me it was hard to do.  Then I had no time to\n> investigate it further.\n> It may be useful for a lot of stuff like aeropeek, jumplists, Panorama and so\n> on. A possible problem though, is that in persistent PB mode, or any other\n> situations where favicons are missing, opening the history sidebar would fire a\n> huge amount of network requests to fetch missing icons. It may be the same for\n> bookmarks sidebar, bookmarks toolbar, or any other Places view with lots of\n> entries.\n\nHmm, this would be less than ideal indeed...\n\nHere's another question: for regular visits, we don't add anything to the favicons table, but the favicon still shows up in the UI.  Is that right?  If that's the case, why would this be a problem for bookmarks?  I'm really puzzled here...", "attachment_id": null, "tags": [], "text": "(In reply to comment #12)\n> (In reply to comment #11)\n> > > What is needed to work as a cache is a bypassing protocol, that hits the\n> > > database and if the icon is not there goes through the network (and eventually\n> > > caches it, if we are not in PB mode). That is bug 573638.\n> > \n> > How hard would doing that be?\n> \n> I never tried, my ideas was to redirect the channel to a network channel, but\n> when I asked someone told me it was hard to do.  Then I had no time to\n> investigate it further.\n> It may be useful for a lot of stuff like aeropeek, jumplists, Panorama and so\n> on. A possible problem though, is that in persistent PB mode, or any other\n> situations where favicons are missing, opening the history sidebar would fire a\n> huge amount of network requests to fetch missing icons. It may be the same for\n> bookmarks sidebar, bookmarks toolbar, or any other Places view with lots of\n> entries.\n\nHmm, this would be less than ideal indeed...\n\nHere's another question: for regular visits, we don't add anything to the favicons table, but the favicon still shows up in the UI.  Is that right?  If that's the case, why would this be a problem for bookmarks?  I'm really puzzled here...", "bug_id": 666782}, {"creator": "mak@mozilla.com", "creation_time": "2011-06-29T21:45:17Z", "time": "2011-06-29T21:45:17Z", "author": "mak@mozilla.com", "is_private": false, "count": 14, "id": 5565640, "text": "(In reply to comment #13)\n> Here's another question: for regular visits, we don't add anything to the\n> favicons table, but the favicon still shows up in the UI.  Is that right? \n> If that's the case, why would this be a problem for bookmarks?  I'm really\n> puzzled here...\n\nYou mean while we are in PB mode?\nif the visit happens to a page that has already a favicon in the db we show the icon, but if you visit a page you never visited before that has no entries, then no, it should show a blank icon since not-bookmarked pages are not allowed to store an icon.\n\nAlso, it depends which part of the UI you mean, tabs for example don't pass through Places... it's sorta complicated and a pass-through protocol may indeed make this simpler. You should look at the history menu or history sidebar to see what Places does.", "bug_id": 666782, "tags": [], "attachment_id": null, "raw_text": "(In reply to comment #13)\n> Here's another question: for regular visits, we don't add anything to the\n> favicons table, but the favicon still shows up in the UI.  Is that right? \n> If that's the case, why would this be a problem for bookmarks?  I'm really\n> puzzled here...\n\nYou mean while we are in PB mode?\nif the visit happens to a page that has already a favicon in the db we show the icon, but if you visit a page you never visited before that has no entries, then no, it should show a blank icon since not-bookmarked pages are not allowed to store an icon.\n\nAlso, it depends which part of the UI you mean, tabs for example don't pass through Places... it's sorta complicated and a pass-through protocol may indeed make this simpler. You should look at the history menu or history sidebar to see what Places does."}, {"is_private": false, "count": 15, "id": 5565828, "creator": "ehsan.akhgari@gmail.com", "creation_time": "2011-06-29T22:59:13Z", "time": "2011-06-29T22:59:13Z", "author": "ehsan.akhgari@gmail.com", "attachment_id": null, "raw_text": "(In reply to comment #14)\n> (In reply to comment #13)\n> > Here's another question: for regular visits, we don't add anything to the\n> > favicons table, but the favicon still shows up in the UI.  Is that right? \n> > If that's the case, why would this be a problem for bookmarks?  I'm really\n> > puzzled here...\n> \n> You mean while we are in PB mode?\n> if the visit happens to a page that has already a favicon in the db we show\n> the icon, but if you visit a page you never visited before that has no\n> entries, then no, it should show a blank icon since not-bookmarked pages are\n> not allowed to store an icon.\n> \n> Also, it depends which part of the UI you mean, tabs for example don't pass\n> through Places... it's sorta complicated and a pass-through protocol may\n> indeed make this simpler. You should look at the history menu or history\n> sidebar to see what Places does.\n\nYes, the tab UI is what I'm worried about.  I'd be fine with us taking the fix here if it breaks the icons in the secondary UI until we have a fix to bug 573638 (although it would also be great if that can be prioritized).", "bug_id": 666782, "text": "(In reply to comment #14)\n> (In reply to comment #13)\n> > Here's another question: for regular visits, we don't add anything to the\n> > favicons table, but the favicon still shows up in the UI.  Is that right? \n> > If that's the case, why would this be a problem for bookmarks?  I'm really\n> > puzzled here...\n> \n> You mean while we are in PB mode?\n> if the visit happens to a page that has already a favicon in the db we show\n> the icon, but if you visit a page you never visited before that has no\n> entries, then no, it should show a blank icon since not-bookmarked pages are\n> not allowed to store an icon.\n> \n> Also, it depends which part of the UI you mean, tabs for example don't pass\n> through Places... it's sorta complicated and a pass-through protocol may\n> indeed make this simpler. You should look at the history menu or history\n> sidebar to see what Places does.\n\nYes, the tab UI is what I'm worried about.  I'd be fine with us taking the fix here if it breaks the icons in the secondary UI until we have a fix to bug 573638 (although it would also be great if that can be prioritized).", "tags": []}, {"is_private": false, "count": 16, "id": 5565864, "author": "mak@mozilla.com", "creator": "mak@mozilla.com", "creation_time": "2011-06-29T23:11:53Z", "time": "2011-06-29T23:11:53Z", "raw_text": "> Yes, the tab UI is what I'm worried about.  I'd be fine with us taking the\n> fix here if it breaks the icons in the secondary UI until we have a fix to\n> bug 573638 (although it would also be great if that can be prioritized).\n\nWell, bookmarks toolbar is not exactly secondary UI (And some user likes to have only icons there for space reasons), and the menu is hard to visually parse without icons. I fear the change will generate more complains than bravo, so we may do it with an ifdef and quickly revert if that happens, even in Aurora or Beta.", "attachment_id": null, "bug_id": 666782, "text": "> Yes, the tab UI is what I'm worried about.  I'd be fine with us taking the\n> fix here if it breaks the icons in the secondary UI until we have a fix to\n> bug 573638 (although it would also be great if that can be prioritized).\n\nWell, bookmarks toolbar is not exactly secondary UI (And some user likes to have only icons there for space reasons), and the menu is hard to visually parse without icons. I fear the change will generate more complains than bravo, so we may do it with an ifdef and quickly revert if that happens, even in Aurora or Beta.", "tags": []}, {"raw_text": "(In reply to comment #16)\n> > Yes, the tab UI is what I'm worried about.  I'd be fine with us taking the\n> > fix here if it breaks the icons in the secondary UI until we have a fix to\n> > bug 573638 (although it would also be great if that can be prioritized).\n> \n> Well, bookmarks toolbar is not exactly secondary UI (And some user likes to\n> have only icons there for space reasons), and the menu is hard to visually\n> parse without icons. I fear the change will generate more complains than bravo,\n> so we may do it with an ifdef and quickly revert if that happens, even in\n> Aurora or Beta.\n\nHere's another idea, can't we store these favicons in a :memory: based database?  This is what we did for the downloads manager.\n\nThis way, the icons won't persist across sessions, but we can load them after a session restart, right?\n\nHere's another crazy idea.  If we could change the New Bookmark dialog to also store the page favicon in the places DB, this bug would be WONTFIX, since that way there is no distinction between visited and unvisited bookmarks based on the existence of a favicon for them.", "attachment_id": null, "tags": [], "bug_id": 666782, "text": "(In reply to comment #16)\n> > Yes, the tab UI is what I'm worried about.  I'd be fine with us taking the\n> > fix here if it breaks the icons in the secondary UI until we have a fix to\n> > bug 573638 (although it would also be great if that can be prioritized).\n> \n> Well, bookmarks toolbar is not exactly secondary UI (And some user likes to\n> have only icons there for space reasons), and the menu is hard to visually\n> parse without icons. I fear the change will generate more complains than bravo,\n> so we may do it with an ifdef and quickly revert if that happens, even in\n> Aurora or Beta.\n\nHere's another idea, can't we store these favicons in a :memory: based database?  This is what we did for the downloads manager.\n\nThis way, the icons won't persist across sessions, but we can load them after a session restart, right?\n\nHere's another crazy idea.  If we could change the New Bookmark dialog to also store the page favicon in the places DB, this bug would be WONTFIX, since that way there is no distinction between visited and unvisited bookmarks based on the existence of a favicon for them.", "id": 5567055, "count": 17, "is_private": false, "author": "ehsan.akhgari@gmail.com", "creation_time": "2011-06-30T14:07:14Z", "time": "2011-06-30T14:07:14Z", "creator": "ehsan.akhgari@gmail.com"}, {"raw_text": "(In reply to comment #17)\n> Here's another idea, can't we store these favicons in a :memory: based\n> database?  This is what we did for the downloads manager.\n> This way, the icons won't persist across sessions, but we can load them\n> after a session restart, right?\n\nThe Places schema is too complicated to do this, I have to think about that, but at first glance it would be a huge amount of work.\nAlso, I don't see how this solves our main problem, that is having all bookmarks with a blank icon. We can't clearly reload all favicons in background on session restart, it would be a much worse privacy hit (like connecting to a public wifi and communicating my bookmarks to the network to fetch their icons).\n\n> Here's another crazy idea.  If we could change the New Bookmark dialog to\n> also store the page favicon in the places DB, this bug would be WONTFIX,\n> since that way there is no distinction between visited and unvisited\n> bookmarks based on the existence of a favicon for them.\n\nThis means when I create a bookmark I generate a visit to the page, again this may be a privacy hit I may not want.\nPlus restoring bookmarks from a backup doesn't restore icons (bug 423126) so again these would stick to a blank icon.", "attachment_id": null, "tags": [], "bug_id": 666782, "text": "(In reply to comment #17)\n> Here's another idea, can't we store these favicons in a :memory: based\n> database?  This is what we did for the downloads manager.\n> This way, the icons won't persist across sessions, but we can load them\n> after a session restart, right?\n\nThe Places schema is too complicated to do this, I have to think about that, but at first glance it would be a huge amount of work.\nAlso, I don't see how this solves our main problem, that is having all bookmarks with a blank icon. We can't clearly reload all favicons in background on session restart, it would be a much worse privacy hit (like connecting to a public wifi and communicating my bookmarks to the network to fetch their icons).\n\n> Here's another crazy idea.  If we could change the New Bookmark dialog to\n> also store the page favicon in the places DB, this bug would be WONTFIX,\n> since that way there is no distinction between visited and unvisited\n> bookmarks based on the existence of a favicon for them.\n\nThis means when I create a bookmark I generate a visit to the page, again this may be a privacy hit I may not want.\nPlus restoring bookmarks from a backup doesn't restore icons (bug 423126) so again these would stick to a blank icon.", "count": 18, "id": 5567089, "is_private": false, "author": "mak@mozilla.com", "time": "2011-06-30T14:31:45Z", "creation_time": "2011-06-30T14:31:45Z", "creator": "mak@mozilla.com"}, {"creator": "ehsan.akhgari@gmail.com", "time": "2011-06-30T15:49:59Z", "creation_time": "2011-06-30T15:49:59Z", "author": "ehsan.akhgari@gmail.com", "is_private": false, "id": 5567240, "count": 19, "tags": [], "bug_id": 666782, "text": "(In reply to comment #18)\n> > Here's another crazy idea.  If we could change the New Bookmark dialog to\n> > also store the page favicon in the places DB, this bug would be WONTFIX,\n> > since that way there is no distinction between visited and unvisited\n> > bookmarks based on the existence of a favicon for them.\n> \n> This means when I create a bookmark I generate a visit to the page\n\nNot necessarily.  The bookmarks created in PB mode don't have a visit entry, but do have a favicon entry, right?\n\n> Plus restoring bookmarks from a backup doesn't restore icons (bug 423126) so\n> again these would stick to a blank icon.\n\nBut isn't that already the case with bookmarks created outside of private browsing mode too?", "attachment_id": null, "raw_text": "(In reply to comment #18)\n> > Here's another crazy idea.  If we could change the New Bookmark dialog to\n> > also store the page favicon in the places DB, this bug would be WONTFIX,\n> > since that way there is no distinction between visited and unvisited\n> > bookmarks based on the existence of a favicon for them.\n> \n> This means when I create a bookmark I generate a visit to the page\n\nNot necessarily.  The bookmarks created in PB mode don't have a visit entry, but do have a favicon entry, right?\n\n> Plus restoring bookmarks from a backup doesn't restore icons (bug 423126) so\n> again these would stick to a blank icon.\n\nBut isn't that already the case with bookmarks created outside of private browsing mode too?"}, {"author": "mak@mozilla.com", "time": "2011-06-30T15:55:16Z", "creation_time": "2011-06-30T15:55:16Z", "creator": "mak@mozilla.com", "id": 5567257, "count": 20, "is_private": false, "text": "(In reply to comment #19)\n> Not necessarily.  The bookmarks created in PB mode don't have a visit entry,\n> but do have a favicon entry, right?\n\nSorry, I meant that creating a bookmark will generate a visit to the server to get the icon, network traffic that I may not want. Fixing a local privacy leak creating a network one doesn't seem sane.\n\n> > Plus restoring bookmarks from a backup doesn't restore icons (bug 423126) so\n> > again these would stick to a blank icon.\n> \n> But isn't that already the case with bookmarks created outside of private\n> browsing mode too?\n\nyes, but then visiting them you get the icon.", "bug_id": 666782, "tags": [], "raw_text": "(In reply to comment #19)\n> Not necessarily.  The bookmarks created in PB mode don't have a visit entry,\n> but do have a favicon entry, right?\n\nSorry, I meant that creating a bookmark will generate a visit to the server to get the icon, network traffic that I may not want. Fixing a local privacy leak creating a network one doesn't seem sane.\n\n> > Plus restoring bookmarks from a backup doesn't restore icons (bug 423126) so\n> > again these would stick to a blank icon.\n> \n> But isn't that already the case with bookmarks created outside of private\n> browsing mode too?\n\nyes, but then visiting them you get the icon.", "attachment_id": null}, {"id": 5567305, "count": 21, "is_private": false, "author": "ehsan.akhgari@gmail.com", "creation_time": "2011-06-30T16:07:20Z", "time": "2011-06-30T16:07:20Z", "creator": "ehsan.akhgari@gmail.com", "raw_text": "(In reply to comment #20)\n> (In reply to comment #19)\n> > Not necessarily.  The bookmarks created in PB mode don't have a visit entry,\n> > but do have a favicon entry, right?\n> \n> Sorry, I meant that creating a bookmark will generate a visit to the server to\n> get the icon, network traffic that I may not want. Fixing a local privacy leak\n> creating a network one doesn't seem sane.\n\nI'm not sure how we're creating a privacy leak by doing that.\n\n> > > Plus restoring bookmarks from a backup doesn't restore icons (bug 423126) so\n> > > again these would stick to a blank icon.\n> > \n> > But isn't that already the case with bookmarks created outside of private\n> > browsing mode too?\n> \n> yes, but then visiting them you get the icon.\n\nI mean, without PB being involved, if you restore bookmarks you'll lose their icons.  With PB mode, the same thing would happen.  So I don't think we need to worry about that here, right?", "attachment_id": null, "bug_id": 666782, "text": "(In reply to comment #20)\n> (In reply to comment #19)\n> > Not necessarily.  The bookmarks created in PB mode don't have a visit entry,\n> > but do have a favicon entry, right?\n> \n> Sorry, I meant that creating a bookmark will generate a visit to the server to\n> get the icon, network traffic that I may not want. Fixing a local privacy leak\n> creating a network one doesn't seem sane.\n\nI'm not sure how we're creating a privacy leak by doing that.\n\n> > > Plus restoring bookmarks from a backup doesn't restore icons (bug 423126) so\n> > > again these would stick to a blank icon.\n> > \n> > But isn't that already the case with bookmarks created outside of private\n> > browsing mode too?\n> \n> yes, but then visiting them you get the icon.\n\nI mean, without PB being involved, if you restore bookmarks you'll lose their icons.  With PB mode, the same thing would happen.  So I don't think we need to worry about that here, right?", "tags": []}, {"tags": [], "bug_id": 666782, "text": "(In reply to comment #21)\n> > Sorry, I meant that creating a bookmark will generate a visit to the server to\n> > get the icon, network traffic that I may not want. Fixing a local privacy leak\n> > creating a network one doesn't seem sane.\n> \n> I'm not sure how we're creating a privacy leak by doing that.\n\nSorry, we are probably misunderstanding each other.\n\nIf I create a bookmark in PB mode, with your suggested fix, Places will have to fetch the page in background and read the favicon from it, then fetch the favicon data. All of this goes through network, but I never asked to visit that page, I asked to make a bookmark locally.\nSo, while the suggestion solves the privacy problem on the computer, by making all bookmarks have an icon regardless, it opens a privacy problem on the network. By creating a bookmark I'm communicating to the network what I'm doing. This is even worse imo, since, while the first issue requires physical access to my computer, this one can be observer by anyone on the network.\n\n> I mean, without PB being involved, if you restore bookmarks you'll lose\n> their icons.  With PB mode, the same thing would happen.  So I don't think\n> we need to worry about that here, right?\n\nyes, but right now when you visit the bookmark you get back an icon regardless being in PB mode or less, fixing this bug you are stuck with the blank document icon if you use persistent PB mode. The problem is just persistent PB mode making all bookmarks views not eye-parse-able.", "author": "mak@mozilla.com", "creation_time": "2011-06-30T20:01:57Z", "time": "2011-06-30T20:01:57Z", "creator": "mak@mozilla.com", "raw_text": "(In reply to comment #21)\n> > Sorry, I meant that creating a bookmark will generate a visit to the server to\n> > get the icon, network traffic that I may not want. Fixing a local privacy leak\n> > creating a network one doesn't seem sane.\n> \n> I'm not sure how we're creating a privacy leak by doing that.\n\nSorry, we are probably misunderstanding each other.\n\nIf I create a bookmark in PB mode, with your suggested fix, Places will have to fetch the page in background and read the favicon from it, then fetch the favicon data. All of this goes through network, but I never asked to visit that page, I asked to make a bookmark locally.\nSo, while the suggestion solves the privacy problem on the computer, by making all bookmarks have an icon regardless, it opens a privacy problem on the network. By creating a bookmark I'm communicating to the network what I'm doing. This is even worse imo, since, while the first issue requires physical access to my computer, this one can be observer by anyone on the network.\n\n> I mean, without PB being involved, if you restore bookmarks you'll lose\n> their icons.  With PB mode, the same thing would happen.  So I don't think\n> we need to worry about that here, right?\n\nyes, but right now when you visit the bookmark you get back an icon regardless being in PB mode or less, fixing this bug you are stuck with the blank document icon if you use persistent PB mode. The problem is just persistent PB mode making all bookmarks views not eye-parse-able.", "id": 5567988, "count": 22, "attachment_id": null, "is_private": false}, {"author": "colinwg@wtixfm.com", "creator": "colinwg@wtixfm.com", "creation_time": "2011-07-01T01:28:26Z", "time": "2011-07-01T01:28:26Z", "is_private": false, "id": 5568726, "count": 23, "tags": [], "text": "Option to right click a bookmark, either in PB or normal mode:\n\nIn PB mode, offer to store the favicon, or set flag to never store it, default is to not fetch it if user does nothing.\n\nIn normal mode, offer to never store it, default is to store it.\n\nSet favicon field in database to -1 to indicate to never store favicon.", "bug_id": 666782, "raw_text": "Option to right click a bookmark, either in PB or normal mode:\n\nIn PB mode, offer to store the favicon, or set flag to never store it, default is to not fetch it if user does nothing.\n\nIn normal mode, offer to never store it, default is to store it.\n\nSet favicon field in database to -1 to indicate to never store favicon.", "attachment_id": null}, {"time": "2011-07-01T09:19:14Z", "creation_time": "2011-07-01T09:19:14Z", "creator": "mak@mozilla.com", "author": "mak@mozilla.com", "id": 5569146, "count": 24, "is_private": false, "bug_id": 666782, "text": "Sorry, but adding more options is 99% of the times the wrong solution to problems, we would just be move the problem from being ours to be a user's problem, that is not the way to go.", "tags": [], "attachment_id": null, "raw_text": "Sorry, but adding more options is 99% of the times the wrong solution to problems, we would just be move the problem from being ours to be a user's problem, that is not the way to go."}, {"count": 25, "id": 5751984, "is_private": false, "time": "2011-10-01T17:38:23Z", "creation_time": "2011-10-01T17:38:23Z", "creator": "colinwg@wtixfm.com", "author": "colinwg@wtixfm.com", "attachment_id": null, "raw_text": "Still present up in Firefox 7.", "text": "Still present up in Firefox 7.", "bug_id": 666782, "tags": []}, {"is_private": false, "id": 5811225, "count": 26, "creator": "mak@mozilla.com", "creation_time": "2011-10-28T13:50:09Z", "time": "2011-10-28T13:50:09Z", "author": "mak@mozilla.com", "attachment_id": null, "raw_text": "off my plate for now, feel free to take this bug if you wish.", "tags": [], "text": "off my plate for now, feel free to take this bug if you wish.", "bug_id": 666782}, {"tags": [], "bug_id": 666782, "text": "Still present in FF8.\n\nCan we get a \"Remove icon\" selection on right click in the bookmarks that sets the favicon_id to -1?", "attachment_id": null, "raw_text": "Still present in FF8.\n\nCan we get a \"Remove icon\" selection on right click in the bookmarks that sets the favicon_id to -1?", "time": "2011-11-11T21:24:48Z", "creation_time": "2011-11-11T21:24:48Z", "creator": "colinwg@wtixfm.com", "author": "colinwg@wtixfm.com", "count": 27, "id": 5843620, "is_private": false}, {"creator": "sworddragon2@gmail.com", "time": "2019-04-25T11:56:01Z", "creation_time": "2019-04-25T11:56:01Z", "author": "sworddragon2@gmail.com", "is_private": false, "count": 28, "id": 14077059, "text": "In Firefox 66.0.3 I'm still seeing this issue in permanent private browsing mode. For example importing an existing places.sqlite into a new profile and clicking any of the bookmarks will result to store a favicon once Firefox gets closed.\n\nI did read the above evaluation that the leak which bookmarks got visited might be only a minor issue but personally I think the difference to give out the information on which sites I have bookmarked (and thus potentially like) compared to the information which of those sites I did visit during the current profile is still significant. Also private browsing mode is being exposed to not store the cache at all - thus an user would now not expect the cache to still work for some parts. \n\nAs a workaround I currently change the setting browser.chrome.site_icons to false to prevent the favicons being stored at all.\n\n\n@Marco: I would also guess on your evaluation 8 years ago (that this issue is just a minor privacy impact) you were not a permanent private browsing user and had not a super strong focus on privacy - but I might be wrong. Maybe in this case it is more hard to evaluate what the best option would be - or my privacy focus is just much more stronger than of the most other privacy-focused people. But to make it more objective do we actually know somehow what users would prefer at default for (permanent) private browsing mode (like telemetry data or something similar)?", "bug_id": 666782, "tags": [], "attachment_id": null, "raw_text": "In Firefox 66.0.3 I'm still seeing this issue in permanent private browsing mode. For example importing an existing places.sqlite into a new profile and clicking any of the bookmarks will result to store a favicon once Firefox gets closed.\n\nI did read the above evaluation that the leak which bookmarks got visited might be only a minor issue but personally I think the difference to give out the information on which sites I have bookmarked (and thus potentially like) compared to the information which of those sites I did visit during the current profile is still significant. Also private browsing mode is being exposed to not store the cache at all - thus an user would now not expect the cache to still work for some parts. \n\nAs a workaround I currently change the setting browser.chrome.site_icons to false to prevent the favicons being stored at all.\n\n\n@Marco: I would also guess on your evaluation 8 years ago (that this issue is just a minor privacy impact) you were not a permanent private browsing user and had not a super strong focus on privacy - but I might be wrong. Maybe in this case it is more hard to evaluate what the best option would be - or my privacy focus is just much more stronger than of the most other privacy-focused people. But to make it more objective do we actually know somehow what users would prefer at default for (permanent) private browsing mode (like telemetry data or something similar)?"}, {"raw_text": "(In reply to sworddragon2 from comment #28)\n> In Firefox 66.0.3 I'm still seeing this issue in permanent private browsing mode. For example importing an existing places.sqlite into a new profile and clicking any of the bookmarks will result to store a favicon once Firefox gets closed.\n\nYes, this bug is still open, so I don't expect things to have changed.\n\n> I did read the above evaluation that the leak which bookmarks got visited might be only a minor issue but personally I think the difference to give out the information on which sites I have bookmarked (and thus potentially like) compared to the information which of those sites I did visit during the current profile is still significant.\n\nWhat we are leaking is that you have visited some of your bookmarks. Because they are bookmarks, as an observer I expect you to have visited them sooner or later, otherwise you wouldn't have stored them.\nOn the other side not storing favicons for bookmarks, means all the bookmarks will be without an icon, hard to recognize at fist sight. And fetching icons in background exposes the user to a worse privacy leak.\n\n> As a workaround I currently change the setting browser.chrome.site_icons to false to prevent the favicons being stored at all.\n\nthat's a valid workaround if you feel strongly about this problem, why is it not enough for you?\n\n> @Marco: I would also guess on your evaluation 8 years ago (that this issue is just a minor privacy impact) you were not a permanent private browsing user and had not a super strong focus on privacy - but I might be wrong.\n\nI focus on privacy, as most Mozilla contributors, the problem here is that the cure seems worst than the illness and nobody suggested a plausible solution yet, that addresses both the privacy and the discoverability of bookmarks problems.\n\n> But to make it more objective do we actually know somehow what users would prefer at default for (permanent) private browsing mode (like telemetry data or something similar)?\n\nNo, and I don't think telemetry can tell us whether users prefer to have favicons or not (what would we measure?), as well as a user study, because this affects a tiny subset of users.", "attachment_id": null, "text": "(In reply to sworddragon2 from comment #28)\n> In Firefox 66.0.3 I'm still seeing this issue in permanent private browsing mode. For example importing an existing places.sqlite into a new profile and clicking any of the bookmarks will result to store a favicon once Firefox gets closed.\n\nYes, this bug is still open, so I don't expect things to have changed.\n\n> I did read the above evaluation that the leak which bookmarks got visited might be only a minor issue but personally I think the difference to give out the information on which sites I have bookmarked (and thus potentially like) compared to the information which of those sites I did visit during the current profile is still significant.\n\nWhat we are leaking is that you have visited some of your bookmarks. Because they are bookmarks, as an observer I expect you to have visited them sooner or later, otherwise you wouldn't have stored them.\nOn the other side not storing favicons for bookmarks, means all the bookmarks will be without an icon, hard to recognize at fist sight. And fetching icons in background exposes the user to a worse privacy leak.\n\n> As a workaround I currently change the setting browser.chrome.site_icons to false to prevent the favicons being stored at all.\n\nthat's a valid workaround if you feel strongly about this problem, why is it not enough for you?\n\n> @Marco: I would also guess on your evaluation 8 years ago (that this issue is just a minor privacy impact) you were not a permanent private browsing user and had not a super strong focus on privacy - but I might be wrong.\n\nI focus on privacy, as most Mozilla contributors, the problem here is that the cure seems worst than the illness and nobody suggested a plausible solution yet, that addresses both the privacy and the discoverability of bookmarks problems.\n\n> But to make it more objective do we actually know somehow what users would prefer at default for (permanent) private browsing mode (like telemetry data or something similar)?\n\nNo, and I don't think telemetry can tell us whether users prefer to have favicons or not (what would we measure?), as well as a user study, because this affects a tiny subset of users.", "bug_id": 666782, "tags": [], "is_private": false, "id": 14091403, "count": 29, "author": "mak@mozilla.com", "creator": "mak@mozilla.com", "creation_time": "2019-05-02T12:14:58Z", "time": "2019-05-02T12:14:58Z"}, {"attachment_id": null, "raw_text": "(In reply to Marco Bonardo [::mak] (Away 22 -28 Apr) from comment #29)\n> On the other side not storing favicons for bookmarks, means all the bookmarks will be without an icon, hard to recognize at fist sight. And fetching icons in background exposes the user to a worse privacy leak.\n\nI also would not like the favicons getting fetched via the network on every startup. But personally I have no issue with bookmarks having no favicons so I'm curious what other users using private browsing mode often would think about this.\n\n\n(In reply to Marco Bonardo [::mak] (Away 22 -28 Apr) from comment #29)\n> (In reply to sworddragon2 from comment #28)\n> > As a workaround I currently change the setting browser.chrome.site_icons to false to prevent the favicons being stored at all.\n> \n> that's a valid workaround if you feel strongly about this problem, why is it not enough for you?\n\nBecause it should be desired that somebody opting into privacy (by using (permanent) private browsing mode) ideally they would have to apply the least workarounds as possible to achieve this goal as good as possible. Also this involves mistakes since anybody can easily forget to update such flags when configuring a new profile. In my case I would now have to wipe all free space of my HDD after deleting the favicons.sqlite to restore the initial privacy (might be even much harder on a SSD). And even then I'm not sure if the places.sqlite still leaks some ID-reference or if Firefox noticed: On startup missing favicons.sqlite AND private browsing mode enabled { Normalize all favicon references in places.sqlite }. Maybe Firefox does something like this already - but somehow I doubt it resulting in even more work.\n\n\n(In reply to Marco Bonardo [::mak] (Away 22 -28 Apr) from comment #29)\n> I focus on privacy, as most Mozilla contributors, the problem here is that the cure seems worst than the illness and nobody suggested a plausible solution yet, that addresses both the privacy and the discoverability of bookmarks problems.\n\nWe could dupe browser.chrome.site_icons into a private browsing variant (as done with several other options already) and defaulting it to false.", "bug_id": 666782, "text": "(In reply to Marco Bonardo [::mak] (Away 22 -28 Apr) from comment #29)\n> On the other side not storing favicons for bookmarks, means all the bookmarks will be without an icon, hard to recognize at fist sight. And fetching icons in background exposes the user to a worse privacy leak.\n\nI also would not like the favicons getting fetched via the network on every startup. But personally I have no issue with bookmarks having no favicons so I'm curious what other users using private browsing mode often would think about this.\n\n\n(In reply to Marco Bonardo [::mak] (Away 22 -28 Apr) from comment #29)\n> (In reply to sworddragon2 from comment #28)\n> > As a workaround I currently change the setting browser.chrome.site_icons to false to prevent the favicons being stored at all.\n> \n> that's a valid workaround if you feel strongly about this problem, why is it not enough for you?\n\nBecause it should be desired that somebody opting into privacy (by using (permanent) private browsing mode) ideally they would have to apply the least workarounds as possible to achieve this goal as good as possible. Also this involves mistakes since anybody can easily forget to update such flags when configuring a new profile. In my case I would now have to wipe all free space of my HDD after deleting the favicons.sqlite to restore the initial privacy (might be even much harder on a SSD). And even then I'm not sure if the places.sqlite still leaks some ID-reference or if Firefox noticed: On startup missing favicons.sqlite AND private browsing mode enabled { Normalize all favicon references in places.sqlite }. Maybe Firefox does something like this already - but somehow I doubt it resulting in even more work.\n\n\n(In reply to Marco Bonardo [::mak] (Away 22 -28 Apr) from comment #29)\n> I focus on privacy, as most Mozilla contributors, the problem here is that the cure seems worst than the illness and nobody suggested a plausible solution yet, that addresses both the privacy and the discoverability of bookmarks problems.\n\nWe could dupe browser.chrome.site_icons into a private browsing variant (as done with several other options already) and defaulting it to false.", "tags": [], "count": 30, "id": 14091566, "is_private": false, "creation_time": "2019-05-02T13:45:37Z", "time": "2019-05-02T13:45:37Z", "creator": "sworddragon2@gmail.com", "author": "sworddragon2@gmail.com"}, {"attachment_id": null, "raw_text": "(In reply to sworddragon2 from comment #30)\n> We could dupe browser.chrome.site_icons into a private browsing variant (as done with several other options already) and defaulting it to false.\n\nHow does this solve being left with icon-less bookmarks? it's a good solution for you, but we don't know if it's a good solution for the other users (and I suspect not, for example we also have a subset of users who only want to see the favicon of bookmarks and no labels at all, plus some users may be used to use peripheral view to recognize bookmarks by icon color even before aiming at a label, and so on).", "tags": [], "text": "(In reply to sworddragon2 from comment #30)\n> We could dupe browser.chrome.site_icons into a private browsing variant (as done with several other options already) and defaulting it to false.\n\nHow does this solve being left with icon-less bookmarks? it's a good solution for you, but we don't know if it's a good solution for the other users (and I suspect not, for example we also have a subset of users who only want to see the favicon of bookmarks and no labels at all, plus some users may be used to use peripheral view to recognize bookmarks by icon color even before aiming at a label, and so on).", "bug_id": 666782, "is_private": false, "count": 31, "id": 14091589, "creator": "mak@mozilla.com", "creation_time": "2019-05-02T13:55:47Z", "time": "2019-05-02T13:55:47Z", "author": "mak@mozilla.com"}, {"attachment_id": null, "raw_text": "(In reply to Marco Bonardo [::mak] from comment #31)\n> (In reply to sworddragon2 from comment #30)\n> > We could dupe browser.chrome.site_icons into a private browsing variant (as done with several other options already) and defaulting it to false.\n> \n> How does this solve being left with icon-less bookmarks?\n\nUsers now have the possibility to opt-in. And since they would not expect any cache to work in private browsing mode at default the (mostly one-time via googling, asking somebody, etc.) usability impact from setting browser.chrome.site_icons.pbmode is barely existent. Especially if you consider that enabling private browsing mode has other big usability impacts that are not even limited to being one-time - they are always present[1][2].\n\n\n[1]The password manager is not able to store credentials anymore. I see the rational that the password manager is here not privacy-friendly as it always exposes all the websites due to the need triggering the popup for the master password once it finds a matching formular (however, I'm thinking for a while that this needs to be changed as part of a generic overhaul of the password manager). But saving a credential is a very explicit process as it is for storing bookmarks so I was always curious why we do allow to store bookmarks but not credentials.\n\n[2]Any site settings are erased after a browser restart - a very expected behavior but still a technical usability impact. And today you have to configure more and more things per website. And with things like bug #1526949 this gets much more annoying than missing favicons (which you just could easily opt-in with a duplicated option). And it is still unclear in bug #1526949 if this behavior should be actually a default for e10s once all tabs of a domain have been unloaded - which would impact usability even drastically more.", "tags": [], "bug_id": 666782, "text": "(In reply to Marco Bonardo [::mak] from comment #31)\n> (In reply to sworddragon2 from comment #30)\n> > We could dupe browser.chrome.site_icons into a private browsing variant (as done with several other options already) and defaulting it to false.\n> \n> How does this solve being left with icon-less bookmarks?\n\nUsers now have the possibility to opt-in. And since they would not expect any cache to work in private browsing mode at default the (mostly one-time via googling, asking somebody, etc.) usability impact from setting browser.chrome.site_icons.pbmode is barely existent. Especially if you consider that enabling private browsing mode has other big usability impacts that are not even limited to being one-time - they are always present[1][2].\n\n\n[1]The password manager is not able to store credentials anymore. I see the rational that the password manager is here not privacy-friendly as it always exposes all the websites due to the need triggering the popup for the master password once it finds a matching formular (however, I'm thinking for a while that this needs to be changed as part of a generic overhaul of the password manager). But saving a credential is a very explicit process as it is for storing bookmarks so I was always curious why we do allow to store bookmarks but not credentials.\n\n[2]Any site settings are erased after a browser restart - a very expected behavior but still a technical usability impact. And today you have to configure more and more things per website. And with things like bug #1526949 this gets much more annoying than missing favicons (which you just could easily opt-in with a duplicated option). And it is still unclear in bug #1526949 if this behavior should be actually a default for e10s once all tabs of a domain have been unloaded - which would impact usability even drastically more.", "is_private": false, "id": 14094080, "count": 32, "creator": "sworddragon2@gmail.com", "time": "2019-05-03T16:40:48Z", "creation_time": "2019-05-03T16:40:48Z", "author": "sworddragon2@gmail.com"}, {"count": 33, "id": 14458390, "is_private": false, "author": "gingerbread_man@live.com", "time": "2019-10-31T01:23:03Z", "creation_time": "2019-10-31T01:23:03Z", "creator": "gingerbread_man@live.com", "raw_text": "", "attachment_id": null, "tags": [], "bug_id": 666782, "text": "*** Bug 1592824 has been marked as a duplicate of this bug. ***"}, {"count": 34, "id": 15571098, "is_private": false, "time": "2021-09-15T16:18:28Z", "creation_time": "2021-09-15T16:18:28Z", "creator": "sworddragon2@gmail.com", "author": "sworddragon2@gmail.com", "attachment_id": null, "raw_text": "(In reply to Marco Bonardo [:mak] (away 11-14 Sep) from comment #29)\n> > As a workaround I currently change the setting browser.chrome.site_icons to false to prevent the favicons being stored at all.\n> \n> that's a valid workaround if you feel strongly about this problem, why is it not enough for you?\n\nI just noticed today (or simply forgot over the years) that this workaround also prevents displaying favicons in tabs - while I would now prefer having them. But it is not a too big deal for me to still go without them them since I usually have not too many tabs open and they are mostly sorted so I have no issue navigating them. But users that want favicons in tabs but also want to avoid storing them on their storage via bookmarks have an issue here if they do not want to migrate to some external bookmark managing.\n\nAdditionally this hopefully prevents me forgetting about this again now. But it also gave me an opportunity to read the complete ticket again and trying to find another solution and I got some idea:\n\nIt was mentioned in this ticket to store the favicons for bookmarks directly in the places.sqlite and this is probably a good idea as part of a solution for this problem. This would eliminate the issue that users doing a backup/recovery via copy/pasting the places.sqlite having no favicons anymore if we should go for not storing new favicons anymore in private browsing mode. So far as I see this leaves 2 remaining problems which I think can all be solved if the compromises are ok:\n\n- Favicons for bookarks are becomming outdated over time and they would not update anymore. But so do the titles and other data for bookmarks and this matches Firefox's standards and it was never a problem (I remember vaguely a past attempt from me getting this changed but the interest wasn't really high). From my experience this is also not much of a huge deal and also does not lock from updating all bookmarks once in a while if desired. So this issue is probably barely relevant here.\n\n- As mentioned much earlier manually creating a bookmark would not have a favicon then. But how many users are actually doing this by manually entering all required information up to the correct site? This is probably a minority and chances are they are more experienced than the average user - which both things mitigate this issue. The remaining threat here can then be solved by going back to my previous idea: Creating a private browsing variant of browser.chrome.site_icons which defaults to not storing favicons. If this minor subset of users or others want to still enable storing favicons in private browsing mode they could change the flag.\n\nHowever, this would still leave the issue that favicons in tabs are not being displayed then. But since the threat is the actual storing of favicons the private browsing variant of that option could only affect those contexts.\n\n\nI guess a general issue could also be that this could be quite some effort for eventual low gains - but it would make private browsing out of the box better. Besides that, are there any other issues with that solution or will some stuff not work as well as I think?", "text": "(In reply to Marco Bonardo [:mak] (away 11-14 Sep) from comment #29)\n> > As a workaround I currently change the setting browser.chrome.site_icons to false to prevent the favicons being stored at all.\n> \n> that's a valid workaround if you feel strongly about this problem, why is it not enough for you?\n\nI just noticed today (or simply forgot over the years) that this workaround also prevents displaying favicons in tabs - while I would now prefer having them. But it is not a too big deal for me to still go without them them since I usually have not too many tabs open and they are mostly sorted so I have no issue navigating them. But users that want favicons in tabs but also want to avoid storing them on their storage via bookmarks have an issue here if they do not want to migrate to some external bookmark managing.\n\nAdditionally this hopefully prevents me forgetting about this again now. But it also gave me an opportunity to read the complete ticket again and trying to find another solution and I got some idea:\n\nIt was mentioned in this ticket to store the favicons for bookmarks directly in the places.sqlite and this is probably a good idea as part of a solution for this problem. This would eliminate the issue that users doing a backup/recovery via copy/pasting the places.sqlite having no favicons anymore if we should go for not storing new favicons anymore in private browsing mode. So far as I see this leaves 2 remaining problems which I think can all be solved if the compromises are ok:\n\n- Favicons for bookarks are becomming outdated over time and they would not update anymore. But so do the titles and other data for bookmarks and this matches Firefox's standards and it was never a problem (I remember vaguely a past attempt from me getting this changed but the interest wasn't really high). From my experience this is also not much of a huge deal and also does not lock from updating all bookmarks once in a while if desired. So this issue is probably barely relevant here.\n\n- As mentioned much earlier manually creating a bookmark would not have a favicon then. But how many users are actually doing this by manually entering all required information up to the correct site? This is probably a minority and chances are they are more experienced than the average user - which both things mitigate this issue. The remaining threat here can then be solved by going back to my previous idea: Creating a private browsing variant of browser.chrome.site_icons which defaults to not storing favicons. If this minor subset of users or others want to still enable storing favicons in private browsing mode they could change the flag.\n\nHowever, this would still leave the issue that favicons in tabs are not being displayed then. But since the threat is the actual storing of favicons the private browsing variant of that option could only affect those contexts.\n\n\nI guess a general issue could also be that this could be quite some effort for eventual low gains - but it would make private browsing out of the box better. Besides that, are there any other issues with that solution or will some stuff not work as well as I think?", "bug_id": 666782, "tags": []}, {"attachment_id": null, "raw_text": "(In reply to sworddragon2 from comment #34)\n> It was mentioned in this ticket to store the favicons for bookmarks directly in the places.sqlite and this is probably a good idea as part of a solution for this problem.\n\nThat's not feasible due to technical limitations, having binary blobs in places.sqlite would affect its performance and largely increase fragmentation of the file. We split out favicons some time ago for this reason. Copying 2 files is not much more difficult than copying one.\n\nI don't have an answer related to keeping tabs icons but not bookmarks icons, most people either want or don't want icons globally. UserChrome.css can be used for the other cases I guess.", "bug_id": 666782, "text": "(In reply to sworddragon2 from comment #34)\n> It was mentioned in this ticket to store the favicons for bookmarks directly in the places.sqlite and this is probably a good idea as part of a solution for this problem.\n\nThat's not feasible due to technical limitations, having binary blobs in places.sqlite would affect its performance and largely increase fragmentation of the file. We split out favicons some time ago for this reason. Copying 2 files is not much more difficult than copying one.\n\nI don't have an answer related to keeping tabs icons but not bookmarks icons, most people either want or don't want icons globally. UserChrome.css can be used for the other cases I guess.", "tags": [], "is_private": false, "count": 35, "id": 15572216, "creator": "mak@mozilla.com", "time": "2021-09-16T13:21:10Z", "creation_time": "2021-09-16T13:21:10Z", "author": "mak@mozilla.com"}]}}}