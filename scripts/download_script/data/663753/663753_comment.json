{"bugs": {"663753": {"comments": [{"id": 5528228, "raw_text": "User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: Mozilla/5.0 (Windows NT 5.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\n\nHTML file used : The head section of the html document contains a javascript which catches the onunload event and displays a popup with alert(). It is followed by a Content-Type meta tag specifying the use of iso-8859-1. The body section contains at least one character from the above part of the charset (code is > 0x80).\nBehavior : the onunload event is fired (the popup displays) during the page loading, it should not.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. create a new tab in Firefox (Ctrl+T)\n2. enter http://v4.calnatation.fr/onunload_on_load.html in the address bar\n3. close the tab by clicking on the cross icon\n\nActual Results:  \nThe popup saying \"onUnload fires !\" displays immediately.\nThe popup displays a second time when the page is unloaded, by closing the tab, or by clicking on the link to about:blank which is provided in this page.\n\nExpected Results:  \nThe popup should not display at the first time, but only at the second time when the page is unloaded.\n\n\nSource code of the page \"onunload_on_load.html\" used to reproduce this bug.\nPlease note that the bug does not appear when one of the following condition is met :\n- the meta tag is placed before the javascript\n- no exotic character (>0x80) from the charset is used\n- the javascript code is shorter (less than 1k byte ?)\n-------------------------------------------------------\n<html>\n<head>\n\t<title>TEST</title>\n\n\t<script type=\"text/javascript\">\n// The javascript code should be a little big\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n\n\tfunction WarnUser(){\n\t\talert(\"onUnload fires !\");\n\t}\n\tonunload = WarnUser;\n\t</script>\n\n\t<!-- Declare Content-Type with the latin-1 charset  -->\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\n</head>\n\n<body>\n\n\tThe body contains a character from the above part of the iso-8859-1 charset (here, the french e-acute 0xE9 is used) : \u00e9\n\t\n\t<br>\n\tDummy link to unload the page : <a href=\"about:blank\">[about:blank]</a>\n\n</body>\n</html>", "attachment_id": null, "text": "User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: Mozilla/5.0 (Windows NT 5.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\n\nHTML file used : The head section of the html document contains a javascript which catches the onunload event and displays a popup with alert(). It is followed by a Content-Type meta tag specifying the use of iso-8859-1. The body section contains at least one character from the above part of the charset (code is > 0x80).\nBehavior : the onunload event is fired (the popup displays) during the page loading, it should not.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. create a new tab in Firefox (Ctrl+T)\n2. enter http://v4.calnatation.fr/onunload_on_load.html in the address bar\n3. close the tab by clicking on the cross icon\n\nActual Results:  \nThe popup saying \"onUnload fires !\" displays immediately.\nThe popup displays a second time when the page is unloaded, by closing the tab, or by clicking on the link to about:blank which is provided in this page.\n\nExpected Results:  \nThe popup should not display at the first time, but only at the second time when the page is unloaded.\n\n\nSource code of the page \"onunload_on_load.html\" used to reproduce this bug.\nPlease note that the bug does not appear when one of the following condition is met :\n- the meta tag is placed before the javascript\n- no exotic character (>0x80) from the charset is used\n- the javascript code is shorter (less than 1k byte ?)\n-------------------------------------------------------\n<html>\n<head>\n\t<title>TEST</title>\n\n\t<script type=\"text/javascript\">\n// The javascript code should be a little big\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n// abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz\n\n\tfunction WarnUser(){\n\t\talert(\"onUnload fires !\");\n\t}\n\tonunload = WarnUser;\n\t</script>\n\n\t<!-- Declare Content-Type with the latin-1 charset  -->\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\n</head>\n\n<body>\n\n\tThe body contains a character from the above part of the iso-8859-1 charset (here, the french e-acute 0xE9 is used) : \u00e9\n\t\n\t<br>\n\tDummy link to unload the page : <a href=\"about:blank\">[about:blank]</a>\n\n</body>\n</html>", "time": "2011-06-13T06:17:29Z", "tags": [], "creation_time": "2011-06-13T06:17:29Z", "author": "serge45@free.fr", "is_private": false, "creator": "serge45@free.fr", "bug_id": 663753, "count": 0}, {"attachment_id": null, "raw_text": "You're seeing a charset change reload due to a <meta> tag that comes too late in the buffer (in particular, after the HTML5 prescan limit, so the script has run, then the <meta> is seen, the charset changes, and the document has to be reloaded with the new charset).\n\nSo I believe this is invalid.\n\nNote that the markup is _definitely_ invalid per spec: that <meta> tag is only allowed as the first child of <head>.", "id": 5528925, "creator": "bzbarsky@mit.edu", "is_private": false, "author": "bzbarsky@mit.edu", "creation_time": "2011-06-13T16:27:02Z", "tags": [], "time": "2011-06-13T16:27:02Z", "text": "You're seeing a charset change reload due to a <meta> tag that comes too late in the buffer (in particular, after the HTML5 prescan limit, so the script has run, then the <meta> is seen, the charset changes, and the document has to be reloaded with the new charset).\n\nSo I believe this is invalid.\n\nNote that the markup is _definitely_ invalid per spec: that <meta> tag is only allowed as the first child of <head>.", "count": 1, "bug_id": 663753}, {"bug_id": 663753, "count": 2, "id": 5529581, "attachment_id": null, "raw_text": "I agree on the fact that the meta should definitively be placed earlier in the head. But please consider that :\n- there are probably a lot of web pages with this kind of late charset change\n- the demo html source is an abstract of the real html generated by one of my website powered by Joomla (onunload event used when in edit mode)\n- I had no problem with the previous versions of Firefox (3.x)\n- the HTML 4.01 specification says in 5.2.2 (http://www.w3.org/TR/html4/charset.html#spec-char-encoding) that \"META declarations should appear as early as possible in the HEAD element\", that's less strict than \"first child\"\n- the html source passes successfully the http://validator.w3.org, when adding HTML4.01 doctype and other mandatory stuff (this completed version is in http://v4.calnatation.fr/onunload_on_load_v2.html)", "author": "serge45@free.fr", "creation_time": "2011-06-13T20:08:31Z", "tags": [], "time": "2011-06-13T20:08:31Z", "text": "I agree on the fact that the meta should definitively be placed earlier in the head. But please consider that :\n- there are probably a lot of web pages with this kind of late charset change\n- the demo html source is an abstract of the real html generated by one of my website powered by Joomla (onunload event used when in edit mode)\n- I had no problem with the previous versions of Firefox (3.x)\n- the HTML 4.01 specification says in 5.2.2 (http://www.w3.org/TR/html4/charset.html#spec-char-encoding) that \"META declarations should appear as early as possible in the HEAD element\", that's less strict than \"first child\"\n- the html source passes successfully the http://validator.w3.org, when adding HTML4.01 doctype and other mandatory stuff (this completed version is in http://v4.calnatation.fr/onunload_on_load_v2.html)", "creator": "serge45@free.fr", "is_private": false}, {"id": 5530098, "raw_text": "> - there are probably a lot of web pages with this kind of late charset change\n\nThere are some, sure.\n\n> - I had no problem with the previous versions of Firefox (3.x)\n\nThe size of the meta prescan buffer has changed, yes.  The new buffer size is the one required by the HTML5 specification.\n\n> the HTML 4.01 specification says\n\nThat's been superseded by HTML5.", "attachment_id": null, "time": "2011-06-13T22:55:41Z", "tags": [], "bug_id": 663753, "text": "> - there are probably a lot of web pages with this kind of late charset change\n\nThere are some, sure.\n\n> - I had no problem with the previous versions of Firefox (3.x)\n\nThe size of the meta prescan buffer has changed, yes.  The new buffer size is the one required by the HTML5 specification.\n\n> the HTML 4.01 specification says\n\nThat's been superseded by HTML5.", "author": "bzbarsky@mit.edu", "creation_time": "2011-06-13T22:55:41Z", "count": 3, "creator": "bzbarsky@mit.edu", "is_private": false}, {"raw_text": "Bulk-downgrade of unassigned, >=5 years untouched DOM/Storage bugs' priority.\n\nIf you have reason to believe this is wrong (especially for the severity), please write a comment and ni :jstutte.", "attachment_id": null, "id": 15178129, "count": 4, "is_private": false, "creator": "jstutte@mozilla.com", "text": "Bulk-downgrade of unassigned, >=5 years untouched DOM/Storage bugs' priority.\n\nIf you have reason to believe this is wrong (especially for the severity), please write a comment and ni :jstutte.", "bug_id": 663753, "time": "2020-12-16T11:07:29Z", "tags": [], "creation_time": "2020-12-16T11:07:29Z", "author": "jstutte@mozilla.com"}]}}, "comments": {}}