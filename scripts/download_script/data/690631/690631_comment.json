{"bugs": {"690631": {"comments": [{"count": 0, "is_private": false, "tags": [], "id": 5748464, "bug_id": 690631, "raw_text": "Our command controllers should be refactored to be more modular so that extensions can override them more easily (or add all-new commands). The Add-on Manager does this[1]; here's a trimmed version of the code:\n\nvar gViewController = {\n  commands: {\n    cmd_back: {\n      isEnabled: function() {\n        return gHistory.canGoBack;\n      },\n      doCommand: function() {\n        gHistory.back();\n      }\n    },\n  },\n\n  supportsCommand: function(aCommand) {\n    return (aCommand in this.commands);\n  },\n\n  isCommandEnabled: function(aCommand) {\n    if (!this.supportsCommand(aCommand))\n      return false;\n    var addon = this.currentViewObj.getSelectedAddon();\n    return this.commands[aCommand].isEnabled(addon);\n  },\n\n  doCommand: function(aCommand, aAddon) {\n    if (!this.supportsCommand(aCommand))\n      return;\n    var cmd = this.commands[aCommand];\n    if (!aAddon)\n      aAddon = this.currentViewObj.getSelectedAddon();\n    if (!cmd.isEnabled(aAddon))\n      return;\n    cmd.doCommand(aAddon);\n  },\n};\n\n[1]  http://mxr.mozilla.org/comm-central/source/mozilla/toolkit/mozapps/extensions/content/extensions.js#512", "creation_time": "2011-09-30T02:00:40Z", "text": "Our command controllers should be refactored to be more modular so that extensions can override them more easily (or add all-new commands). The Add-on Manager does this[1]; here's a trimmed version of the code:\n\nvar gViewController = {\n  commands: {\n    cmd_back: {\n      isEnabled: function() {\n        return gHistory.canGoBack;\n      },\n      doCommand: function() {\n        gHistory.back();\n      }\n    },\n  },\n\n  supportsCommand: function(aCommand) {\n    return (aCommand in this.commands);\n  },\n\n  isCommandEnabled: function(aCommand) {\n    if (!this.supportsCommand(aCommand))\n      return false;\n    var addon = this.currentViewObj.getSelectedAddon();\n    return this.commands[aCommand].isEnabled(addon);\n  },\n\n  doCommand: function(aCommand, aAddon) {\n    if (!this.supportsCommand(aCommand))\n      return;\n    var cmd = this.commands[aCommand];\n    if (!aAddon)\n      aAddon = this.currentViewObj.getSelectedAddon();\n    if (!cmd.isEnabled(aAddon))\n      return;\n    cmd.doCommand(aAddon);\n  },\n};\n\n[1]  http://mxr.mozilla.org/comm-central/source/mozilla/toolkit/mozapps/extensions/content/extensions.js#512", "time": "2011-09-30T02:00:40Z", "attachment_id": null, "creator": "jporterbugs@gmail.com", "author": "jporterbugs@gmail.com"}, {"creator": "philip.chee@gmail.com", "author": "philip.chee@gmail.com", "text": "Can't extensions just use  insertControllerAt()\nhttp://mxr.mozilla.org/comm-central/source/mozilla/content/xul/document/public/nsIControllers.idl#47", "attachment_id": null, "time": "2011-11-28T18:53:03Z", "raw_text": "Can't extensions just use  insertControllerAt()\nhttp://mxr.mozilla.org/comm-central/source/mozilla/content/xul/document/public/nsIControllers.idl#47", "creation_time": "2011-11-28T18:53:03Z", "bug_id": 690631, "tags": [], "is_private": false, "count": 1, "id": 5876241}, {"creator": "jporterbugs@gmail.com", "author": "jporterbugs@gmail.com", "text": "(In reply to Philip Chee from comment #1)\n> Can't extensions just use  insertControllerAt()\n> http://mxr.mozilla.org/comm-central/source/mozilla/content/xul/document/\n> public/nsIControllers.idl#47\n\nHm, you're right. I suppose a better reason for this is that the code is considerably less messy, and we won't need to worry about bugs from switch statement fallthrough (like bug 670502).", "time": "2012-01-20T00:08:34Z", "attachment_id": null, "creation_time": "2012-01-20T00:08:34Z", "raw_text": "(In reply to Philip Chee from comment #1)\n> Can't extensions just use  insertControllerAt()\n> http://mxr.mozilla.org/comm-central/source/mozilla/content/xul/document/\n> public/nsIControllers.idl#47\n\nHm, you're right. I suppose a better reason for this is that the code is considerably less messy, and we won't need to worry about bugs from switch statement fallthrough (like bug 670502).", "bug_id": 690631, "tags": [], "count": 2, "is_private": false, "id": 5993948}]}}, "comments": {}}