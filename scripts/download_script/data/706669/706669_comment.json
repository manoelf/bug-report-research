{"bugs": {"706669": {"comments": [{"creation_time": "2011-11-30T22:23:05Z", "author": "justin.lebar+bug@gmail.com", "text": "Roc told me at the last all-hands that it shouldn't be too hard to discard layout data for a tab.  Just set its browser element to invisible, iirc?\n\nLayout uses ~10% of my RSS, so if we could decrease this significantly, that'd be awesome, even if it only applied to pages without any plugins.\n\nI don't know how long it would take to recompute a page's layout.  On mobile, I imagine we could tolerate this delay, since switching tabs is infrequent.  On desktop, we could play tricks like recomputing a tab's layout data when you hover over it, and/or not discarding the layout data immediately.", "tags": [], "time": "2011-11-30T22:23:05Z", "bug_id": 706669, "is_private": false, "creator": "justin.lebar+bug@gmail.com", "count": 0, "id": 5883584, "attachment_id": null, "raw_text": "Roc told me at the last all-hands that it shouldn't be too hard to discard layout data for a tab.  Just set its browser element to invisible, iirc?\n\nLayout uses ~10% of my RSS, so if we could decrease this significantly, that'd be awesome, even if it only applied to pages without any plugins.\n\nI don't know how long it would take to recompute a page's layout.  On mobile, I imagine we could tolerate this delay, since switching tabs is infrequent.  On desktop, we could play tricks like recomputing a tab's layout data when you hover over it, and/or not discarding the layout data immediately."}, {"id": 5883600, "raw_text": "> Just set its browser element to invisible, iirc?\n\ndisplay:none.\n\nWe need to fix bug 90268 and maybe scroll state restoration first, right?\n\n> I don't know how long it would take to recompute a page's layout.\n\nThat depends on the page.  You can test this on pages of your choice with this bookmarklet:\n\n  javascript: var e = document.documentElement; var s = e.style; s.display = \"none\"; e.offsetWidth; var d = new Date; s.display = \"\"; e.offsetWidth; alert(new Date - d);\n\nOn my mbp, for this bug report, the number is 7ms.  For something like the HTML5 single-page spec we're talking 4 seconds on my machine.  For the cnn.com homepage, about 150ms.", "attachment_id": null, "text": "> Just set its browser element to invisible, iirc?\n\ndisplay:none.\n\nWe need to fix bug 90268 and maybe scroll state restoration first, right?\n\n> I don't know how long it would take to recompute a page's layout.\n\nThat depends on the page.  You can test this on pages of your choice with this bookmarklet:\n\n  javascript: var e = document.documentElement; var s = e.style; s.display = \"none\"; e.offsetWidth; var d = new Date; s.display = \"\"; e.offsetWidth; alert(new Date - d);\n\nOn my mbp, for this bug report, the number is 7ms.  For something like the HTML5 single-page spec we're talking 4 seconds on my machine.  For the cnn.com homepage, about 150ms.", "bug_id": 706669, "tags": [], "time": "2011-11-30T22:29:36Z", "creation_time": "2011-11-30T22:29:36Z", "author": "bzbarsky@mit.edu", "count": 1, "is_private": false, "creator": "bzbarsky@mit.edu"}, {"raw_text": "> For something like the HTML5 single-page spec we're talking 4 seconds on my machine.\n\nIn bug 678392, they're talking about saving a screenshots of each tab (actually, of each shentry in each tab).  Perhaps we could use something like that to make this lag suck less.\n\nOTOH, maybe it's better to think about session-restoring tabs which you haven't touched for a long time.  We could session-restore tabs much less aggressively and still get more benefit than we would from this...", "attachment_id": null, "id": 5883633, "is_private": false, "creator": "justin.lebar+bug@gmail.com", "text": "> For something like the HTML5 single-page spec we're talking 4 seconds on my machine.\n\nIn bug 678392, they're talking about saving a screenshots of each tab (actually, of each shentry in each tab).  Perhaps we could use something like that to make this lag suck less.\n\nOTOH, maybe it's better to think about session-restoring tabs which you haven't touched for a long time.  We could session-restore tabs much less aggressively and still get more benefit than we would from this...", "time": "2011-11-30T22:41:56Z", "tags": [], "creation_time": "2011-11-30T22:41:56Z", "author": "justin.lebar+bug@gmail.com", "count": 2, "bug_id": 706669}, {"id": 5884205, "raw_text": "(In reply to Boris Zbarsky (:bz) from comment #1)\n> > Just set its browser element to invisible, iirc?\n> \n> display:none.\n> \n> We need to fix bug 90268 and maybe scroll state restoration first, right?\n\nScroll state restoration should be OK.\n\nSelection state needs to be fixed too. Bug 619273 is ready to land but there may be other selection-related issues.\n\nThere might be other lurking issues. We should do something here that's controlled by a pref.\n\n> On my mbp, for this bug report, the number is 7ms.  For something like the\n> HTML5 single-page spec we're talking 4 seconds on my machine.  For the\n> cnn.com homepage, about 150ms.\n\nIt's a quandry. The large pages are the ones that would give the most RAM benefit.", "attachment_id": null, "time": "2011-12-01T02:07:50Z", "bug_id": 706669, "tags": [], "text": "(In reply to Boris Zbarsky (:bz) from comment #1)\n> > Just set its browser element to invisible, iirc?\n> \n> display:none.\n> \n> We need to fix bug 90268 and maybe scroll state restoration first, right?\n\nScroll state restoration should be OK.\n\nSelection state needs to be fixed too. Bug 619273 is ready to land but there may be other selection-related issues.\n\nThere might be other lurking issues. We should do something here that's controlled by a pref.\n\n> On my mbp, for this bug report, the number is 7ms.  For something like the\n> HTML5 single-page spec we're talking 4 seconds on my machine.  For the\n> cnn.com homepage, about 150ms.\n\nIt's a quandry. The large pages are the ones that would give the most RAM benefit.", "author": "roc@ocallahan.org", "creation_time": "2011-12-01T02:07:50Z", "count": 3, "creator": "roc@ocallahan.org", "is_private": false}, {"raw_text": "One option I considered is interruptible frame construction...  The problem is that the frame construction setup is, to some extent, breadth-first.  That makes it a little more complicated to deal with than a depth-first setup like reflow.", "attachment_id": null, "id": 5884311, "creator": "bzbarsky@mit.edu", "is_private": false, "tags": [], "time": "2011-12-01T03:35:45Z", "text": "One option I considered is interruptible frame construction...  The problem is that the frame construction setup is, to some extent, breadth-first.  That makes it a little more complicated to deal with than a depth-first setup like reflow.", "author": "bzbarsky@mit.edu", "creation_time": "2011-12-01T03:35:45Z", "count": 4, "bug_id": 706669}, {"attachment_id": null, "raw_text": "Interruptible frame construction (and reflow) won't work too well if you're scrolled far down the document.", "id": 5884314, "creator": "roc@ocallahan.org", "is_private": false, "count": 5, "author": "roc@ocallahan.org", "creation_time": "2011-12-01T03:40:01Z", "time": "2011-12-01T03:40:01Z", "bug_id": 706669, "tags": [], "text": "Interruptible frame construction (and reflow) won't work too well if you're scrolled far down the document."}, {"raw_text": "Yeah, indeed.\n\nFor what it's worth, I just retested html5, and the style computation + reflow is closer to 9s now.  :(", "attachment_id": null, "id": 5884382, "count": 6, "creator": "bzbarsky@mit.edu", "is_private": false, "tags": [], "time": "2011-12-01T04:47:44Z", "bug_id": 706669, "text": "Yeah, indeed.\n\nFor what it's worth, I just retested html5, and the style computation + reflow is closer to 9s now.  :(", "author": "bzbarsky@mit.edu", "creation_time": "2011-12-01T04:47:44Z"}, {"count": 7, "bug_id": 706669, "raw_text": "This could be a big win but we don't have a clear path forward nor somebody to work on it, so we'll make this a MemShrink:P2.", "attachment_id": null, "id": 5895621, "is_private": false, "creator": "n.nethercote@gmail.com", "text": "This could be a big win but we don't have a clear path forward nor somebody to work on it, so we'll make this a MemShrink:P2.", "tags": [], "time": "2011-12-06T22:11:48Z", "creation_time": "2011-12-06T22:11:48Z", "author": "n.nethercote@gmail.com"}]}}, "comments": {}}