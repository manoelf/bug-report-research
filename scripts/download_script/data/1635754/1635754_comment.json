{"bugs": {"1635754": {"comments": [{"creation_time": "2020-05-06T13:07:49Z", "creator": "tlong@mozilla.com", "time": "2020-05-06T13:07:49Z", "tags": [], "count": 0, "author": "tlong@mozilla.com", "id": 14800212, "is_private": false, "text": "While testing out the Fx-iOS integration, I made the mistake of using an underscore when trying to send the legacy telemetry id in the deletion request ping.  Glean parser happily generated the following:\n```\nextension GleanMetrics {\n    enum LegacyIds {\n        /// The client id from legacy telemetry.\n        static let clientId = UuidMetricType(\n            category: \"legacy.ids\",\n            name: \"client_id\",\n            sendInPings: [\"deletion_request\"],\n            lifetime: .user,\n            disabled: false\n        )\n\n    }\n}\n```\nI wondered why the id wasn't getting into the ping until I realized it should be `deletion-request` and not `deletion_request`.  Glean parser should probably error on underscores in this case.", "raw_text": "While testing out the Fx-iOS integration, I made the mistake of using an underscore when trying to send the legacy telemetry id in the deletion request ping.  Glean parser happily generated the following:\n```\nextension GleanMetrics {\n    enum LegacyIds {\n        /// The client id from legacy telemetry.\n        static let clientId = UuidMetricType(\n            category: \"legacy.ids\",\n            name: \"client_id\",\n            sendInPings: [\"deletion_request\"],\n            lifetime: .user,\n            disabled: false\n        )\n\n    }\n}\n```\nI wondered why the id wasn't getting into the ping until I realized it should be `deletion-request` and not `deletion_request`.  Glean parser should probably error on underscores in this case.", "attachment_id": null, "bug_id": 1635754}, {"creator": "chutten@mozilla.com", "creation_time": "2020-05-06T13:35:42Z", "time": "2020-05-06T13:35:42Z", "count": 1, "tags": [], "id": 14800258, "author": "chutten@mozilla.com", "raw_text": "Proposal: Add a `version` parameter to `metrics.yaml` files. Add a glinter warning when parsing a `metrics.yaml` with a version less than the version it thinks is most recent. Then we can gate certain parse errors on version checks (e.g. \n```python\nif metrics_yaml_version > 1 and True in ['_' in ping for ping in send_in_pings]:\n    ERROR\n```\n\nCounter-proposal from Jan-Erik: Hard-code an allowlist of the known historical bad pings and error on everything else.", "text": "Proposal: Add a `version` parameter to `metrics.yaml` files. Add a glinter warning when parsing a `metrics.yaml` with a version less than the version it thinks is most recent. Then we can gate certain parse errors on version checks (e.g. \n```python\nif metrics_yaml_version > 1 and True in ['_' in ping for ping in send_in_pings]:\n    ERROR\n```\n\nCounter-proposal from Jan-Erik: Hard-code an allowlist of the known historical bad pings and error on everything else.", "is_private": false, "attachment_id": null, "bug_id": 1635754}, {"tags": [], "count": 2, "time": "2020-05-12T09:33:34Z", "creation_time": "2020-05-12T09:33:34Z", "creator": "jrediger@mozilla.com", "bug_id": 1635754, "attachment_id": 9147559, "is_private": false, "text": "Created attachment 9147559\nGitHub Pull Request", "raw_text": "", "id": 14813674, "author": "jrediger@mozilla.com"}, {"bug_id": 1635754, "attachment_id": null, "text": "The attached PR tests this now explicitly for pings with an underscore. \nThe issue above is that `deletion_request` is still allowed with this as one of the legacy pings. Other pings with an underscore are not.\nWe can't fix that as we need to be able to parse old versions of files in the probe-scraper.\n\nI'm moving chutten's suggestion to a new bug.", "raw_text": "The attached PR tests this now explicitly for pings with an underscore. \nThe issue above is that `deletion_request` is still allowed with this as one of the legacy pings. Other pings with an underscore are not.\nWe can't fix that as we need to be able to parse old versions of files in the probe-scraper.\n\nI'm moving chutten's suggestion to a new bug.", "is_private": false, "author": "jrediger@mozilla.com", "id": 14814016, "count": 3, "tags": [], "time": "2020-05-12T13:15:14Z", "creator": "jrediger@mozilla.com", "creation_time": "2020-05-12T13:15:14Z"}]}}, "comments": {}}