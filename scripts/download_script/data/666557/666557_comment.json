{"comments": {}, "bugs": {"666557": {"comments": [{"author": "joey@mozilla.com", "time": "2011-06-23T12:47:11Z", "attachment_id": null, "text": "In addition to being run when clean targets are in play the configure script seems to be called with most make invocations.\n\nThe following dependencies could reduce the frequency:\n  o run configure if the last run was more than [n] days ago\n    - conservative: n=1 day, will need to detect changes in OS packages.\n  o run configure if\n    - gathered .mozconfig files are newer to pickup flag and option changes \n    - configure* script has been modified\n    - other deps-?\n    - targets like distclean or clobber are used\n    - if the last platform used for compiling has changed.\n      * users building within a common or NFS mounted sandbox.\n\n\nObviously a 'reconfigure' target will be needed.  The target should simply force stale configure dependencies { $(RM) .ts/configure.done ? } allowing people to regenerate after updating system and development packages ala:\n\n   % make -f client.mk reconfigure build", "creator": "joey@mozilla.com", "raw_text": "In addition to being run when clean targets are in play the configure script seems to be called with most make invocations.\n\nThe following dependencies could reduce the frequency:\n  o run configure if the last run was more than [n] days ago\n    - conservative: n=1 day, will need to detect changes in OS packages.\n  o run configure if\n    - gathered .mozconfig files are newer to pickup flag and option changes \n    - configure* script has been modified\n    - other deps-?\n    - targets like distclean or clobber are used\n    - if the last platform used for compiling has changed.\n      * users building within a common or NFS mounted sandbox.\n\n\nObviously a 'reconfigure' target will be needed.  The target should simply force stale configure dependencies { $(RM) .ts/configure.done ? } allowing people to regenerate after updating system and development packages ala:\n\n   % make -f client.mk reconfigure build", "creation_time": "2011-06-23T12:47:11Z", "bug_id": 666557, "id": 5550811, "tags": [], "count": 0, "is_private": false}, {"text": "We should only run configure when \"clean\" is called if there's not already an objdir. We could probably fix that, it's pretty useless in that case (nothing to clean if you haven't built...)\n\nWe already have a set of dependencies to trigger running configure:\nhttp://mxr.mozilla.org/mozilla-central/source/client.mk#268\n\nIt's possible there are bugs there, but this mechanism already exists. (.mozconfig.mk is already in that list to pick up mozconfig changes, FWIW)\n\nRunning configure every |n| days seems wrong, we should just make the deps work correctly if they're broken.\n\nI wouldn't worry about crazytown antics like people trying to build multiple platforms with a single objdir, that's the kind of thing we can just tell people \"don't do that\".", "time": "2011-06-23T13:12:59Z", "attachment_id": null, "raw_text": "We should only run configure when \"clean\" is called if there's not already an objdir. We could probably fix that, it's pretty useless in that case (nothing to clean if you haven't built...)\n\nWe already have a set of dependencies to trigger running configure:\nhttp://mxr.mozilla.org/mozilla-central/source/client.mk#268\n\nIt's possible there are bugs there, but this mechanism already exists. (.mozconfig.mk is already in that list to pick up mozconfig changes, FWIW)\n\nRunning configure every |n| days seems wrong, we should just make the deps work correctly if they're broken.\n\nI wouldn't worry about crazytown antics like people trying to build multiple platforms with a single objdir, that's the kind of thing we can just tell people \"don't do that\".", "creation_time": "2011-06-23T13:12:59Z", "bug_id": 666557, "count": 1, "is_private": false, "tags": [], "id": 5550853, "creator": "ted@mielczarek.org", "author": "ted@mielczarek.org"}, {"bug_id": 666557, "id": 5578804, "tags": [], "count": 2, "is_private": false, "attachment_id": null, "time": "2011-07-07T16:07:23Z", "text": ">> We should only run configure when \"clean\" is called if there's not already an objdir.\n\nI'll have to start checking dependencies then because it seems to be running more often then needed.\n\n> Running configure every |n| days seems wrong, we should just make the deps\n> work correctly if they're broken.\n> \n> I wouldn't worry about crazytown antics like people trying to build multiple\n> platforms with a single objdir, that's the kind of thing we can just tell\n> people \"don't do that\".\n\nThe intent was only to force reconfiguring when OS packages/headers/tools/deps external to the sandbox are updated -- not handle any crazy build scenarios within the sandbox :).  If people are expected to manually run 'make configure' or 'make clean' after an external event or to see if weird failures are repeatable { packages silently updated by a system update } that would also work.", "creation_time": "2011-07-07T16:07:23Z", "raw_text": ">> We should only run configure when \"clean\" is called if there's not already an objdir.\n\nI'll have to start checking dependencies then because it seems to be running more often then needed.\n\n> Running configure every |n| days seems wrong, we should just make the deps\n> work correctly if they're broken.\n> \n> I wouldn't worry about crazytown antics like people trying to build multiple\n> platforms with a single objdir, that's the kind of thing we can just tell\n> people \"don't do that\".\n\nThe intent was only to force reconfiguring when OS packages/headers/tools/deps external to the sandbox are updated -- not handle any crazy build scenarios within the sandbox :).  If people are expected to manually run 'make configure' or 'make clean' after an external event or to see if weird failures are repeatable { packages silently updated by a system update } that would also work.", "author": "joey@mozilla.com", "creator": "joey@mozilla.com"}, {"author": "khuey@kylehuey.com", "creator": "khuey@kylehuey.com", "attachment_id": null, "time": "2011-07-07T16:10:09Z", "text": "(In reply to comment #2)\n> > Running configure every |n| days seems wrong, we should just make the deps\n> > work correctly if they're broken.\n> > \n> > I wouldn't worry about crazytown antics like people trying to build multiple\n> > platforms with a single objdir, that's the kind of thing we can just tell\n> > people \"don't do that\".\n> \n> The intent was only to force reconfiguring when OS\n> packages/headers/tools/deps external to the sandbox are updated -- not\n> handle any crazy build scenarios within the sandbox :).  If people are\n> expected to manually run 'make configure' or 'make clean' after an external\n> event or to see if weird failures are repeatable { packages silently updated\n> by a system update } that would also work.\n\nPeople are expected to clobber their object directory and start over when they change something outside of our build.", "raw_text": "(In reply to comment #2)\n> > Running configure every |n| days seems wrong, we should just make the deps\n> > work correctly if they're broken.\n> > \n> > I wouldn't worry about crazytown antics like people trying to build multiple\n> > platforms with a single objdir, that's the kind of thing we can just tell\n> > people \"don't do that\".\n> \n> The intent was only to force reconfiguring when OS\n> packages/headers/tools/deps external to the sandbox are updated -- not\n> handle any crazy build scenarios within the sandbox :).  If people are\n> expected to manually run 'make configure' or 'make clean' after an external\n> event or to see if weird failures are repeatable { packages silently updated\n> by a system update } that would also work.\n\nPeople are expected to clobber their object directory and start over when they change something outside of our build.", "creation_time": "2011-07-07T16:10:09Z", "bug_id": 666557, "id": 5578815, "is_private": false, "count": 3, "tags": []}]}}}