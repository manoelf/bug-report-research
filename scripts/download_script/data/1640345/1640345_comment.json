{"bugs": {"1640345": {"comments": [{"id": 14838625, "author": "jld@mozilla.com", "text": "If we had a pref to set `MOZ_HEADLESS` for content processes (as described in bug 1129492 comment #21) and turn off the file broker rules that allow brokered connections to the X server (needed for some GL interposition layers), then that could be combined with the `widget.disable-native-theme-for-content` pref to yield a browser where:\n1. Content processes shouldn't be able to communicate directly with the X server\n2. WebGL and Flash are broken\n3. A lot of automated tests are broken because of the widget theme change\n\nSo that configuration isn't shippable yet, but it could be useful for use cases that weren't going to use WebGL or Flash anyway, and for experimenting to see if anything else is broken that we don't know about.", "raw_text": "If we had a pref to set `MOZ_HEADLESS` for content processes (as described in bug 1129492 comment #21) and turn off the file broker rules that allow brokered connections to the X server (needed for some GL interposition layers), then that could be combined with the `widget.disable-native-theme-for-content` pref to yield a browser where:\n1. Content processes shouldn't be able to communicate directly with the X server\n2. WebGL and Flash are broken\n3. A lot of automated tests are broken because of the widget theme change\n\nSo that configuration isn't shippable yet, but it could be useful for use cases that weren't going to use WebGL or Flash anyway, and for experimenting to see if anything else is broken that we don't know about.", "is_private": false, "attachment_id": null, "bug_id": 1640345, "creator": "jld@mozilla.com", "creation_time": "2020-05-23T01:39:55Z", "time": "2020-05-23T01:39:55Z", "count": 0, "tags": []}, {"tags": [], "count": 1, "time": "2020-06-27T00:25:27Z", "creation_time": "2020-06-27T00:25:27Z", "creator": "jld@mozilla.com", "bug_id": 1640345, "attachment_id": 9159844, "is_private": false, "raw_text": "This adds the boolean pref security.sandbox.content.headless (on Linux\nonly) which does two things:\n\n1. Sets the MOZ_HEADLESS env var for content processes, so that they\ndon't initialize GTK and don't connect to the X server.\n\n2. Disallows brokered access to parts of the filesystem used only for\ngraphics -- most critically connecting to the X11 socket itself, but\nalso opening GPU device nodes and the parts of sysfs used by Mesa, for\nexample.\n\nThis is experimental; use at your own risk.\n\nSetting this pref will break native widgets, so it's also necessary to\nset widget.disable-native-theme-for-content\n\nAdditionally, it breaks Flash and WebGL; see bug 1638466 for the latter.", "text": "Created attachment 9159844\nBug 1640345 - Add a hidden pref to prevent sandboxed content processes from connecting to the X server.\n\nThis adds the boolean pref security.sandbox.content.headless (on Linux\nonly) which does two things:\n\n1. Sets the MOZ_HEADLESS env var for content processes, so that they\ndon't initialize GTK and don't connect to the X server.\n\n2. Disallows brokered access to parts of the filesystem used only for\ngraphics -- most critically connecting to the X11 socket itself, but\nalso opening GPU device nodes and the parts of sysfs used by Mesa, for\nexample.\n\nThis is experimental; use at your own risk.\n\nSetting this pref will break native widgets, so it's also necessary to\nset widget.disable-native-theme-for-content\n\nAdditionally, it breaks Flash and WebGL; see bug 1638466 for the latter.", "id": 14905089, "author": "jld@mozilla.com"}, {"raw_text": "Pushed by jedavis@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/0f8b6494d3eb\nAdd a hidden pref to prevent sandboxed content processes from connecting to the X server. r=gcp", "text": "Pushed by jedavis@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/0f8b6494d3eb\nAdd a hidden pref to prevent sandboxed content processes from connecting to the X server. r=gcp", "is_private": false, "creator": "pulsebot@bots.tld", "creation_time": "2020-06-29T22:34:02Z", "id": 14909246, "author": "pulsebot@bots.tld", "count": 2, "bug_id": 1640345, "tags": [], "attachment_id": null, "time": "2020-06-29T22:34:02Z"}, {"author": "nerli@mozilla.com", "id": 14909503, "is_private": false, "text": "Backed out 4 changesets (Bug 1644917, Bug 1640345) for causing failures in browser_preferences_usage.js CLOSED TREE\n\nPush with failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&group_state=expanded&selectedTaskRun=I4JjFG4AR8mDDVcT2gfYNg.0&resultStatus=testfailed%2Cbusted%2Cexception&revision=0f8b6494d3eb9dad4c7f455f5ee89ad2a2d77e5b\n\nFailure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=307967950&repo=autoland&lineNumber=7884\nhttps://treeherder.mozilla.org/logviewer.html#/jobs?job_id=307974242&repo=autoland&lineNumber=2074\n\nBackout: https://hg.mozilla.org/integration/autoland/rev/adc328596e28636b03fabe701ec6a4d07054e5af", "raw_text": "Backed out 4 changesets (Bug 1644917, Bug 1640345) for causing failures in browser_preferences_usage.js CLOSED TREE\n\nPush with failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&group_state=expanded&selectedTaskRun=I4JjFG4AR8mDDVcT2gfYNg.0&resultStatus=testfailed%2Cbusted%2Cexception&revision=0f8b6494d3eb9dad4c7f455f5ee89ad2a2d77e5b\n\nFailure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=307967950&repo=autoland&lineNumber=7884\nhttps://treeherder.mozilla.org/logviewer.html#/jobs?job_id=307974242&repo=autoland&lineNumber=2074\n\nBackout: https://hg.mozilla.org/integration/autoland/rev/adc328596e28636b03fabe701ec6a4d07054e5af", "attachment_id": null, "bug_id": 1640345, "creation_time": "2020-06-30T02:29:56Z", "creator": "nerli@mozilla.com", "time": "2020-06-30T02:29:56Z", "tags": [], "count": 3}, {"creation_time": "2020-06-30T19:00:14Z", "creator": "jld@mozilla.com", "time": "2020-06-30T19:00:14Z", "tags": [], "count": 4, "id": 14911225, "author": "jld@mozilla.com", "is_private": false, "raw_text": "See bug 1644917 comment #6.", "text": "See bug 1644917 comment #6.", "attachment_id": null, "bug_id": 1640345}, {"attachment_id": null, "bug_id": 1640345, "id": 14927798, "author": "pulsebot@bots.tld", "is_private": false, "text": "Pushed by jedavis@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/5980f36397c5\nAdd a hidden pref to prevent sandboxed content processes from connecting to the X server. r=gcp", "raw_text": "Pushed by jedavis@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/5980f36397c5\nAdd a hidden pref to prevent sandboxed content processes from connecting to the X server. r=gcp", "time": "2020-07-09T16:06:54Z", "tags": [], "count": 5, "creation_time": "2020-07-09T16:06:54Z", "creator": "pulsebot@bots.tld"}, {"id": 14928578, "author": "abutkovits@mozilla.com", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/5980f36397c5", "text": "https://hg.mozilla.org/mozilla-central/rev/5980f36397c5", "is_private": false, "attachment_id": null, "bug_id": 1640345, "creator": "abutkovits@mozilla.com", "creation_time": "2020-07-09T21:42:05Z", "time": "2020-07-09T21:42:05Z", "count": 6, "tags": ["bugherder"]}]}}, "comments": {}}