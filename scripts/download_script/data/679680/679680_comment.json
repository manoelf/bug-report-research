{"bugs": {"679680": {"comments": [{"raw_text": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:6.0) Gecko/20100101 Firefox/6.0\nBuild ID: 20110811165603\n\nSteps to reproduce:\n\nUpdate from Thunderbird 5 to Thunderbird 6 on Windows 7 Professional 64bit\n\n\nActual results:\n\nWhen started with a pinned shortcut in the taskbar, TB 6 appears as a new icon in the taskbar\n\n\nExpected results:\n\nWhen started with a pinned shortcut in the taskbar, TB 6 should appears on the pinned icon in the taskbar", "attachment_id": null, "bug_id": 679680, "text": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:6.0) Gecko/20100101 Firefox/6.0\nBuild ID: 20110811165603\n\nSteps to reproduce:\n\nUpdate from Thunderbird 5 to Thunderbird 6 on Windows 7 Professional 64bit\n\n\nActual results:\n\nWhen started with a pinned shortcut in the taskbar, TB 6 appears as a new icon in the taskbar\n\n\nExpected results:\n\nWhen started with a pinned shortcut in the taskbar, TB 6 should appears on the pinned icon in the taskbar", "tags": [], "id": 5659429, "count": 0, "is_private": false, "author": "u422471@disabled.tld", "time": "2011-08-17T13:09:54Z", "creation_time": "2011-08-17T13:09:54Z", "creator": "u422471@disabled.tld"}, {"attachment_id": 554031, "raw_text": "", "tags": [], "bug_id": 679680, "text": "Created attachment 554031\nscreenshot of this problem", "id": 5662101, "count": 1, "is_private": false, "time": "2011-08-18T11:25:54Z", "creation_time": "2011-08-18T11:25:54Z", "creator": "u422471@disabled.tld", "author": "u422471@disabled.tld"}, {"time": "2011-09-07T09:31:44Z", "creation_time": "2011-09-07T09:31:44Z", "creator": "u422471@disabled.tld", "author": "u422471@disabled.tld", "count": 2, "id": 5704263, "is_private": false, "text": "More informations:\n\nThis is fixed when removing the pinned shortcut and pin it again to the tastkbar. But after updating Thunderbird from 6.0 to 6.0.1 or 6.0.1 to 6.0.2 this problem is back.", "bug_id": 679680, "tags": [], "attachment_id": null, "raw_text": "More informations:\n\nThis is fixed when removing the pinned shortcut and pin it again to the tastkbar. But after updating Thunderbird from 6.0 to 6.0.1 or 6.0.1 to 6.0.2 this problem is back."}, {"count": 3, "id": 5704429, "is_private": false, "author": "rain@sunshowers.io", "creation_time": "2011-09-07T11:54:45Z", "time": "2011-09-07T11:54:45Z", "creator": "rain@sunshowers.io", "raw_text": "Hmm, we have code to handle precisely this (bug 661363), so this shouldn't be happening. Looking into it.", "attachment_id": null, "tags": [], "text": "Hmm, we have code to handle precisely this (bug 661363), so this shouldn't be happening. Looking into it.", "bug_id": 679680}, {"author": "rain@sunshowers.io", "time": "2011-09-07T13:47:17Z", "creation_time": "2011-09-07T13:47:17Z", "creator": "rain@sunshowers.io", "count": 4, "id": 5704640, "is_private": false, "bug_id": 679680, "text": "I can't reproduce this locally. Here's what I did:\n\n1. Set up a fresh Windows 7 x64 SP1 virtual machine and make sure that it's up-to-date.\n2. Download Thunderbird 5: <https://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/5.0/win32/en-US/Thunderbird%20Setup%205.0.exe>.\n3. Install Thunderbird 5 using default settings.\n4. Open Thunderbird and pin it to the taskbar, then go to help -> about and update to Thunderbird 6.0.2.\n\nNo new icon showed up for me.\n\nCould you try the following steps, please? Since you mentioned Thunderbird 6.0.1 as having the same issue, let's start from there.\n\n1. Unpin any Thunderbird shortcuts you already have in the start menu or taskbar.\n2. Uninstall Thunderbird.\n3. Download Thunderbird 6.0.1: <https://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/6.0.1/win32/en-US/Thunderbird%20Setup%206.0.1.exe>.\n4. Install it as usual.\n5. Open it up, then pin it to the taskbar.\n6. Help -> About and update to 6.0.2.\n\nDoes the problem still show up? If it does, then\n\n7. Open a command prompt (cmd).\n8. Type in the following commands:\n\ncd \"%appdata%\\roaming\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\"\ncopy Thunderbird.lnk Thunderbird.lnk2\n\n9. Now add Thunderbird.lnk2 as an attachment to this bug. In the file selection box, you should be able to navigate to %appdata%\\roaming\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar. The reason you can't attach Thunderbird.lnk directly is that Windows thinks you want to attach the target of the link (the actual Thunderbird executable).", "tags": [], "raw_text": "I can't reproduce this locally. Here's what I did:\n\n1. Set up a fresh Windows 7 x64 SP1 virtual machine and make sure that it's up-to-date.\n2. Download Thunderbird 5: <https://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/5.0/win32/en-US/Thunderbird%20Setup%205.0.exe>.\n3. Install Thunderbird 5 using default settings.\n4. Open Thunderbird and pin it to the taskbar, then go to help -> about and update to Thunderbird 6.0.2.\n\nNo new icon showed up for me.\n\nCould you try the following steps, please? Since you mentioned Thunderbird 6.0.1 as having the same issue, let's start from there.\n\n1. Unpin any Thunderbird shortcuts you already have in the start menu or taskbar.\n2. Uninstall Thunderbird.\n3. Download Thunderbird 6.0.1: <https://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/6.0.1/win32/en-US/Thunderbird%20Setup%206.0.1.exe>.\n4. Install it as usual.\n5. Open it up, then pin it to the taskbar.\n6. Help -> About and update to 6.0.2.\n\nDoes the problem still show up? If it does, then\n\n7. Open a command prompt (cmd).\n8. Type in the following commands:\n\ncd \"%appdata%\\roaming\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\"\ncopy Thunderbird.lnk Thunderbird.lnk2\n\n9. Now add Thunderbird.lnk2 as an attachment to this bug. In the file selection box, you should be able to navigate to %appdata%\\roaming\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar. The reason you can't attach Thunderbird.lnk directly is that Windows thinks you want to attach the target of the link (the actual Thunderbird executable).", "attachment_id": null}, {"raw_text": "> cd \"%appdata%\\roaming\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\"\n\nMy mistake. This should be\n\ncd \"%appdata%\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\"", "attachment_id": null, "text": "> cd \"%appdata%\\roaming\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\"\n\nMy mistake. This should be\n\ncd \"%appdata%\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\"", "bug_id": 679680, "tags": [], "id": 5704641, "count": 5, "is_private": false, "author": "rain@sunshowers.io", "creation_time": "2011-09-07T13:48:18Z", "time": "2011-09-07T13:48:18Z", "creator": "rain@sunshowers.io"}, {"author": "u422471@disabled.tld", "creation_time": "2011-09-07T14:39:18Z", "time": "2011-09-07T14:39:18Z", "creator": "u422471@disabled.tld", "id": 5704764, "count": 6, "is_private": false, "tags": [], "bug_id": 679680, "text": "Created attachment 558800\nMozilla Thunderbird.lnk2", "raw_text": "", "attachment_id": 558800}, {"count": 7, "id": 5704767, "is_private": false, "author": "u422471@disabled.tld", "time": "2011-09-07T14:39:52Z", "creation_time": "2011-09-07T14:39:52Z", "creator": "u422471@disabled.tld", "raw_text": "", "attachment_id": 558802, "text": "Created attachment 558802\nThunderbird.lnk2", "bug_id": 679680, "tags": []}, {"count": 8, "id": 5704789, "is_private": false, "time": "2011-09-07T14:44:34Z", "creation_time": "2011-09-07T14:44:34Z", "creator": "u422471@disabled.tld", "author": "u422471@disabled.tld", "attachment_id": null, "raw_text": "Hi!\n\nThanks for your reply.\n\nI did some tests as you wrote above. The same happens again and again when i deinstall Thunderbird, install TB 6.0.1 and update it to 6.0.2. But i found some strange behavior with the name of the .lnk files:\n\nWhen i install TB 6.0.1 and pin it to the taskbar the .lnk file is named \"Mozilla Thunderbird.lnk\". When i update from 6.0.1 to 6.0.2, remove the pinned shortcut and pin it again the Link is called \"Thunderbird.lnk\"\n\nI've attached both shortcuts as an attachment.", "tags": [], "bug_id": 679680, "text": "Hi!\n\nThanks for your reply.\n\nI did some tests as you wrote above. The same happens again and again when i deinstall Thunderbird, install TB 6.0.1 and update it to 6.0.2. But i found some strange behavior with the name of the .lnk files:\n\nWhen i install TB 6.0.1 and pin it to the taskbar the .lnk file is named \"Mozilla Thunderbird.lnk\". When i update from 6.0.1 to 6.0.2, remove the pinned shortcut and pin it again the Link is called \"Thunderbird.lnk\"\n\nI've attached both shortcuts as an attachment."}, {"time": "2011-09-09T11:40:52Z", "creation_time": "2011-09-09T11:40:52Z", "creator": "rain@sunshowers.io", "tags": [], "bug_id": 679680, "text": "This is really strange, the shortcuts don't seem to have any sort of app model ID set at all. In the config editor, what is mail.taskbar.lastgroupid set to?", "author": "rain@sunshowers.io", "id": 5710283, "count": 9, "is_private": false, "attachment_id": null, "raw_text": "This is really strange, the shortcuts don't seem to have any sort of app model ID set at all. In the config editor, what is mail.taskbar.lastgroupid set to?"}, {"id": 5711670, "count": 10, "is_private": false, "author": "u422471@disabled.tld", "time": "2011-09-09T21:57:11Z", "creation_time": "2011-09-09T21:57:11Z", "creator": "u422471@disabled.tld", "raw_text": "Hi!\n\nThanks again for your reply.\n\nThe mail.taskbar.lasgroupid with TB 6.0.2 is now set to:\n\n.Thunderbird.6.0.2", "attachment_id": null, "tags": [], "text": "Hi!\n\nThanks again for your reply.\n\nThe mail.taskbar.lasgroupid with TB 6.0.2 is now set to:\n\n.Thunderbird.6.0.2", "bug_id": 679680}, {"raw_text": "Hi, Chris, are you still having this issue with Thunderbird 7.0.1? Nothing's changed on our end, but I'm still curious. If you are then I think I'll look into this issue a bit further.", "attachment_id": null, "tags": [], "bug_id": 679680, "text": "Hi, Chris, are you still having this issue with Thunderbird 7.0.1? Nothing's changed on our end, but I'm still curious. If you are then I think I'll look into this issue a bit further.", "count": 11, "id": 5752568, "is_private": false, "author": "rain@sunshowers.io", "creation_time": "2011-10-02T10:10:56Z", "time": "2011-10-02T10:10:56Z", "creator": "rain@sunshowers.io"}, {"raw_text": "Hey, thanks for asking about the status of my problem. I'm still having this issue and did some more tests:\n\nThe strange thing was, i had a Thunderbird 3.1.6 and a Thunderbird 7.0.1 in the list of my installed software in the control panel. When i remove one of them, the other one is removed too. Now i've installed Thunderbird 7.0 and this this version appears in the list of my installed software. When i update Thunderbird to 7.0.1 the version 7.0 is still in the list and a new item with Thunderbird 7.0.1 is created. Maybe this causes the problem?", "attachment_id": null, "text": "Hey, thanks for asking about the status of my problem. I'm still having this issue and did some more tests:\n\nThe strange thing was, i had a Thunderbird 3.1.6 and a Thunderbird 7.0.1 in the list of my installed software in the control panel. When i remove one of them, the other one is removed too. Now i've installed Thunderbird 7.0 and this this version appears in the list of my installed software. When i update Thunderbird to 7.0.1 the version 7.0 is still in the list and a new item with Thunderbird 7.0.1 is created. Maybe this causes the problem?", "bug_id": 679680, "tags": [], "is_private": false, "id": 5752617, "count": 12, "author": "u422471@disabled.tld", "creator": "u422471@disabled.tld", "creation_time": "2011-10-02T11:42:37Z", "time": "2011-10-02T11:42:37Z"}, {"id": 5752626, "count": 13, "is_private": false, "author": "rain@sunshowers.io", "time": "2011-10-02T11:58:01Z", "creation_time": "2011-10-02T11:58:01Z", "creator": "rain@sunshowers.io", "raw_text": "Interesting, that could easily be related. I'm looking at this right now.", "attachment_id": null, "text": "Interesting, that could easily be related. I'm looking at this right now.", "bug_id": 679680, "tags": []}, {"attachment_id": null, "raw_text": "I think I've finally managed to reproduce this!\n\n1. Unpin any Thunderbird shortcuts from the taskbar.\n2. Right click on the exe in Explorer and choose Pin to Taskbar. <-- This method is important.\n3. Open Thunderbird.", "bug_id": 679680, "text": "I think I've finally managed to reproduce this!\n\n1. Unpin any Thunderbird shortcuts from the taskbar.\n2. Right click on the exe in Explorer and choose Pin to Taskbar. <-- This method is important.\n3. Open Thunderbird.", "tags": [], "is_private": false, "count": 14, "id": 5752722, "creator": "rain@sunshowers.io", "time": "2011-10-02T14:03:42Z", "creation_time": "2011-10-02T14:03:42Z", "author": "rain@sunshowers.io"}, {"raw_text": "No, false alarm :( I still can't reproduce.", "count": 15, "id": 5752727, "is_private": false, "attachment_id": null, "text": "No, false alarm :( I still can't reproduce.", "bug_id": 679680, "tags": [], "author": "rain@sunshowers.io", "creation_time": "2011-10-02T14:12:47Z", "time": "2011-10-02T14:12:47Z", "creator": "rain@sunshowers.io"}, {"creator": "rain@sunshowers.io", "creation_time": "2011-10-02T16:34:34Z", "time": "2011-10-02T16:34:34Z", "author": "rain@sunshowers.io", "is_private": false, "count": 16, "id": 5752841, "tags": [], "bug_id": 679680, "text": "Chris, could you try this out? Unpin any Thunderbird shortcuts, install Thunderbird 7.0, pin it, then update to 7.0.1. At this point, you'll be seeing two Thunderbird icons on the taskbar. Now open a command prompt and run\n\nD:\\Programme\\Mozilla Thunderbird\\uninstall\\helper.exe /UpdateShortcutAppUserModelIds\n\nThis is what we should be running every time there's an update.\n\nccing Robert -- do you have any ideas what might be happening here? Is the Windows app model ID cache (if it exists) screwed up somehow? The code's all in toolkit/ so it might affect Firefox too.", "attachment_id": null, "raw_text": "Chris, could you try this out? Unpin any Thunderbird shortcuts, install Thunderbird 7.0, pin it, then update to 7.0.1. At this point, you'll be seeing two Thunderbird icons on the taskbar. Now open a command prompt and run\n\nD:\\Programme\\Mozilla Thunderbird\\uninstall\\helper.exe /UpdateShortcutAppUserModelIds\n\nThis is what we should be running every time there's an update.\n\nccing Robert -- do you have any ideas what might be happening here? Is the Windows app model ID cache (if it exists) screwed up somehow? The code's all in toolkit/ so it might affect Firefox too."}, {"attachment_id": null, "raw_text": "> D:\\Programme\\Mozilla Thunderbird\\uninstall\\helper.exe /UpdateShortcutAppUserModelIds\n\nSorry, this should be\n\n\"D:\\Programme\\Mozilla Thunderbird\\uninstall\\helper.exe\" /UpdateShortcutAppUserModelIds", "tags": [], "text": "> D:\\Programme\\Mozilla Thunderbird\\uninstall\\helper.exe /UpdateShortcutAppUserModelIds\n\nSorry, this should be\n\n\"D:\\Programme\\Mozilla Thunderbird\\uninstall\\helper.exe\" /UpdateShortcutAppUserModelIds", "bug_id": 679680, "count": 17, "id": 5752842, "is_private": false, "creation_time": "2011-10-02T16:35:01Z", "time": "2011-10-02T16:35:01Z", "creator": "rain@sunshowers.io", "author": "rain@sunshowers.io"}, {"author": "u422471@disabled.tld", "creation_time": "2011-10-02T19:44:22Z", "time": "2011-10-02T19:44:22Z", "creator": "u422471@disabled.tld", "count": 18, "id": 5752981, "is_private": false, "tags": [], "text": "Hi!\n\nSorry, i wasn't online to answer your questions. I've tested this and run \"D:\\Programme\\Mozilla Thunderbird\\uninstall\\helper.exe\" /UpdateShortcutAppUserModelIds in my command prompt after the update from 7.0 to 7.0.1. After running the command i got no output / results and there are still two icons on the taskbar.", "bug_id": 679680, "raw_text": "Hi!\n\nSorry, i wasn't online to answer your questions. I've tested this and run \"D:\\Programme\\Mozilla Thunderbird\\uninstall\\helper.exe\" /UpdateShortcutAppUserModelIds in my command prompt after the update from 7.0 to 7.0.1. After running the command i got no output / results and there are still two icons on the taskbar.", "attachment_id": null}, {"raw_text": "There have been a couple of reports of this happening with Firefox as well though I have no idea as to why it happens for some people. I *think* bug 577867 will at least make this happen even less often since the app id on the shortcut won't need to be updated.", "attachment_id": null, "bug_id": 679680, "text": "There have been a couple of reports of this happening with Firefox as well though I have no idea as to why it happens for some people. I *think* bug 577867 will at least make this happen even less often since the app id on the shortcut won't need to be updated.", "tags": [], "is_private": false, "count": 19, "id": 5753076, "author": "robert.strong.bugs@gmail.com", "creator": "robert.strong.bugs@gmail.com", "time": "2011-10-02T21:09:57Z", "creation_time": "2011-10-02T21:09:57Z"}, {"time": "2011-10-04T08:17:31Z", "creation_time": "2011-10-04T08:17:31Z", "creator": "rain@sunshowers.io", "author": "rain@sunshowers.io", "id": 5756722, "count": 20, "is_private": false, "text": "So through an awesome live debugging session with Chris (thanks Chris!) we found out that the helper.exe process had its compatibility set to Windows Vista. (I think it was because of bug 670034). Removing the setting made everything work again.\n\nSome ways to resolve the issue:\n1. Remove the ${If} ${AtLeastWin7} condition at <https://mxr.mozilla.org/comm-central/source/mozilla/toolkit/mozapps/installer/windows/nsis/common.nsh#6524>. There are probably plenty of other bugs of this sort lurking around though.\n2. If we find a registry entry for ourselves under (HKCU|HKLM)\\Software\\Windows NT\\Current Version\\AppCompatFlags\\Layers, remove it (might need to elevate here), then reload ourselves.\n\nRobert, Jim, thoughts?", "bug_id": 679680, "tags": [], "attachment_id": null, "raw_text": "So through an awesome live debugging session with Chris (thanks Chris!) we found out that the helper.exe process had its compatibility set to Windows Vista. (I think it was because of bug 670034). Removing the setting made everything work again.\n\nSome ways to resolve the issue:\n1. Remove the ${If} ${AtLeastWin7} condition at <https://mxr.mozilla.org/comm-central/source/mozilla/toolkit/mozapps/installer/windows/nsis/common.nsh#6524>. There are probably plenty of other bugs of this sort lurking around though.\n2. If we find a registry entry for ourselves under (HKCU|HKLM)\\Software\\Windows NT\\Current Version\\AppCompatFlags\\Layers, remove it (might need to elevate here), then reload ourselves.\n\nRobert, Jim, thoughts?"}, {"count": 21, "id": 5757936, "is_private": false, "author": "robert.strong.bugs@gmail.com", "time": "2011-10-04T17:56:52Z", "creation_time": "2011-10-04T17:56:52Z", "creator": "robert.strong.bugs@gmail.com", "raw_text": "I don't think that this was caused by bug 670034 since that will not set AppCompatFlags, we have had one bug report for this with Firefox using NSIS 2.33, and I have tested this numerous times on Win7 using NSIS 2.46 without this happening. I have seen bug reports of AppCompatFlags getting set by something other than Firefox or Firefox's separate binaries (a couple of times where the user set the AppCompatFlags on firefox.exe for example) which I suspect is the cause in this instance.\n\nBug 577867 will remove the need to update the app id on shortcuts which should solve this problem since the following won't be necessary any more.\nhttps://mxr.mozilla.org/comm-central/source/mozilla/toolkit/mozapps/installer/windows/nsis/common.nsh#6524\n\nI wouldn't be against the removal of the registry key though it shouldn't really be necessary and the removal would only apply to the next time the binary was launched.", "attachment_id": null, "tags": [], "text": "I don't think that this was caused by bug 670034 since that will not set AppCompatFlags, we have had one bug report for this with Firefox using NSIS 2.33, and I have tested this numerous times on Win7 using NSIS 2.46 without this happening. I have seen bug reports of AppCompatFlags getting set by something other than Firefox or Firefox's separate binaries (a couple of times where the user set the AppCompatFlags on firefox.exe for example) which I suspect is the cause in this instance.\n\nBug 577867 will remove the need to update the app id on shortcuts which should solve this problem since the following won't be necessary any more.\nhttps://mxr.mozilla.org/comm-central/source/mozilla/toolkit/mozapps/installer/windows/nsis/common.nsh#6524\n\nI wouldn't be against the removal of the registry key though it shouldn't really be necessary and the removal would only apply to the next time the binary was launched.", "bug_id": 679680}]}}, "comments": {}}