{"bugs": {"683472": {"comments": [{"creator": "public@lrbabe.com", "creation_time": "2011-08-31T11:33:42Z", "is_private": false, "attachment_id": null, "tags": [], "author": "public@lrbabe.com", "text": "1. When using watchPosition and *then* getCurrentPosition() in the same snippet, only \"CURRENT\" will be displayed in the console.\n\nnavigator.geolocation.watchPosition(function( pos ) {\n    console.log( \"WATCH\", pos );\n});\nnavigator.geolocation.getCurrentPosition(function( pos ) {\n    console.log( \"CURRENT\", pos );\n});\n\n2. When using getCurrentPosition() and *then* watchPosition() or getCurrentPosition() again, geolocation will stop working, accross all tabs (sometime you have to rune the snippet twice to see the bug)\n\nnavigator.geolocation.getCurrentPosition(function( pos ) {\n    console.log( \"CURRENT\", pos );\n});\nnavigator.geolocation.watchPosition(function( pos ) {\n    console.log( \"WATCH\", pos );\n});\n\n3. Using watchPosition() and then watchPosition() again has the same effect as 2.\n\nIn any case, only the callback of the last call to watchPosition() or getCurrentPosition() ever fires (if geolocation does not stop working immediately).", "count": 0, "id": 5690236, "bug_id": 683472, "time": "2011-08-31T11:33:42Z", "raw_text": "1. When using watchPosition and *then* getCurrentPosition() in the same snippet, only \"CURRENT\" will be displayed in the console.\n\nnavigator.geolocation.watchPosition(function( pos ) {\n    console.log( \"WATCH\", pos );\n});\nnavigator.geolocation.getCurrentPosition(function( pos ) {\n    console.log( \"CURRENT\", pos );\n});\n\n2. When using getCurrentPosition() and *then* watchPosition() or getCurrentPosition() again, geolocation will stop working, accross all tabs (sometime you have to rune the snippet twice to see the bug)\n\nnavigator.geolocation.getCurrentPosition(function( pos ) {\n    console.log( \"CURRENT\", pos );\n});\nnavigator.geolocation.watchPosition(function( pos ) {\n    console.log( \"WATCH\", pos );\n});\n\n3. Using watchPosition() and then watchPosition() again has the same effect as 2.\n\nIn any case, only the callback of the last call to watchPosition() or getCurrentPosition() ever fires (if geolocation does not stop working immediately)."}, {"time": "2011-08-31T16:52:10Z", "attachment_id": null, "raw_text": "Can you provide a minimized testcase which showcases this bug?", "tags": [], "creator": "u279076@disabled.tld", "author": "u279076@disabled.tld", "text": "Can you provide a minimized testcase which showcases this bug?", "count": 1, "id": 5691116, "bug_id": 683472, "is_private": false, "creation_time": "2011-08-31T16:52:10Z"}, {"creation_time": "2011-08-31T18:27:17Z", "is_private": false, "id": 5691497, "bug_id": 683472, "count": 2, "text": "Here are the test cases:\nhttp://fiddle.jshell.net/louisremi/MypZQ/2/show/\nhttp://fiddle.jshell.net/louisremi/MypZQ/6/show/\n\nI have trouble reproducing the case where geolocation stops working. Sometime I have to refresh http://fiddle.jshell.net/louisremi/MypZQ/2/show/ a dozen of times before it happens, sometime it happens on the first time I open the page. When it happens, I have to restart the browser.\n\nSo the first thing to fix is the fact that only the last call to watchPosition() or getCurrentPosition() has its callback executed.", "author": "public@lrbabe.com", "creator": "public@lrbabe.com", "tags": [], "raw_text": "Here are the test cases:\nhttp://fiddle.jshell.net/louisremi/MypZQ/2/show/\nhttp://fiddle.jshell.net/louisremi/MypZQ/6/show/\n\nI have trouble reproducing the case where geolocation stops working. Sometime I have to refresh http://fiddle.jshell.net/louisremi/MypZQ/2/show/ a dozen of times before it happens, sometime it happens on the first time I open the page. When it happens, I have to restart the browser.\n\nSo the first thing to fix is the fact that only the last call to watchPosition() or getCurrentPosition() has its callback executed.", "attachment_id": null, "time": "2011-08-31T18:27:17Z"}, {"tags": [], "raw_text": "When this starts failing do any errors appear in the Error Console?", "attachment_id": null, "time": "2011-08-31T18:29:19Z", "creation_time": "2011-08-31T18:29:19Z", "is_private": false, "id": 5691501, "bug_id": 683472, "text": "When this starts failing do any errors appear in the Error Console?", "count": 3, "author": "u279076@disabled.tld", "creator": "u279076@disabled.tld"}, {"is_private": false, "creation_time": "2011-08-31T18:44:56Z", "id": 5691563, "bug_id": 683472, "count": 4, "text": "No, I have checked and I haven't seen any.", "author": "public@lrbabe.com", "creator": "public@lrbabe.com", "tags": [], "raw_text": "No, I have checked and I haven't seen any.", "attachment_id": null, "time": "2011-08-31T18:44:56Z"}, {"attachment_id": null, "raw_text": "Oh, gross, this happens because two prompts are triggered, but they're collapsed into one prompt for the most recent geolocation request (the watch request). Then when that's allowed and an update occurs, we see the getCurrentPosition request which hasn't been allowed, so we skip over it, and then remove it so it doesn't get any more updates.", "time": "2011-09-05T15:31:07Z", "tags": [], "author": "josh@joshmatthews.net", "text": "Oh, gross, this happens because two prompts are triggered, but they're collapsed into one prompt for the most recent geolocation request (the watch request). Then when that's allowed and an update occurs, we see the getCurrentPosition request which hasn't been allowed, so we skip over it, and then remove it so it doesn't get any more updates.", "count": 5, "creator": "josh@joshmatthews.net", "creation_time": "2011-09-05T15:31:07Z", "is_private": false, "id": 5700635, "bug_id": 683472}, {"tags": [], "time": "2011-09-05T16:13:46Z", "attachment_id": 558299, "raw_text": "This solves the problem of the first testcase. I'm still digging into why the second one behaves so strangely.", "id": 5700686, "bug_id": 683472, "creation_time": "2011-09-05T16:13:46Z", "is_private": false, "creator": "josh@joshmatthews.net", "author": "josh@joshmatthews.net", "count": 6, "text": "Created attachment 558299\nAllow or deny all similar pending content permission requests when permissino is granted or denied.\n\nThis solves the problem of the first testcase. I'm still digging into why the second one behaves so strangely."}, {"tags": [], "attachment_id": null, "raw_text": "Mark, I'm interested in your feedback as to whether we should look into collapsing similar content permission prompts on mobile. I believe that with the sample testcase above we'll just display two prompts.", "time": "2011-09-05T16:16:58Z", "is_private": false, "creation_time": "2011-09-05T16:16:58Z", "bug_id": 683472, "id": 5700687, "author": "josh@joshmatthews.net", "text": "Mark, I'm interested in your feedback as to whether we should look into collapsing similar content permission prompts on mobile. I believe that with the sample testcase above we'll just display two prompts.", "count": 7, "creator": "josh@joshmatthews.net"}, {"tags": [], "attachment_id": 558299, "is_private": false, "creation_time": "2011-09-05T16:24:38Z", "creator": "mark.finkle@gmail.com", "time": "2011-09-05T16:24:38Z", "raw_text": "It seems like this is the \"right\" thing to do. We could start stacking each prompt in it's own row, but that seems like it could confuse the user and just look amateurish.", "bug_id": 683472, "id": 5700695, "text": "Comment on attachment 558299\nAllow or deny all similar pending content permission requests when permissino is granted or denied.\n\nIt seems like this is the \"right\" thing to do. We could start stacking each prompt in it's own row, but that seems like it could confuse the user and just look amateurish.", "count": 8, "author": "mark.finkle@gmail.com"}, {"creation_time": "2011-09-05T16:25:39Z", "is_private": false, "bug_id": 683472, "id": 5700699, "text": "Note that mobile has similar code here:\nhttp://mxr.mozilla.org/mozilla-central/source/mobile/components/ContentPermissionPrompt.js", "count": 9, "author": "mark.finkle@gmail.com", "creator": "mark.finkle@gmail.com", "tags": [], "raw_text": "Note that mobile has similar code here:\nhttp://mxr.mozilla.org/mozilla-central/source/mobile/components/ContentPermissionPrompt.js", "attachment_id": null, "time": "2011-09-05T16:25:39Z"}, {"creation_time": "2011-09-05T17:59:56Z", "is_private": false, "creator": "public@lrbabe.com", "tags": [], "attachment_id": null, "bug_id": 683472, "id": 5700771, "author": "public@lrbabe.com", "text": "Hey Josh, thank you for taking care of this once again. While you are at it, I suggest you have a look at bug 683656. Users should have to click only once on \"share location\" per browsing session.", "count": 10, "time": "2011-09-05T17:59:56Z", "raw_text": "Hey Josh, thank you for taking care of this once again. While you are at it, I suggest you have a look at bug 683656. Users should have to click only once on \"share location\" per browsing session."}, {"tags": [], "time": "2011-12-31T21:46:38Z", "raw_text": "Rebased.", "attachment_id": 585162, "id": 5948594, "bug_id": 683472, "is_private": false, "creation_time": "2011-12-31T21:46:38Z", "creator": "josh@joshmatthews.net", "count": 11, "text": "Created attachment 585162\nAllow or deny all similar pending content permission requests when permissino is granted or denied.\n\nRebased.", "author": "josh@joshmatthews.net"}, {"creator": "josh@joshmatthews.net", "text": "Comment on attachment 585162\nAllow or deny all similar pending content permission requests when permissino is granted or denied.\n\nNo response from firefox-reviewers for more than a month. Let's try throwing a dart at the map.", "count": 12, "author": "josh@joshmatthews.net", "bug_id": 683472, "id": 6039476, "is_private": false, "creation_time": "2012-02-07T03:17:00Z", "time": "2012-02-07T03:17:00Z", "raw_text": "No response from firefox-reviewers for more than a month. Let's try throwing a dart at the map.", "attachment_id": 585162, "tags": []}, {"tags": [], "time": "2012-02-07T03:32:54Z", "raw_text": "(In reply to Josh Matthews [:jdm] from comment #12)\n> No response from firefox-reviewers for more than a month. Let's try throwing\n> a dart at the map.\n\nSorry if there was some misunderstanding, but that's not a valid use of the alias. The mailing list doesn't get normal bugmail, and this bug isn't in the Firefox product, so that request went to /dev/null. firefox-reviewers get mail when \"review\" flags are changed in bugs that are in the Firefox product, regardless of the assignee.", "attachment_id": null, "bug_id": 683472, "id": 6039521, "creation_time": "2012-02-07T03:32:54Z", "is_private": false, "creator": "gavin.sharp@gmail.com", "count": 13, "text": "(In reply to Josh Matthews [:jdm] from comment #12)\n> No response from firefox-reviewers for more than a month. Let's try throwing\n> a dart at the map.\n\nSorry if there was some misunderstanding, but that's not a valid use of the alias. The mailing list doesn't get normal bugmail, and this bug isn't in the Firefox product, so that request went to /dev/null. firefox-reviewers get mail when \"review\" flags are changed in bugs that are in the Firefox product, regardless of the assignee.", "author": "gavin.sharp@gmail.com"}, {"attachment_id": 585162, "raw_text": "It looks like this can potentially leak request objects indefinitely (including past the time when their associated tabs are closed), which doesn't seem acceptable.\n\nOne way to solve that might be to have the requests live on the notification object (which gets cleared out on tab close), rather than in the prompter.\n\nDoes the relevant spec mention how to deal with multiple successive prompts? Do you know how other browsers handle this?", "time": "2012-02-07T03:44:08Z", "tags": [], "author": "gavin.sharp@gmail.com", "text": "Comment on attachment 585162\nAllow or deny all similar pending content permission requests when permissino is granted or denied.\n\nIt looks like this can potentially leak request objects indefinitely (including past the time when their associated tabs are closed), which doesn't seem acceptable.\n\nOne way to solve that might be to have the requests live on the notification object (which gets cleared out on tab close), rather than in the prompter.\n\nDoes the relevant spec mention how to deal with multiple successive prompts? Do you know how other browsers handle this?", "count": 14, "creator": "gavin.sharp@gmail.com", "creation_time": "2012-02-07T03:44:08Z", "is_private": false, "id": 6039542, "bug_id": 683472}, {"bug_id": 683472, "id": 8562882, "creation_time": "2014-03-21T14:13:07Z", "is_private": false, "creator": "josh@joshmatthews.net", "author": "josh@joshmatthews.net", "text": "I'm not actively looking into this. However, if someone wanted to tackle this, answering Gavin's question about what other browsers do would be a great first step, and then the notification code lives at http://mxr.mozilla.org/mozilla-central/source/toolkit/modules/PopupNotifications.jsm . Adapting the patch here to store the request objects inside the notifications instead of the prompt code should not be too difficult.", "count": 15, "tags": [], "time": "2014-03-21T14:13:07Z", "attachment_id": null, "raw_text": "I'm not actively looking into this. However, if someone wanted to tackle this, answering Gavin's question about what other browsers do would be a great first step, and then the notification code lives at http://mxr.mozilla.org/mozilla-central/source/toolkit/modules/PopupNotifications.jsm . Adapting the patch here to store the request objects inside the notifications instead of the prompt code should not be too difficult."}, {"attachment_id": null, "tags": [], "creator": "cpeterson@mozilla.com", "is_private": false, "creation_time": "2014-04-11T22:39:45Z", "time": "2014-04-11T22:39:45Z", "raw_text": "Mass tracking-e10s flag change. Filter bugmail on \"2be0fcce-e36a-4e2c-aa80-0e3d33eb5406\".", "author": "cpeterson@mozilla.com", "count": 16, "text": "Mass tracking-e10s flag change. Filter bugmail on \"2be0fcce-e36a-4e2c-aa80-0e3d33eb5406\".", "id": 8653010, "bug_id": 683472}, {"id": 8653823, "bug_id": 683472, "author": "josh@joshmatthews.net", "count": 17, "text": "It's unclear to me why this was blocking e10s.", "time": "2014-04-12T03:47:27Z", "raw_text": "It's unclear to me why this was blocking e10s.", "creation_time": "2014-04-12T03:47:27Z", "is_private": false, "creator": "josh@joshmatthews.net", "tags": [], "attachment_id": null}]}}, "comments": {}}