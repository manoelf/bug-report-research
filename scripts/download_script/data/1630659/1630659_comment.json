{"bugs": {"1630659": {"comments": [{"creator": "eolson@mozilla.com", "time": "2020-04-16T16:04:10Z", "bug_id": 1630659, "is_private": false, "tags": [], "count": 0, "text": "Tracking efforts to identify the HMAC issue in the user migration from sync-py to sync-rs.", "creation_time": "2020-04-16T16:04:10Z", "author": "eolson@mozilla.com", "id": 14759389, "raw_text": "Tracking efforts to identify the HMAC issue in the user migration from sync-py to sync-rs.", "attachment_id": null}, {"bug_id": 1630659, "is_private": false, "text": "Github issue is here -> https://github.com/mozilla-services/syncstorage-rs/issues/592", "author": "eolson@mozilla.com", "id": 14759393, "attachment_id": null, "time": "2020-04-16T16:07:16Z", "creator": "eolson@mozilla.com", "tags": [], "count": 1, "creation_time": "2020-04-16T16:07:16Z", "raw_text": "Github issue is here -> https://github.com/mozilla-services/syncstorage-rs/issues/592"}, {"bug_id": 1630659, "is_private": false, "tags": [], "creator": "ryan@rfk.id.au", "time": "2020-04-16T20:49:58Z", "id": 14759960, "author": "ryan@rfk.id.au", "attachment_id": null, "raw_text": "ni? myself for a test user account on which to try to repro this.", "text": "ni? myself for a test user account on which to try to repro this.", "count": 2, "creation_time": "2020-04-16T20:49:58Z"}, {"is_private": false, "bug_id": 1630659, "tags": [], "creator": "ryan@rfk.id.au", "time": "2020-04-17T01:48:08Z", "id": 14760631, "author": "ryan@rfk.id.au", "raw_text": "I had a test user account with current storage URI:\n\n   https://sync-660-us-west-2.sync.services.mozilla.com/1.5/143087941\n\nPlease try migrating this account to spanner storage and I'll see if the HMAC issue appears.", "attachment_id": null, "text": "I had a test user account with current storage URI:\n\n   https://sync-660-us-west-2.sync.services.mozilla.com/1.5/143087941\n\nPlease try migrating this account to spanner storage and I'll see if the HMAC issue appears.", "count": 3, "creation_time": "2020-04-17T01:48:08Z"}, {"text": "Apologies, I just noticed this comment yesterday.  We can not selectively 401 individual users so I had to reassign this uid to a node we have dedicated to migrating in production (815).  Then we can test the e2e migration workflow from there.\n\nYour new userid on node 815 is 143742198.  Once it syncs there, I can run the data migration to spanner, reassign the user, and 401 the node.", "attachment_id": null, "author": "eolson@mozilla.com", "id": 14776184, "is_private": false, "bug_id": 1630659, "creation_time": "2020-04-24T13:13:26Z", "count": 4, "raw_text": "Apologies, I just noticed this comment yesterday.  We can not selectively 401 individual users so I had to reassign this uid to a node we have dedicated to migrating in production (815).  Then we can test the e2e migration workflow from there.\n\nYour new userid on node 815 is 143742198.  Once it syncs there, I can run the data migration to spanner, reassign the user, and 401 the node.", "creator": "eolson@mozilla.com", "time": "2020-04-24T13:13:26Z", "tags": []}, {"raw_text": "Re-adding ni for you Ryan so you see that last bit in comment #7.", "count": 5, "creation_time": "2020-04-24T13:21:00Z", "tags": [], "creator": "rtublitz@mozilla.com", "time": "2020-04-24T13:21:00Z", "id": 14776264, "author": "rtublitz@mozilla.com", "attachment_id": null, "text": "Re-adding ni for you Ryan so you see that last bit in comment #7.", "is_private": false, "bug_id": 1630659}, {"creator": "ryan@rfk.id.au", "time": "2020-04-28T05:06:43Z", "tags": [], "bug_id": 1630659, "is_private": false, "creation_time": "2020-04-28T05:06:43Z", "text": "Thank, I can confirm that I've now synced this account to https://sync-815-us-west-2.sync.services.mozilla.com/1.5/143742198/\n\nFWIW, I believe :pjenvey had a pretty good theory about the cause of the HMAC errors over in https://github.com/mozilla-services/services-engineering/issues/45, so I would be happy to just close this bug as resolved. But I'm also happy to give it one more test from my point of view if that's useful.", "count": 6, "raw_text": "Thank, I can confirm that I've now synced this account to https://sync-815-us-west-2.sync.services.mozilla.com/1.5/143742198/\n\nFWIW, I believe :pjenvey had a pretty good theory about the cause of the HMAC errors over in https://github.com/mozilla-services/services-engineering/issues/45, so I would be happy to just close this bug as resolved. But I'm also happy to give it one more test from my point of view if that's useful.", "attachment_id": null, "author": "ryan@rfk.id.au", "id": 14783162}, {"creation_time": "2020-04-28T15:59:40Z", "text": "We were scheduled to do prod user migration testing today so I went ahead and migrated this user as well.  The new uid is 143742198", "count": 7, "raw_text": "We were scheduled to do prod user migration testing today so I went ahead and migrated this user as well.  The new uid is 143742198", "attachment_id": null, "author": "eolson@mozilla.com", "id": 14784173, "time": "2020-04-28T15:59:40Z", "creator": "eolson@mozilla.com", "tags": [], "bug_id": 1630659, "is_private": false}, {"tags": [], "creator": "ryan@rfk.id.au", "time": "2020-04-28T23:16:19Z", "raw_text": "Thanks. After a fresh sync this profile is now syncing successfully to https://sync-1-us-west1-g.sync.services.mozilla.com/1.5/144105202/\n\n>  The new uid is 143742198\n\nWhich, I note that I got a different uid to the one you shared above, is this something to be concerned about? The browser did not appear to re-upload any of its data (apart from tabs) which IIUC indicates that things were migrated successfully on the backend.\n\nThere were no HMAC errors present during the sync.", "count": 8, "creation_time": "2020-04-28T23:16:19Z", "is_private": false, "bug_id": 1630659, "id": 14785258, "author": "ryan@rfk.id.au", "attachment_id": null, "text": "Thanks. After a fresh sync this profile is now syncing successfully to https://sync-1-us-west1-g.sync.services.mozilla.com/1.5/144105202/\n\n>  The new uid is 143742198\n\nWhich, I note that I got a different uid to the one you shared above, is this something to be concerned about? The browser did not appear to re-upload any of its data (apart from tabs) which IIUC indicates that things were migrated successfully on the backend.\n\nThere were no HMAC errors present during the sync."}, {"creation_time": "2020-04-29T00:47:12Z", "count": 9, "raw_text": "Indeed, your new uid should be `144105202`.  In my haste, I forgot that your new id for the spanner node would not be created until the first sync.  The uid I mentioned above was for the client's time on the migrate sync-py node.\n\nI pulled the server logs, these are all the requests:\n```\ntimestamp                       request                                                                   status  request_length  bytes_sent\n2020-04-28 23:11:26.661374 UTC  GET /1.5/144105202/info/collections HTTP/1.1                              200     1140.0          186.0\n2020-04-28 23:11:26.868866 UTC  GET /1.5/144105202/info/configuration HTTP/1.1                            200     1143.0          165.0\n2020-04-28 23:11:27.100393 UTC  GET /1.5/144105202/storage/meta/global HTTP/1.1                           200     1144.0          577.0\n2020-04-28 23:11:27.315571 UTC  GET /1.5/144105202/storage/meta/global HTTP/1.1                           200     1144.0          577.0\n2020-04-28 23:11:27.526238 UTC  GET /1.5/144105202/storage/crypto/keys HTTP/1.1                           200     1143.0          402.0\n2020-04-28 23:11:27.742528 UTC  GET /1.5/144105202/info/collections HTTP/1.1                              200     1140.0          186.0\n2020-04-28 23:11:27.943604 UTC  GET /1.5/144105202/info/configuration HTTP/1.1                            200     1142.0          165.0\n2020-04-28 23:11:28.159722 UTC  GET /1.5/144105202/storage/clients?full=1&limit=1000 HTTP/1.1             200     1158.0          540.0\n2020-04-28 23:11:28.461233 UTC  POST /1.5/144105202/storage/clients?batch=true&commit=true HTTP/1.1       200     1791.0          65.0\n2020-04-28 23:11:28.802279 UTC  POST /1.5/144105202/storage/tabs?batch=true&commit=true HTTP/1.1          200     1906.0          65.0\n2020-04-28 23:12:25.167678 UTC  GET /1.5/144105202/info/collections HTTP/1.1                              200     1141.0          207.0\n2020-04-28 23:12:25.395196 UTC  GET /1.5/144105202/info/collection_counts HTTP/1.1                        200     1146.0          101.0\n2020-04-28 23:12:25.655342 UTC  GET /1.5/144105202/storage/bookmarks?full=1&limit=1000 HTTP/1.1           200     1160.0          4064.0\n2020-04-28 23:12:25.657521 UTC  GET /1.5/144105202/storage/clients?full=1&limit=1000 HTTP/1.1             200     1158.0          540.0\n2020-04-28 23:12:25.658093 UTC  GET /1.5/144105202/storage/forms?full=1&limit=1000 HTTP/1.1               200     1156.0          308.0\n2020-04-28 23:12:25.658534 UTC  GET /1.5/144105202/storage/crypto?full=1&limit=1000 HTTP/1.1              200     1156.0          404.0\n2020-04-28 23:12:25.658955 UTC  GET /1.5/144105202/storage/addons?full=1&limit=1000 HTTP/1.1              200     1157.0          478.0\n2020-04-28 23:12:25.666260 UTC  GET /1.5/144105202/storage/meta?full=1&limit=1000 HTTP/1.1                200     1155.0          579.0\n2020-04-28 23:12:25.672740 UTC  GET /1.5/144105202/storage/tabs?full=1&limit=1000 HTTP/1.1                200     1155.0          668.0\n2020-04-28 23:12:25.674269 UTC  GET /1.5/144105202/storage/prefs?full=1&limit=1000 HTTP/1.1               200     1156.0          9763.0\n2020-04-28 23:12:25.675369 UTC  GET /1.5/144105202/storage/history?full=1&sort=index&limit=1000 HTTP/1.1  200     1169.0          5592.0\n```\nBy the number of gets, I suspect you were using about-sync add-on?", "time": "2020-04-29T00:47:12Z", "creator": "eolson@mozilla.com", "tags": [], "text": "Indeed, your new uid should be `144105202`.  In my haste, I forgot that your new id for the spanner node would not be created until the first sync.  The uid I mentioned above was for the client's time on the migrate sync-py node.\n\nI pulled the server logs, these are all the requests:\n```\ntimestamp                       request                                                                   status  request_length  bytes_sent\n2020-04-28 23:11:26.661374 UTC  GET /1.5/144105202/info/collections HTTP/1.1                              200     1140.0          186.0\n2020-04-28 23:11:26.868866 UTC  GET /1.5/144105202/info/configuration HTTP/1.1                            200     1143.0          165.0\n2020-04-28 23:11:27.100393 UTC  GET /1.5/144105202/storage/meta/global HTTP/1.1                           200     1144.0          577.0\n2020-04-28 23:11:27.315571 UTC  GET /1.5/144105202/storage/meta/global HTTP/1.1                           200     1144.0          577.0\n2020-04-28 23:11:27.526238 UTC  GET /1.5/144105202/storage/crypto/keys HTTP/1.1                           200     1143.0          402.0\n2020-04-28 23:11:27.742528 UTC  GET /1.5/144105202/info/collections HTTP/1.1                              200     1140.0          186.0\n2020-04-28 23:11:27.943604 UTC  GET /1.5/144105202/info/configuration HTTP/1.1                            200     1142.0          165.0\n2020-04-28 23:11:28.159722 UTC  GET /1.5/144105202/storage/clients?full=1&limit=1000 HTTP/1.1             200     1158.0          540.0\n2020-04-28 23:11:28.461233 UTC  POST /1.5/144105202/storage/clients?batch=true&commit=true HTTP/1.1       200     1791.0          65.0\n2020-04-28 23:11:28.802279 UTC  POST /1.5/144105202/storage/tabs?batch=true&commit=true HTTP/1.1          200     1906.0          65.0\n2020-04-28 23:12:25.167678 UTC  GET /1.5/144105202/info/collections HTTP/1.1                              200     1141.0          207.0\n2020-04-28 23:12:25.395196 UTC  GET /1.5/144105202/info/collection_counts HTTP/1.1                        200     1146.0          101.0\n2020-04-28 23:12:25.655342 UTC  GET /1.5/144105202/storage/bookmarks?full=1&limit=1000 HTTP/1.1           200     1160.0          4064.0\n2020-04-28 23:12:25.657521 UTC  GET /1.5/144105202/storage/clients?full=1&limit=1000 HTTP/1.1             200     1158.0          540.0\n2020-04-28 23:12:25.658093 UTC  GET /1.5/144105202/storage/forms?full=1&limit=1000 HTTP/1.1               200     1156.0          308.0\n2020-04-28 23:12:25.658534 UTC  GET /1.5/144105202/storage/crypto?full=1&limit=1000 HTTP/1.1              200     1156.0          404.0\n2020-04-28 23:12:25.658955 UTC  GET /1.5/144105202/storage/addons?full=1&limit=1000 HTTP/1.1              200     1157.0          478.0\n2020-04-28 23:12:25.666260 UTC  GET /1.5/144105202/storage/meta?full=1&limit=1000 HTTP/1.1                200     1155.0          579.0\n2020-04-28 23:12:25.672740 UTC  GET /1.5/144105202/storage/tabs?full=1&limit=1000 HTTP/1.1                200     1155.0          668.0\n2020-04-28 23:12:25.674269 UTC  GET /1.5/144105202/storage/prefs?full=1&limit=1000 HTTP/1.1               200     1156.0          9763.0\n2020-04-28 23:12:25.675369 UTC  GET /1.5/144105202/storage/history?full=1&sort=index&limit=1000 HTTP/1.1  200     1169.0          5592.0\n```\nBy the number of gets, I suspect you were using about-sync add-on?", "attachment_id": null, "author": "eolson@mozilla.com", "id": 14785359, "bug_id": 1630659, "is_private": false}, {"creation_time": "2020-04-29T01:04:44Z", "count": 10, "raw_text": "> By the number of gets, I suspect you were using about-sync add-on?\n\nIndeed I am.", "time": "2020-04-29T01:04:44Z", "creator": "ryan@rfk.id.au", "tags": [], "text": "> By the number of gets, I suspect you were using about-sync add-on?\n\nIndeed I am.", "attachment_id": null, "author": "ryan@rfk.id.au", "id": 14785376, "is_private": false, "bug_id": 1630659}, {"tags": [], "time": "2020-04-29T14:40:23Z", "creator": "eolson@mozilla.com", "raw_text": "Thanks for you help!  Closing this bug now.", "count": 11, "creation_time": "2020-04-29T14:40:23Z", "bug_id": 1630659, "is_private": false, "id": 14786276, "author": "eolson@mozilla.com", "attachment_id": null, "text": "Thanks for you help!  Closing this bug now."}]}}, "comments": {}}