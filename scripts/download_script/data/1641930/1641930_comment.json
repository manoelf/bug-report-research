{"bugs": {"1641930": {"comments": [{"attachment_id": null, "bug_id": 1641930, "author": "tlong@mozilla.com", "id": 14852044, "text": "This should also include validation of the legacy telemetry id in the deletion-request ping.", "raw_text": "This should also include validation of the legacy telemetry id in the deletion-request ping.", "is_private": false, "time": "2020-05-29T16:52:14Z", "count": 0, "tags": [], "creator": "tlong@mozilla.com", "creation_time": "2020-05-29T16:52:14Z"}, {"time": "2020-06-22T19:15:39Z", "count": 1, "tags": [], "creator": "tlong@mozilla.com", "creation_time": "2020-06-22T19:15:39Z", "attachment_id": null, "bug_id": 1641930, "author": "tlong@mozilla.com", "id": 14894883, "raw_text": "## Firefox for iOS Glean baseline vs. legacy telemetry validation\n\n### Scope\n\nThis validation will be limited to 1 week of pings received from Firefox-iOS version 26.0 from June 7th, 2020 through \nJune 13th, 2020.  \n\n[This includes 88,262,026 legacy pings from 2,947,657 clients, and 133,242,291 baseline pings from 2,995,399 clients.](https://sql.telemetry.mozilla.org/queries/72148/source)\n\n### Session Durations\n\nThis was the first product I found while doing one of these validations [that actually had valid durations reported in the legacy telemetry!](https://sql.telemetry.mozilla.org/queries/72149/source#181014).  Aside from quite a few more legacy pings reporting zero duration than Glean, the comparison between the two looks fairly reasonable.\n\n### Ping and Client Counts\n\nIf we observe the [ping and client counts by hour](https://sql.telemetry.mozilla.org/queries/71790/source#180190), Glean consistently counts around 3.5% more clients than legacy, while sending about 20% more pings.\n\n### Ping Duplication Rates\n\n [There are less Glean dupes produced by fewer clients than legacy dupes and clients.](https://sql.telemetry.mozilla.org/queries/72150/source#181016)\n\n### Environment Counts\n\nThe following are comparisons of the counts between legacy and Glean telemetry based on different environment data.\n\n#### [Counts by Device](https://sql.telemetry.mozilla.org/queries/72151/source#181018)\n\nAs expected, we see more pings coming from Glean, but the client counts are very consistent between Glean and legacy.\n\n#### [Counts by Locale](https://sql.telemetry.mozilla.org/queries/72152/source#181020)\n\nAgain, no surprises here with the same overall trend of more baseline pings but consistent client counts between\nlegacy and Glean telemetry.  \n\n#### [Counts by OS Version](https://sql.telemetry.mozilla.org/queries/72153/source#181022)\n\nThe trend continues here with more baseline pings and consistent client counts.\n\n#### [Counts by Timezone](https://sql.telemetry.mozilla.org/queries/72155/source#181025)\n\nOnce again, the trend continues with more baseline pings than legacy pings, and very similar client counts.  \n\n#### [Counts by Geo-Country](https://sql.telemetry.mozilla.org/queries/72157/source#181029)\n\nThe final environment variable I looked at didn't turn up any surprises either, continuing the same trend of more baseline pings and consistent client counts.\n\n### Conclusions\n\nBased on everything I've seen, it looks like Glean will give us counts that are consistent with legacy telemetry on\nFirefox-iOS.  While we do see more pings from Glean than legacy, this can be explained by the addition of the \"foreground\" reason to the baseline ping.", "text": "## Firefox for iOS Glean baseline vs. legacy telemetry validation\n\n### Scope\n\nThis validation will be limited to 1 week of pings received from Firefox-iOS version 26.0 from June 7th, 2020 through \nJune 13th, 2020.  \n\n[This includes 88,262,026 legacy pings from 2,947,657 clients, and 133,242,291 baseline pings from 2,995,399 clients.](https://sql.telemetry.mozilla.org/queries/72148/source)\n\n### Session Durations\n\nThis was the first product I found while doing one of these validations [that actually had valid durations reported in the legacy telemetry!](https://sql.telemetry.mozilla.org/queries/72149/source#181014).  Aside from quite a few more legacy pings reporting zero duration than Glean, the comparison between the two looks fairly reasonable.\n\n### Ping and Client Counts\n\nIf we observe the [ping and client counts by hour](https://sql.telemetry.mozilla.org/queries/71790/source#180190), Glean consistently counts around 3.5% more clients than legacy, while sending about 20% more pings.\n\n### Ping Duplication Rates\n\n [There are less Glean dupes produced by fewer clients than legacy dupes and clients.](https://sql.telemetry.mozilla.org/queries/72150/source#181016)\n\n### Environment Counts\n\nThe following are comparisons of the counts between legacy and Glean telemetry based on different environment data.\n\n#### [Counts by Device](https://sql.telemetry.mozilla.org/queries/72151/source#181018)\n\nAs expected, we see more pings coming from Glean, but the client counts are very consistent between Glean and legacy.\n\n#### [Counts by Locale](https://sql.telemetry.mozilla.org/queries/72152/source#181020)\n\nAgain, no surprises here with the same overall trend of more baseline pings but consistent client counts between\nlegacy and Glean telemetry.  \n\n#### [Counts by OS Version](https://sql.telemetry.mozilla.org/queries/72153/source#181022)\n\nThe trend continues here with more baseline pings and consistent client counts.\n\n#### [Counts by Timezone](https://sql.telemetry.mozilla.org/queries/72155/source#181025)\n\nOnce again, the trend continues with more baseline pings than legacy pings, and very similar client counts.  \n\n#### [Counts by Geo-Country](https://sql.telemetry.mozilla.org/queries/72157/source#181029)\n\nThe final environment variable I looked at didn't turn up any surprises either, continuing the same trend of more baseline pings and consistent client counts.\n\n### Conclusions\n\nBased on everything I've seen, it looks like Glean will give us counts that are consistent with legacy telemetry on\nFirefox-iOS.  While we do see more pings from Glean than legacy, this can be explained by the addition of the \"foreground\" reason to the baseline ping.", "is_private": false}, {"is_private": false, "text": "The legacy telemetry id in the deletion-request ping has yet to make it to release (it will be in the next release at the end of month), but I was able to smoke-test this in the beta version:\nhttps://sql.telemetry.mozilla.org/queries/72161/source", "raw_text": "The legacy telemetry id in the deletion-request ping has yet to make it to release (it will be in the next release at the end of month), but I was able to smoke-test this in the beta version:\nhttps://sql.telemetry.mozilla.org/queries/72161/source", "id": 14894916, "creation_time": "2020-06-22T19:30:42Z", "author": "tlong@mozilla.com", "creator": "tlong@mozilla.com", "tags": [], "bug_id": 1641930, "count": 2, "time": "2020-06-22T19:30:42Z", "attachment_id": null}, {"is_private": false, "text": "Overall this seems clear and correct. I have some requests, however...\n\n(In reply to Travis Long [:travis_] from comment #1)\n> ## Firefox for iOS Glean baseline vs. legacy telemetry validation\n> \n> ### Session Durations\n> \n> This was the first product I found while doing one of these validations [that actually had valid durations reported in the legacy telemetry!](https://sql.telemetry.mozilla.org/queries/72149/source#181014).  Aside from quite a few more legacy pings reporting zero duration than Glean, the comparison between the two looks fairly reasonable.\n\nCan you venture any hypothesis about why this might be? Or what this might mean as a result for anyone analyzing using Glean after having used legacy stuff?\n \n> ### Ping and Client Counts\n> \n> If we observe the [ping and client counts by hour](https://sql.telemetry.mozilla.org/queries/71790/source#180190), Glean consistently counts around 3.5% more clients than legacy, while sending about 20% more pings.\n\nYou didn't mention that you were comparing 7-hour averages of differences. It'd be nice to be able to inspect the unaveraged differences as well in either the same or a separate visualisation. \n\nAlso, do you have any theories about the repeating 24-hour seasonality of the differences? \n \n> ### Ping Duplication Rates\n> \n>  [There are less Glean dupes produced by fewer clients than legacy dupes and clients.](https://sql.telemetry.mozilla.org/queries/72150/source#181016)\n\n(( I'd personally have used `COUNTIF` instead of `SUM(IF(...))` for the `*_dupe_clients` ))\n\nShould the increasing number of duplicates worry us? It's symmetric, so I expect not, but perhaps we should take a look at these counts in proportion to the total number of pings and clients as well?\n\n> ### Environment Counts\n\nI like the portable approach of the query design here as it makes the group much easier to review. I'm intrigued by why you needed the `WHERE EXISTS` (I was expecting an outer join of some kind)\n\nAlso, I'd have liked a differences plot so the scale wasn't working against us for seeing whether there's any pronounced differences or notable absences in one dataset or another.\n \n> ### Conclusions\n> \n> Based on everything I've seen, it looks like Glean will give us counts that are consistent with legacy telemetry on\n> Firefox-iOS.  While we do see more pings from Glean than legacy, this can be explained by the addition of the \"foreground\" reason to the baseline ping.\n\nAh, it \"can be explained\" can it? Do you have an example query excluding other baseline ping reasons to back up this claim? : D", "raw_text": "Overall this seems clear and correct. I have some requests, however...\n\n(In reply to Travis Long [:travis_] from comment #1)\n> ## Firefox for iOS Glean baseline vs. legacy telemetry validation\n> \n> ### Session Durations\n> \n> This was the first product I found while doing one of these validations [that actually had valid durations reported in the legacy telemetry!](https://sql.telemetry.mozilla.org/queries/72149/source#181014).  Aside from quite a few more legacy pings reporting zero duration than Glean, the comparison between the two looks fairly reasonable.\n\nCan you venture any hypothesis about why this might be? Or what this might mean as a result for anyone analyzing using Glean after having used legacy stuff?\n \n> ### Ping and Client Counts\n> \n> If we observe the [ping and client counts by hour](https://sql.telemetry.mozilla.org/queries/71790/source#180190), Glean consistently counts around 3.5% more clients than legacy, while sending about 20% more pings.\n\nYou didn't mention that you were comparing 7-hour averages of differences. It'd be nice to be able to inspect the unaveraged differences as well in either the same or a separate visualisation. \n\nAlso, do you have any theories about the repeating 24-hour seasonality of the differences? \n \n> ### Ping Duplication Rates\n> \n>  [There are less Glean dupes produced by fewer clients than legacy dupes and clients.](https://sql.telemetry.mozilla.org/queries/72150/source#181016)\n\n(( I'd personally have used `COUNTIF` instead of `SUM(IF(...))` for the `*_dupe_clients` ))\n\nShould the increasing number of duplicates worry us? It's symmetric, so I expect not, but perhaps we should take a look at these counts in proportion to the total number of pings and clients as well?\n\n> ### Environment Counts\n\nI like the portable approach of the query design here as it makes the group much easier to review. I'm intrigued by why you needed the `WHERE EXISTS` (I was expecting an outer join of some kind)\n\nAlso, I'd have liked a differences plot so the scale wasn't working against us for seeing whether there's any pronounced differences or notable absences in one dataset or another.\n \n> ### Conclusions\n> \n> Based on everything I've seen, it looks like Glean will give us counts that are consistent with legacy telemetry on\n> Firefox-iOS.  While we do see more pings from Glean than legacy, this can be explained by the addition of the \"foreground\" reason to the baseline ping.\n\nAh, it \"can be explained\" can it? Do you have an example query excluding other baseline ping reasons to back up this claim? : D", "author": "chutten@mozilla.com", "id": 14895137, "bug_id": 1641930, "attachment_id": null, "creation_time": "2020-06-22T21:16:29Z", "creator": "chutten@mozilla.com", "tags": [], "count": 3, "time": "2020-06-22T21:16:29Z"}, {"tags": [], "count": 4, "time": "2020-06-23T18:38:17Z", "creation_time": "2020-06-23T18:38:17Z", "creator": "tlong@mozilla.com", "bug_id": 1641930, "attachment_id": null, "is_private": false, "raw_text": "(In reply to Chris H-C :chutten from comment #3)\n> Overall this seems clear and correct. I have some requests, however...\n> \n> (In reply to Travis Long [:travis_] from comment #1)\n> > ## Firefox for iOS Glean baseline vs. legacy telemetry validation\n> > \n> > ### Session Durations\n> > \n> > This was the first product I found while doing one of these validations [that actually had valid durations reported in the legacy telemetry!](https://sql.telemetry.mozilla.org/queries/72149/source#181014).  Aside from quite a few more legacy pings reporting zero duration than Glean, the comparison between the two looks fairly reasonable.\n> \n> Can you venture any hypothesis about why this might be? Or what this might mean as a result for anyone analyzing using Glean after having used legacy stuff?\n\nMy best guess hypothesis to explain this ties into what I have seen with other legacy enabled apps, in that I just think that a large portion of the time no valid duration gets recorded, which in legacy telemetry, results in a zero being transmitted for ingestion.  The only other thing that comes to mind is within the extensions, legacy does record telemetry so perhaps the different behavior of the extensions plays a part in recording zero durations.  Unfortunately, there's no real way that legacy telemetry indicates whether it was recorded from an extension or the base app, that I can tell.\n\n> > ### Ping and Client Counts\n> > \n> > If we observe the [ping and client counts by hour](https://sql.telemetry.mozilla.org/queries/71790/source#180190), Glean consistently counts around 3.5% more clients than legacy, while sending about 20% more pings.\n> \n> You didn't mention that you were comparing 7-hour averages of differences. It'd be nice to be able to inspect the unaveraged differences as well in either the same or a separate visualisation. \n\nOops, I forgot I had smoothing left on in there.  I have now removed the `AVG() OVER()` from that query so it isn't being smoothed anymore.\n\n> Also, do you have any theories about the repeating 24-hour seasonality of the differences? \n\nNo, now that you mention it, that is a _very_ interesting feature of the ping count differences.  Removing the smoothing makes it even more pronounced with hourly features lining up at the same times every day.  You could almost tell time by it ;).  I spoke to Marissa about this and she suggested slicing this by time zone to see what happens and it looks like the seasonality we see in this chart _may_ be explained by different sized populations of time zones going through their normal 24 hour usage seasonality and combined together.\n\n> > ### Ping Duplication Rates\n> > \n> >  [There are less Glean dupes produced by fewer clients than legacy dupes and clients.](https://sql.telemetry.mozilla.org/queries/72150/source#181016)\n> \n> (( I'd personally have used `COUNTIF` instead of `SUM(IF(...))` for the `*_dupe_clients` ))\n> \n> Should the increasing number of duplicates worry us? It's symmetric, so I expect not, but perhaps we should take a look at these counts in proportion to the total number of pings and clients as well?\n\nI looked at this in proportion to the counts, and I added a normalized rate for the dupe pings and dupe clients to the query and it does appear that dupe ping rates are increasing slightly but the dupe clients rate is fairly steady.\n\n> > ### Environment Counts\n> \n> I like the portable approach of the query design here as it makes the group much easier to review. I'm intrigued by why you needed the `WHERE EXISTS` (I was expecting an outer join of some kind)\n\nYeah, I think this was mostly me getting stuck getting the join to work like I wanted and finding a solution that worked for me somewhere online or in a similar query.  Happy to learn better ways of doing this :)\n\n> Also, I'd have liked a differences plot so the scale wasn't working against us for seeing whether there's any pronounced differences or notable absences in one dataset or another.\n\nYeah, that's probably a better idea to show the differences rather than the counts.  The charts were a PITA to conform to the difference in scale from pings to clients.\n\n> > ### Conclusions\n> > \n> > Based on everything I've seen, it looks like Glean will give us counts that are consistent with legacy telemetry on\n> > Firefox-iOS.  While we do see more pings from Glean than legacy, this can be explained by the addition of the \"foreground\" reason to the baseline ping.\n> \n> Ah, it \"can be explained\" can it? Do you have an example query excluding other baseline ping reasons to back up this claim? : D\n\nChallenge accepted: https://sql.telemetry.mozilla.org/queries/72193/source#181086.  This chart shows the baseline ping counts broken down by reason compared to the legacy ping counts.  I wish I could have stacked some but not all of the y-axes fields...", "text": "(In reply to Chris H-C :chutten from comment #3)\n> Overall this seems clear and correct. I have some requests, however...\n> \n> (In reply to Travis Long [:travis_] from comment #1)\n> > ## Firefox for iOS Glean baseline vs. legacy telemetry validation\n> > \n> > ### Session Durations\n> > \n> > This was the first product I found while doing one of these validations [that actually had valid durations reported in the legacy telemetry!](https://sql.telemetry.mozilla.org/queries/72149/source#181014).  Aside from quite a few more legacy pings reporting zero duration than Glean, the comparison between the two looks fairly reasonable.\n> \n> Can you venture any hypothesis about why this might be? Or what this might mean as a result for anyone analyzing using Glean after having used legacy stuff?\n\nMy best guess hypothesis to explain this ties into what I have seen with other legacy enabled apps, in that I just think that a large portion of the time no valid duration gets recorded, which in legacy telemetry, results in a zero being transmitted for ingestion.  The only other thing that comes to mind is within the extensions, legacy does record telemetry so perhaps the different behavior of the extensions plays a part in recording zero durations.  Unfortunately, there's no real way that legacy telemetry indicates whether it was recorded from an extension or the base app, that I can tell.\n\n> > ### Ping and Client Counts\n> > \n> > If we observe the [ping and client counts by hour](https://sql.telemetry.mozilla.org/queries/71790/source#180190), Glean consistently counts around 3.5% more clients than legacy, while sending about 20% more pings.\n> \n> You didn't mention that you were comparing 7-hour averages of differences. It'd be nice to be able to inspect the unaveraged differences as well in either the same or a separate visualisation. \n\nOops, I forgot I had smoothing left on in there.  I have now removed the `AVG() OVER()` from that query so it isn't being smoothed anymore.\n\n> Also, do you have any theories about the repeating 24-hour seasonality of the differences? \n\nNo, now that you mention it, that is a _very_ interesting feature of the ping count differences.  Removing the smoothing makes it even more pronounced with hourly features lining up at the same times every day.  You could almost tell time by it ;).  I spoke to Marissa about this and she suggested slicing this by time zone to see what happens and it looks like the seasonality we see in this chart _may_ be explained by different sized populations of time zones going through their normal 24 hour usage seasonality and combined together.\n\n> > ### Ping Duplication Rates\n> > \n> >  [There are less Glean dupes produced by fewer clients than legacy dupes and clients.](https://sql.telemetry.mozilla.org/queries/72150/source#181016)\n> \n> (( I'd personally have used `COUNTIF` instead of `SUM(IF(...))` for the `*_dupe_clients` ))\n> \n> Should the increasing number of duplicates worry us? It's symmetric, so I expect not, but perhaps we should take a look at these counts in proportion to the total number of pings and clients as well?\n\nI looked at this in proportion to the counts, and I added a normalized rate for the dupe pings and dupe clients to the query and it does appear that dupe ping rates are increasing slightly but the dupe clients rate is fairly steady.\n\n> > ### Environment Counts\n> \n> I like the portable approach of the query design here as it makes the group much easier to review. I'm intrigued by why you needed the `WHERE EXISTS` (I was expecting an outer join of some kind)\n\nYeah, I think this was mostly me getting stuck getting the join to work like I wanted and finding a solution that worked for me somewhere online or in a similar query.  Happy to learn better ways of doing this :)\n\n> Also, I'd have liked a differences plot so the scale wasn't working against us for seeing whether there's any pronounced differences or notable absences in one dataset or another.\n\nYeah, that's probably a better idea to show the differences rather than the counts.  The charts were a PITA to conform to the difference in scale from pings to clients.\n\n> > ### Conclusions\n> > \n> > Based on everything I've seen, it looks like Glean will give us counts that are consistent with legacy telemetry on\n> > Firefox-iOS.  While we do see more pings from Glean than legacy, this can be explained by the addition of the \"foreground\" reason to the baseline ping.\n> \n> Ah, it \"can be explained\" can it? Do you have an example query excluding other baseline ping reasons to back up this claim? : D\n\nChallenge accepted: https://sql.telemetry.mozilla.org/queries/72193/source#181086.  This chart shows the baseline ping counts broken down by reason compared to the legacy ping counts.  I wish I could have stacked some but not all of the y-axes fields...", "author": "tlong@mozilla.com", "id": 14897372}, {"attachment_id": null, "bug_id": 1641930, "id": 14897521, "author": "chutten@mozilla.com", "is_private": false, "raw_text": "The explanations and updates look good to me.", "text": "The explanations and updates look good to me.", "time": "2020-06-23T19:57:06Z", "tags": [], "count": 5, "creation_time": "2020-06-23T19:57:06Z", "creator": "chutten@mozilla.com"}]}}, "comments": {}}