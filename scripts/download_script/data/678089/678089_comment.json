{"bugs": {"678089": {"comments": [{"count": 0, "text": "in a recent m-c build, I loaded:\nhttp://medicalxpress.com/news/2011-08-drug-viral-infection.html\nwhich looks like it opened:\n\"http://video.unrulymedia.com/iframe_43248912_flash.html?d=1312558182698#uuid=109x110x117x105x47x111x112x106x117x100x102x103x111x106x46x109x98x115x106x119x46x104x118x115x101x46x57x49x46x50x50x49x51x48x116x120x102x111x48x110x112x100x47x116x116x102x115x113x121x109x98x100x106x101x102x110x48x48x59x113x117x117x105x\"\n\nin an frame.\n\nAfter doing this, I noticed that firefox was consistently eating 100% of my cpu\nand in fact, it spent nearly 50% of its time in:\n3267015  45.4113  libxul.so                firefox                  nsLineBox::LastChild() const\nand, the most common backtrace I've seen is:\n#0  nsLineBox::LastChild (this=0x7f2a6c785bd8) at /home/mrosenberg/src/central/central/layout/generic/nsLineBox.cpp:243\n#1  0x00007f2add275012 in nsBlockFrame::DoRemoveFrame (this=0x7f2a69feda50, aDeletedFrame=0x7f2ab00b78d0, aFlags=2)\n    at /home/mrosenberg/src/central/central/layout/generic/nsBlockFrame.cpp:5403\n#2  0x00007f2add2752f2 in nsBlockFrame::RemoveFrame (this=0x7f2a69feda50, aListName=<value optimized out>, \n    aOldFrame=0x7f2ab00b78d0) at /home/mrosenberg/src/central/central/layout/generic/nsBlockFrame.cpp:5033\n#3  0x00007f2add2403cb in nsFrameManager::RemoveFrame (this=<value optimized out>, aListName=<value optimized out>, \n    aOldFrame=<value optimized out>) at /home/mrosenberg/src/central/central/layout/base/nsFrameManager.cpp:510\n#4  0x00007f2add224e2e in nsCSSFrameConstructor::ContentRemoved (this=0x7f2a691f0000, aContainer=0x7f2a72e0d580, \n    aChild=0x7f2a72834ed0, aOldNextSibling=0x7f2a72834f80, aFlags=nsCSSFrameConstructor::REMOVE_CONTENT, \n    aDidReconstruct=<value optimized out>)\n    at /home/mrosenberg/src/central/central/layout/base/nsCSSFrameConstructor.cpp:7501\n#5  0x00007f2add251436 in PresShell::ContentRemoved (this=0x7f2a691ef400, aDocument=<value optimized out>, \n    aContainer=0x7f2a72e0d580, aChild=0x7f2a72834ed0, aIndexInContainer=0, aPreviousSibling=<value optimized out>)\n    at /home/mrosenberg/src/central/central/layout/base/nsPresShell.cpp:5039\n#6  0x00007f2add3c1ef6 in nsNodeUtils::ContentRemoved (aContainer=<value optimized out>, aChild=0x7f2a72834ed0, \n    aIndexInContainer=0, aPreviousSibling=0x0)\n    at /home/mrosenberg/src/central/central/content/base/src/nsNodeUtils.cpp:196\n#7  0x00007f2add3b75bf in nsINode::doRemoveChildAt (this=0x7f2a72e0d580, aIndex=0, aNotify=1, aKid=0x7f2a72834ed0, \n    aChildArray=<value optimized out>)\n    at /home/mrosenberg/src/central/central/content/base/src/nsGenericElement.cpp:3559\n#8  0x00007f2add3b8af8 in nsGenericElement::RemoveChildAt (this=0x7f2a72e0d580, aIndex=0, aNotify=<value optimized out>)\n    at /home/mrosenberg/src/central/central/content/base/src/nsGenericElement.cpp:3530\n#9  0x00007f2add43b43f in nsGenericHTMLElement::SetInnerHTML (this=0x7f2a72e0d580, aInnerHTML=...)\n    at /home/mrosenberg/src/central/central/content/html/content/src/nsGenericHTMLElement.cpp:763\n#10 0x00007f2add748b67 in nsIDOMNSHTMLElement_SetInnerHTML (cx=<value optimized out>, obj=<value optimized out>, \n    id=139821749139264, strict=<value optimized out>, vp=0x7fff60e3e940)\n    at /home/mrosenberg/src/central/central/objs/opt/js/src/xpconnect/src/dom_quickstubs.cpp:22156\n#11 0x00007f2addc69c42 in CallJSPropertyOpSetter (cx=0x7f2a689f9400, obj=<value optimized out>, id=139821749139264, \n    defineHow=<value optimized out>, vp=0x7fff60e3e940, strict=0)\n    at /home/mrosenberg/src/central/central/js/src/jscntxtinlines.h:344\n#12 set (cx=0x7f2a689f9400, obj=<value optimized out>, id=139821749139264, defineHow=<value optimized out>, \n    vp=0x7fff60e3e940, strict=0) at /home/mrosenberg/src/central/central/js/src/jsscopeinlines.h:303\n#13 js_SetPropertyHelper (cx=0x7f2a689f9400, obj=<value optimized out>, id=139821749139264, \n    defineHow=<value optimized out>, vp=0x7fff60e3e940, strict=0)\n    at /home/mrosenberg/src/central/central/js/src/jsobj.cpp:5509\n#14 0x00007f2adde2825a in js::Interpret (cx=<value optimized out>, entryFrame=0x7f2accafe030, \n    interpMode=js::JSINTERP_NORMAL) at /home/mrosenberg/src/central/central/js/src/jsinterp.cpp:3823\n#15 0x00007f2addc45583 in Execute (cx=0x7f2a689f9400, script=0x7f2a6e664000, scopeChainArg=<value optimized out>, \n    rval=0x0) at /home/mrosenberg/src/central/central/js/src/jsinterp.cpp:912\n#16 js::ExternalExecute (cx=0x7f2a689f9400, script=0x7f2a6e664000, scopeChainArg=<value optimized out>, rval=0x0)\n    at /home/mrosenberg/src/central/central/js/src/jsinterp.cpp:948\n#17 0x00007f2addbd621c in EvaluateUCScriptForPrincipalsCommon (cx=0x7f2a689f9400, obj=0x7f2a6e469088, \n    principals=<value optimized out>, chars=<value optimized out>, length=<value optimized out>, \n    filename=<value optimized out>, lineno=1, rval=0x0, version=JSVERSION_DEFAULT)\n    at /home/mrosenberg/src/central/central/js/src/jsapi.cpp:4897\n#18 JS_EvaluateUCScriptForPrincipalsVersion (cx=0x7f2a689f9400, obj=0x7f2a6e469088, principals=<value optimized out>, \n    chars=<value optimized out>, length=<value optimized out>, filename=<value optimized out>, lineno=1, rval=0x0, \n    version=JSVERSION_DEFAULT) at /home/mrosenberg/src/central/central/js/src/jsapi.cpp:4913\n#19 0x00007f2add4f71e8 in EvaluateString (this=0x7f2a66dff220, aScript=..., aScopeObject=<value optimized out>, \n    aPrincipal=<value optimized out>, aURL=0x7f2a727c4348 \"http://video.unrulymedia.com/video_v28.js\", aLineNo=1, \n    aVersion=0, aRetValue=0x0, aIsUndefined=0x7fff60e3eefc)\n    at /home/mrosenberg/src/central/central/dom/base/nsJSEnvironment.cpp:1461\n#20 nsJSContext::EvaluateString (this=0x7f2a66dff220, aScript=..., aScopeObject=<value optimized out>, \n    aPrincipal=<value optimized out>, aURL=0x7f2a727c4348 \"http://video.unrulymedia.com/video_v28.js\", aLineNo=1, \n    aVersion=0, aRetValue=0x0, aIsUndefined=0x7fff60e3eefc)\n    at /home/mrosenberg/src/central/central/dom/base/nsJSEnvironment.cpp:1358\n#21 0x00007f2add3cf357 in nsScriptLoader::EvaluateScript (this=0x7f2a7588d4a0, aRequest=<value optimized out>, \n    aScript=...) at /home/mrosenberg/src/central/central/content/base/src/nsScriptLoader.cpp:906\n#22 0x00007f2add3cfe4c in nsScriptLoader::ProcessRequest (this=0x7f2a7588d4a0, aRequest=0x7f2a66d0dbf0)\n    at /home/mrosenberg/src/central/central/content/base/src/nsScriptLoader.cpp:799\n#23 0x00007f2add3d1193 in nsScriptLoader::ProcessPendingRequests (this=0x7f2a7588d4a0)\n    at /home/mrosenberg/src/central/central/content/base/src/nsScriptLoader.cpp:965\n#24 0x00007f2add3d144a in nsScriptLoader::OnStreamComplete (this=0x7f2a7588d4a0, aLoader=<value optimized out>, \n    aContext=<value optimized out>, aStatus=<value optimized out>, aStringLen=<value optimized out>, \n    aString=<value optimized out>) at /home/mrosenberg/src/central/central/content/base/src/nsScriptLoader.cpp:1183\n#25 0x00007f2add1239d5 in nsStreamLoader::OnStopRequest (this=<value optimized out>, request=<value optimized out>, \n    ctxt=<value optimized out>, aStatus=<value optimized out>)\n    at /home/mrosenberg/src/central/central/netwerk/base/src/nsStreamLoader.cpp:125\n#26 0x00007f2add1788df in nsHttpChannel::OnStopRequest (this=0x7f2a74b8b000, request=<value optimized out>, \n    ctxt=<value optimized out>, status=0)\n    at /home/mrosenberg/src/central/central/netwerk/protocol/http/nsHttpChannel.cpp:4212\n#27 0x00007f2add10e811 in nsInputStreamPump::OnStateStop (this=0x7f2a66316820)\n    at /home/mrosenberg/src/central/central/netwerk/base/src/nsInputStreamPump.cpp:578\n#28 0x00007f2add10e88f in nsInputStreamPump::OnInputStreamReady (this=0x7f2a66316820, stream=<value optimized out>)\n    at /home/mrosenberg/src/central/central/netwerk/base/src/nsInputStreamPump.cpp:403\n---Type <return> to continue, or q <return> to quit---\n#29 0x00007f2adda4f04c in nsInputStreamReadyEvent::Run (this=<value optimized out>)\n    at /home/mrosenberg/src/central/central/xpcom/io/nsStreamUtils.cpp:114\n#30 0x00007f2adda5db22 in nsThread::ProcessNextEvent (this=0x7f2ad114d110, mayWait=0, result=0x7fff60e3f24c)\n    at /home/mrosenberg/src/central/central/xpcom/threads/nsThread.cpp:631\n#31 0x00007f2adda33600 in NS_ProcessNextEvent_P (thread=<value optimized out>, mayWait=<value optimized out>)\n    at /home/mrosenberg/src/central/central/objs/opt/xpcom/build/nsThreadUtils.cpp:245\n#32 0x00007f2add9d8a0c in mozilla::ipc::MessagePump::Run (this=0x7f2ad11451c0, aDelegate=0x7f2ae00bdd30)\n    at /home/mrosenberg/src/central/central/ipc/glue/MessagePump.cpp:110\n#33 0x00007f2adda7a6ff in RunHandler (this=0x7f2ae00bdd30)\n    at /home/mrosenberg/src/central/central/ipc/chromium/src/base/message_loop.cc:205\n#34 MessageLoop::Run (this=0x7f2ae00bdd30)\n    at /home/mrosenberg/src/central/central/ipc/chromium/src/base/message_loop.cc:179\n#35 0x00007f2add93eb8c in nsBaseAppShell::Run (this=0x7f2acf4517f0)\n    at /home/mrosenberg/src/central/central/widget/src/xpwidgets/nsBaseAppShell.cpp:189\n#36 0x00007f2add818040 in nsAppStartup::Run (this=0x7f2acf4ff600)\n    at /home/mrosenberg/src/central/central/toolkit/components/startup/nsAppStartup.cpp:224\n#37 0x00007f2add0f1f58 in XRE_main (argc=<value optimized out>, argv=<value optimized out>, \n    aAppData=<value optimized out>) at /home/mrosenberg/src/central/central/toolkit/xre/nsAppRunner.cpp:3539\n#38 0x0000000000401a1c in do_main (argc=<value optimized out>, argv=<value optimized out>)\n    at /home/mrosenberg/src/central/central/browser/app/nsBrowserApp.cpp:198\n#39 main (argc=<value optimized out>, argv=<value optimized out>)\n    at /home/mrosenberg/src/central/central/browser/app/nsBrowserApp.cpp:281\n\ndholbert knows more about what is actually taking time here.", "author": "marty.rosenberg@gmail.com", "creator": "marty.rosenberg@gmail.com", "is_private": false, "creation_time": "2011-08-10T23:07:50Z", "id": 5646492, "bug_id": 678089, "raw_text": "in a recent m-c build, I loaded:\nhttp://medicalxpress.com/news/2011-08-drug-viral-infection.html\nwhich looks like it opened:\n\"http://video.unrulymedia.com/iframe_43248912_flash.html?d=1312558182698#uuid=109x110x117x105x47x111x112x106x117x100x102x103x111x106x46x109x98x115x106x119x46x104x118x115x101x46x57x49x46x50x50x49x51x48x116x120x102x111x48x110x112x100x47x116x116x102x115x113x121x109x98x100x106x101x102x110x48x48x59x113x117x117x105x\"\n\nin an frame.\n\nAfter doing this, I noticed that firefox was consistently eating 100% of my cpu\nand in fact, it spent nearly 50% of its time in:\n3267015  45.4113  libxul.so                firefox                  nsLineBox::LastChild() const\nand, the most common backtrace I've seen is:\n#0  nsLineBox::LastChild (this=0x7f2a6c785bd8) at /home/mrosenberg/src/central/central/layout/generic/nsLineBox.cpp:243\n#1  0x00007f2add275012 in nsBlockFrame::DoRemoveFrame (this=0x7f2a69feda50, aDeletedFrame=0x7f2ab00b78d0, aFlags=2)\n    at /home/mrosenberg/src/central/central/layout/generic/nsBlockFrame.cpp:5403\n#2  0x00007f2add2752f2 in nsBlockFrame::RemoveFrame (this=0x7f2a69feda50, aListName=<value optimized out>, \n    aOldFrame=0x7f2ab00b78d0) at /home/mrosenberg/src/central/central/layout/generic/nsBlockFrame.cpp:5033\n#3  0x00007f2add2403cb in nsFrameManager::RemoveFrame (this=<value optimized out>, aListName=<value optimized out>, \n    aOldFrame=<value optimized out>) at /home/mrosenberg/src/central/central/layout/base/nsFrameManager.cpp:510\n#4  0x00007f2add224e2e in nsCSSFrameConstructor::ContentRemoved (this=0x7f2a691f0000, aContainer=0x7f2a72e0d580, \n    aChild=0x7f2a72834ed0, aOldNextSibling=0x7f2a72834f80, aFlags=nsCSSFrameConstructor::REMOVE_CONTENT, \n    aDidReconstruct=<value optimized out>)\n    at /home/mrosenberg/src/central/central/layout/base/nsCSSFrameConstructor.cpp:7501\n#5  0x00007f2add251436 in PresShell::ContentRemoved (this=0x7f2a691ef400, aDocument=<value optimized out>, \n    aContainer=0x7f2a72e0d580, aChild=0x7f2a72834ed0, aIndexInContainer=0, aPreviousSibling=<value optimized out>)\n    at /home/mrosenberg/src/central/central/layout/base/nsPresShell.cpp:5039\n#6  0x00007f2add3c1ef6 in nsNodeUtils::ContentRemoved (aContainer=<value optimized out>, aChild=0x7f2a72834ed0, \n    aIndexInContainer=0, aPreviousSibling=0x0)\n    at /home/mrosenberg/src/central/central/content/base/src/nsNodeUtils.cpp:196\n#7  0x00007f2add3b75bf in nsINode::doRemoveChildAt (this=0x7f2a72e0d580, aIndex=0, aNotify=1, aKid=0x7f2a72834ed0, \n    aChildArray=<value optimized out>)\n    at /home/mrosenberg/src/central/central/content/base/src/nsGenericElement.cpp:3559\n#8  0x00007f2add3b8af8 in nsGenericElement::RemoveChildAt (this=0x7f2a72e0d580, aIndex=0, aNotify=<value optimized out>)\n    at /home/mrosenberg/src/central/central/content/base/src/nsGenericElement.cpp:3530\n#9  0x00007f2add43b43f in nsGenericHTMLElement::SetInnerHTML (this=0x7f2a72e0d580, aInnerHTML=...)\n    at /home/mrosenberg/src/central/central/content/html/content/src/nsGenericHTMLElement.cpp:763\n#10 0x00007f2add748b67 in nsIDOMNSHTMLElement_SetInnerHTML (cx=<value optimized out>, obj=<value optimized out>, \n    id=139821749139264, strict=<value optimized out>, vp=0x7fff60e3e940)\n    at /home/mrosenberg/src/central/central/objs/opt/js/src/xpconnect/src/dom_quickstubs.cpp:22156\n#11 0x00007f2addc69c42 in CallJSPropertyOpSetter (cx=0x7f2a689f9400, obj=<value optimized out>, id=139821749139264, \n    defineHow=<value optimized out>, vp=0x7fff60e3e940, strict=0)\n    at /home/mrosenberg/src/central/central/js/src/jscntxtinlines.h:344\n#12 set (cx=0x7f2a689f9400, obj=<value optimized out>, id=139821749139264, defineHow=<value optimized out>, \n    vp=0x7fff60e3e940, strict=0) at /home/mrosenberg/src/central/central/js/src/jsscopeinlines.h:303\n#13 js_SetPropertyHelper (cx=0x7f2a689f9400, obj=<value optimized out>, id=139821749139264, \n    defineHow=<value optimized out>, vp=0x7fff60e3e940, strict=0)\n    at /home/mrosenberg/src/central/central/js/src/jsobj.cpp:5509\n#14 0x00007f2adde2825a in js::Interpret (cx=<value optimized out>, entryFrame=0x7f2accafe030, \n    interpMode=js::JSINTERP_NORMAL) at /home/mrosenberg/src/central/central/js/src/jsinterp.cpp:3823\n#15 0x00007f2addc45583 in Execute (cx=0x7f2a689f9400, script=0x7f2a6e664000, scopeChainArg=<value optimized out>, \n    rval=0x0) at /home/mrosenberg/src/central/central/js/src/jsinterp.cpp:912\n#16 js::ExternalExecute (cx=0x7f2a689f9400, script=0x7f2a6e664000, scopeChainArg=<value optimized out>, rval=0x0)\n    at /home/mrosenberg/src/central/central/js/src/jsinterp.cpp:948\n#17 0x00007f2addbd621c in EvaluateUCScriptForPrincipalsCommon (cx=0x7f2a689f9400, obj=0x7f2a6e469088, \n    principals=<value optimized out>, chars=<value optimized out>, length=<value optimized out>, \n    filename=<value optimized out>, lineno=1, rval=0x0, version=JSVERSION_DEFAULT)\n    at /home/mrosenberg/src/central/central/js/src/jsapi.cpp:4897\n#18 JS_EvaluateUCScriptForPrincipalsVersion (cx=0x7f2a689f9400, obj=0x7f2a6e469088, principals=<value optimized out>, \n    chars=<value optimized out>, length=<value optimized out>, filename=<value optimized out>, lineno=1, rval=0x0, \n    version=JSVERSION_DEFAULT) at /home/mrosenberg/src/central/central/js/src/jsapi.cpp:4913\n#19 0x00007f2add4f71e8 in EvaluateString (this=0x7f2a66dff220, aScript=..., aScopeObject=<value optimized out>, \n    aPrincipal=<value optimized out>, aURL=0x7f2a727c4348 \"http://video.unrulymedia.com/video_v28.js\", aLineNo=1, \n    aVersion=0, aRetValue=0x0, aIsUndefined=0x7fff60e3eefc)\n    at /home/mrosenberg/src/central/central/dom/base/nsJSEnvironment.cpp:1461\n#20 nsJSContext::EvaluateString (this=0x7f2a66dff220, aScript=..., aScopeObject=<value optimized out>, \n    aPrincipal=<value optimized out>, aURL=0x7f2a727c4348 \"http://video.unrulymedia.com/video_v28.js\", aLineNo=1, \n    aVersion=0, aRetValue=0x0, aIsUndefined=0x7fff60e3eefc)\n    at /home/mrosenberg/src/central/central/dom/base/nsJSEnvironment.cpp:1358\n#21 0x00007f2add3cf357 in nsScriptLoader::EvaluateScript (this=0x7f2a7588d4a0, aRequest=<value optimized out>, \n    aScript=...) at /home/mrosenberg/src/central/central/content/base/src/nsScriptLoader.cpp:906\n#22 0x00007f2add3cfe4c in nsScriptLoader::ProcessRequest (this=0x7f2a7588d4a0, aRequest=0x7f2a66d0dbf0)\n    at /home/mrosenberg/src/central/central/content/base/src/nsScriptLoader.cpp:799\n#23 0x00007f2add3d1193 in nsScriptLoader::ProcessPendingRequests (this=0x7f2a7588d4a0)\n    at /home/mrosenberg/src/central/central/content/base/src/nsScriptLoader.cpp:965\n#24 0x00007f2add3d144a in nsScriptLoader::OnStreamComplete (this=0x7f2a7588d4a0, aLoader=<value optimized out>, \n    aContext=<value optimized out>, aStatus=<value optimized out>, aStringLen=<value optimized out>, \n    aString=<value optimized out>) at /home/mrosenberg/src/central/central/content/base/src/nsScriptLoader.cpp:1183\n#25 0x00007f2add1239d5 in nsStreamLoader::OnStopRequest (this=<value optimized out>, request=<value optimized out>, \n    ctxt=<value optimized out>, aStatus=<value optimized out>)\n    at /home/mrosenberg/src/central/central/netwerk/base/src/nsStreamLoader.cpp:125\n#26 0x00007f2add1788df in nsHttpChannel::OnStopRequest (this=0x7f2a74b8b000, request=<value optimized out>, \n    ctxt=<value optimized out>, status=0)\n    at /home/mrosenberg/src/central/central/netwerk/protocol/http/nsHttpChannel.cpp:4212\n#27 0x00007f2add10e811 in nsInputStreamPump::OnStateStop (this=0x7f2a66316820)\n    at /home/mrosenberg/src/central/central/netwerk/base/src/nsInputStreamPump.cpp:578\n#28 0x00007f2add10e88f in nsInputStreamPump::OnInputStreamReady (this=0x7f2a66316820, stream=<value optimized out>)\n    at /home/mrosenberg/src/central/central/netwerk/base/src/nsInputStreamPump.cpp:403\n---Type <return> to continue, or q <return> to quit---\n#29 0x00007f2adda4f04c in nsInputStreamReadyEvent::Run (this=<value optimized out>)\n    at /home/mrosenberg/src/central/central/xpcom/io/nsStreamUtils.cpp:114\n#30 0x00007f2adda5db22 in nsThread::ProcessNextEvent (this=0x7f2ad114d110, mayWait=0, result=0x7fff60e3f24c)\n    at /home/mrosenberg/src/central/central/xpcom/threads/nsThread.cpp:631\n#31 0x00007f2adda33600 in NS_ProcessNextEvent_P (thread=<value optimized out>, mayWait=<value optimized out>)\n    at /home/mrosenberg/src/central/central/objs/opt/xpcom/build/nsThreadUtils.cpp:245\n#32 0x00007f2add9d8a0c in mozilla::ipc::MessagePump::Run (this=0x7f2ad11451c0, aDelegate=0x7f2ae00bdd30)\n    at /home/mrosenberg/src/central/central/ipc/glue/MessagePump.cpp:110\n#33 0x00007f2adda7a6ff in RunHandler (this=0x7f2ae00bdd30)\n    at /home/mrosenberg/src/central/central/ipc/chromium/src/base/message_loop.cc:205\n#34 MessageLoop::Run (this=0x7f2ae00bdd30)\n    at /home/mrosenberg/src/central/central/ipc/chromium/src/base/message_loop.cc:179\n#35 0x00007f2add93eb8c in nsBaseAppShell::Run (this=0x7f2acf4517f0)\n    at /home/mrosenberg/src/central/central/widget/src/xpwidgets/nsBaseAppShell.cpp:189\n#36 0x00007f2add818040 in nsAppStartup::Run (this=0x7f2acf4ff600)\n    at /home/mrosenberg/src/central/central/toolkit/components/startup/nsAppStartup.cpp:224\n#37 0x00007f2add0f1f58 in XRE_main (argc=<value optimized out>, argv=<value optimized out>, \n    aAppData=<value optimized out>) at /home/mrosenberg/src/central/central/toolkit/xre/nsAppRunner.cpp:3539\n#38 0x0000000000401a1c in do_main (argc=<value optimized out>, argv=<value optimized out>)\n    at /home/mrosenberg/src/central/central/browser/app/nsBrowserApp.cpp:198\n#39 main (argc=<value optimized out>, argv=<value optimized out>)\n    at /home/mrosenberg/src/central/central/browser/app/nsBrowserApp.cpp:281\n\ndholbert knows more about what is actually taking time here.", "attachment_id": null, "time": "2011-08-10T23:07:50Z", "tags": []}, {"creator": "dholbert@mozilla.com", "text": "So what's going on is, we're getting repeated calls (from script) to:\n  nsGenericHTMLElement::SetInnerHTML()\n\nThat method calls \"RemoveChildAt()\" for each of its children.  And each RemoveChildAt() call triggers a call to nsLineBox::LastChild(), which walks its whole linked-list of children.\n\nSo in cases where we have all our children on the same line*, this ends up being effectively O(n^2) -- n RemoveChildAt() calls, each of which traverses O(n) frames.\n\n* (I'm assuming that's the case here; Marty saw thousands of children being traversed in LastChild() in some cases)", "count": 1, "author": "dholbert@mozilla.com", "bug_id": 678089, "id": 5646530, "creation_time": "2011-08-10T23:19:10Z", "is_private": false, "time": "2011-08-10T23:19:10Z", "raw_text": "So what's going on is, we're getting repeated calls (from script) to:\n  nsGenericHTMLElement::SetInnerHTML()\n\nThat method calls \"RemoveChildAt()\" for each of its children.  And each RemoveChildAt() call triggers a call to nsLineBox::LastChild(), which walks its whole linked-list of children.\n\nSo in cases where we have all our children on the same line*, this ends up being effectively O(n^2) -- n RemoveChildAt() calls, each of which traverses O(n) frames.\n\n* (I'm assuming that's the case here; Marty saw thousands of children being traversed in LastChild() in some cases)", "attachment_id": null, "tags": []}, {"id": 5646777, "bug_id": 678089, "creation_time": "2011-08-11T02:14:18Z", "is_private": false, "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu", "text": "This is similar to bug 506844, except the removal order doesn't matter here and it only bites in the case of a very long line.\n\nIf we really want to check whether something is the last child on a line, can't we check that it's either got no next sibling or the sibling is the first child on the next line?  We could even make a IsLastChildOnLine() method on nsLineBox for this, I'd think.  At least modulo overflow lines and the like...\n\nI keep thinking we need a better way of keeping track of where our line box boundaries are in the frame tree (e.g. by adding some flag to the first frame on each line or something).  We have tons of performance bugs due to the current line box setup.", "count": 2, "tags": [], "time": "2011-08-11T02:14:18Z", "attachment_id": null, "raw_text": "This is similar to bug 506844, except the removal order doesn't matter here and it only bites in the case of a very long line.\n\nIf we really want to check whether something is the last child on a line, can't we check that it's either got no next sibling or the sibling is the first child on the next line?  We could even make a IsLastChildOnLine() method on nsLineBox for this, I'd think.  At least modulo overflow lines and the like...\n\nI keep thinking we need a better way of keeping track of where our line box boundaries are in the frame tree (e.g. by adding some flag to the first frame on each line or something).  We have tons of performance bugs due to the current line box setup."}]}}, "comments": {}}