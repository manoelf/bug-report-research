{"comments": {}, "bugs": {"666219": {"comments": [{"creator": "maxoueb@gmail.com", "time": "2011-06-22T11:17:52Z", "creation_time": "2011-06-22T11:17:52Z", "author": "maxoueb@gmail.com", "is_private": false, "id": 5547856, "count": 0, "tags": [], "text": "User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_7) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/13.0.782.24 Safari/535.1\nBuild Identifier: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:5.0) Gecko/20100101 Firefox/5.0\n\nI'm experiencing a pretty heavy CPU usage in Firefox 5 (as in, continuously at 100+% CPU), when playing a local MP3 file on jsmad.org\n\nCapture: http://cl.ly/2b2p0l3z0E402z2I3f2h\n\nConfig:\nMac OS X 10.6.7\n2.53 GHz Intel Core 2 Duo\n4 GB 1067 MHz DDR3\nNVIDIA GeForce 9400M, 256 MB\nIntel\u00ae X25-M SSD\n\nBrowser:\nFirefox 5\nMozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:5.0) Gecko/20100101 Firefox/5.0\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Go to http://jsmad.org\n2. Open an MP3 file\n3. Play\n\nActual Results:  \nheavy CPU usage in Firefox during playback (as in, continuously at 100+% CPU)\n\nExpected Results:  \n20-25% CPU usage during playback\n\nJSmad Github thread: https://github.com/nddrylliog/jsmad/issues/18", "bug_id": 666219, "attachment_id": null, "raw_text": "User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_7) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/13.0.782.24 Safari/535.1\nBuild Identifier: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:5.0) Gecko/20100101 Firefox/5.0\n\nI'm experiencing a pretty heavy CPU usage in Firefox 5 (as in, continuously at 100+% CPU), when playing a local MP3 file on jsmad.org\n\nCapture: http://cl.ly/2b2p0l3z0E402z2I3f2h\n\nConfig:\nMac OS X 10.6.7\n2.53 GHz Intel Core 2 Duo\n4 GB 1067 MHz DDR3\nNVIDIA GeForce 9400M, 256 MB\nIntel\u00ae X25-M SSD\n\nBrowser:\nFirefox 5\nMozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:5.0) Gecko/20100101 Firefox/5.0\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Go to http://jsmad.org\n2. Open an MP3 file\n3. Play\n\nActual Results:  \nheavy CPU usage in Firefox during playback (as in, continuously at 100+% CPU)\n\nExpected Results:  \n20-25% CPU usage during playback\n\nJSmad Github thread: https://github.com/nddrylliog/jsmad/issues/18"}, {"text": "Additional details: on Firefox 4.0/WinXP and Firefox 6.0a2/WinXP it's stable at 8-9% CPU usage. On Firefox 4.0.1/Fedora15 it's stable at 20-25% CPU usage.", "bug_id": 666219, "tags": [], "raw_text": "Additional details: on Firefox 4.0/WinXP and Firefox 6.0a2/WinXP it's stable at 8-9% CPU usage. On Firefox 4.0.1/Fedora15 it's stable at 20-25% CPU usage.", "attachment_id": null, "author": "amos@official.fm", "creation_time": "2011-06-22T11:22:50Z", "time": "2011-06-22T11:22:50Z", "creator": "amos@official.fm", "id": 5547862, "count": 1, "is_private": false}, {"raw_text": "On the exact same machine (loading the same MP3 file):\n- Chrome Canary (14.0.798.0 canary): average of 19.4% CPU usage\n- Firefox Aurora 6.0a2 (Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:6.0a2) Gecko/20110619 Firefox/6.0a2): average of 104% CPU usage\n\nSomething is definitely not right with Firefox/Mac", "attachment_id": null, "bug_id": 666219, "text": "On the exact same machine (loading the same MP3 file):\n- Chrome Canary (14.0.798.0 canary): average of 19.4% CPU usage\n- Firefox Aurora 6.0a2 (Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:6.0a2) Gecko/20110619 Firefox/6.0a2): average of 104% CPU usage\n\nSomething is definitely not right with Firefox/Mac", "tags": [], "is_private": false, "id": 5547869, "count": 2, "author": "maxoueb@gmail.com", "creator": "maxoueb@gmail.com", "creation_time": "2011-06-22T11:27:33Z", "time": "2011-06-22T11:27:33Z"}, {"raw_text": "This is related to issue 665000 https://bugzilla.mozilla.org/show_bug.cgi?id=665000 . It is caused by the postMessage hack used to replace setTimeout to make it work in background tabs as well. This is a Firefox 5 -specific issue, because the code is using a worker-based approach when MozBlobBuilder is available.", "attachment_id": null, "bug_id": 666219, "text": "This is related to issue 665000 https://bugzilla.mozilla.org/show_bug.cgi?id=665000 . It is caused by the postMessage hack used to replace setTimeout to make it work in background tabs as well. This is a Firefox 5 -specific issue, because the code is using a worker-based approach when MozBlobBuilder is available.", "tags": [], "is_private": false, "count": 3, "id": 5547871, "author": "jussi.kalliokoski@gmail.com", "creator": "jussi.kalliokoski@gmail.com", "time": "2011-06-22T11:29:22Z", "creation_time": "2011-06-22T11:29:22Z"}, {"tags": [], "bug_id": 666219, "text": "@Max are those Firefox 6 results recent? (less than 10 minutes) I have recently updated jsmad.org to use the latest version of Jussi's audiolib.js, which includes a much better solution for Firefox 6. If not, please retest with that so we can see if Jussi's hypothesis is right (ie. if it's because of the postMessage hack)", "raw_text": "@Max are those Firefox 6 results recent? (less than 10 minutes) I have recently updated jsmad.org to use the latest version of Jussi's audiolib.js, which includes a much better solution for Firefox 6. If not, please retest with that so we can see if Jussi's hypothesis is right (ie. if it's because of the postMessage hack)", "attachment_id": null, "author": "amos@official.fm", "creator": "amos@official.fm", "time": "2011-06-22T11:33:49Z", "creation_time": "2011-06-22T11:33:49Z", "is_private": false, "id": 5547874, "count": 4}, {"count": 5, "id": 5547876, "is_private": false, "author": "jussi.kalliokoski@gmail.com", "time": "2011-06-22T11:36:55Z", "creation_time": "2011-06-22T11:36:55Z", "creator": "jussi.kalliokoski@gmail.com", "raw_text": "Max: The data number for Aurora 6.0a2 shouldn't be right anymore, the fix for that has landed already.", "attachment_id": null, "text": "Max: The data number for Aurora 6.0a2 shouldn't be right anymore, the fix for that has landed already.", "bug_id": 666219, "tags": []}, {"id": 5547882, "count": 6, "is_private": false, "author": "jussi.kalliokoski@gmail.com", "creation_time": "2011-06-22T11:45:44Z", "time": "2011-06-22T11:45:44Z", "creator": "jussi.kalliokoski@gmail.com", "raw_text": "I personally think the clamping should be disabled by default until 6.0, where a workaround exists, but I bet you guys on the other end don't like that idea too much. :P", "attachment_id": null, "text": "I personally think the clamping should be disabled by default until 6.0, where a workaround exists, but I bet you guys on the other end don't like that idea too much. :P", "bug_id": 666219, "tags": []}, {"raw_text": "I just updated Aurora (Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:6.0a2) Gecko/20110621 Firefox/6.0a2), and the results are indeed better, CPU load is now between 43% and 78%", "attachment_id": null, "tags": [], "text": "I just updated Aurora (Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:6.0a2) Gecko/20110621 Firefox/6.0a2), and the results are indeed better, CPU load is now between 43% and 78%", "bug_id": 666219, "id": 5547888, "count": 7, "is_private": false, "author": "maxoueb@gmail.com", "creation_time": "2011-06-22T11:50:56Z", "time": "2011-06-22T11:50:56Z", "creator": "maxoueb@gmail.com"}, {"count": 8, "id": 5547910, "is_private": false, "author": "amos@official.fm", "creation_time": "2011-06-22T12:02:08Z", "time": "2011-06-22T12:02:08Z", "creator": "amos@official.fm", "raw_text": "(In reply to comment #7)\n> I just updated Aurora (Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6;\n> rv:6.0a2) Gecko/20110621 Firefox/6.0a2), and the results are indeed better,\n> CPU load is now between 43% and 78%\n\nThat's still much, much worse than on Win32 and Linux. Something's definitely fishy.\n\n(In reply to comment #6)\n> I personally think the clamping should be disabled by default until 6.0\n\nThat's my opinion as well. I was disappointed that such a bug was in Firefox 5.0 and that the attitude was \"we'll see what we can learn from this release and apply it to 6.0\". Are stable releases considered alpha quality now?", "attachment_id": null, "bug_id": 666219, "text": "(In reply to comment #7)\n> I just updated Aurora (Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6;\n> rv:6.0a2) Gecko/20110621 Firefox/6.0a2), and the results are indeed better,\n> CPU load is now between 43% and 78%\n\nThat's still much, much worse than on Win32 and Linux. Something's definitely fishy.\n\n(In reply to comment #6)\n> I personally think the clamping should be disabled by default until 6.0\n\nThat's my opinion as well. I was disappointed that such a bug was in Firefox 5.0 and that the attitude was \"we'll see what we can learn from this release and apply it to 6.0\". Are stable releases considered alpha quality now?", "tags": []}, {"raw_text": "No, stable releases aren't considered alpha quality.  But throttling background tabs was important for overall CPU usage.  We knew of one thing, this turned out to be another.\n\nNote that Chrome is also going to be (or is) doing the same throttling.  Their Audio APIs are different enough where they don't run into the mismatch that causes problems with this type of library.\n\nWe need to work on a solution so that libraries that want to produce sound in the background like jsmad can continue to work without having to be timer-based.", "attachment_id": null, "tags": [], "bug_id": 666219, "text": "No, stable releases aren't considered alpha quality.  But throttling background tabs was important for overall CPU usage.  We knew of one thing, this turned out to be another.\n\nNote that Chrome is also going to be (or is) doing the same throttling.  Their Audio APIs are different enough where they don't run into the mismatch that causes problems with this type of library.\n\nWe need to work on a solution so that libraries that want to produce sound in the background like jsmad can continue to work without having to be timer-based.", "count": 9, "id": 5548415, "is_private": false, "author": "blizzard@mozilla.com", "creation_time": "2011-06-22T16:21:49Z", "time": "2011-06-22T16:21:49Z", "creator": "blizzard@mozilla.com"}, {"text": "Can someone describe how the work-around works in Firefox 5?", "bug_id": 666219, "tags": [], "raw_text": "Can someone describe how the work-around works in Firefox 5?", "attachment_id": null, "author": "blizzard@mozilla.com", "creation_time": "2011-06-22T16:31:10Z", "time": "2011-06-22T16:31:10Z", "creator": "blizzard@mozilla.com", "count": 10, "id": 5548454, "is_private": false}, {"creator": "david.humphrey@senecacollege.ca", "creation_time": "2011-06-22T16:38:07Z", "time": "2011-06-22T16:38:07Z", "author": "david.humphrey@senecacollege.ca", "is_private": false, "count": 11, "id": 5548481, "tags": [], "bug_id": 666219, "text": "(In reply to comment #10)\n> Can someone describe how the work-around works in Firefox 5?\n\nChris, smaug was the one that suggested this.", "attachment_id": null, "raw_text": "(In reply to comment #10)\n> Can someone describe how the work-around works in Firefox 5?\n\nChris, smaug was the one that suggested this."}, {"attachment_id": null, "raw_text": "(In reply to comment #10)\n> Can someone describe how the work-around works in Firefox 5?\n\nWell, I didn't write it (Jussi did), but I think here's the gist of it: https://github.com/jussi-kalliokoski/audiolib.js/blob/master/lib/audiolib.js#L1020\n\n(lines 1020 to 1032)\n\n(In reply to comment #9)\n> No, stable releases aren't considered alpha quality.  But throttling\n> background tabs was important for overall CPU usage.  We knew of one thing,\n> this turned out to be another.\n\nThat's understandable, considering that right now, very few applications do background audio in pure JS.\n\nHowever, if FF5 reveals to be a very bad platform to do that, there are many chances that there won't be more applications doing that. Hence the proposal to postpone timeout clamping until FF6, where we have a better solution available.\n \n> Note that Chrome is also going to be (or is) doing the same throttling. \n> Their Audio APIs are different enough where they don't run into the mismatch\n> that causes problems with this type of library.\n\nI also have interrogations about why there are two APIs, and whether developers will have to juggle between them indefinitely but that discussion is definitely too broad for this bug report :)\n\n> We need to work on a solution so that libraries that want to produce sound\n> in the background like jsmad can continue to work without having to be\n> timer-based.\n\nAs far as I know, that solution exists, and has been implemented in Firefox 6 (Audio workers). Jussi has integrated this solution in audiolib.js 0.4.6, and it works like a charm in Aurora. However, with FF5, we're stuck with the ugly postMessage hack. Hence, again, the proposal to only clamp timeouts starting with FF6.\n\n(I realize that it's too late for FF5.0, but I've heard Firefox is going to get the continuous silent update system, so I'm still hoping.)", "bug_id": 666219, "text": "(In reply to comment #10)\n> Can someone describe how the work-around works in Firefox 5?\n\nWell, I didn't write it (Jussi did), but I think here's the gist of it: https://github.com/jussi-kalliokoski/audiolib.js/blob/master/lib/audiolib.js#L1020\n\n(lines 1020 to 1032)\n\n(In reply to comment #9)\n> No, stable releases aren't considered alpha quality.  But throttling\n> background tabs was important for overall CPU usage.  We knew of one thing,\n> this turned out to be another.\n\nThat's understandable, considering that right now, very few applications do background audio in pure JS.\n\nHowever, if FF5 reveals to be a very bad platform to do that, there are many chances that there won't be more applications doing that. Hence the proposal to postpone timeout clamping until FF6, where we have a better solution available.\n \n> Note that Chrome is also going to be (or is) doing the same throttling. \n> Their Audio APIs are different enough where they don't run into the mismatch\n> that causes problems with this type of library.\n\nI also have interrogations about why there are two APIs, and whether developers will have to juggle between them indefinitely but that discussion is definitely too broad for this bug report :)\n\n> We need to work on a solution so that libraries that want to produce sound\n> in the background like jsmad can continue to work without having to be\n> timer-based.\n\nAs far as I know, that solution exists, and has been implemented in Firefox 6 (Audio workers). Jussi has integrated this solution in audiolib.js 0.4.6, and it works like a charm in Aurora. However, with FF5, we're stuck with the ugly postMessage hack. Hence, again, the proposal to only clamp timeouts starting with FF6.\n\n(I realize that it's too late for FF5.0, but I've heard Firefox is going to get the continuous silent update system, so I'm still hoping.)", "tags": [], "is_private": false, "id": 5548508, "count": 12, "creator": "amos@official.fm", "creation_time": "2011-06-22T16:45:58Z", "time": "2011-06-22T16:45:58Z", "author": "amos@official.fm"}, {"count": 13, "id": 11143748, "is_private": false, "author": "vseerror@lehigh.edu", "time": "2016-02-06T12:18:24Z", "creation_time": "2016-02-06T12:18:24Z", "creator": "vseerror@lehigh.edu", "raw_text": "jsmad.org testcase is gone, site has been taken over", "attachment_id": null, "tags": [], "bug_id": 666219, "text": "jsmad.org testcase is gone, site has been taken over"}]}}}