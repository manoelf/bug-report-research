{"comments": {}, "bugs": {"707822": {"comments": [{"attachment_id": null, "raw_text": "In implementing Debugger, several times I needed to change a js_InternalInterpret case, but had a very difficult time producing a test that would reliably reach that path. In general, recompilations have a big impact on what's actually going on inside the engine, but are hard to reliably trigger. There should be an easy way for tests to force recompilations to happen at specific points.\n\nMy specific case: The REJOIN_THIS_PROTOTYPE case in js_InternalInterpret calls ScriptDebugEpilogue, but it is impossible to trigger reliably: ic::GetPropNoCache must cause a recompilation, which it only does when ic::GetProp calls ValueToObject and that lazily initializes a primitive class. I ended up manually adding a call to JS_GC to ic::GetPropNoCache to test the code, and then removing it.\n\nThere should be a way for a test to say, \"DebugProbes.GetPropNoCacheRecompilation = true;\", and then for the C++ code to check something and force a recompilation at that point. In non-DEBUG code, we should let the compiler see that the condition is never true, so it can toss the code.", "id": 5893733, "creator": "jimb@mozilla.com", "is_private": false, "author": "jimb@mozilla.com", "creation_time": "2011-12-05T21:56:16Z", "tags": [], "time": "2011-12-05T21:56:16Z", "text": "In implementing Debugger, several times I needed to change a js_InternalInterpret case, but had a very difficult time producing a test that would reliably reach that path. In general, recompilations have a big impact on what's actually going on inside the engine, but are hard to reliably trigger. There should be an easy way for tests to force recompilations to happen at specific points.\n\nMy specific case: The REJOIN_THIS_PROTOTYPE case in js_InternalInterpret calls ScriptDebugEpilogue, but it is impossible to trigger reliably: ic::GetPropNoCache must cause a recompilation, which it only does when ic::GetProp calls ValueToObject and that lazily initializes a primitive class. I ended up manually adding a call to JS_GC to ic::GetPropNoCache to test the code, and then removing it.\n\nThere should be a way for a test to say, \"DebugProbes.GetPropNoCacheRecompilation = true;\", and then for the C++ code to check something and force a recompilation at that point. In non-DEBUG code, we should let the compiler see that the condition is never true, so it can toss the code.", "count": 0, "bug_id": 707822}]}}}