{"comments": {}, "bugs": {"646351": {"comments": [{"attachment_id": null, "tags": [], "creation_time": "2011-03-30T06:08:37Z", "creator": "al_9x@yahoo.com", "raw_text": "User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0) Gecko/20100101 Firefox/4.0\nBuild Identifier: Mozilla/5.0 (Windows NT 5.1; rv:2.0) Gecko/20100101 Firefox/4.0\n\nFx 4.0.0 & 3.6.16\n\n\nReproducible: Always\n\nSteps to Reproduce:\n1. xp sp3, Fx 4.0.0, new profile\n2. set browser.download.manager.addToRecentDocs = false\n3. right click on a link (e.g. \"Our Mission\" - http://www.mozilla.org/about/mission.html on http://www.mozilla.org/)\n4. \"Save Link As...\"\n5. after it's downloaded, mission.html is added to recent docs", "bug_id": 646351, "text": "User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0) Gecko/20100101 Firefox/4.0\nBuild Identifier: Mozilla/5.0 (Windows NT 5.1; rv:2.0) Gecko/20100101 Firefox/4.0\n\nFx 4.0.0 & 3.6.16\n\n\nReproducible: Always\n\nSteps to Reproduce:\n1. xp sp3, Fx 4.0.0, new profile\n2. set browser.download.manager.addToRecentDocs = false\n3. right click on a link (e.g. \"Our Mission\" - http://www.mozilla.org/about/mission.html on http://www.mozilla.org/)\n4. \"Save Link As...\"\n5. after it's downloaded, mission.html is added to recent docs", "is_private": false, "count": 0, "author": "al_9x@yahoo.com", "time": "2011-03-30T06:08:37Z", "id": 5379674}, {"id": 5380603, "is_private": false, "author": "xtc4uall@gmail.com", "bug_id": 646351, "attachment_id": null, "tags": [], "creation_time": "2011-03-30T16:47:25Z", "count": 1, "time": "2011-03-30T16:47:25Z", "text": "Can you test against 3.5/3.0 too?", "creator": "xtc4uall@gmail.com", "raw_text": "Can you test against 3.5/3.0 too?"}, {"time": "2011-03-30T17:22:54Z", "count": 2, "raw_text": "(In reply to comment #1)\n> Can you test against 3.5/3.0 too?\n\nsame", "creator": "al_9x@yahoo.com", "text": "(In reply to comment #1)\n> Can you test against 3.5/3.0 too?\n\nsame", "author": "al_9x@yahoo.com", "is_private": false, "id": 5380732, "creation_time": "2011-03-30T17:22:54Z", "tags": [], "attachment_id": null, "bug_id": 646351}, {"count": 3, "time": "2011-03-30T21:03:43Z", "text": "See bug 310071 comment 6 - we don't explicitly make the call to add the document if the pref is false, but if you use the file picker to save the file, Windows will add the file to recent docs on its own - I don't think we can control that. \n\nOur setting should take effect when you have the download manager automatically save files to your downloads folder without asking.\n\nCan you confirm that that explains what you're seeing?", "creator": "gavin.sharp@gmail.com", "raw_text": "See bug 310071 comment 6 - we don't explicitly make the call to add the document if the pref is false, but if you use the file picker to save the file, Windows will add the file to recent docs on its own - I don't think we can control that. \n\nOur setting should take effect when you have the download manager automatically save files to your downloads folder without asking.\n\nCan you confirm that that explains what you're seeing?", "id": 5381392, "author": "gavin.sharp@gmail.com", "is_private": false, "bug_id": 646351, "attachment_id": null, "tags": [], "creation_time": "2011-03-30T21:03:43Z"}, {"author": "al_9x@yahoo.com", "time": "2011-03-30T22:11:14Z", "count": 4, "is_private": false, "id": 5381600, "raw_text": "(In reply to comment #3)\n> See bug 310071 comment 6 - we don't explicitly make the call to add the\n> document if the pref is false, but if you use the file picker to save the file,\n> Windows will add the file to recent docs on its own - I don't think we can\n> control that.\n\nOFN_DONTADDTORECENT\nhttp://msdn.microsoft.com/en-us/library/ms646839%28VS.85%29.aspx\n\n> \n> Our setting should take effect when you have the download manager automatically\n> save files to your downloads folder without asking.\n\nIf it's as easy as passing OFN_DONTADDTORECEN to GetSaveFileName, your setting should take effect regardless.", "creator": "al_9x@yahoo.com", "tags": [], "creation_time": "2011-03-30T22:11:14Z", "attachment_id": null, "text": "(In reply to comment #3)\n> See bug 310071 comment 6 - we don't explicitly make the call to add the\n> document if the pref is false, but if you use the file picker to save the file,\n> Windows will add the file to recent docs on its own - I don't think we can\n> control that.\n\nOFN_DONTADDTORECENT\nhttp://msdn.microsoft.com/en-us/library/ms646839%28VS.85%29.aspx\n\n> \n> Our setting should take effect when you have the download manager automatically\n> save files to your downloads folder without asking.\n\nIf it's as easy as passing OFN_DONTADDTORECEN to GetSaveFileName, your setting should take effect regardless.", "bug_id": 646351}, {"raw_text": "Ah, good find. The file picker code (where we call GetSaveFileName) is lower level and generic (used by all gecko platform consumers, not just the download manager), so ideally we'd make that behavior controllable for nsIFilePicker users, but perhaps as a first step we should just make OFN_DONTADDTORECEN the default.", "creator": "gavin.sharp@gmail.com", "tags": [], "creation_time": "2011-04-17T01:13:46Z", "attachment_id": null, "text": "Ah, good find. The file picker code (where we call GetSaveFileName) is lower level and generic (used by all gecko platform consumers, not just the download manager), so ideally we'd make that behavior controllable for nsIFilePicker users, but perhaps as a first step we should just make OFN_DONTADDTORECEN the default.", "bug_id": 646351, "time": "2011-04-17T01:13:46Z", "author": "gavin.sharp@gmail.com", "count": 5, "is_private": false, "id": 5414148}, {"bug_id": 646351, "tags": [], "creation_time": "2011-04-17T18:54:42Z", "attachment_id": null, "id": 5414697, "is_private": false, "author": "sdwilsh@forerunnerdesigns.com", "text": "(In reply to comment #5)\n> Ah, good find. The file picker code (where we call GetSaveFileName) is lower\n> level and generic (used by all gecko platform consumers, not just the download\n> manager), so ideally we'd make that behavior controllable for nsIFilePicker\n> users, but perhaps as a first step we should just make OFN_DONTADDTORECEN the\n> default.\nRob or Jim, do you have thoughts on the best approach here?", "raw_text": "(In reply to comment #5)\n> Ah, good find. The file picker code (where we call GetSaveFileName) is lower\n> level and generic (used by all gecko platform consumers, not just the download\n> manager), so ideally we'd make that behavior controllable for nsIFilePicker\n> users, but perhaps as a first step we should just make OFN_DONTADDTORECEN the\n> default.\nRob or Jim, do you have thoughts on the best approach here?", "creator": "sdwilsh@forerunnerdesigns.com", "time": "2011-04-17T18:54:42Z", "count": 6}, {"bug_id": 646351, "attachment_id": null, "tags": [], "creation_time": "2011-04-18T23:24:21Z", "id": 5417196, "author": "robert.strong.bugs@gmail.com", "is_private": false, "text": "I personally don't think OFN_DONTADDTORECEN should be the default. Besides that comment #5 seems like the way to go.", "creator": "robert.strong.bugs@gmail.com", "raw_text": "I personally don't think OFN_DONTADDTORECEN should be the default. Besides that comment #5 seems like the way to go.", "count": 7, "time": "2011-04-18T23:24:21Z"}, {"time": "2011-04-18T23:42:24Z", "count": 8, "raw_text": "IMHO, we should tie these settings to privacy mode. If not active, we should populate the information in windows and get rid of the pref.", "creator": "jmathies@mozilla.com", "text": "IMHO, we should tie these settings to privacy mode. If not active, we should populate the information in windows and get rid of the pref.", "is_private": false, "author": "jmathies@mozilla.com", "id": 5417255, "creation_time": "2011-04-18T23:42:24Z", "tags": [], "attachment_id": null, "bug_id": 646351}, {"attachment_id": null, "tags": [], "creation_time": "2011-04-18T23:51:52Z", "creator": "al_9x@yahoo.com", "raw_text": "(In reply to comment #7)\n> I personally don't think OFN_DONTADDTORECEN should be the default. Besides that\n> comment #5 seems like the way to go.\n\nIt's pretty senseless behavior for GetSaveFileName to add to recent docs by default, because all it does is construct a path, the actual file may never be created.  If you cancel a download in Fx, the recent docs entry remains for a nonexistent file.\n\nWhy should recent docs be polluted with phantom entries?  If a recent docs entry is desired, it should be created manually upon a successful saving of the file (as already happens), not by GetSaveFileName.  So OFN_DONTADDTORECENT is quite a sensible default.  Why are you against it?", "bug_id": 646351, "text": "(In reply to comment #7)\n> I personally don't think OFN_DONTADDTORECEN should be the default. Besides that\n> comment #5 seems like the way to go.\n\nIt's pretty senseless behavior for GetSaveFileName to add to recent docs by default, because all it does is construct a path, the actual file may never be created.  If you cancel a download in Fx, the recent docs entry remains for a nonexistent file.\n\nWhy should recent docs be polluted with phantom entries?  If a recent docs entry is desired, it should be created manually upon a successful saving of the file (as already happens), not by GetSaveFileName.  So OFN_DONTADDTORECENT is quite a sensible default.  Why are you against it?", "is_private": false, "count": 9, "time": "2011-04-18T23:51:52Z", "author": "al_9x@yahoo.com", "id": 5417274}, {"id": 5417290, "is_private": false, "count": 10, "author": "robert.strong.bugs@gmail.com", "time": "2011-04-18T23:57:12Z", "bug_id": 646351, "text": "It wasn't clear that saved files would be added by default to the recent list. If they are on success then even better.", "attachment_id": null, "tags": [], "creation_time": "2011-04-18T23:57:12Z", "creator": "robert.strong.bugs@gmail.com", "raw_text": "It wasn't clear that saved files would be added by default to the recent list. If they are on success then even better."}, {"raw_text": "(In reply to comment #8)\n> IMHO, we should tie these settings to privacy mode. If not active, we should\n> populate the information in windows and get rid of the pref.\n\nIt's not (only) a privacy issue.  I only want to see docs I explicitly opened in recent docs, keeping downloads out has utility.\n\nBut even from a privacy perspective, there are prefs to individually control all privacy related modules (cookies, history, cache, downloads, etc) when not in privacy mode, why would you take away that ability for recent docs?", "creator": "al_9x@yahoo.com", "tags": [], "creation_time": "2011-04-19T00:03:07Z", "attachment_id": null, "text": "(In reply to comment #8)\n> IMHO, we should tie these settings to privacy mode. If not active, we should\n> populate the information in windows and get rid of the pref.\n\nIt's not (only) a privacy issue.  I only want to see docs I explicitly opened in recent docs, keeping downloads out has utility.\n\nBut even from a privacy perspective, there are prefs to individually control all privacy related modules (cookies, history, cache, downloads, etc) when not in privacy mode, why would you take away that ability for recent docs?", "bug_id": 646351, "time": "2011-04-19T00:03:07Z", "author": "al_9x@yahoo.com", "count": 11, "is_private": false, "id": 5417308}, {"creation_time": "2011-04-19T00:09:01Z", "tags": [], "attachment_id": null, "bug_id": 646351, "author": "al_9x@yahoo.com", "is_private": false, "id": 5417320, "raw_text": "(In reply to comment #10)\n> It wasn't clear that saved files would be added by default to the recent list.\n> If they are on success then even better.\n\nNot sure if I understood you, so you agree now, knowing that there is a manual add to recent on download finish, that OFN_DONTADDTORECENT would be a good default?", "creator": "al_9x@yahoo.com", "text": "(In reply to comment #10)\n> It wasn't clear that saved files would be added by default to the recent list.\n> If they are on success then even better.\n\nNot sure if I understood you, so you agree now, knowing that there is a manual add to recent on download finish, that OFN_DONTADDTORECENT would be a good default?", "time": "2011-04-19T00:09:01Z", "count": 12}, {"creation_time": "2011-04-19T00:22:08Z", "tags": [], "attachment_id": null, "raw_text": "Correct. I would go as far as to say that if all call sites handle success / failure that it would be good to just use OFN_DONTADDTORECENT and require call sites to add themselves to the recent list.", "creator": "robert.strong.bugs@gmail.com", "bug_id": 646351, "text": "Correct. I would go as far as to say that if all call sites handle success / failure that it would be good to just use OFN_DONTADDTORECENT and require call sites to add themselves to the recent list.", "is_private": false, "time": "2011-04-19T00:22:08Z", "author": "robert.strong.bugs@gmail.com", "count": 13, "id": 5417345}, {"count": 14, "time": "2011-04-19T01:06:17Z", "creator": "jmathies@mozilla.com", "raw_text": "(In reply to comment #11)\n> (In reply to comment #8)\n> > IMHO, we should tie these settings to privacy mode. If not active, we should\n> > populate the information in windows and get rid of the pref.\n> \n> It's not (only) a privacy issue.  I only want to see docs I explicitly opened\n> in recent docs, keeping downloads out has utility.\n> \n> But even from a privacy perspective, there are prefs to individually control\n> all privacy related modules (cookies, history, cache, downloads, etc) when not\n> in privacy mode, why would you take away that ability for recent docs?\n\nBecause we have too many prefs which add complexity to the code making things slower, bloated, and hard to maintain. When the recent docs code in download manager was written we didn't have a privacy mode. Now we do, so maybe it's time to eliminate the pref and rely solely on privacy settings.", "text": "(In reply to comment #11)\n> (In reply to comment #8)\n> > IMHO, we should tie these settings to privacy mode. If not active, we should\n> > populate the information in windows and get rid of the pref.\n> \n> It's not (only) a privacy issue.  I only want to see docs I explicitly opened\n> in recent docs, keeping downloads out has utility.\n> \n> But even from a privacy perspective, there are prefs to individually control\n> all privacy related modules (cookies, history, cache, downloads, etc) when not\n> in privacy mode, why would you take away that ability for recent docs?\n\nBecause we have too many prefs which add complexity to the code making things slower, bloated, and hard to maintain. When the recent docs code in download manager was written we didn't have a privacy mode. Now we do, so maybe it's time to eliminate the pref and rely solely on privacy settings.", "is_private": false, "author": "jmathies@mozilla.com", "id": 5417420, "attachment_id": null, "tags": [], "creation_time": "2011-04-19T01:06:17Z", "bug_id": 646351}, {"creator": "al_9x@yahoo.com", "raw_text": "(In reply to comment #14)\n> Because we have too many prefs which add complexity to the code making things\n> slower, bloated, and hard to maintain.\n\nThe following code is not complex, bloated, slow, or hard to maintain.  Are you overwhelmed by it? \n______________________________________________________________________\nPRBool addToRecentDocs = PR_TRUE;\nif (pref)\n  pref->GetBoolPref(PREF_BDM_ADDTORECENTDOCS, &addToRecentDocs);\n\nif (addToRecentDocs &&\n    !nsDownloadManager::gDownloadManagerService->mInPrivateBrowsing) {\n  ::SHAddToRecentDocs(SHARD_PATHW, path.get());\n}\n______________________________________________________________________\n\n\n> When the recent docs code in download\n> manager was written we didn't have a privacy mode. Now we do, so maybe it's\n> time to eliminate the pref and rely solely on privacy settings.\n\nYou didn't have privacy mode when most or all the prefs controlling functionality with privacy implications were added.  Do you want to take them all away?  Leave the user with no control over cookies, history, cache, downloads in normal browsing mode?\n\nAnd did you miss the part about this being not only a privacy feature?  There is value in trying to limit recent docs to files you explicitly open.", "text": "(In reply to comment #14)\n> Because we have too many prefs which add complexity to the code making things\n> slower, bloated, and hard to maintain.\n\nThe following code is not complex, bloated, slow, or hard to maintain.  Are you overwhelmed by it? \n______________________________________________________________________\nPRBool addToRecentDocs = PR_TRUE;\nif (pref)\n  pref->GetBoolPref(PREF_BDM_ADDTORECENTDOCS, &addToRecentDocs);\n\nif (addToRecentDocs &&\n    !nsDownloadManager::gDownloadManagerService->mInPrivateBrowsing) {\n  ::SHAddToRecentDocs(SHARD_PATHW, path.get());\n}\n______________________________________________________________________\n\n\n> When the recent docs code in download\n> manager was written we didn't have a privacy mode. Now we do, so maybe it's\n> time to eliminate the pref and rely solely on privacy settings.\n\nYou didn't have privacy mode when most or all the prefs controlling functionality with privacy implications were added.  Do you want to take them all away?  Leave the user with no control over cookies, history, cache, downloads in normal browsing mode?\n\nAnd did you miss the part about this being not only a privacy feature?  There is value in trying to limit recent docs to files you explicitly open.", "count": 15, "time": "2011-04-19T02:11:44Z", "attachment_id": null, "creation_time": "2011-04-19T02:11:44Z", "tags": [], "bug_id": 646351, "is_private": false, "author": "al_9x@yahoo.com", "id": 5417558}, {"bug_id": 646351, "attachment_id": null, "creation_time": "2011-04-19T04:06:30Z", "tags": [], "id": 5417760, "is_private": false, "author": "sdwilsh@forerunnerdesigns.com", "text": "(In reply to comment #15)\n> The following code is not complex, bloated, slow, or hard to maintain.  Are you\n> overwhelmed by it? \nI am, and I'm the module owner of this code, although I'm not advocating for its removal at this time.", "creator": "sdwilsh@forerunnerdesigns.com", "raw_text": "(In reply to comment #15)\n> The following code is not complex, bloated, slow, or hard to maintain.  Are you\n> overwhelmed by it? \nI am, and I'm the module owner of this code, although I'm not advocating for its removal at this time.", "count": 16, "time": "2011-04-19T04:06:30Z"}, {"bug_id": 646351, "attachment_id": null, "creation_time": "2011-04-19T05:22:16Z", "tags": [], "id": 5417867, "is_private": false, "author": "al_9x@yahoo.com", "text": "(In reply to comment #16)\n> I am, and I'm the module owner of this code, although I'm not advocating for\n> its removal at this time.\n\nI guess I shouldn't be surprised, you found the following beyond your capacity to maintain in Bug 178506\n______________________________________________________________________\n\nPRBool setLastModifiedTime = PR_FALSE;\nif (pref)\n    pref->GetBoolPref(PREF_BDM_SETLASTMODIFIEDTIME,&setLastModifiedTime);\nif (setLastModifiedTime)\n    (void)file->SetLastModifiedTime(GetLastModifiedTime(mRequest));\n______________________________________________________________________\n\nThe two snippets of pref code I quoted are as trivial as it gets.  The idea that you are genuinely overwhelmed by their complexity, bloat, and unmaintainability is absurd.  I am seeing this \"pref=(slow, bloated, unmaintainable)\" mantra repeated more and more often, but it's an excuse only, because it's a lie.  There is perhaps much bloated, slow, unmaintainable code in Mozilla, but these trivial, tiny snippets of pref code are not it.", "creator": "al_9x@yahoo.com", "raw_text": "(In reply to comment #16)\n> I am, and I'm the module owner of this code, although I'm not advocating for\n> its removal at this time.\n\nI guess I shouldn't be surprised, you found the following beyond your capacity to maintain in Bug 178506\n______________________________________________________________________\n\nPRBool setLastModifiedTime = PR_FALSE;\nif (pref)\n    pref->GetBoolPref(PREF_BDM_SETLASTMODIFIEDTIME,&setLastModifiedTime);\nif (setLastModifiedTime)\n    (void)file->SetLastModifiedTime(GetLastModifiedTime(mRequest));\n______________________________________________________________________\n\nThe two snippets of pref code I quoted are as trivial as it gets.  The idea that you are genuinely overwhelmed by their complexity, bloat, and unmaintainability is absurd.  I am seeing this \"pref=(slow, bloated, unmaintainable)\" mantra repeated more and more often, but it's an excuse only, because it's a lie.  There is perhaps much bloated, slow, unmaintainable code in Mozilla, but these trivial, tiny snippets of pref code are not it.", "count": 17, "time": "2011-04-19T05:22:16Z"}, {"id": 5418218, "count": 18, "author": "jmathies@mozilla.com", "time": "2011-04-19T11:39:51Z", "is_private": false, "text": "(In reply to comment #6)\n> (In reply to comment #5)\n> > Ah, good find. The file picker code (where we call GetSaveFileName) is lower\n> > level and generic (used by all gecko platform consumers, not just the download\n> > manager), so ideally we'd make that behavior controllable for nsIFilePicker\n> > users, but perhaps as a first step we should just make OFN_DONTADDTORECEN the\n> > default.\n> Rob or Jim, do you have thoughts on the best approach here?\n\nI really don't have strong feelings on this, although I suspect for every user we have that thinks this should be the default, we have an equal number of users who rely on the behavior and would be upset if we changed it. We've probably had this since version 1.0. I don't think though that we should add yet another pref to control whether or not we use it. :)\n\nI'm more curious if this represents a privacy leak while in privacy mode. That option should be set when saving a file in that case. I'll do some testing to see if it is.\n\nOn removing the pref, that's out of scope for this bug, so I'll file a new one. Recent Docs is pretty much obsolete on Win7, it's not visible by default and the option to turn it on is buried deep in taskbar settings. In general it's been replace by relevant search through the start menu.", "bug_id": 646351, "creator": "jmathies@mozilla.com", "raw_text": "(In reply to comment #6)\n> (In reply to comment #5)\n> > Ah, good find. The file picker code (where we call GetSaveFileName) is lower\n> > level and generic (used by all gecko platform consumers, not just the download\n> > manager), so ideally we'd make that behavior controllable for nsIFilePicker\n> > users, but perhaps as a first step we should just make OFN_DONTADDTORECEN the\n> > default.\n> Rob or Jim, do you have thoughts on the best approach here?\n\nI really don't have strong feelings on this, although I suspect for every user we have that thinks this should be the default, we have an equal number of users who rely on the behavior and would be upset if we changed it. We've probably had this since version 1.0. I don't think though that we should add yet another pref to control whether or not we use it. :)\n\nI'm more curious if this represents a privacy leak while in privacy mode. That option should be set when saving a file in that case. I'll do some testing to see if it is.\n\nOn removing the pref, that's out of scope for this bug, so I'll file a new one. Recent Docs is pretty much obsolete on Win7, it's not visible by default and the option to turn it on is buried deep in taskbar settings. In general it's been replace by relevant search through the start menu.", "attachment_id": null, "creation_time": "2011-04-19T11:39:51Z", "tags": []}, {"raw_text": "", "creator": "jmathies@mozilla.com", "text": "Created attachment 534544\npart 1 - content utils", "time": "2011-05-23T20:30:17Z", "count": 19, "tags": [], "creation_time": "2011-05-23T20:30:17Z", "attachment_id": 534544, "bug_id": 646351, "is_private": false, "author": "jmathies@mozilla.com", "id": 5487421}, {"is_private": false, "count": 20, "author": "mak@mozilla.com", "time": "2019-06-12T10:23:56Z", "id": 14176039, "attachment_id": null, "tags": [], "creation_time": "2019-06-12T10:23:56Z", "creator": "mak@mozilla.com", "raw_text": "", "bug_id": 646351, "text": "*** Bug 1557831 has been marked as a duplicate of this bug. ***"}]}}}