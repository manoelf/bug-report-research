{"bugs": {"634391": {"comments": [{"attachment_id": null, "time": "2011-02-15T21:32:04Z", "is_private": false, "author": "michi_1111@yahoo.de", "bug_id": 634391, "tags": [], "creator": "michi_1111@yahoo.de", "count": 0, "raw_text": "User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0b11) Gecko/20100101 Firefox/4.0b11\nBuild Identifier: Firefox 4.0b11\n\nPopupNotifications.show() does not attach the notification to the supplied anchorId. \n\nReproducible: Always\n\nSteps to Reproduce:\n1. Execute the JavaScript command to show a notification attached to the addon bar on the bottom:\nPopupNotifications.show(gBrowser.selectedBrowser,\n  \"id\",\n  \"message\",\n  \"addon-bar\", /* <- anchorID */\n  null, /* mainAction */\n  null, /* secondaryActions */\n  null /* options */\n);\n\nActual Results:  \nThe notification is always attached to the original \"notification-popup-box\".\n\nExpected Results:  \nThe notification should be attached to the addon bar (\"addon-bar\") on the bottom.\n\nIn PopupNotifications.jsm in line 76, the querySelector function returns null even if the element with the supplied anchorID exists (e.g., \"addon-bar\", \"TabsToolbar\", or even \"notification-popup-box\").\n\n[code]\n    anchorElement = this.owner.iconBox.querySelector(\"#\"+this.anchorID);\n\n    if (!anchorElement)\n      anchorElement = this.owner.iconBox;\n[/code]", "id": 5281021, "text": "User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0b11) Gecko/20100101 Firefox/4.0b11\nBuild Identifier: Firefox 4.0b11\n\nPopupNotifications.show() does not attach the notification to the supplied anchorId. \n\nReproducible: Always\n\nSteps to Reproduce:\n1. Execute the JavaScript command to show a notification attached to the addon bar on the bottom:\nPopupNotifications.show(gBrowser.selectedBrowser,\n  \"id\",\n  \"message\",\n  \"addon-bar\", /* <- anchorID */\n  null, /* mainAction */\n  null, /* secondaryActions */\n  null /* options */\n);\n\nActual Results:  \nThe notification is always attached to the original \"notification-popup-box\".\n\nExpected Results:  \nThe notification should be attached to the addon bar (\"addon-bar\") on the bottom.\n\nIn PopupNotifications.jsm in line 76, the querySelector function returns null even if the element with the supplied anchorID exists (e.g., \"addon-bar\", \"TabsToolbar\", or even \"notification-popup-box\").\n\n[code]\n    anchorElement = this.owner.iconBox.querySelector(\"#\"+this.anchorID);\n\n    if (!anchorElement)\n      anchorElement = this.owner.iconBox;\n[/code]", "creation_time": "2011-02-15T21:32:04Z"}, {"time": "2011-02-18T23:58:37Z", "is_private": false, "attachment_id": null, "tags": [], "creator": "u279076@disabled.tld", "count": 1, "bug_id": 634391, "creation_time": "2011-02-18T23:58:37Z", "text": "Can you please create a test case and attach it to this bug so that we can try to reproduce it?\n\nThanks.", "id": 5291157, "raw_text": "Can you please create a test case and attach it to this bug so that we can try to reproduce it?\n\nThanks.", "author": "u279076@disabled.tld"}, {"author": "michi_1111@yahoo.de", "attachment_id": null, "text": "(In reply to comment #1)\n> Can you please create a test case and attach it to this bug so that we can try\n> to reproduce it?\n> \n> Thanks.\n\nYou can reproduce this error by following these steps (in this exact order): \n\n1. Open Firefox 4.0b11\n2. Navigate to \"about:addons\"\n3. Open the Web Console (e.g. through Control-Shift-K)\n4. Execute the following lines of code in the Web Console command line interpreter:\n\ntestMsgPos = function(anchorId) {\n\t\n\t// get main window:\n\tvar w = QueryInterface(Components.interfaces.nsIInterfaceRequestor)\n\t\t\t\t\t   .getInterface(Components.interfaces.nsIWebNavigation)\n\t\t\t\t\t   .QueryInterface(Components.interfaces.nsIDocShellTreeItem)\n\t\t\t\t\t   .rootTreeItem\n\t\t\t\t\t   .QueryInterface(Components.interfaces.nsIInterfaceRequestor)\n\t\t\t\t\t   .getInterface(Components.interfaces.nsIDOMWindow);\n\t\n\tvar nfId = anchorId + \"_notification_id\";\n\tvar nfMsg = \"This message should be attached to \\\"\"  + anchorId + \"\\\".\";\n\t\n\t// display notification attached to anchor:\n\tvar nf = w.PopupNotifications.show(w.gBrowser.selectedBrowser,\n\t  nfId,\n\t  nfMsg,\n\t  anchorId, /* <- anchorId */\n\t  null, /* mainAction */\n\t  null, /* secondaryActions */\n\t  null /* options */\n\t);\n\t\n\t// get anchor element:\n\tvar anchor = nf.anchorElement;\n\t\n\t// report errors to firefox error console:\n\tif(!anchor) console.error( \"Notification has no anchor\" ); // report the error and continue execution\n\telse if(anchor.id != anchorId) console.error( \"Found anchor.id '\" + anchor.id + \"' but expected anchorId '\" + anchorId + \"'!\" ); // report the error and continue execution\n\n\t// return whether anchor is present and has the expected id:\n\treturn anchor && anchor.id == anchorId;\n};\n\ntestMsgPos(\"addon-bar\");\ntestMsgPos(\"TabsToolbar\");\ntestMsgPos(\"home-button\");\n\n\n\n5. You would expect that the 3 notifications would appear in different positions (\"addon-bar\", \"TabsToolbar\", and \"home-button\"). But they don't.\n6. The following error messages will be shown in the Web Console:\n> [19:50:31.973] \"Found anchor.id 'notification-popup-box' but expected anchorId 'addon-bar'!\"\n> [19:50:31.989] \"Found anchor.id 'notification-popup-box' but expected anchorId 'TabsToolbar'!\"\n> [19:50:32.006] \"Found anchor.id 'notification-popup-box' but expected anchorId 'home-button'!\"", "creation_time": "2011-02-20T18:52:33Z", "is_private": false, "raw_text": "(In reply to comment #1)\n> Can you please create a test case and attach it to this bug so that we can try\n> to reproduce it?\n> \n> Thanks.\n\nYou can reproduce this error by following these steps (in this exact order): \n\n1. Open Firefox 4.0b11\n2. Navigate to \"about:addons\"\n3. Open the Web Console (e.g. through Control-Shift-K)\n4. Execute the following lines of code in the Web Console command line interpreter:\n\ntestMsgPos = function(anchorId) {\n\t\n\t// get main window:\n\tvar w = QueryInterface(Components.interfaces.nsIInterfaceRequestor)\n\t\t\t\t\t   .getInterface(Components.interfaces.nsIWebNavigation)\n\t\t\t\t\t   .QueryInterface(Components.interfaces.nsIDocShellTreeItem)\n\t\t\t\t\t   .rootTreeItem\n\t\t\t\t\t   .QueryInterface(Components.interfaces.nsIInterfaceRequestor)\n\t\t\t\t\t   .getInterface(Components.interfaces.nsIDOMWindow);\n\t\n\tvar nfId = anchorId + \"_notification_id\";\n\tvar nfMsg = \"This message should be attached to \\\"\"  + anchorId + \"\\\".\";\n\t\n\t// display notification attached to anchor:\n\tvar nf = w.PopupNotifications.show(w.gBrowser.selectedBrowser,\n\t  nfId,\n\t  nfMsg,\n\t  anchorId, /* <- anchorId */\n\t  null, /* mainAction */\n\t  null, /* secondaryActions */\n\t  null /* options */\n\t);\n\t\n\t// get anchor element:\n\tvar anchor = nf.anchorElement;\n\t\n\t// report errors to firefox error console:\n\tif(!anchor) console.error( \"Notification has no anchor\" ); // report the error and continue execution\n\telse if(anchor.id != anchorId) console.error( \"Found anchor.id '\" + anchor.id + \"' but expected anchorId '\" + anchorId + \"'!\" ); // report the error and continue execution\n\n\t// return whether anchor is present and has the expected id:\n\treturn anchor && anchor.id == anchorId;\n};\n\ntestMsgPos(\"addon-bar\");\ntestMsgPos(\"TabsToolbar\");\ntestMsgPos(\"home-button\");\n\n\n\n5. You would expect that the 3 notifications would appear in different positions (\"addon-bar\", \"TabsToolbar\", and \"home-button\"). But they don't.\n6. The following error messages will be shown in the Web Console:\n> [19:50:31.973] \"Found anchor.id 'notification-popup-box' but expected anchorId 'addon-bar'!\"\n> [19:50:31.989] \"Found anchor.id 'notification-popup-box' but expected anchorId 'TabsToolbar'!\"\n> [19:50:32.006] \"Found anchor.id 'notification-popup-box' but expected anchorId 'home-button'!\"", "id": 5293132, "bug_id": 634391, "creator": "michi_1111@yahoo.de", "tags": [], "time": "2011-02-20T18:52:33Z", "count": 2}, {"attachment_id": null, "time": "2011-02-27T17:21:25Z", "is_private": false, "author": "michi_1111@yahoo.de", "bug_id": 634391, "creator": "michi_1111@yahoo.de", "tags": [], "count": 3, "raw_text": "Note that the above JavaScript code has two line breaks within the comments, which break the code. \n\nBefore execution, please remove the two comments with the following text:\n\n  //report the\nerror and continue execution\n\nSorry for the confusion.", "id": 5307355, "text": "Note that the above JavaScript code has two line breaks within the comments, which break the code. \n\nBefore execution, please remove the two comments with the following text:\n\n  //report the\nerror and continue execution\n\nSorry for the confusion.", "creation_time": "2011-02-27T17:21:25Z"}, {"time": "2011-03-05T02:37:48Z", "is_private": false, "attachment_id": null, "bug_id": 634391, "tags": [], "count": 4, "creator": "u279076@disabled.tld", "text": "Confirmed using the testcase from comment 2 in Firefox 4.0rc1.", "creation_time": "2011-03-05T02:37:48Z", "raw_text": "Confirmed using the testcase from comment 2 in Firefox 4.0rc1.", "id": 5323452, "author": "u279076@disabled.tld"}, {"attachment_id": null, "author": "mozilla@kaply.com", "time": "2011-04-18T22:17:17Z", "tags": [], "creator": "mozilla@kaply.com", "count": 5, "bug_id": 634391, "creation_time": "2011-04-18T22:17:17Z", "is_private": false, "text": "Here's the code from PopupNotifications.jsm\n\nlet anchorElement = null;\nif (this.anchorID)\n  anchorElement = this.owner.iconBox.querySelector(\"#\"+this.anchorID);\n \nif (!anchorElement)\n  anchorElement = this.owner.iconBox;\n\nSo because querySelector is called on the iconBox, anchorID only works if the element specified by the anchorID is a child of the iconBox.\n\nshould be:\n\nanchorElement = this.owner.iconBox.ownerDocument.querySelector(\"#\"+this.anchorID);", "id": 5416965, "raw_text": "Here's the code from PopupNotifications.jsm\n\nlet anchorElement = null;\nif (this.anchorID)\n  anchorElement = this.owner.iconBox.querySelector(\"#\"+this.anchorID);\n \nif (!anchorElement)\n  anchorElement = this.owner.iconBox;\n\nSo because querySelector is called on the iconBox, anchorID only works if the element specified by the anchorID is a child of the iconBox.\n\nshould be:\n\nanchorElement = this.owner.iconBox.ownerDocument.querySelector(\"#\"+this.anchorID);"}, {"author": "god.vedmaka@gmail.com", "bug_id": 634391, "tags": [], "creator": "god.vedmaka@gmail.com", "count": 6, "raw_text": "When this will be fixed?\nCan i do like that to fix it?\n\nComponents.utils.import(\"chrome://content/PopupNotifications.jsm\");\nPopupNotifications.show(gBrowser.selectedBrowser, \"sample-popup\",\n        \"This is a sample popup notification.\",\n        \"MY-ANCHER-ID\", /* anchor ID */\n        {\n          label: \"Do Something\",\n          accessKey: \"D\",\n          callback: function() {\n            alert(\"Doing something awesome!\");\n          }\n        },\n        null  /* secondary action */\n        );\t\n\nwhere chrome://content/PopupNotifications.jsm - is file with fixed code?", "id": 5523087, "text": "When this will be fixed?\nCan i do like that to fix it?\n\nComponents.utils.import(\"chrome://content/PopupNotifications.jsm\");\nPopupNotifications.show(gBrowser.selectedBrowser, \"sample-popup\",\n        \"This is a sample popup notification.\",\n        \"MY-ANCHER-ID\", /* anchor ID */\n        {\n          label: \"Do Something\",\n          accessKey: \"D\",\n          callback: function() {\n            alert(\"Doing something awesome!\");\n          }\n        },\n        null  /* secondary action */\n        );\t\n\nwhere chrome://content/PopupNotifications.jsm - is file with fixed code?", "creation_time": "2011-06-09T19:48:08Z", "attachment_id": null, "time": "2011-06-09T19:48:08Z", "is_private": false}, {"text": "Created attachment 538325\nUse iconBox ownerDocument for query\n\nBecause querySelector is called on the iconBox, anchorID only works if the element specified by the anchorID is a child of the iconBox.\n\nquerySelector should be called on the ownerDocument of the iconBox", "creation_time": "2011-06-09T19:55:17Z", "raw_text": "Because querySelector is called on the iconBox, anchorID only works if the element specified by the anchorID is a child of the iconBox.\n\nquerySelector should be called on the ownerDocument of the iconBox", "id": 5523107, "bug_id": 634391, "creator": "mozilla@kaply.com", "tags": [], "count": 7, "author": "mozilla@kaply.com", "is_private": false, "time": "2011-06-09T19:55:17Z", "attachment_id": 538325}, {"author": "god.vedmaka@gmail.com", "raw_text": "In comment above - chrome://content/PopupNotifications.jsm has \n\nanchorElement = this.owner.iconBox.ownerDocument.querySelector(\"#\"+this.anchorID);\n\nbut it still not works - attached to iconBox, did i misunderstanding something?", "id": 5523115, "text": "In comment above - chrome://content/PopupNotifications.jsm has \n\nanchorElement = this.owner.iconBox.ownerDocument.querySelector(\"#\"+this.anchorID);\n\nbut it still not works - attached to iconBox, did i misunderstanding something?", "creation_time": "2011-06-09T19:58:38Z", "bug_id": 634391, "tags": [], "creator": "god.vedmaka@gmail.com", "count": 8, "attachment_id": null, "is_private": false, "time": "2011-06-09T19:58:38Z"}, {"count": 9, "time": "2011-06-09T20:00:39Z", "creator": "gavin.sharp@gmail.com", "tags": [], "bug_id": 634391, "id": 5523120, "raw_text": "This was intentional - the _onIconBoxCommand code won't work for elements outside of the iconBox.\n\nWe need a better solution to allow PopupNotifications anchored elsewhere, but I haven't had much time to come up with one. Bug 604473 takes the approach of just creating a separate PopupNotifications object, which may be a suitable workaround in the interim.", "creation_time": "2011-06-09T20:00:39Z", "is_private": false, "text": "Comment on attachment 538325\nUse iconBox ownerDocument for query\n\nThis was intentional - the _onIconBoxCommand code won't work for elements outside of the iconBox.\n\nWe need a better solution to allow PopupNotifications anchored elsewhere, but I haven't had much time to come up with one. Bug 604473 takes the approach of just creating a separate PopupNotifications object, which may be a suitable workaround in the interim.", "attachment_id": 538325, "author": "gavin.sharp@gmail.com"}, {"bug_id": 634391, "count": 10, "creator": "mozilla@kaply.com", "tags": [], "time": "2011-06-09T20:03:30Z", "raw_text": "The problem is people are reading the documentation:\n\nhttps://developer.mozilla.org/en/JavaScript_code_modules/PopupNotifications.jsm\n\nAnd it indicates that the popup can be attached arbitrarily.\n\nIf this:\n\nanchorID\nThe ID of the element that should serve as the anchor for the notification popup (that is, the element the arrow on the popup should point to). If you specify null, the notification will be anchored to the icon box at the start of the URL bar.\n\nCan only ever be the iconBox, we need to change the docs.", "id": 5523126, "text": "The problem is people are reading the documentation:\n\nhttps://developer.mozilla.org/en/JavaScript_code_modules/PopupNotifications.jsm\n\nAnd it indicates that the popup can be attached arbitrarily.\n\nIf this:\n\nanchorID\nThe ID of the element that should serve as the anchor for the notification popup (that is, the element the arrow on the popup should point to). If you specify null, the notification will be anchored to the icon box at the start of the URL bar.\n\nCan only ever be the iconBox, we need to change the docs.", "is_private": false, "creation_time": "2011-06-09T20:03:30Z", "author": "mozilla@kaply.com", "attachment_id": null}, {"is_private": false, "time": "2011-06-09T20:11:44Z", "attachment_id": null, "id": 5523143, "raw_text": "It can any element, it just needs to be a descendant of the iconBox.", "creation_time": "2011-06-09T20:11:44Z", "text": "It can any element, it just needs to be a descendant of the iconBox.", "count": 11, "creator": "gavin.sharp@gmail.com", "tags": [], "bug_id": 634391, "author": "gavin.sharp@gmail.com"}, {"tags": [], "creator": "gavin.sharp@gmail.com", "count": 12, "bug_id": 634391, "id": 5523169, "raw_text": "I've updated https://developer.mozilla.org/en/JavaScript_code_modules/PopupNotifications.jsm .", "creation_time": "2011-06-09T20:17:06Z", "text": "I've updated https://developer.mozilla.org/en/JavaScript_code_modules/PopupNotifications.jsm .", "author": "gavin.sharp@gmail.com", "time": "2011-06-09T20:17:06Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "time": "2014-05-21T05:59:24Z", "is_private": false, "author": "mozilla+bmo@noorenberghe.ca", "bug_id": 634391, "creator": "mozilla+bmo@noorenberghe.ca", "count": 13, "tags": [], "raw_text": "Bulk move to Toolkit::Notifications and Alerts\n\nFilter on notifications-and-alerts-component.", "id": 8819799, "text": "Bulk move to Toolkit::Notifications and Alerts\n\nFilter on notifications-and-alerts-component.", "creation_time": "2014-05-21T05:59:24Z"}]}}, "comments": {}}