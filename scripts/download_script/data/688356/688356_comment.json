{"bugs": {"688356": {"comments": [{"creator": "bholley@mozilla.com", "author": "bholley@mozilla.com", "is_private": false, "count": 0, "tags": [], "id": 5729965, "bug_id": 688356, "raw_text": "I ran into this over in bug 684327.\n\nIn js/src/xpconnect/tests, we will soon have, among other things:\n1 - an 'idl' directory, containing test interfaces\n2 - a 'components' directory that depends on the relevant idl\n3 - a 'unit' directory, which contains xpcshell tests that exercise 1 and 2.\n\nI noticed that, for some reason, running make in js/src/xpconnect/tests would generate the xpt typelib files in idl/_xpidlgen, but not the headers. Running 'make -C idl' would generate both.\n\nWith some experimentation, I discovered that it worked if I commented out XPCSHELL_TESTS=unit in js/src/xpconnect/tests/Makefile.in. To quote bsmedberg on irc, 'that is...unexpected'.\n\nThe relevant block is here: http://mxr.mozilla.org/mozilla-central/source/config/rules.mk#125 . I think the problem has to do with the use of a double-colon rule on libs. When I run make --debug=b, I get:\n\n> Reading makefiles...\n> Updating goal targets....\n>  File `libs' does not exist.\n> Target `libs' is double-colon and has no prerequisites.\n> Must remake target `libs'.\n>  File `libs' does not exist.\n> Must remake target `libs'.\n\nCommenting out XPCSHELL_TESTS=unit, I get:\n\n> Reading makefiles...\n> Updating goal targets....\n> File `default' does not exist.\n> Target `default' is double-colon and has no prerequisites.\n> Must remake target `default'.\n> GNU Make 3.81\n> Copyright (C) 2006  Free Software Foundation, Inc.\n> This is free software; see the source for copying conditions.\n> There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A\n> PARTICULAR PURPOSE.\n> \n> This program built for i386-apple-darwin11.0\n> Reading makefiles...\n> Updating goal targets....\n>  File `export' does not exist.\n> Must remake target `export'.\n\nThis seems to have bitten others before: http://lists.gnu.org/archive/html/help-make/2002-04/msg00047.html . It appears that the double colon is causing libs to take precedence over the default rule somehow.\n\nI'm working around this for now by doing adding a libs:export dependency within idl/Makefile.in. Seems like something we ought to fix though.", "creation_time": "2011-09-22T02:38:46Z", "text": "I ran into this over in bug 684327.\n\nIn js/src/xpconnect/tests, we will soon have, among other things:\n1 - an 'idl' directory, containing test interfaces\n2 - a 'components' directory that depends on the relevant idl\n3 - a 'unit' directory, which contains xpcshell tests that exercise 1 and 2.\n\nI noticed that, for some reason, running make in js/src/xpconnect/tests would generate the xpt typelib files in idl/_xpidlgen, but not the headers. Running 'make -C idl' would generate both.\n\nWith some experimentation, I discovered that it worked if I commented out XPCSHELL_TESTS=unit in js/src/xpconnect/tests/Makefile.in. To quote bsmedberg on irc, 'that is...unexpected'.\n\nThe relevant block is here: http://mxr.mozilla.org/mozilla-central/source/config/rules.mk#125 . I think the problem has to do with the use of a double-colon rule on libs. When I run make --debug=b, I get:\n\n> Reading makefiles...\n> Updating goal targets....\n>  File `libs' does not exist.\n> Target `libs' is double-colon and has no prerequisites.\n> Must remake target `libs'.\n>  File `libs' does not exist.\n> Must remake target `libs'.\n\nCommenting out XPCSHELL_TESTS=unit, I get:\n\n> Reading makefiles...\n> Updating goal targets....\n> File `default' does not exist.\n> Target `default' is double-colon and has no prerequisites.\n> Must remake target `default'.\n> GNU Make 3.81\n> Copyright (C) 2006  Free Software Foundation, Inc.\n> This is free software; see the source for copying conditions.\n> There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A\n> PARTICULAR PURPOSE.\n> \n> This program built for i386-apple-darwin11.0\n> Reading makefiles...\n> Updating goal targets....\n>  File `export' does not exist.\n> Must remake target `export'.\n\nThis seems to have bitten others before: http://lists.gnu.org/archive/html/help-make/2002-04/msg00047.html . It appears that the double colon is causing libs to take precedence over the default rule somehow.\n\nI'm working around this for now by doing adding a libs:export dependency within idl/Makefile.in. Seems like something we ought to fix though.", "time": "2011-09-22T02:38:46Z", "attachment_id": null}, {"bug_id": 688356, "id": 5730450, "count": 1, "is_private": false, "tags": [], "attachment_id": null, "time": "2011-09-22T11:43:33Z", "text": "No, the problem is just the order.  When no target is specified, make makes the first target in the makefile.  If XPCSHELL_TESTS or CPP_UNIT_TESTS are defined then the default target at http://mxr.mozilla.org/mozilla-central/source/config/rules.mk#700 is superseded by either http://mxr.mozilla.org/mozilla-central/source/config/rules.mk#137 or http://mxr.mozilla.org/mozilla-central/source/config/rules.mk#231.", "creation_time": "2011-09-22T11:43:33Z", "raw_text": "No, the problem is just the order.  When no target is specified, make makes the first target in the makefile.  If XPCSHELL_TESTS or CPP_UNIT_TESTS are defined then the default target at http://mxr.mozilla.org/mozilla-central/source/config/rules.mk#700 is superseded by either http://mxr.mozilla.org/mozilla-central/source/config/rules.mk#137 or http://mxr.mozilla.org/mozilla-central/source/config/rules.mk#231.", "author": "khuey@kylehuey.com", "creator": "khuey@kylehuey.com"}, {"attachment_id": null, "time": "2011-09-22T13:26:42Z", "text": "We should probably either move the XPCSHELL_TESTS blocks down, or move the default rules way up to the top (which sounds preferable).", "raw_text": "We should probably either move the XPCSHELL_TESTS blocks down, or move the default rules way up to the top (which sounds preferable).", "creation_time": "2011-09-22T13:26:42Z", "bug_id": 688356, "id": 5730604, "tags": [], "is_private": false, "count": 2, "author": "ted@mielczarek.org", "creator": "ted@mielczarek.org"}]}}, "comments": {}}