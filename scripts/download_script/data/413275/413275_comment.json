{"comments": {}, "bugs": {"413275": {"comments": [{"creation_time": "2008-01-20T23:06:39Z", "text": "Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.4; en-US; rv:1.9b3pre) Gecko/2008012014 Firefox/3.0b3pre\n\nSteps to reproduce:\n- Rename or delete old profile folders\n- Start Firefox\n- Migration Wizard comes up\n- Cancel the Migration Wizard Dialog\n- JS Error is shown in Debug Build output\n\n* Call to xpconnect wrapped JSObject produced this error:  *\n[Exception... \"'[JavaScript Error: \"sourceProfiles is null\" {file: \"chrome://browser/content/migration/migration.js\" line: 177}]' when calling method: [nsIDOMEventListener::handleEvent]\"  nsresult: \"0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS)\"  location: \"<unknown>\"  data: yes]", "time": "2008-01-20T23:06:39Z", "tags": [], "raw_text": "Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.4; en-US; rv:1.9b3pre) Gecko/2008012014 Firefox/3.0b3pre\n\nSteps to reproduce:\n- Rename or delete old profile folders\n- Start Firefox\n- Migration Wizard comes up\n- Cancel the Migration Wizard Dialog\n- JS Error is shown in Debug Build output\n\n* Call to xpconnect wrapped JSObject produced this error:  *\n[Exception... \"'[JavaScript Error: \"sourceProfiles is null\" {file: \"chrome://browser/content/migration/migration.js\" line: 177}]' when calling method: [nsIDOMEventListener::handleEvent]\"  nsresult: \"0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS)\"  location: \"<unknown>\"  data: yes]", "author": "cbook@mozilla.com", "creator": "cbook@mozilla.com", "bug_id": 413275, "is_private": false, "count": 0, "id": 3445523, "attachment_id": null}, {"creator": "gavin.sharp@gmail.com", "raw_text": "", "bug_id": 413275, "id": 3470887, "count": 1, "creation_time": "2008-02-07T04:24:37Z", "author": "gavin.sharp@gmail.com", "is_private": false, "attachment_id": null, "text": "*** Bug 415981 has been marked as a duplicate of this bug. ***", "tags": [], "time": "2008-02-07T04:24:37Z"}, {"count": 2, "attachment_id": null, "id": 3498508, "bug_id": 413275, "is_private": false, "raw_text": "this doesn't cause anything user-facing, and its in the context of the window we're destroying, no?", "creator": "mconnor@mozilla.com", "author": "mconnor@mozilla.com", "time": "2008-02-25T21:37:29Z", "tags": [], "text": "this doesn't cause anything user-facing, and its in the context of the window we're destroying, no?", "creation_time": "2008-02-25T21:37:29Z"}, {"tags": [], "time": "2008-03-03T23:30:29Z", "text": "Created attachment 307115\nAdditionally check whether sourceProfiles is null\n\nThis error happens in the case where the user selects \"Don't import anything\" and clicks \"Next\", in which case this._migrator is non-null, but this._migrator.sourceProfiles *is* null.", "creation_time": "2008-03-03T23:30:29Z", "id": 3510186, "attachment_id": 307115, "count": 3, "is_private": false, "bug_id": 413275, "author": "mredivo@flock.com", "creator": "mredivo@flock.com", "raw_text": "This error happens in the case where the user selects \"Don't import anything\" and clicks \"Next\", in which case this._migrator is non-null, but this._migrator.sourceProfiles *is* null."}, {"is_private": false, "bug_id": 413275, "author": "gavin.sharp@gmail.com", "creator": "gavin.sharp@gmail.com", "raw_text": "Which migrator implementation returns null for sourceProfiles?", "id": 3510221, "attachment_id": null, "count": 4, "text": "Which migrator implementation returns null for sourceProfiles?", "creation_time": "2008-03-03T23:55:11Z", "tags": [], "time": "2008-03-03T23:55:11Z"}, {"tags": [], "time": "2008-03-04T00:03:15Z", "creation_time": "2008-03-04T00:03:15Z", "text": "Not sure we can pick any particular one to blame; after all, the user selected \"Don't import anything\".\n\nI have not seen this error if a source profile has been selected.", "id": 3510235, "attachment_id": null, "count": 5, "creator": "mredivo@flock.com", "author": "mredivo@flock.com", "raw_text": "Not sure we can pick any particular one to blame; after all, the user selected \"Don't import anything\".\n\nI have not seen this error if a source profile has been selected.", "is_private": false, "bug_id": 413275}, {"count": 6, "id": 3518613, "raw_text": "(In reply to comment #5)\n> Not sure we can pick any particular one to blame; after all, the user selected\n> \"Don't import anything\".\n\nRight, I meant: what does this._migrator refer to after the user picked \"Don't import anything\"? Shouldn't it be null?", "creator": "gavin.sharp@gmail.com", "bug_id": 413275, "creation_time": "2008-03-09T00:36:55Z", "attachment_id": null, "author": "gavin.sharp@gmail.com", "is_private": false, "time": "2008-03-09T00:36:55Z", "tags": [], "text": "(In reply to comment #5)\n> Not sure we can pick any particular one to blame; after all, the user selected\n> \"Don't import anything\".\n\nRight, I meant: what does this._migrator refer to after the user picked \"Don't import anything\"? Shouldn't it be null?"}, {"time": "2008-03-10T19:09:44Z", "tags": [], "text": "Created attachment 308454\nSet this._migrator = null when \"Don't import anything\" selected\n\n\"this._migrator\" turns out to be the migrator passed in when the dialog was launched. There was no code to clear it when the user selected \"Don't import anything\".\n\nThis patch takes care of that, and consequently prevents the JS error.\n\nAn alternate fix would abort the process entirely, instead of advancing to profile selection.\n\nThere is one more point. From nsIBrowserProfileMigrator.idl:\n\n  /** \n   * An enumeration of available profiles. If the import source does \n   * not support profiles, this attribute is null.\n   */\n  readonly attribute nsISupportsArray sourceProfiles;\n\nI'm not certain if this page gets bypassed when the import source does not support profiles, but if it doesn't, there should still be a check for NULL. I left this check in.", "creation_time": "2008-03-10T19:09:44Z", "count": 7, "attachment_id": 308454, "id": 3520201, "bug_id": 413275, "is_private": false, "raw_text": "\"this._migrator\" turns out to be the migrator passed in when the dialog was launched. There was no code to clear it when the user selected \"Don't import anything\".\n\nThis patch takes care of that, and consequently prevents the JS error.\n\nAn alternate fix would abort the process entirely, instead of advancing to profile selection.\n\nThere is one more point. From nsIBrowserProfileMigrator.idl:\n\n  /** \n   * An enumeration of available profiles. If the import source does \n   * not support profiles, this attribute is null.\n   */\n  readonly attribute nsISupportsArray sourceProfiles;\n\nI'm not certain if this page gets bypassed when the import source does not support profiles, but if it doesn't, there should still be a check for NULL. I left this check in.", "creator": "mredivo@flock.com", "author": "mredivo@flock.com"}, {"author": "gavin.sharp@gmail.com", "is_private": false, "attachment_id": null, "text": "It looks like the real problem here is that onSelectProfilePageShow is being called at all. Since onImportSourcePageAdvanced cancels the dialog we shouldn't end up in onSelectProfilePageShow at all, but dialog.xml's advance() looks for a specific return value of \"false\" from the pageadvanced handler to avoid progressing further (and ultimately firing the next page's \"pageshow\" event). So I think we should fix this by having onImportSourcePageAdvanced return \"false\" rather than undefined.\n\nWe can also take the null check of sourceProfiles, I suppose, but the nsProfileMigrator code that launches this dialog will only pass in a migrator if the migrator's GetSourceExists returns true (or if it's IE on windows, which always has a \"profile\"), so in practice it won't be a problem.", "tags": [], "time": "2008-03-12T22:04:16Z", "creator": "gavin.sharp@gmail.com", "raw_text": "It looks like the real problem here is that onSelectProfilePageShow is being called at all. Since onImportSourcePageAdvanced cancels the dialog we shouldn't end up in onSelectProfilePageShow at all, but dialog.xml's advance() looks for a specific return value of \"false\" from the pageadvanced handler to avoid progressing further (and ultimately firing the next page's \"pageshow\" event). So I think we should fix this by having onImportSourcePageAdvanced return \"false\" rather than undefined.\n\nWe can also take the null check of sourceProfiles, I suppose, but the nsProfileMigrator code that launches this dialog will only pass in a migrator if the migrator's GetSourceExists returns true (or if it's IE on windows, which always has a \"profile\"), so in practice it won't be a problem.", "bug_id": 413275, "id": 3524611, "count": 8, "creation_time": "2008-03-12T22:04:16Z"}, {"is_private": false, "author": "gavin.sharp@gmail.com", "attachment_id": null, "text": "Marcus: can you take this bug?", "time": "2008-03-12T22:04:50Z", "tags": [], "bug_id": 413275, "raw_text": "Marcus: can you take this bug?", "creator": "gavin.sharp@gmail.com", "count": 9, "id": 3524613, "creation_time": "2008-03-12T22:04:50Z"}, {"tags": [], "time": "2008-03-12T23:33:31Z", "text": "Yes, I can take this bug.\n\nI can't find the \"Take bug\" checkbox or the \"Assignee\" textbox, neither here nor when adding an attachment; insufficient permissions, I presume?", "creation_time": "2008-03-12T23:33:31Z", "attachment_id": null, "id": 3524807, "count": 10, "is_private": false, "bug_id": 413275, "creator": "mredivo@flock.com", "author": "mredivo@flock.com", "raw_text": "Yes, I can take this bug.\n\nI can't find the \"Take bug\" checkbox or the \"Assignee\" textbox, neither here nor when adding an attachment; insufficient permissions, I presume?"}, {"text": "(In reply to comment #10\n> I can't find the \"Take bug\" checkbox or the \"Assignee\" textbox, neither here\n> nor when adding an attachment; insufficient permissions, I presume?\n\nAh, yeah. I've granted you editbugs/canconfirm, you should be able to do it now.", "time": "2008-03-13T15:10:22Z", "tags": [], "author": "gavin.sharp@gmail.com", "is_private": false, "attachment_id": null, "creation_time": "2008-03-13T15:10:22Z", "raw_text": "(In reply to comment #10\n> I can't find the \"Take bug\" checkbox or the \"Assignee\" textbox, neither here\n> nor when adding an attachment; insufficient permissions, I presume?\n\nAh, yeah. I've granted you editbugs/canconfirm, you should be able to do it now.", "creator": "gavin.sharp@gmail.com", "bug_id": 413275, "count": 11, "id": 3525939}, {"id": 3528804, "attachment_id": 309534, "count": 12, "creator": "mredivo@flock.com", "author": "mredivo@flock.com", "raw_text": "When the user selects \"Don't import anything\", we need to clear the 'next=\"selectProfile\"' property defined in migration.xul. By doing so, the wizard does not erroneously execute code for the next page when canceling.\n\nThe \"next\" property is updated later in the function, so it would appear that it could be left out of the XUL. That's not a good idea; the \"Next\" button then becomes the \"Finish\" button.\n\nIt also appears that the \"selectProfile\" page is only selected to be shown when the source is known to support multiple profiles, so guarding access to this._migrator.sourceProfiles (as in the previous patches) is not necessary.", "is_private": false, "bug_id": 413275, "tags": [], "time": "2008-03-14T22:26:14Z", "creation_time": "2008-03-14T22:26:14Z", "text": "Created attachment 309534\nAvoid advancing to next page when not necessary\n\nWhen the user selects \"Don't import anything\", we need to clear the 'next=\"selectProfile\"' property defined in migration.xul. By doing so, the wizard does not erroneously execute code for the next page when canceling.\n\nThe \"next\" property is updated later in the function, so it would appear that it could be left out of the XUL. That's not a good idea; the \"Next\" button then becomes the \"Finish\" button.\n\nIt also appears that the \"selectProfile\" page is only selected to be shown when the source is known to support multiple profiles, so guarding access to this._migrator.sourceProfiles (as in the previous patches) is not necessary."}, {"bug_id": 413275, "creator": "gavin.sharp@gmail.com", "raw_text": "Does the fix I suggest in the last sentence of the second paragraph of comment 8 not work?\n\nThat is, change:\nhttp://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/browser/components/migration/content/migration.js&rev=1.35&mark=161#153\n\nto be \"return false;\" rather than \"return;\".", "id": 3528809, "count": 13, "creation_time": "2008-03-14T22:31:33Z", "is_private": false, "author": "gavin.sharp@gmail.com", "attachment_id": null, "text": "Does the fix I suggest in the last sentence of the second paragraph of comment 8 not work?\n\nThat is, change:\nhttp://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/browser/components/migration/content/migration.js&rev=1.35&mark=161#153\n\nto be \"return false;\" rather than \"return;\".", "tags": [], "time": "2008-03-14T22:31:33Z"}, {"bug_id": 413275, "raw_text": "(In reply to comment #13)\n> Does the fix I suggest in the last sentence of the second paragraph of comment\n> 8 not work?\n> \n> That is, change:\n> http://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/browser/components/migration/content/migration.js&rev=1.35&mark=161#153\n> \n> to be \"return false;\" rather than \"return;\".\n> \n\nNope, doesn't work.\n\ndocument.documentElement.cancel(); actually calls window.close, but the handler for the next page still executes.\n\nInspection also shows that the return value does not make it back to here:\n\nhttp://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/toolkit/content/widgets/wizard.xml#427\n\nwhere the value of \"returned\" is \"undefined\" both as the code currently is, and when returning false.", "creator": "mredivo@flock.com", "count": 14, "id": 3528822, "creation_time": "2008-03-14T22:43:45Z", "is_private": false, "author": "mredivo@flock.com", "attachment_id": null, "text": "(In reply to comment #13)\n> Does the fix I suggest in the last sentence of the second paragraph of comment\n> 8 not work?\n> \n> That is, change:\n> http://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/browser/components/migration/content/migration.js&rev=1.35&mark=161#153\n> \n> to be \"return false;\" rather than \"return;\".\n> \n\nNope, doesn't work.\n\ndocument.documentElement.cancel(); actually calls window.close, but the handler for the next page still executes.\n\nInspection also shows that the return value does not make it back to here:\n\nhttp://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/toolkit/content/widgets/wizard.xml#427\n\nwhere the value of \"returned\" is \"undefined\" both as the code currently is, and when returning false.", "time": "2008-03-14T22:43:45Z", "tags": []}, {"time": "2008-03-14T23:32:39Z", "tags": [], "text": "Oh, you probably also need to change:\nhttp://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/browser/components/migration/content/migration.xul&rev=1.28&mark=59#57\n\nand add a \"return \".", "creation_time": "2008-03-14T23:32:39Z", "count": 15, "id": 3528915, "attachment_id": null, "bug_id": 413275, "is_private": false, "raw_text": "Oh, you probably also need to change:\nhttp://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/browser/components/migration/content/migration.xul&rev=1.28&mark=59#57\n\nand add a \"return \".", "author": "gavin.sharp@gmail.com", "creator": "gavin.sharp@gmail.com"}, {"raw_text": "Gavin, thanks for the tip.", "author": "mredivo@flock.com", "creator": "mredivo@flock.com", "bug_id": 413275, "is_private": false, "count": 16, "id": 3530041, "attachment_id": 309696, "creation_time": "2008-03-15T23:24:10Z", "text": "Created attachment 309696\nReturn FALSE to avoid advancing to next page when not necessary\n\nGavin, thanks for the tip.", "time": "2008-03-15T23:24:10Z", "tags": []}, {"attachment_id": 309696, "author": "gavin.sharp@gmail.com", "is_private": false, "time": "2008-03-16T08:52:17Z", "tags": [], "text": "Comment on attachment 309696\nReturn FALSE to avoid advancing to next page when not necessary\n\nThanks for the patch! :)", "count": 17, "id": 3530387, "raw_text": "Thanks for the patch! :)", "creator": "gavin.sharp@gmail.com", "bug_id": 413275, "creation_time": "2008-03-16T08:52:17Z"}, {"count": 18, "id": 3530887, "attachment_id": null, "bug_id": 413275, "is_private": false, "raw_text": "Checking in browser/components/migration/content/migration.js;\n/cvsroot/mozilla/browser/components/migration/content/migration.js,v  <--  migration.js\nnew revision: 1.36; previous revision: 1.35\ndone\nChecking in browser/components/migration/content/migration.xul;\n/cvsroot/mozilla/browser/components/migration/content/migration.xul,v  <--  migration.xul\nnew revision: 1.29; previous revision: 1.28\ndone", "creator": "reed@reedloden.com", "author": "reed@reedloden.com", "time": "2008-03-16T21:04:31Z", "tags": [], "text": "Checking in browser/components/migration/content/migration.js;\n/cvsroot/mozilla/browser/components/migration/content/migration.js,v  <--  migration.js\nnew revision: 1.36; previous revision: 1.35\ndone\nChecking in browser/components/migration/content/migration.xul;\n/cvsroot/mozilla/browser/components/migration/content/migration.xul,v  <--  migration.xul\nnew revision: 1.29; previous revision: 1.28\ndone", "creation_time": "2008-03-16T21:04:31Z"}]}}}