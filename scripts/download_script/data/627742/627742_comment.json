{"comments": {}, "bugs": {"627742": {"comments": [{"bug_id": 627742, "text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-GB; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13\nBuild Identifier: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-GB; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13\n\nWhen two @font-face declarations reference the same font file, the file is downloaded twice\n\n(Not sure if this counts as a bug, but it seems mighty inefficient to me)\n\nReproducible: Always\n\nSteps to Reproduce:\n1. use following css (but edit to link to fonts on your server)\n\n@font-face {\n    font-family: Header Font;\n    src: url('/assets/font/Museo_Slab_500-webfont.eot');\n    src: local('?'), url('/assets/font/Museo_Slab_500-webfont.woff') format('woff'), url('/assets/font/Museo_Slab_500-webfont.ttf') format('truetype'), url('/assets/font/Museo_Slab_500-webfont.svg#webfontCg7ZQgsV') format('svg');\n}\n\n@font-face {\n    font-family: Button Font;\n    src: url('/assets/font/Museo_Slab_500-webfont.eot');\n    src: local('?'), url('/assets/font/Museo_Slab_500-webfont.woff') format('woff'), url('/assets/font/Museo_Slab_500-webfont.ttf') format('truetype'), url('/assets/font/Museo_Slab_500-webfont.svg#webfontCg7ZQgsV') format('svg');\n}\n\nhtml\n\n<p style=\"font-family: Button Font\">text</p>\n<p style=\"font-family: Header Font\">text</p>\n\n2. refresh the page and watch downloads in firebug. The font file is always downloaded twice.\nActual Results:  \nmuseo_slab_700.otf was downloaded twice, the second download taking a lot longer than the first\n\nExpected Results:  \nfont should download once", "time": "2011-01-21T16:35:08Z", "creation_time": "2011-01-21T16:35:08Z", "attachment_id": null, "creator": "wheresrhys@gmail.com", "raw_text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-GB; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13\nBuild Identifier: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-GB; rv:1.9.2.13) Gecko/20101203 Firefox/3.6.13\n\nWhen two @font-face declarations reference the same font file, the file is downloaded twice\n\n(Not sure if this counts as a bug, but it seems mighty inefficient to me)\n\nReproducible: Always\n\nSteps to Reproduce:\n1. use following css (but edit to link to fonts on your server)\n\n@font-face {\n    font-family: Header Font;\n    src: url('/assets/font/Museo_Slab_500-webfont.eot');\n    src: local('?'), url('/assets/font/Museo_Slab_500-webfont.woff') format('woff'), url('/assets/font/Museo_Slab_500-webfont.ttf') format('truetype'), url('/assets/font/Museo_Slab_500-webfont.svg#webfontCg7ZQgsV') format('svg');\n}\n\n@font-face {\n    font-family: Button Font;\n    src: url('/assets/font/Museo_Slab_500-webfont.eot');\n    src: local('?'), url('/assets/font/Museo_Slab_500-webfont.woff') format('woff'), url('/assets/font/Museo_Slab_500-webfont.ttf') format('truetype'), url('/assets/font/Museo_Slab_500-webfont.svg#webfontCg7ZQgsV') format('svg');\n}\n\nhtml\n\n<p style=\"font-family: Button Font\">text</p>\n<p style=\"font-family: Header Font\">text</p>\n\n2. refresh the page and watch downloads in firebug. The font file is always downloaded twice.\nActual Results:  \nmuseo_slab_700.otf was downloaded twice, the second download taking a lot longer than the first\n\nExpected Results:  \nfont should download once", "id": 5216953, "tags": [], "is_private": false, "count": 0, "author": "wheresrhys@gmail.com"}, {"text": "What's the full url to that file?  Or a complete testcase page showing the problem?", "bug_id": 627742, "creation_time": "2011-01-21T17:55:42Z", "time": "2011-01-21T17:55:42Z", "raw_text": "What's the full url to that file?  Or a complete testcase page showing the problem?", "creator": "bzbarsky@mit.edu", "attachment_id": null, "tags": [], "id": 5217211, "is_private": false, "author": "bzbarsky@mit.edu", "count": 1}, {"count": 2, "author": "wheresrhys@gmail.com", "attachment_id": 506251, "creator": "wheresrhys@gmail.com", "raw_text": "As requested, here's a test case", "bug_id": 627742, "id": 5220641, "text": "Created attachment 506251\nTest case\n\nAs requested, here's a test case", "tags": [], "time": "2011-01-23T19:38:41Z", "is_private": false, "creation_time": "2011-01-23T19:38:41Z"}, {"author": "bzbarsky@mit.edu", "count": 3, "creator": "bzbarsky@mit.edu", "raw_text": "The behavior of that testcase depends on the HTTP server it's running on; if the server sends \"Cache-control: no-cache\" for the font files, they'll be downloaded twice, for example.\n\nSo how are you refreshing the page?  (There are at least 3 different ways of doing that, with different cache-related behavior.)  And what exact headers is your server sending for those files?", "attachment_id": null, "tags": [], "text": "The behavior of that testcase depends on the HTTP server it's running on; if the server sends \"Cache-control: no-cache\" for the font files, they'll be downloaded twice, for example.\n\nSo how are you refreshing the page?  (There are at least 3 different ways of doing that, with different cache-related behavior.)  And what exact headers is your server sending for those files?", "id": 5220657, "bug_id": 627742, "creation_time": "2011-01-23T19:53:47Z", "time": "2011-01-23T19:53:47Z", "is_private": false}, {"raw_text": "You've lost me now - I'm a front-end developer so don't really know too much about server side set-up.\n\nLike I said initially, I'm not 100% sure it should even count as a bug, though it just seems to be highly inefficient EVER to attempt to download the same url twice when the page is only refreshed once. Surely the browser should check to see if the file exists in the browser cache, or is in the process of being fetched, before firing off another request. By comparison, if an image is included in a html file twice, whether as an <img> tag or background image, the browser only fetches the image once.", "creator": "wheresrhys@gmail.com", "attachment_id": null, "author": "wheresrhys@gmail.com", "count": 4, "creation_time": "2011-01-23T20:33:23Z", "time": "2011-01-23T20:33:23Z", "is_private": false, "tags": [], "text": "You've lost me now - I'm a front-end developer so don't really know too much about server side set-up.\n\nLike I said initially, I'm not 100% sure it should even count as a bug, though it just seems to be highly inefficient EVER to attempt to download the same url twice when the page is only refreshed once. Surely the browser should check to see if the file exists in the browser cache, or is in the process of being fetched, before firing off another request. By comparison, if an image is included in a html file twice, whether as an <img> tag or background image, the browser only fetches the image once.", "id": 5220682, "bug_id": 627742}, {"count": 5, "author": "bzbarsky@mit.edu", "attachment_id": null, "creator": "bzbarsky@mit.edu", "raw_text": "We do check.  But if the server said to not cache it, HTTP says we should ask the server for the resource again.\n\nFor images there is a non-HTTP object cache on top of the HTTP cache (which caches HTTP responses).\n\nI'd sort of appreciate an answer to my questions in comment 3, but at the very least, I'd like to know the answer to this question: Do you see the two loads if the page is \"refreshed\" by focusing the url bar or hitting enter?", "bug_id": 627742, "id": 5220728, "text": "We do check.  But if the server said to not cache it, HTTP says we should ask the server for the resource again.\n\nFor images there is a non-HTTP object cache on top of the HTTP cache (which caches HTTP responses).\n\nI'd sort of appreciate an answer to my questions in comment 3, but at the very least, I'd like to know the answer to this question: Do you see the two loads if the page is \"refreshed\" by focusing the url bar or hitting enter?", "tags": [], "time": "2011-01-23T21:41:38Z", "is_private": false, "creation_time": "2011-01-23T21:41:38Z"}, {"bug_id": 627742, "text": "The double download occurs when hitting f5 or enter (with enter all the reponse codes are 200, with f5 they are always a 304 followed by a 200). I'm not sure how to get the headers sent information. I uploaded a complete test page so hopefully if you run that you'll be able to replicate what I'm seeing and get the extra information you need.", "time": "2011-01-23T23:03:49Z", "creation_time": "2011-01-23T23:03:49Z", "creator": "wheresrhys@gmail.com", "raw_text": "The double download occurs when hitting f5 or enter (with enter all the reponse codes are 200, with f5 they are always a 304 followed by a 200). I'm not sure how to get the headers sent information. I uploaded a complete test page so hopefully if you run that you'll be able to replicate what I'm seeing and get the extra information you need.", "attachment_id": null, "id": 5220805, "tags": [], "is_private": false, "count": 6, "author": "wheresrhys@gmail.com"}, {"creation_time": "2011-01-24T01:40:56Z", "time": "2011-01-24T01:40:56Z", "is_private": false, "tags": [], "text": "Hmm.  304 indicates that we did cache it and the cache entry is valid; why would there be a 200 after a 304?  That's weird.\n\n> I'm not sure how to get the headers sent information.\n\nhttps://developer.mozilla.org/en/HTTP_Logging has instructions for that.  If you would be willing to create a log for the \"load the page, then focus url bar and hit enter\" case, that would be very much appreciated!", "id": 5220980, "bug_id": 627742, "raw_text": "Hmm.  304 indicates that we did cache it and the cache entry is valid; why would there be a 200 after a 304?  That's weird.\n\n> I'm not sure how to get the headers sent information.\n\nhttps://developer.mozilla.org/en/HTTP_Logging has instructions for that.  If you would be willing to create a log for the \"load the page, then focus url bar and hit enter\" case, that would be very much appreciated!", "creator": "bzbarsky@mit.edu", "attachment_id": null, "author": "bzbarsky@mit.edu", "count": 7}, {"creator": "wheresrhys@gmail.com", "raw_text": "", "attachment_id": 508524, "text": "Created attachment 508524\nLogs to accompany the test case", "bug_id": 627742, "creation_time": "2011-01-31T21:36:35Z", "time": "2011-01-31T21:36:35Z", "author": "wheresrhys@gmail.com", "count": 8, "tags": [], "id": 5240940, "is_private": false}, {"count": 9, "author": "bzbarsky@mit.edu", "is_private": false, "id": 5241947, "tags": [], "raw_text": "That log shows the browser asking the network module for http://localhost/xampp/Museo_Slab_500.otf 4 times.  Each of the 4 times, the resource is loaded from cache.  No HTTP requests are made for that URI.  In fact, the log shows only 5 GET requests to the server: 2 for favicon.ico, one for /en-GB/firefox/api/1.2/list/featured/all/10/WINNT/3.6.13, one for /firefox?client=firefox-a&rls=org.mozilla:en-GB:official and one for a long extern_js url...", "creator": "bzbarsky@mit.edu", "attachment_id": null, "time": "2011-02-01T04:21:46Z", "creation_time": "2011-02-01T04:21:46Z", "bug_id": 627742, "text": "That log shows the browser asking the network module for http://localhost/xampp/Museo_Slab_500.otf 4 times.  Each of the 4 times, the resource is loaded from cache.  No HTTP requests are made for that URI.  In fact, the log shows only 5 GET requests to the server: 2 for favicon.ico, one for /en-GB/firefox/api/1.2/list/featured/all/10/WINNT/3.6.13, one for /firefox?client=firefox-a&rls=org.mozilla:en-GB:official and one for a long extern_js url..."}, {"creation_time": "2012-01-13T22:01:54Z", "is_private": false, "time": "2012-01-13T22:01:54Z", "text": "I sent up an example server running this example at http://8.19.33.144/\n\nWe seem to always make two requests. IE, Safari, Chrome and Opera all send a single request.", "tags": [], "bug_id": 627742, "id": 5979671, "attachment_id": null, "raw_text": "I sent up an example server running this example at http://8.19.33.144/\n\nWe seem to always make two requests. IE, Safari, Chrome and Opera all send a single request.", "creator": "jmuizelaar@mozilla.com", "author": "jmuizelaar@mozilla.com", "count": 10}, {"id": 5980360, "tags": [], "is_private": false, "count": 11, "author": "bzbarsky@mit.edu", "bug_id": 627742, "text": "The testcase from comment 10 sends no useful cache-related headers, so we think the font file is brand-new and needs to be revalidated on every load.  Any sort of sane setup would probably send useful cache headers with files.\n\nThat said, it sounds like other browsers have some sort of non-HTTP font-face cache sitting in front of their HTTP cache?", "time": "2012-01-14T04:34:38Z", "creation_time": "2012-01-14T04:34:38Z", "attachment_id": null, "raw_text": "The testcase from comment 10 sends no useful cache-related headers, so we think the font file is brand-new and needs to be revalidated on every load.  Any sort of sane setup would probably send useful cache headers with files.\n\nThat said, it sounds like other browsers have some sort of non-HTTP font-face cache sitting in front of their HTTP cache?", "creator": "bzbarsky@mit.edu"}, {"author": "joe@drew.ca", "count": 12, "tags": [], "id": 5980407, "is_private": false, "attachment_id": null, "creator": "joe@drew.ca", "raw_text": "Bug 665707 would help for implementing such a cache :)", "text": "Bug 665707 would help for implementing such a cache :)", "bug_id": 627742, "creation_time": "2012-01-14T06:13:22Z", "time": "2012-01-14T06:13:22Z"}, {"id": 5980705, "tags": [], "is_private": false, "count": 13, "author": "jmuizelaar@mozilla.com", "bug_id": 627742, "text": "(In reply to Boris Zbarsky (:bz) from comment #11)\n> The testcase from comment 10 sends no useful cache-related headers, so we\n> think the font file is brand-new and needs to be revalidated on every load. \n> Any sort of sane setup would probably send useful cache headers with files.\n> \n> That said, it sounds like other browsers have some sort of non-HTTP\n> font-face cache sitting in front of their HTTP cache?\n\nI assume that other browsers treat all resources with the same name referenced from the same document as the same, thus don't download it twice. (e.g. WebKit's CachedImage, CachedFont etc.)", "time": "2012-01-14T14:31:47Z", "creation_time": "2012-01-14T14:31:47Z", "attachment_id": null, "raw_text": "(In reply to Boris Zbarsky (:bz) from comment #11)\n> The testcase from comment 10 sends no useful cache-related headers, so we\n> think the font file is brand-new and needs to be revalidated on every load. \n> Any sort of sane setup would probably send useful cache headers with files.\n> \n> That said, it sounds like other browsers have some sort of non-HTTP\n> font-face cache sitting in front of their HTTP cache?\n\nI assume that other browsers treat all resources with the same name referenced from the same document as the same, thus don't download it twice. (e.g. WebKit's CachedImage, CachedFont etc.)", "creator": "jmuizelaar@mozilla.com"}, {"creation_time": "2012-01-14T18:59:04Z", "time": "2012-01-14T18:59:04Z", "text": "Here's another test page:\n\nhttp://js.infidigm.net/script-cache.html\n\nThis shows Firefox making 4 requests, Chrome and Opera making 3 requests and Safari making 1 request.\n\nThus it seems like Chrome and Opera will, at least for script, reuse the same result\nduring load, after onload they refetch. Safari, will reuse the same result for the lifetime of the page? and we refetch each time.", "bug_id": 627742, "attachment_id": null, "raw_text": "Here's another test page:\n\nhttp://js.infidigm.net/script-cache.html\n\nThis shows Firefox making 4 requests, Chrome and Opera making 3 requests and Safari making 1 request.\n\nThus it seems like Chrome and Opera will, at least for script, reuse the same result\nduring load, after onload they refetch. Safari, will reuse the same result for the lifetime of the page? and we refetch each time.", "creator": "jmuizelaar@mozilla.com", "is_private": false, "tags": [], "id": 5980945, "author": "jmuizelaar@mozilla.com", "count": 14}]}}}