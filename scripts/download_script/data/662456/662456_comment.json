{"bugs": {"662456": {"comments": [{"is_private": false, "creation_time": "2011-06-07T01:47:11Z", "creator": "brian@briansmith.org", "tags": [], "attachment_id": null, "bug_id": 662456, "id": 5516674, "author": "brian@briansmith.org", "text": "The code is:\n\n    me = STAN_GetNSSCertificate(cert);\n    if (!me) {\n        PORT_SetError(SEC_ERROR_NO_MEMORY);\n\treturn NULL;\n    }\n\nSTAN_GetNSSCertificate can fail for multiple reasons, besides OOM. STAN_GetNSSCertificate needs to call PORT_SetError itself so that callers don't have to guess why it failed. Then, CERT_FindCertIssuer (and other callers) need to avoid calling PORT_SetError() when STAN_GetNSSCertificate fails.", "count": 0, "raw_text": "The code is:\n\n    me = STAN_GetNSSCertificate(cert);\n    if (!me) {\n        PORT_SetError(SEC_ERROR_NO_MEMORY);\n\treturn NULL;\n    }\n\nSTAN_GetNSSCertificate can fail for multiple reasons, besides OOM. STAN_GetNSSCertificate needs to call PORT_SetError itself so that callers don't have to guess why it failed. Then, CERT_FindCertIssuer (and other callers) need to avoid calling PORT_SetError() when STAN_GetNSSCertificate fails.", "time": "2011-06-07T01:47:11Z"}, {"time": "2011-06-07T07:58:15Z", "raw_text": "Too bad, but this anti-pattern is used in the NSS very often, not only this particular case.\n\nIMO, there should be a common sense rule: callee, not caller sets the error code. Caller MAY translate particular error codes, if appropriate (very rare).\n\nI assume that all occurrences of this anti-pattern may be fixed at once, in one dedicated bug id. This would be a nice refactoring.", "attachment_id": null, "tags": [], "creator": "pka@datatech.ru", "count": 1, "text": "Too bad, but this anti-pattern is used in the NSS very often, not only this particular case.\n\nIMO, there should be a common sense rule: callee, not caller sets the error code. Caller MAY translate particular error codes, if appropriate (very rare).\n\nI assume that all occurrences of this anti-pattern may be fixed at once, in one dedicated bug id. This would be a nice refactoring.", "author": "pka@datatech.ru", "bug_id": 662456, "id": 5516974, "is_private": false, "creation_time": "2011-06-07T07:58:15Z"}]}}, "comments": {}}