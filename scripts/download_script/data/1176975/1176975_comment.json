{"bugs": {"1176975": {"comments": [{"author": "pawelesc2@gmail.com", "is_private": false, "text": "Created attachment 8625570\ntestbookmark.html\n\nUser Agent: Mozilla/5.0 (Windows NT 6.1; rv:38.0) Gecko/20100101 Firefox/38.0\nBuild ID: 20150525141253\n\nSteps to reproduce:\n\nUsed Bookmarks menu to export bookmarks to HTML file on one computer.\nOn the other, couldn't import said file by using Import from HTML option. Happens on two separate computers.\n\n\nActual results:\n\nThe file has additional data (Visual Studio Project File description, some other \"random\" data) in header which makes Firefox unable to import bookmarks from HTML file. There is no error, just nothing happens.\nWhen using browser console it results in following errors:\n\n\"01:34:00.086 Failed to import bookmarks from file:///C:/Users/Pawel/Desktop/testbookmark.html: [Exception... \"Component returned failure code: 0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS) [nsINavBookmarksService.runInBatchMode]\"  nsresult: \"0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS)\"  location: \"JS frame :: resource://gre/modules/BookmarkHTMLUtils.jsm :: walkTreeForImport :: line 934\"  data: no]1 BookmarkHTMLUtils.jsm:159:0\"\n\n \"01:34:00.087 [Exception... \"Component returned failure code: 0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS) [nsINavBookmarksService.runInBatchMode]\"  nsresult: \"0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS)\"  location: \"JS frame :: resource://gre/modules/BookmarkHTMLUtils.jsm :: walkTreeForImport :: line 934\"  data: no]1 Promise-backend.js:870:0\n\"\n\n\nExpected results:\n\nThe bookmarks should be imported.", "bug_id": 1176975, "time": "2015-06-23T23:36:01Z", "creator": "pawelesc2@gmail.com", "raw_text": "User Agent: Mozilla/5.0 (Windows NT 6.1; rv:38.0) Gecko/20100101 Firefox/38.0\nBuild ID: 20150525141253\n\nSteps to reproduce:\n\nUsed Bookmarks menu to export bookmarks to HTML file on one computer.\nOn the other, couldn't import said file by using Import from HTML option. Happens on two separate computers.\n\n\nActual results:\n\nThe file has additional data (Visual Studio Project File description, some other \"random\" data) in header which makes Firefox unable to import bookmarks from HTML file. There is no error, just nothing happens.\nWhen using browser console it results in following errors:\n\n\"01:34:00.086 Failed to import bookmarks from file:///C:/Users/Pawel/Desktop/testbookmark.html: [Exception... \"Component returned failure code: 0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS) [nsINavBookmarksService.runInBatchMode]\"  nsresult: \"0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS)\"  location: \"JS frame :: resource://gre/modules/BookmarkHTMLUtils.jsm :: walkTreeForImport :: line 934\"  data: no]1 BookmarkHTMLUtils.jsm:159:0\"\n\n \"01:34:00.087 [Exception... \"Component returned failure code: 0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS) [nsINavBookmarksService.runInBatchMode]\"  nsresult: \"0x80570021 (NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS)\"  location: \"JS frame :: resource://gre/modules/BookmarkHTMLUtils.jsm :: walkTreeForImport :: line 934\"  data: no]1 Promise-backend.js:870:0\n\"\n\n\nExpected results:\n\nThe bookmarks should be imported.", "attachment_id": 8625570, "count": 0, "tags": [], "creation_time": "2015-06-23T23:36:01Z", "id": 10417210}, {"raw_text": "A word of clarification: both the VS Project stuff references names I personally recognise (names of projects, like \"Blackbox\") as well as the excerpt which follows (which seems to be a Last.fm shortcut/custom search I made and still use, it is in bookmarks, but it wasn't when I generated the attached .html file).\n\nIn my amateur search for cause I tracked the issue down to this line:\nhttps://dxr.mozilla.org/mozilla-central/source/toolkit/components/places/BookmarkHTMLUtils.jsm#1158\n\nbut of course I don't know the project, so it might be false.", "id": 10417229, "creator": "pawelesc2@gmail.com", "creation_time": "2015-06-23T23:41:14Z", "attachment_id": null, "text": "A word of clarification: both the VS Project stuff references names I personally recognise (names of projects, like \"Blackbox\") as well as the excerpt which follows (which seems to be a Last.fm shortcut/custom search I made and still use, it is in bookmarks, but it wasn't when I generated the attached .html file).\n\nIn my amateur search for cause I tracked the issue down to this line:\nhttps://dxr.mozilla.org/mozilla-central/source/toolkit/components/places/BookmarkHTMLUtils.jsm#1158\n\nbut of course I don't know the project, so it might be false.", "is_private": false, "author": "pawelesc2@gmail.com", "tags": [], "count": 1, "bug_id": 1176975, "time": "2015-06-23T23:41:14Z"}, {"tags": [], "count": 2, "creation_time": "2015-12-10T21:32:05Z", "id": 10999934, "time": "2015-12-10T21:32:05Z", "bug_id": 1176975, "text": "Hello,\n\nIs this bug still present in Firefox 42.0 or Nightly 45.0a1?\n\nThank you,\n\nJustin", "author": "jwilliams@softvision.com", "is_private": false, "attachment_id": null, "raw_text": "Hello,\n\nIs this bug still present in Firefox 42.0 or Nightly 45.0a1?\n\nThank you,\n\nJustin", "creator": "jwilliams@softvision.com"}, {"tags": [], "count": 3, "id": 11000754, "creation_time": "2015-12-11T13:02:44Z", "bug_id": 1176975, "time": "2015-12-11T13:02:44Z", "text": "(In reply to Justin - QA from comment #2)\n> Hello,\n> \n> Is this bug still present in Firefox 42.0 or Nightly 45.0a1?\n> \n> Thank you,\n> \n> Justin\n\nIt seems it's still present in 42.0, also whewn I start it without addons. Nightly 45.0a1 also shows this issue.\n\nThere's a twist: when I made a new profile for further testing of Nightly install it exported a legit bookmarks.html file. When I used 42.0 with this new profile - it worked again. To recap:\n\nMy main profile:\n42.0 - broken\n45.0a1 - broken\n\nClear profile:\n42.0 - OK\n45.0a1 - OK\n\nSo the problem might be present in the bookmarks themselves or other user files, though addons themselves shouldn't affect it because disabling them didn't help.\n\nI don't know the codebase, but still I believe it has something to do with this piece of code:\nhttps://dxr.mozilla.org/mozilla-central/source/toolkit/components/places/BookmarkHTMLUtils.jsm#1168\n\n_writeDescription: function (aItem, aIndent) {\n    let descriptionAnno = aItem.annos &&\n                          aItem.annos.find(anno => anno.name == DESCRIPTION_ANNO);\n    if (descriptionAnno)\n      this._writeLine(aIndent + \"<DD>\" + escapeHtmlEntities(descriptionAnno.value));\n\n\nBut I don't get why this part in the exported bookmarks.html:\n\n\"<DD>Microsoft Visual Studio Solution File, Format Version 11.00\n# Visual Studio 2010 (...)\"\n\nhappens before first occurence of \"<DL><p>\", so before the actual bookmarks are listed.\nSo maybe this line?:\nhttps://dxr.mozilla.org/mozilla-central/source/toolkit/components/places/BookmarkHTMLUtils.jsm#1064", "author": "pawelesc2@gmail.com", "is_private": false, "attachment_id": null, "raw_text": "(In reply to Justin - QA from comment #2)\n> Hello,\n> \n> Is this bug still present in Firefox 42.0 or Nightly 45.0a1?\n> \n> Thank you,\n> \n> Justin\n\nIt seems it's still present in 42.0, also whewn I start it without addons. Nightly 45.0a1 also shows this issue.\n\nThere's a twist: when I made a new profile for further testing of Nightly install it exported a legit bookmarks.html file. When I used 42.0 with this new profile - it worked again. To recap:\n\nMy main profile:\n42.0 - broken\n45.0a1 - broken\n\nClear profile:\n42.0 - OK\n45.0a1 - OK\n\nSo the problem might be present in the bookmarks themselves or other user files, though addons themselves shouldn't affect it because disabling them didn't help.\n\nI don't know the codebase, but still I believe it has something to do with this piece of code:\nhttps://dxr.mozilla.org/mozilla-central/source/toolkit/components/places/BookmarkHTMLUtils.jsm#1168\n\n_writeDescription: function (aItem, aIndent) {\n    let descriptionAnno = aItem.annos &&\n                          aItem.annos.find(anno => anno.name == DESCRIPTION_ANNO);\n    if (descriptionAnno)\n      this._writeLine(aIndent + \"<DD>\" + escapeHtmlEntities(descriptionAnno.value));\n\n\nBut I don't get why this part in the exported bookmarks.html:\n\n\"<DD>Microsoft Visual Studio Solution File, Format Version 11.00\n# Visual Studio 2010 (...)\"\n\nhappens before first occurence of \"<DL><p>\", so before the actual bookmarks are listed.\nSo maybe this line?:\nhttps://dxr.mozilla.org/mozilla-central/source/toolkit/components/places/BookmarkHTMLUtils.jsm#1064", "creator": "pawelesc2@gmail.com"}, {"bug_id": 1176975, "time": "2015-12-11T16:29:04Z", "text": "would you mind sending me privately the places.sqlite file that generates this bookmarks.html file? Sounds like something is very wrong in its structure if it generates such a file...\n\nAre JSON backups working properly at all?", "author": "mak@mozilla.com", "is_private": false, "attachment_id": null, "raw_text": "would you mind sending me privately the places.sqlite file that generates this bookmarks.html file? Sounds like something is very wrong in its structure if it generates such a file...\n\nAre JSON backups working properly at all?", "creator": "mak@mozilla.com", "tags": [], "count": 4, "creation_time": "2015-12-11T16:29:04Z", "id": 11001178}, {"bug_id": 1176975, "time": "2015-12-11T16:32:27Z", "text": "btw, looks like that long string has been set as the description of the bookmarks menu folder, for whatever reason.", "author": "mak@mozilla.com", "is_private": false, "attachment_id": null, "creator": "mak@mozilla.com", "raw_text": "btw, looks like that long string has been set as the description of the bookmarks menu folder, for whatever reason.", "count": 5, "tags": [], "creation_time": "2015-12-11T16:32:27Z", "id": 11001194}, {"attachment_id": null, "raw_text": "(In reply to Marco Bonardo [::mak] from comment #4)\n> would you mind sending me privately the places.sqlite file that generates\n> this bookmarks.html file? Sounds like something is very wrong in its\n> structure if it generates such a file...\n> \n> Are JSON backups working properly at all?\n\nWhen using the Restore menu (the one which lists dates) - it works OK.\n\n(In reply to Marco Bonardo [::mak] from comment #5)\n> btw, looks like that long string has been set as the description of the\n> bookmarks menu folder, for whatever reason.\n\nIt was in fact description of the Bookmarks Toolbar folder. I deleted it, and now top of exported bookmarks.html file looks like that:\n\n<!DOCTYPE NETSCAPE-Bookmark-file-1>\n<!-- This is an automatically generated file.\n     It will be read and overwritten.\n     DO NOT EDIT! -->\n<META HTTP-EQUIV=\"Content-Type\" CONTENT=\"text/html; charset=UTF-8\">\n<TITLE>Bookmarks</TITLE>\n<H1>Menu Zak\u0142adki</H1>\n\n<DD>\n<DL><p>\n(...)\n\nAnd it still doesn't import. When I manually delete the \"<DD>\" tag - it works - but after that it STILL produces a file with the \"<DD>\" tag upon exporting. It's same with both 42.0 and Nightly.\n\nShould it be possible at all to add a description to the top folders of Bookmarks (like the Menu and Toolbar ones)? I can access the Properties of the Toolbar folder, but sometimes there's no option for it when right clicking, which is throwing me off further. I went to investigate and will post more details in next reply.", "creation_time": "2015-12-11T20:31:45Z", "creator": "pawelesc2@gmail.com", "id": 11001721, "tags": [], "time": "2015-12-11T20:31:45Z", "bug_id": 1176975, "count": 6, "author": "pawelesc2@gmail.com", "is_private": false, "text": "(In reply to Marco Bonardo [::mak] from comment #4)\n> would you mind sending me privately the places.sqlite file that generates\n> this bookmarks.html file? Sounds like something is very wrong in its\n> structure if it generates such a file...\n> \n> Are JSON backups working properly at all?\n\nWhen using the Restore menu (the one which lists dates) - it works OK.\n\n(In reply to Marco Bonardo [::mak] from comment #5)\n> btw, looks like that long string has been set as the description of the\n> bookmarks menu folder, for whatever reason.\n\nIt was in fact description of the Bookmarks Toolbar folder. I deleted it, and now top of exported bookmarks.html file looks like that:\n\n<!DOCTYPE NETSCAPE-Bookmark-file-1>\n<!-- This is an automatically generated file.\n     It will be read and overwritten.\n     DO NOT EDIT! -->\n<META HTTP-EQUIV=\"Content-Type\" CONTENT=\"text/html; charset=UTF-8\">\n<TITLE>Bookmarks</TITLE>\n<H1>Menu Zak\u0142adki</H1>\n\n<DD>\n<DL><p>\n(...)\n\nAnd it still doesn't import. When I manually delete the \"<DD>\" tag - it works - but after that it STILL produces a file with the \"<DD>\" tag upon exporting. It's same with both 42.0 and Nightly.\n\nShould it be possible at all to add a description to the top folders of Bookmarks (like the Menu and Toolbar ones)? I can access the Properties of the Toolbar folder, but sometimes there's no option for it when right clicking, which is throwing me off further. I went to investigate and will post more details in next reply."}, {"id": 11001740, "creation_time": "2015-12-11T20:42:38Z", "count": 7, "tags": [], "creator": "pawelesc2@gmail.com", "raw_text": "Menu allowing to add description to Bookmarks Menu folder by right clicking on Bookmarks Toolbar folder - note, that those are different folders!", "attachment_id": 8697683, "is_private": false, "author": "pawelesc2@gmail.com", "text": "Created attachment 8697683\nMenu allowing to add description to Bookmarks Menu folder by right clicking on Bookmarks Toolbar folder\n\nMenu allowing to add description to Bookmarks Menu folder by right clicking on Bookmarks Toolbar folder - note, that those are different folders!", "bug_id": 1176975, "time": "2015-12-11T20:42:38Z"}, {"time": "2015-12-11T20:43:12Z", "bug_id": 1176975, "is_private": false, "author": "pawelesc2@gmail.com", "text": "Created attachment 8697684\nPlace.sqlite files\n\nPlace.sqlite files - before and after adding a description to the Bookmarks Menu folder.", "attachment_id": 8697684, "raw_text": "Place.sqlite files - before and after adding a description to the Bookmarks Menu folder.", "creator": "pawelesc2@gmail.com", "tags": [], "count": 8, "id": 11001742, "creation_time": "2015-12-11T20:43:12Z"}, {"count": 9, "bug_id": 1176975, "time": "2015-12-11T20:53:02Z", "tags": [], "text": "So I tested it and attached two new files.\n\nI assume, that it shouldn't be possible to add a description to \"Bookmarks Menu\" folder. But actually I was able to do so, it's displayed on the attached image:\n  right clicking on Bookmarks Toolbar\n  accessing Properties (here it's \"W\u0142a\u015bciwo\u015bci\")\n  adding description and saving\n! note, that Bookmarks Toolbar and Bookmarks Menu are two different things, it's shown on the image with red and green !\nIt seems, that it opens properties of wrong folder. Also, sometimes there's no menu entry for Properties. I actually had to right-click around on other items (folders) for it to appear also for the Toolbar folder. This makes me think, that it shouldn't be possible at all to access Properties menu for the top folders.\n\nAfter adding the description the Places.sqlite file changes. Both are included as attachments: before and after adding the description. It seems, that this process corrupts the file permanently in a way, that it generates malformed bookmarks.html files. Note, that you can find the description (\"TESTDESCRIPTION\") itself in the \"post\" Places.sqlite file. Even if you delete the description from properties, there are traces of it being added before, so it's permanent.", "is_private": false, "author": "pawelesc2@gmail.com", "attachment_id": null, "creation_time": "2015-12-11T20:53:02Z", "id": 11001758, "creator": "pawelesc2@gmail.com", "raw_text": "So I tested it and attached two new files.\n\nI assume, that it shouldn't be possible to add a description to \"Bookmarks Menu\" folder. But actually I was able to do so, it's displayed on the attached image:\n  right clicking on Bookmarks Toolbar\n  accessing Properties (here it's \"W\u0142a\u015bciwo\u015bci\")\n  adding description and saving\n! note, that Bookmarks Toolbar and Bookmarks Menu are two different things, it's shown on the image with red and green !\nIt seems, that it opens properties of wrong folder. Also, sometimes there's no menu entry for Properties. I actually had to right-click around on other items (folders) for it to appear also for the Toolbar folder. This makes me think, that it shouldn't be possible at all to access Properties menu for the top folders.\n\nAfter adding the description the Places.sqlite file changes. Both are included as attachments: before and after adding the description. It seems, that this process corrupts the file permanently in a way, that it generates malformed bookmarks.html files. Note, that you can find the description (\"TESTDESCRIPTION\") itself in the \"post\" Places.sqlite file. Even if you delete the description from properties, there are traces of it being added before, so it's permanent."}, {"tags": [], "count": 10, "creation_time": "2018-06-29T10:38:18Z", "id": 13437591, "is_private": false, "author": "standard8@mozilla.com", "text": "I've just been trying this again, it turns out it was fixed in Firefox 58 by bug 1095427. The rewrite obviously made us slightly more lenient.", "time": "2018-06-29T10:38:18Z", "bug_id": 1176975, "raw_text": "I've just been trying this again, it turns out it was fixed in Firefox 58 by bug 1095427. The rewrite obviously made us slightly more lenient.", "creator": "standard8@mozilla.com", "attachment_id": null}]}}, "comments": {}}