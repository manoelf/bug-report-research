{"bugs": {"689769": {"comments": [{"count": 0, "bug_id": 689769, "creator": "n.nethercote@gmail.com", "is_private": false, "tags": [], "time": "2011-09-27T22:20:41Z", "text": "Inspired by bug 683284:  we use a lot more memory than other browsers on pages that have tons of text, e.g. tinderbox logs, big Mercurial changesets.  (We also do badly at text-ish/layout-ish things like tables).\n\nThis is a bug to track such cases.", "author": "n.nethercote@gmail.com", "creation_time": "2011-09-27T22:20:41Z", "raw_text": "Inspired by bug 683284:  we use a lot more memory than other browsers on pages that have tons of text, e.g. tinderbox logs, big Mercurial changesets.  (We also do badly at text-ish/layout-ish things like tables).\n\nThis is a bug to track such cases.", "attachment_id": null, "id": 5741579}, {"bug_id": 689769, "count": 1, "tags": [], "time": "2011-09-27T23:57:04Z", "text": "I recommend, like in bug 683284, that we limit this bug's depends list to bugs where we clearly do worse than another browser on an explicit testcase.  These bugs should be actionable.", "author": "justin.lebar+bug@gmail.com", "creation_time": "2011-09-27T23:57:04Z", "creator": "justin.lebar+bug@gmail.com", "is_private": false, "id": 5741861, "raw_text": "I recommend, like in bug 683284, that we limit this bug's depends list to bugs where we clearly do worse than another browser on an explicit testcase.  These bugs should be actionable.", "attachment_id": null}, {"creation_time": "2011-09-28T00:16:14Z", "author": "roc@ocallahan.org", "text": "I recommend distinguishing peak memory use (page has just loaded) from long-term memory use (after the page has been loaded for a minute or more). We create a lot of temporary textrun structures that get expired after about 30 seconds, and it'll be useful to know when they're the problem (or not).", "time": "2011-09-28T00:16:14Z", "tags": [], "bug_id": 689769, "is_private": false, "creator": "roc@ocallahan.org", "count": 2, "id": 5741905, "attachment_id": null, "raw_text": "I recommend distinguishing peak memory use (page has just loaded) from long-term memory use (after the page has been loaded for a minute or more). We create a lot of temporary textrun structures that get expired after about 30 seconds, and it'll be useful to know when they're the problem (or not)."}, {"id": 5743817, "raw_text": "roc, what are the temporary textrun structures for, and why are they expired?", "attachment_id": null, "text": "roc, what are the temporary textrun structures for, and why are they expired?", "tags": [], "time": "2011-09-28T18:48:21Z", "creation_time": "2011-09-28T18:48:21Z", "author": "n.nethercote@gmail.com", "is_private": false, "creator": "n.nethercote@gmail.com", "bug_id": 689769, "count": 3}, {"creation_time": "2011-09-28T23:08:23Z", "author": "roc@ocallahan.org", "text": "They're for caching the results of shaping (kerning etc) and measuring text.\n\nThey expire because after the page has finished loading (or otherwise changing) we don't need most of them anymore, and of course we want to save memory.", "time": "2011-09-28T23:08:23Z", "bug_id": 689769, "tags": [], "is_private": false, "creator": "roc@ocallahan.org", "count": 4, "id": 5744667, "attachment_id": null, "raw_text": "They're for caching the results of shaping (kerning etc) and measuring text.\n\nThey expire because after the page has finished loading (or otherwise changing) we don't need most of them anymore, and of course we want to save memory."}, {"author": "n.nethercote@gmail.com", "creation_time": "2011-09-28T23:39:35Z", "bug_id": 689769, "time": "2011-09-28T23:39:35Z", "tags": [], "text": "> They expire because after the page has finished loading (or otherwise\n> changing) we don't need most of them anymore, and of course we want to save\n> memory.\n\nWhy can't we just flush them as soon as we know they're finished?  Is there some uncertainty about whether they'll be needed again?", "creator": "n.nethercote@gmail.com", "is_private": false, "count": 5, "id": 5744762, "attachment_id": null, "raw_text": "> They expire because after the page has finished loading (or otherwise\n> changing) we don't need most of them anymore, and of course we want to save\n> memory.\n\nWhy can't we just flush them as soon as we know they're finished?  Is there some uncertainty about whether they'll be needed again?"}, {"creation_time": "2011-09-28T23:52:11Z", "author": "roc@ocallahan.org", "text": "Yes there is, because they're needed every time we reflow the page and we don't know when that will happen. The page could trigger reflows due to scripted changes, the user could resize the window, etc.", "time": "2011-09-28T23:52:11Z", "tags": [], "is_private": false, "creator": "roc@ocallahan.org", "id": 5744792, "attachment_id": null, "raw_text": "Yes there is, because they're needed every time we reflow the page and we don't know when that will happen. The page could trigger reflows due to scripted changes, the user could resize the window, etc.", "bug_id": 689769, "count": 6}, {"bug_id": 689769, "count": 7, "creation_time": "2011-09-29T01:29:08Z", "author": "bzbarsky@mit.edu", "text": "They're also needed to paint, no?  So when you're scrolling, you want to keep the textruns around for the text that's moving...", "time": "2011-09-29T01:29:08Z", "tags": [], "is_private": false, "creator": "bzbarsky@mit.edu", "id": 5745001, "attachment_id": null, "raw_text": "They're also needed to paint, no?  So when you're scrolling, you want to keep the textruns around for the text that's moving..."}, {"time": "2011-09-29T01:46:03Z", "bug_id": 689769, "tags": [], "text": "Yes, and they're needed for a few other things, but I was trying to keep the explanation simple :-)", "author": "roc@ocallahan.org", "creation_time": "2011-09-29T01:46:03Z", "count": 8, "creator": "roc@ocallahan.org", "is_private": false, "id": 5745025, "raw_text": "Yes, and they're needed for a few other things, but I was trying to keep the explanation simple :-)", "attachment_id": null}, {"id": 5745273, "attachment_id": null, "raw_text": "Given that most of the cases where we see this we're looking at fixed width fonts (AFAICT), are there any optimizations that would be worth doing for those cases? Seems those cases ought to be significantly simpler as far as text measurement and sizing goes... Mostly thinking out loud here, so if this is clearly not worth it, then so be it.", "creation_time": "2011-09-29T05:06:26Z", "author": "jstenback+bmo@gmail.com", "text": "Given that most of the cases where we see this we're looking at fixed width fonts (AFAICT), are there any optimizations that would be worth doing for those cases? Seems those cases ought to be significantly simpler as far as text measurement and sizing goes... Mostly thinking out loud here, so if this is clearly not worth it, then so be it.", "tags": [], "time": "2011-09-29T05:06:26Z", "bug_id": 689769, "is_private": false, "creator": "jstenback+bmo@gmail.com", "count": 9}, {"attachment_id": null, "raw_text": "Yes, we probably could and should do something to optimize some of the common cases here.\n\nOne question is whether it's possible to detect a \"fixed width\" font up-front in a way that actually works correctly for common fixed-width fonts. I'm not even sure that common fixed-width fonts have exactly the same advances for every character.", "id": 5745285, "creator": "roc@ocallahan.org", "is_private": false, "count": 10, "author": "roc@ocallahan.org", "creation_time": "2011-09-29T05:22:09Z", "tags": [], "bug_id": 689769, "time": "2011-09-29T05:22:09Z", "text": "Yes, we probably could and should do something to optimize some of the common cases here.\n\nOne question is whether it's possible to detect a \"fixed width\" font up-front in a way that actually works correctly for common fixed-width fonts. I'm not even sure that common fixed-width fonts have exactly the same advances for every character."}]}}, "comments": {}}