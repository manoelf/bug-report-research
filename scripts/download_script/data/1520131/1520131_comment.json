{"comments": {}, "bugs": {"1520131": {"comments": [{"id": 13863003, "text": "Created attachment 9036543\nmozconfig used to build\n\nUser Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3622.0 Safari/537.36\n\nSteps to reproduce:\n\nTried to build latest firefox-hg on ArchLinux x86_64\n\nlatest checked out changeset is:\nchangeset:   453851:e49161da5784\ntag:         tip\nparent:      453845:a01a559aa611\nparent:      453850:5ecfcb615bd6\nuser:        Brindusan Cristian <cbrindusan@mozilla.com>\ndate:        Tue Jan 15 06:38:06 2019 +0200\nsummary:     Merge inbound to mozilla-central. a=merge\n\nProblematic command that mach build executed:\n\n/tmp \n$ /usr/bin/ccache /usr/bin/clang++ -o Unified_cpp_toolkit_xre0.o -c  -I/tmp/obj-x86_64-pc-linux-gnu/dist/stl_wrappers -I/tmp/obj-x86_64-pc-linux-gnu/dist/system_wrappers -include /home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/config/gcc_hidden.h -DNDEBUG=1 -DTRIMMED=1 -DPROXY_PRINTING=1 -DOS_POSIX=1 -DOS_LINUX=1 -DUSE_GLX_TEST '-DMOZ_APP_NAME=\"firefox\"' '-DMOZ_APP_BASENAME=\"Firefox\"' '-DMOZ_APP_DISPLAYNAME=\"Nightly\"' '-DMOZ_APP_VERSION=\"66.0a1\"' '-DOS_TARGET=\"Linux\"' '-DMOZ_WIDGET_TOOLKIT=\"gtk3\"' '-DTARGET_OS_ABI=\"Linux_x86_64-gcc3\"' -DGRE_MILESTONE=66.0a1 -DAPP_VERSION=66.0a1 '-DAPP_ID={ec8030f7-c20a-464f-9b0e-13a3a9e97384}' -DMOZ_BUILD_APP_IS_BROWSER -DTOPOBJDIR=/tmp/obj-x86_64-pc-linux-gnu -DSTATIC_EXPORTABLE_JS_API -DMOZ_HAS_MOZGLUE -DMOZILLA_INTERNAL_API -DIMPL_LIBXUL -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/xre -I/tmp/obj-x86_64-pc-linux-gnu/toolkit/xre -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/components/printingui -I/tmp/obj-x86_64-pc-linux-gnu/ipc/ipdl/_ipdlheaders -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/ipc/chromium/src -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/ipc/glue -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/other-licenses/nsis/Contrib/CityHash/cityhash -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/components/find -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/components/printingui/ipc -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/components/windowwatcher -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/profile -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/config -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/dom/base -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/dom/commandhandler -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/dom/ipc -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/dom/webbrowserpersist -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/testing/gtest/mozilla -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/crashreporter -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/xpcom/build -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/widget/xremoteclient -I/tmp/obj-x86_64-pc-linux-gnu/dist/include -I/tmp/obj-x86_64-pc-linux-gnu/dist/include/nspr -I/tmp/obj-x86_64-pc-linux-gnu/dist/include/nss -fPIC -DMOZILLA_CLIENT -include /tmp/obj-x86_64-pc-linux-gnu/mozilla-config.h -Qunused-arguments -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Qunused-arguments -Wall -Wbitfield-enum-conversion -Wempty-body -Wignored-qualifiers -Woverloaded-virtual -Wpointer-arith -Wshadow-field-in-constructor-modified -Wsign-compare -Wtype-limits -Wunreachable-code -Wunreachable-code-return -Wwrite-strings -Wno-invalid-offsetof -Wclass-varargs -Wfloat-overflow-conversion -Wfloat-zero-conversion -Wloop-analysis -Wc++1z-compat -Wc++2a-compat -Wcomma -Wimplicit-fallthrough -Wstring-conversion -Wtautological-overlap-compare -Wtautological-unsigned-enum-zero-compare -Wtautological-unsigned-zero-compare -Wno-inline-new-delete -Wno-error=deprecated-declarations -Wno-error=array-bounds -Wno-error=return-std-move -Wno-error=atomic-alignment -Wformat -Wformat-security -Wno-gnu-zero-variadic-macro-arguments -Wno-unknown-warning-option -Wno-return-type-c-linkage -fno-sized-deallocation -pipe -march=native -Wno-trigraphs -fno-schedule-insns2 -fno-delete-null-pointer-checks -mtune=native -fomit-frame-pointer -Ofast -fno-fast-math -D_FORTIFY_SOURCE=2 -mno-avx -fPIC -mretpoline -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -fstack-protector-strong -fno-exceptions -fno-strict-aliasing -fno-rtti -fno-exceptions -fno-math-errno -pthread -pipe -g -O2 -fomit-frame-pointer -funwind-tables -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/widget/gtk/compat-gtk3 -I/usr/include/gtk-3.0 -I/usr/include/pango-1.0 -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include -I/usr/lib/libffi-3.2.1/include -I/usr/include/fribidi -I/usr/include/cairo -I/usr/include/pixman-1 -I/usr/include/freetype2 -I/usr/include/libpng16 -I/usr/include/harfbuzz -I/usr/include/uuid -I/usr/include/gdk-pixbuf-2.0 -I/usr/include/libmount -I/usr/include/blkid -I/usr/include/gio-unix-2.0 -I/usr/include/libdrm -I/usr/include/atk-1.0 -I/usr/include/at-spi2-atk/2.0 -I/usr/include/at-spi-2.0 -I/usr/include/dbus-1.0 -I/usr/lib/dbus-1.0/include -I/usr/include/gtk-3.0/unix-print -pthread -I/usr/include/pango-1.0 -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include -I/usr/lib/libffi-3.2.1/include -I/usr/include/fribidi -I/usr/include/freetype2 -I/usr/include/libpng16 -I/usr/include/harfbuzz -I/usr/include/uuid -I/usr/include/cairo -I/usr/include/pixman-1 -Wno-error=shadow  -MD -MP -MF .deps/Unified_cpp_toolkit_xre0.o.pp  -fcolor-diagnostics  /tmp/obj-x86_64-pc-linux-gnu/toolkit/xre/Unified_cpp_toolkit_xre0.cpp\n\n\n\nActual results:\n\nclang-7: warning: optimization flag '-fno-schedule-insns2' is not supported [-Wignored-optimization-argument]\nIn file included from /tmp/obj-x86_64-pc-linux-gnu/toolkit/xre/Unified_cpp_toolkit_xre0.cpp:137:\n/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/xre/nsXREDirProvider.cpp:22:10: fatal error: \n      'commonupdatedir.h' file not found\n#include \"commonupdatedir.h\"\n         ^~~~~~~~~~~~~~~~~~~\n1 error generated.\n\n\n\nExpected results:\n\nno error", "tags": [], "time": "2019-01-15T10:43:05Z", "bug_id": 1520131, "attachment_id": 9036543, "count": 0, "creator": "xftroxgpx@protonmail.com", "is_private": false, "raw_text": "User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3622.0 Safari/537.36\n\nSteps to reproduce:\n\nTried to build latest firefox-hg on ArchLinux x86_64\n\nlatest checked out changeset is:\nchangeset:   453851:e49161da5784\ntag:         tip\nparent:      453845:a01a559aa611\nparent:      453850:5ecfcb615bd6\nuser:        Brindusan Cristian <cbrindusan@mozilla.com>\ndate:        Tue Jan 15 06:38:06 2019 +0200\nsummary:     Merge inbound to mozilla-central. a=merge\n\nProblematic command that mach build executed:\n\n/tmp \n$ /usr/bin/ccache /usr/bin/clang++ -o Unified_cpp_toolkit_xre0.o -c  -I/tmp/obj-x86_64-pc-linux-gnu/dist/stl_wrappers -I/tmp/obj-x86_64-pc-linux-gnu/dist/system_wrappers -include /home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/config/gcc_hidden.h -DNDEBUG=1 -DTRIMMED=1 -DPROXY_PRINTING=1 -DOS_POSIX=1 -DOS_LINUX=1 -DUSE_GLX_TEST '-DMOZ_APP_NAME=\"firefox\"' '-DMOZ_APP_BASENAME=\"Firefox\"' '-DMOZ_APP_DISPLAYNAME=\"Nightly\"' '-DMOZ_APP_VERSION=\"66.0a1\"' '-DOS_TARGET=\"Linux\"' '-DMOZ_WIDGET_TOOLKIT=\"gtk3\"' '-DTARGET_OS_ABI=\"Linux_x86_64-gcc3\"' -DGRE_MILESTONE=66.0a1 -DAPP_VERSION=66.0a1 '-DAPP_ID={ec8030f7-c20a-464f-9b0e-13a3a9e97384}' -DMOZ_BUILD_APP_IS_BROWSER -DTOPOBJDIR=/tmp/obj-x86_64-pc-linux-gnu -DSTATIC_EXPORTABLE_JS_API -DMOZ_HAS_MOZGLUE -DMOZILLA_INTERNAL_API -DIMPL_LIBXUL -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/xre -I/tmp/obj-x86_64-pc-linux-gnu/toolkit/xre -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/components/printingui -I/tmp/obj-x86_64-pc-linux-gnu/ipc/ipdl/_ipdlheaders -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/ipc/chromium/src -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/ipc/glue -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/other-licenses/nsis/Contrib/CityHash/cityhash -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/components/find -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/components/printingui/ipc -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/components/windowwatcher -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/profile -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/config -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/dom/base -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/dom/commandhandler -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/dom/ipc -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/dom/webbrowserpersist -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/testing/gtest/mozilla -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/crashreporter -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/xpcom/build -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/widget/xremoteclient -I/tmp/obj-x86_64-pc-linux-gnu/dist/include -I/tmp/obj-x86_64-pc-linux-gnu/dist/include/nspr -I/tmp/obj-x86_64-pc-linux-gnu/dist/include/nss -fPIC -DMOZILLA_CLIENT -include /tmp/obj-x86_64-pc-linux-gnu/mozilla-config.h -Qunused-arguments -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -fstack-protector-strong -Qunused-arguments -Wall -Wbitfield-enum-conversion -Wempty-body -Wignored-qualifiers -Woverloaded-virtual -Wpointer-arith -Wshadow-field-in-constructor-modified -Wsign-compare -Wtype-limits -Wunreachable-code -Wunreachable-code-return -Wwrite-strings -Wno-invalid-offsetof -Wclass-varargs -Wfloat-overflow-conversion -Wfloat-zero-conversion -Wloop-analysis -Wc++1z-compat -Wc++2a-compat -Wcomma -Wimplicit-fallthrough -Wstring-conversion -Wtautological-overlap-compare -Wtautological-unsigned-enum-zero-compare -Wtautological-unsigned-zero-compare -Wno-inline-new-delete -Wno-error=deprecated-declarations -Wno-error=array-bounds -Wno-error=return-std-move -Wno-error=atomic-alignment -Wformat -Wformat-security -Wno-gnu-zero-variadic-macro-arguments -Wno-unknown-warning-option -Wno-return-type-c-linkage -fno-sized-deallocation -pipe -march=native -Wno-trigraphs -fno-schedule-insns2 -fno-delete-null-pointer-checks -mtune=native -fomit-frame-pointer -Ofast -fno-fast-math -D_FORTIFY_SOURCE=2 -mno-avx -fPIC -mretpoline -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -fstack-protector-strong -fno-exceptions -fno-strict-aliasing -fno-rtti -fno-exceptions -fno-math-errno -pthread -pipe -g -O2 -fomit-frame-pointer -funwind-tables -I/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/widget/gtk/compat-gtk3 -I/usr/include/gtk-3.0 -I/usr/include/pango-1.0 -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include -I/usr/lib/libffi-3.2.1/include -I/usr/include/fribidi -I/usr/include/cairo -I/usr/include/pixman-1 -I/usr/include/freetype2 -I/usr/include/libpng16 -I/usr/include/harfbuzz -I/usr/include/uuid -I/usr/include/gdk-pixbuf-2.0 -I/usr/include/libmount -I/usr/include/blkid -I/usr/include/gio-unix-2.0 -I/usr/include/libdrm -I/usr/include/atk-1.0 -I/usr/include/at-spi2-atk/2.0 -I/usr/include/at-spi-2.0 -I/usr/include/dbus-1.0 -I/usr/lib/dbus-1.0/include -I/usr/include/gtk-3.0/unix-print -pthread -I/usr/include/pango-1.0 -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include -I/usr/lib/libffi-3.2.1/include -I/usr/include/fribidi -I/usr/include/freetype2 -I/usr/include/libpng16 -I/usr/include/harfbuzz -I/usr/include/uuid -I/usr/include/cairo -I/usr/include/pixman-1 -Wno-error=shadow  -MD -MP -MF .deps/Unified_cpp_toolkit_xre0.o.pp  -fcolor-diagnostics  /tmp/obj-x86_64-pc-linux-gnu/toolkit/xre/Unified_cpp_toolkit_xre0.cpp\n\n\n\nActual results:\n\nclang-7: warning: optimization flag '-fno-schedule-insns2' is not supported [-Wignored-optimization-argument]\nIn file included from /tmp/obj-x86_64-pc-linux-gnu/toolkit/xre/Unified_cpp_toolkit_xre0.cpp:137:\n/home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/toolkit/xre/nsXREDirProvider.cpp:22:10: fatal error: \n      'commonupdatedir.h' file not found\n#include \"commonupdatedir.h\"\n         ^~~~~~~~~~~~~~~~~~~\n1 error generated.\n\n\n\nExpected results:\n\nno error", "author": "xftroxgpx@protonmail.com", "creation_time": "2019-01-15T10:43:05Z"}, {"bug_id": 1520131, "text": "```bash\n$ find . -iname commonupdatedir.h -exec ls -la `realpath {}` \\;\n-rw-r--r-- 1 xftroxgpx xftroxgpx 1267 Dec 25 16:00 /home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/./toolkit/mozapps/update/common/commonupdatedir.h\n```", "id": 13863011, "time": "2019-01-15T10:46:49Z", "tags": [], "raw_text": "```bash\n$ find . -iname commonupdatedir.h -exec ls -la `realpath {}` \\;\n-rw-r--r-- 1 xftroxgpx xftroxgpx 1267 Dec 25 16:00 /home/xftroxgpx/build/1packages/4used/firefox-hg/makepkg_pacman/firefox-hg/src/firefox-hg/./toolkit/mozapps/update/common/commonupdatedir.h\n```", "creator": "xftroxgpx@protonmail.com", "is_private": false, "creation_time": "2019-01-15T10:46:49Z", "author": "xftroxgpx@protonmail.com", "count": 1, "attachment_id": null}, {"is_private": false, "raw_text": "Are you using --disable-updater? I suspect that might be why this wasn't caught by automation.\n\nI'm encountering this problem as well and I do use that flag.", "author": "jan.steffens@gmail.com", "creation_time": "2019-01-15T11:00:47Z", "attachment_id": null, "count": 2, "creator": "jan.steffens@gmail.com", "bug_id": 1520131, "id": 13863035, "text": "Are you using --disable-updater? I suspect that might be why this wasn't caught by automation.\n\nI'm encountering this problem as well and I do use that flag.", "tags": [], "time": "2019-01-15T11:00:47Z"}, {"raw_text": "Indeed I am:\nac_add_options --disable-updater                                                \nin mozconfig file\nDid you find a workaround? other than --enable-updater which I presume would work.", "is_private": false, "creation_time": "2019-01-15T11:08:13Z", "author": "xftroxgpx@protonmail.com", "count": 3, "attachment_id": null, "creator": "xftroxgpx@protonmail.com", "bug_id": 1520131, "text": "Indeed I am:\nac_add_options --disable-updater                                                \nin mozconfig file\nDid you find a workaround? other than --enable-updater which I presume would work.", "id": 13863047, "time": "2019-01-15T11:08:13Z", "tags": []}, {"bug_id": 1520131, "time": "2019-01-15T11:23:24Z", "tags": [], "text": "Bug 1518587 moves the `#include \"commonupdatedir.h\"` out of the `#ifdef XP_WIN` but looking at the diff I'm not sure why it does that. Maybe moving it back will work.", "id": 13863068, "creation_time": "2019-01-15T11:23:24Z", "author": "jan.steffens@gmail.com", "raw_text": "Bug 1518587 moves the `#include \"commonupdatedir.h\"` out of the `#ifdef XP_WIN` but looking at the diff I'm not sure why it does that. Maybe moving it back will work.", "is_private": false, "creator": "jan.steffens@gmail.com", "count": 4, "attachment_id": null}, {"bug_id": 1520131, "tags": [], "time": "2019-01-15T12:10:46Z", "text": "Their left side file(toolkit/xre/nsXREDirProvider.cpp) looks different(older?) than mine, however I've found the diff between the last two changesets for that file:\n\nhg diff -r 453243:5c1a8f06c28b -r 453758:394b490d3e2d toolkit/xre/nsXREDirProvider.cpp\n\nand what you said is still true:\n\n```diff\ndiff -r 5c1a8f06c28b -r 394b490d3e2d toolkit/xre/nsXREDirProvider.cpp\n--- a/toolkit/xre/nsXREDirProvider.cpp\tThu Dec 13 09:08:40 2018 +0000\n+++ b/toolkit/xre/nsXREDirProvider.cpp\tMon Jan 14 17:27:34 2019 +0000\n@@ -19,6 +19,7 @@\n #include \"nsIToolkitChromeRegistry.h\"\n #include \"nsIToolkitProfileService.h\"\n #include \"nsIXULRuntime.h\"\n+#include \"commonupdatedir.h\"\n \n #include \"nsAppDirectoryServiceDefs.h\"\n #include \"nsDirectoryServiceDefs.h\"\n@@ -47,7 +48,6 @@\n #ifdef XP_WIN\n #include <windows.h>\n #include <shlobj.h>\n-#include \"commonupdatedir.h\"\n #endif\n #ifdef XP_MACOSX\n #include \"nsILocalFileMac.h\"\n@@ -98,19 +98,14 @@\n \n // These are required to allow nsXREDirProvider to be usable in xpcshell tests.\n // where gAppData is null.\n-static const char* GetAppProfile() {\n-  if (gAppData) {\n-    return gAppData->profile;\n-  }\n-  return nullptr;\n-}\n-\n+#if defined(XP_MACOSX) || defined(XP_WIN)\n static const char* GetAppName() {\n   if (gAppData) {\n     return gAppData->name;\n   }\n   return nullptr;\n }\n+#endif\n \n static const char* GetAppVendor() {\n   if (gAppData) {\n@@ -1608,14 +1603,21 @@\n nsresult nsXREDirProvider::AppendProfilePath(nsIFile* aFile, bool aLocal) {\n   NS_ASSERTION(aFile, \"Null pointer!\");\n \n+  // If there is no XREAppData then there is no information to use to build\n+  // the profile path so just do nothing. This should only happen in xpcshell\n+  // tests.\n+  if (!gAppData) {\n+    return NS_OK;\n+  }\n+\n   nsAutoCString profile;\n   nsAutoCString appName;\n   nsAutoCString vendor;\n-  if (GetAppProfile()) {\n-    profile = GetAppProfile();\n+  if (gAppData->profile) {\n+    profile = gAppData->profile;\n   } else {\n-    appName = GetAppName();\n-    vendor = GetAppVendor();\n+    appName = gAppData->name;\n+    vendor = gAppData->vendor;\n   }\n \n   nsresult rv;\n```", "id": 13863118, "author": "xftroxgpx@protonmail.com", "creation_time": "2019-01-15T12:10:46Z", "is_private": false, "raw_text": "Their left side file(toolkit/xre/nsXREDirProvider.cpp) looks different(older?) than mine, however I've found the diff between the last two changesets for that file:\n\nhg diff -r 453243:5c1a8f06c28b -r 453758:394b490d3e2d toolkit/xre/nsXREDirProvider.cpp\n\nand what you said is still true:\n\n```diff\ndiff -r 5c1a8f06c28b -r 394b490d3e2d toolkit/xre/nsXREDirProvider.cpp\n--- a/toolkit/xre/nsXREDirProvider.cpp\tThu Dec 13 09:08:40 2018 +0000\n+++ b/toolkit/xre/nsXREDirProvider.cpp\tMon Jan 14 17:27:34 2019 +0000\n@@ -19,6 +19,7 @@\n #include \"nsIToolkitChromeRegistry.h\"\n #include \"nsIToolkitProfileService.h\"\n #include \"nsIXULRuntime.h\"\n+#include \"commonupdatedir.h\"\n \n #include \"nsAppDirectoryServiceDefs.h\"\n #include \"nsDirectoryServiceDefs.h\"\n@@ -47,7 +48,6 @@\n #ifdef XP_WIN\n #include <windows.h>\n #include <shlobj.h>\n-#include \"commonupdatedir.h\"\n #endif\n #ifdef XP_MACOSX\n #include \"nsILocalFileMac.h\"\n@@ -98,19 +98,14 @@\n \n // These are required to allow nsXREDirProvider to be usable in xpcshell tests.\n // where gAppData is null.\n-static const char* GetAppProfile() {\n-  if (gAppData) {\n-    return gAppData->profile;\n-  }\n-  return nullptr;\n-}\n-\n+#if defined(XP_MACOSX) || defined(XP_WIN)\n static const char* GetAppName() {\n   if (gAppData) {\n     return gAppData->name;\n   }\n   return nullptr;\n }\n+#endif\n \n static const char* GetAppVendor() {\n   if (gAppData) {\n@@ -1608,14 +1603,21 @@\n nsresult nsXREDirProvider::AppendProfilePath(nsIFile* aFile, bool aLocal) {\n   NS_ASSERTION(aFile, \"Null pointer!\");\n \n+  // If there is no XREAppData then there is no information to use to build\n+  // the profile path so just do nothing. This should only happen in xpcshell\n+  // tests.\n+  if (!gAppData) {\n+    return NS_OK;\n+  }\n+\n   nsAutoCString profile;\n   nsAutoCString appName;\n   nsAutoCString vendor;\n-  if (GetAppProfile()) {\n-    profile = GetAppProfile();\n+  if (gAppData->profile) {\n+    profile = gAppData->profile;\n   } else {\n-    appName = GetAppName();\n-    vendor = GetAppVendor();\n+    appName = gAppData->name;\n+    vendor = gAppData->vendor;\n   }\n \n   nsresult rv;\n```", "creator": "xftroxgpx@protonmail.com", "attachment_id": null, "count": 5}, {"raw_text": "Removing the `#include \"commonupdatedir.h\"` line (eg. commented it out) worked well - compiled&installed firefox now.\nThank you Jan Alexander Steffens [:heftig] !", "creator": "xftroxgpx@protonmail.com", "bug_id": 1520131, "time": "2019-01-15T15:41:51Z", "tags": [], "id": 13863512, "text": "Removing the `#include \"commonupdatedir.h\"` line (eg. commented it out) worked well - compiled&installed firefox now.\nThank you Jan Alexander Steffens [:heftig] !", "creation_time": "2019-01-15T15:41:51Z", "author": "xftroxgpx@protonmail.com", "is_private": false, "count": 6, "attachment_id": null}, {"is_private": false, "author": "jbeich@FreeBSD.org", "creation_time": "2019-01-15T16:40:18Z", "attachment_id": null, "count": 7, "bug_id": 1520131, "text": "*** Bug 1520193 has been marked as a duplicate of this bug. ***", "id": 13863683, "tags": [], "time": "2019-01-15T16:40:18Z", "raw_text": "", "creator": "jbeich@FreeBSD.org"}, {"bug_id": 1520131, "text": "(In reply to Jan Alexander Steffens [:heftig] from comment #2)\n> Are you using --disable-updater? I suspect that might be why this wasn't\n> caught by automation.\n\nBug 1371159 is supposed to fix automation.", "id": 13863747, "tags": [], "time": "2019-01-15T16:58:25Z", "is_private": false, "raw_text": "(In reply to Jan Alexander Steffens [:heftig] from comment #2)\n> Are you using --disable-updater? I suspect that might be why this wasn't\n> caught by automation.\n\nBug 1371159 is supposed to fix automation.", "author": "jbeich@FreeBSD.org", "creation_time": "2019-01-15T16:58:25Z", "attachment_id": null, "count": 8, "creator": "jbeich@FreeBSD.org"}, {"time": "2019-01-15T17:37:50Z", "tags": [], "text": "Ok, this should be fixed in bug 1520139 (beta builds on android run with the updater disabled).", "id": 13863848, "bug_id": 1520131, "creator": "dtownsend@mozilla.com", "count": 9, "attachment_id": null, "creation_time": "2019-01-15T17:37:50Z", "author": "dtownsend@mozilla.com", "raw_text": "Ok, this should be fixed in bug 1520139 (beta builds on android run with the updater disabled).", "is_private": false}, {"text": "This also breaks the build on Linux (with the mozconfig option).", "id": 13863980, "time": "2019-01-15T18:29:05Z", "tags": [], "bug_id": 1520131, "count": 10, "attachment_id": null, "creator": "acelists@atlas.sk", "raw_text": "This also breaks the build on Linux (with the mozconfig option).", "is_private": false, "creation_time": "2019-01-15T18:29:05Z", "author": "acelists@atlas.sk"}, {"time": "2019-01-15T18:58:01Z", "tags": [], "id": 13864065, "text": "The build is also broken for a local Fennec/GeckoView from m-c, since the default is to not use the updater.", "bug_id": 1520131, "creator": "snorp@snorp.net", "count": 11, "attachment_id": null, "creation_time": "2019-01-15T18:58:01Z", "author": "snorp@snorp.net", "raw_text": "The build is also broken for a local Fennec/GeckoView from m-c, since the default is to not use the updater.", "is_private": false}, {"count": 12, "attachment_id": null, "creator": "dtownsend@mozilla.com", "raw_text": "The patch in bug 1520139 should fix all that, though it would be useful to confirm that.", "is_private": false, "creation_time": "2019-01-15T19:58:51Z", "author": "dtownsend@mozilla.com", "text": "The patch in bug 1520139 should fix all that, though it would be useful to confirm that.", "id": 13864205, "time": "2019-01-15T19:58:51Z", "tags": [], "bug_id": 1520131}, {"is_private": false, "raw_text": "It builds again, thanks.", "author": "jan.steffens@gmail.com", "creation_time": "2019-01-16T15:14:03Z", "attachment_id": null, "count": 13, "creator": "jan.steffens@gmail.com", "bug_id": 1520131, "id": 13865880, "text": "It builds again, thanks.", "tags": [], "time": "2019-01-16T15:14:03Z"}]}}}