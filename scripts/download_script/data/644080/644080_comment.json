{"comments": {}, "bugs": {"644080": {"comments": [{"attachment_id": null, "creator": "bebraw@gmail.com", "author": "bebraw@gmail.com", "text": "User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.16 Safari/534.24\nBuild Identifier: Firefox 4.0\n\nIn the example linked I set up a Canvas and drew a few \"dabs\" on it using \"copy\" compositing mode and a circle clipping area.\n\nUnlike in other browsers, FF3.6 included, FF4 renders a faint white border around the dabs. It might be cool to get that fixed. I would also appreciate if you could point me to some possible workaround. Perhaps I'm missing something obvious. :)\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Open the provided URL in FF4.\n2. Open the provided URL in FF3.6 or some other browser supporting Canvas.\n3. Compare the result.\nActual Results:  \nThe result did not match (white border around \"dabs\").\n\nExpected Results:  \nNo white borders around \"dabs\".", "count": 0, "is_private": false, "tags": [], "raw_text": "User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.16 Safari/534.24\nBuild Identifier: Firefox 4.0\n\nIn the example linked I set up a Canvas and drew a few \"dabs\" on it using \"copy\" compositing mode and a circle clipping area.\n\nUnlike in other browsers, FF3.6 included, FF4 renders a faint white border around the dabs. It might be cool to get that fixed. I would also appreciate if you could point me to some possible workaround. Perhaps I'm missing something obvious. :)\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Open the provided URL in FF4.\n2. Open the provided URL in FF3.6 or some other browser supporting Canvas.\n3. Compare the result.\nActual Results:  \nThe result did not match (white border around \"dabs\").\n\nExpected Results:  \nNo white borders around \"dabs\".", "creation_time": "2011-03-23T08:43:30Z", "bug_id": 644080, "id": 5361988, "time": "2011-03-23T08:43:30Z"}, {"attachment_id": 521171, "is_private": false, "tags": [], "creator": "alex.lakatos.qa@gmail.com", "creation_time": "2011-03-23T14:38:38Z", "bug_id": 644080, "raw_text": "This is a screenshot comparing renderings in Firefox 4 and Chrome 10", "id": 5362439, "time": "2011-03-23T14:38:38Z", "author": "alex.lakatos.qa@gmail.com", "text": "Created attachment 521171\nscreenshot comparing ff4 and chrome10\n\nThis is a screenshot comparing renderings in Firefox 4 and Chrome 10", "count": 1}, {"count": 2, "text": "Created attachment 521173\nscreenshot after a locked screen\n\nIf i lock the screen, when i unlock it the canvas is painted with artefacts.", "author": "alex.lakatos.qa@gmail.com", "creator": "alex.lakatos.qa@gmail.com", "attachment_id": 521173, "id": 5362462, "time": "2011-03-23T14:43:47Z", "tags": [], "raw_text": "If i lock the screen, when i unlock it the canvas is painted with artefacts.", "bug_id": 644080, "creation_time": "2011-03-23T14:43:47Z", "is_private": false}, {"creator": "bzbarsky@mit.edu", "attachment_id": null, "count": 3, "text": "Chrome and Firefox 3.6 implement the \"copy\" compositing mode incorrectly.\n\nOpera 11 and Firefox 4 do it right (as does IE9).  Opera has the same white dabs...\n\nI can also reproduce them with a rect clip, but only if I make it non-pixel-aligned.  Is it possible that we're ending up with some pixels that are partially covered by the clip path and as a result we don't paint into them from the source image but do paint them into the canvas or some such?\n\nOh, and I see this on Mac.\n\nAlex, I suspect your screen locking issues have nothing to do with this bug.", "author": "bzbarsky@mit.edu", "raw_text": "Chrome and Firefox 3.6 implement the \"copy\" compositing mode incorrectly.\n\nOpera 11 and Firefox 4 do it right (as does IE9).  Opera has the same white dabs...\n\nI can also reproduce them with a rect clip, but only if I make it non-pixel-aligned.  Is it possible that we're ending up with some pixels that are partially covered by the clip path and as a result we don't paint into them from the source image but do paint them into the canvas or some such?\n\nOh, and I see this on Mac.\n\nAlex, I suspect your screen locking issues have nothing to do with this bug.", "bug_id": 644080, "creation_time": "2011-03-23T15:14:32Z", "tags": [], "is_private": false, "time": "2011-03-23T15:14:32Z", "id": 5362540}, {"attachment_id": null, "is_private": false, "bug_id": 644080, "creation_time": "2011-03-23T16:50:44Z", "raw_text": "Thanks Boris, filed bug 644199 now for the issue in comment 2.", "tags": [], "creator": "alex.lakatos.qa@gmail.com", "time": "2011-03-23T16:50:44Z", "author": "alex.lakatos.qa@gmail.com", "id": 5362821, "count": 4, "text": "Thanks Boris, filed bug 644199 now for the issue in comment 2."}, {"time": "2011-03-23T21:44:58Z", "id": 5363938, "bug_id": 644080, "creation_time": "2011-03-23T21:44:58Z", "raw_text": "We render the image to a temporary surface, clipped, then draw that surface to the destination with operator SOURCE, clipped again.\n\nWhen the clip partially covers a pixel with amount C < 1.0, the first step sets the temporary surface pixel alpha to C. The second step sets the output pixel alpha to B*(1 - C) + C*C, where B is the previous output pixel alpha (probably 1.0). So that pixel ends up partially transparent.\n\nThe core issue is that we're applying the clip at two different places in the pipeline and when we're doing antialiased clipping with an alpha mask, clipping is not idempotent. Notice that Chrome doesn't antialias the clip in that screenshot.\n\nIn this case it would be enough to just not apply the global clip when we draw to the temporary surface, but that's hard to implement with cairo.", "tags": [], "is_private": false, "text": "We render the image to a temporary surface, clipped, then draw that surface to the destination with operator SOURCE, clipped again.\n\nWhen the clip partially covers a pixel with amount C < 1.0, the first step sets the temporary surface pixel alpha to C. The second step sets the output pixel alpha to B*(1 - C) + C*C, where B is the previous output pixel alpha (probably 1.0). So that pixel ends up partially transparent.\n\nThe core issue is that we're applying the clip at two different places in the pipeline and when we're doing antialiased clipping with an alpha mask, clipping is not idempotent. Notice that Chrome doesn't antialias the clip in that screenshot.\n\nIn this case it would be enough to just not apply the global clip when we draw to the temporary surface, but that's hard to implement with cairo.", "count": 5, "author": "roc@ocallahan.org", "creator": "roc@ocallahan.org", "attachment_id": null}, {"count": 6, "text": "Well, it's probably not that hard.", "time": "2011-03-23T21:46:50Z", "author": "roc@ocallahan.org", "id": 5363944, "creation_time": "2011-03-23T21:46:50Z", "bug_id": 644080, "raw_text": "Well, it's probably not that hard.", "tags": [], "creator": "roc@ocallahan.org", "attachment_id": null, "is_private": false}, {"time": "2011-04-04T05:40:32Z", "id": 5389814, "is_private": false, "raw_text": "Robert, was this method of C <1.0 changed in FF 4 since this issue does not happen in previous versions of FF prior to 4?\n\nDoes your \"probably not that hard\" suggest this issue status will be changed to assigned any time soon? :)", "creation_time": "2011-04-04T05:40:32Z", "bug_id": 644080, "tags": [], "author": "mixart@gmail.com", "count": 7, "text": "Robert, was this method of C <1.0 changed in FF 4 since this issue does not happen in previous versions of FF prior to 4?\n\nDoes your \"probably not that hard\" suggest this issue status will be changed to assigned any time soon? :)", "attachment_id": null, "creator": "mixart@gmail.com"}, {"creator": "roc@ocallahan.org", "attachment_id": null, "text": "I'm not sure what changed this for FF4.\n\nWe have a lot of more important stuff to work on, probably. But this might be fixed by some of the canvas performance work we're planning to do.", "count": 8, "author": "roc@ocallahan.org", "raw_text": "I'm not sure what changed this for FF4.\n\nWe have a lot of more important stuff to work on, probably. But this might be fixed by some of the canvas performance work we're planning to do.", "bug_id": 644080, "creation_time": "2011-04-07T22:02:39Z", "tags": [], "is_private": false, "time": "2011-04-07T22:02:39Z", "id": 5395207}, {"creation_time": "2011-08-17T07:34:02Z", "bug_id": 644080, "raw_text": "@Robert O'Callahan: How did the optimization work go?\n\nJust FYI the bug still seems to be reproducible (FF 6.0, OS X Lion).", "tags": [], "is_private": false, "time": "2011-08-17T07:34:02Z", "id": 5659044, "creator": "bebraw@gmail.com", "attachment_id": null, "text": "@Robert O'Callahan: How did the optimization work go?\n\nJust FYI the bug still seems to be reproducible (FF 6.0, OS X Lion).", "count": 9, "author": "bebraw@gmail.com"}, {"creator": "roc@ocallahan.org", "attachment_id": null, "count": 10, "text": "It's in Firefox 7, so in nightlies/Aurora/Beta. Although I don't think the latest beta builds have it yet.", "author": "roc@ocallahan.org", "tags": [], "bug_id": 644080, "creation_time": "2011-08-18T03:08:43Z", "raw_text": "It's in Firefox 7, so in nightlies/Aurora/Beta. Although I don't think the latest beta builds have it yet.", "is_private": false, "id": 5661642, "time": "2011-08-18T03:08:43Z"}, {"id": 5667124, "time": "2011-08-20T10:03:23Z", "is_private": false, "tags": [], "raw_text": "Hey Robert, just downloaded the latest nightlies (8.0a1) which you suggest has the fix, but did not notice it was fixed (using the link posted in the OP).. http://ratemydrawings.com/bebraw/copyclip/copyclip.html", "bug_id": 644080, "creation_time": "2011-08-20T10:03:23Z", "author": "mixart@gmail.com", "text": "Hey Robert, just downloaded the latest nightlies (8.0a1) which you suggest has the fix, but did not notice it was fixed (using the link posted in the OP).. http://ratemydrawings.com/bebraw/copyclip/copyclip.html", "count": 11, "attachment_id": null, "creator": "mixart@gmail.com"}, {"time": "2011-08-20T12:15:45Z", "id": 5667199, "raw_text": "Well, that work was only for Windows so far, but yeah, it didn't fix it even on Windows.\n\nWe should be able to fix this in Azure fairly easily though. Bas, see comment #5...", "creation_time": "2011-08-20T12:15:45Z", "bug_id": 644080, "tags": [], "is_private": false, "count": 12, "text": "Well, that work was only for Windows so far, but yeah, it didn't fix it even on Windows.\n\nWe should be able to fix this in Azure fairly easily though. Bas, see comment #5...", "author": "roc@ocallahan.org", "creator": "roc@ocallahan.org", "attachment_id": null}, {"time": "2011-08-20T13:56:57Z", "id": 5667263, "is_private": false, "bug_id": 644080, "creation_time": "2011-08-20T13:56:57Z", "raw_text": "I'm not sure this is trivial in Azure! But I will look :)", "tags": [], "author": "bas@basschouten.com", "text": "I'm not sure this is trivial in Azure! But I will look :)", "count": 13, "attachment_id": null, "creator": "bas@basschouten.com"}, {"is_private": false, "creation_time": "2011-11-01T10:42:49Z", "bug_id": 644080, "raw_text": "Have a community of members - many who have turned away from FF due to this bug rendering one of my web apps useless - such a shame. Cheering for someone to make this a priority :)", "tags": [], "time": "2011-11-01T10:42:49Z", "id": 5817485, "attachment_id": null, "creator": "mixart@gmail.com", "author": "mixart@gmail.com", "text": "Have a community of members - many who have turned away from FF due to this bug rendering one of my web apps useless - such a shame. Cheering for someone to make this a priority :)", "count": 14}]}}}