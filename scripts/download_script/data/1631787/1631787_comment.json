{"bugs": {"1631787": {"comments": [{"creation_time": "2020-04-21T13:43:35Z", "creator": "rtublitz@mozilla.com", "attachment_id": null, "id": 14769006, "text": "Vasilica's team will be testing the migration as part of [this PI request](https://jira.mozilla.com/browse/PI-573). \n\nI'm marking this as a P1 as we're planning to start the migration on May 4th assuming all goes ok.\n\nErik and JR: can you be on hand to help troubleshoot? JR: could you also detail specifically what flags to use for the script?", "raw_text": "Vasilica's team will be testing the migration as part of [this PI request](https://jira.mozilla.com/browse/PI-573). \n\nI'm marking this as a P1 as we're planning to start the migration on May 4th assuming all goes ok.\n\nErik and JR: can you be on hand to help troubleshoot? JR: could you also detail specifically what flags to use for the script?", "time": "2020-04-21T13:43:35Z", "author": "rtublitz@mozilla.com", "tags": [], "bug_id": 1631787, "is_private": false, "count": 0}, {"creation_time": "2020-04-21T15:27:40Z", "creator": "eolson@mozilla.com", "attachment_id": null, "text": "Yes, sounds great!", "id": 14769356, "raw_text": "Yes, sounds great!", "time": "2020-04-21T15:27:40Z", "author": "eolson@mozilla.com", "bug_id": 1631787, "tags": [], "count": 1, "is_private": false}, {"text": "There are now several scripts that will need to be run. The (README.md)[https://github.com/mozilla-services/syncstorage-rs/tree/master/tools/user_migration_ file] includes instructions about how to run these. All scripts support `--help` which will list all available options, their functions and default values (if appropriate). Most of the option default values have been suggested by operations, so no changes should be required. It is presumed that the scripts will have default read and write access to the current directory.\n\nBy default, the `gen_bso_users.py --hoard_limit` value does not have a default value. @eolson may have recommendations about what a good value to use is. \n\nNote, these scripts will generate a `success_{date}.log` and `failure_{date}.log` file (if appropriate) indicating the successfully and unsuccessfully migrated userids.", "id": 14769750, "creation_time": "2020-04-21T17:05:21Z", "creator": "jrconlin@mozilla.com", "attachment_id": null, "author": "jrconlin@mozilla.com", "tags": [], "bug_id": 1631787, "count": 2, "is_private": false, "raw_text": "There are now several scripts that will need to be run. The (README.md)[https://github.com/mozilla-services/syncstorage-rs/tree/master/tools/user_migration_ file] includes instructions about how to run these. All scripts support `--help` which will list all available options, their functions and default values (if appropriate). Most of the option default values have been suggested by operations, so no changes should be required. It is presumed that the scripts will have default read and write access to the current directory.\n\nBy default, the `gen_bso_users.py --hoard_limit` value does not have a default value. @eolson may have recommendations about what a good value to use is. \n\nNote, these scripts will generate a `success_{date}.log` and `failure_{date}.log` file (if appropriate) indicating the successfully and unsuccessfully migrated userids.", "time": "2020-04-21T17:05:21Z"}, {"raw_text": "Hi! Here are the selected accounts for this second part testing of sync data migration:\n \nproduser1@mailinator.com     128709160\nproduser2@mailinator.com     128754071\nproduser3@mailinator.com     128803402\nproduser4@mailinator.com     128803495\nproduser5@mailinator.com     128804907\nproduser6@mailinator.com     128806959\nproduser8@mailinator.com     128808758\nproduser9@mailinator.com     128809197\nproduser10@mailinator.com  128808946\nproduser13@mailinator.com  128809645\nproduser14@mailinator.com  128812632\nproduser15@mailinator.com  128812699", "creation_time": "2020-04-23T14:07:03Z", "time": "2020-04-23T14:07:03Z", "creator": "vasilica.mihasca@softvision.com", "attachment_id": null, "id": 14773916, "text": "Hi! Here are the selected accounts for this second part testing of sync data migration:\n \nproduser1@mailinator.com     128709160\nproduser2@mailinator.com     128754071\nproduser3@mailinator.com     128803402\nproduser4@mailinator.com     128803495\nproduser5@mailinator.com     128804907\nproduser6@mailinator.com     128806959\nproduser8@mailinator.com     128808758\nproduser9@mailinator.com     128809197\nproduser10@mailinator.com  128808946\nproduser13@mailinator.com  128809645\nproduser14@mailinator.com  128812632\nproduser15@mailinator.com  128812699", "author": "vasilica.mihasca@softvision.com", "bug_id": 1631787, "tags": [], "is_private": false, "count": 3}, {"creator": "eolson@mozilla.com", "attachment_id": null, "creation_time": "2020-04-23T19:20:36Z", "text": "Hello, they have been assigned to the node we will use for migration.  Their new uids are as follows:\n```\nproduser1@mailinator.com 128709160 ebd5428fdef74e7ea2315bb4c0ed3897@api.accounts.firefox.com 143683269\nproduser2@mailinator.com 128754071 0f13d22f1c3e48edba8f49bd83f295af@api.accounts.firefox.com 143683279\nproduser3@mailinator.com 128803402 9909a79230b04ce7ab19b75206b6d8a7@api.accounts.firefox.com 143683290\nproduser4@mailinator.com 128803495 9b46d6447ed14421849d155c821ac3f1@api.accounts.firefox.com 143683297\nproduser5@mailinator.com 128804907 31a63278ac2d48afb72808ea7145b7c2@api.accounts.firefox.com 143683302\nproduser6@mailinator.com 128806959 d4db06b1118a46cdb73c6091ce176f63@api.accounts.firefox.com 143683311\nproduser8@mailinator.com 128808758 16cde22f1532456ea91e7744dce4c605@api.accounts.firefox.com 143683318\nproduser9@mailinator.com 128809197 632c2fba929a4194a2f98685edb00163@api.accounts.firefox.com 143683321\nproduser10@mailinator.com 128808946 f20b94b939ca47cba726760a13e2d4d2@api.accounts.firefox.com 143683328\nproduser13@mailinator.com 128809645 96be267c104a4b02be3c7895e7af3bb0@api.accounts.firefox.com 143683334\nproduser14@mailinator.com 128812632 387cc0c04a8f489fa94af0136b0b4cfe@api.accounts.firefox.com 143683341\nproduser15@mailinator.com 128812699 36b464f5ef1f4bd38920a311bd2ea654@api.accounts.firefox.com 143683351\n```\nThe node is up, please allow them to sync prior to the testing.", "id": 14774682, "time": "2020-04-23T19:20:36Z", "raw_text": "Hello, they have been assigned to the node we will use for migration.  Their new uids are as follows:\n```\nproduser1@mailinator.com 128709160 ebd5428fdef74e7ea2315bb4c0ed3897@api.accounts.firefox.com 143683269\nproduser2@mailinator.com 128754071 0f13d22f1c3e48edba8f49bd83f295af@api.accounts.firefox.com 143683279\nproduser3@mailinator.com 128803402 9909a79230b04ce7ab19b75206b6d8a7@api.accounts.firefox.com 143683290\nproduser4@mailinator.com 128803495 9b46d6447ed14421849d155c821ac3f1@api.accounts.firefox.com 143683297\nproduser5@mailinator.com 128804907 31a63278ac2d48afb72808ea7145b7c2@api.accounts.firefox.com 143683302\nproduser6@mailinator.com 128806959 d4db06b1118a46cdb73c6091ce176f63@api.accounts.firefox.com 143683311\nproduser8@mailinator.com 128808758 16cde22f1532456ea91e7744dce4c605@api.accounts.firefox.com 143683318\nproduser9@mailinator.com 128809197 632c2fba929a4194a2f98685edb00163@api.accounts.firefox.com 143683321\nproduser10@mailinator.com 128808946 f20b94b939ca47cba726760a13e2d4d2@api.accounts.firefox.com 143683328\nproduser13@mailinator.com 128809645 96be267c104a4b02be3c7895e7af3bb0@api.accounts.firefox.com 143683334\nproduser14@mailinator.com 128812632 387cc0c04a8f489fa94af0136b0b4cfe@api.accounts.firefox.com 143683341\nproduser15@mailinator.com 128812699 36b464f5ef1f4bd38920a311bd2ea654@api.accounts.firefox.com 143683351\n```\nThe node is up, please allow them to sync prior to the testing.", "count": 4, "is_private": false, "bug_id": 1631787, "tags": [], "author": "eolson@mozilla.com"}, {"count": 5, "is_private": false, "bug_id": 1631787, "tags": [], "author": "eolson@mozilla.com", "text": "I used 300k as a hoard limit in a recent test, that seemed reasonable as it would take about 4.5 minutes to transfer a user with that many rows and less than .5% of users on the node had more than that.", "id": 14774723, "attachment_id": null, "creator": "eolson@mozilla.com", "time": "2020-04-23T19:38:17Z", "creation_time": "2020-04-23T19:38:17Z", "raw_text": "I used 300k as a hoard limit in a recent test, that seemed reasonable as it would take about 4.5 minutes to transfer a user with that many rows and less than .5% of users on the node had more than that."}, {"attachment_id": null, "creator": "bobm@mozilla.com", "creation_time": "2020-04-23T21:16:17Z", "text": "*** Bug 1567006 has been marked as a duplicate of this bug. ***", "id": 14774956, "time": "2020-04-23T21:16:17Z", "raw_text": "", "count": 6, "is_private": false, "tags": [], "bug_id": 1631787, "author": "bobm@mozilla.com"}, {"time": "2020-04-29T14:37:57Z", "raw_text": "Migration tests were completed yesterday.  There were 12 clients tested.  The beginning of the test was delayed due to the clients having sync errors while connecting to the migration sync-py node and deleting all their data.  We have reproduced this issue today and it may need to be addressed.\n\nThe clients were re-populated and the migration to spanner testing was completed.\n\nAttaching two clients logs showing the failures that led to data loss.", "count": 7, "is_private": false, "bug_id": 1631787, "tags": [], "author": "eolson@mozilla.com", "creator": "eolson@mozilla.com", "attachment_id": null, "creation_time": "2020-04-29T14:37:57Z", "id": 14786266, "text": "Migration tests were completed yesterday.  There were 12 clients tested.  The beginning of the test was delayed due to the clients having sync errors while connecting to the migration sync-py node and deleting all their data.  We have reproduced this issue today and it may need to be addressed.\n\nThe clients were re-populated and the migration to spanner testing was completed.\n\nAttaching two clients logs showing the failures that led to data loss."}, {"bug_id": 1631787, "tags": [], "is_private": false, "count": 8, "author": "eolson@mozilla.com", "time": "2020-04-29T14:38:32Z", "raw_text": "", "text": "Created attachment 9144330\nsync errors for 143683269.txt", "id": 14786269, "attachment_id": 9144330, "creator": "eolson@mozilla.com", "creation_time": "2020-04-29T14:38:32Z"}, {"author": "eolson@mozilla.com", "bug_id": 1631787, "tags": [], "count": 9, "is_private": false, "raw_text": "", "time": "2020-04-29T14:38:42Z", "text": "Created attachment 9144331\nsync errors for 143683279.txt", "id": 14786270, "creation_time": "2020-04-29T14:38:42Z", "creator": "eolson@mozilla.com", "attachment_id": 9144331}, {"raw_text": "New uids to get server logs after data migration to spanner:\n```\nproduser1@mailinator.com 128709160 ebd5428fdef74e7ea2315bb4c0ed3897@api.accounts.firefox.com 144074002\nproduser2@mailinator.com 128754071 0f13d22f1c3e48edba8f49bd83f295af@api.accounts.firefox.com 144074484\nproduser3@mailinator.com 128803402 9909a79230b04ce7ab19b75206b6d8a7@api.accounts.firefox.com 144073987\nproduser4@mailinator.com 128803495 9b46d6447ed14421849d155c821ac3f1@api.accounts.firefox.com 144075243\nproduser5@mailinator.com 128804907 31a63278ac2d48afb72808ea7145b7c2@api.accounts.firefox.com 144076549\nproduser6@mailinator.com 128806959 d4db06b1118a46cdb73c6091ce176f63@api.accounts.firefox.com 144076072\nproduser8@mailinator.com 128808758 16cde22f1532456ea91e7744dce4c605@api.accounts.firefox.com 144074443\nproduser9@mailinator.com 128809197 632c2fba929a4194a2f98685edb00163@api.accounts.firefox.com 144075229\nproduser10@mailinator.com 128808946 f20b94b939ca47cba726760a13e2d4d2@api.accounts.firefox.com 144076550\nproduser13@mailinator.com 128809645 96be267c104a4b02be3c7895e7af3bb0@api.accounts.firefox.com 144124338\nproduser14@mailinator.com 128812632 387cc0c04a8f489fa94af0136b0b4cfe@api.accounts.firefox.com 144076546\nproduser15@mailinator.com 128812699 36b464f5ef1f4bd38920a311bd2ea654@api.accounts.firefox.com 144125169\n```", "time": "2020-04-29T15:09:16Z", "author": "eolson@mozilla.com", "is_private": false, "count": 10, "tags": [], "bug_id": 1631787, "creation_time": "2020-04-29T15:09:16Z", "creator": "eolson@mozilla.com", "attachment_id": null, "id": 14786350, "text": "New uids to get server logs after data migration to spanner:\n```\nproduser1@mailinator.com 128709160 ebd5428fdef74e7ea2315bb4c0ed3897@api.accounts.firefox.com 144074002\nproduser2@mailinator.com 128754071 0f13d22f1c3e48edba8f49bd83f295af@api.accounts.firefox.com 144074484\nproduser3@mailinator.com 128803402 9909a79230b04ce7ab19b75206b6d8a7@api.accounts.firefox.com 144073987\nproduser4@mailinator.com 128803495 9b46d6447ed14421849d155c821ac3f1@api.accounts.firefox.com 144075243\nproduser5@mailinator.com 128804907 31a63278ac2d48afb72808ea7145b7c2@api.accounts.firefox.com 144076549\nproduser6@mailinator.com 128806959 d4db06b1118a46cdb73c6091ce176f63@api.accounts.firefox.com 144076072\nproduser8@mailinator.com 128808758 16cde22f1532456ea91e7744dce4c605@api.accounts.firefox.com 144074443\nproduser9@mailinator.com 128809197 632c2fba929a4194a2f98685edb00163@api.accounts.firefox.com 144075229\nproduser10@mailinator.com 128808946 f20b94b939ca47cba726760a13e2d4d2@api.accounts.firefox.com 144076550\nproduser13@mailinator.com 128809645 96be267c104a4b02be3c7895e7af3bb0@api.accounts.firefox.com 144124338\nproduser14@mailinator.com 128812632 387cc0c04a8f489fa94af0136b0b4cfe@api.accounts.firefox.com 144076546\nproduser15@mailinator.com 128812699 36b464f5ef1f4bd38920a311bd2ea654@api.accounts.firefox.com 144125169\n```"}, {"time": "2020-04-29T15:39:07Z", "attachment_id": 9144354, "creator": "eolson@mozilla.com", "raw_text": "", "creation_time": "2020-04-29T15:39:07Z", "bug_id": 1631787, "tags": [], "count": 11, "is_private": false, "author": "eolson@mozilla.com", "id": 14786407, "text": "Created attachment 9144354\n4-28-clients.csv.tgz"}, {"creator": "eolson@mozilla.com", "attachment_id": null, "creation_time": "2020-04-29T15:39:18Z", "id": 14786408, "text": "Serverside logs are attached.  144074443, 144075243, and 144073987 re-uploaded their bookmarks.  144124338 and 144125169 have no activity.", "time": "2020-04-29T15:39:18Z", "raw_text": "Serverside logs are attached.  144074443, 144075243, and 144073987 re-uploaded their bookmarks.  144124338 and 144125169 have no activity.", "bug_id": 1631787, "tags": [], "is_private": false, "count": 12, "author": "eolson@mozilla.com"}, {"id": 14786634, "text": "(In reply to Erik Olson from comment #7)\n>  The beginning of the test was delayed due to the clients having sync errors while connecting to the migration sync-py node and deleting all their data.  We have reproduced this issue today and it may need to be addressed.\n\nThe first log shows a hostname lookup failure (oddly enough this happens shortly after a successful GET to the same sync node).\n\nThe second log shows no /meta/global record. The is expected since this is their first connection to a sync-py node (`https://sync-815-us-west-2.sync.services.mozilla.com`) where they have no existing data. So the client performs a reset which includes deleting everything on the server:\n```\n1588075958472\tSync.Service\tINFO\tNo metadata record, server wipe needed\n1588075958472\tSync.Service\tINFO\tWiping server data\n1588075958472\tSync.Service\tINFO\tFresh start. Resetting client.\n```\n\n> The clients were re-populated and the migration to spanner testing was completed.\n> \n> Attaching two clients logs showing the failures that led to data loss.\n\nAll I see is the delete against the sync-py node client logs (which isn't data loss if there was no data there in the first place).\n\nDo we have the client logs against the spanner node?", "creation_time": "2020-04-29T17:01:26Z", "attachment_id": null, "creator": "pjenvey@mozilla.com", "author": "pjenvey@mozilla.com", "bug_id": 1631787, "tags": [], "is_private": false, "count": 13, "raw_text": "(In reply to Erik Olson from comment #7)\n>  The beginning of the test was delayed due to the clients having sync errors while connecting to the migration sync-py node and deleting all their data.  We have reproduced this issue today and it may need to be addressed.\n\nThe first log shows a hostname lookup failure (oddly enough this happens shortly after a successful GET to the same sync node).\n\nThe second log shows no /meta/global record. The is expected since this is their first connection to a sync-py node (`https://sync-815-us-west-2.sync.services.mozilla.com`) where they have no existing data. So the client performs a reset which includes deleting everything on the server:\n```\n1588075958472\tSync.Service\tINFO\tNo metadata record, server wipe needed\n1588075958472\tSync.Service\tINFO\tWiping server data\n1588075958472\tSync.Service\tINFO\tFresh start. Resetting client.\n```\n\n> The clients were re-populated and the migration to spanner testing was completed.\n> \n> Attaching two clients logs showing the failures that led to data loss.\n\nAll I see is the delete against the sync-py node client logs (which isn't data loss if there was no data there in the first place).\n\nDo we have the client logs against the spanner node?", "time": "2020-04-29T17:01:26Z"}, {"is_private": false, "count": 14, "bug_id": 1631787, "tags": [], "id": 14787418, "text": "Vasilica can you make these client logs available?", "author": "pjenvey@mozilla.com", "attachment_id": null, "creator": "pjenvey@mozilla.com", "time": "2020-04-29T23:09:12Z", "raw_text": "Vasilica can you make these client logs available?", "creation_time": "2020-04-29T23:09:12Z"}, {"time": "2020-04-30T07:35:57Z", "raw_text": "I found the following sync errors, are these the right ones?", "bug_id": 1631787, "tags": [], "count": 15, "is_private": false, "author": "vasilica.mihasca@softvision.com", "creator": "vasilica.mihasca@softvision.com", "attachment_id": 9144564, "creation_time": "2020-04-30T07:35:57Z", "text": "Created attachment 9144564\nsync-error3.txt\n\nI found the following sync errors, are these the right ones?", "id": 14787908}, {"raw_text": "", "time": "2020-04-30T07:36:11Z", "author": "vasilica.mihasca@softvision.com", "tags": [], "bug_id": 1631787, "is_private": false, "count": 16, "creation_time": "2020-04-30T07:36:11Z", "creator": "vasilica.mihasca@softvision.com", "attachment_id": 9144565, "id": 14787909, "text": "Created attachment 9144565\nsync-error4.txt"}, {"attachment_id": null, "creator": "eolson@mozilla.com", "creation_time": "2020-04-30T13:15:51Z", "id": 14788640, "text": "I think we have determined the sync problems/data loss with node sync-815-us-west-2 are because of the workflow. Neither the client nor the server had the data, so there was nothing to sync.\n\nDo you have client logs for 144074443, 144075243, and 144073987 as they re-uploaded their bookmarks to the spanner node, which they should not have done?", "time": "2020-04-30T13:15:51Z", "raw_text": "I think we have determined the sync problems/data loss with node sync-815-us-west-2 are because of the workflow. Neither the client nor the server had the data, so there was nothing to sync.\n\nDo you have client logs for 144074443, 144075243, and 144073987 as they re-uploaded their bookmarks to the spanner node, which they should not have done?", "bug_id": 1631787, "tags": [], "count": 17, "is_private": false, "author": "eolson@mozilla.com"}, {"time": "2020-04-30T15:11:26Z", "raw_text": "Here are the logs for the following users:\n- 144075243: \n    - https://drive.google.com/file/d/1iWibNI8RdXTa5LchZu8d5uFcs8lrf9ty/view?usp=sharing\n- 144074443: \n    - https://drive.google.com/file/d/1FhUAI7F4E-CmBSxq4Eij7ejbRiJ0__pW/view?usp=sharing\n    - https://drive.google.com/file/d/1iAm6tFFaVoDIfgHyF8cGGOyAxlyFP8cF/view?usp=sharing\n    - https://drive.google.com/file/d/1fSLBhx6AHuOE1ECtMHTxcj11rwroYi5m/view?usp=sharing", "count": 18, "is_private": false, "bug_id": 1631787, "tags": [], "author": "vasilica.mihasca@softvision.com", "creator": "vasilica.mihasca@softvision.com", "attachment_id": null, "creation_time": "2020-04-30T15:11:26Z", "id": 14788945, "text": "Here are the logs for the following users:\n- 144075243: \n    - https://drive.google.com/file/d/1iWibNI8RdXTa5LchZu8d5uFcs8lrf9ty/view?usp=sharing\n- 144074443: \n    - https://drive.google.com/file/d/1FhUAI7F4E-CmBSxq4Eij7ejbRiJ0__pW/view?usp=sharing\n    - https://drive.google.com/file/d/1iAm6tFFaVoDIfgHyF8cGGOyAxlyFP8cF/view?usp=sharing\n    - https://drive.google.com/file/d/1fSLBhx6AHuOE1ECtMHTxcj11rwroYi5m/view?usp=sharing"}, {"creation_time": "2020-05-07T16:35:43Z", "creator": "rbillings@mozilla.com", "attachment_id": null, "text": "Verified sync users being migrated with correct history and bookmarks. A final round of manual testing is planned.", "id": 14802875, "raw_text": "Verified sync users being migrated with correct history and bookmarks. A final round of manual testing is planned.", "time": "2020-05-07T16:35:43Z", "author": "rbillings@mozilla.com", "count": 19, "is_private": false, "tags": [], "bug_id": 1631787}]}}, "comments": {}}