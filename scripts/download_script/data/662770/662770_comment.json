{"bugs": {"662770": {"comments": [{"bug_id": 662770, "tags": [], "count": 0, "is_private": false, "id": 5519486, "text": "Created attachment 537988\ntest case\n\nI guess the title says it all. If a modal window opens (on linux) a noautohide\npanel, the entire panel is unresponsive. No UI element works inside it.\nThis bug does not affect Mac OS X and I haven't tested yet on windows.\n\nI have written a small xpi for Firefox that show the bug. It's attached here.\nIt adds a \"Panel bug\" entry to the Tools menu. Selecting it will open a modal\nwindow and a button inside that window opens a noautohide panel. The button\ninside that panel is unresponsive on\n\n  ubuntu 10.04 i386\n  ubuntu 10.10 x86_64\n  ubuntu 11.04 i386", "time": "2011-06-08T12:10:39Z", "attachment_id": 537988, "raw_text": "I guess the title says it all. If a modal window opens (on linux) a noautohide\npanel, the entire panel is unresponsive. No UI element works inside it.\nThis bug does not affect Mac OS X and I haven't tested yet on windows.\n\nI have written a small xpi for Firefox that show the bug. It's attached here.\nIt adds a \"Panel bug\" entry to the Tools menu. Selecting it will open a modal\nwindow and a button inside that window opens a noautohide panel. The button\ninside that panel is unresponsive on\n\n  ubuntu 10.04 i386\n  ubuntu 10.10 x86_64\n  ubuntu 11.04 i386", "creation_time": "2011-06-08T12:10:39Z", "creator": "daniel@glazman.org", "author": "daniel@glazman.org"}, {"text": "FWIW, the bug blocks the CSS Pro Editor for BlueGriffon on linux.\n\nEnn, do you think this is fixable in Gecko or is GTK guilty here? I'd\nlike to know if I can expect some kind of fix or if I need to rewrite\nmy own code to get rid of noautohide panels on linux. Thanks!", "attachment_id": null, "time": "2011-06-08T13:52:27Z", "creation_time": "2011-06-08T13:52:27Z", "raw_text": "FWIW, the bug blocks the CSS Pro Editor for BlueGriffon on linux.\n\nEnn, do you think this is fixable in Gecko or is GTK guilty here? I'd\nlike to know if I can expect some kind of fix or if I need to rewrite\nmy own code to get rid of noautohide panels on linux. Thanks!", "bug_id": 662770, "is_private": false, "count": 1, "tags": [], "id": 5519626, "creator": "daniel@glazman.org", "author": "daniel@glazman.org"}, {"bug_id": 662770, "tags": [], "is_private": false, "count": 2, "id": 5519640, "creator": "enndeakin@gmail.com", "text": "Created attachment 538008\ntestcase\n\nThe panel is not receiving any mouse button events (press or motion). The parent modal dialog does receive events when moved or pressed over.", "author": "enndeakin@gmail.com", "attachment_id": 538008, "time": "2011-06-08T14:01:23Z", "creation_time": "2011-06-08T14:01:23Z", "raw_text": "The panel is not receiving any mouse button events (press or motion). The parent modal dialog does receive events when moved or pressed over."}, {"bug_id": 662770, "is_private": false, "count": 3, "tags": [], "id": 5519642, "text": "(In reply to comment #1)\n> Enn, do you think this is fixable in Gecko or is GTK guilty here? I'd\n> like to know if I can expect some kind of fix or if I need to rewrite\n> my own code to get rid of noautohide panels on linux. Thanks!\n\nLikely fixable but Karl will likely need to investigate as it's beyond my gtk knowledge.", "attachment_id": null, "time": "2011-06-08T14:03:08Z", "creation_time": "2011-06-08T14:03:08Z", "raw_text": "(In reply to comment #1)\n> Enn, do you think this is fixable in Gecko or is GTK guilty here? I'd\n> like to know if I can expect some kind of fix or if I need to rewrite\n> my own code to get rid of noautohide panels on linux. Thanks!\n\nLikely fixable but Karl will likely need to investigate as it's beyond my gtk knowledge.", "creator": "enndeakin@gmail.com", "author": "enndeakin@gmail.com"}, {"is_private": false, "count": 4, "tags": [], "id": 5519820, "bug_id": 662770, "raw_text": "(In reply to comment #3)\n\n> Likely fixable but Karl will likely need to investigate as it's beyond my\n> gtk knowledge.\n\nThanks. Yeah, mine too. I tried a few things in nsXULPopupManager and\ngtk2/nsWindow but it went nowhere.", "creation_time": "2011-06-08T15:39:35Z", "text": "(In reply to comment #3)\n\n> Likely fixable but Karl will likely need to investigate as it's beyond my\n> gtk knowledge.\n\nThanks. Yeah, mine too. I tried a few things in nsXULPopupManager and\ngtk2/nsWindow but it went nowhere.", "time": "2011-06-08T15:39:35Z", "attachment_id": null, "creator": "daniel@glazman.org", "author": "daniel@glazman.org"}, {"author": "karlt@mozbugz.karlt.net", "creator": "karlt@mozbugz.karlt.net", "time": "2011-06-08T22:07:25Z", "attachment_id": null, "text": "Neil: what do you do to run your testcase?\n(I tried setting dom.allow_XUL_XBL_for_file and using -chrome modalpanel.xul, but the window opened when pressing the \"Window\" button was not modal.)", "creation_time": "2011-06-08T22:07:25Z", "raw_text": "Neil: what do you do to run your testcase?\n(I tried setting dom.allow_XUL_XBL_for_file and using -chrome modalpanel.xul, but the window opened when pressing the \"Window\" button was not modal.)", "bug_id": 662770, "id": 5520987, "is_private": false, "count": 5, "tags": []}, {"author": "karlt@mozbugz.karlt.net", "creator": "karlt@mozbugz.karlt.net", "id": 5521018, "is_private": false, "count": 6, "tags": [], "bug_id": 662770, "raw_text": "What's happening is that the gtk_window_set_modal call does gtk_grab_add on the toplevel window.  That means that any events on other windows (including the noautohide panel) are sent to the widget for the toplevel modal window.  We don't listen for mouse events on that widget.  If we did, then our modal windows would not be modal (i.e. other windows would get events).\n\nI guess it would be possible to\n\n-    gtk_window_set_modal(GTK_WINDOW(mShell), aModal ? TRUE : FALSE);\n+    gdk_window_set_modal_hint(mShell->window, aModal);\n\nand either implement modality within Gecko,\nor change the grab to the container widget where we do listen for events and send them off only if their windows are descendants or associated popups.\n\nI wonder how modality is implemented on other platforms.", "creation_time": "2011-06-08T22:21:16Z", "time": "2011-06-08T22:21:16Z", "attachment_id": null, "text": "What's happening is that the gtk_window_set_modal call does gtk_grab_add on the toplevel window.  That means that any events on other windows (including the noautohide panel) are sent to the widget for the toplevel modal window.  We don't listen for mouse events on that widget.  If we did, then our modal windows would not be modal (i.e. other windows would get events).\n\nI guess it would be possible to\n\n-    gtk_window_set_modal(GTK_WINDOW(mShell), aModal ? TRUE : FALSE);\n+    gdk_window_set_modal_hint(mShell->window, aModal);\n\nand either implement modality within Gecko,\nor change the grab to the container widget where we do listen for events and send them off only if their windows are descendants or associated popups.\n\nI wonder how modality is implemented on other platforms."}, {"tags": [], "count": 7, "is_private": false, "id": 5521830, "bug_id": 662770, "creation_time": "2011-06-09T07:55:41Z", "raw_text": "(In reply to comment #6)\n\n> I guess it would be possible to\n> \n> -    gtk_window_set_modal(GTK_WINDOW(mShell), aModal ? TRUE : FALSE);\n> +    gdk_window_set_modal_hint(mShell->window, aModal);\n> \n> and either implement modality within Gecko,\n> or change the grab to the container widget where we do listen for events and\n> send them off only if their windows are descendants or associated popups.\n\nKarl, thanks for the answer. Do you think this is fixable in a reasonable\ntimeframe or do you suggest I work around the issue on Linux? This is\nblocking my CSS Editor on Linux (while the Mac and Windows version work\nabsolutely fine with noautohide panels opened from a modal window) and\ntweaking my code to fix the linux issue will imply probably a full week\nof work. Thanks!", "text": "(In reply to comment #6)\n\n> I guess it would be possible to\n> \n> -    gtk_window_set_modal(GTK_WINDOW(mShell), aModal ? TRUE : FALSE);\n> +    gdk_window_set_modal_hint(mShell->window, aModal);\n> \n> and either implement modality within Gecko,\n> or change the grab to the container widget where we do listen for events and\n> send them off only if their windows are descendants or associated popups.\n\nKarl, thanks for the answer. Do you think this is fixable in a reasonable\ntimeframe or do you suggest I work around the issue on Linux? This is\nblocking my CSS Editor on Linux (while the Mac and Windows version work\nabsolutely fine with noautohide panels opened from a modal window) and\ntweaking my code to fix the linux issue will imply probably a full week\nof work. Thanks!", "attachment_id": null, "time": "2011-06-09T07:55:41Z", "creator": "daniel@glazman.org", "author": "daniel@glazman.org"}, {"author": "daniel@glazman.org", "time": "2011-06-09T08:02:23Z", "attachment_id": null, "text": "This maybe stupid, but could a temporary fix (until a more complex and full\nimplementation is done) be to make noautohide panels themselves modal? Then\na noautohide panel opened from a modal window is itself an undecorated modal window\nand even if that's not _exactly_ what a panel is, at least the panel is\nresponsive to UI events? I am willing to add that as a patch to BlueGriffon's\ncore instead of adding that \"hack\" to mozilla-central but this goes beyond\nmy personal gtk knowledge... If you think it is workable, can you tell me\nhow?", "creator": "daniel@glazman.org", "creation_time": "2011-06-09T08:02:23Z", "raw_text": "This maybe stupid, but could a temporary fix (until a more complex and full\nimplementation is done) be to make noautohide panels themselves modal? Then\na noautohide panel opened from a modal window is itself an undecorated modal window\nand even if that's not _exactly_ what a panel is, at least the panel is\nresponsive to UI events? I am willing to add that as a patch to BlueGriffon's\ncore instead of adding that \"hack\" to mozilla-central but this goes beyond\nmy personal gtk knowledge... If you think it is workable, can you tell me\nhow?", "bug_id": 662770, "id": 5521834, "tags": [], "is_private": false, "count": 8}, {"raw_text": "Ok, I tried the strategy exposed here earlier and it seemed to work fine.\nI am attaching a patch that does exactly what I meant. Karl, is it the\nright place to do that and the right thing to do as a workaround?\n\nWith that hack in, noautohidable panels become modal and ARE responsive.\nGranted, it's not perfect but at least there is no loss of functionality\nin BlueGriffon on Linux. I am perfectly fine to live with that until a\ncleaner solution is found and implemented in mozilla-central.", "creation_time": "2011-06-09T08:57:04Z", "attachment_id": 538214, "time": "2011-06-09T08:57:04Z", "text": "Created attachment 538214\nworkaround for bug 662770\n\nOk, I tried the strategy exposed here earlier and it seemed to work fine.\nI am attaching a patch that does exactly what I meant. Karl, is it the\nright place to do that and the right thing to do as a workaround?\n\nWith that hack in, noautohidable panels become modal and ARE responsive.\nGranted, it's not perfect but at least there is no loss of functionality\nin BlueGriffon on Linux. I am perfectly fine to live with that until a\ncleaner solution is found and implemented in mozilla-central.", "id": 5521874, "tags": [], "count": 9, "is_private": false, "bug_id": 662770, "author": "daniel@glazman.org", "creator": "daniel@glazman.org"}, {"creator": "karlt@mozbugz.karlt.net", "author": "karlt@mozbugz.karlt.net", "text": "(In reply to comment #7)\n> Karl, thanks for the answer. Do you think this is fixable in a reasonable\n> timeframe or do you suggest I work around the issue on Linux?\n\nI expect this is fixable but I'm not clear on what what be the appropriate fix and I don't think this would be a priority.  User interfaces are moving away from modal dialogs, modal dialogs are usually short-lived and noautohide panels are more likely long-lived, so this seems an unusual situation.\n\n(In reply to comment #8)\n> This maybe stupid, but could a temporary fix (until a more complex and full\n> implementation is done) be to make noautohide panels themselves modal? Then\n> a noautohide panel opened from a modal window is itself an undecorated modal\n> window and even if that's not _exactly_ what a panel is, at least the panel is\n> responsive to UI events?\n\nI expect making the panel modal will block events from the dialog to which it belongs, and it would also do similarly when a noautohide panel is opened from a non-modal window.\n\nAs a workaround, I would suggest the gtk_window_set_modal/gdk_window_set_modal_hint change in comment 6, and explicitly setting enabled to false on windows that should not accept input.\nhttp://hg.mozilla.org/mozilla-central/annotate/9b43783ab8ec/widget/public/nsIBaseWindow.idl#l195\n\nPerhaps that is even the appropriate fix for this bug - I'm not clear.", "time": "2011-06-10T03:49:00Z", "attachment_id": null, "raw_text": "(In reply to comment #7)\n> Karl, thanks for the answer. Do you think this is fixable in a reasonable\n> timeframe or do you suggest I work around the issue on Linux?\n\nI expect this is fixable but I'm not clear on what what be the appropriate fix and I don't think this would be a priority.  User interfaces are moving away from modal dialogs, modal dialogs are usually short-lived and noautohide panels are more likely long-lived, so this seems an unusual situation.\n\n(In reply to comment #8)\n> This maybe stupid, but could a temporary fix (until a more complex and full\n> implementation is done) be to make noautohide panels themselves modal? Then\n> a noautohide panel opened from a modal window is itself an undecorated modal\n> window and even if that's not _exactly_ what a panel is, at least the panel is\n> responsive to UI events?\n\nI expect making the panel modal will block events from the dialog to which it belongs, and it would also do similarly when a noautohide panel is opened from a non-modal window.\n\nAs a workaround, I would suggest the gtk_window_set_modal/gdk_window_set_modal_hint change in comment 6, and explicitly setting enabled to false on windows that should not accept input.\nhttp://hg.mozilla.org/mozilla-central/annotate/9b43783ab8ec/widget/public/nsIBaseWindow.idl#l195\n\nPerhaps that is even the appropriate fix for this bug - I'm not clear.", "creation_time": "2011-06-10T03:49:00Z", "bug_id": 662770, "tags": [], "is_private": false, "count": 10, "id": 5524188}, {"time": "2018-04-30T20:12:41Z", "attachment_id": null, "text": "Moving to Core:XUL per https://bugzilla.mozilla.org/show_bug.cgi?id=1455336", "creation_time": "2018-04-30T20:12:41Z", "raw_text": "Moving to Core:XUL per https://bugzilla.mozilla.org/show_bug.cgi?id=1455336", "bug_id": 662770, "id": 13244566, "count": 11, "is_private": false, "tags": [], "author": "bug-husbandry-bot@mozilla.bugs", "creator": "bug-husbandry-bot@mozilla.bugs"}]}}, "comments": {}}