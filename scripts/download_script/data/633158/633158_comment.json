{"bugs": {"633158": {"comments": [{"id": 5269246, "time": "2011-02-10T12:48:34Z", "is_private": false, "tags": [], "raw_text": "_numPinnedTabs return \nthe number of pinned tab without excluding _removingTabs\n\nit can lead to unexpected result in some cases for example:\nsince visibleTabs contain all visible tabs without _removingTabs then\nlet tab = this.tabbrowser.visibleTabs[this.tabbrowser._numPinnedTabs] can be null if _removingTabs is grater then visibleTabs.length.\nalso we can get different tab then the one we want.\n\nvar tabsToClose = (aAll ? this.tabs.length : this.visibleTabs.length - 1)\n                            - gBrowser._numPinnedTabs;\ntabsToClose is obviously not the correct number if _numPinnedTabs contain removingTabs", "bug_id": 633158, "creation_time": "2011-02-10T12:48:34Z", "author": "tabmix.onemen@gmail.com", "text": "_numPinnedTabs return \nthe number of pinned tab without excluding _removingTabs\n\nit can lead to unexpected result in some cases for example:\nsince visibleTabs contain all visible tabs without _removingTabs then\nlet tab = this.tabbrowser.visibleTabs[this.tabbrowser._numPinnedTabs] can be null if _removingTabs is grater then visibleTabs.length.\nalso we can get different tab then the one we want.\n\nvar tabsToClose = (aAll ? this.tabs.length : this.visibleTabs.length - 1)\n                            - gBrowser._numPinnedTabs;\ntabsToClose is obviously not the correct number if _numPinnedTabs contain removingTabs", "count": 0, "attachment_id": null, "creator": "tabmix.onemen@gmail.com"}, {"id": 5481274, "time": "2011-05-19T21:32:58Z", "is_private": false, "tags": [], "creation_time": "2011-05-19T21:32:58Z", "bug_id": 633158, "raw_text": "No test yet; input on building a test would be appreciated, as my understanding is that the problems related to this will only occur if you get _numPinnedTabs while the browser is still clearing some pinned tabs in _removingTabs, which is timing dependent?\n\nI haven't tested the patch, other than running the browser with it, for the same reason.", "author": "unusualtears@gmail.com", "count": 1, "text": "Created attachment 533793\nWIP: Simple patch, no test.\n\nNo test yet; input on building a test would be appreciated, as my understanding is that the problems related to this will only occur if you get _numPinnedTabs while the browser is still clearing some pinned tabs in _removingTabs, which is timing dependent?\n\nI haven't tested the patch, other than running the browser with it, for the same reason.", "attachment_id": 533793, "creator": "unusualtears@gmail.com"}, {"id": 5481570, "time": "2011-05-19T23:22:06Z", "tags": [], "raw_text": "Doing this would break tabbrowser.tabs[tabbrowser._numPinnedTabs]...\n\nNote that pinned tabs are removed synchronously, so this affects only _numPinnedTabs users that respond to events that are dispatched when closing a pinned tab (e.g. TabClose, possibly TabOpen / TabSelect).", "bug_id": 633158, "creation_time": "2011-05-19T23:22:06Z", "is_private": false, "text": "Doing this would break tabbrowser.tabs[tabbrowser._numPinnedTabs]...\n\nNote that pinned tabs are removed synchronously, so this affects only _numPinnedTabs users that respond to events that are dispatched when closing a pinned tab (e.g. TabClose, possibly TabOpen / TabSelect).", "count": 2, "author": "dao+bmo@mozilla.com", "creator": "dao+bmo@mozilla.com", "attachment_id": null}, {"creator": "unusualtears@gmail.com", "attachment_id": 534541, "text": "Created attachment 534541\nWIP v2: Split to _numVisiblePinnedTabs and modify users of _numPinnedTabs as needed.\n\nThanks for the feedback.  Based on that, it looks like there is need for a separate property, this patch calls it _numVisiblePinnedTabs.  Might need a better name than _numVisiblePinnedTabs, though the name does somewhat indicate it's the counterpart to visibleTabs.\n\nPasses all tests that are passed without it.", "count": 3, "author": "unusualtears@gmail.com", "tags": [], "bug_id": 633158, "creation_time": "2011-05-23T20:24:37Z", "raw_text": "Thanks for the feedback.  Based on that, it looks like there is need for a separate property, this patch calls it _numVisiblePinnedTabs.  Might need a better name than _numVisiblePinnedTabs, though the name does somewhat indicate it's the counterpart to visibleTabs.\n\nPasses all tests that are passed without it.", "is_private": false, "id": 5487406, "time": "2011-05-23T20:24:37Z"}, {"is_private": false, "tags": [], "creation_time": "2011-05-23T20:32:24Z", "bug_id": 633158, "raw_text": "It's not clear to me what this bug is concerned about, exactly. Why would TabContextMenu.updateContextMenu be called while a pinned tab is being removed? Same question for gBrowser.warnAboutClosingTabs.", "id": 5487428, "time": "2011-05-23T20:32:24Z", "attachment_id": null, "creator": "dao+bmo@mozilla.com", "author": "dao+bmo@mozilla.com", "count": 4, "text": "It's not clear to me what this bug is concerned about, exactly. Why would TabContextMenu.updateContextMenu be called while a pinned tab is being removed? Same question for gBrowser.warnAboutClosingTabs."}, {"attachment_id": null, "creator": "unusualtears@gmail.com", "author": "unusualtears@gmail.com", "count": 5, "text": "Thanks for the feedback and patience.  I was tilting at a windmill here.  Sorry for that.\n\nI was still under the impression that there could be cases where having a separate count of pinned tabs would be useful.  But, as you said in Comment 2, the only cases would be a small number of event consumers.\n\nHaving the separate property for just those few cases doesn't gain enough to justify the additional code when it's easy enough for users to handle it themselves.\n\nSome kind of auto-browser extension might call updateContextMenu under a handler, but I doubt it would call warnAboutClosingTabs, and although it might trigger the same, it would probably disable it first.  In either case, it could handle the cleanup itself.", "is_private": false, "creation_time": "2011-05-23T21:36:49Z", "bug_id": 633158, "raw_text": "Thanks for the feedback and patience.  I was tilting at a windmill here.  Sorry for that.\n\nI was still under the impression that there could be cases where having a separate count of pinned tabs would be useful.  But, as you said in Comment 2, the only cases would be a small number of event consumers.\n\nHaving the separate property for just those few cases doesn't gain enough to justify the additional code when it's easy enough for users to handle it themselves.\n\nSome kind of auto-browser extension might call updateContextMenu under a handler, but I doubt it would call warnAboutClosingTabs, and although it might trigger the same, it would probably disable it first.  In either case, it could handle the cleanup itself.", "tags": [], "time": "2011-05-23T21:36:49Z", "id": 5487670}]}}, "comments": {}}