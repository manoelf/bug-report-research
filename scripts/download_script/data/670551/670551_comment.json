{"bugs": {"670551": {"comments": [{"is_private": false, "creation_time": "2011-07-10T18:08:17Z", "id": 5583538, "bug_id": 670551, "author": "bugzilla-mozilla-20000923@james-ross.co.uk", "text": "Created attachment 545090\nCustom log of idle service and notifications\n\nI noticed this problem when I upgraded my XULRunner for ChatZilla to Gecko 2.0 and while idle overnight, every 10 minutes or so, it would mark me \"back\" and then immediately \"away\" again. The ChatZilla away/back is directly tied to the nsIIdleService so I logged that and saw the data (idleTime -> timeStr in the code) was just fine - i.e. it has a large idle time even for the \"back\" notifications!\n\nSo I've compiled trunk (18c8c2ea4caf07635792b70168fad1d8a6694a38) and attached is a log from nsIdleService.cpp, just after timeStr.AppendInt(idleTime), using the following code:\n\nprintf(\"nsIdleService::CheckAwayState: mLHA=%d -> %d, cTime=%d, lTime=%d, iTime=%d (%d)\\n\", mLastHandledActivity, curTime - idleTime, curTime, lastTime, idleTime, idleTimeMS);\n\nI have intermixed it with the notifcations ChatZilla received during the same period to highlight when it goes wrong.\n\nAs far as I can tell, this problem exists as a result of bug 544240 switching all the important calculations to use seconds instead of milliseconds. It now has rounding issues. :)", "count": 0, "creator": "bugzilla-mozilla-20000923@james-ross.co.uk", "tags": [], "attachment_id": 545090, "raw_text": "I noticed this problem when I upgraded my XULRunner for ChatZilla to Gecko 2.0 and while idle overnight, every 10 minutes or so, it would mark me \"back\" and then immediately \"away\" again. The ChatZilla away/back is directly tied to the nsIIdleService so I logged that and saw the data (idleTime -> timeStr in the code) was just fine - i.e. it has a large idle time even for the \"back\" notifications!\n\nSo I've compiled trunk (18c8c2ea4caf07635792b70168fad1d8a6694a38) and attached is a log from nsIdleService.cpp, just after timeStr.AppendInt(idleTime), using the following code:\n\nprintf(\"nsIdleService::CheckAwayState: mLHA=%d -> %d, cTime=%d, lTime=%d, iTime=%d (%d)\\n\", mLastHandledActivity, curTime - idleTime, curTime, lastTime, idleTime, idleTimeMS);\n\nI have intermixed it with the notifcations ChatZilla received during the same period to highlight when it goes wrong.\n\nAs far as I can tell, this problem exists as a result of bug 544240 switching all the important calculations to use seconds instead of milliseconds. It now has rounding issues. :)", "time": "2011-07-10T18:08:17Z"}, {"creator": "bugzilla-mozilla-20000923@james-ross.co.uk", "is_private": false, "creation_time": "2011-07-10T18:12:57Z", "attachment_id": null, "tags": [], "author": "bugzilla-mozilla-20000923@james-ross.co.uk", "count": 1, "text": "In case there's any confusion, I added idleTimeMS myself a little earlier to see how badly it was rounding, like this:\n\n  PRUint32 idleTimeMS = idleTime;\n  idleTime /= 1000;", "bug_id": 670551, "id": 5583540, "raw_text": "In case there's any confusion, I added idleTimeMS myself a little earlier to see how badly it was rounding, like this:\n\n  PRUint32 idleTimeMS = idleTime;\n  idleTime /= 1000;", "time": "2011-07-10T18:12:57Z"}, {"attachment_id": null, "raw_text": "This may have been resolved by bug 811459.", "time": "2013-02-17T17:32:54Z", "tags": [], "author": "irving@cfrq.net", "text": "This may have been resolved by bug 811459.", "count": 2, "creator": "irving@cfrq.net", "creation_time": "2013-02-17T17:32:54Z", "is_private": false, "id": 7112462, "bug_id": 670551}]}}, "comments": {}}