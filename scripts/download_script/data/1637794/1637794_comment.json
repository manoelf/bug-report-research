{"bugs": {"1637794": {"comments": [{"creation_time": "2020-05-13T23:24:21Z", "count": 0, "raw_text": "I would like to copy GLAM etl exports for Fenix from the `glam-fenix-dev` project into the nonprod GLAM project. I am using the `google_cloud_airflow_dataproc` connection, which is the connection used for [extracting from the GLAM dag](https://github.com/mozilla/telemetry-airflow/blob/master/dags/glam_subdags/extract.py)\n\nSee: https://github.com/mozilla/telemetry-airflow/blob/master/dags/glam_org_mozilla_fenix.py\n\n\n```python\nglam_bucket = \"glam-dev-bespoke-nonprod-dataops-mozgcp-net\"\n\n...\n\ngcs_delete = GoogleCloudStorageDeleteOperator(\n    task_id=\"gcs_delete\",\n    bucket_name=glam_bucket,\n    prefix=\"glam-extract-fenix\",\n    gcp_conn_id=\"google_cloud_airflow_dataproc\",\n    dag=dag,\n)\n\ngcs_copy = GoogleCloudStorageToGoogleCloudStorageOperator(\n    task_id=\"gcs_copy\",\n    source_bucket=\"glam-fenix-dev\",\n    source_object=\"*.csv\",\n    destination_bucket=glam_bucket,\n    gcp_conn_id=\"google_cloud_airflow_dataproc\",\n    dag=dag,\n)\n```\n\nThis fails when deleting files in the nonprod bucket.\n\n```\nForbidden: 403 GET https://storage.googleapis.com/storage/v1/b/glam-dev-bespoke-nonprod-dataops-mozgcp-net/o?prefix=glam-extract-fenix&projection=noAcl: airflow-google-connection@moz-fx-data-airflow-prod-88e0.iam.gserviceaccount.com does not have storage.objects.list access to the Google Cloud Storage bucket.\n```\n\nhttps://workflow.telemetry.mozilla.org/log?task_id=gcs_delete&dag_id=glam_org_mozilla_fenix&execution_date=2020-05-12T00%3A00%3A00%2B00%3A00\n\nI expect the `gcs_delete` command to succeed.", "creator": "amiyaguchi@mozilla.com", "time": "2020-05-13T23:24:21Z", "tags": [], "text": "I would like to copy GLAM etl exports for Fenix from the `glam-fenix-dev` project into the nonprod GLAM project. I am using the `google_cloud_airflow_dataproc` connection, which is the connection used for [extracting from the GLAM dag](https://github.com/mozilla/telemetry-airflow/blob/master/dags/glam_subdags/extract.py)\n\nSee: https://github.com/mozilla/telemetry-airflow/blob/master/dags/glam_org_mozilla_fenix.py\n\n\n```python\nglam_bucket = \"glam-dev-bespoke-nonprod-dataops-mozgcp-net\"\n\n...\n\ngcs_delete = GoogleCloudStorageDeleteOperator(\n    task_id=\"gcs_delete\",\n    bucket_name=glam_bucket,\n    prefix=\"glam-extract-fenix\",\n    gcp_conn_id=\"google_cloud_airflow_dataproc\",\n    dag=dag,\n)\n\ngcs_copy = GoogleCloudStorageToGoogleCloudStorageOperator(\n    task_id=\"gcs_copy\",\n    source_bucket=\"glam-fenix-dev\",\n    source_object=\"*.csv\",\n    destination_bucket=glam_bucket,\n    gcp_conn_id=\"google_cloud_airflow_dataproc\",\n    dag=dag,\n)\n```\n\nThis fails when deleting files in the nonprod bucket.\n\n```\nForbidden: 403 GET https://storage.googleapis.com/storage/v1/b/glam-dev-bespoke-nonprod-dataops-mozgcp-net/o?prefix=glam-extract-fenix&projection=noAcl: airflow-google-connection@moz-fx-data-airflow-prod-88e0.iam.gserviceaccount.com does not have storage.objects.list access to the Google Cloud Storage bucket.\n```\n\nhttps://workflow.telemetry.mozilla.org/log?task_id=gcs_delete&dag_id=glam_org_mozilla_fenix&execution_date=2020-05-12T00%3A00%3A00%2B00%3A00\n\nI expect the `gcs_delete` command to succeed.", "attachment_id": null, "id": 14818247, "author": "amiyaguchi@mozilla.com", "bug_id": 1637794, "is_private": false}, {"tags": [], "time": "2020-07-15T18:17:48Z", "creator": "bimsland@mozilla.com", "raw_text": "This should be fixed now, mind testing it out?", "creation_time": "2020-07-15T18:17:48Z", "count": 1, "bug_id": 1637794, "is_private": false, "attachment_id": null, "id": 14938993, "author": "bimsland@mozilla.com", "text": "This should be fixed now, mind testing it out?"}, {"tags": [], "creator": "amiyaguchi@mozilla.com", "time": "2020-07-15T19:04:25Z", "raw_text": "The job that was using this was removed in https://github.com/mozilla/telemetry-airflow/pull/1059, so this is no longer a job that is in production. I don't have an easy way to test the permissions here. It looks like this is no longer necessary with bug 1652880 importing directly from the glam-fenix-dev bucket.", "creation_time": "2020-07-15T19:04:25Z", "count": 2, "is_private": false, "bug_id": 1637794, "attachment_id": null, "author": "amiyaguchi@mozilla.com", "id": 14939076, "text": "The job that was using this was removed in https://github.com/mozilla/telemetry-airflow/pull/1059, so this is no longer a job that is in production. I don't have an easy way to test the permissions here. It looks like this is no longer necessary with bug 1652880 importing directly from the glam-fenix-dev bucket."}]}}, "comments": {}}