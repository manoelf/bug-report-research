{"comments": {}, "bugs": {"626635": {"comments": [{"creation_time": "2011-01-18T15:07:04Z", "is_private": false, "time": "2011-01-18T15:07:04Z", "tags": [], "text": "(originally filed as https://bugzilla.redhat.com/show_bug.cgi?id=670349)\n\nDescription of problem:\nFirefox is throwing alignment errors on the ARM platform.\n\nVersion-Release number of selected component (if applicable):\nfirefox-3.5.4-1.fc12.armv5tel\n\nHow reproducible:\nEvery time.\n\nSteps to Reproduce:\n1. Boot the system with kernel boot parameter alignment=3 to enable fixup+warn\n2. Start Firefox\n3. Browse a few pages, open a few links in new tabs, close a few old tabs.\n4. Check dmesg to see the alignment errors reported.\n\nActual results:\nHere is what gets reported in the system log when alignment warnings are\nenabled:\n...\nAlignment trap: firefox (2983) PC=0x4094ebc4 Instr=0xe1c1a0f0\nAddress=0xbeb5bcbc FSR 0x801\nAlignment trap: firefox (2983) PC=0x4094eef4 Instr=0xe1cd01d8\nAddress=0xbeb5bcbc FSR 0x001\n...\n\nThis is only a small example - typically 2-4 thousand of errors like these will\nget logged within seconds.\n\nExpected results:\nNo alignment warnings.\n\nAdditional info:\nRecent ARMv7 chips includes automatic alignment fix-up in hardware, so testing\nfor this has to be done on ARMv6 or earlier.", "id": 5207247, "bug_id": 626635, "raw_text": "(originally filed as https://bugzilla.redhat.com/show_bug.cgi?id=670349)\n\nDescription of problem:\nFirefox is throwing alignment errors on the ARM platform.\n\nVersion-Release number of selected component (if applicable):\nfirefox-3.5.4-1.fc12.armv5tel\n\nHow reproducible:\nEvery time.\n\nSteps to Reproduce:\n1. Boot the system with kernel boot parameter alignment=3 to enable fixup+warn\n2. Start Firefox\n3. Browse a few pages, open a few links in new tabs, close a few old tabs.\n4. Check dmesg to see the alignment errors reported.\n\nActual results:\nHere is what gets reported in the system log when alignment warnings are\nenabled:\n...\nAlignment trap: firefox (2983) PC=0x4094ebc4 Instr=0xe1c1a0f0\nAddress=0xbeb5bcbc FSR 0x801\nAlignment trap: firefox (2983) PC=0x4094eef4 Instr=0xe1cd01d8\nAddress=0xbeb5bcbc FSR 0x001\n...\n\nThis is only a small example - typically 2-4 thousand of errors like these will\nget logged within seconds.\n\nExpected results:\nNo alignment warnings.\n\nAdditional info:\nRecent ARMv7 chips includes automatic alignment fix-up in hardware, so testing\nfor this has to be done on ARMv6 or earlier.", "creator": "mcepl@cepl.eu", "attachment_id": null, "author": "mcepl@cepl.eu", "count": 0}, {"text": "Does this happen with a recent Gecko too?\n\nAt what code locations?", "bug_id": 626635, "creation_time": "2011-01-18T15:28:00Z", "time": "2011-01-18T15:28:00Z", "attachment_id": null, "creator": "bzbarsky@mit.edu", "raw_text": "Does this happen with a recent Gecko too?\n\nAt what code locations?", "tags": [], "id": 5207291, "is_private": false, "author": "bzbarsky@mit.edu", "count": 1}, {"attachment_id": null, "creator": "gordan@bobich.net", "raw_text": "Unfortunately there is no visibility of where in the code specifically the error occurs, but considering that just starting up firefox throws about 1500 of these errors (which almost certainly cause data corruption without the expensive fixup being enabled in the kernel) it's not an isolated incident.\n\nDon't know about more recent versions than the one I posted, I will try to build 4.0b9 on ARM next week and see what happens.\n\nIt's also worth noting that the above version of Firefox is also very unstable on ARM even with the fixup for the alignment errors.", "author": "gordan@bobich.net", "count": 2, "creation_time": "2011-01-18T15:36:52Z", "is_private": false, "time": "2011-01-18T15:36:52Z", "text": "Unfortunately there is no visibility of where in the code specifically the error occurs, but considering that just starting up firefox throws about 1500 of these errors (which almost certainly cause data corruption without the expensive fixup being enabled in the kernel) it's not an isolated incident.\n\nDon't know about more recent versions than the one I posted, I will try to build 4.0b9 on ARM next week and see what happens.\n\nIt's also worth noting that the above version of Firefox is also very unstable on ARM even with the fixup for the alignment errors.", "tags": [], "bug_id": 626635, "id": 5207306}, {"raw_text": "> It's not an isolated incident\n\nOr it's a single line of code (or a few of them) that's called a bunch....", "creator": "bzbarsky@mit.edu", "attachment_id": null, "count": 3, "author": "bzbarsky@mit.edu", "is_private": false, "time": "2011-01-18T15:48:47Z", "creation_time": "2011-01-18T15:48:47Z", "id": 5207348, "bug_id": 626635, "tags": [], "text": "> It's not an isolated incident\n\nOr it's a single line of code (or a few of them) that's called a bunch...."}, {"count": 4, "author": "mcepl@cepl.eu", "is_private": false, "id": 5207766, "tags": [], "attachment_id": null, "creator": "mcepl@cepl.eu", "raw_text": "It could be worthy to emphasize that this is real Firefox (or XULRunner) on real computer, not Fennec on a phone.", "time": "2011-01-18T18:12:11Z", "creation_time": "2011-01-18T18:12:11Z", "bug_id": 626635, "text": "It could be worthy to emphasize that this is real Firefox (or XULRunner) on real computer, not Fennec on a phone."}, {"count": 5, "author": "gordan@bobich.net", "attachment_id": null, "raw_text": "This also happens with the following, more recent version of Firefox:\nfirefox-3.6.3-4.fc13.armv5tel. Will attach the alignment trap log separately.", "creator": "gordan@bobich.net", "bug_id": 626635, "id": 5292427, "text": "This also happens with the following, more recent version of Firefox:\nfirefox-3.6.3-4.fc13.armv5tel. Will attach the alignment trap log separately.", "tags": [], "time": "2011-02-19T22:36:00Z", "is_private": false, "creation_time": "2011-02-19T22:36:00Z"}, {"is_private": false, "time": "2011-02-19T22:37:04Z", "creation_time": "2011-02-19T22:37:04Z", "bug_id": 626635, "id": 5292428, "text": "Created attachment 513807\ndmesg grep of alignment traps tripped in the firefox process", "tags": [], "attachment_id": 513807, "raw_text": "", "creator": "gordan@bobich.net", "count": 6, "author": "gordan@bobich.net"}, {"text": "Is there any way at all you can get a stack for any of those?", "bug_id": 626635, "creation_time": "2011-02-20T01:36:41Z", "time": "2011-02-20T01:36:41Z", "attachment_id": null, "raw_text": "Is there any way at all you can get a stack for any of those?", "creator": "bzbarsky@mit.edu", "tags": [], "id": 5292578, "is_private": false, "author": "bzbarsky@mit.edu", "count": 7}, {"attachment_id": null, "creator": "gordan@bobich.net", "raw_text": "Hmm... I could get it to core dump on alignment failure instead of fixing alignment, and see if I can get a backtrace from that. I'll see what I can do.", "time": "2011-02-20T01:46:08Z", "creation_time": "2011-02-20T01:46:08Z", "bug_id": 626635, "text": "Hmm... I could get it to core dump on alignment failure instead of fixing alignment, and see if I can get a backtrace from that. I'll see what I can do.", "count": 8, "author": "gordan@bobich.net", "is_private": false, "id": 5292585, "tags": []}, {"attachment_id": null, "creator": "gordan@bobich.net", "raw_text": "Ah, it looks like the Fedora koji repository doesn't have debuginfo packages, which makes the cores pretty useless. I'll see if I can find the corresponding debuginfos.", "author": "gordan@bobich.net", "count": 9, "creation_time": "2011-02-20T02:41:25Z", "is_private": false, "time": "2011-02-20T02:41:25Z", "text": "Ah, it looks like the Fedora koji repository doesn't have debuginfo packages, which makes the cores pretty useless. I'll see if I can find the corresponding debuginfos.", "tags": [], "bug_id": 626635, "id": 5292611}, {"attachment_id": null, "raw_text": "Some of the debuginfo packages are still missing, but here is the backtrace I get at the moment:\n\n\n#0  PropertyProvider::GetSpacingInternal (this=0xbebc4ec0, aStart=0, aLength=8, aSpacing=0xbebc3954, aIgnoreTabs=1)\n    at nsTextFrameThebes.cpp:2386\n#1  0x40d36afc in PropertyProvider::GetSpacing (this=<value optimized out>, aStart=<value optimized out>, \n    aLength=<value optimized out>, aSpacing=<value optimized out>) at nsTextFrameThebes.cpp:2366\n#2  0x414d4530 in GetAdjustedSpacing (this=<value optimized out>, aStart=0, aEnd=8, aProvider=0xbebc4ec0, aSpacingStart=0, \n    aSpacingEnd=8, aSpacing=0xbebc3948) at gfxFont.cpp:1998\n#3  gfxTextRun::GetAdjustedSpacingArray (this=<value optimized out>, aStart=0, aEnd=8, aProvider=0xbebc4ec0, aSpacingStart=0, \n    aSpacingEnd=8, aSpacing=0xbebc3948) at gfxFont.cpp:2029\n#4  0x414d645c in gfxTextRun::AccumulateMetricsForRun (this=0x49816ac0, aFont=0x497d1e30, aStart=0, aEnd=8, aBoundingBoxType=\n    gfxFont::LOOSE_INK_EXTENTS, aRefContext=0x4d081ef0, aProvider=0xbebc4ec0, aSpacingStart=0, aSpacingEnd=8, aMetrics=0xbebc4d48)\n    at gfxFont.cpp:2331\n#5  0x414d6838 in gfxTextRun::MeasureText (this=0x49816ac0, aStart=<value optimized out>, aLength=<value optimized out>, \n    aBoundingBoxType=gfxFont::LOOSE_INK_EXTENTS, aRefContext=0x4d081ef0, aProvider=0xbebc4ec0) at gfxFont.cpp:2404\n#6  0x414d6e50 in gfxTextRun::BreakAndMeasureText (this=0x49816ac0, aStart=3200012416, aMaxLength=3200012112, \n    aLineBreakBefore=<value optimized out>, aWidth=27000, aProvider=0xbebc4ec0, aSuppressInitialBreak=1, aTrimWhitespace=\n    0xbebc5068, aMetrics=0xbebc4f50, aBoundingBoxType=gfxFont::LOOSE_INK_EXTENTS, aRefContext=0x4d081ef0, aUsedHyphenation=\n    0xbebc507c, aLastBreak=0xbebc5080, aCanWordWrap=0, aBreakPriority=0xbebc5078) at gfxFont.cpp:2562\n#7  0x40d3b460 in nsTextFrame::Reflow (this=0x4d950c38, aPresContext=0x8, aMetrics=..., aReflowState=..., aStatus=@0xbebc5254)\n    at nsTextFrameThebes.cpp:6214\n#8  0x40d19ac0 in nsLineLayout::ReflowFrame (this=0xbebc532c, aFrame=0x4d950c38, aReflowStatus=@0x0, aMetrics=0x0, aPushedFrame=\n    @0xbebc5250) at nsLineLayout.cpp:848\n#9  0x40ce5b08 in nsBlockFrame::ReflowInlineFrame (this=0x4d950ab8, aState=..., aLineLayout=..., aLine=<value optimized out>, \n    aFrame=0x4d950c38, aLineReflowStatus=0xbebc52c4) at nsBlockFrame.cpp:3758\n#10 0x40ce8298 in nsBlockFrame::DoReflowInlineFrames (this=0x4d950ab8, aState=..., aLineLayout=..., aLine=..., \n    aFloatAvailableSpace=..., aAvailableSpaceHeight=@0xbebc53d8, aFloatStateBeforeLine=0xbebc53cc, aKeepReflowGoing=0xbebc554c, \n    aLineReflowStatus=0xbebc53dc, aAllowPullUp=1) at nsBlockFrame.cpp:3574\n#11 0x40ce8620 in nsBlockFrame::ReflowInlineFrames (this=0xbebc562c, aState=..., aLine=..., aKeepReflowGoing=0xbebc554c)\n    at nsBlockFrame.cpp:3424\n#12 0x40ce88d0 in nsBlockFrame::ReflowLine (this=0x4d950ab8, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc554c) at nsBlockFrame.cpp:2463\n#13 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4d950ab8, aState=...) at nsBlockFrame.cpp:1921\n#14 0x40ce9660 in nsBlockFrame::Reflow (this=0x4d950ab8, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc59ec) at nsBlockFrame.cpp:991\n#15 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc58f8, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=1, aLine=\n    0x4d950e78, aFrameRS=..., aFrameReflowStatus=@0xbebc59ec, aState=...) at nsBlockReflowContext.cpp:310\n#16 0x40ce6374 in nsBlockFrame::ReflowBlockFrame (this=0x4d9506d8, aState=..., aLine=..., aKeepReflowGoing=0x0)\n    at nsBlockFrame.cpp:3141\n#17 0x40ce874c in nsBlockFrame::ReflowLine (this=0x4d9506d8, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc5b64) at nsBlockFrame.cpp:2408\n#18 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4d9506d8, aState=...) at nsBlockFrame.cpp:1921\n#19 0x40ce9660 in nsBlockFrame::Reflow (this=0x4d9506d8, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc6244) at nsBlockFrame.cpp:991\n#20 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc5e30, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=1, aLine=0x0, \n    aFrameRS=..., aFrameReflowStatus=@0xbebc6244, aState=...) at nsBlockReflowContext.cpp:310\n#21 0x40ce334c in nsBlockFrame::ReflowFloat (this=0xbebc65a4, aState=..., aFloatAvailableSpace=<value optimized out>, aPlaceholder=\n    0x4d950730, aFloatMargin=..., aReflowStatus=@0xbebc6244) at nsBlockFrame.cpp:5910\n#22 0x40cead0c in nsBlockReflowState::FlowAndPlaceFloat (this=0xbebc65a4, aFloatCache=<value optimized out>, aReflowStatus=\n    @0xbebc6244, aForceFit=216) at nsBlockReflowState.cpp:812\n#23 0x40ceb3ec in nsBlockReflowState::AddFloat (this=0xbebc65a4, aLineLayout=..., aPlaceholder=0x4d950730, aAvailableWidth=54780, \n    aReflowStatus=@0xbebc6244) at nsBlockReflowState.cpp:610\n#24 0x40d19b64 in AddFloat (this=0xbebc631c, aFrame=0x4d950730, aReflowStatus=@0x0, aMetrics=0x0, aPushedFrame=@0xbebc6240)\n    at nsLineLayout.h:215\n#25 nsLineLayout::ReflowFrame (this=0xbebc631c, aFrame=0x4d950730, aReflowStatus=@0x0, aMetrics=0x0, aPushedFrame=@0xbebc6240)\n    at nsLineLayout.cpp:887\n#26 0x40ce5b08 in nsBlockFrame::ReflowInlineFrame (this=0x4d950378, aState=..., aLineLayout=..., aLine=<value optimized out>, \n    aFrame=0x4d950730, aLineReflowStatus=0xbebc62b4) at nsBlockFrame.cpp:3758\n#27 0x40ce8298 in nsBlockFrame::DoReflowInlineFrames (this=0x4d950378, aState=..., aLineLayout=..., aLine=..., \n    aFloatAvailableSpace=..., aAvailableSpaceHeight=@0xbebc63c8, aFloatStateBeforeLine=0xbebc63bc, aKeepReflowGoing=0xbebc653c, \n    aLineReflowStatus=0xbebc63cc, aAllowPullUp=1) at nsBlockFrame.cpp:3574\n#28 0x40ce8620 in nsBlockFrame::ReflowInlineFrames (this=0xbebc661c, aState=..., aLine=..., aKeepReflowGoing=0xbebc653c)\n    at nsBlockFrame.cpp:3424\n#29 0x40ce88d0 in nsBlockFrame::ReflowLine (this=0x4d950378, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc653c) at nsBlockFrame.cpp:2463\n#30 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4d950378, aState=...) at nsBlockFrame.cpp:1921\n#31 0x40ce9660 in nsBlockFrame::Reflow (this=0x4d950378, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc6c1c) at nsBlockFrame.cpp:991\n#32 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc6808, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=0, aLine=0x0, \n    aFrameRS=..., aFrameReflowStatus=@0xbebc6c1c, aState=...) at nsBlockReflowContext.cpp:310\n#33 0x40ce334c in nsBlockFrame::ReflowFloat (this=0xbebc6f7c, aState=..., aFloatAvailableSpace=<value optimized out>, aPlaceholder=\n    0x4d950470, aFloatMargin=..., aReflowStatus=@0xbebc6c1c) at nsBlockFrame.cpp:5910\n#34 0x40cead0c in nsBlockReflowState::FlowAndPlaceFloat (this=0xbebc6f7c, aFloatCache=<value optimized out>, aReflowStatus=\n    @0xbebc6c1c, aForceFit=-1094948008) at nsBlockReflowState.cpp:812\n#35 0x40ceb3ec in nsBlockReflowState::AddFloat (this=0xbebc6f7c, aLineLayout=..., aPlaceholder=0x4d950470, aAvailableWidth=54780, \n    aReflowStatus=@0xbebc6c1c) at nsBlockReflowState.cpp:610\n#36 0x40d19b64 in AddFloat (this=0xbebc6cf4, aFrame=0x4d950470, aReflowStatus=@0xbebc6ca8, aMetrics=0x0, aPushedFrame=@0xbebc6c18)\n    at nsLineLayout.h:215\n#37 nsLineLayout::ReflowFrame (this=0xbebc6cf4, aFrame=0x4d950470, aReflowStatus=@0xbebc6ca8, aMetrics=0x0, aPushedFrame=\n    @0xbebc6c18) at nsLineLayout.cpp:887\n#38 0x40ce5b08 in nsBlockFrame::ReflowInlineFrame (this=0x4daa87c0, aState=..., aLineLayout=..., aLine=<value optimized out>, \n    aFrame=0x4d950470, aLineReflowStatus=0xbebc6c8c) at nsBlockFrame.cpp:3758\n#39 0x40ce8298 in nsBlockFrame::DoReflowInlineFrames (this=0x4daa87c0, aState=..., aLineLayout=..., aLine=..., \n    aFloatAvailableSpace=..., aAvailableSpaceHeight=@0xbebc6da0, aFloatStateBeforeLine=0xbebc6d94, aKeepReflowGoing=0xbebc6f14, \n    aLineReflowStatus=0xbebc6da4, aAllowPullUp=1) at nsBlockFrame.cpp:3574\n#40 0x40ce8620 in nsBlockFrame::ReflowInlineFrames (this=0xbebc6ff4, aState=..., aLine=..., aKeepReflowGoing=0xbebc6f14)\n    at nsBlockFrame.cpp:3424\n#41 0x40ce88d0 in nsBlockFrame::ReflowLine (this=0x4daa87c0, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc6f14) at nsBlockFrame.cpp:2463\n#42 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4daa87c0, aState=...) at nsBlockFrame.cpp:1921\n#43 0x40ce9660 in nsBlockFrame::Reflow (this=0x4daa87c0, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc73b4) at nsBlockFrame.cpp:991\n#44 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc72c0, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=1, aLine=\n    0x4d960c78, aFrameRS=..., aFrameReflowStatus=@0xbebc73b4, aState=...) at nsBlockReflowContext.cpp:310\n#45 0x40ce6374 in nsBlockFrame::ReflowBlockFrame (this=0x4daa8640, aState=..., aLine=..., aKeepReflowGoing=0x0)\n    at nsBlockFrame.cpp:3141\n#46 0x40ce874c in nsBlockFrame::ReflowLine (this=0x4daa8640, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc752c) at nsBlockFrame.cpp:2408\n#47 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4daa8640, aState=...) at nsBlockFrame.cpp:1921\n#48 0x40ce9660 in nsBlockFrame::Reflow (this=0x4daa8640, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc79cc) at nsBlockFrame.cpp:991\n#49 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc78d8, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=1, aLine=\n    0x4d960ca0, aFrameRS=..., aFrameReflowStatus=@0xbebc79cc, aState=...) at nsBlockReflowContext.cpp:310\n#50 0x40ce6374 in nsBlockFrame::ReflowBlockFrame (this=0x4daa83b0, aState=..., aLine=..., aKeepReflowGoing=0x0)\n    at nsBlockFrame.cpp:3141\n#51 0x40ce874c in nsBlockFrame::ReflowLine (this=0x4daa83b0, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc7b44) at nsBlockFrame.cpp:2408\n#52 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4daa83b0, aState=...) at nsBlockFrame.cpp:1921\n#53 0x40ce9660 in nsBlockFrame::Reflow (this=0x4daa83b0, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc7fe4) at nsBlockFrame.cpp:991\n#54 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc7ef0, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=1, aLine=\n    0x4daa8408, aFrameRS=..., aFrameReflowStatus=@0xbebc7fe4, aState=...) at nsBlockReflowContext.cpp:310\n#55 0x40ce6374 in nsBlockFrame::ReflowBlockFrame (this=0x4daa8010, aState=..., aLine=..., aKeepReflowGoing=0x0)\n    at nsBlockFrame.cpp:3141\n#56 0x40ce874c in nsBlockFrame::ReflowLine (this=0x4daa8010, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc815c) at nsBlockFrame.cpp:2408\n#57 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4daa8010, aState=...) at nsBlockFrame.cpp:1921\n#58 0x40ce9660 in nsBlockFrame::Reflow (this=0x4daa8010, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc8654) at nsBlockFrame.cpp:991\n#59 0x40cf0898 in nsContainerFrame::ReflowChild (this=<value optimized out>, aKidFrame=0x4daa8010, aPresContext=0x4d0ed400, \n    aDesiredSize=..., aReflowState=..., aX=0, aY=0, aFlags=0, aStatus=@0xbebc8654, aTracker=0x0) at nsContainerFrame.cpp:800\n#60 0x40d0b128 in CanvasFrame::Reflow (this=0x4d0d0b78, aPresContext=0x4d0ed400, aDesiredSize=..., aReflowState=..., aStatus=\n    @0xbebc8654) at nsHTMLFrame.cpp:549\n#61 0x40cf0898 in nsContainerFrame::ReflowChild (this=<value optimized out>, aKidFrame=0x4d0d0b78, aPresContext=0x4d0ed400, \n    aDesiredSize=..., aReflowState=..., aX=0, aY=0, aFlags=3, aStatus=@0xbebc8654, aTracker=0x0) at nsContainerFrame.cpp:800\n#62 0x40d07428 in nsHTMLScrollFrame::ReflowScrolledFrame (this=0x4d0d0c88, aState=0xbebc8738, aAssumeHScroll=0, aAssumeVScroll=\n    75600, aMetrics=0xbebc8690, aFirstPass=1) at nsGfxScrollFrame.cpp:545\n#63 0x40d078a0 in nsHTMLScrollFrame::ReflowContents (this=0x4d0d0c88, aState=0xbebc8738, aDesiredSize=<value optimized out>)\n    at nsGfxScrollFrame.cpp:639\n#64 0x40d07c60 in nsHTMLScrollFrame::Reflow (this=0x4d0d0c88, aPresContext=<value optimized out>, aDesiredSize=..., aReflowState=\n    ..., aStatus=@0xbebc8b78) at nsGfxScrollFrame.cpp:840\n#65 0x40cf0898 in nsContainerFrame::ReflowChild (this=<value optimized out>, aKidFrame=0x4d0d0c88, aPresContext=0x4d0ed400, \n    aDesiredSize=..., aReflowState=..., aX=0, aY=0, aFlags=0, aStatus=@0xbebc8b78, aTracker=0x0) at nsContainerFrame.cpp:800\n#66 0x40d40734 in ViewportFrame::Reflow (this=0x4d0d0628, aPresContext=0x4d0d04b8, aDesiredSize=..., aReflowState=..., aStatus=\n    @0xbebc8b78) at nsViewportFrame.cpp:284\n#67 0x40cce960 in PresShell::DoReflow (this=0x49606400, target=0x49818b00, aInterruptible=1) at nsPresShell.cpp:7285\n#68 0x40cd2780 in PresShell::ResizeReflow (this=0x49606400, aWidth=75600, aHeight=<value optimized out>) at nsPresShell.cpp:2799\n#69 0x40ccd9bc in PresShell::ResizeReflow (this=<value optimized out>, aView=<value optimized out>, aWidth=<value optimized out>, \n    aHeight=<value optimized out>) at nsPresShell.cpp:6912\n#70 0x40f8faec in nsViewManager::DoSetWindowDimensions (this=0x4d0eb3a0, aWidth=75600, aHeight=79380) at nsViewManager.h:278\n#71 0x40f8d298 in nsViewManager::SetWindowDimensions (this=0x4d0eb3a0, aWidth=75600, aHeight=79380) at nsViewManager.cpp:359\n#72 0x40f8ec5c in nsViewManager::DispatchEvent (this=0x4d0eb3a0, aEvent=0xbebc8d10, aView=0x4d0eb400, aStatus=0xbebc8cec)", "creator": "gordan@bobich.net", "author": "gordan@bobich.net", "count": 10, "creation_time": "2011-02-22T23:28:27Z", "time": "2011-02-22T23:28:27Z", "is_private": false, "text": "Some of the debuginfo packages are still missing, but here is the backtrace I get at the moment:\n\n\n#0  PropertyProvider::GetSpacingInternal (this=0xbebc4ec0, aStart=0, aLength=8, aSpacing=0xbebc3954, aIgnoreTabs=1)\n    at nsTextFrameThebes.cpp:2386\n#1  0x40d36afc in PropertyProvider::GetSpacing (this=<value optimized out>, aStart=<value optimized out>, \n    aLength=<value optimized out>, aSpacing=<value optimized out>) at nsTextFrameThebes.cpp:2366\n#2  0x414d4530 in GetAdjustedSpacing (this=<value optimized out>, aStart=0, aEnd=8, aProvider=0xbebc4ec0, aSpacingStart=0, \n    aSpacingEnd=8, aSpacing=0xbebc3948) at gfxFont.cpp:1998\n#3  gfxTextRun::GetAdjustedSpacingArray (this=<value optimized out>, aStart=0, aEnd=8, aProvider=0xbebc4ec0, aSpacingStart=0, \n    aSpacingEnd=8, aSpacing=0xbebc3948) at gfxFont.cpp:2029\n#4  0x414d645c in gfxTextRun::AccumulateMetricsForRun (this=0x49816ac0, aFont=0x497d1e30, aStart=0, aEnd=8, aBoundingBoxType=\n    gfxFont::LOOSE_INK_EXTENTS, aRefContext=0x4d081ef0, aProvider=0xbebc4ec0, aSpacingStart=0, aSpacingEnd=8, aMetrics=0xbebc4d48)\n    at gfxFont.cpp:2331\n#5  0x414d6838 in gfxTextRun::MeasureText (this=0x49816ac0, aStart=<value optimized out>, aLength=<value optimized out>, \n    aBoundingBoxType=gfxFont::LOOSE_INK_EXTENTS, aRefContext=0x4d081ef0, aProvider=0xbebc4ec0) at gfxFont.cpp:2404\n#6  0x414d6e50 in gfxTextRun::BreakAndMeasureText (this=0x49816ac0, aStart=3200012416, aMaxLength=3200012112, \n    aLineBreakBefore=<value optimized out>, aWidth=27000, aProvider=0xbebc4ec0, aSuppressInitialBreak=1, aTrimWhitespace=\n    0xbebc5068, aMetrics=0xbebc4f50, aBoundingBoxType=gfxFont::LOOSE_INK_EXTENTS, aRefContext=0x4d081ef0, aUsedHyphenation=\n    0xbebc507c, aLastBreak=0xbebc5080, aCanWordWrap=0, aBreakPriority=0xbebc5078) at gfxFont.cpp:2562\n#7  0x40d3b460 in nsTextFrame::Reflow (this=0x4d950c38, aPresContext=0x8, aMetrics=..., aReflowState=..., aStatus=@0xbebc5254)\n    at nsTextFrameThebes.cpp:6214\n#8  0x40d19ac0 in nsLineLayout::ReflowFrame (this=0xbebc532c, aFrame=0x4d950c38, aReflowStatus=@0x0, aMetrics=0x0, aPushedFrame=\n    @0xbebc5250) at nsLineLayout.cpp:848\n#9  0x40ce5b08 in nsBlockFrame::ReflowInlineFrame (this=0x4d950ab8, aState=..., aLineLayout=..., aLine=<value optimized out>, \n    aFrame=0x4d950c38, aLineReflowStatus=0xbebc52c4) at nsBlockFrame.cpp:3758\n#10 0x40ce8298 in nsBlockFrame::DoReflowInlineFrames (this=0x4d950ab8, aState=..., aLineLayout=..., aLine=..., \n    aFloatAvailableSpace=..., aAvailableSpaceHeight=@0xbebc53d8, aFloatStateBeforeLine=0xbebc53cc, aKeepReflowGoing=0xbebc554c, \n    aLineReflowStatus=0xbebc53dc, aAllowPullUp=1) at nsBlockFrame.cpp:3574\n#11 0x40ce8620 in nsBlockFrame::ReflowInlineFrames (this=0xbebc562c, aState=..., aLine=..., aKeepReflowGoing=0xbebc554c)\n    at nsBlockFrame.cpp:3424\n#12 0x40ce88d0 in nsBlockFrame::ReflowLine (this=0x4d950ab8, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc554c) at nsBlockFrame.cpp:2463\n#13 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4d950ab8, aState=...) at nsBlockFrame.cpp:1921\n#14 0x40ce9660 in nsBlockFrame::Reflow (this=0x4d950ab8, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc59ec) at nsBlockFrame.cpp:991\n#15 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc58f8, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=1, aLine=\n    0x4d950e78, aFrameRS=..., aFrameReflowStatus=@0xbebc59ec, aState=...) at nsBlockReflowContext.cpp:310\n#16 0x40ce6374 in nsBlockFrame::ReflowBlockFrame (this=0x4d9506d8, aState=..., aLine=..., aKeepReflowGoing=0x0)\n    at nsBlockFrame.cpp:3141\n#17 0x40ce874c in nsBlockFrame::ReflowLine (this=0x4d9506d8, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc5b64) at nsBlockFrame.cpp:2408\n#18 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4d9506d8, aState=...) at nsBlockFrame.cpp:1921\n#19 0x40ce9660 in nsBlockFrame::Reflow (this=0x4d9506d8, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc6244) at nsBlockFrame.cpp:991\n#20 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc5e30, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=1, aLine=0x0, \n    aFrameRS=..., aFrameReflowStatus=@0xbebc6244, aState=...) at nsBlockReflowContext.cpp:310\n#21 0x40ce334c in nsBlockFrame::ReflowFloat (this=0xbebc65a4, aState=..., aFloatAvailableSpace=<value optimized out>, aPlaceholder=\n    0x4d950730, aFloatMargin=..., aReflowStatus=@0xbebc6244) at nsBlockFrame.cpp:5910\n#22 0x40cead0c in nsBlockReflowState::FlowAndPlaceFloat (this=0xbebc65a4, aFloatCache=<value optimized out>, aReflowStatus=\n    @0xbebc6244, aForceFit=216) at nsBlockReflowState.cpp:812\n#23 0x40ceb3ec in nsBlockReflowState::AddFloat (this=0xbebc65a4, aLineLayout=..., aPlaceholder=0x4d950730, aAvailableWidth=54780, \n    aReflowStatus=@0xbebc6244) at nsBlockReflowState.cpp:610\n#24 0x40d19b64 in AddFloat (this=0xbebc631c, aFrame=0x4d950730, aReflowStatus=@0x0, aMetrics=0x0, aPushedFrame=@0xbebc6240)\n    at nsLineLayout.h:215\n#25 nsLineLayout::ReflowFrame (this=0xbebc631c, aFrame=0x4d950730, aReflowStatus=@0x0, aMetrics=0x0, aPushedFrame=@0xbebc6240)\n    at nsLineLayout.cpp:887\n#26 0x40ce5b08 in nsBlockFrame::ReflowInlineFrame (this=0x4d950378, aState=..., aLineLayout=..., aLine=<value optimized out>, \n    aFrame=0x4d950730, aLineReflowStatus=0xbebc62b4) at nsBlockFrame.cpp:3758\n#27 0x40ce8298 in nsBlockFrame::DoReflowInlineFrames (this=0x4d950378, aState=..., aLineLayout=..., aLine=..., \n    aFloatAvailableSpace=..., aAvailableSpaceHeight=@0xbebc63c8, aFloatStateBeforeLine=0xbebc63bc, aKeepReflowGoing=0xbebc653c, \n    aLineReflowStatus=0xbebc63cc, aAllowPullUp=1) at nsBlockFrame.cpp:3574\n#28 0x40ce8620 in nsBlockFrame::ReflowInlineFrames (this=0xbebc661c, aState=..., aLine=..., aKeepReflowGoing=0xbebc653c)\n    at nsBlockFrame.cpp:3424\n#29 0x40ce88d0 in nsBlockFrame::ReflowLine (this=0x4d950378, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc653c) at nsBlockFrame.cpp:2463\n#30 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4d950378, aState=...) at nsBlockFrame.cpp:1921\n#31 0x40ce9660 in nsBlockFrame::Reflow (this=0x4d950378, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc6c1c) at nsBlockFrame.cpp:991\n#32 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc6808, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=0, aLine=0x0, \n    aFrameRS=..., aFrameReflowStatus=@0xbebc6c1c, aState=...) at nsBlockReflowContext.cpp:310\n#33 0x40ce334c in nsBlockFrame::ReflowFloat (this=0xbebc6f7c, aState=..., aFloatAvailableSpace=<value optimized out>, aPlaceholder=\n    0x4d950470, aFloatMargin=..., aReflowStatus=@0xbebc6c1c) at nsBlockFrame.cpp:5910\n#34 0x40cead0c in nsBlockReflowState::FlowAndPlaceFloat (this=0xbebc6f7c, aFloatCache=<value optimized out>, aReflowStatus=\n    @0xbebc6c1c, aForceFit=-1094948008) at nsBlockReflowState.cpp:812\n#35 0x40ceb3ec in nsBlockReflowState::AddFloat (this=0xbebc6f7c, aLineLayout=..., aPlaceholder=0x4d950470, aAvailableWidth=54780, \n    aReflowStatus=@0xbebc6c1c) at nsBlockReflowState.cpp:610\n#36 0x40d19b64 in AddFloat (this=0xbebc6cf4, aFrame=0x4d950470, aReflowStatus=@0xbebc6ca8, aMetrics=0x0, aPushedFrame=@0xbebc6c18)\n    at nsLineLayout.h:215\n#37 nsLineLayout::ReflowFrame (this=0xbebc6cf4, aFrame=0x4d950470, aReflowStatus=@0xbebc6ca8, aMetrics=0x0, aPushedFrame=\n    @0xbebc6c18) at nsLineLayout.cpp:887\n#38 0x40ce5b08 in nsBlockFrame::ReflowInlineFrame (this=0x4daa87c0, aState=..., aLineLayout=..., aLine=<value optimized out>, \n    aFrame=0x4d950470, aLineReflowStatus=0xbebc6c8c) at nsBlockFrame.cpp:3758\n#39 0x40ce8298 in nsBlockFrame::DoReflowInlineFrames (this=0x4daa87c0, aState=..., aLineLayout=..., aLine=..., \n    aFloatAvailableSpace=..., aAvailableSpaceHeight=@0xbebc6da0, aFloatStateBeforeLine=0xbebc6d94, aKeepReflowGoing=0xbebc6f14, \n    aLineReflowStatus=0xbebc6da4, aAllowPullUp=1) at nsBlockFrame.cpp:3574\n#40 0x40ce8620 in nsBlockFrame::ReflowInlineFrames (this=0xbebc6ff4, aState=..., aLine=..., aKeepReflowGoing=0xbebc6f14)\n    at nsBlockFrame.cpp:3424\n#41 0x40ce88d0 in nsBlockFrame::ReflowLine (this=0x4daa87c0, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc6f14) at nsBlockFrame.cpp:2463\n#42 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4daa87c0, aState=...) at nsBlockFrame.cpp:1921\n#43 0x40ce9660 in nsBlockFrame::Reflow (this=0x4daa87c0, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc73b4) at nsBlockFrame.cpp:991\n#44 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc72c0, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=1, aLine=\n    0x4d960c78, aFrameRS=..., aFrameReflowStatus=@0xbebc73b4, aState=...) at nsBlockReflowContext.cpp:310\n#45 0x40ce6374 in nsBlockFrame::ReflowBlockFrame (this=0x4daa8640, aState=..., aLine=..., aKeepReflowGoing=0x0)\n    at nsBlockFrame.cpp:3141\n#46 0x40ce874c in nsBlockFrame::ReflowLine (this=0x4daa8640, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc752c) at nsBlockFrame.cpp:2408\n#47 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4daa8640, aState=...) at nsBlockFrame.cpp:1921\n#48 0x40ce9660 in nsBlockFrame::Reflow (this=0x4daa8640, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc79cc) at nsBlockFrame.cpp:991\n#49 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc78d8, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=1, aLine=\n    0x4d960ca0, aFrameRS=..., aFrameReflowStatus=@0xbebc79cc, aState=...) at nsBlockReflowContext.cpp:310\n#50 0x40ce6374 in nsBlockFrame::ReflowBlockFrame (this=0x4daa83b0, aState=..., aLine=..., aKeepReflowGoing=0x0)\n    at nsBlockFrame.cpp:3141\n#51 0x40ce874c in nsBlockFrame::ReflowLine (this=0x4daa83b0, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc7b44) at nsBlockFrame.cpp:2408\n#52 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4daa83b0, aState=...) at nsBlockFrame.cpp:1921\n#53 0x40ce9660 in nsBlockFrame::Reflow (this=0x4daa83b0, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc7fe4) at nsBlockFrame.cpp:991\n#54 0x40cea158 in nsBlockReflowContext::ReflowBlock (this=0xbebc7ef0, aSpace=<value optimized out>, \n    aApplyTopMargin=<value optimized out>, aPrevMargin=<value optimized out>, aClearance=0, aIsAdjacentWithTop=1, aLine=\n    0x4daa8408, aFrameRS=..., aFrameReflowStatus=@0xbebc7fe4, aState=...) at nsBlockReflowContext.cpp:310\n#55 0x40ce6374 in nsBlockFrame::ReflowBlockFrame (this=0x4daa8010, aState=..., aLine=..., aKeepReflowGoing=0x0)\n    at nsBlockFrame.cpp:3141\n#56 0x40ce874c in nsBlockFrame::ReflowLine (this=0x4daa8010, aState=<value optimized out>, aLine=<value optimized out>, \n    aKeepReflowGoing=0xbebc815c) at nsBlockFrame.cpp:2408\n#57 0x40ce8c84 in nsBlockFrame::ReflowDirtyLines (this=0x4daa8010, aState=...) at nsBlockFrame.cpp:1921\n#58 0x40ce9660 in nsBlockFrame::Reflow (this=0x4daa8010, aPresContext=0x4d0ed400, aMetrics=..., aReflowState=..., aStatus=\n    @0xbebc8654) at nsBlockFrame.cpp:991\n#59 0x40cf0898 in nsContainerFrame::ReflowChild (this=<value optimized out>, aKidFrame=0x4daa8010, aPresContext=0x4d0ed400, \n    aDesiredSize=..., aReflowState=..., aX=0, aY=0, aFlags=0, aStatus=@0xbebc8654, aTracker=0x0) at nsContainerFrame.cpp:800\n#60 0x40d0b128 in CanvasFrame::Reflow (this=0x4d0d0b78, aPresContext=0x4d0ed400, aDesiredSize=..., aReflowState=..., aStatus=\n    @0xbebc8654) at nsHTMLFrame.cpp:549\n#61 0x40cf0898 in nsContainerFrame::ReflowChild (this=<value optimized out>, aKidFrame=0x4d0d0b78, aPresContext=0x4d0ed400, \n    aDesiredSize=..., aReflowState=..., aX=0, aY=0, aFlags=3, aStatus=@0xbebc8654, aTracker=0x0) at nsContainerFrame.cpp:800\n#62 0x40d07428 in nsHTMLScrollFrame::ReflowScrolledFrame (this=0x4d0d0c88, aState=0xbebc8738, aAssumeHScroll=0, aAssumeVScroll=\n    75600, aMetrics=0xbebc8690, aFirstPass=1) at nsGfxScrollFrame.cpp:545\n#63 0x40d078a0 in nsHTMLScrollFrame::ReflowContents (this=0x4d0d0c88, aState=0xbebc8738, aDesiredSize=<value optimized out>)\n    at nsGfxScrollFrame.cpp:639\n#64 0x40d07c60 in nsHTMLScrollFrame::Reflow (this=0x4d0d0c88, aPresContext=<value optimized out>, aDesiredSize=..., aReflowState=\n    ..., aStatus=@0xbebc8b78) at nsGfxScrollFrame.cpp:840\n#65 0x40cf0898 in nsContainerFrame::ReflowChild (this=<value optimized out>, aKidFrame=0x4d0d0c88, aPresContext=0x4d0ed400, \n    aDesiredSize=..., aReflowState=..., aX=0, aY=0, aFlags=0, aStatus=@0xbebc8b78, aTracker=0x0) at nsContainerFrame.cpp:800\n#66 0x40d40734 in ViewportFrame::Reflow (this=0x4d0d0628, aPresContext=0x4d0d04b8, aDesiredSize=..., aReflowState=..., aStatus=\n    @0xbebc8b78) at nsViewportFrame.cpp:284\n#67 0x40cce960 in PresShell::DoReflow (this=0x49606400, target=0x49818b00, aInterruptible=1) at nsPresShell.cpp:7285\n#68 0x40cd2780 in PresShell::ResizeReflow (this=0x49606400, aWidth=75600, aHeight=<value optimized out>) at nsPresShell.cpp:2799\n#69 0x40ccd9bc in PresShell::ResizeReflow (this=<value optimized out>, aView=<value optimized out>, aWidth=<value optimized out>, \n    aHeight=<value optimized out>) at nsPresShell.cpp:6912\n#70 0x40f8faec in nsViewManager::DoSetWindowDimensions (this=0x4d0eb3a0, aWidth=75600, aHeight=79380) at nsViewManager.h:278\n#71 0x40f8d298 in nsViewManager::SetWindowDimensions (this=0x4d0eb3a0, aWidth=75600, aHeight=79380) at nsViewManager.cpp:359\n#72 0x40f8ec5c in nsViewManager::DispatchEvent (this=0x4d0eb3a0, aEvent=0xbebc8d10, aView=0x4d0eb400, aStatus=0xbebc8cec)", "tags": [], "bug_id": 626635, "id": 5297279}, {"id": 5297362, "tags": [], "is_private": false, "count": 11, "author": "bzbarsky@mit.edu", "bug_id": 626635, "text": "Thanks for the stack!  Is that a stack with 3.6.something, or with 4.0 betas?", "time": "2011-02-23T00:02:58Z", "creation_time": "2011-02-23T00:02:58Z", "raw_text": "Thanks for the stack!  Is that a stack with 3.6.something, or with 4.0 betas?", "creator": "bzbarsky@mit.edu", "attachment_id": null}, {"text": "Or possibly neither....  What does your debugger think is around line 2386 in nsTextFrameThebes.cpp?", "tags": [], "bug_id": 626635, "id": 5297369, "creation_time": "2011-02-23T00:04:27Z", "is_private": false, "time": "2011-02-23T00:04:27Z", "author": "bzbarsky@mit.edu", "count": 12, "attachment_id": null, "creator": "bzbarsky@mit.edu", "raw_text": "Or possibly neither....  What does your debugger think is around line 2386 in nsTextFrameThebes.cpp?"}, {"author": "gordan@bobich.net", "count": 13, "is_private": false, "tags": [], "id": 5298071, "raw_text": "The Firefox in question is 3.6.3 built from this source package:\nhttp://arm.koji.fedoraproject.org/packages/firefox/3.6.3/4.fc13/src/firefox-3.6.3-4.fc13.src.rpm\n\nThe code at that location is  a loop:\n\n2384: PRUint32 index;\n2385: for (index = 0; index < aLength; ++index) {\n2386:    aSpacing[index].mBefore = 0.0;\n2387:    aSpacing[index].mAfter = 0.0;\n2388: }", "creator": "gordan@bobich.net", "attachment_id": null, "creation_time": "2011-02-23T09:45:05Z", "time": "2011-02-23T09:45:05Z", "text": "The Firefox in question is 3.6.3 built from this source package:\nhttp://arm.koji.fedoraproject.org/packages/firefox/3.6.3/4.fc13/src/firefox-3.6.3-4.fc13.src.rpm\n\nThe code at that location is  a loop:\n\n2384: PRUint32 index;\n2385: for (index = 0; index < aLength; ++index) {\n2386:    aSpacing[index].mBefore = 0.0;\n2387:    aSpacing[index].mAfter = 0.0;\n2388: }", "bug_id": 626635}, {"creation_time": "2011-02-23T14:54:45Z", "time": "2011-02-23T14:54:45Z", "text": "Hmm.  So in frame 2 above we have:\n\n  aSpacing=0xbebc3948\n\nand in frame 0 we have:\n\n  aSpacing=0xbebc3954\n\nbut the value is just passed through directly from frame 2 to frame 0.... maybe just gdb being confused.\n\nIn any case, the original source of that aSpacing is this (in gfxTextRun::AccumulateMetricsForRun):\n\n  nsAutoTArray<PropertyProvider::Spacing,200> spacingBuffer;\n\nOn trunk, the buffer of an nsAutoTArray is 8-byte-aligned.  This was fixed after 1.9.2 branched, in bug 448658.\n\nDoes applying the patch from that bug make things better?", "bug_id": 626635, "attachment_id": null, "creator": "bzbarsky@mit.edu", "raw_text": "Hmm.  So in frame 2 above we have:\n\n  aSpacing=0xbebc3948\n\nand in frame 0 we have:\n\n  aSpacing=0xbebc3954\n\nbut the value is just passed through directly from frame 2 to frame 0.... maybe just gdb being confused.\n\nIn any case, the original source of that aSpacing is this (in gfxTextRun::AccumulateMetricsForRun):\n\n  nsAutoTArray<PropertyProvider::Spacing,200> spacingBuffer;\n\nOn trunk, the buffer of an nsAutoTArray is 8-byte-aligned.  This was fixed after 1.9.2 branched, in bug 448658.\n\nDoes applying the patch from that bug make things better?", "is_private": false, "tags": [], "id": 5298598, "author": "bzbarsky@mit.edu", "count": 14}, {"text": "I have seen exactly the same bug with fennec running on an iPAQ hx4700 (armv5te):\n\nAlignment trap: plugin-containe (625) PC=0x40f17cbc Instr=0xe1c423f0 Address=0xbe8af2b4 FSR 0x813\n\nAfter much digging I found the problem. The bug is in ipdl auto-generated files such as PLayers.h, in class definitions such as SpecificLayerAttributes:\n\n  1943  class SpecificLayerAttributes MOZ_FINAL\n<snip>\n  1971      union Value {\n  1972          char Vnull_t[sizeof(null_t)];\n  1973          char VThebesLayerAttributes[sizeof(ThebesLayerAttributes)];\n  1974          char VContainerLayerAttributes[sizeof(ContainerLayerAttributes)];\n  1975          char VColorLayerAttributes[sizeof(ColorLayerAttributes)];\n  1976          char VCanvasLayerAttributes[sizeof(CanvasLayerAttributes)];\n  1977          char VImageLayerAttributes[sizeof(ImageLayerAttributes)];\n  1978      };\n\nBecause it is composed entirely of char arrays, union Value has no alignment requirements despite needing to hold structures which do. For example, ContainerLayerAttributes contains a FrameMetrics, and FrameMetrics contains a PRUint64 (unsigned long long). As soon as such a 64-bit field is accessed (as it is in SpecificLayerAttributes::operator=() for example) ARM will throw an alignment fault.\n\nThe fix is to force all instances of union Value on to the most restrictive boundary:\n\n  1971      union Value {\n  1972          char Vnull_t[sizeof(null_t)];\n  1973          char VThebesLayerAttributes[sizeof(ThebesLayerAttributes)];\n  1974          char VContainerLayerAttributes[sizeof(ContainerLayerAttributes)];\n  1975          char VColorLayerAttributes[sizeof(ColorLayerAttributes)];\n  1976          char VCanvasLayerAttributes[sizeof(CanvasLayerAttributes)];\n  1977          char VImageLayerAttributes[sizeof(ImageLayerAttributes)];\n  1978      } __attribute__ ((aligned (__BIGGEST_ALIGNMENT__)));\n\nThis fixed fennec on my iPAQ.\n\nAlternatively (and more portably), union Value could include a long long, double, or whatever type is suitable (though how this could be determined I don't know).\n\nI don't know python so I can't provide a patch for the ipdl auto-generation code; I just hacked all the target header files which contained union Value.", "tags": [], "bug_id": 626635, "id": 5916171, "creation_time": "2011-12-14T18:00:40Z", "is_private": false, "time": "2011-12-14T18:00:40Z", "author": "junkmailnotread@yahoo.com", "count": 15, "attachment_id": null, "creator": "junkmailnotread@yahoo.com", "raw_text": "I have seen exactly the same bug with fennec running on an iPAQ hx4700 (armv5te):\n\nAlignment trap: plugin-containe (625) PC=0x40f17cbc Instr=0xe1c423f0 Address=0xbe8af2b4 FSR 0x813\n\nAfter much digging I found the problem. The bug is in ipdl auto-generated files such as PLayers.h, in class definitions such as SpecificLayerAttributes:\n\n  1943  class SpecificLayerAttributes MOZ_FINAL\n<snip>\n  1971      union Value {\n  1972          char Vnull_t[sizeof(null_t)];\n  1973          char VThebesLayerAttributes[sizeof(ThebesLayerAttributes)];\n  1974          char VContainerLayerAttributes[sizeof(ContainerLayerAttributes)];\n  1975          char VColorLayerAttributes[sizeof(ColorLayerAttributes)];\n  1976          char VCanvasLayerAttributes[sizeof(CanvasLayerAttributes)];\n  1977          char VImageLayerAttributes[sizeof(ImageLayerAttributes)];\n  1978      };\n\nBecause it is composed entirely of char arrays, union Value has no alignment requirements despite needing to hold structures which do. For example, ContainerLayerAttributes contains a FrameMetrics, and FrameMetrics contains a PRUint64 (unsigned long long). As soon as such a 64-bit field is accessed (as it is in SpecificLayerAttributes::operator=() for example) ARM will throw an alignment fault.\n\nThe fix is to force all instances of union Value on to the most restrictive boundary:\n\n  1971      union Value {\n  1972          char Vnull_t[sizeof(null_t)];\n  1973          char VThebesLayerAttributes[sizeof(ThebesLayerAttributes)];\n  1974          char VContainerLayerAttributes[sizeof(ContainerLayerAttributes)];\n  1975          char VColorLayerAttributes[sizeof(ColorLayerAttributes)];\n  1976          char VCanvasLayerAttributes[sizeof(CanvasLayerAttributes)];\n  1977          char VImageLayerAttributes[sizeof(ImageLayerAttributes)];\n  1978      } __attribute__ ((aligned (__BIGGEST_ALIGNMENT__)));\n\nThis fixed fennec on my iPAQ.\n\nAlternatively (and more portably), union Value could include a long long, double, or whatever type is suitable (though how this could be determined I don't know).\n\nI don't know python so I can't provide a patch for the ipdl auto-generation code; I just hacked all the target header files which contained union Value."}, {"author": "junkmailnotread@yahoo.com", "count": 16, "is_private": false, "tags": [], "id": 5926769, "attachment_id": null, "creator": "junkmailnotread@yahoo.com", "raw_text": "Should I file my previous fix as a new bug? It does need to be applied whether or not it is the same bug, and would seemingly benefit from more visibility than it has here.", "creation_time": "2011-12-19T16:12:30Z", "time": "2011-12-19T16:12:30Z", "text": "Should I file my previous fix as a new bug? It does need to be applied whether or not it is the same bug, and would seemingly benefit from more visibility than it has here.", "bug_id": 626635}, {"creator": "junkmailnotread@yahoo.com", "raw_text": "I filed my previous fix as Bug 714516.", "attachment_id": null, "author": "junkmailnotread@yahoo.com", "count": 17, "creation_time": "2012-01-01T16:04:48Z", "time": "2012-01-01T16:04:48Z", "is_private": false, "tags": [], "text": "I filed my previous fix as Bug 714516.", "id": 5948924, "bug_id": 626635}, {"creation_time": "2012-03-01T10:59:42Z", "time": "2012-03-01T10:59:42Z", "text": "Given that the object in question is a union, wouldn't the simplest\n(and most portable) way to force alignment be to add otherwise unused\nmembers of the correct types?\n\nie end up generating something like this:\n\n    union Value {\n        char Vnull_t[sizeof(null_t)];\n        char VThebesLayerAttributes[sizeof(ThebesLayerAttributes)];\n        char VContainerLayerAttributes[sizeof(ContainerLayerAttributes)];\n        char VColorLayerAttributes[sizeof(ColorLayerAttributes)];\n        char VCanvasLayerAttributes[sizeof(CanvasLayerAttributes)];\n        char VImageLayerAttributes[sizeof(ImageLayerAttributes)];\n\n        VThebesLayerAttributes align_ThebesLayerAttributes;\n        VContainerLayerAttributes align_VContainerLayerAttributes;\n        VColorLayerAttributes align_VColorLayerAttributes;\n        VCanvasLayerAttributes align_VCanvasLayerAttributes;\n        VImageLayerAttributes align_VImageLayerAttributes;\n    };\n\n[not tested]\n\nwhich will ensure the minimum alignment necessary but no further, and avoids gcc specific extensions.", "bug_id": 626635, "creator": "nick@ccl4.org", "raw_text": "Given that the object in question is a union, wouldn't the simplest\n(and most portable) way to force alignment be to add otherwise unused\nmembers of the correct types?\n\nie end up generating something like this:\n\n    union Value {\n        char Vnull_t[sizeof(null_t)];\n        char VThebesLayerAttributes[sizeof(ThebesLayerAttributes)];\n        char VContainerLayerAttributes[sizeof(ContainerLayerAttributes)];\n        char VColorLayerAttributes[sizeof(ColorLayerAttributes)];\n        char VCanvasLayerAttributes[sizeof(CanvasLayerAttributes)];\n        char VImageLayerAttributes[sizeof(ImageLayerAttributes)];\n\n        VThebesLayerAttributes align_ThebesLayerAttributes;\n        VContainerLayerAttributes align_VContainerLayerAttributes;\n        VColorLayerAttributes align_VColorLayerAttributes;\n        VCanvasLayerAttributes align_VCanvasLayerAttributes;\n        VImageLayerAttributes align_VImageLayerAttributes;\n    };\n\n[not tested]\n\nwhich will ensure the minimum alignment necessary but no further, and avoids gcc specific extensions.", "attachment_id": null, "is_private": false, "tags": [], "id": 6105431, "author": "nick@ccl4.org", "count": 18}]}}}