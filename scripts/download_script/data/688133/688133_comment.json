{"comments": {}, "bugs": {"688133": {"comments": [{"author": "ronen.zilberman@gmail.com", "creator": "ronen.zilberman@gmail.com", "raw_text": "User Agent: Mozilla/5.0 (Windows NT 5.1; rv:6.0.2) Gecko/20100101 Firefox/6.0.2\nBuild ID: 20110902133214\n\nSteps to reproduce:\n\nThere seems to be erroneous calls to the onStateChange ProgressListener, atleast with regards to the documentation here: https://developer.mozilla.org/en/nsIWebProgressListener\n\nI installed a progress listener like this:\ngBrowser.addTabsProgressListener(progressListener);      \n\nand the onstate function code is:\n  onStateChange: function(aBrowser, aWebProgress, aRequest, aFlag, aStatus) {\n\tvar url = null;\n\tif (aRequest && aRequest.URI) url = aRequest.URI.spec;\n        var flags = ... string representation of aFlag...;\n        dump(\"state change: (\" + aFlag.toString(16) + \"=\"  + flags +\") url = \" + url);\t\n   }\n\n\nI encounter a URL that behaves strangely but (not intense) debugging didn't pinpoint the exact culprit, as other websites behave normally.\n\n------\n\nAnother issue is that for some reason the calling log changes when I use the Fiddler web proxy. (http://www.fiddler2.com/). As you can imagine, this was quite tricky as I use it as a debug tool. I can't imagine how or why it would cause a change in firefox internal behavior. \n\n----------\nAll the bevaiours are consistant and repeatable.\nUA string: User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:6.0.2) Gecko/20100101 Firefox/6.0.2\n\n\n\nActual results:\n\nURL: http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\n(no fiddler)\n\n----- START LOG\n1 state change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\n2 state change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\n3 state change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\n4 state change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.facebook.com/plugins/like.php?api_key=89186614300&channel_url=http%3A%2F%2Fstatic.ak.fbcdn.net%2Fconnect%2Fxd_proxy.php%3Fversion%3D3%23cb%3Df7d2ff873ddf4c%26origin%3Dhttp%253A%252F%252Fwww.etsy.com%252Ff32c571a0947f82%26relation%3Dparent.parent%26transport%3Dpostmessage&extended_social_context=false&href=http%253A%252F%252Fwww.etsy.com%252Fshop%252Fjessjamesjake&layout=button_count&locale=en_US&node_type=link&sdk=joey&show_faces=false&width=90\n5 state change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\n6 state change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.facebook.com/plugins/like.php?api_key=89186614300&channel_url=http%3A%2F%2Fstatic.ak.fbcdn.net%2Fconnect%2Fxd_proxy.php%3Fversion%3D3%23cb%3Df7d2ff873ddf4c%26origin%3Dhttp%253A%252F%252Fwww.etsy.com%252Ff32c571a0947f82%26relation%3Dparent.parent%26transport%3Dpostmessage&extended_social_context=false&href=http%253A%252F%252Fwww.etsy.com%252Fshop%252Fjessjamesjake&layout=button_count&locale=en_US&node_type=link&sdk=joey&show_faces=false&width=90\n7 state change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\n8 state change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\n9 state change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://static.ak.fbcdn.net/connect/xd_proxy.php?version=3#cb=f7d2ff873ddf4c&origin=http%3A%2F%2Fwww.etsy.com%2Ff32c571a0947f82&relation=parent.parent&transport=postmessage&type=resize&height=20&ackData[id]=1&width=90\n10 state change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://static.ak.fbcdn.net/connect/xd_proxy.php?version=3#cb=f7d2ff873ddf4c&origin=http%3A%2F%2Fwww.etsy.com%2Ff32c571a0947f82&relation=parent.parent&transport=postmessage&type=resize&height=20&ackData[id]=1&width=90\n11 state change: (10010=STATE_STOP STATE_IS_REQUEST ) url = null\n12 state change: (10010=STATE_STOP STATE_IS_REQUEST ) url = null\n\nEND LOG\n\nThere are many things wrong here:\n- calls to about:blank\n- some internal (iframe/ajax) calls seen as document calls\n-----------------------------------------------------------\n\n----- START LOG\nURL: http://www.x.com\n(WITH fiddler)\n\nstate change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = https://www.x.com/\nstate change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = https://www.x.com/\n\n---- END LOG\n\nThis is just any random website.\nHere you can see that the last call (STATE_IS_REQUEST) is missing.\n-----------------------------------------------\n\nURL: http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\n(WITH fiddler)\n\n----- START LOG\nstate change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\nstate change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\nstate change: (10010=STATE_STOP STATE_IS_REQUEST ) url = http://static.ak.fbcdn.net/rsrc.php/v1/yN/r/l2tJ1_sR57H.css\nstate change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\nstate change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\nstate change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://static.ak.fbcdn.net/connect/xd_proxy.php?version=3#cb=f8535fc2346b68&origin=http%3A%2F%2Fwww.etsy.com%2Ff1679af3b32ac66&relation=parent.parent&transport=postmessage&type=resize&height=20&ackData[id]=1&width=90\nstate change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://static.ak.fbcdn.net/connect/xd_proxy.php?version=3#cb=f8535fc2346b68&origin=http%3A%2F%2Fwww.etsy.com%2Ff1679af3b32ac66&relation=parent.parent&transport=postmessage&type=resize&height=20&ackData[id]=1&width=90\nstate change: (10010=STATE_STOP STATE_IS_REQUEST ) url = null\nstate change: (10010=STATE_STOP STATE_IS_REQUEST ) url = null\n\n--- END LOG\n\nThe behavior changes. Can't make sense of how.\n------------------------------------------------------------------------\n\n\n\n\n\n\n\nExpected results:\n\nHere is a call log for x.com with no fiddler (i.e normal behaviour)\n\n---- START LOG\nstate change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.x.com/\nstate change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = https://www.x.com/\nstate change: (10010=STATE_STOP STATE_IS_REQUEST ) url = null\n---- END LOG\n\n\nEven here there are some errors with regards to the documentation:\n1. The order of the STATE_STOP calls are reversed.\n2. the call that has STATE_IS_REQUEST does not have STATE_IS_DOCUMENT.\n\n\n\npart of from said documention:\n\"when a document request completes, two onStateChange() calls with STATE_STOP are generated. The document request is passed as aRequest to both calls. The first has STATE_IS_REQUEST and STATE_IS_DOCUMENT set, and the second has the STATE_IS_WINDOW flag set (and possibly the STATE_IS_NETWORK flag set as well -- see above for a description of when the STATE_IS_NETWORK flag may be set). This second STATE_STOP event may be useful as a way to partition the work that occurs when a document request completes.\n\"", "creation_time": "2011-09-21T12:20:19Z", "attachment_id": null, "time": "2011-09-21T12:20:19Z", "text": "User Agent: Mozilla/5.0 (Windows NT 5.1; rv:6.0.2) Gecko/20100101 Firefox/6.0.2\nBuild ID: 20110902133214\n\nSteps to reproduce:\n\nThere seems to be erroneous calls to the onStateChange ProgressListener, atleast with regards to the documentation here: https://developer.mozilla.org/en/nsIWebProgressListener\n\nI installed a progress listener like this:\ngBrowser.addTabsProgressListener(progressListener);      \n\nand the onstate function code is:\n  onStateChange: function(aBrowser, aWebProgress, aRequest, aFlag, aStatus) {\n\tvar url = null;\n\tif (aRequest && aRequest.URI) url = aRequest.URI.spec;\n        var flags = ... string representation of aFlag...;\n        dump(\"state change: (\" + aFlag.toString(16) + \"=\"  + flags +\") url = \" + url);\t\n   }\n\n\nI encounter a URL that behaves strangely but (not intense) debugging didn't pinpoint the exact culprit, as other websites behave normally.\n\n------\n\nAnother issue is that for some reason the calling log changes when I use the Fiddler web proxy. (http://www.fiddler2.com/). As you can imagine, this was quite tricky as I use it as a debug tool. I can't imagine how or why it would cause a change in firefox internal behavior. \n\n----------\nAll the bevaiours are consistant and repeatable.\nUA string: User-Agent: Mozilla/5.0 (Windows NT 5.1; rv:6.0.2) Gecko/20100101 Firefox/6.0.2\n\n\n\nActual results:\n\nURL: http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\n(no fiddler)\n\n----- START LOG\n1 state change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\n2 state change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\n3 state change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\n4 state change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.facebook.com/plugins/like.php?api_key=89186614300&channel_url=http%3A%2F%2Fstatic.ak.fbcdn.net%2Fconnect%2Fxd_proxy.php%3Fversion%3D3%23cb%3Df7d2ff873ddf4c%26origin%3Dhttp%253A%252F%252Fwww.etsy.com%252Ff32c571a0947f82%26relation%3Dparent.parent%26transport%3Dpostmessage&extended_social_context=false&href=http%253A%252F%252Fwww.etsy.com%252Fshop%252Fjessjamesjake&layout=button_count&locale=en_US&node_type=link&sdk=joey&show_faces=false&width=90\n5 state change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\n6 state change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.facebook.com/plugins/like.php?api_key=89186614300&channel_url=http%3A%2F%2Fstatic.ak.fbcdn.net%2Fconnect%2Fxd_proxy.php%3Fversion%3D3%23cb%3Df7d2ff873ddf4c%26origin%3Dhttp%253A%252F%252Fwww.etsy.com%252Ff32c571a0947f82%26relation%3Dparent.parent%26transport%3Dpostmessage&extended_social_context=false&href=http%253A%252F%252Fwww.etsy.com%252Fshop%252Fjessjamesjake&layout=button_count&locale=en_US&node_type=link&sdk=joey&show_faces=false&width=90\n7 state change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\n8 state change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\n9 state change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://static.ak.fbcdn.net/connect/xd_proxy.php?version=3#cb=f7d2ff873ddf4c&origin=http%3A%2F%2Fwww.etsy.com%2Ff32c571a0947f82&relation=parent.parent&transport=postmessage&type=resize&height=20&ackData[id]=1&width=90\n10 state change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://static.ak.fbcdn.net/connect/xd_proxy.php?version=3#cb=f7d2ff873ddf4c&origin=http%3A%2F%2Fwww.etsy.com%2Ff32c571a0947f82&relation=parent.parent&transport=postmessage&type=resize&height=20&ackData[id]=1&width=90\n11 state change: (10010=STATE_STOP STATE_IS_REQUEST ) url = null\n12 state change: (10010=STATE_STOP STATE_IS_REQUEST ) url = null\n\nEND LOG\n\nThere are many things wrong here:\n- calls to about:blank\n- some internal (iframe/ajax) calls seen as document calls\n-----------------------------------------------------------\n\n----- START LOG\nURL: http://www.x.com\n(WITH fiddler)\n\nstate change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = https://www.x.com/\nstate change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = https://www.x.com/\n\n---- END LOG\n\nThis is just any random website.\nHere you can see that the last call (STATE_IS_REQUEST) is missing.\n-----------------------------------------------\n\nURL: http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\n(WITH fiddler)\n\n----- START LOG\nstate change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\nstate change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.etsy.com/shop/jessjamesjake?ref=fp_treasury_12\nstate change: (10010=STATE_STOP STATE_IS_REQUEST ) url = http://static.ak.fbcdn.net/rsrc.php/v1/yN/r/l2tJ1_sR57H.css\nstate change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\nstate change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = about:blank\nstate change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://static.ak.fbcdn.net/connect/xd_proxy.php?version=3#cb=f8535fc2346b68&origin=http%3A%2F%2Fwww.etsy.com%2Ff1679af3b32ac66&relation=parent.parent&transport=postmessage&type=resize&height=20&ackData[id]=1&width=90\nstate change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://static.ak.fbcdn.net/connect/xd_proxy.php?version=3#cb=f8535fc2346b68&origin=http%3A%2F%2Fwww.etsy.com%2Ff1679af3b32ac66&relation=parent.parent&transport=postmessage&type=resize&height=20&ackData[id]=1&width=90\nstate change: (10010=STATE_STOP STATE_IS_REQUEST ) url = null\nstate change: (10010=STATE_STOP STATE_IS_REQUEST ) url = null\n\n--- END LOG\n\nThe behavior changes. Can't make sense of how.\n------------------------------------------------------------------------\n\n\n\n\n\n\n\nExpected results:\n\nHere is a call log for x.com with no fiddler (i.e normal behaviour)\n\n---- START LOG\nstate change: (f0001=STATE_START STATE_IS_REQUEST STATE_IS_DOCUMENT STATE_IS_NETWORK STATE_IS_WINDOW ) url = http://www.x.com/\nstate change: (c0010=STATE_STOP STATE_IS_NETWORK STATE_IS_WINDOW ) url = https://www.x.com/\nstate change: (10010=STATE_STOP STATE_IS_REQUEST ) url = null\n---- END LOG\n\n\nEven here there are some errors with regards to the documentation:\n1. The order of the STATE_STOP calls are reversed.\n2. the call that has STATE_IS_REQUEST does not have STATE_IS_DOCUMENT.\n\n\n\npart of from said documention:\n\"when a document request completes, two onStateChange() calls with STATE_STOP are generated. The document request is passed as aRequest to both calls. The first has STATE_IS_REQUEST and STATE_IS_DOCUMENT set, and the second has the STATE_IS_WINDOW flag set (and possibly the STATE_IS_NETWORK flag set as well -- see above for a description of when the STATE_IS_NETWORK flag may be set). This second STATE_STOP event may be useful as a way to partition the work that occurs when a document request completes.\n\"", "id": 5727910, "count": 0, "is_private": false, "tags": [], "bug_id": 688133}, {"bug_id": 688133, "id": 5727939, "count": 1, "is_private": false, "tags": [], "time": "2011-09-21T12:48:36Z", "attachment_id": null, "text": "The additional calls are for iframe start and stop. However other pages with iframes do not show this behaviour.\nAlso the STATE_STOP + STATE_IS_REQUEST is called twice, with a NULL aRequest.URI.", "raw_text": "The additional calls are for iframe start and stop. However other pages with iframes do not show this behaviour.\nAlso the STATE_STOP + STATE_IS_REQUEST is called twice, with a NULL aRequest.URI.", "creation_time": "2011-09-21T12:48:36Z", "author": "ronen.zilberman@gmail.com", "creator": "ronen.zilberman@gmail.com"}, {"creator": "torisugari@gmail.com", "author": "torisugari@gmail.com", "tags": [], "count": 2, "is_private": false, "id": 5828230, "bug_id": 688133, "creation_time": "2011-11-05T08:51:14Z", "raw_text": "Would you test your progress listener with <browser/> instead of <tabbrowser/>? We are filtering out some onStateChange calls for <tabbrowser/>, if the total number of requests are more than 1.", "text": "Would you test your progress listener with <browser/> instead of <tabbrowser/>? We are filtering out some onStateChange calls for <tabbrowser/>, if the total number of requests are more than 1.", "time": "2011-11-05T08:51:14Z", "attachment_id": null}]}}}