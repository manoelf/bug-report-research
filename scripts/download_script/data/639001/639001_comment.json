{"bugs": {"639001": {"comments": [{"count": 0, "text": "At the moment, we choose which debug hook function to call when an event occurs in a JS debuggee by consulting a 'JSDebugHooks *' in the current context. I would like to move this pointer to the JSCompartment. That is, hook references that now look like cx->debugHooks->mumbleHook would become cx->compartment->debugHooks->mumbleHook.\n\nWhy? Compartments are a natural choice for the extent of a JavaScript debuggee. In content, they correspond to origins. They also work nicely for debugger/debuggee separation, as the wrapper logic can enforce restrictions on how debugger and debuggee objects refer to each other. Contexts don't work so well, since they're invisible at the JavaScript level. Runtimes are too broad; we want to be able to establish hooks for the debuggee without any risk of the debugger's own code triggering them.\n\nThis change shouldn't affect jsd, since that ignores the JSContext's JSDebugHooks pointer and manipulates only the JSRuntime's hook functions. As far as I can tell, Firefox does not use the per-context pointers either, beyond calling JS_ClearContextDebugHooks to avoid dragging Firebug into worker thread activities.", "author": "jimb@mozilla.com", "creator": "jimb@mozilla.com", "attachment_id": null, "time": "2011-03-05T01:38:55Z", "id": 5323281, "raw_text": "At the moment, we choose which debug hook function to call when an event occurs in a JS debuggee by consulting a 'JSDebugHooks *' in the current context. I would like to move this pointer to the JSCompartment. That is, hook references that now look like cx->debugHooks->mumbleHook would become cx->compartment->debugHooks->mumbleHook.\n\nWhy? Compartments are a natural choice for the extent of a JavaScript debuggee. In content, they correspond to origins. They also work nicely for debugger/debuggee separation, as the wrapper logic can enforce restrictions on how debugger and debuggee objects refer to each other. Contexts don't work so well, since they're invisible at the JavaScript level. Runtimes are too broad; we want to be able to establish hooks for the debuggee without any risk of the debugger's own code triggering them.\n\nThis change shouldn't affect jsd, since that ignores the JSContext's JSDebugHooks pointer and manipulates only the JSRuntime's hook functions. As far as I can tell, Firefox does not use the per-context pointers either, beyond calling JS_ClearContextDebugHooks to avoid dragging Firebug into worker thread activities.", "creation_time": "2011-03-05T01:38:55Z", "bug_id": 639001, "tags": [], "is_private": false}]}}, "comments": {}}