{"bugs": {"685740": {"comments": [{"id": 5709550, "count": 0, "is_private": false, "creation_time": "2011-09-08T23:47:28Z", "time": "2011-09-08T23:47:28Z", "creator": "honzab.moz@firemni.cz", "author": "honzab.moz@firemni.cz", "attachment_id": null, "raw_text": "A common page, running locally on my testing server, no favicon.ico file in the root, server IIS 7.5.\n\nI can see 4 requests in the log for GET /favicon.ico with following Accept header values:\n1. Accept: image/png,image/*;q=0.8,*/*;q=0.5\n2. Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n3. Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n4. Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n\nOther common headers unmodified between requests.\n\n\nAll 3 responses are 404 Not Found with Cache-Control: private and the IIS \"not found\" error page text/html content.\n\nRequests come from:\n\n\n1.:\n\n \txul.dll!NewImageChannel(nsIChannel * * aResult=0x00339a84, nsIURI * aURI=0x04d36a80, nsIURI * aInitialDocumentURI=0x04f94280, nsIURI * aReferringURI=0x04f94280, nsILoadGroup * aLoadGroup=0x04f94dc8, const nsCString & aAcceptHeader={...}, unsigned int aLoadFlags=5120, nsIChannelPolicy * aPolicy=0x00000000)  Line 525 + 0x22 bytes\t\n \txul.dll!imgLoader::LoadImage(nsIURI * aURI=0x04d36a80, nsIURI * aInitialDocumentURI=0x04f94280, nsIURI * aReferrerURI=0x04f94280, nsIPrincipal * aLoadingPrincipal=0x03816bb8, nsILoadGroup * aLoadGroup=0x04f94dc8, imgIDecoderObserver * aObserver=0x0667e0d0, nsISupports * aCX=0x050b6f28, unsigned int aLoadFlags=5120, nsISupports * aCacheKey=0x00000000, imgIRequest * aRequest=0x00000000, nsIChannelPolicy * aPolicy=0x00000000, imgIRequest * * _retval=0x06793dd8)  Line 1692 + 0x42 bytes\t\n \txul.dll!nsContentUtils::LoadImage(nsIURI * aURI=0x04d36a80, nsIDocument * aLoadingDocument=0x050b6f28, nsIPrincipal * aLoadingPrincipal=0x03816bb8, nsIURI * aReferrer=0x04f94280, imgIDecoderObserver * aObserver=0x0667e0d0, int aLoadFlags=5120, imgIRequest * * aRequest=0x06793dd8)  Line 2352 + 0x44 bytes\t\n \txul.dll!nsImageBoxFrame::UpdateImage()  Line 266 + 0x6d bytes\t\n \txul.dll!nsImageBoxFrame::AttributeChanged(int aNameSpaceID=0, nsIAtom * aAttribute=0x0379e2e8, int aModType=2)  Line 170\t\n \txul.dll!nsCSSFrameConstructor::AttributeChanged(mozilla::dom::Element * aElement=0x063dc9e8, int aNameSpaceID=0, nsIAtom * aAttribute=0x0379e2e8, int aModType=2)  Line 8225\t\n \txul.dll!PresShell::AttributeChanged(nsIDocument * aDocument=0x050b6f28, mozilla::dom::Element * aElement=0x063dc9e8, int aNameSpaceID=0, nsIAtom * aAttribute=0x0379e2e8, int aModType=2)  Line 5002\t\n \txul.dll!nsNodeUtils::AttributeChanged(mozilla::dom::Element * aElement=0x063dc9e8, int aNameSpaceID=0, nsIAtom * aAttribute=0x0379e2e8, int aModType=2)  Line 136 + 0xd0 bytes\t\n \txul.dll!nsGenericElement::SetAttrAndNotify(int aNamespaceID=0, nsIAtom * aName=0x0379e2e8, nsIAtom * aPrefix=0x00000000, const nsAString_internal & aOldValue={...}, nsAttrValue & aParsedValue={...}, unsigned char aModType='\u0002', int aFireMutation=0, int aNotify=1, const nsAString_internal * aValueForAfterSetAttr=0x0033a088)  Line 4640 + 0x19 bytes\t\n \txul.dll!nsGenericElement::SetAttr(int aNamespaceID=0, nsIAtom * aName=0x0379e2e8, nsIAtom * aPrefix=0x00000000, const nsAString_internal & aValue={...}, int aNotify=1)  Line 4547 + 0x39 bytes\t\n \txul.dll!nsGenericElement::SetAttr(int aNameSpaceID=0, nsIAtom * aName=0x0379e2e8, const nsAString_internal & aValue={...}, int aNotify=1)  Line 282\t\n \txul.dll!nsGenericElement::SetAttribute(const nsAString_internal & aName={...}, const nsAString_internal & aValue={...})  Line 2541 + 0x19 bytes\t\n \txul.dll!nsXULElement::SetAttribute(const nsAString_internal & name={...}, const nsAString_internal & value={...})  Line 540 + 0x14 bytes\t\n \txul.dll!nsIDOMElement_SetAttribute(JSContext * cx=0x04f987e8, unsigned int argc=2, jsval_layout * vp=0x04650318)  Line 5708 + 0x23 bytes\t\n0 PageProxySetIcon(aURL = \"http://test.local.i7/favicon.ico\") [\"chrome://browser/content/browser.js\":8384]\n    this = [object ChromeWindow @ 0x4ea01e0 (native @ 0x4e86b90)]\n1 anonymous(aIconURL = \"http://test.local.i7/favicon.ico\") [\"chrome://browser/content/browser.js\":10014]\n    this = [object Object]\n2 anonymous(p = [object Object], 0, [object Object]) [\"chrome://browser/content/tabbrowser.xml\":410]\n    this = [object ChromeWindow @ 0x4ea01e0 (native @ 0x4e86b90)]\n3 _callProgressListeners(aCallTabsListeners = undefined, aCallGlobalListeners = undefined, aArguments = http://test.local.i7/favicon.ico, aMethod = \"onLink\nIconAvailable\", aBrowser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]) [\"chrome://browser/content/tabbrowser.xml\":407]\n    rv = true\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n4 setIcon(aURI = [xpconnect wrapped nsIURI @ 0x8675d68 (native @ 0x8675bb4)], aTab = [object XULElement @ 0x5cd7298 (native @ 0x5d00420)]) [\"chrome://brows\ner/content/tabbrowser.xml\":698]\n    browser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n5 useDefaultIcon(aTab = [object XULElement @ 0x5cd7298 (native @ 0x5d00420)]) [\"chrome://browser/content/tabbrowser.xml\":752]\n    icon = \"http://test.local.i7/favicon.ico\"\n    docURIObject = [xpconnect wrapped nsIURI @ 0x86755b8 (native @ 0x882e3ec)]\n    browser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n6 anonymous(aStatus = 0, aStateFlags = 786448, aRequest = [xpconnect wrapped (nsISupports, nsIRequest, nsIChannel) @ 0x4b82e38 (native @ 0x4b81a70)], aWebP\nrogress = [xpconnect wrapped (nsISupports, nsIDocShell, nsIInterfaceRequestor, nsIWebProgress, nsIWebNavigation, nsIDocShellHistory, nsIDocumentLoader) @ 0\nx84fd8d0 (native @ 0x8437bc4)]) [\"chrome://browser/content/tabbrowser.xml\":556]\n    location = undefined\n    NS_ERROR_UNKNOWN_HOST = 2152398878\n    nsIChannel = nsIChannel\n    nsIWebProgressListener = nsIWebProgressListener\n    oldBlank = false\n    this = [object Object]\n\n\n\n2.:\n \txul.dll!mozilla::places::AsyncFetchAndSetIconFromNetwork::Run()  Line 602 + 0x35 bytes\t\n\n\n\n3.:\n0 _imageFromURI(callback = [function], uri = [xpconnect wrapped nsIURI @ 0x8b60978 (native @ 0x853d22c)]) [\"resource://gre/modules/WindowsPreviewPerTab.jsm\n\":109]\n    channel = undefined\n    this = [object BackstagePass @ 0x8b378a8 (native @ 0x3adeafc)]\n1 getFaviconAsImage(callback = [function], iconurl = \"http://test.local.i7/favicon.ico\") [\"resource://gre/modules/WindowsPreviewPerTab.jsm\":130]\n    this = [object BackstagePass @ 0x8b378a8 (native @ 0x3adeafc)]\n2 anonymous(aIconURL = \"http://test.local.i7/favicon.ico\", aBrowser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]) [\"resource://gre/modules/Window\nsPreviewPerTab.jsm\":571]\n    self = [object Object]\n    this = [object Object]\n3 anonymous(p = [object Object], 1, [object Object],[object Object]) [\"chrome://browser/content/tabbrowser.xml\":426]\n    this = [object ChromeWindow @ 0x4ea01e0 (native @ 0x4e86b90)]\n4 _callProgressListeners(aCallTabsListeners = undefined, aCallGlobalListeners = undefined, aArguments = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)\n],http://test.local.i7/favicon.ico, aMethod = \"onLinkIconAvailable\", aBrowser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]) [\"chrome://browser/co\nntent/tabbrowser.xml\":423]\n    rv = false\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n5 setIcon(aURI = [xpconnect wrapped nsIURI @ 0x8675d68 (native @ 0x8675bb4)], aTab = [object XULElement @ 0x5cd7298 (native @ 0x5d00420)]) [\"chrome://brows\ner/content/tabbrowser.xml\":698]\n    browser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n6 useDefaultIcon(aTab = [object XULElement @ 0x5cd7298 (native @ 0x5d00420)]) [\"chrome://browser/content/tabbrowser.xml\":752]\n    icon = \"http://test.local.i7/favicon.ico\"\n    docURIObject = [xpconnect wrapped nsIURI @ 0x86755b8 (native @ 0x882e3ec)]\n    browser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n7 anonymous(aStatus = 0, aStateFlags = 786448, aRequest = [xpconnect wrapped (nsISupports, nsIRequest, nsIChannel) @ 0x4b82e38 (native @ 0x4b81a70)], aWebP\nrogress = [xpconnect wrapped (nsISupports, nsIDocShell, nsIInterfaceRequestor, nsIWebProgress, nsIWebNavigation, nsIDocShellHistory, nsIDocumentLoader) @ 0\nx84fd8d0 (native @ 0x8437bc4)]) [\"chrome://browser/content/tabbrowser.xml\":556]\n    location = undefined\n    NS_ERROR_UNKNOWN_HOST = 2152398878\n    nsIChannel = nsIChannel\n    nsIWebProgressListener = nsIWebProgressListener\n    oldBlank = false\n    this = [object Object]\n\n\n\nAnd during debugging I have found another one..\n\n4.:\n \txul.dll!NewImageChannel(nsIChannel * * aResult=0x002bac38, nsIURI * aURI=0x03af8030, nsIURI * aInitialDocumentURI=0x04e782d8, nsIURI * aReferringURI=0x04e782d8, nsILoadGroup * aLoadGroup=0x04e78e20, const nsCString & aAcceptHeader={...}, unsigned int aLoadFlags=5120, nsIChannelPolicy * aPolicy=0x00000000)  Line 525 + 0x22 bytes\t\n \txul.dll!imgLoader::LoadImage(nsIURI * aURI=0x03af8030, nsIURI * aInitialDocumentURI=0x04e782d8, nsIURI * aReferrerURI=0x04e782d8, nsIPrincipal * aLoadingPrincipal=0x03aa63c0, nsILoadGroup * aLoadGroup=0x04e78e20, imgIDecoderObserver * aObserver=0x087b59e8, nsISupports * aCX=0x058cc968, unsigned int aLoadFlags=5120, nsISupports * aCacheKey=0x00000000, imgIRequest * aRequest=0x00000000, nsIChannelPolicy * aPolicy=0x00000000, imgIRequest * * _retval=0x08874710)  Line 1692 + 0x42 bytes\t\n \txul.dll!nsContentUtils::LoadImage(nsIURI * aURI=0x03af8030, nsIDocument * aLoadingDocument=0x058cc968, nsIPrincipal * aLoadingPrincipal=0x03aa63c0, nsIURI * aReferrer=0x04e782d8, imgIDecoderObserver * aObserver=0x087b59e8, int aLoadFlags=5120, imgIRequest * * aRequest=0x08874710)  Line 2352 + 0x44 bytes\t\n \txul.dll!nsImageBoxFrame::UpdateImage()  Line 266 + 0x6d bytes\t\n \txul.dll!nsImageBoxFrame::Init(nsIContent * aContent=0x06004230, nsIFrame * aParent=0x08486d68, nsIFrame * aPrevInFlow=0x00000000)  Line 234\t\n \txul.dll!nsCSSFrameConstructor::InitAndRestoreFrame(const nsFrameConstructorState & aState={...}, nsIContent * aContent=0x06004230, nsIFrame * aParentFrame=0x08486d68, nsIFrame * aPrevInFlow=0x00000000, nsIFrame * aNewFrame=0x088746b8, int aAllowCounters=1)  Line 4499 + 0x1a bytes\t\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x08486d68, nsFrameItems & aFrameItems={...})  Line 3716 + 0x1c bytes\t\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x08486d68, nsFrameItems & aFrameItems={...})  Line 5445 + 0x18 bytes\t\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x08486d68, nsFrameItems & aFrameItems={...})  Line 9456 + 0x18 bytes\t\n \txul.dll!nsCSSFrameConstructor::ContentRangeInserted(nsIContent * aContainer=0x060040a0, nsIContent * aStartChild=0x06004230, nsIContent * aEndChild=0x060042c8, nsILayoutHistoryState * aFrameState=0x05b48440, int aAllowLazyConstruction=0)  Line 7147\t\n \txul.dll!nsCSSFrameConstructor::ContentInserted(nsIContent * aContainer=0x060040a0, nsIContent * aChild=0x06004230, nsILayoutHistoryState * aFrameState=0x05b48440, int aAllowLazyConstruction=0)  Line 6768\t\n \txul.dll!nsCSSFrameConstructor::RecreateFramesForContent(nsIContent * aContent=0x06004230, int aAsyncInsert=0)  Line 9101 + 0x23 bytes\t\n \txul.dll!nsCSSFrameConstructor::ProcessRestyledFrames(nsStyleChangeList & aChangeList={...})  Line 7967\t\n \txul.dll!nsCSSFrameConstructor::RestyleElement(mozilla::dom::Element * aElement=0x058f9ad0, nsIFrame * aPrimaryFrame=0x058dcff0, nsChangeHint aMinHint=0, mozilla::css::RestyleTracker & aRestyleTracker={...}, int aRestyleDescendants=1)  Line 8053\t\n \txul.dll!mozilla::css::RestyleTracker::ProcessOneRestyle(mozilla::dom::Element * aElement=0x058f9ad0, nsRestyleHint aRestyleHint=eRestyle_Subtree, nsChangeHint aChangeHint=0)  Line 157\t\n \txul.dll!mozilla::css::RestyleTracker::ProcessRestyles()  Line 241\t\n \txul.dll!nsCSSFrameConstructor::ProcessPendingRestyles()  Line 11625\t\n \txul.dll!PresShell::FlushPendingNotifications(mozFlushType aType=Flush_InterruptibleLayout)  Line 4821\t\n \txul.dll!PresShell::WillPaint(int aWillSendDidPaint=1)  Line 7645\t\n \txul.dll!nsViewManager::CallWillPaintOnObservers(int aWillSendDidPaint=1)  Line 1582\t\n \txul.dll!nsViewManager::DispatchEvent(nsGUIEvent * aEvent=0x002bc048, nsIView * aView=0x058d9e40, nsEventStatus * aStatus=0x002bbd50)  Line 879\t\n \txul.dll!AttachedHandleEvent(nsGUIEvent * aEvent=0x002bc048)  Line 192\t\n \txul.dll!nsWindow::DispatchEvent(nsGUIEvent * event=0x002bc048, nsEventStatus & aStatus=nsEventStatus_eIgnore)  Line 3577 + 0xc bytes\t\n \txul.dll!nsWindow::DispatchWindowEvent(nsGUIEvent * event=0x002bc048)  Line 3604\t\n \txul.dll!nsWindow::OnPaint(HDC__ * aDC=0x00000000, unsigned int aNestingLevel=0)  Line 250\t\n\n\n\nI would suggest to coalesce the requests to a single one.  All of these are happening in parallel, mostly.  Maybe some special handling of cache entry for this request might be a solution.  Anyway, doing 4 requests for the same thing seems to be crazy.", "text": "A common page, running locally on my testing server, no favicon.ico file in the root, server IIS 7.5.\n\nI can see 4 requests in the log for GET /favicon.ico with following Accept header values:\n1. Accept: image/png,image/*;q=0.8,*/*;q=0.5\n2. Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n3. Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n4. Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n\nOther common headers unmodified between requests.\n\n\nAll 3 responses are 404 Not Found with Cache-Control: private and the IIS \"not found\" error page text/html content.\n\nRequests come from:\n\n\n1.:\n\n \txul.dll!NewImageChannel(nsIChannel * * aResult=0x00339a84, nsIURI * aURI=0x04d36a80, nsIURI * aInitialDocumentURI=0x04f94280, nsIURI * aReferringURI=0x04f94280, nsILoadGroup * aLoadGroup=0x04f94dc8, const nsCString & aAcceptHeader={...}, unsigned int aLoadFlags=5120, nsIChannelPolicy * aPolicy=0x00000000)  Line 525 + 0x22 bytes\t\n \txul.dll!imgLoader::LoadImage(nsIURI * aURI=0x04d36a80, nsIURI * aInitialDocumentURI=0x04f94280, nsIURI * aReferrerURI=0x04f94280, nsIPrincipal * aLoadingPrincipal=0x03816bb8, nsILoadGroup * aLoadGroup=0x04f94dc8, imgIDecoderObserver * aObserver=0x0667e0d0, nsISupports * aCX=0x050b6f28, unsigned int aLoadFlags=5120, nsISupports * aCacheKey=0x00000000, imgIRequest * aRequest=0x00000000, nsIChannelPolicy * aPolicy=0x00000000, imgIRequest * * _retval=0x06793dd8)  Line 1692 + 0x42 bytes\t\n \txul.dll!nsContentUtils::LoadImage(nsIURI * aURI=0x04d36a80, nsIDocument * aLoadingDocument=0x050b6f28, nsIPrincipal * aLoadingPrincipal=0x03816bb8, nsIURI * aReferrer=0x04f94280, imgIDecoderObserver * aObserver=0x0667e0d0, int aLoadFlags=5120, imgIRequest * * aRequest=0x06793dd8)  Line 2352 + 0x44 bytes\t\n \txul.dll!nsImageBoxFrame::UpdateImage()  Line 266 + 0x6d bytes\t\n \txul.dll!nsImageBoxFrame::AttributeChanged(int aNameSpaceID=0, nsIAtom * aAttribute=0x0379e2e8, int aModType=2)  Line 170\t\n \txul.dll!nsCSSFrameConstructor::AttributeChanged(mozilla::dom::Element * aElement=0x063dc9e8, int aNameSpaceID=0, nsIAtom * aAttribute=0x0379e2e8, int aModType=2)  Line 8225\t\n \txul.dll!PresShell::AttributeChanged(nsIDocument * aDocument=0x050b6f28, mozilla::dom::Element * aElement=0x063dc9e8, int aNameSpaceID=0, nsIAtom * aAttribute=0x0379e2e8, int aModType=2)  Line 5002\t\n \txul.dll!nsNodeUtils::AttributeChanged(mozilla::dom::Element * aElement=0x063dc9e8, int aNameSpaceID=0, nsIAtom * aAttribute=0x0379e2e8, int aModType=2)  Line 136 + 0xd0 bytes\t\n \txul.dll!nsGenericElement::SetAttrAndNotify(int aNamespaceID=0, nsIAtom * aName=0x0379e2e8, nsIAtom * aPrefix=0x00000000, const nsAString_internal & aOldValue={...}, nsAttrValue & aParsedValue={...}, unsigned char aModType='\u0002', int aFireMutation=0, int aNotify=1, const nsAString_internal * aValueForAfterSetAttr=0x0033a088)  Line 4640 + 0x19 bytes\t\n \txul.dll!nsGenericElement::SetAttr(int aNamespaceID=0, nsIAtom * aName=0x0379e2e8, nsIAtom * aPrefix=0x00000000, const nsAString_internal & aValue={...}, int aNotify=1)  Line 4547 + 0x39 bytes\t\n \txul.dll!nsGenericElement::SetAttr(int aNameSpaceID=0, nsIAtom * aName=0x0379e2e8, const nsAString_internal & aValue={...}, int aNotify=1)  Line 282\t\n \txul.dll!nsGenericElement::SetAttribute(const nsAString_internal & aName={...}, const nsAString_internal & aValue={...})  Line 2541 + 0x19 bytes\t\n \txul.dll!nsXULElement::SetAttribute(const nsAString_internal & name={...}, const nsAString_internal & value={...})  Line 540 + 0x14 bytes\t\n \txul.dll!nsIDOMElement_SetAttribute(JSContext * cx=0x04f987e8, unsigned int argc=2, jsval_layout * vp=0x04650318)  Line 5708 + 0x23 bytes\t\n0 PageProxySetIcon(aURL = \"http://test.local.i7/favicon.ico\") [\"chrome://browser/content/browser.js\":8384]\n    this = [object ChromeWindow @ 0x4ea01e0 (native @ 0x4e86b90)]\n1 anonymous(aIconURL = \"http://test.local.i7/favicon.ico\") [\"chrome://browser/content/browser.js\":10014]\n    this = [object Object]\n2 anonymous(p = [object Object], 0, [object Object]) [\"chrome://browser/content/tabbrowser.xml\":410]\n    this = [object ChromeWindow @ 0x4ea01e0 (native @ 0x4e86b90)]\n3 _callProgressListeners(aCallTabsListeners = undefined, aCallGlobalListeners = undefined, aArguments = http://test.local.i7/favicon.ico, aMethod = \"onLink\nIconAvailable\", aBrowser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]) [\"chrome://browser/content/tabbrowser.xml\":407]\n    rv = true\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n4 setIcon(aURI = [xpconnect wrapped nsIURI @ 0x8675d68 (native @ 0x8675bb4)], aTab = [object XULElement @ 0x5cd7298 (native @ 0x5d00420)]) [\"chrome://brows\ner/content/tabbrowser.xml\":698]\n    browser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n5 useDefaultIcon(aTab = [object XULElement @ 0x5cd7298 (native @ 0x5d00420)]) [\"chrome://browser/content/tabbrowser.xml\":752]\n    icon = \"http://test.local.i7/favicon.ico\"\n    docURIObject = [xpconnect wrapped nsIURI @ 0x86755b8 (native @ 0x882e3ec)]\n    browser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n6 anonymous(aStatus = 0, aStateFlags = 786448, aRequest = [xpconnect wrapped (nsISupports, nsIRequest, nsIChannel) @ 0x4b82e38 (native @ 0x4b81a70)], aWebP\nrogress = [xpconnect wrapped (nsISupports, nsIDocShell, nsIInterfaceRequestor, nsIWebProgress, nsIWebNavigation, nsIDocShellHistory, nsIDocumentLoader) @ 0\nx84fd8d0 (native @ 0x8437bc4)]) [\"chrome://browser/content/tabbrowser.xml\":556]\n    location = undefined\n    NS_ERROR_UNKNOWN_HOST = 2152398878\n    nsIChannel = nsIChannel\n    nsIWebProgressListener = nsIWebProgressListener\n    oldBlank = false\n    this = [object Object]\n\n\n\n2.:\n \txul.dll!mozilla::places::AsyncFetchAndSetIconFromNetwork::Run()  Line 602 + 0x35 bytes\t\n\n\n\n3.:\n0 _imageFromURI(callback = [function], uri = [xpconnect wrapped nsIURI @ 0x8b60978 (native @ 0x853d22c)]) [\"resource://gre/modules/WindowsPreviewPerTab.jsm\n\":109]\n    channel = undefined\n    this = [object BackstagePass @ 0x8b378a8 (native @ 0x3adeafc)]\n1 getFaviconAsImage(callback = [function], iconurl = \"http://test.local.i7/favicon.ico\") [\"resource://gre/modules/WindowsPreviewPerTab.jsm\":130]\n    this = [object BackstagePass @ 0x8b378a8 (native @ 0x3adeafc)]\n2 anonymous(aIconURL = \"http://test.local.i7/favicon.ico\", aBrowser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]) [\"resource://gre/modules/Window\nsPreviewPerTab.jsm\":571]\n    self = [object Object]\n    this = [object Object]\n3 anonymous(p = [object Object], 1, [object Object],[object Object]) [\"chrome://browser/content/tabbrowser.xml\":426]\n    this = [object ChromeWindow @ 0x4ea01e0 (native @ 0x4e86b90)]\n4 _callProgressListeners(aCallTabsListeners = undefined, aCallGlobalListeners = undefined, aArguments = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)\n],http://test.local.i7/favicon.ico, aMethod = \"onLinkIconAvailable\", aBrowser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]) [\"chrome://browser/co\nntent/tabbrowser.xml\":423]\n    rv = false\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n5 setIcon(aURI = [xpconnect wrapped nsIURI @ 0x8675d68 (native @ 0x8675bb4)], aTab = [object XULElement @ 0x5cd7298 (native @ 0x5d00420)]) [\"chrome://brows\ner/content/tabbrowser.xml\":698]\n    browser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n6 useDefaultIcon(aTab = [object XULElement @ 0x5cd7298 (native @ 0x5d00420)]) [\"chrome://browser/content/tabbrowser.xml\":752]\n    icon = \"http://test.local.i7/favicon.ico\"\n    docURIObject = [xpconnect wrapped nsIURI @ 0x86755b8 (native @ 0x882e3ec)]\n    browser = [object XULElement @ 0x845fdf8 (native @ 0x84376e8)]\n    this = [object XULElement @ 0x602edc0 (native @ 0x5da0cf8)]\n7 anonymous(aStatus = 0, aStateFlags = 786448, aRequest = [xpconnect wrapped (nsISupports, nsIRequest, nsIChannel) @ 0x4b82e38 (native @ 0x4b81a70)], aWebP\nrogress = [xpconnect wrapped (nsISupports, nsIDocShell, nsIInterfaceRequestor, nsIWebProgress, nsIWebNavigation, nsIDocShellHistory, nsIDocumentLoader) @ 0\nx84fd8d0 (native @ 0x8437bc4)]) [\"chrome://browser/content/tabbrowser.xml\":556]\n    location = undefined\n    NS_ERROR_UNKNOWN_HOST = 2152398878\n    nsIChannel = nsIChannel\n    nsIWebProgressListener = nsIWebProgressListener\n    oldBlank = false\n    this = [object Object]\n\n\n\nAnd during debugging I have found another one..\n\n4.:\n \txul.dll!NewImageChannel(nsIChannel * * aResult=0x002bac38, nsIURI * aURI=0x03af8030, nsIURI * aInitialDocumentURI=0x04e782d8, nsIURI * aReferringURI=0x04e782d8, nsILoadGroup * aLoadGroup=0x04e78e20, const nsCString & aAcceptHeader={...}, unsigned int aLoadFlags=5120, nsIChannelPolicy * aPolicy=0x00000000)  Line 525 + 0x22 bytes\t\n \txul.dll!imgLoader::LoadImage(nsIURI * aURI=0x03af8030, nsIURI * aInitialDocumentURI=0x04e782d8, nsIURI * aReferrerURI=0x04e782d8, nsIPrincipal * aLoadingPrincipal=0x03aa63c0, nsILoadGroup * aLoadGroup=0x04e78e20, imgIDecoderObserver * aObserver=0x087b59e8, nsISupports * aCX=0x058cc968, unsigned int aLoadFlags=5120, nsISupports * aCacheKey=0x00000000, imgIRequest * aRequest=0x00000000, nsIChannelPolicy * aPolicy=0x00000000, imgIRequest * * _retval=0x08874710)  Line 1692 + 0x42 bytes\t\n \txul.dll!nsContentUtils::LoadImage(nsIURI * aURI=0x03af8030, nsIDocument * aLoadingDocument=0x058cc968, nsIPrincipal * aLoadingPrincipal=0x03aa63c0, nsIURI * aReferrer=0x04e782d8, imgIDecoderObserver * aObserver=0x087b59e8, int aLoadFlags=5120, imgIRequest * * aRequest=0x08874710)  Line 2352 + 0x44 bytes\t\n \txul.dll!nsImageBoxFrame::UpdateImage()  Line 266 + 0x6d bytes\t\n \txul.dll!nsImageBoxFrame::Init(nsIContent * aContent=0x06004230, nsIFrame * aParent=0x08486d68, nsIFrame * aPrevInFlow=0x00000000)  Line 234\t\n \txul.dll!nsCSSFrameConstructor::InitAndRestoreFrame(const nsFrameConstructorState & aState={...}, nsIContent * aContent=0x06004230, nsIFrame * aParentFrame=0x08486d68, nsIFrame * aPrevInFlow=0x00000000, nsIFrame * aNewFrame=0x088746b8, int aAllowCounters=1)  Line 4499 + 0x1a bytes\t\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal(nsCSSFrameConstructor::FrameConstructionItem & aItem={...}, nsFrameConstructorState & aState={...}, nsIFrame * aParentFrame=0x08486d68, nsFrameItems & aFrameItems={...})  Line 3716 + 0x1c bytes\t\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList::Iterator & aIter={...}, nsIFrame * aParentFrame=0x08486d68, nsFrameItems & aFrameItems={...})  Line 5445 + 0x18 bytes\t\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList(nsFrameConstructorState & aState={...}, nsCSSFrameConstructor::FrameConstructionItemList & aItems={...}, nsIFrame * aParentFrame=0x08486d68, nsFrameItems & aFrameItems={...})  Line 9456 + 0x18 bytes\t\n \txul.dll!nsCSSFrameConstructor::ContentRangeInserted(nsIContent * aContainer=0x060040a0, nsIContent * aStartChild=0x06004230, nsIContent * aEndChild=0x060042c8, nsILayoutHistoryState * aFrameState=0x05b48440, int aAllowLazyConstruction=0)  Line 7147\t\n \txul.dll!nsCSSFrameConstructor::ContentInserted(nsIContent * aContainer=0x060040a0, nsIContent * aChild=0x06004230, nsILayoutHistoryState * aFrameState=0x05b48440, int aAllowLazyConstruction=0)  Line 6768\t\n \txul.dll!nsCSSFrameConstructor::RecreateFramesForContent(nsIContent * aContent=0x06004230, int aAsyncInsert=0)  Line 9101 + 0x23 bytes\t\n \txul.dll!nsCSSFrameConstructor::ProcessRestyledFrames(nsStyleChangeList & aChangeList={...})  Line 7967\t\n \txul.dll!nsCSSFrameConstructor::RestyleElement(mozilla::dom::Element * aElement=0x058f9ad0, nsIFrame * aPrimaryFrame=0x058dcff0, nsChangeHint aMinHint=0, mozilla::css::RestyleTracker & aRestyleTracker={...}, int aRestyleDescendants=1)  Line 8053\t\n \txul.dll!mozilla::css::RestyleTracker::ProcessOneRestyle(mozilla::dom::Element * aElement=0x058f9ad0, nsRestyleHint aRestyleHint=eRestyle_Subtree, nsChangeHint aChangeHint=0)  Line 157\t\n \txul.dll!mozilla::css::RestyleTracker::ProcessRestyles()  Line 241\t\n \txul.dll!nsCSSFrameConstructor::ProcessPendingRestyles()  Line 11625\t\n \txul.dll!PresShell::FlushPendingNotifications(mozFlushType aType=Flush_InterruptibleLayout)  Line 4821\t\n \txul.dll!PresShell::WillPaint(int aWillSendDidPaint=1)  Line 7645\t\n \txul.dll!nsViewManager::CallWillPaintOnObservers(int aWillSendDidPaint=1)  Line 1582\t\n \txul.dll!nsViewManager::DispatchEvent(nsGUIEvent * aEvent=0x002bc048, nsIView * aView=0x058d9e40, nsEventStatus * aStatus=0x002bbd50)  Line 879\t\n \txul.dll!AttachedHandleEvent(nsGUIEvent * aEvent=0x002bc048)  Line 192\t\n \txul.dll!nsWindow::DispatchEvent(nsGUIEvent * event=0x002bc048, nsEventStatus & aStatus=nsEventStatus_eIgnore)  Line 3577 + 0xc bytes\t\n \txul.dll!nsWindow::DispatchWindowEvent(nsGUIEvent * event=0x002bc048)  Line 3604\t\n \txul.dll!nsWindow::OnPaint(HDC__ * aDC=0x00000000, unsigned int aNestingLevel=0)  Line 250\t\n\n\n\nI would suggest to coalesce the requests to a single one.  All of these are happening in parallel, mostly.  Maybe some special handling of cache entry for this request might be a solution.  Anyway, doing 4 requests for the same thing seems to be crazy.", "bug_id": 685740, "tags": []}, {"author": "bzbarsky@mit.edu", "creation_time": "2011-10-27T06:07:12Z", "time": "2011-10-27T06:07:12Z", "creator": "bzbarsky@mit.edu", "id": 5808313, "count": 1, "is_private": false, "tags": [], "text": "Isn't the solution to cache error responses in the image cache?  We have an existing bug on that...", "bug_id": 685740, "raw_text": "Isn't the solution to cache error responses in the image cache?  We have an existing bug on that...", "attachment_id": null}, {"author": "mak@mozilla.com", "creation_time": "2017-04-06T07:33:14Z", "time": "2017-04-06T07:33:14Z", "creator": "mak@mozilla.com", "id": 12210986, "count": 2, "is_private": false, "bug_id": 685740, "text": "1. is probably the tab icon\n2. the mozilla::places load is to store the favicon in the favicons service cache, from there it will be reused for various UI pieces (history menu and views, bookmarks menu and views, newtab/AS, ...) and retained for 7 days before a new reload.\n3. looks like Windows taskbar previews\n\nThe image cache should indeed serve the same image to all UI consumers, but some of these consumers are likely fetching the image url directly from the network and then the image cache doesn't help.\n\nWe could either pass an already loaded payload to the favicons service to save one load, or use the favicons service protocols (moz-anno:favicon: or page-icon:) more broadly (both for the tab and for Windows previews). The problem there is that the favicons service doesn't store icons in PB mode, so we would either need to create a temp store for PB mode, or make the above protocols fall-through to network when there's no locally cached icon, but that has security implications that go over my knowledge (I'd be happy to cooperate on figuring those out).\n\nAlso note it's likely in the future the favicons service will fetch more than a single icon per page, many pages are indeed providing multiple icons at different sizes, and we're working to support hi dpi and bigger favicons in the UI. So we could start fetching some more icons from each page (when they are not cached yet). I'm happy to hear suggestions on how we could make that less painful.", "tags": [], "raw_text": "1. is probably the tab icon\n2. the mozilla::places load is to store the favicon in the favicons service cache, from there it will be reused for various UI pieces (history menu and views, bookmarks menu and views, newtab/AS, ...) and retained for 7 days before a new reload.\n3. looks like Windows taskbar previews\n\nThe image cache should indeed serve the same image to all UI consumers, but some of these consumers are likely fetching the image url directly from the network and then the image cache doesn't help.\n\nWe could either pass an already loaded payload to the favicons service to save one load, or use the favicons service protocols (moz-anno:favicon: or page-icon:) more broadly (both for the tab and for Windows previews). The problem there is that the favicons service doesn't store icons in PB mode, so we would either need to create a temp store for PB mode, or make the above protocols fall-through to network when there's no locally cached icon, but that has security implications that go over my knowledge (I'd be happy to cooperate on figuring those out).\n\nAlso note it's likely in the future the favicons service will fetch more than a single icon per page, many pages are indeed providing multiple icons at different sizes, and we're working to support hi dpi and bigger favicons in the UI. So we could start fetching some more icons from each page (when they are not cached yet). I'm happy to hear suggestions on how we could make that less painful.", "attachment_id": null}, {"is_private": false, "id": 12219252, "count": 3, "creator": "honzab.moz@firemni.cz", "time": "2017-04-09T15:07:40Z", "creation_time": "2017-04-09T15:07:40Z", "author": "honzab.moz@firemni.cz", "attachment_id": null, "raw_text": "This has reduced to only 2 requests:\n\n>\txul.dll!mozilla::net::nsHttpChannel::AsyncOpen(0x28467f80, 0x00000000) Line 5777\tC++\n \txul.dll!mozilla::net::nsHttpChannel::AsyncOpen2(0x28467f80) Line 5971\tC++\n \txul.dll!imgLoader::LoadImage(0x28248c80, 0x228e2a00, 0x228e2a00, RP_Unset, 0x285af6a0, 0x22b26ec0, 0x1e253160, 0x24ed39c0, 0x1d78d000, 5120, 0x00000000, 41, {...}, 0x282a2178) Line 2246\tC++\n \txul.dll!nsContentUtils::LoadImage(0x28248c80, 0x24ed39c0, 0x1d78d000, 0x285af6a0, 0x228e2a00, RP_Unset, 0x1e253160, 5120, {...}, 0x282a2178, 41) Line 3435\tC++\n \txul.dll!nsImageBoxFrame::UpdateImage() Line 247\tC++\n \txul.dll!nsImageBoxFrame::Init(0x24ed39c0, 0x2511d738, 0x00000000) Line 211\tC++\n \txul.dll!nsCSSFrameConstructor::InitAndRestoreFrame({...}, 0x24ed39c0, 0x2511d738, 0x282a2120, true) Line 5012\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal({...}, {...}, 0x2511d738, {...}) Line 3932\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem({...}, {...}, 0x2511d738, {...}) Line 6265\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList({...}, {...}, 0x2511d738, {...}) Line 10843\tC++\n \txul.dll!nsCSSFrameConstructor::ContentRangeInserted(0x24ed3920, 0x24ed39c0, 0x24ed3a10, 0x2286e6c0, false, 0x00000000) Line 8253\tC++\n \txul.dll!nsCSSFrameConstructor::ContentInserted(0x24ed3920, 0x24ed39c0, 0x2286e6c0, false) Line 7799\tC++\n \txul.dll!nsCSSFrameConstructor::RecreateFramesForContent(0x24ed39c0, false, REMOVE_FOR_RECONSTRUCTION, 0x00000000) Line 9913\tC++\n \txul.dll!nsCSSFrameConstructor::MaybeRecreateFramesForElement(0x24ed39c0) Line 9519\tC++\n \txul.dll!mozilla::GeckoRestyleManager::RestyleElement(0x24ed39c0, 0x00000000, nsChangeHint_Empty, {...}, 3, {...}) Line 164\tC++\n \txul.dll!mozilla::RestyleTracker::ProcessOneRestyle(0x24ed39c0, 3, nsChangeHint_Empty, {...}) Line 95\tC++\n \txul.dll!mozilla::RestyleTracker::DoProcessRestyles() Line 264\tC++\n \txul.dll!mozilla::GeckoRestyleManager::ProcessRestyles({...}) Line 392\tC++\n \txul.dll!mozilla::GeckoRestyleManager::ProcessPendingRestyles() Line 506\tC++\n \txul.dll!mozilla::RestyleManager::ProcessPendingRestyles() Line 45\tC++\n \txul.dll!mozilla::PresShell::DoFlushPendingNotifications({...}) Line 4210\tC++\n \txul.dll!nsIPresShell::FlushPendingNotifications({...}) Line 609\tC++\n \txul.dll!nsRefreshDriver::Tick(1491747297906295, {...}) Line 1776\tC++\n \txul.dll!mozilla::RefreshDriverTimer::TickDriver(0x1ea2b8c0, 1491747297906295, {...}) Line 330\tC++\n \txul.dll!mozilla::RefreshDriverTimer::TickRefreshDrivers(1491747297906295, {...}, {...}) Line 299\tC++\n \txul.dll!mozilla::RefreshDriverTimer::Tick(1491747297906295, {...}) Line 323\tC++\n \txul.dll!mozilla::VsyncRefreshDriverTimer::RunRefreshDrivers({...}) Line 712\tC++\n \txul.dll!mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver({...}) Line 627\tC++\n \txul.dll!mozilla::detail::RunnableMethodArguments<mozilla::TimeStamp>::applyImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver,void (__thiscall mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp),StoreCopyPassByConstLRef<mozilla::TimeStamp>,0>(0x2232fa10, 0x10043389, {...}, {...}) Line 865\tC++\n \txul.dll!mozilla::detail::RunnableMethodArguments<mozilla::TimeStamp>::apply<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver,void (__thiscall mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp)>(0x2232fa10, 0x10043389) Line 870\tC++\n \txul.dll!mozilla::detail::RunnableMethodImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver * const,void (__thiscall mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp),1,0,mozilla::TimeStamp>::Run() Line 901\tC++\n \txul.dll!nsThread::ProcessNextEvent(false, 0x0077f4e1) Line 1270\tC++\n \txul.dll!NS_ProcessNextEvent(0x0116b300, false) Line 389\tC++\n \txul.dll!mozilla::ipc::MessagePump::Run(0x01125060) Line 96\tC++\n \txul.dll!MessageLoop::RunInternal() Line 239\tC++\n \txul.dll!MessageLoop::RunHandler() Line 232\tC++\n \txul.dll!MessageLoop::Run() Line 212\tC++\n \txul.dll!nsBaseAppShell::Run() Line 158\tC++\n \txul.dll!nsAppShell::Run() Line 271\tC++\n \txul.dll!nsAppStartup::Run() Line 283\tC++\n \txul.dll!XREMain::XRE_mainRun() Line 4538\tC++\n \txul.dll!XREMain::XRE_main(4, 0x01102040, {...}) Line 4718\tC++\n \txul.dll!XRE_main(4, 0x01102040, {...}) Line 4811\tC++\n\n  \n>\txul.dll!mozilla::net::nsHttpChannel::AsyncOpen(0x228e1ed4, 0x00000000) Line 5777\tC++\n \txul.dll!mozilla::net::nsHttpChannel::AsyncOpen2(0x228e1ed4) Line 5971\tC++\n \txul.dll!mozilla::places::AsyncFetchAndSetIconForPage::FetchFromNetwork() Line 444\tC++\n \txul.dll!mozilla::detail::RunnableMethodArguments<>::applyImpl<mozilla::places::AsyncFetchAndSetIconForPage,enum nsresult (__thiscall mozilla::places::AsyncFetchAndSetIconForPage::*)(void)>(0x228e1ec0, 0x100b9c19, {...}, {...}) Line 865\tC++\n \txul.dll!mozilla::detail::RunnableMethodArguments<>::apply<mozilla::places::AsyncFetchAndSetIconForPage,enum nsresult (__thiscall mozilla::places::AsyncFetchAndSetIconForPage::*)(void)>(0x228e1ec0, 0x100b9c19) Line 870\tC++\n \txul.dll!mozilla::detail::RunnableMethodImpl<mozilla::places::AsyncFetchAndSetIconForPage * const,enum nsresult (__thiscall mozilla::places::AsyncFetchAndSetIconForPage::*)(void),1,0>::Run() Line 901\tC++\n \txul.dll!nsThread::ProcessNextEvent(false, 0x0077f4e1) Line 1270\tC++\n \txul.dll!NS_ProcessNextEvent(0x0116b300, false) Line 389\tC++\n \txul.dll!mozilla::ipc::MessagePump::Run(0x01125060) Line 96\tC++\n \txul.dll!MessageLoop::RunInternal() Line 239\tC++\n \txul.dll!MessageLoop::RunHandler() Line 232\tC++\n \txul.dll!MessageLoop::Run() Line 212\tC++\n \txul.dll!nsBaseAppShell::Run() Line 158\tC++\n \txul.dll!nsAppShell::Run() Line 271\tC++\n \txul.dll!nsAppStartup::Run() Line 283\tC++\n \txul.dll!XREMain::XRE_mainRun() Line 4538\tC++\n \txul.dll!XREMain::XRE_main(4, 0x01102040, {...}) Line 4718\tC++\n\n\nBoth fortunately happen later during the page load process, so they no longer block paint, I believe (no tool to check, tho....)  But still would be good to coalesce them.  One option is to make the response more cacheable, at least 404.\n\nI don't believe this blocks CDP anymore and bug 1247843 will use a different solution.", "bug_id": 685740, "text": "This has reduced to only 2 requests:\n\n>\txul.dll!mozilla::net::nsHttpChannel::AsyncOpen(0x28467f80, 0x00000000) Line 5777\tC++\n \txul.dll!mozilla::net::nsHttpChannel::AsyncOpen2(0x28467f80) Line 5971\tC++\n \txul.dll!imgLoader::LoadImage(0x28248c80, 0x228e2a00, 0x228e2a00, RP_Unset, 0x285af6a0, 0x22b26ec0, 0x1e253160, 0x24ed39c0, 0x1d78d000, 5120, 0x00000000, 41, {...}, 0x282a2178) Line 2246\tC++\n \txul.dll!nsContentUtils::LoadImage(0x28248c80, 0x24ed39c0, 0x1d78d000, 0x285af6a0, 0x228e2a00, RP_Unset, 0x1e253160, 5120, {...}, 0x282a2178, 41) Line 3435\tC++\n \txul.dll!nsImageBoxFrame::UpdateImage() Line 247\tC++\n \txul.dll!nsImageBoxFrame::Init(0x24ed39c0, 0x2511d738, 0x00000000) Line 211\tC++\n \txul.dll!nsCSSFrameConstructor::InitAndRestoreFrame({...}, 0x24ed39c0, 0x2511d738, 0x282a2120, true) Line 5012\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFrameFromItemInternal({...}, {...}, 0x2511d738, {...}) Line 3932\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItem({...}, {...}, 0x2511d738, {...}) Line 6265\tC++\n \txul.dll!nsCSSFrameConstructor::ConstructFramesFromItemList({...}, {...}, 0x2511d738, {...}) Line 10843\tC++\n \txul.dll!nsCSSFrameConstructor::ContentRangeInserted(0x24ed3920, 0x24ed39c0, 0x24ed3a10, 0x2286e6c0, false, 0x00000000) Line 8253\tC++\n \txul.dll!nsCSSFrameConstructor::ContentInserted(0x24ed3920, 0x24ed39c0, 0x2286e6c0, false) Line 7799\tC++\n \txul.dll!nsCSSFrameConstructor::RecreateFramesForContent(0x24ed39c0, false, REMOVE_FOR_RECONSTRUCTION, 0x00000000) Line 9913\tC++\n \txul.dll!nsCSSFrameConstructor::MaybeRecreateFramesForElement(0x24ed39c0) Line 9519\tC++\n \txul.dll!mozilla::GeckoRestyleManager::RestyleElement(0x24ed39c0, 0x00000000, nsChangeHint_Empty, {...}, 3, {...}) Line 164\tC++\n \txul.dll!mozilla::RestyleTracker::ProcessOneRestyle(0x24ed39c0, 3, nsChangeHint_Empty, {...}) Line 95\tC++\n \txul.dll!mozilla::RestyleTracker::DoProcessRestyles() Line 264\tC++\n \txul.dll!mozilla::GeckoRestyleManager::ProcessRestyles({...}) Line 392\tC++\n \txul.dll!mozilla::GeckoRestyleManager::ProcessPendingRestyles() Line 506\tC++\n \txul.dll!mozilla::RestyleManager::ProcessPendingRestyles() Line 45\tC++\n \txul.dll!mozilla::PresShell::DoFlushPendingNotifications({...}) Line 4210\tC++\n \txul.dll!nsIPresShell::FlushPendingNotifications({...}) Line 609\tC++\n \txul.dll!nsRefreshDriver::Tick(1491747297906295, {...}) Line 1776\tC++\n \txul.dll!mozilla::RefreshDriverTimer::TickDriver(0x1ea2b8c0, 1491747297906295, {...}) Line 330\tC++\n \txul.dll!mozilla::RefreshDriverTimer::TickRefreshDrivers(1491747297906295, {...}, {...}) Line 299\tC++\n \txul.dll!mozilla::RefreshDriverTimer::Tick(1491747297906295, {...}) Line 323\tC++\n \txul.dll!mozilla::VsyncRefreshDriverTimer::RunRefreshDrivers({...}) Line 712\tC++\n \txul.dll!mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver({...}) Line 627\tC++\n \txul.dll!mozilla::detail::RunnableMethodArguments<mozilla::TimeStamp>::applyImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver,void (__thiscall mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp),StoreCopyPassByConstLRef<mozilla::TimeStamp>,0>(0x2232fa10, 0x10043389, {...}, {...}) Line 865\tC++\n \txul.dll!mozilla::detail::RunnableMethodArguments<mozilla::TimeStamp>::apply<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver,void (__thiscall mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp)>(0x2232fa10, 0x10043389) Line 870\tC++\n \txul.dll!mozilla::detail::RunnableMethodImpl<mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver * const,void (__thiscall mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp),1,0,mozilla::TimeStamp>::Run() Line 901\tC++\n \txul.dll!nsThread::ProcessNextEvent(false, 0x0077f4e1) Line 1270\tC++\n \txul.dll!NS_ProcessNextEvent(0x0116b300, false) Line 389\tC++\n \txul.dll!mozilla::ipc::MessagePump::Run(0x01125060) Line 96\tC++\n \txul.dll!MessageLoop::RunInternal() Line 239\tC++\n \txul.dll!MessageLoop::RunHandler() Line 232\tC++\n \txul.dll!MessageLoop::Run() Line 212\tC++\n \txul.dll!nsBaseAppShell::Run() Line 158\tC++\n \txul.dll!nsAppShell::Run() Line 271\tC++\n \txul.dll!nsAppStartup::Run() Line 283\tC++\n \txul.dll!XREMain::XRE_mainRun() Line 4538\tC++\n \txul.dll!XREMain::XRE_main(4, 0x01102040, {...}) Line 4718\tC++\n \txul.dll!XRE_main(4, 0x01102040, {...}) Line 4811\tC++\n\n  \n>\txul.dll!mozilla::net::nsHttpChannel::AsyncOpen(0x228e1ed4, 0x00000000) Line 5777\tC++\n \txul.dll!mozilla::net::nsHttpChannel::AsyncOpen2(0x228e1ed4) Line 5971\tC++\n \txul.dll!mozilla::places::AsyncFetchAndSetIconForPage::FetchFromNetwork() Line 444\tC++\n \txul.dll!mozilla::detail::RunnableMethodArguments<>::applyImpl<mozilla::places::AsyncFetchAndSetIconForPage,enum nsresult (__thiscall mozilla::places::AsyncFetchAndSetIconForPage::*)(void)>(0x228e1ec0, 0x100b9c19, {...}, {...}) Line 865\tC++\n \txul.dll!mozilla::detail::RunnableMethodArguments<>::apply<mozilla::places::AsyncFetchAndSetIconForPage,enum nsresult (__thiscall mozilla::places::AsyncFetchAndSetIconForPage::*)(void)>(0x228e1ec0, 0x100b9c19) Line 870\tC++\n \txul.dll!mozilla::detail::RunnableMethodImpl<mozilla::places::AsyncFetchAndSetIconForPage * const,enum nsresult (__thiscall mozilla::places::AsyncFetchAndSetIconForPage::*)(void),1,0>::Run() Line 901\tC++\n \txul.dll!nsThread::ProcessNextEvent(false, 0x0077f4e1) Line 1270\tC++\n \txul.dll!NS_ProcessNextEvent(0x0116b300, false) Line 389\tC++\n \txul.dll!mozilla::ipc::MessagePump::Run(0x01125060) Line 96\tC++\n \txul.dll!MessageLoop::RunInternal() Line 239\tC++\n \txul.dll!MessageLoop::RunHandler() Line 232\tC++\n \txul.dll!MessageLoop::Run() Line 212\tC++\n \txul.dll!nsBaseAppShell::Run() Line 158\tC++\n \txul.dll!nsAppShell::Run() Line 271\tC++\n \txul.dll!nsAppStartup::Run() Line 283\tC++\n \txul.dll!XREMain::XRE_mainRun() Line 4538\tC++\n \txul.dll!XREMain::XRE_main(4, 0x01102040, {...}) Line 4718\tC++\n\n\nBoth fortunately happen later during the page load process, so they no longer block paint, I believe (no tool to check, tho....)  But still would be good to coalesce them.  One option is to make the response more cacheable, at least 404.\n\nI don't believe this blocks CDP anymore and bug 1247843 will use a different solution.", "tags": []}, {"text": "The first load apparently comes from here:\n\nhttps://dxr.mozilla.org/mozilla-central/rev/2a3ecdb7d1ea814708021fee6735b3aedcf03e48/browser/base/content/tabbrowser.xml#971\n\nWhich according comment 2 seems to be windows taskbar preview.  The priority of the channel is LOW, so it's not that bad.", "bug_id": 685740, "tags": [], "attachment_id": null, "raw_text": "The first load apparently comes from here:\n\nhttps://dxr.mozilla.org/mozilla-central/rev/2a3ecdb7d1ea814708021fee6735b3aedcf03e48/browser/base/content/tabbrowser.xml#971\n\nWhich according comment 2 seems to be windows taskbar preview.  The priority of the channel is LOW, so it's not that bad.", "creator": "honzab.moz@firemni.cz", "time": "2017-04-09T16:12:54Z", "creation_time": "2017-04-09T16:12:54Z", "author": "honzab.moz@firemni.cz", "is_private": false, "count": 4, "id": 12219293}, {"id": 12319881, "count": 5, "is_private": false, "time": "2017-05-15T18:24:51Z", "creation_time": "2017-05-15T18:24:51Z", "creator": "honzab.moz@firemni.cz", "author": "honzab.moz@firemni.cz", "attachment_id": null, "raw_text": "I don't think this needs an urgent fix, releasing.", "tags": [], "bug_id": 685740, "text": "I don't think this needs an urgent fix, releasing."}, {"creator": "stephen.donner@gmail.com", "time": "2020-04-16T23:07:01Z", "creation_time": "2020-04-16T23:07:01Z", "author": "stephen.donner@gmail.com", "is_private": false, "id": 14760296, "count": 6, "tags": [], "text": "Mass-removing myself from cc; search for 12b9dfe4-ece3-40dc-8d23-60e179f64ac1 or any reasonable part thereof, to mass-delete these notifications (and sorry!)", "bug_id": 685740, "attachment_id": null, "raw_text": "Mass-removing myself from cc; search for 12b9dfe4-ece3-40dc-8d23-60e179f64ac1 or any reasonable part thereof, to mass-delete these notifications (and sorry!)"}]}}, "comments": {}}