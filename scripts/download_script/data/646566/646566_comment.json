{"comments": {}, "bugs": {"646566": {"comments": [{"is_private": false, "time": "2011-03-30T18:34:52Z", "attachment_id": null, "creation_time": "2011-03-30T18:34:52Z", "text": "See http://tinderbox.mozilla.org/showlog.cgi?log=Firefox/1301446512.1301451126.7332.gz&fulltext=1#err0.", "id": 5380992, "raw_text": "See http://tinderbox.mozilla.org/showlog.cgi?log=Firefox/1301446512.1301451126.7332.gz&fulltext=1#err0.", "creator": "ben@stechz.com", "count": 0, "tags": [], "bug_id": 646566, "author": "ben@stechz.com"}, {"author": "ben@stechz.com", "attachment_id": null, "raw_text": "Interesting. This crash actually *always* happens, but it doesn't count as a failure because usually we get to the leak output before the crash occurs.\n\nhttp://tinderbox.mozilla.org/showlog.cgi?log=Firefox/1301501610.1301504983.13551.gz&fulltext=1#err0\n\nGood news really. That means the crash should be easy to reproduce this on any machine.", "id": 5381080, "text": "Interesting. This crash actually *always* happens, but it doesn't count as a failure because usually we get to the leak output before the crash occurs.\n\nhttp://tinderbox.mozilla.org/showlog.cgi?log=Firefox/1301501610.1301504983.13551.gz&fulltext=1#err0\n\nGood news really. That means the crash should be easy to reproduce this on any machine.", "creation_time": "2011-03-30T19:06:26Z", "is_private": false, "bug_id": 646566, "time": "2011-03-30T19:06:26Z", "tags": [], "creator": "ben@stechz.com", "count": 1}, {"bug_id": 646566, "time": "2011-03-30T19:13:01Z", "tags": [], "creator": "josh@joshmatthews.net", "count": 2, "text": "What's the crash you're seeing?  The only moderately suspicious lines in the log I see are:\n\nERROR: The process with PID 3440 could not be terminated.\nReason: There is no running instance of the task.\n\nand\n\nTEST-UNEXPECTED-FAIL | tab process 2668 | automationutils.processLeakLog() | missing output line for total leaks!\n\nI would expect to see some other indication that a crash is taking place.  These lines\n\nPROCESS-CRASH | Main app process exited normally | application crashed (minidump found)\nThread 0 (crashed)\n\njust indicate that the expected crash occurred during a test in which we explicitly load a content script that uses jsctypes to crash intentionally.", "creation_time": "2011-03-30T19:13:01Z", "is_private": false, "raw_text": "What's the crash you're seeing?  The only moderately suspicious lines in the log I see are:\n\nERROR: The process with PID 3440 could not be terminated.\nReason: There is no running instance of the task.\n\nand\n\nTEST-UNEXPECTED-FAIL | tab process 2668 | automationutils.processLeakLog() | missing output line for total leaks!\n\nI would expect to see some other indication that a crash is taking place.  These lines\n\nPROCESS-CRASH | Main app process exited normally | application crashed (minidump found)\nThread 0 (crashed)\n\njust indicate that the expected crash occurred during a test in which we explicitly load a content script that uses jsctypes to crash intentionally.", "id": 5381096, "author": "josh@joshmatthews.net", "attachment_id": null}, {"attachment_id": null, "author": "ben@stechz.com", "creator": "ben@stechz.com", "count": 3, "time": "2011-03-30T21:04:30Z", "tags": [], "bug_id": 646566, "creation_time": "2011-03-30T21:04:30Z", "is_private": false, "text": "I didn't realize that's an intentional crash, sorry.\n\nWhy are we sometimes not seeing the leak log?", "id": 5381397, "raw_text": "I didn't realize that's an intentional crash, sorry.\n\nWhy are we sometimes not seeing the leak log?"}, {"raw_text": "It seems that bug 643083 really tickles this issue.", "id": 5381615, "text": "It seems that bug 643083 really tickles this issue.", "creation_time": "2011-03-30T22:14:55Z", "bug_id": 646566, "count": 4, "tags": [], "creator": "ben@stechz.com", "author": "ben@stechz.com", "is_private": false, "time": "2011-03-30T22:14:55Z", "attachment_id": null}, {"is_private": false, "time": "2011-03-30T22:29:38Z", "attachment_id": null, "creation_time": "2011-03-30T22:29:38Z", "text": "As in the patch in 643083 causes no leak log to be output?", "id": 5381664, "raw_text": "As in the patch in 643083 causes no leak log to be output?", "count": 5, "tags": [], "creator": "josh@joshmatthews.net", "bug_id": 646566, "author": "josh@joshmatthews.net"}, {"raw_text": "Yes. Sometimes.", "id": 5381666, "text": "Yes. Sometimes.", "is_private": false, "creation_time": "2011-03-30T22:30:19Z", "bug_id": 646566, "creator": "ben@stechz.com", "time": "2011-03-30T22:30:19Z", "count": 6, "tags": [], "author": "ben@stechz.com", "attachment_id": null}, {"author": "ben@stechz.com", "raw_text": "I need help on this bug. This is important because I have working tests for our asynchronous scrolling, but this missing output line means I won't be able to land those patches.\n\nWho is a good person to debug this?\n\nCC'ing Mark to see if he has any people that can help.", "id": 5383952, "text": "I need help on this bug. This is important because I have working tests for our asynchronous scrolling, but this missing output line means I won't be able to land those patches.\n\nWho is a good person to debug this?\n\nCC'ing Mark to see if he has any people that can help.", "creation_time": "2011-03-31T18:43:29Z", "bug_id": 646566, "count": 7, "creator": "ben@stechz.com", "tags": [], "attachment_id": null, "is_private": false, "time": "2011-03-31T18:43:29Z"}, {"tags": [], "creator": "josh@joshmatthews.net", "count": 8, "bug_id": 646566, "creation_time": "2011-03-31T19:22:14Z", "text": "Ok, so I don't think this is a huge deal.  Basically, if a content process notices that the parent process is quitting imminently, the child just exits immediately and doesn't bother going through the process of shutting down XPCOM and printing out a leak log.  cjones, is this correct?", "id": 5384081, "raw_text": "Ok, so I don't think this is a huge deal.  Basically, if a content process notices that the parent process is quitting imminently, the child just exits immediately and doesn't bother going through the process of shutting down XPCOM and printing out a leak log.  cjones, is this correct?", "author": "josh@joshmatthews.net", "time": "2011-03-31T19:22:14Z", "is_private": false, "attachment_id": null}, {"raw_text": "Not quite --- in debug builds, the content process tries to go through normal XPCOM shutdown, but if something sends a message after IPC has been closed, deep into shutdown, then ContentChild just _exit()s.  In opt builds it immediately _exit()s after being told to shut down, and doesn't attempt XPCOM shutdown.\n\nIt's not a great system, but in the past when this has caused a problem there were obvious bugs in code being shut down so I just fixed those bugs (e.g. reading unneeded prefs on shutdown).\n\nWe should find out what's trying to send messages late into shutdown --- just break on http://mxr.mozilla.org/mozilla-central/source/dom/ipc/ContentChild.cpp#513 and grab a backtrace.", "id": 5384454, "text": "Not quite --- in debug builds, the content process tries to go through normal XPCOM shutdown, but if something sends a message after IPC has been closed, deep into shutdown, then ContentChild just _exit()s.  In opt builds it immediately _exit()s after being told to shut down, and doesn't attempt XPCOM shutdown.\n\nIt's not a great system, but in the past when this has caused a problem there were obvious bugs in code being shut down so I just fixed those bugs (e.g. reading unneeded prefs on shutdown).\n\nWe should find out what's trying to send messages late into shutdown --- just break on http://mxr.mozilla.org/mozilla-central/source/dom/ipc/ContentChild.cpp#513 and grab a backtrace.", "creation_time": "2011-03-31T21:02:56Z", "bug_id": 646566, "count": 9, "tags": [], "creator": "cjones.bugs@gmail.com", "author": "cjones.bugs@gmail.com", "is_private": false, "time": "2011-03-31T21:02:56Z", "attachment_id": null}, {"tags": [], "count": 10, "creator": "ben@stechz.com", "bug_id": 646566, "creation_time": "2011-04-11T18:55:28Z", "text": "I don't quite understand how to move forward on this. If this is only happening sometimes on Mac, will I need a Mac build? Or can this be debugged on Linux?", "id": 5401118, "raw_text": "I don't quite understand how to move forward on this. If this is only happening sometimes on Mac, will I need a Mac build? Or can this be debugged on Linux?", "author": "ben@stechz.com", "time": "2011-04-11T18:55:28Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "author": "ben@stechz.com", "creator": "ben@stechz.com", "count": 11, "tags": [], "time": "2011-04-11T19:55:35Z", "bug_id": 646566, "id": 5401265, "raw_text": "The log doesn't say anything like \"content process _exiting\". I'm not sure this is why we are exiting early.\n\nhttp://mxr.mozilla.org/mozilla-central/source/dom/ipc/ContentChild.cpp#532", "is_private": false, "creation_time": "2011-04-11T19:55:35Z", "text": "The log doesn't say anything like \"content process _exiting\". I'm not sure this is why we are exiting early.\n\nhttp://mxr.mozilla.org/mozilla-central/source/dom/ipc/ContentChild.cpp#532"}, {"author": "ben@stechz.com", "tags": [], "creator": "ben@stechz.com", "count": 12, "bug_id": 646566, "id": 5401351, "raw_text": "Oh, it is indeed present here:\nhttp://tinderbox.mozilla.org/showlog.cgi?log=Firefox/1301446512.1301451126.7332.gz&fulltext=1#err0", "creation_time": "2011-04-11T20:18:15Z", "text": "Oh, it is indeed present here:\nhttp://tinderbox.mozilla.org/showlog.cgi?log=Firefox/1301446512.1301451126.7332.gz&fulltext=1#err0", "attachment_id": null, "time": "2011-04-11T20:18:15Z", "is_private": false}, {"author": "josh@joshmatthews.net", "attachment_id": null, "raw_text": "Ok, I've found some wackiness going on in the log in comment 0:\n\nWe start this test which no longer exists in the tree:\n\nTEST-START | chrome://mochitests/content/browser/dom/tests/browser/browser_643083.js\npldhash: for the table at address 19C9BD68, the given entrySize of 48 probably favors chaining over double hashing.\n++DOCSHELL 19C9BD00 == 13\n++DOMWINDOW == 307 (1C1D9220) [serial = 4953] [outer = 00000000]\nWARNING: Subdocument container has no content: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/base/nsDocumentViewer.cpp, line 2401\n++DOMWINDOW == 308 (1C1DA160) [serial = 4954] [outer = 1C1D91D0]\nWARNING: Subdocument container has no content: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/base/nsDocumentViewer.cpp, line 2401\nWARNING: Subdocument container has no content: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/base/nsDocumentViewer.cpp, line 2401\nWARNING: No script language registered for this mime-type: file e:/builds/moz2_slave/cen-w32-dbg/build/dom/base/nsDOMScriptObjectFactory.cpp, line 161\nWARNING: Failed to find a scripting language: file e:/builds/moz2_slave/cen-w32-dbg/build/content/xul/document/src/nsXULContentSink.cpp, line 1029\nWARNING: Connect called twice: file e:/builds/moz2_slave/cen-w32-dbg/build/ipc/chromium/src/chrome/common/ipc_channel_win.cc, line 178\n\n^ that's kind of weird\n\nWARNING: No docshells for remote frames!: file e:/builds/moz2_slave/cen-w32-dbg/build/content/base/src/nsFrameLoader.cpp, line 559\nWARNING: No docshells for remote frames!: file e:/builds/moz2_slave/cen-w32-dbg/build/content/base/src/nsFrameLoader.cpp, line 559\nWARNING: Nv3DVStreaming CoCreateInstance failed (disabled).: file e:/builds/moz2_slave/cen-w32-dbg/build/gfx/layers/d3d9/Nv3DVUtils.cpp, line 85\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/base/nsTraceRefcntImpl.cpp, line 172\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/base/nsTraceRefcntImpl.cpp, line 172\n### XPCOM_MEM_BLOAT_LOG defined -- logging bloat/leaks to c:\\users\\cltbld\\appdata\\local\\temp\\tmppqhz-l\\runtests_leaks_tab_pid2668.log\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/base/nsTraceRefcntImpl.cpp, line 172\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/base/nsTraceRefcntImpl.cpp, line 172\nWARNING: Connect called twice: file e:/builds/moz2_slave/cen-w32-dbg/build/ipc/chromium/src/chrome/common/ipc_channel_win.cc, line 178\n\n^ also weird\n\nWARNING: NS_ENSURE_TRUE(mMainThread) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/threads/nsThreadManager.cpp, line 284\nWARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0xC1F30001: file e:/builds/moz2_slave/cen-w32-dbg/build/obj-firefox/xpcom/build/nsThreadUtils.cpp, line 173\nWARNING: NS_ENSURE_TRUE(mMainThread) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/threads/nsThreadManager.cpp, line 284\nWARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0xC1F30001: file e:/builds/moz2_slave/cen-w32-dbg/build/obj-firefox/xpcom/build/nsThreadUtils.cpp, line 173\nTEST-INFO | chrome://mochitests/content/browser/dom/tests/browser/browser_643083.js | Console message: [JavaScript Error: \"[Exception... \"Component returned failure code: 0x80040111 (NS_ERROR_NOT_AVAILABLE) [nsIContainerBoxObject.docShell]\"  nsresult: \"0x80040111 (NS_ERROR_NOT_AVAILABLE)\"  location: \"JS frame :: chrome://global/content/bindings/browser.xml :: get_docShell :: line 0\"  data: no]\" {file: \"chrome://global/content/bindings/browser.xml\" line: 670}]\nCouldn't convert chrome URL: chrome://global/locale/intl.properties\nnsNativeModuleLoader::LoadModule(\"c:\\talos-slave\\test\\build\\firefox\\components\\xpcomsample.dll\") - load FAILED, rv: 80520012, error:\n\t<unknown; can't get error from NSPR>\nWARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80004005: file e:/builds/moz2_slave/cen-w32-dbg/build/netwerk/base/src/nsIOService.cpp, line 647\nCouldn't convert chrome URL: chrome://global-platform/locale/intl.properties\nWARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80004005: file e:/builds/moz2_slave/cen-w32-dbg/build/netwerk/base/src/nsIOService.cpp, line 647\npldhash: for the table at address 02679B08, the given entrySize of 48 probably favors chaining over double hashing.\ncreating 1!\n[TabChild] SHOW (w,h)= (0, 0)\n\n^ what? creating a content process? who? what?\n\npldhash: for the table at address 035041D8, the given entrySize of 48 probably favors chaining over double hashing.\nWARNING: shadow layers no sprechen D3D backend yet: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/ipc/RenderFrameParent.cpp, line 699\n++DOCSHELL 03504170 == 1\n++DOMWINDOW == 1 (02733238) [serial = 1] [outer = 00000000]\nloading about:blank, 1\npldhash: for the table at address 0344C258, the given entrySize of 56 probably favors chaining over double hashing.\nWARNING: Subdocument container has no content: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/base/nsDocumentViewer.cpp, line 2401\n++DOMWINDOW == 2 (03545248) [serial = 2] [outer = 027331E8]\nWARNING: NS_ENSURE_TRUE(sf) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/docshell/base/nsDocShell.cpp, line 4996\nWARNING: NS_ENSURE_TRUE(sf) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/docshell/base/nsDocShell.cpp, line 4996\n[TabChild] RESIZE to (w,h)= (126d, 10d)\n[TabChild] RESIZE to (w,h)= (494d, 472d)\nWARNING: Subdocument container has no content: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/base/nsDocumentViewer.cpp, line 2401\n++DOMWINDOW == 3 (036589F0) [serial = 3] [outer = 027331E8]\n\n###!!! [Parent][AsyncChannel] Error: Value error: message was deserialized, but contained an illegal value\n\n^ ohnoz\n\nWARNING: NS_ENSURE_SUCCESS(rv, 0) failed with result 0x8000FFFF: file e:/builds/moz2_slave/cen-w32-dbg/build/content/base/src/nsContentUtils.cpp, line 2905\nWARNING: NS_ENSURE_TRUE(pusher.Push(aBoundElement)) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/content/xbl/src/nsXBLProtoImplMethod.cpp, line 327\nWARNING: NS_ENSURE_SUCCESS(rv, 0) failed with result 0x8000FFFF: file e:/builds/moz2_slave/cen-w32-dbg/build/content/base/src/nsContentUtils.cpp, line 2905\nWARNING: NS_ENSURE_TRUE(pusher.Push(aBoundElement)) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/content/xbl/src/nsXBLProtoImplMethod.cpp, line 327\nTEST-PASS | chrome://mochitests/content/browser/dom/tests/browser/browser_643083.js | Completed message to close window\nINFO TEST-END | chrome://mochitests/content/browser/dom/tests/browser/browser_643083.js | finished in 670ms\nTEST-INFO | checking window state\nTEST-INFO | before wait for focus -- loaded: complete active window: ([object ChromeWindow @ 0x80ca338 (native @ 0x80e6388)]) chrome://browser/content/browser.xul focused window: ([object XrayWrapper [object Window @ 0x1c116aa0 (native @ 0x1adf7b10)]]) http://mochi.test:8888/browser/docshell/test/navigation/bug343515_pg3.html desired window: ([object ChromeWindow @ 0x80ca338 (native @ 0x80e6388)]) chrome://browser/content/browser.xul child window: ([object XrayWrapper [object Window @ 0x1c116aa0 (native @ 0x1adf7b10)]]) http://mochi.test:8888/browser/docshell/test/navigation/bug343515_pg3.html docshell visible: true\nTEST-INFO | already focused\nTEST-INFO | maybe run tests <load:true, focus:true> -- loaded: complete active window: ([object ChromeWindow @ 0x80ca338 (native @ 0x80e6388)]) chrome://browser/content/browser.xul focused window: ([object XrayWrapper [object Window @ 0x1c116aa0 (native @ 0x1adf7b10)]]) http://mochi.test:8888/browser/docshell/test/navigation/bug343515_pg3.html desired window: ([object ChromeWindow @ 0x80ca338 (native @ 0x80e6388)]) chrome://browser/content/browser.xul child window: ([object XrayWrapper [object Window @ 0x1c116aa0 (native @ 0x1adf7b10)]]) http://mochi.test:8888/browser/docshell/test/navigation/bug343515_pg3.html docshell visible: true\nTEST-START | chrome://mochitests/content/browser/dom/tests/browser/browser_ConsoleAPITests.js\npldhash: for the table at address 19C9C1B8, the given entrySize of 48 probably favors chaining over double hashing.\n++DOCSHELL 19C9C150 == 14\n++DOMWINDOW == 309 (1ADF66C8) [serial = 4955] [outer = 00000000]\n++DOMWINDOW == 310 (1F434BB0) [serial = 4956] [outer = 1ADF6678]\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][SyncChannel] Error: Route error: message sent to unknown actor ID\n\n^ crashy mccrashcrash", "id": 5401378, "text": "Ok, I've found some wackiness going on in the log in comment 0:\n\nWe start this test which no longer exists in the tree:\n\nTEST-START | chrome://mochitests/content/browser/dom/tests/browser/browser_643083.js\npldhash: for the table at address 19C9BD68, the given entrySize of 48 probably favors chaining over double hashing.\n++DOCSHELL 19C9BD00 == 13\n++DOMWINDOW == 307 (1C1D9220) [serial = 4953] [outer = 00000000]\nWARNING: Subdocument container has no content: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/base/nsDocumentViewer.cpp, line 2401\n++DOMWINDOW == 308 (1C1DA160) [serial = 4954] [outer = 1C1D91D0]\nWARNING: Subdocument container has no content: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/base/nsDocumentViewer.cpp, line 2401\nWARNING: Subdocument container has no content: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/base/nsDocumentViewer.cpp, line 2401\nWARNING: No script language registered for this mime-type: file e:/builds/moz2_slave/cen-w32-dbg/build/dom/base/nsDOMScriptObjectFactory.cpp, line 161\nWARNING: Failed to find a scripting language: file e:/builds/moz2_slave/cen-w32-dbg/build/content/xul/document/src/nsXULContentSink.cpp, line 1029\nWARNING: Connect called twice: file e:/builds/moz2_slave/cen-w32-dbg/build/ipc/chromium/src/chrome/common/ipc_channel_win.cc, line 178\n\n^ that's kind of weird\n\nWARNING: No docshells for remote frames!: file e:/builds/moz2_slave/cen-w32-dbg/build/content/base/src/nsFrameLoader.cpp, line 559\nWARNING: No docshells for remote frames!: file e:/builds/moz2_slave/cen-w32-dbg/build/content/base/src/nsFrameLoader.cpp, line 559\nWARNING: Nv3DVStreaming CoCreateInstance failed (disabled).: file e:/builds/moz2_slave/cen-w32-dbg/build/gfx/layers/d3d9/Nv3DVUtils.cpp, line 85\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/base/nsTraceRefcntImpl.cpp, line 172\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/base/nsTraceRefcntImpl.cpp, line 172\n### XPCOM_MEM_BLOAT_LOG defined -- logging bloat/leaks to c:\\users\\cltbld\\appdata\\local\\temp\\tmppqhz-l\\runtests_leaks_tab_pid2668.log\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/base/nsTraceRefcntImpl.cpp, line 172\nWARNING: XPCOM objects created/destroyed from static ctor/dtor: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/base/nsTraceRefcntImpl.cpp, line 172\nWARNING: Connect called twice: file e:/builds/moz2_slave/cen-w32-dbg/build/ipc/chromium/src/chrome/common/ipc_channel_win.cc, line 178\n\n^ also weird\n\nWARNING: NS_ENSURE_TRUE(mMainThread) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/threads/nsThreadManager.cpp, line 284\nWARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0xC1F30001: file e:/builds/moz2_slave/cen-w32-dbg/build/obj-firefox/xpcom/build/nsThreadUtils.cpp, line 173\nWARNING: NS_ENSURE_TRUE(mMainThread) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/xpcom/threads/nsThreadManager.cpp, line 284\nWARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0xC1F30001: file e:/builds/moz2_slave/cen-w32-dbg/build/obj-firefox/xpcom/build/nsThreadUtils.cpp, line 173\nTEST-INFO | chrome://mochitests/content/browser/dom/tests/browser/browser_643083.js | Console message: [JavaScript Error: \"[Exception... \"Component returned failure code: 0x80040111 (NS_ERROR_NOT_AVAILABLE) [nsIContainerBoxObject.docShell]\"  nsresult: \"0x80040111 (NS_ERROR_NOT_AVAILABLE)\"  location: \"JS frame :: chrome://global/content/bindings/browser.xml :: get_docShell :: line 0\"  data: no]\" {file: \"chrome://global/content/bindings/browser.xml\" line: 670}]\nCouldn't convert chrome URL: chrome://global/locale/intl.properties\nnsNativeModuleLoader::LoadModule(\"c:\\talos-slave\\test\\build\\firefox\\components\\xpcomsample.dll\") - load FAILED, rv: 80520012, error:\n\t<unknown; can't get error from NSPR>\nWARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80004005: file e:/builds/moz2_slave/cen-w32-dbg/build/netwerk/base/src/nsIOService.cpp, line 647\nCouldn't convert chrome URL: chrome://global-platform/locale/intl.properties\nWARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80004005: file e:/builds/moz2_slave/cen-w32-dbg/build/netwerk/base/src/nsIOService.cpp, line 647\npldhash: for the table at address 02679B08, the given entrySize of 48 probably favors chaining over double hashing.\ncreating 1!\n[TabChild] SHOW (w,h)= (0, 0)\n\n^ what? creating a content process? who? what?\n\npldhash: for the table at address 035041D8, the given entrySize of 48 probably favors chaining over double hashing.\nWARNING: shadow layers no sprechen D3D backend yet: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/ipc/RenderFrameParent.cpp, line 699\n++DOCSHELL 03504170 == 1\n++DOMWINDOW == 1 (02733238) [serial = 1] [outer = 00000000]\nloading about:blank, 1\npldhash: for the table at address 0344C258, the given entrySize of 56 probably favors chaining over double hashing.\nWARNING: Subdocument container has no content: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/base/nsDocumentViewer.cpp, line 2401\n++DOMWINDOW == 2 (03545248) [serial = 2] [outer = 027331E8]\nWARNING: NS_ENSURE_TRUE(sf) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/docshell/base/nsDocShell.cpp, line 4996\nWARNING: NS_ENSURE_TRUE(sf) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/docshell/base/nsDocShell.cpp, line 4996\n[TabChild] RESIZE to (w,h)= (126d, 10d)\n[TabChild] RESIZE to (w,h)= (494d, 472d)\nWARNING: Subdocument container has no content: file e:/builds/moz2_slave/cen-w32-dbg/build/layout/base/nsDocumentViewer.cpp, line 2401\n++DOMWINDOW == 3 (036589F0) [serial = 3] [outer = 027331E8]\n\n###!!! [Parent][AsyncChannel] Error: Value error: message was deserialized, but contained an illegal value\n\n^ ohnoz\n\nWARNING: NS_ENSURE_SUCCESS(rv, 0) failed with result 0x8000FFFF: file e:/builds/moz2_slave/cen-w32-dbg/build/content/base/src/nsContentUtils.cpp, line 2905\nWARNING: NS_ENSURE_TRUE(pusher.Push(aBoundElement)) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/content/xbl/src/nsXBLProtoImplMethod.cpp, line 327\nWARNING: NS_ENSURE_SUCCESS(rv, 0) failed with result 0x8000FFFF: file e:/builds/moz2_slave/cen-w32-dbg/build/content/base/src/nsContentUtils.cpp, line 2905\nWARNING: NS_ENSURE_TRUE(pusher.Push(aBoundElement)) failed: file e:/builds/moz2_slave/cen-w32-dbg/build/content/xbl/src/nsXBLProtoImplMethod.cpp, line 327\nTEST-PASS | chrome://mochitests/content/browser/dom/tests/browser/browser_643083.js | Completed message to close window\nINFO TEST-END | chrome://mochitests/content/browser/dom/tests/browser/browser_643083.js | finished in 670ms\nTEST-INFO | checking window state\nTEST-INFO | before wait for focus -- loaded: complete active window: ([object ChromeWindow @ 0x80ca338 (native @ 0x80e6388)]) chrome://browser/content/browser.xul focused window: ([object XrayWrapper [object Window @ 0x1c116aa0 (native @ 0x1adf7b10)]]) http://mochi.test:8888/browser/docshell/test/navigation/bug343515_pg3.html desired window: ([object ChromeWindow @ 0x80ca338 (native @ 0x80e6388)]) chrome://browser/content/browser.xul child window: ([object XrayWrapper [object Window @ 0x1c116aa0 (native @ 0x1adf7b10)]]) http://mochi.test:8888/browser/docshell/test/navigation/bug343515_pg3.html docshell visible: true\nTEST-INFO | already focused\nTEST-INFO | maybe run tests <load:true, focus:true> -- loaded: complete active window: ([object ChromeWindow @ 0x80ca338 (native @ 0x80e6388)]) chrome://browser/content/browser.xul focused window: ([object XrayWrapper [object Window @ 0x1c116aa0 (native @ 0x1adf7b10)]]) http://mochi.test:8888/browser/docshell/test/navigation/bug343515_pg3.html desired window: ([object ChromeWindow @ 0x80ca338 (native @ 0x80e6388)]) chrome://browser/content/browser.xul child window: ([object XrayWrapper [object Window @ 0x1c116aa0 (native @ 0x1adf7b10)]]) http://mochi.test:8888/browser/docshell/test/navigation/bug343515_pg3.html docshell visible: true\nTEST-START | chrome://mochitests/content/browser/dom/tests/browser/browser_ConsoleAPITests.js\npldhash: for the table at address 19C9C1B8, the given entrySize of 48 probably favors chaining over double hashing.\n++DOCSHELL 19C9C150 == 14\n++DOMWINDOW == 309 (1ADF66C8) [serial = 4955] [outer = 00000000]\n++DOMWINDOW == 310 (1F434BB0) [serial = 4956] [outer = 1ADF6678]\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][SyncChannel] Error: Route error: message sent to unknown actor ID\n\n^ crashy mccrashcrash", "creation_time": "2011-04-11T20:28:44Z", "is_private": false, "bug_id": 646566, "creator": "josh@joshmatthews.net", "time": "2011-04-11T20:28:44Z", "tags": [], "count": 13}, {"author": "ben@stechz.com", "bug_id": 646566, "tags": [], "creator": "ben@stechz.com", "count": 14, "text": "The test is in: https://bugzilla.mozilla.org/show_bug.cgi?id=643083\n\nIt does in fact need to create a content process to run the test.", "creation_time": "2011-04-11T20:31:55Z", "raw_text": "The test is in: https://bugzilla.mozilla.org/show_bug.cgi?id=643083\n\nIt does in fact need to create a content process to run the test.", "id": 5401392, "attachment_id": null, "time": "2011-04-11T20:31:55Z", "is_private": false}, {"raw_text": "(In reply to comment #10)\n> I don't quite understand how to move forward on this. If this is only happening\n> sometimes on Mac, will I need a Mac build? Or can this be debugged on Linux?\n\nHave you tried to reproduce locally?", "id": 5401465, "text": "(In reply to comment #10)\n> I don't quite understand how to move forward on this. If this is only happening\n> sometimes on Mac, will I need a Mac build? Or can this be debugged on Linux?\n\nHave you tried to reproduce locally?", "creation_time": "2011-04-11T20:50:10Z", "bug_id": 646566, "creator": "cjones.bugs@gmail.com", "tags": [], "count": 15, "author": "cjones.bugs@gmail.com", "is_private": false, "time": "2011-04-11T20:50:10Z", "attachment_id": null}, {"author": "ben@stechz.com", "text": "(In reply to comment #15)\n> (In reply to comment #10)\n> > I don't quite understand how to move forward on this. If this is only happening\n> > sometimes on Mac, will I need a Mac build? Or can this be debugged on Linux?\n> \n> Have you tried to reproduce locally?\n\nWorks fine on Linux. So far I can't repro on Mac.", "creation_time": "2011-04-11T20:51:07Z", "raw_text": "(In reply to comment #15)\n> (In reply to comment #10)\n> > I don't quite understand how to move forward on this. If this is only happening\n> > sometimes on Mac, will I need a Mac build? Or can this be debugged on Linux?\n> \n> Have you tried to reproduce locally?\n\nWorks fine on Linux. So far I can't repro on Mac.", "id": 5401468, "bug_id": 646566, "creator": "ben@stechz.com", "tags": [], "count": 16, "attachment_id": null, "is_private": false, "time": "2011-04-11T20:51:07Z"}, {"author": "ben@stechz.com", "creator": "ben@stechz.com", "count": 17, "tags": [], "bug_id": 646566, "creation_time": "2011-04-12T16:56:12Z", "text": "jdm says mozilla::ipc::AsyncChannel::PrintErrorMessage is a good place to break. AllocPXXX is returning null.\n\nHere is the latest try run for bug 643083.\n\nhttp://tinderbox.mozilla.org/showlog.cgi?log=MozillaTry/1302590144.1302594887.10030.gz&fulltext=1", "id": 5403989, "raw_text": "jdm says mozilla::ipc::AsyncChannel::PrintErrorMessage is a good place to break. AllocPXXX is returning null.\n\nHere is the latest try run for bug 643083.\n\nhttp://tinderbox.mozilla.org/showlog.cgi?log=MozillaTry/1302590144.1302594887.10030.gz&fulltext=1", "attachment_id": null, "time": "2011-04-12T16:56:12Z", "is_private": false}, {"attachment_id": null, "author": "josh@joshmatthews.net", "creation_time": "2011-04-12T16:58:42Z", "is_private": false, "text": "###!!! [Parent][AsyncChannel] Error: Value error: message was deserialized, but contained an illegal value\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][SyncChannel] Error: Route error: message sent to unknown actor ID\n\n\nI find these errors quite interesting, especially because the parent process doesn't die.  That means that we're looking at one of:\n\n1) in a constructor message, AllocPWhatever returns null.\n2) a shared memory destruction message, looking up the id returns null\n\ncjones, any particular reason neither of these are fatal errors?", "id": 5403995, "raw_text": "###!!! [Parent][AsyncChannel] Error: Value error: message was deserialized, but contained an illegal value\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][AsyncChannel] Error: Route error: message sent to unknown actor ID\n\n\n###!!! [Parent][SyncChannel] Error: Route error: message sent to unknown actor ID\n\n\nI find these errors quite interesting, especially because the parent process doesn't die.  That means that we're looking at one of:\n\n1) in a constructor message, AllocPWhatever returns null.\n2) a shared memory destruction message, looking up the id returns null\n\ncjones, any particular reason neither of these are fatal errors?", "count": 18, "time": "2011-04-12T16:58:42Z", "tags": [], "creator": "josh@joshmatthews.net", "bug_id": 646566}, {"time": "2011-04-12T19:29:58Z", "is_private": false, "attachment_id": null, "bug_id": 646566, "tags": [], "count": 19, "creator": "cjones.bugs@gmail.com", "text": "We might never turn on fatal errors in the chrome process (in the sense of chrome process aborting).  IIRC those errors in the chrome process result in the content process being killed, but it looks like they're happening after the content process dies anyway.  Those errors are fatal in content processes though.", "creation_time": "2011-04-12T19:29:58Z", "raw_text": "We might never turn on fatal errors in the chrome process (in the sense of chrome process aborting).  IIRC those errors in the chrome process result in the content process being killed, but it looks like they're happening after the content process dies anyway.  Those errors are fatal in content processes though.", "id": 5404519, "author": "cjones.bugs@gmail.com"}, {"bug_id": 646566, "count": 20, "tags": [], "time": "2011-04-12T20:13:19Z", "creator": "josh@joshmatthews.net", "text": "Sorry, terminology mismatch here.  I'm specifically referring to the FatalError function that's called like so:\n\n>            if ((!(Read((&(__handle)), (&(__msg)), (&(__iter)))))) {\n>                FatalError(\"error deserializing (better message TODO)\");\n>                return MsgValueError;\n>            }\n\nwhich does kill off the child process.  Contrast that with\n\n>            actor = AllocPCrashReporter();\n>            if ((!(actor))) {\n>                return MsgValueError;\n>            }\n\nand \n\n>            Shmem::SharedMemory* rawmem = LookupSharedMemory(id);\n>            if ((!(rawmem))) {\n>                return MsgValueError;\n>            }\n\nThe content process doesn't die during this test, as far as I tell.  It appears to die later (intentionally), during test_process_error.xul when there's this output:\n\n###!!! [Parent][AsyncChannel] Error: Value error: message was deserialized, but contained an illegal value\n\n\n###!!! [Parent][AsyncChannel] Error: Channel error: cannot send/recv", "is_private": false, "creation_time": "2011-04-12T20:13:19Z", "raw_text": "Sorry, terminology mismatch here.  I'm specifically referring to the FatalError function that's called like so:\n\n>            if ((!(Read((&(__handle)), (&(__msg)), (&(__iter)))))) {\n>                FatalError(\"error deserializing (better message TODO)\");\n>                return MsgValueError;\n>            }\n\nwhich does kill off the child process.  Contrast that with\n\n>            actor = AllocPCrashReporter();\n>            if ((!(actor))) {\n>                return MsgValueError;\n>            }\n\nand \n\n>            Shmem::SharedMemory* rawmem = LookupSharedMemory(id);\n>            if ((!(rawmem))) {\n>                return MsgValueError;\n>            }\n\nThe content process doesn't die during this test, as far as I tell.  It appears to die later (intentionally), during test_process_error.xul when there's this output:\n\n###!!! [Parent][AsyncChannel] Error: Value error: message was deserialized, but contained an illegal value\n\n\n###!!! [Parent][AsyncChannel] Error: Channel error: cannot send/recv", "id": 5404622, "author": "josh@joshmatthews.net", "attachment_id": null}, {"time": "2011-04-12T21:21:43Z", "is_private": false, "attachment_id": null, "count": 21, "tags": [], "creator": "ben@stechz.com", "bug_id": 646566, "id": 5404853, "raw_text": "What happens to messages that can't be read from shared memory? Maybe they get flushed at the very end or something strange like that?", "creation_time": "2011-04-12T21:21:43Z", "text": "What happens to messages that can't be read from shared memory? Maybe they get flushed at the very end or something strange like that?", "author": "ben@stechz.com"}, {"author": "ben@stechz.com", "attachment_id": null, "bug_id": 646566, "count": 22, "creator": "ben@stechz.com", "time": "2011-04-13T22:20:55Z", "tags": [], "raw_text": "This is not reproducing on Doug's Windows 7 machine either.", "id": 5407987, "text": "This is not reproducing on Doug's Windows 7 machine either.", "creation_time": "2011-04-13T22:20:55Z", "is_private": false}, {"tags": [], "count": 23, "creator": "ben@stechz.com", "bug_id": 646566, "id": 5408039, "raw_text": "I have never been able to reproduce this issue. I think I need access to a Windows 6.1 VM that runs our automation tests. I've asked Lukas for a test machine to get this to reproduce.", "creation_time": "2011-04-13T22:38:24Z", "text": "I have never been able to reproduce this issue. I think I need access to a Windows 6.1 VM that runs our automation tests. I've asked Lukas for a test machine to get this to reproduce.", "author": "ben@stechz.com", "time": "2011-04-13T22:38:24Z", "is_private": false, "attachment_id": null}, {"attachment_id": 526059, "author": "ben@stechz.com", "count": 24, "creator": "ben@stechz.com", "time": "2011-04-14T18:28:20Z", "tags": [], "bug_id": 646566, "creation_time": "2011-04-14T18:28:20Z", "is_private": false, "text": "Created attachment 526059\nLog for --test-path=dom", "id": 5410016, "raw_text": ""}, {"attachment_id": null, "is_private": false, "time": "2011-04-14T18:35:41Z", "author": "ben@stechz.com", "id": 5410039, "raw_text": "Most important from the log is what the default process leaked:\n\n     |<----------------Class--------------->|<-----Bytes------>|<----------------Objects---------------->|<--------------References-------------->|\n                                              Per-Inst   Leaked    Total      Rem      Mean       StdDev     Total      Rem      Mean       StdDev\n   0 TOTAL                                          17      992  8446169       18 ( 2670.86 +/-  4118.34) 10786589       10 ( 3556.48 +/-  5866.90)\n 124 Monitor                                        16       16      582        1 (   60.53 +/-    24.02)        0        0 (    0.00 +/-     0.00)\n 125 Mutex                                          12       36      967        3 (  101.97 +/-    22.51)        0        0 (    0.00 +/-     0.00)\n 760 nsStringBuffer                                  8       16   242726        2 (10298.46 +/-  1722.65)   366600        2 (15965.49 +/-  2740.02)\n 802 nsTArray_base                                   4       12   607851        3 (15634.68 +/-  3566.20)        0        0 (    0.00 +/-     0.00)\n 815 nsThread                                      128      128       25        1 (   10.47 +/-     4.84)    87858        2 (  116.95 +/-    11.12)\n 819 nsTimerImpl                                    72      144     1771        2 (   38.71 +/-     6.59)    10000        2 (   68.12 +/-    10.80)\n 848 nsVoidArray                                     4        8   107440        2 ( 1983.22 +/-   462.15)        0        0 (    0.00 +/-     0.00)\n 854 nsWebShellWindow                              168      336        4        2 (    2.50 +/-     1.05)      484        2 (    6.33 +/-     1.38)\n 930 nsXULWindow                                   148      296        4        2 (    2.50 +/-     1.05)      484        2 (    6.33 +/-     1.38)", "creation_time": "2011-04-14T18:35:41Z", "text": "Most important from the log is what the default process leaked:\n\n     |<----------------Class--------------->|<-----Bytes------>|<----------------Objects---------------->|<--------------References-------------->|\n                                              Per-Inst   Leaked    Total      Rem      Mean       StdDev     Total      Rem      Mean       StdDev\n   0 TOTAL                                          17      992  8446169       18 ( 2670.86 +/-  4118.34) 10786589       10 ( 3556.48 +/-  5866.90)\n 124 Monitor                                        16       16      582        1 (   60.53 +/-    24.02)        0        0 (    0.00 +/-     0.00)\n 125 Mutex                                          12       36      967        3 (  101.97 +/-    22.51)        0        0 (    0.00 +/-     0.00)\n 760 nsStringBuffer                                  8       16   242726        2 (10298.46 +/-  1722.65)   366600        2 (15965.49 +/-  2740.02)\n 802 nsTArray_base                                   4       12   607851        3 (15634.68 +/-  3566.20)        0        0 (    0.00 +/-     0.00)\n 815 nsThread                                      128      128       25        1 (   10.47 +/-     4.84)    87858        2 (  116.95 +/-    11.12)\n 819 nsTimerImpl                                    72      144     1771        2 (   38.71 +/-     6.59)    10000        2 (   68.12 +/-    10.80)\n 848 nsVoidArray                                     4        8   107440        2 ( 1983.22 +/-   462.15)        0        0 (    0.00 +/-     0.00)\n 854 nsWebShellWindow                              168      336        4        2 (    2.50 +/-     1.05)      484        2 (    6.33 +/-     1.38)\n 930 nsXULWindow                                   148      296        4        2 (    2.50 +/-     1.05)      484        2 (    6.33 +/-     1.38)", "tags": [], "creator": "ben@stechz.com", "count": 25, "bug_id": 646566}, {"time": "2011-04-14T20:24:22Z", "is_private": false, "attachment_id": null, "creator": "ben@stechz.com", "count": 26, "tags": [], "bug_id": 646566, "id": 5410344, "raw_text": "I'm not getting anywhere with this bug. Instead of quickly creating and destroying a xul window, I think I'm going to try something different (like opening a new remote tab) and get this off my plate.\n\nHere's the diff that causes the problem in case anyone decides to figure this out later:\nhttps://bugzilla.mozilla.org/attachment.cgi?id=520409&action=diff\n\nI suppose this could be a bad bug that might bite us in other ways later, but I'm at my wit's end.", "creation_time": "2011-04-14T20:24:22Z", "text": "I'm not getting anywhere with this bug. Instead of quickly creating and destroying a xul window, I think I'm going to try something different (like opening a new remote tab) and get this off my plate.\n\nHere's the diff that causes the problem in case anyone decides to figure this out later:\nhttps://bugzilla.mozilla.org/attachment.cgi?id=520409&action=diff\n\nI suppose this could be a bad bug that might bite us in other ways later, but I'm at my wit's end.", "author": "ben@stechz.com"}]}}}