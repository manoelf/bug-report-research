{"comments": {}, "bugs": {"677360": {"comments": [{"author": "rkent@caspia.com", "creator": "rkent@caspia.com", "time": "2011-08-08T21:01:38Z", "attachment_id": null, "text": "I'm getting this in a debug build of Thunderbird, with the comm-aurora repository at  8165:56aa3a1b61e2, and mozilla-aurora at 72744:1539927cf9ba  I have quite a bit of detail of this, so I'll record that in case it will be useful in fixing.\n\nThe error is occurring while Thunderbird is trying to get the attachment of an IMAP spam message, for stack see bug 668944 comment 29.\n\nI have details of the text that is being fed into xpcom and leading to the assertion.\n\nIn xpcconvert.cpp this line:\n\n                    jschar *p = (jschar *)UTF8ToNewUnicode(*cString, &len);\n                    \n*cString.mData is:\n\n0x0E37BCE8  46 77 64 3a 20 50 72 6f 66 69 74 65 7a 20 64 65 73 20 6a  Fwd: Profitez des j\n0x0E37BCFB  65 75 78 20 61 75 20 6a 61 63 6b 70 6f 74 20 70 72 6f 67  eux au jackpot prog\n0x0E37BD0E  72 65 73 73 69 66 20 67 72 e2 63 65 20 61 75 20 62 6f 6e  ressif gr\u00e2ce au bon\n0x0E37BD21  75 73 20 64 65 20 62 69 65 6e 76 65 6e 75 65 20 70 6f 75  us de bienvenue pou\n0x0E37BD34  72 20 6c 65 73 20 6e 6f 75 76 65 61 75 78 20 6a 6f 75 65  r les nouveaux joue\n0x0E37BD47  75 72 73 2e 2e 65 6d 6c 00 cd cd cd cd cd cd cd cd cd cd  urs..eml.\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\n\nreturned length is 101  However, *p is:\n\n0x079C9218  46 00 77 00 64 00 3a 00 20 00 50 00 72 00 6f 00 66  F.w.d.:. .P.r.o.f\n0x079C9229  00 69 00 74 00 65 00 7a 00 20 00 64 00 65 00 73 00  .i.t.e.z. .d.e.s.\n0x079C923A  20 00 6a 00 65 00 75 00 78 00 20 00 61 00 75 00 20   .j.e.u.x. .a.u. \n0x079C924B  00 6a 00 61 00 63 00 6b 00 70 00 6f 00 74 00 20 00  .j.a.c.k.p.o.t. .\n0x079C925C  70 00 72 00 6f 00 67 00 72 00 65 00 73 00 73 00 69  p.r.o.g.r.e.s.s.i\n0x079C926D  00 66 00 20 00 67 00 72 00 00 00 cd cd cd cd cd cd  .f. .g.r...\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\n0x079C927E  cd cd cd cd cd cd cd cd cd cd cd cd cd cd cd cd cd  \u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\n\nSo something is going wrong with the decoding of \"gr\u00e2ce\"\n\nThis line starts the code that leads to the assertion:\n\n                    JSString* jsString =\n                        JS_NewExternalString(cx, p, len,\n                                             sXPCOMUCStringFinalizerIndex);\n\nI see:\n\n###!!! ASSERTION: length mismatch: 'calculator.Length() == converter.Length()',\nfile c:/tb/aurora/src/mozilla/xpcom/string/src/nsReadableUtils.cpp, line 402\nAssertion failure: chars[length] == 0, at c:\\tb\\aurora\\src\\mozilla\\js\\src\\vm/Str\ning-inl.h:171", "raw_text": "I'm getting this in a debug build of Thunderbird, with the comm-aurora repository at  8165:56aa3a1b61e2, and mozilla-aurora at 72744:1539927cf9ba  I have quite a bit of detail of this, so I'll record that in case it will be useful in fixing.\n\nThe error is occurring while Thunderbird is trying to get the attachment of an IMAP spam message, for stack see bug 668944 comment 29.\n\nI have details of the text that is being fed into xpcom and leading to the assertion.\n\nIn xpcconvert.cpp this line:\n\n                    jschar *p = (jschar *)UTF8ToNewUnicode(*cString, &len);\n                    \n*cString.mData is:\n\n0x0E37BCE8  46 77 64 3a 20 50 72 6f 66 69 74 65 7a 20 64 65 73 20 6a  Fwd: Profitez des j\n0x0E37BCFB  65 75 78 20 61 75 20 6a 61 63 6b 70 6f 74 20 70 72 6f 67  eux au jackpot prog\n0x0E37BD0E  72 65 73 73 69 66 20 67 72 e2 63 65 20 61 75 20 62 6f 6e  ressif gr\u00e2ce au bon\n0x0E37BD21  75 73 20 64 65 20 62 69 65 6e 76 65 6e 75 65 20 70 6f 75  us de bienvenue pou\n0x0E37BD34  72 20 6c 65 73 20 6e 6f 75 76 65 61 75 78 20 6a 6f 75 65  r les nouveaux joue\n0x0E37BD47  75 72 73 2e 2e 65 6d 6c 00 cd cd cd cd cd cd cd cd cd cd  urs..eml.\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\n\nreturned length is 101  However, *p is:\n\n0x079C9218  46 00 77 00 64 00 3a 00 20 00 50 00 72 00 6f 00 66  F.w.d.:. .P.r.o.f\n0x079C9229  00 69 00 74 00 65 00 7a 00 20 00 64 00 65 00 73 00  .i.t.e.z. .d.e.s.\n0x079C923A  20 00 6a 00 65 00 75 00 78 00 20 00 61 00 75 00 20   .j.e.u.x. .a.u. \n0x079C924B  00 6a 00 61 00 63 00 6b 00 70 00 6f 00 74 00 20 00  .j.a.c.k.p.o.t. .\n0x079C925C  70 00 72 00 6f 00 67 00 72 00 65 00 73 00 73 00 69  p.r.o.g.r.e.s.s.i\n0x079C926D  00 66 00 20 00 67 00 72 00 00 00 cd cd cd cd cd cd  .f. .g.r...\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\n0x079C927E  cd cd cd cd cd cd cd cd cd cd cd cd cd cd cd cd cd  \u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\n\nSo something is going wrong with the decoding of \"gr\u00e2ce\"\n\nThis line starts the code that leads to the assertion:\n\n                    JSString* jsString =\n                        JS_NewExternalString(cx, p, len,\n                                             sXPCOMUCStringFinalizerIndex);\n\nI see:\n\n###!!! ASSERTION: length mismatch: 'calculator.Length() == converter.Length()',\nfile c:/tb/aurora/src/mozilla/xpcom/string/src/nsReadableUtils.cpp, line 402\nAssertion failure: chars[length] == 0, at c:\\tb\\aurora\\src\\mozilla\\js\\src\\vm/Str\ning-inl.h:171", "creation_time": "2011-08-08T21:01:38Z", "bug_id": 677360, "id": 5640535, "tags": [], "count": 0, "is_private": false}, {"creator": "jonathan.protzenko@gmail.com", "author": "jonathan.protzenko@gmail.com", "creation_time": "2011-08-09T02:44:09Z", "raw_text": "That would explain the random reading in the memory described in bug 676882. Can you try out with a fresh comm-central build see if this is fixed?", "text": "That would explain the random reading in the memory described in bug 676882. Can you try out with a fresh comm-central build see if this is fixed?", "time": "2011-08-09T02:44:09Z", "attachment_id": null, "tags": [], "count": 1, "is_private": false, "id": 5641342, "bug_id": 677360}, {"bug_id": 677360, "tags": [], "is_private": false, "count": 2, "id": 5641448, "text": "Is there some specific patch that you expect fixes it?", "time": "2011-08-09T04:38:14Z", "attachment_id": null, "raw_text": "Is there some specific patch that you expect fixes it?", "creation_time": "2011-08-09T04:38:14Z", "creator": "rkent@caspia.com", "author": "rkent@caspia.com"}, {"text": "The patch that I commited in bug 676882", "time": "2011-08-09T04:39:18Z", "attachment_id": null, "creation_time": "2011-08-09T04:39:18Z", "raw_text": "The patch that I commited in bug 676882", "bug_id": 677360, "count": 3, "is_private": false, "tags": [], "id": 5641450, "creator": "jonathan.protzenko@gmail.com", "author": "jonathan.protzenko@gmail.com"}, {"creator": "rkent@caspia.com", "author": "rkent@caspia.com", "text": "That's why I asked. First, I don't see any evidence that you committed that patch. Second, your patch seems to deal with a munged subject, but this issue of mine (which probably has the same root cause) is in the title of the attachment (which happens to be a message that SpamAssassin converted into an attachment).\n\nBut I will test it anyway.", "time": "2011-08-09T04:45:33Z", "attachment_id": null, "creation_time": "2011-08-09T04:45:33Z", "raw_text": "That's why I asked. First, I don't see any evidence that you committed that patch. Second, your patch seems to deal with a munged subject, but this issue of mine (which probably has the same root cause) is in the title of the attachment (which happens to be a message that SpamAssassin converted into an attachment).\n\nBut I will test it anyway.", "bug_id": 677360, "is_private": false, "count": 4, "tags": [], "id": 5641456}, {"bug_id": 677360, "id": 5641468, "count": 5, "is_private": false, "tags": [], "time": "2011-08-09T05:00:06Z", "attachment_id": null, "text": "I'm sorry I meant bug 674488. I'll commit the patch in bug 676882 tomorrow so you might want to wait until then. Sorry for the confusion.", "creation_time": "2011-08-09T05:00:06Z", "raw_text": "I'm sorry I meant bug 674488. I'll commit the patch in bug 676882 tomorrow so you might want to wait until then. Sorry for the confusion.", "author": "jonathan.protzenko@gmail.com", "creator": "jonathan.protzenko@gmail.com"}, {"bug_id": 677360, "id": 5642540, "is_private": false, "count": 6, "tags": [], "attachment_id": null, "time": "2011-08-09T16:48:50Z", "text": "The problem does not occur with Thunderbird trunk 8266:ef977dca2337 (which I think means bug 674488 landed but not bug 676882)\n\nTo the XPCOM types: this just means that Thunderbird has a workaround, the core bug presumably still exists.", "raw_text": "The problem does not occur with Thunderbird trunk 8266:ef977dca2337 (which I think means bug 674488 landed but not bug 676882)\n\nTo the XPCOM types: this just means that Thunderbird has a workaround, the core bug presumably still exists.", "creation_time": "2011-08-09T16:48:50Z", "author": "rkent@caspia.com", "creator": "rkent@caspia.com"}, {"author": "jonathan.protzenko@gmail.com", "creator": "jonathan.protzenko@gmail.com", "creation_time": "2011-08-09T16:51:30Z", "raw_text": "Absolutely, the core bug still lurks around.", "attachment_id": null, "time": "2011-08-09T16:51:30Z", "text": "Absolutely, the core bug still lurks around.", "id": 5642550, "tags": [], "count": 7, "is_private": false, "bug_id": 677360}]}}}