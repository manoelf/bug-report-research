{"comments": {}, "bugs": {"624082": {"comments": [{"raw_text": "User-Agent:       Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20101215 Gentoo Firefox/3.6.13\nBuild Identifier: Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20110107 Lightning/1.0b3pre Thunderbird/3.1.7\n\nMoving a large number of messages to different folders can lead to some of them getting lost: they disappear from the original folder, but don't appear in their target folder. On the imap server, the messages are still in the original folder, but TB won't display them, probably due to some UID mismatch.\n\nReproducible: Sometimes\n\nSteps to Reproduce:\n1. Move a large number of messages from folder A to folder B\n2. Quickly after that move remaining messages from folder A to folder C\n3. Wait till the busy cursor disappears\nActual Results:  \nFirst bunch of messages visible in B, second bunch not visible in TB at all, but present in A in the maildir store on the server.\n\nExpected Results:  \nMessages moved to B and C, or if that shouldn't work for some reason, still visible in A.\n\nDid wireshark the connection after the problem had already occurred. TB didn't ask for any kind of message listing from the server for folder A. It simply displayed it empty, no matter how often I switched folders. Probably because the maximum UID was somehow persistently marked as \"seen\", \"retrieved\" or whatever.", "id": 5184309, "text": "User-Agent:       Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20101215 Gentoo Firefox/3.6.13\nBuild Identifier: Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.2.13) Gecko/20110107 Lightning/1.0b3pre Thunderbird/3.1.7\n\nMoving a large number of messages to different folders can lead to some of them getting lost: they disappear from the original folder, but don't appear in their target folder. On the imap server, the messages are still in the original folder, but TB won't display them, probably due to some UID mismatch.\n\nReproducible: Sometimes\n\nSteps to Reproduce:\n1. Move a large number of messages from folder A to folder B\n2. Quickly after that move remaining messages from folder A to folder C\n3. Wait till the busy cursor disappears\nActual Results:  \nFirst bunch of messages visible in B, second bunch not visible in TB at all, but present in A in the maildir store on the server.\n\nExpected Results:  \nMessages moved to B and C, or if that shouldn't work for some reason, still visible in A.\n\nDid wireshark the connection after the problem had already occurred. TB didn't ask for any kind of message listing from the server for folder A. It simply displayed it empty, no matter how often I switched folders. Probably because the maximum UID was somehow persistently marked as \"seen\", \"retrieved\" or whatever.", "time": "2011-01-08T02:38:56Z", "is_private": false, "count": 0, "tags": [], "creator": "Martin.vGagern@gmx.net", "author": "Martin.vGagern@gmx.net", "attachment_id": null, "bug_id": 624082, "creation_time": "2011-01-08T02:38:56Z"}, {"creation_time": "2011-01-08T02:51:14Z", "creator": "Martin.vGagern@gmx.net", "text": "Renaming A.msf in the Profile/ImapMail/host.name directory makes the messages reappear. That's a good workaround if you notice that there actually are missing messages.", "id": 5184340, "time": "2011-01-08T02:51:14Z", "is_private": false, "attachment_id": null, "bug_id": 624082, "tags": [], "author": "Martin.vGagern@gmx.net", "count": 1, "raw_text": "Renaming A.msf in the Profile/ImapMail/host.name directory makes the messages reappear. That's a good workaround if you notice that there actually are missing messages."}, {"creator": "vseerror@lehigh.edu", "creation_time": "2011-01-08T14:08:52Z", "time": "2011-01-08T14:08:52Z", "text": "Or in the UI, you can right+click the folder > properties > repair.\n\nwhat is \"a large number\"?", "id": 5184840, "is_private": false, "author": "vseerror@lehigh.edu", "tags": [], "bug_id": 624082, "attachment_id": null, "raw_text": "Or in the UI, you can right+click the folder > properties > repair.\n\nwhat is \"a large number\"?", "count": 2}, {"attachment_id": null, "bug_id": 624082, "tags": [], "author": "Martin.vGagern@gmx.net", "count": 3, "raw_text": "(In reply to comment #2)\n> Or in the UI, you can right+click the folder > properties > repair.\n\nThanks, hadn't known that. Might be useful!\n\n> what is \"a large number\"?\n\n700+ to B, then 1100+ to C. By the way, dovecot on localhost is the imap server in this case, and it reported no error to syslog, while they claim to always generate output if anything goes wrong. So I assume the server to be OK here.\n\nAfter some consideration, I believe that having the messages disappear from their origin folder almost immediately might be a good thing in terms of a responsive UI. But that change in what TB considers the state of that folder should only be made permanent when the mails actually have been moved, i.e. when the move command has been sent and confirmed. From my observation I presume that current behaviour is somewhat different. So if something goes wrong, you can be certain that at least after the next restart of TB you see what's actually there. A discrepancy in the number of messages in some folder might be an indication of a broken msf file as well, and as far as I can see, IMAP provides that number along with the maximum UID.", "creation_time": "2011-01-08T14:55:39Z", "creator": "Martin.vGagern@gmx.net", "text": "(In reply to comment #2)\n> Or in the UI, you can right+click the folder > properties > repair.\n\nThanks, hadn't known that. Might be useful!\n\n> what is \"a large number\"?\n\n700+ to B, then 1100+ to C. By the way, dovecot on localhost is the imap server in this case, and it reported no error to syslog, while they claim to always generate output if anything goes wrong. So I assume the server to be OK here.\n\nAfter some consideration, I believe that having the messages disappear from their origin folder almost immediately might be a good thing in terms of a responsive UI. But that change in what TB considers the state of that folder should only be made permanent when the mails actually have been moved, i.e. when the move command has been sent and confirmed. From my observation I presume that current behaviour is somewhat different. So if something goes wrong, you can be certain that at least after the next restart of TB you see what's actually there. A discrepancy in the number of messages in some folder might be an indication of a broken msf file as well, and as far as I can see, IMAP provides that number along with the maximum UID.", "id": 5184866, "time": "2011-01-08T14:55:39Z", "is_private": false}, {"is_private": false, "time": "2011-12-26T11:57:48Z", "id": 5939829, "text": "I can confirm this. I'm running hMailserver and moved about 70 folders from my local folders to the IMAP server. even when moving small folders with just 200 messages a bunch of messages were missing. I tried multiple times, but the messages were missing over and over again. Manually copying *just* the missing messages worked though.", "creator": "fesoft@gmx.net", "creation_time": "2011-12-26T11:57:48Z", "raw_text": "I can confirm this. I'm running hMailserver and moved about 70 folders from my local folders to the IMAP server. even when moving small folders with just 200 messages a bunch of messages were missing. I tried multiple times, but the messages were missing over and over again. Manually copying *just* the missing messages worked though.", "count": 4, "author": "fesoft@gmx.net", "tags": [], "bug_id": 624082, "attachment_id": null}, {"is_private": false, "time": "2012-01-05T08:32:02Z", "id": 5956457, "text": "(In reply to Martin von Gagern from comment #0)\n> Steps to Reproduce:\n> 1. Move a large number of messages from folder A to folder B\n> 2. Quickly after that move remaining messages from folder A to folder C\n> 3. Wait till the busy cursor disappears\n> Actual Results:  \n> First bunch of messages visible in B, second bunch not visible in TB at all,\n> but present in A in the maildir store on the server.\n(In reply to Martin von Gagern from comment #1)\n> Renaming A.msf in the Profile/ImapMail/host.name directory makes the\n> messages reappear.\n\nThese indicate;\n- Tb doesn't store \\Deleted flag to disappeared mails.\n  (mails which were not copied to move target folder B but not shown at folder A)\n- Tb wrongly removes mail's meta data from .msf which was not successfully copied.\n  (I assume you use \"Move to Trash\" model or \"Remove immediately\" model.)\n- Because \"renaming A.msf\" is similar to \"Repair Folders\", all active mails in\n  folder A at IMAP server(mails without \\Deleted flag) is re-fetched from server.\n\nIf IMAP delete model of \"Just Mark it as Deleted\", deleted mail(\\Deleted flag is stored) is shown with strike thru line at thread pane by Tb.\nTo Martin von Gagern (bug opener):\nCan you check next when you can reproduce your problem with \"Just Mark it as Deleted\" model?\n(1) Write down UID of all mails in folder A for which you requested \"move to B\".\n    Execute your test with \"Just Mark it as Deleted\".\n    Show \"Order Received\" column(value is UID of mail if IMAP)\n    and check UIDs of mails with strike-thru line at thread pane of folder A.\n(2) Check mails in folder A via second Tb instance. \n    Create a new Tb profile(call P2), define the IMAP account only,\n    disable Global Indexer and Search, unckeck \"Keep messages on this computer...\"\n    of Synchronization&Disk Space, disable automatic new mail check,\n    disable automatic message purge(retention policy etc.),\n    select \"Just Mark it as Deleted\" at Server Settings.\n    Start second Tb with -no-remote mode using the new profile.\n      thunderbird.exe -no-remote -P \"P2\"\n    Click folder A, Show \"Order Received\" column.\n    Check which mail(which UID) in folder A is shown with strike-thru line by (1)\n    but mail of same UID is shown without strike-thru line by (2).\n\nNote:\nIf \"Just Mark it as Deleted\" model, you can execute Undelete of any mail of \\Deleted flag(shown with strike-thru line) any time via context menu of mail(s) at thread pane, unless Compact is requested(expunge command is issued, and mail of \\Deleted flag is erased at server).", "creator": "m-wada@usa.com", "creation_time": "2012-01-05T08:32:02Z", "raw_text": "(In reply to Martin von Gagern from comment #0)\n> Steps to Reproduce:\n> 1. Move a large number of messages from folder A to folder B\n> 2. Quickly after that move remaining messages from folder A to folder C\n> 3. Wait till the busy cursor disappears\n> Actual Results:  \n> First bunch of messages visible in B, second bunch not visible in TB at all,\n> but present in A in the maildir store on the server.\n(In reply to Martin von Gagern from comment #1)\n> Renaming A.msf in the Profile/ImapMail/host.name directory makes the\n> messages reappear.\n\nThese indicate;\n- Tb doesn't store \\Deleted flag to disappeared mails.\n  (mails which were not copied to move target folder B but not shown at folder A)\n- Tb wrongly removes mail's meta data from .msf which was not successfully copied.\n  (I assume you use \"Move to Trash\" model or \"Remove immediately\" model.)\n- Because \"renaming A.msf\" is similar to \"Repair Folders\", all active mails in\n  folder A at IMAP server(mails without \\Deleted flag) is re-fetched from server.\n\nIf IMAP delete model of \"Just Mark it as Deleted\", deleted mail(\\Deleted flag is stored) is shown with strike thru line at thread pane by Tb.\nTo Martin von Gagern (bug opener):\nCan you check next when you can reproduce your problem with \"Just Mark it as Deleted\" model?\n(1) Write down UID of all mails in folder A for which you requested \"move to B\".\n    Execute your test with \"Just Mark it as Deleted\".\n    Show \"Order Received\" column(value is UID of mail if IMAP)\n    and check UIDs of mails with strike-thru line at thread pane of folder A.\n(2) Check mails in folder A via second Tb instance. \n    Create a new Tb profile(call P2), define the IMAP account only,\n    disable Global Indexer and Search, unckeck \"Keep messages on this computer...\"\n    of Synchronization&Disk Space, disable automatic new mail check,\n    disable automatic message purge(retention policy etc.),\n    select \"Just Mark it as Deleted\" at Server Settings.\n    Start second Tb with -no-remote mode using the new profile.\n      thunderbird.exe -no-remote -P \"P2\"\n    Click folder A, Show \"Order Received\" column.\n    Check which mail(which UID) in folder A is shown with strike-thru line by (1)\n    but mail of same UID is shown without strike-thru line by (2).\n\nNote:\nIf \"Just Mark it as Deleted\" model, you can execute Undelete of any mail of \\Deleted flag(shown with strike-thru line) any time via context menu of mail(s) at thread pane, unless Compact is requested(expunge command is issued, and mail of \\Deleted flag is erased at server).", "count": 5, "author": "m-wada@usa.com", "tags": [], "bug_id": 624082, "attachment_id": null}, {"raw_text": "(In reply to Chris Brand from comment #4)\n> I can confirm this. I'm running hMailserver and moved about 70 folders from\n> my local folders to the IMAP server. even when moving small folders with\n> just 200 messages a bunch of messages were missing. I tried multiple times,\n> but the messages were missing over and over again. Manually copying *just*\n> the missing messages worked though.\n\nIf your problem is same problem as this bug, why you can manually copy from move source folder after the \"move failure\"(local mail folder in your case, although this bug is for \"move source folder=IMAP folder\" case and not-moved mail disappears from move source folder until Repair Folder.\n\n\"Move mail from local mail folder to IMAP folder\" consists of;\n(1) Upload mail data to IMAP server(append) == Copy step from local to IMAP.\n(2) Delete the mail from local mail folder.\n\"Delete\" in this context is same as \"Shift+Delete\" if local mail folder.\nSo, if a mail is once deleted, user can't see deleted mail any more, unless \"flag for deleted status in X-Mozilla-Status: header\" is manually reset and Repair Folder\" is executed.\nYour case is simply a \"copy failure\" during step (1), isn't it?\n\nMove mails by what kind of operation?\nSelect mails at thread pane, then Drag&Drop to IMAP folder?\nSelect mails at thread pane, then \"Move To\" of context menu?", "count": 6, "author": "m-wada@usa.com", "tags": [], "bug_id": 624082, "attachment_id": null, "time": "2012-01-05T08:55:09Z", "text": "(In reply to Chris Brand from comment #4)\n> I can confirm this. I'm running hMailserver and moved about 70 folders from\n> my local folders to the IMAP server. even when moving small folders with\n> just 200 messages a bunch of messages were missing. I tried multiple times,\n> but the messages were missing over and over again. Manually copying *just*\n> the missing messages worked though.\n\nIf your problem is same problem as this bug, why you can manually copy from move source folder after the \"move failure\"(local mail folder in your case, although this bug is for \"move source folder=IMAP folder\" case and not-moved mail disappears from move source folder until Repair Folder.\n\n\"Move mail from local mail folder to IMAP folder\" consists of;\n(1) Upload mail data to IMAP server(append) == Copy step from local to IMAP.\n(2) Delete the mail from local mail folder.\n\"Delete\" in this context is same as \"Shift+Delete\" if local mail folder.\nSo, if a mail is once deleted, user can't see deleted mail any more, unless \"flag for deleted status in X-Mozilla-Status: header\" is manually reset and Repair Folder\" is executed.\nYour case is simply a \"copy failure\" during step (1), isn't it?\n\nMove mails by what kind of operation?\nSelect mails at thread pane, then Drag&Drop to IMAP folder?\nSelect mails at thread pane, then \"Move To\" of context menu?", "id": 5956495, "is_private": false, "creator": "m-wada@usa.com", "creation_time": "2012-01-05T08:55:09Z"}, {"is_private": false, "raw_text": "Martin von Gagern(bug opener), see also bug 522675 and bug 693353, please.\nThese are for problem like next.\n Tb stores flag \\Deleted, even though fetch from IMAP server for \"move mail\" fails,\n or even though \"append to IMAP server for detach/delete\" fails.\nIn your case, \\Deleted flag doesn't look stored by Tb, however, similar mechanism is supected.", "text": "Martin von Gagern(bug opener), see also bug 522675 and bug 693353, please.\nThese are for problem like next.\n Tb stores flag \\Deleted, even though fetch from IMAP server for \"move mail\" fails,\n or even though \"append to IMAP server for detach/delete\" fails.\nIn your case, \\Deleted flag doesn't look stored by Tb, however, similar mechanism is supected.", "id": 5956511, "time": "2012-01-05T09:05:37Z", "count": 7, "creator": "m-wada@usa.com", "tags": [], "author": "m-wada@usa.com", "creation_time": "2012-01-05T09:05:37Z", "attachment_id": null, "bug_id": 624082}, {"tags": [], "creator": "m-wada@usa.com", "author": "m-wada@usa.com", "attachment_id": null, "bug_id": 624082, "creation_time": "2012-01-06T00:14:54Z", "text": "(In reply to Chris Brand from comment #4)\n> Imoved about 70 folders (snip)\n> even when moving small folders (snip)\n\nMove *Folder\" instead of \"move selected mails\"? (this bug is for \"move selected mails\")\n\nThis bug is for problem when multiple requests of \"move of selected mails from IMAP folder to IMAP folder of same IMAP account\" on single move source folder.\n\"Move folder\" && \"Move from local to IMAP\" case is better processed in separated bug, because \"create folder\"+\"subscribe folder\" is required before mail upload to IMAP server, for the folder and all subfolders.\nChris Brand, open separated bug for your problem, with detailed \"Steps to reproduce problem\", with attaching IMAP log to the bug(after remove/replace personal information, after remove very many log lines for mail data), please.", "raw_text": "(In reply to Chris Brand from comment #4)\n> Imoved about 70 folders (snip)\n> even when moving small folders (snip)\n\nMove *Folder\" instead of \"move selected mails\"? (this bug is for \"move selected mails\")\n\nThis bug is for problem when multiple requests of \"move of selected mails from IMAP folder to IMAP folder of same IMAP account\" on single move source folder.\n\"Move folder\" && \"Move from local to IMAP\" case is better processed in separated bug, because \"create folder\"+\"subscribe folder\" is required before mail upload to IMAP server, for the folder and all subfolders.\nChris Brand, open separated bug for your problem, with detailed \"Steps to reproduce problem\", with attaching IMAP log to the bug(after remove/replace personal information, after remove very many log lines for mail data), please.", "id": 5959111, "time": "2012-01-06T00:14:54Z", "is_private": false, "count": 8}, {"tags": [], "author": "m-wada@usa.com", "attachment_id": null, "bug_id": 624082, "raw_text": "Bug 538375 was found for \"Move folder or mails\" && \"Move from local to IMAP\" case, in which bug opener says phenomenon was observed with Gmail IMAP and hMailServer.\nChris Brand, see Bug 538375 instead of this bug, please.", "count": 9, "creator": "m-wada@usa.com", "creation_time": "2012-01-06T02:01:45Z", "text": "Bug 538375 was found for \"Move folder or mails\" && \"Move from local to IMAP\" case, in which bug opener says phenomenon was observed with Gmail IMAP and hMailServer.\nChris Brand, see Bug 538375 instead of this bug, please.", "id": 5959376, "time": "2012-01-06T02:01:45Z", "is_private": false}, {"raw_text": "(In reply to WADA from comment #5)\n> To Martin von Gagern (bug opener):\n> Can you check next when you can reproduce your problem with \"Just Mark it as\n> Deleted\" model?\n\nIntend to try this out asap, but haven't managed to find the time so far.", "count": 10, "tags": [], "author": "Martin.vGagern@gmx.net", "attachment_id": null, "bug_id": 624082, "is_private": false, "id": 6000341, "text": "(In reply to WADA from comment #5)\n> To Martin von Gagern (bug opener):\n> Can you check next when you can reproduce your problem with \"Just Mark it as\n> Deleted\" model?\n\nIntend to try this out asap, but haven't managed to find the time so far.", "time": "2012-01-23T13:08:59Z", "creator": "Martin.vGagern@gmx.net", "creation_time": "2012-01-23T13:08:59Z"}, {"creation_time": "2015-09-28T09:32:18Z", "creator": "jgehrcke@googlemail.com", "time": "2015-09-28T09:32:18Z", "text": "Using TB 38.2.0 on Windows. It just happened to me that I moved *one* message from one IMAP folder to another, and the description in this bug report fits perfectly:\n\n- disappears from the original folder\n- but does not appear in the target folder\n- On the imap server, the message is still in the original folder\n- but TB does not display it\n\nAn independent IMAP client showed the mail in the original folder, but TB did not.\n\nA repair (right+click the folder > properties > repair) made the message re-appear in the original folder. I then moved it \"again\", and it worked.", "id": 10782486, "is_private": false, "bug_id": 624082, "attachment_id": null, "author": "jgehrcke@googlemail.com", "tags": [], "count": 11, "raw_text": "Using TB 38.2.0 on Windows. It just happened to me that I moved *one* message from one IMAP folder to another, and the description in this bug report fits perfectly:\n\n- disappears from the original folder\n- but does not appear in the target folder\n- On the imap server, the message is still in the original folder\n- but TB does not display it\n\nAn independent IMAP client showed the mail in the original folder, but TB did not.\n\nA repair (right+click the folder > properties > repair) made the message re-appear in the original folder. I then moved it \"again\", and it worked."}, {"is_private": false, "text": "(In reply to jgehrcke from comment #11)\n> Using TB 38.2.0 on Windows. It just happened to me that I moved *one*\n> message from one IMAP folder to another, and the description in this bug\n> report fits perfectly:\n> \n> - disappears from the original folder\n> - but does not appear in the target folder\n> - On the imap server, the message is still in the original folder\n> - but TB does not display it\n \nDo you use MailDir for your IMAP accunt?\nI could consistently see such phenomenon in testing for MailDir only.\nUI to set msgStore=MailDir was opened by a few Tb versions, but it's hidden again.", "id": 10782508, "raw_text": "(In reply to jgehrcke from comment #11)\n> Using TB 38.2.0 on Windows. It just happened to me that I moved *one*\n> message from one IMAP folder to another, and the description in this bug\n> report fits perfectly:\n> \n> - disappears from the original folder\n> - but does not appear in the target folder\n> - On the imap server, the message is still in the original folder\n> - but TB does not display it\n \nDo you use MailDir for your IMAP accunt?\nI could consistently see such phenomenon in testing for MailDir only.\nUI to set msgStore=MailDir was opened by a few Tb versions, but it's hidden again.", "time": "2015-09-28T09:45:49Z", "count": 12, "creator": "m-wada@usa.com", "tags": [], "author": "m-wada@usa.com", "creation_time": "2015-09-28T09:45:49Z", "attachment_id": null, "bug_id": 624082}, {"raw_text": "(In reply to WADA from comment #12)\n  \n> Do you use MailDir for your IMAP accunt?\n> I could consistently see such phenomenon in testing for MailDir only.\n> UI to set msgStore=MailDir was opened by a few Tb versions, but it's hidden\n> again.\n\nWhere can I see which format I use for a specific account? Probably I don't use MailDir.\n\nI should add that I am using my Thunderbird profile since many years and for the IMAP account in question I regularly move mails between folders via drag'n'drop. Have never observed an issue with that. Today was the first time. I was hugely surprised to not find the mail in the target folder.\n\nI then looked into the activity manager and there was a corresponding entry \"Moved 1 message from Unbekannt to Inbox\". Also, I found the mail in question via full text search, i.e. it showed up in the search results. However, it could not be opened anymore.\n\nSo I knew that it wasn't me who made a mistake, but it was Thunderbird who got confused about that mail. I cannot reproduce this issue anymore, but clearly there was something bogus going on.", "count": 13, "tags": [], "author": "jgehrcke@googlemail.com", "attachment_id": null, "bug_id": 624082, "is_private": false, "text": "(In reply to WADA from comment #12)\n  \n> Do you use MailDir for your IMAP accunt?\n> I could consistently see such phenomenon in testing for MailDir only.\n> UI to set msgStore=MailDir was opened by a few Tb versions, but it's hidden\n> again.\n\nWhere can I see which format I use for a specific account? Probably I don't use MailDir.\n\nI should add that I am using my Thunderbird profile since many years and for the IMAP account in question I regularly move mails between folders via drag'n'drop. Have never observed an issue with that. Today was the first time. I was hugely surprised to not find the mail in the target folder.\n\nI then looked into the activity manager and there was a corresponding entry \"Moved 1 message from Unbekannt to Inbox\". Also, I found the mail in question via full text search, i.e. it showed up in the search results. However, it could not be opened anymore.\n\nSo I knew that it wasn't me who made a mistake, but it was Thunderbird who got confused about that mail. I cannot reproduce this issue anymore, but clearly there was something bogus going on.", "id": 10782518, "time": "2015-09-28T09:54:19Z", "creator": "jgehrcke@googlemail.com", "creation_time": "2015-09-28T09:54:19Z"}, {"tags": [], "creator": "m-wada@usa.com", "author": "m-wada@usa.com", "creation_time": "2015-09-28T10:01:55Z", "attachment_id": null, "bug_id": 624082, "is_private": false, "raw_text": "(In reply to jgehrcke from comment #13)\n> Where can I see which format I use for a specific account? Probably I don't use MailDir.\n\nmail.server.server#.storeContractID = @mozilla.org/msgstore/berkeleystore;1\nmail.server.server#.storeContractID = @mozilla.org/msgstore/maildirstore;1", "id": 10782528, "text": "(In reply to jgehrcke from comment #13)\n> Where can I see which format I use for a specific account? Probably I don't use MailDir.\n\nmail.server.server#.storeContractID = @mozilla.org/msgstore/berkeleystore;1\nmail.server.server#.storeContractID = @mozilla.org/msgstore/maildirstore;1", "time": "2015-09-28T10:01:55Z", "count": 14}, {"count": 15, "raw_text": "(In reply to jgehrcke from comment #13)\n> I regularly move mails between folders via drag'n'drop.\n> Have never observed an issue with that. Today was the first time.\n\nDrag&Drop is more dangerous than Move in menu, because \"Move mails operation\" can be canceled by problem in DrogDrop\" too. Move in menu is safer thaan Drag&Drop because it's affected by IMAP/IMAP Folder relevant problem only. Safest way is \"Do Copy, Then Detete after confirmation of successful Copy\" :-) \n   \n> I then looked into the activity manager and there was a corresponding entry\n> \"Moved 1 message from Unbekannt to Inbox\".\n\nThis indicates;\n  For \"Move between folders operation\", move ended normally, so \"\"Moved 1 message\" was logged,\n  or log was written before actual execution of move.\n  For IMAP, \"copy to target folder\" was not successful,\n  so \"Delete at MoveSoure\"==\"uid store nn +Flags(\\Deleted)\" was not executed.\n  For \"Move messages\", move normally ended, so removed msgDbHdr from msgDB(xxx.msf) of MoveSourceFolder.\n\n> Also, I found the mail in question via full text search,\n> i.e. it showed up in the search results. However, it could not be opened anymore.\n\nIf Full Text Search(Global Search, Ctrl+K), it can be explained.\n  Because \"uid store nn +Flags(\\Deleted)\" is not issued, data of mail is not removed by Global Indexer.\nIf Advanced Search or Quick Search(Ctrl+Shift+K), search is done via messageKey(=UID if imap) of msgDBHdr in msgDB. Because msgDBHdr is removed from msgDB(xxx.msf), search doesn't find the mail. \nPhenomenon itself is same as one I saw in mailDir testing.\n\nI think timing dependent phenomenon(depends on \"at what stage, error occurred\"), and we can produce phenomenon relatively easily if MailDir is used. MailDir is microscope of IMAP problem :-)", "bug_id": 624082, "attachment_id": null, "author": "m-wada@usa.com", "tags": [], "is_private": false, "time": "2015-09-28T10:40:12Z", "text": "(In reply to jgehrcke from comment #13)\n> I regularly move mails between folders via drag'n'drop.\n> Have never observed an issue with that. Today was the first time.\n\nDrag&Drop is more dangerous than Move in menu, because \"Move mails operation\" can be canceled by problem in DrogDrop\" too. Move in menu is safer thaan Drag&Drop because it's affected by IMAP/IMAP Folder relevant problem only. Safest way is \"Do Copy, Then Detete after confirmation of successful Copy\" :-) \n   \n> I then looked into the activity manager and there was a corresponding entry\n> \"Moved 1 message from Unbekannt to Inbox\".\n\nThis indicates;\n  For \"Move between folders operation\", move ended normally, so \"\"Moved 1 message\" was logged,\n  or log was written before actual execution of move.\n  For IMAP, \"copy to target folder\" was not successful,\n  so \"Delete at MoveSoure\"==\"uid store nn +Flags(\\Deleted)\" was not executed.\n  For \"Move messages\", move normally ended, so removed msgDbHdr from msgDB(xxx.msf) of MoveSourceFolder.\n\n> Also, I found the mail in question via full text search,\n> i.e. it showed up in the search results. However, it could not be opened anymore.\n\nIf Full Text Search(Global Search, Ctrl+K), it can be explained.\n  Because \"uid store nn +Flags(\\Deleted)\" is not issued, data of mail is not removed by Global Indexer.\nIf Advanced Search or Quick Search(Ctrl+Shift+K), search is done via messageKey(=UID if imap) of msgDBHdr in msgDB. Because msgDBHdr is removed from msgDB(xxx.msf), search doesn't find the mail. \nPhenomenon itself is same as one I saw in mailDir testing.\n\nI think timing dependent phenomenon(depends on \"at what stage, error occurred\"), and we can produce phenomenon relatively easily if MailDir is used. MailDir is microscope of IMAP problem :-)", "id": 10782607, "creation_time": "2015-09-28T10:40:12Z", "creator": "m-wada@usa.com"}, {"count": 16, "time": "2015-09-28T10:42:01Z", "text": "(In reply to WADA from comment #12)\n\n> Do you use MailDir for your IMAP accunt?\n\nI have used the config editor and searched for \"maildirstore\". No search result. All my accounts are configured to use the berkeleystore.", "id": 10782610, "raw_text": "(In reply to WADA from comment #12)\n\n> Do you use MailDir for your IMAP accunt?\n\nI have used the config editor and searched for \"maildirstore\". No search result. All my accounts are configured to use the berkeleystore.", "is_private": false, "bug_id": 624082, "attachment_id": null, "creation_time": "2015-09-28T10:42:01Z", "author": "jgehrcke@googlemail.com", "creator": "jgehrcke@googlemail.com", "tags": []}, {"count": 17, "is_private": false, "time": "2015-09-28T10:48:17Z", "raw_text": "Thanks for your analysis, Wada. \n\nI see that \"Drag&Drop is more dangerous than Move in menu\". However, drag'n'drop is supported, so the goal clearly must be that the user is informed about an error when an error occurs that TB cannot recover from itself. \n\nI also agree that this is a timing dependent phenomenon. That is, the mechanism in question is subject to a race condition. It should be identified and defused.", "id": 10782621, "text": "Thanks for your analysis, Wada. \n\nI see that \"Drag&Drop is more dangerous than Move in menu\". However, drag'n'drop is supported, so the goal clearly must be that the user is informed about an error when an error occurs that TB cannot recover from itself. \n\nI also agree that this is a timing dependent phenomenon. That is, the mechanism in question is subject to a race condition. It should be identified and defused.", "creation_time": "2015-09-28T10:48:17Z", "bug_id": 624082, "attachment_id": null, "author": "jgehrcke@googlemail.com", "tags": [], "creator": "jgehrcke@googlemail.com"}, {"attachment_id": null, "bug_id": 624082, "tags": [], "author": "m-wada@usa.com", "count": 18, "raw_text": "(In reply to jgehrcke from comment #11)\n> I moved *one* message from one IMAP folder to another, (snip)\n\n(1) Move between imap folder of same imap account? (2) Or move between different imap account?\nI can't imagine prolem in (1), because move = \"uid move xx Target\" or \"uid copy xx Targrt\" + \"uid store xx +Flags(\\Deleted)\" only and move of one mail only.\nIf (2), move = \"fetch body from source server\" + \"append(upload) to target server\" + \"uid store xx +Flags(\\Deleted) at source server\", so error at end of append may produce such problem, because there is problem in error handling of append.\n  eg. transfer of all mail data by append completes, but timeout occurs before OK response is returned.\n  At server, all mail data is received, so uploaded mail is normally accepted.", "creation_time": "2015-09-28T23:21:48Z", "creator": "m-wada@usa.com", "is_private": false, "id": 10786188, "text": "(In reply to jgehrcke from comment #11)\n> I moved *one* message from one IMAP folder to another, (snip)\n\n(1) Move between imap folder of same imap account? (2) Or move between different imap account?\nI can't imagine prolem in (1), because move = \"uid move xx Target\" or \"uid copy xx Targrt\" + \"uid store xx +Flags(\\Deleted)\" only and move of one mail only.\nIf (2), move = \"fetch body from source server\" + \"append(upload) to target server\" + \"uid store xx +Flags(\\Deleted) at source server\", so error at end of append may produce such problem, because there is problem in error handling of append.\n  eg. transfer of all mail data by append completes, but timeout occurs before OK response is returned.\n  At server, all mail data is received, so uploaded mail is normally accepted.", "time": "2015-09-28T23:21:48Z"}, {"is_private": false, "time": "2015-09-29T02:34:05Z", "id": 10786831, "text": "FYI.\nBug 538375 is for \"Move or Copy from local folder to IMAP folder\", so \"append, something wrong while appending\" is involved.", "creator": "m-wada@usa.com", "creation_time": "2015-09-29T02:34:05Z", "raw_text": "FYI.\nBug 538375 is for \"Move or Copy from local folder to IMAP folder\", so \"append, something wrong while appending\" is involved.", "count": 19, "author": "m-wada@usa.com", "tags": [], "bug_id": 624082, "attachment_id": null}, {"creator": "vseerror@lehigh.edu", "creation_time": "2019-02-15T19:52:24Z", "time": "2019-02-15T19:52:24Z", "id": 13928794, "text": "(might be backend, but imap is at least better than General)", "is_private": false, "author": "vseerror@lehigh.edu", "tags": [], "bug_id": 624082, "attachment_id": null, "raw_text": "(might be backend, but imap is at least better than General)", "count": 20}]}}}