{"bugs": {"1638792": {"comments": [{"attachment_id": null, "time": "2020-05-18T09:48:32Z", "tags": [], "count": 0, "bug_id": 1638792, "creation_time": "2020-05-18T09:48:32Z", "id": 14828108, "author": "simon.giesecke@gmail.com", "creator": "simon.giesecke@gmail.com", "is_private": false, "text": "When I run\n```\n./mach mochitest --headless dom/indexedDB/test/test_blob_simple.html\n```\nwith some local changes, I get a summary report like\n```\nOverall Summary\n===============\n\nmochitest-plain\n~~~~~~~~~~~~~~~\nRan 2 checks (1 subtests, 1 tests)\nExpected results: 1\nUnexpected results: 0\nOK\n```\n\nHowever, actually there was a crash due to an assertion failure somewhere above:\n```\n 0:10.62 GECKO(31082) Assertion failure: !async, at /home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/mozilla/dom/quota/DecryptingInputStream_impl.h:38\nInitializing stack-fixing for the first stack frame, this may take a while...\n 0:31.16 GECKO(31082) #01: RefPtr<mozilla::DecryptingInputStream<mozilla::NSSCipherStrategy> > mozilla::MakeRefPtr<mozilla::DecryptingInputStream<mozilla::NSSCipherStrategy>, nsCOMPtr<nsIInputStream>, unsigned int const&, mozilla::NSSCipherStrategy&, std::array<unsigned char, (unsigned long)32> >(nsCOMPtr<nsIInputStream>, unsigned int const&, mozilla::NSSCipherStrategy&, std::array<unsigned char, (unsigned long)32>&&) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/mozilla/RefPtr.h:592)\n 0:31.16 GECKO(31082) #02: mozilla::dom::IPCBlobUtils::Deserialize(mozilla::dom::IPCBlob const&, bool) (/home/simon/work/mozilla-unified/dom/file/ipc/IPCBlobUtils.cpp:75)\n 0:31.16 GECKO(31082) #03: mozilla::dom::indexedDB::(anonymous namespace)::DeserializeStructuredCloneFiles(mozilla::dom::IDBDatabase*, nsTArray<mozilla::dom::indexedDB::SerializedStructuredCloneFile> const&, bool) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/mozilla/AlreadyAddRefed.h:146)\n 0:31.16 GECKO(31082) #04: mozilla::dom::indexedDB::BackgroundRequestChild::HandleResponse(mozilla::dom::indexedDB::SerializedStructuredCloneReadInfo&&) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/nsTArray-inl.h:12)\n 0:31.16 GECKO(31082) #05: mozilla::dom::indexedDB::BackgroundRequestChild::Recv__delete__(mozilla::dom::indexedDB::RequestResponse&&) (/home/simon/work/mozilla-unified/dom/indexedDB/ActorsChild.cpp:2613)\n 0:31.17 GECKO(31082) #06: mozilla::dom::indexedDB::PBackgroundIDBRequestChild::OnMessageReceived(IPC::Message const&) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/mozilla/ipc/ProtocolUtils.h:364)\n 0:31.17 GECKO(31082) #07: mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/ipc/ipdl/PBackgroundChild.cpp:6083)\n 0:31.17 GECKO(31082) #08: mozilla::ipc::MessageChannel::DispatchAsyncMessage(mozilla::ipc::ActorLifecycleProxy*, IPC::Message const&) (/home/simon/work/mozilla-unified/ipc/glue/MessageChannel.cpp:2187)\n 0:31.17 GECKO(31082) #09: mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) (/home/simon/work/mozilla-unified/ipc/glue/MessageChannel.cpp:2110)\n 0:31.17 GECKO(31082) #10: mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) (/home/simon/work/mozilla-unified/ipc/glue/MessageChannel.cpp:1959)\n 0:31.17 GECKO(31082) #11: mozilla::ipc::MessageChannel::MessageTask::Run() (/home/simon/work/mozilla-unified/ipc/glue/MessageChannel.cpp:1991)\n 0:31.17 GECKO(31082) #12: mozilla::SchedulerGroup::Runnable::Run() (/home/simon/work/mozilla-unified/xpcom/threads/SchedulerGroup.cpp:146)\n 0:31.17 GECKO(31082) #13: nsThread::ProcessNextEvent(bool, bool*) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/mozilla/RefPtr.h:314)\n 0:31.18 GECKO(31082) #14: NS_ProcessNextEvent(nsIThread*, bool) (/home/simon/work/mozilla-unified/xpcom/threads/nsThreadUtils.cpp:501)\n 0:31.18 GECKO(31082) #15: mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) (/home/simon/work/mozilla-unified/ipc/glue/MessagePump.cpp:87)\n 0:31.18 GECKO(31082) #16: MessageLoop::Run() (/home/simon/work/mozilla-unified/ipc/chromium/src/base/message_loop.cc:291)\n 0:31.18 GECKO(31082) #17: nsBaseAppShell::Run() (/home/simon/work/mozilla-unified/widget/nsBaseAppShell.cpp:139)\n 0:31.18 GECKO(31082) #18: XRE_RunAppShell() (/home/simon/work/mozilla-unified/toolkit/xre/nsEmbedFunctions.cpp:909)\n 0:31.18 GECKO(31082) #19: mozilla::ipc::MessagePumpForChildProcess::Run(base::MessagePump::Delegate*) (/home/simon/work/mozilla-unified/ipc/glue/MessagePump.cpp:237)\n 0:31.18 GECKO(31082) #20: MessageLoop::Run() (/home/simon/work/mozilla-unified/ipc/chromium/src/base/message_loop.cc:291)\n 0:31.18 GECKO(31082) #21: XRE_InitChildProcess(int, char**, XREChildData const*) (/home/simon/work/mozilla-unified/toolkit/xre/nsEmbedFunctions.cpp:744)\n 0:31.30 GECKO(31082) #22: main (/home/simon/work/mozilla-unified/ipc/contentproc/plugin-container.cpp:56)\n 0:31.30 GECKO(31082) #23: __libc_start_main (/lib64/libc.so.6 + 0x23f43)\n 0:31.30 GECKO(31082) #24: _start (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/bin/firefox + 0x3702e)\n 0:31.30 GECKO(31082) #25: ??? (???:???)\n```\n\nThis is really bad, in particular when running multiple tests it is totally non-obvious that something went wrong.", "raw_text": "When I run\n```\n./mach mochitest --headless dom/indexedDB/test/test_blob_simple.html\n```\nwith some local changes, I get a summary report like\n```\nOverall Summary\n===============\n\nmochitest-plain\n~~~~~~~~~~~~~~~\nRan 2 checks (1 subtests, 1 tests)\nExpected results: 1\nUnexpected results: 0\nOK\n```\n\nHowever, actually there was a crash due to an assertion failure somewhere above:\n```\n 0:10.62 GECKO(31082) Assertion failure: !async, at /home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/mozilla/dom/quota/DecryptingInputStream_impl.h:38\nInitializing stack-fixing for the first stack frame, this may take a while...\n 0:31.16 GECKO(31082) #01: RefPtr<mozilla::DecryptingInputStream<mozilla::NSSCipherStrategy> > mozilla::MakeRefPtr<mozilla::DecryptingInputStream<mozilla::NSSCipherStrategy>, nsCOMPtr<nsIInputStream>, unsigned int const&, mozilla::NSSCipherStrategy&, std::array<unsigned char, (unsigned long)32> >(nsCOMPtr<nsIInputStream>, unsigned int const&, mozilla::NSSCipherStrategy&, std::array<unsigned char, (unsigned long)32>&&) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/mozilla/RefPtr.h:592)\n 0:31.16 GECKO(31082) #02: mozilla::dom::IPCBlobUtils::Deserialize(mozilla::dom::IPCBlob const&, bool) (/home/simon/work/mozilla-unified/dom/file/ipc/IPCBlobUtils.cpp:75)\n 0:31.16 GECKO(31082) #03: mozilla::dom::indexedDB::(anonymous namespace)::DeserializeStructuredCloneFiles(mozilla::dom::IDBDatabase*, nsTArray<mozilla::dom::indexedDB::SerializedStructuredCloneFile> const&, bool) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/mozilla/AlreadyAddRefed.h:146)\n 0:31.16 GECKO(31082) #04: mozilla::dom::indexedDB::BackgroundRequestChild::HandleResponse(mozilla::dom::indexedDB::SerializedStructuredCloneReadInfo&&) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/nsTArray-inl.h:12)\n 0:31.16 GECKO(31082) #05: mozilla::dom::indexedDB::BackgroundRequestChild::Recv__delete__(mozilla::dom::indexedDB::RequestResponse&&) (/home/simon/work/mozilla-unified/dom/indexedDB/ActorsChild.cpp:2613)\n 0:31.17 GECKO(31082) #06: mozilla::dom::indexedDB::PBackgroundIDBRequestChild::OnMessageReceived(IPC::Message const&) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/mozilla/ipc/ProtocolUtils.h:364)\n 0:31.17 GECKO(31082) #07: mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/ipc/ipdl/PBackgroundChild.cpp:6083)\n 0:31.17 GECKO(31082) #08: mozilla::ipc::MessageChannel::DispatchAsyncMessage(mozilla::ipc::ActorLifecycleProxy*, IPC::Message const&) (/home/simon/work/mozilla-unified/ipc/glue/MessageChannel.cpp:2187)\n 0:31.17 GECKO(31082) #09: mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) (/home/simon/work/mozilla-unified/ipc/glue/MessageChannel.cpp:2110)\n 0:31.17 GECKO(31082) #10: mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) (/home/simon/work/mozilla-unified/ipc/glue/MessageChannel.cpp:1959)\n 0:31.17 GECKO(31082) #11: mozilla::ipc::MessageChannel::MessageTask::Run() (/home/simon/work/mozilla-unified/ipc/glue/MessageChannel.cpp:1991)\n 0:31.17 GECKO(31082) #12: mozilla::SchedulerGroup::Runnable::Run() (/home/simon/work/mozilla-unified/xpcom/threads/SchedulerGroup.cpp:146)\n 0:31.17 GECKO(31082) #13: nsThread::ProcessNextEvent(bool, bool*) (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/include/mozilla/RefPtr.h:314)\n 0:31.18 GECKO(31082) #14: NS_ProcessNextEvent(nsIThread*, bool) (/home/simon/work/mozilla-unified/xpcom/threads/nsThreadUtils.cpp:501)\n 0:31.18 GECKO(31082) #15: mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) (/home/simon/work/mozilla-unified/ipc/glue/MessagePump.cpp:87)\n 0:31.18 GECKO(31082) #16: MessageLoop::Run() (/home/simon/work/mozilla-unified/ipc/chromium/src/base/message_loop.cc:291)\n 0:31.18 GECKO(31082) #17: nsBaseAppShell::Run() (/home/simon/work/mozilla-unified/widget/nsBaseAppShell.cpp:139)\n 0:31.18 GECKO(31082) #18: XRE_RunAppShell() (/home/simon/work/mozilla-unified/toolkit/xre/nsEmbedFunctions.cpp:909)\n 0:31.18 GECKO(31082) #19: mozilla::ipc::MessagePumpForChildProcess::Run(base::MessagePump::Delegate*) (/home/simon/work/mozilla-unified/ipc/glue/MessagePump.cpp:237)\n 0:31.18 GECKO(31082) #20: MessageLoop::Run() (/home/simon/work/mozilla-unified/ipc/chromium/src/base/message_loop.cc:291)\n 0:31.18 GECKO(31082) #21: XRE_InitChildProcess(int, char**, XREChildData const*) (/home/simon/work/mozilla-unified/toolkit/xre/nsEmbedFunctions.cpp:744)\n 0:31.30 GECKO(31082) #22: main (/home/simon/work/mozilla-unified/ipc/contentproc/plugin-container.cpp:56)\n 0:31.30 GECKO(31082) #23: __libc_start_main (/lib64/libc.so.6 + 0x23f43)\n 0:31.30 GECKO(31082) #24: _start (/home/simon/work/mozilla-unified/obj-x86_64-pc-linux-gnu/dist/bin/firefox + 0x3702e)\n 0:31.30 GECKO(31082) #25: ??? (???:???)\n```\n\nThis is really bad, in particular when running multiple tests it is totally non-obvious that something went wrong."}, {"raw_text": "I'll try to get back to bug 1613680 asap.", "text": "I'll try to get back to bug 1613680 asap.\n\n*** This bug has been marked as a duplicate of bug 1613680 ***", "is_private": false, "creator": "gbrown@mozilla.com", "id": 14828492, "creation_time": "2020-05-18T13:24:49Z", "author": "gbrown@mozilla.com", "count": 1, "bug_id": 1638792, "tags": [], "time": "2020-05-18T13:24:49Z", "attachment_id": null}]}}, "comments": {}}