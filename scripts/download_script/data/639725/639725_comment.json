{"comments": {}, "bugs": {"639725": {"comments": [{"attachment_id": null, "is_private": false, "time": "2011-03-08T02:59:57Z", "author": "karlt@mozbugz.karlt.net", "id": 5329219, "raw_text": "Regression range:\nhttp://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=58101a16aff7&tochange=30239e4cebd8\n\nLooks like\nhttp://hg.mozilla.org/mozilla-central/rev/bcae411bc333\n\nThis is currently making it difficult to distinguish regular old fashioned plugin X errors from the wave of GLX errors that has arrived with wmode=direct on\nyoutube.", "creation_time": "2011-03-08T02:59:57Z", "text": "Regression range:\nhttp://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=58101a16aff7&tochange=30239e4cebd8\n\nLooks like\nhttp://hg.mozilla.org/mozilla-central/rev/bcae411bc333\n\nThis is currently making it difficult to distinguish regular old fashioned plugin X errors from the wave of GLX errors that has arrived with wmode=direct on\nyoutube.", "tags": [], "count": 0, "creator": "karlt@mozbugz.karlt.net", "bug_id": 639725}, {"author": "ted@mielczarek.org", "attachment_id": null, "text": "Did that ever work? We don't remote AnnotateCrashReport yet (bug 581341).", "is_private": false, "creation_time": "2011-03-08T13:51:08Z", "raw_text": "Did that ever work? We don't remote AnnotateCrashReport yet (bug 581341).", "id": 5329966, "bug_id": 639725, "time": "2011-03-08T13:51:08Z", "tags": [], "count": 1, "creator": "ted@mielczarek.org"}, {"is_private": false, "time": "2011-03-08T21:05:55Z", "attachment_id": null, "text": "Yes, this is a regression.  Still working on 1.9.2.\n\nhttp://hg.mozilla.org/mozilla-central/annotate/5666cb06e519/toolkit/xre/nsX11ErrorHandler.cpp#l151", "creation_time": "2011-03-08T21:05:55Z", "raw_text": "Yes, this is a regression.  Still working on 1.9.2.\n\nhttp://hg.mozilla.org/mozilla-central/annotate/5666cb06e519/toolkit/xre/nsX11ErrorHandler.cpp#l151", "id": 5331293, "bug_id": 639725, "count": 2, "tags": [], "creator": "karlt@mozbugz.karlt.net", "author": "karlt@mozbugz.karlt.net"}, {"attachment_id": null, "time": "2011-03-09T12:33:18Z", "is_private": false, "author": "ted@mielczarek.org", "creator": "ted@mielczarek.org", "count": 3, "tags": [], "bug_id": 639725, "id": 5332802, "raw_text": "Ah, I forgot all about that. cjones' changes were necessary because in content processes we run a lot of existing code that tries to do crashreporter things, and we didn't want to have to sprinkle ProcessType checks all over. I think the right solution is just to make the CrashReporter APIs check processtype internally and remote themselves correctly, and switch your annotation there to just use AnnotateCrashReport directly, so that it should work from any type of process.", "creation_time": "2011-03-09T12:33:18Z", "text": "Ah, I forgot all about that. cjones' changes were necessary because in content processes we run a lot of existing code that tries to do crashreporter things, and we didn't want to have to sprinkle ProcessType checks all over. I think the right solution is just to make the CrashReporter APIs check processtype internally and remote themselves correctly, and switch your annotation there to just use AnnotateCrashReport directly, so that it should work from any type of process."}, {"id": 5334108, "raw_text": "Thanks for your comments.  It does make sense that we centralize processtype checks.\n\nOne issue is that it is harder to remote notes from a non-main thread, and I assume NS_DebugBreak for example could be called from any thread.  (Is CrashReporter::AppendAppNotesToCrashReport() actually safe from a non-main thread?)  I guess we can just have a is-main-thread check and no-op if not.\n\nSomething to bear in mind is they we may want something on 2.0, which may be averse to significant changes.  However, with a new release model, I don't know whether we'll continue to support older releases, so this may not end up being an issue.", "creation_time": "2011-03-09T21:12:57Z", "text": "Thanks for your comments.  It does make sense that we centralize processtype checks.\n\nOne issue is that it is harder to remote notes from a non-main thread, and I assume NS_DebugBreak for example could be called from any thread.  (Is CrashReporter::AppendAppNotesToCrashReport() actually safe from a non-main thread?)  I guess we can just have a is-main-thread check and no-op if not.\n\nSomething to bear in mind is they we may want something on 2.0, which may be averse to significant changes.  However, with a new release model, I don't know whether we'll continue to support older releases, so this may not end up being an issue.", "creator": "karlt@mozbugz.karlt.net", "count": 4, "tags": [], "bug_id": 639725, "author": "karlt@mozbugz.karlt.net", "is_private": false, "time": "2011-03-09T21:12:57Z", "attachment_id": null}, {"tags": [], "count": 5, "creator": "ted@mielczarek.org", "bug_id": 639725, "id": 5334769, "raw_text": "For a simpler fix, we could perhaps just put the process type checks in all the crashreporter APIs, and bail out for non-chrome processes (except for GetEnabled(), which we could fix to work correctly), so that calling AnnotateCrashReport() would be harmless in content processes. Then this callsite ought to work again, and we can leave remoting the other APIs for that other bug. Does that sound reasonable?", "creation_time": "2011-03-10T00:31:10Z", "text": "For a simpler fix, we could perhaps just put the process type checks in all the crashreporter APIs, and bail out for non-chrome processes (except for GetEnabled(), which we could fix to work correctly), so that calling AnnotateCrashReport() would be harmless in content processes. Then this callsite ought to work again, and we can leave remoting the other APIs for that other bug. Does that sound reasonable?", "author": "ted@mielczarek.org", "time": "2011-03-10T00:31:10Z", "is_private": false, "attachment_id": null}, {"author": "karlt@mozbugz.karlt.net", "attachment_id": null, "raw_text": "I don't have a feel for how many APIs would need to have the checks added, but that sounds reasonable to me.", "id": 5334874, "text": "I don't have a feel for how many APIs would need to have the checks added, but that sounds reasonable to me.", "is_private": false, "creation_time": "2011-03-10T01:16:21Z", "bug_id": 639725, "time": "2011-03-10T01:16:21Z", "count": 6, "tags": [], "creator": "karlt@mozbugz.karlt.net"}, {"bug_id": 639725, "tags": [], "count": 7, "creator": "ted@mielczarek.org", "raw_text": "http://mxr.mozilla.org/mozilla-central/source/toolkit/crashreporter/nsExceptionHandler.h (as ugly as it has become) is the set of public APIs exposed curerntly.", "id": 5336334, "text": "http://mxr.mozilla.org/mozilla-central/source/toolkit/crashreporter/nsExceptionHandler.h (as ugly as it has become) is the set of public APIs exposed curerntly.", "creation_time": "2011-03-10T16:26:30Z", "author": "ted@mielczarek.org", "time": "2011-03-10T16:26:30Z", "is_private": false, "attachment_id": null}]}}}