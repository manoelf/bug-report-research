{"comments": {}, "bugs": {"677424": {"comments": [{"count": 0, "id": 5641136, "is_private": false, "author": "dtownsend@mozilla.com", "time": "2011-08-09T00:11:08Z", "creation_time": "2011-08-09T00:11:08Z", "creator": "dtownsend@mozilla.com", "raw_text": "In bug 476430 I have an in-content UI that wants to close itself and restart the application. It sends quit-application-requested first because it doesn't want to close itself if the request is denied, then it closes itself, then it restarts the application which sends quit-application-granted.\n\nSession store gathers its last set of data in quit-application-granted and so it ignores the fact that a tab goes away immediately after that", "attachment_id": null, "tags": [], "bug_id": 677424, "text": "In bug 476430 I have an in-content UI that wants to close itself and restart the application. It sends quit-application-requested first because it doesn't want to close itself if the request is denied, then it closes itself, then it restarts the application which sends quit-application-granted.\n\nSession store gathers its last set of data in quit-application-granted and so it ignores the fact that a tab goes away immediately after that"}, {"text": "Created attachment 551649\nPatch v0.1\n\nThe alternative to this felt to focused on the case presented here so this is a bit more general purpose (I was going to delete the tab from window.tabs and adjust window.selected in onTabRemove).\n\nI think this will work, but no test yet (well, Dave can say if it works). If I write a test that notifies quit-application-requested, is that going to mess things up? Actually I'm not sure we can test this properly since we really need to be quitting :/", "bug_id": 677424, "tags": [], "raw_text": "The alternative to this felt to focused on the case presented here so this is a bit more general purpose (I was going to delete the tab from window.tabs and adjust window.selected in onTabRemove).\n\nI think this will work, but no test yet (well, Dave can say if it works). If I write a test that notifies quit-application-requested, is that going to mess things up? Actually I'm not sure we can test this properly since we really need to be quitting :/", "attachment_id": 551649, "author": "paul@oshannessy.com", "creator": "paul@oshannessy.com", "creation_time": "2011-08-09T01:38:12Z", "time": "2011-08-09T01:38:12Z", "is_private": false, "count": 1, "id": 5641269}, {"tags": [], "text": "If any code breaks after receiving multiple quit-application-requested notifications then that code is itself broken", "bug_id": 677424, "attachment_id": null, "raw_text": "If any code breaks after receiving multiple quit-application-requested notifications then that code is itself broken", "creator": "dtownsend@mozilla.com", "creation_time": "2011-08-09T02:02:26Z", "time": "2011-08-09T02:02:26Z", "author": "dtownsend@mozilla.com", "is_private": false, "count": 2, "id": 5641303}, {"bug_id": 677424, "text": "(In reply to Dave Townsend (:Mossop) from comment #2)\n> If any code breaks after receiving multiple quit-application-requested\n> notifications then that code is itself broken\n\nI wasn't worried so much about that, just wasn't sure if it would trigger anything (eg. the quit dialog) that wasn't something we could pref off.", "tags": [], "attachment_id": null, "raw_text": "(In reply to Dave Townsend (:Mossop) from comment #2)\n> If any code breaks after receiving multiple quit-application-requested\n> notifications then that code is itself broken\n\nI wasn't worried so much about that, just wasn't sure if it would trigger anything (eg. the quit dialog) that wasn't something we could pref off.", "creation_time": "2011-08-09T02:15:11Z", "time": "2011-08-09T02:15:11Z", "creator": "paul@oshannessy.com", "author": "paul@oshannessy.com", "id": 5641317, "count": 3, "is_private": false}, {"time": "2011-08-09T02:43:15Z", "creation_time": "2011-08-09T02:43:15Z", "creator": "dtownsend@mozilla.com", "author": "dtownsend@mozilla.com", "id": 5641341, "count": 4, "is_private": false, "bug_id": 677424, "text": "Oh, good point. Yes it is bound to do that in some cases, but you can handle that in the test.\n\nTo really handle the shutdown/restart properly we probably need mozmill tests for session restore, maybe some even already exist", "tags": [], "attachment_id": null, "raw_text": "Oh, good point. Yes it is bound to do that in some cases, but you can handle that in the test.\n\nTo really handle the shutdown/restart properly we probably need mozmill tests for session restore, maybe some even already exist"}, {"attachment_id": 552242, "is_private": false, "count": 5, "id": 5646375, "raw_text": "The previous patch doesn't work because the tab is still in tabbrowsers list of tabs at the time the TabClose event is dispatched. This works by removing the tabs data from the cached window state when it is removed.", "creator": "dtownsend@mozilla.com", "time": "2011-08-10T22:34:33Z", "creation_time": "2011-08-10T22:34:33Z", "author": "dtownsend@mozilla.com", "tags": [], "text": "Created attachment 552242\npatch rev 1\n\nThe previous patch doesn't work because the tab is still in tabbrowsers list of tabs at the time the TabClose event is dispatched. This works by removing the tabs data from the cached window state when it is removed.", "bug_id": 677424}, {"id": 5648197, "count": 6, "is_private": false, "author": "paul@oshannessy.com", "time": "2011-08-11T18:58:40Z", "creation_time": "2011-08-11T18:58:40Z", "creator": "paul@oshannessy.com", "raw_text": "This is going to make the e10s work a little bit more interesting with the currentURI check, but that problem is for future-Paul/Jez to figure out. This will need tweaking when app tabs happen like I want them too (but that's just a comment for me to remember).", "attachment_id": 552242, "tags": [], "bug_id": 677424, "text": "Comment on attachment 552242\npatch rev 1\n\nThis is going to make the e10s work a little bit more interesting with the currentURI check, but that problem is for future-Paul/Jez to figure out. This will need tweaking when app tabs happen like I want them too (but that's just a comment for me to remember)."}, {"author": "dtownsend@mozilla.com", "creation_time": "2011-08-12T20:53:28Z", "time": "2011-08-12T20:53:28Z", "creator": "dtownsend@mozilla.com", "count": 7, "id": 5650860, "is_private": false, "tags": [], "text": "Landed: http://hg.mozilla.org/mozilla-central/rev/d980e7a3aa49", "bug_id": 677424, "raw_text": "Landed: http://hg.mozilla.org/mozilla-central/rev/d980e7a3aa49", "attachment_id": null}, {"tags": [], "bug_id": 677424, "text": "Backed out due to test failures (timeout in browser_500328.js on OSX debug builds)", "attachment_id": null, "raw_text": "Backed out due to test failures (timeout in browser_500328.js on OSX debug builds)", "creator": "dtownsend@mozilla.com", "time": "2011-08-13T05:01:29Z", "creation_time": "2011-08-13T05:01:29Z", "author": "dtownsend@mozilla.com", "is_private": false, "id": 5651470, "count": 8}]}}}