{"comments": {}, "bugs": {"682647": {"comments": [{"creation_time": "2011-08-28T04:40:19Z", "is_private": false, "id": 5683217, "bug_id": 682647, "author": "jruderman@gmail.com", "count": 0, "text": "Created attachment 556350\ntestcase\n\n###!!! ABORT: image ratio with nonsense width: 'aIntrinsicRatio.width >= 0', file layout/base/nsCSSRendering.cpp, line 3931\n\nThe abort was added in bug 609714, but I don't know if there was also a more recent regression.", "creator": "jruderman@gmail.com", "tags": [], "attachment_id": 556350, "raw_text": "###!!! ABORT: image ratio with nonsense width: 'aIntrinsicRatio.width >= 0', file layout/base/nsCSSRendering.cpp, line 3931\n\nThe abort was added in bug 609714, but I don't know if there was also a more recent regression.", "time": "2011-08-28T04:40:19Z"}, {"is_private": false, "creation_time": "2011-08-28T04:40:38Z", "creator": "jruderman@gmail.com", "tags": [], "attachment_id": 556351, "id": 5683218, "bug_id": 682647, "count": 1, "text": "Created attachment 556351\nstack trace", "author": "jruderman@gmail.com", "time": "2011-08-28T04:40:38Z", "raw_text": ""}, {"attachment_id": null, "tags": [], "creator": "dholbert@mozilla.com", "creation_time": "2011-09-01T22:41:02Z", "is_private": false, "time": "2011-09-01T22:41:02Z", "raw_text": "Confirmed in my Linux x86_64 debug build.\n\nI get this series of warning messages in my terminal, leading up to the abort:\n{\nWARNING: Overflowed nscoord_MAX in conversion to nscoord: 'aValue <= nscoord_MAX', file ../../dist/include/nsCoord.h, line 114\nWARNING: Overflowed nscoord_MAX in conversion to nscoord: 'aValue <= nscoord_MAX', file ../../dist/include/nsCoord.h, line 114\nWARNING: Overflowed nscoord_MAX in conversion to nscoord: 'aValue <= nscoord_MAX', file ../../dist/include/nsCoord.h, line 114\nWARNING: Overflowed nscoord_MAX in conversion to nscoord: 'aValue <= nscoord_MAX', file ../../dist/include/nsCoord.h, line 114\nnsBlockReflowContext: ColumnSet(div)(0)@0x7faae07d2670 metrics=-2147483648,-2147483648!\n###!!! ASSERTION: illegal width for combined area: 'aOverflowAreas.Overflow(otype).width >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 498\n###!!! ASSERTION: illegal height for combined area: 'aOverflowAreas.Overflow(otype).height >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 500\n###!!! ASSERTION: illegal width for combined area: 'aOverflowAreas.Overflow(otype).width >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 498\n###!!! ASSERTION: illegal height for combined area: 'aOverflowAreas.Overflow(otype).height >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 500\nnsBlockReflowContext: ColumnSet(div)(0)@0x7faae07d2670 metrics=-2147483648,-2147483648!\n###!!! ASSERTION: illegal width for combined area: 'aOverflowAreas.Overflow(otype).width >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 498\n###!!! ASSERTION: illegal height for combined area: 'aOverflowAreas.Overflow(otype).height >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 500\n###!!! ASSERTION: illegal width for combined area: 'aOverflowAreas.Overflow(otype).width >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 498\n###!!! ASSERTION: illegal height for combined area: 'aOverflowAreas.Overflow(otype).height >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 500\n###!!! ABORT: image ratio with nonsense width: 'aIntrinsicRatio.width >= 0', file ../../../mozilla/layout/base/nsCSSRendering.cpp, line 3931\n}", "text": "Confirmed in my Linux x86_64 debug build.\n\nI get this series of warning messages in my terminal, leading up to the abort:\n{\nWARNING: Overflowed nscoord_MAX in conversion to nscoord: 'aValue <= nscoord_MAX', file ../../dist/include/nsCoord.h, line 114\nWARNING: Overflowed nscoord_MAX in conversion to nscoord: 'aValue <= nscoord_MAX', file ../../dist/include/nsCoord.h, line 114\nWARNING: Overflowed nscoord_MAX in conversion to nscoord: 'aValue <= nscoord_MAX', file ../../dist/include/nsCoord.h, line 114\nWARNING: Overflowed nscoord_MAX in conversion to nscoord: 'aValue <= nscoord_MAX', file ../../dist/include/nsCoord.h, line 114\nnsBlockReflowContext: ColumnSet(div)(0)@0x7faae07d2670 metrics=-2147483648,-2147483648!\n###!!! ASSERTION: illegal width for combined area: 'aOverflowAreas.Overflow(otype).width >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 498\n###!!! ASSERTION: illegal height for combined area: 'aOverflowAreas.Overflow(otype).height >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 500\n###!!! ASSERTION: illegal width for combined area: 'aOverflowAreas.Overflow(otype).width >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 498\n###!!! ASSERTION: illegal height for combined area: 'aOverflowAreas.Overflow(otype).height >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 500\nnsBlockReflowContext: ColumnSet(div)(0)@0x7faae07d2670 metrics=-2147483648,-2147483648!\n###!!! ASSERTION: illegal width for combined area: 'aOverflowAreas.Overflow(otype).width >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 498\n###!!! ASSERTION: illegal height for combined area: 'aOverflowAreas.Overflow(otype).height >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 500\n###!!! ASSERTION: illegal width for combined area: 'aOverflowAreas.Overflow(otype).width >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 498\n###!!! ASSERTION: illegal height for combined area: 'aOverflowAreas.Overflow(otype).height >= 0', file ../../../mozilla/layout/generic/nsLineBox.cpp, line 500\n###!!! ABORT: image ratio with nonsense width: 'aIntrinsicRatio.width >= 0', file ../../../mozilla/layout/base/nsCSSRendering.cpp, line 3931\n}", "count": 2, "author": "dholbert@mozilla.com", "bug_id": 682647, "id": 5694958}, {"count": 3, "text": "Bug 690619 might be related.", "author": "jruderman@gmail.com", "creator": "jruderman@gmail.com", "creation_time": "2011-09-30T00:37:02Z", "is_private": false, "bug_id": 682647, "id": 5748305, "raw_text": "Bug 690619 might be related.", "attachment_id": null, "time": "2011-09-30T00:37:02Z", "tags": []}, {"time": "2013-04-05T01:42:29Z", "attachment_id": 733686, "raw_text": "Clamp negative layout width/height values to zero image width/height.\n(this is in the eStyleImageType_Element case)\nhttp://hg.mozilla.org/mozilla-central/annotate/c232bec6974d/layout/base/nsCSSRendering.cpp#l4375\n\nThis is effectively what we do for eStyleImageType_Image too - \nnsLayoutUtils::ComputeSizeForDrawing() calls imgIContainer::GetWidth()\nwhich returns mSize, which rejects negative values, e.g.:\nhttp://hg.mozilla.org/mozilla-central/annotate/c232bec6974d/image/src/RasterImage.cpp#l1409\n\nI'll file a follow-up bug for the remaining non-fatal assertions in this test.\n(\"ASSERTION: illegal width/height for combined area\")\n\nhttps://tbpl.mozilla.org/?tree=Try&rev=f39faf2370c6", "tags": [], "creator": "MatsPalmgren_bugz@use.startmail.com", "author": "MatsPalmgren_bugz@use.startmail.com", "text": "Created attachment 733686\nfix+test\n\nClamp negative layout width/height values to zero image width/height.\n(this is in the eStyleImageType_Element case)\nhttp://hg.mozilla.org/mozilla-central/annotate/c232bec6974d/layout/base/nsCSSRendering.cpp#l4375\n\nThis is effectively what we do for eStyleImageType_Image too - \nnsLayoutUtils::ComputeSizeForDrawing() calls imgIContainer::GetWidth()\nwhich returns mSize, which rejects negative values, e.g.:\nhttp://hg.mozilla.org/mozilla-central/annotate/c232bec6974d/image/src/RasterImage.cpp#l1409\n\nI'll file a follow-up bug for the remaining non-fatal assertions in this test.\n(\"ASSERTION: illegal width/height for combined area\")\n\nhttps://tbpl.mozilla.org/?tree=Try&rev=f39faf2370c6", "count": 4, "id": 7280105, "bug_id": 682647, "creation_time": "2013-04-05T01:42:29Z", "is_private": false}, {"creator": "ryanvm@gmail.com", "text": "Still asserts on trunk:\n\nASSERTION: unexpected max block size: 'aBSize >= 0', file /builds/slave/m-cen-l64-d-000000000000000000/build/src/layout/generic/nsFloatManager.cpp, line 128\n\nMats, is the attached patch still relevant?", "count": 5, "author": "ryanvm@gmail.com", "id": 10891731, "bug_id": 682647, "creation_time": "2015-10-31T17:31:31Z", "is_private": false, "time": "2015-10-31T17:31:31Z", "raw_text": "Still asserts on trunk:\n\nASSERTION: unexpected max block size: 'aBSize >= 0', file /builds/slave/m-cen-l64-d-000000000000000000/build/src/layout/generic/nsFloatManager.cpp, line 128\n\nMats, is the attached patch still relevant?", "attachment_id": null, "tags": []}, {"id": 10932432, "bug_id": 682647, "is_private": false, "creation_time": "2015-11-14T00:24:17Z", "creator": "MatsPalmgren_bugz@use.startmail.com", "text": "No, I don't think so.  I probably realized at some point that it's just\nwallpaper and it would be better to do something a bit more general.\n\nThe root of the problem is of course the \"padding: 8589934593in;\" in\nthe test.  This is capped to NS_MAXSIZE so we have:\n\n(gdb) p borderPadding\n$7 = {\n  mWritingMode = {\n    mWritingMode = 0 '\\000'\n  }, \n  mMargin = {\n    <mozilla::gfx::BaseMargin<int, nsMargin>> = {\n      top = 1073741824, \n      right = 1073741824, \n      bottom = 1073741824, \n      left = 1073741824\n    }, <No data fields>}\n}\n(gdb) p borderPadding.IStartEnd(wm)\n$8 = -2147483648\n\nwhich leads to a frame having negative width/height.\n\nI've proposed in the past that we should cap these values much more\naggressively in the style system so that situations like this\nwould rarely occur...\n\nWe could also make nsIFrame::SetRect and nsHTMLReflowMetrics::SetSize\nclamp negative width/height.  FWIW, doing the latter makes\nthe nsFloatManager assert go away.", "count": 6, "author": "MatsPalmgren_bugz@use.startmail.com", "tags": [], "time": "2015-11-14T00:24:17Z", "raw_text": "No, I don't think so.  I probably realized at some point that it's just\nwallpaper and it would be better to do something a bit more general.\n\nThe root of the problem is of course the \"padding: 8589934593in;\" in\nthe test.  This is capped to NS_MAXSIZE so we have:\n\n(gdb) p borderPadding\n$7 = {\n  mWritingMode = {\n    mWritingMode = 0 '\\000'\n  }, \n  mMargin = {\n    <mozilla::gfx::BaseMargin<int, nsMargin>> = {\n      top = 1073741824, \n      right = 1073741824, \n      bottom = 1073741824, \n      left = 1073741824\n    }, <No data fields>}\n}\n(gdb) p borderPadding.IStartEnd(wm)\n$8 = -2147483648\n\nwhich leads to a frame having negative width/height.\n\nI've proposed in the past that we should cap these values much more\naggressively in the style system so that situations like this\nwould rarely occur...\n\nWe could also make nsIFrame::SetRect and nsHTMLReflowMetrics::SetSize\nclamp negative width/height.  FWIW, doing the latter makes\nthe nsFloatManager assert go away.", "attachment_id": null}]}}}