{"bugs": {"702179": {"comments": [{"id": 5846029, "attachment_id": null, "raw_text": "Build Firefox with static js lib and enable-dtrace on Solaris.\nRun Firefox.\nRun dtrace -l | grep javascript\n\nActual Results: Get nothing.\n\nThe problem is mozjs-dtrace.o has symbols of dtrace_dof_init and dtrace_dof_fini.\nBut it is not linked into libxul.so.\n\nIt got lost during mozjs-dtrace.o->libjs_static.a->libxul.so.\n\nBy default, archive members are extracted to satisfy undefined references and to promote tentative definitions with data definitions.\n\nSo we need to use allextract for libjs_static.a, or add mozjs-dtrace.o to libxul.so.\n\nI don't know if we need to similar fix it on BSD or Linux.\nAnd I don't know what to do if we have another module with dtrace probe obj.", "author": "ginnchen+exoracle@gmail.com", "creation_time": "2011-11-14T03:51:48Z", "time": "2011-11-14T03:51:48Z", "tags": [], "bug_id": 702179, "text": "Build Firefox with static js lib and enable-dtrace on Solaris.\nRun Firefox.\nRun dtrace -l | grep javascript\n\nActual Results: Get nothing.\n\nThe problem is mozjs-dtrace.o has symbols of dtrace_dof_init and dtrace_dof_fini.\nBut it is not linked into libxul.so.\n\nIt got lost during mozjs-dtrace.o->libjs_static.a->libxul.so.\n\nBy default, archive members are extracted to satisfy undefined references and to promote tentative definitions with data definitions.\n\nSo we need to use allextract for libjs_static.a, or add mozjs-dtrace.o to libxul.so.\n\nI don't know if we need to similar fix it on BSD or Linux.\nAnd I don't know what to do if we have another module with dtrace probe obj.", "creator": "ginnchen+exoracle@gmail.com", "is_private": false, "count": 0}, {"count": 1, "bug_id": 702179, "attachment_id": 574227, "raw_text": "I know it is ugly, but it is what I have for now.", "id": 5846035, "is_private": false, "creator": "ginnchen+exoracle@gmail.com", "creation_time": "2011-11-14T03:56:28Z", "author": "ginnchen+exoracle@gmail.com", "text": "Created attachment 574227\npatch\n\nI know it is ugly, but it is what I have for now.", "tags": [], "time": "2011-11-14T03:56:28Z"}, {"attachment_id": null, "raw_text": "Note that we don't actually link the static library anymore, we create fake static libraries (libmozjs_static.a.desc) that just list the object files contained within. I think we can probably get rid of all the special-case handling for DTrace and just include the probes directly in the \"static library\" we create.", "id": 5846443, "creator": "ted@mielczarek.org", "is_private": false, "author": "ted@mielczarek.org", "creation_time": "2011-11-14T13:08:21Z", "time": "2011-11-14T13:08:21Z", "tags": [], "text": "Note that we don't actually link the static library anymore, we create fake static libraries (libmozjs_static.a.desc) that just list the object files contained within. I think we can probably get rid of all the special-case handling for DTrace and just include the probes directly in the \"static library\" we create.", "count": 2, "bug_id": 702179}, {"attachment_id": null, "raw_text": "We also use the actual static library when both the fake and the static lib exist. For consistency, in that case, we should add MKSHLIB_FORCE_ALL and MKSHLIB_UNFORCE_ALL, but it turns out this breaks things that do expect unused stuff to be magically eliminated (iirc, this happens mostly with the xpcom glue).\n\nThe \"easy\" fix is to stop building the real static library.", "id": 5846518, "creator": "mh+mozilla@glandium.org", "is_private": false, "author": "mh+mozilla@glandium.org", "creation_time": "2011-11-14T14:19:17Z", "tags": [], "time": "2011-11-14T14:19:17Z", "text": "We also use the actual static library when both the fake and the static lib exist. For consistency, in that case, we should add MKSHLIB_FORCE_ALL and MKSHLIB_UNFORCE_ALL, but it turns out this breaks things that do expect unused stuff to be magically eliminated (iirc, this happens mostly with the xpcom glue).\n\nThe \"easy\" fix is to stop building the real static library.", "count": 3, "bug_id": 702179}, {"raw_text": "OK, that will fix it.\n\nI tried MKSHLIB_FORCE_ALL and MKSHLIB_UNFORCE_ALL for js, the generated libxul is sightly larger than just adding mozjs-dtrace.o.", "attachment_id": null, "id": 5848297, "count": 4, "creator": "ginnchen+exoracle@gmail.com", "is_private": false, "tags": [], "time": "2011-11-15T00:57:59Z", "bug_id": 702179, "text": "OK, that will fix it.\n\nI tried MKSHLIB_FORCE_ALL and MKSHLIB_UNFORCE_ALL for js, the generated libxul is sightly larger than just adding mozjs-dtrace.o.", "author": "ginnchen+exoracle@gmail.com", "creation_time": "2011-11-15T00:57:59Z"}, {"id": 5848749, "attachment_id": 574538, "raw_text": "stop building real .a for js_static\nalso fix MOZ_JS_SHARED_LIBS", "creation_time": "2011-11-15T05:28:23Z", "author": "ginnchen+exoracle@gmail.com", "text": "Created attachment 574538\npatch v2\n\nstop building real .a for js_static\nalso fix MOZ_JS_SHARED_LIBS", "tags": [], "time": "2011-11-15T05:28:23Z", "bug_id": 702179, "is_private": false, "creator": "ginnchen+exoracle@gmail.com", "count": 5}, {"creator": "ted@mielczarek.org", "is_private": false, "count": 6, "author": "ted@mielczarek.org", "creation_time": "2011-11-16T15:46:32Z", "tags": [], "time": "2011-11-16T15:46:32Z", "bug_id": 702179, "text": "Comment on attachment 574538\npatch v2\n\nReview of attachment 574538:\n-----------------------------------------------------------------\n\nI'm going to pass this one to glandium.", "attachment_id": 574538, "raw_text": "Review of attachment 574538:\n-----------------------------------------------------------------\n\nI'm going to pass this one to glandium.", "id": 5852574}, {"count": 7, "bug_id": 702179, "raw_text": "Review of attachment 574538:\n-----------------------------------------------------------------\n\n::: configure.in\n@@ +1335,5 @@\n>  MOZ_PNG_CFLAGS=\n>  MOZ_PNG_LIBS='$(call EXPAND_LIBNAME_PATH,mozpng,$(DEPTH)/media/libpng)'\n>  \n> +MOZ_JS_STATIC_LIBS='$(call EXPAND_LIBNAME_PATH,js_static,$(DEPTH)/js/src)'\n> +MOZ_JS_SHARED_LIBS='$(LIBXUL_DIST)/lib/$(DLL_PREFIX)mozjs$(DLL_SUFFIX)'\n\nYou don't need to change MOZ_JS_SHARED_LIBS.", "attachment_id": 574538, "id": 5861839, "creator": "mh+mozilla@glandium.org", "is_private": false, "time": "2011-11-21T06:59:08Z", "tags": [], "text": "Comment on attachment 574538\npatch v2\n\nReview of attachment 574538:\n-----------------------------------------------------------------\n\n::: configure.in\n@@ +1335,5 @@\n>  MOZ_PNG_CFLAGS=\n>  MOZ_PNG_LIBS='$(call EXPAND_LIBNAME_PATH,mozpng,$(DEPTH)/media/libpng)'\n>  \n> +MOZ_JS_STATIC_LIBS='$(call EXPAND_LIBNAME_PATH,js_static,$(DEPTH)/js/src)'\n> +MOZ_JS_SHARED_LIBS='$(LIBXUL_DIST)/lib/$(DLL_PREFIX)mozjs$(DLL_SUFFIX)'\n\nYou don't need to change MOZ_JS_SHARED_LIBS.", "author": "mh+mozilla@glandium.org", "creation_time": "2011-11-21T06:59:08Z"}, {"author": "ginnchen+exoracle@gmail.com", "creation_time": "2011-11-21T13:38:49Z", "bug_id": 702179, "tags": [], "time": "2011-11-21T13:38:49Z", "text": "(In reply to Mike Hommey [:glandium] from comment #7)\n\n> You don't need to change MOZ_JS_SHARED_LIBS.\n\nYou're right.\n\nI didn't know we have scripts to change it to libmozjs.so.", "creator": "ginnchen+exoracle@gmail.com", "is_private": false, "count": 8, "id": 5862183, "attachment_id": null, "raw_text": "(In reply to Mike Hommey [:glandium] from comment #7)\n\n> You don't need to change MOZ_JS_SHARED_LIBS.\n\nYou're right.\n\nI didn't know we have scripts to change it to libmozjs.so."}, {"id": 5881092, "attachment_id": null, "raw_text": "http://hg.mozilla.org/integration/mozilla-inbound/rev/281583d67072", "author": "ginnchen+exoracle@gmail.com", "creation_time": "2011-11-30T03:27:37Z", "bug_id": 702179, "time": "2011-11-30T03:27:37Z", "tags": [], "text": "http://hg.mozilla.org/integration/mozilla-inbound/rev/281583d67072", "creator": "ginnchen+exoracle@gmail.com", "is_private": false, "count": 9}, {"creation_time": "2011-11-30T10:11:32Z", "author": "mh+mozilla@glandium.org", "text": "Created attachment 577901\nAdditional change\n\nBug 673616 made a (wrong) change that broke win64 when this bug landed. I think this additional patch should solve the issue. I'll push on try.", "time": "2011-11-30T10:11:32Z", "tags": [], "bug_id": 702179, "is_private": false, "creator": "mh+mozilla@glandium.org", "count": 10, "id": 5881582, "attachment_id": 577901, "raw_text": "Bug 673616 made a (wrong) change that broke win64 when this bug landed. I think this additional patch should solve the issue. I'll push on try."}, {"count": 11, "is_private": false, "creator": "mak@mozilla.com", "text": "backed out for comment 10", "tags": [], "time": "2011-11-30T10:14:07Z", "bug_id": 702179, "creation_time": "2011-11-30T10:14:07Z", "author": "mak@mozilla.com", "raw_text": "backed out for comment 10", "attachment_id": null, "id": 5881585}, {"count": 12, "bug_id": 702179, "attachment_id": null, "raw_text": "Try run looks good (with the typo fixed in the patch I attached)\n\nhttps://tbpl.mozilla.org/?tree=Try&rev=cff48b989bcd", "id": 5881828, "is_private": false, "creator": "mh+mozilla@glandium.org", "creation_time": "2011-11-30T13:22:09Z", "author": "mh+mozilla@glandium.org", "text": "Try run looks good (with the typo fixed in the patch I attached)\n\nhttps://tbpl.mozilla.org/?tree=Try&rev=cff48b989bcd", "time": "2011-11-30T13:22:09Z", "tags": []}, {"creator": "ginnchen+exoracle@gmail.com", "is_private": false, "count": 13, "author": "ginnchen+exoracle@gmail.com", "creation_time": "2011-12-21T11:29:55Z", "bug_id": 702179, "tags": [], "time": "2011-12-21T11:29:55Z", "text": "Reland with additional fix\n\nhttp://hg.mozilla.org/integration/mozilla-inbound/rev/1d0ec7fa8b96", "attachment_id": null, "raw_text": "Reland with additional fix\n\nhttp://hg.mozilla.org/integration/mozilla-inbound/rev/1d0ec7fa8b96", "id": 5932196}, {"id": 5932637, "raw_text": "Backed out for build PGO Linux build failures:\nhttps://tbpl.mozilla.org/?tree=Mozilla-Inbound&rev=f154f18b320a\nhttps://tbpl.mozilla.org/php/getParsedLog.php?id=8087854&tree=Mozilla-Inbound\n{\n/tools/python/bin/python2.5 /builds/slave/m-in-lnx64-pgo/build/config/pythonpath.py -I../../config /builds/slave/m-in-lnx64-pgo/build/config/expandlibs_exec.py --uselist --  <<snip>>\ng++: error trying to exec '/tools/gcc-4.5-0moz3/libexec/gcc/x86_64-unknown-linux-gnu/4.5.2/collect2': execv: Argument list too long\n}", "attachment_id": null, "text": "Backed out for build PGO Linux build failures:\nhttps://tbpl.mozilla.org/?tree=Mozilla-Inbound&rev=f154f18b320a\nhttps://tbpl.mozilla.org/php/getParsedLog.php?id=8087854&tree=Mozilla-Inbound\n{\n/tools/python/bin/python2.5 /builds/slave/m-in-lnx64-pgo/build/config/pythonpath.py -I../../config /builds/slave/m-in-lnx64-pgo/build/config/expandlibs_exec.py --uselist --  <<snip>>\ng++: error trying to exec '/tools/gcc-4.5-0moz3/libexec/gcc/x86_64-unknown-linux-gnu/4.5.2/collect2': execv: Argument list too long\n}", "time": "2011-12-21T15:59:22Z", "bug_id": 702179, "tags": [], "creation_time": "2011-12-21T15:59:22Z", "author": "emorley@mozilla.com", "count": 14, "is_private": false, "creator": "emorley@mozilla.com"}, {"id": 5932639, "raw_text": "Backout:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/856b3079c55c", "attachment_id": null, "tags": [], "bug_id": 702179, "time": "2011-12-21T15:59:47Z", "text": "Backout:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/856b3079c55c", "author": "emorley@mozilla.com", "creation_time": "2011-12-21T15:59:47Z", "count": 15, "creator": "emorley@mozilla.com", "is_private": false}, {"id": 5932652, "attachment_id": null, "raw_text": "(In reply to Ed Morley [:edmorley] from comment #14)\n> Backed out for build PGO Linux build failures:\n> https://tbpl.mozilla.org/?tree=Mozilla-Inbound&rev=f154f18b320a\n> https://tbpl.mozilla.org/php/getParsedLog.php?id=8087854&tree=Mozilla-Inbound\n> {\n> /tools/python/bin/python2.5\n> /builds/slave/m-in-lnx64-pgo/build/config/pythonpath.py -I../../config\n> /builds/slave/m-in-lnx64-pgo/build/config/expandlibs_exec.py --uselist -- \n> <<snip>>\n> g++: error trying to exec\n> '/tools/gcc-4.5-0moz3/libexec/gcc/x86_64-unknown-linux-gnu/4.5.2/collect2':\n> execv: Argument list too long\n> }\n\nO_o that's exactly the kind of error that expandlibs was designed to avoid", "author": "mh+mozilla@glandium.org", "creation_time": "2011-12-21T16:05:14Z", "bug_id": 702179, "time": "2011-12-21T16:05:14Z", "tags": [], "text": "(In reply to Ed Morley [:edmorley] from comment #14)\n> Backed out for build PGO Linux build failures:\n> https://tbpl.mozilla.org/?tree=Mozilla-Inbound&rev=f154f18b320a\n> https://tbpl.mozilla.org/php/getParsedLog.php?id=8087854&tree=Mozilla-Inbound\n> {\n> /tools/python/bin/python2.5\n> /builds/slave/m-in-lnx64-pgo/build/config/pythonpath.py -I../../config\n> /builds/slave/m-in-lnx64-pgo/build/config/expandlibs_exec.py --uselist -- \n> <<snip>>\n> g++: error trying to exec\n> '/tools/gcc-4.5-0moz3/libexec/gcc/x86_64-unknown-linux-gnu/4.5.2/collect2':\n> execv: Argument list too long\n> }\n\nO_o that's exactly the kind of error that expandlibs was designed to avoid", "creator": "mh+mozilla@glandium.org", "is_private": false, "count": 16}, {"count": 17, "creator": "ginnchen+exoracle@gmail.com", "is_private": false, "tags": [], "time": "2011-12-22T06:16:06Z", "bug_id": 702179, "text": "(In reply to Mike Hommey [:glandium] from comment #16)\n\n> > g++: error trying to exec\n> > '/tools/gcc-4.5-0moz3/libexec/gcc/x86_64-unknown-linux-gnu/4.5.2/collect2':\n> > execv: Argument list too long\n> > }\n> \n> O_o that's exactly the kind of error that expandlibs was designed to avoid\n\nI guess gcc extracts the list when it executes collect2.", "author": "ginnchen+exoracle@gmail.com", "creation_time": "2011-12-22T06:16:06Z", "raw_text": "(In reply to Mike Hommey [:glandium] from comment #16)\n\n> > g++: error trying to exec\n> > '/tools/gcc-4.5-0moz3/libexec/gcc/x86_64-unknown-linux-gnu/4.5.2/collect2':\n> > execv: Argument list too long\n> > }\n> \n> O_o that's exactly the kind of error that expandlibs was designed to avoid\n\nI guess gcc extracts the list when it executes collect2.", "attachment_id": null, "id": 5934611}, {"attachment_id": null, "raw_text": "collect2 is not supposed to see the list, it should be in a linker script, thus seen by ld directly.", "id": 5934657, "is_private": false, "creator": "mh+mozilla@glandium.org", "count": 18, "creation_time": "2011-12-22T07:16:41Z", "author": "mh+mozilla@glandium.org", "text": "collect2 is not supposed to see the list, it should be in a linker script, thus seen by ld directly.", "time": "2011-12-22T07:16:41Z", "bug_id": 702179, "tags": []}, {"id": 5934737, "attachment_id": null, "raw_text": "even better, it just built on try...", "author": "mh+mozilla@glandium.org", "creation_time": "2011-12-22T09:14:00Z", "time": "2011-12-22T09:14:00Z", "bug_id": 702179, "tags": [], "text": "even better, it just built on try...", "creator": "mh+mozilla@glandium.org", "is_private": false, "count": 19}, {"id": 6021892, "attachment_id": null, "raw_text": "Reland after Bug 719742 is fixed.", "author": "ginnchen+exoracle@gmail.com", "creation_time": "2012-01-31T06:54:49Z", "bug_id": 702179, "tags": [], "time": "2012-01-31T06:54:49Z", "text": "Reland after Bug 719742 is fixed.", "creator": "ginnchen+exoracle@gmail.com", "is_private": false, "count": 20}, {"raw_text": "backout\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/5cb20ac871d0\n\nWindows build uses shared js...\n\nTestRacingServiceManager.exe : fatal error LNK1120: 1 unresolved externals\nmake[6]: *** [TestRacingServiceManager.exe] Error 96\nmake[5]: *** [tools] Error 2\nmake[4]: *** [tools_tier_platform] Error 2\nmake[3]: *** [tier_platform] Error 2\nmake[2]: *** [default] Error 2\nmake[1]: *** [realbuild] Error 2\nmake: *** [build] Error 2\n\nMacOSX ...\n\nmake[7]: *** [TestGetURL] Error 1\nmake[7]: *** Waiting for unfinished jobs....\nmake[7]: *** [TestNativeXMLHttpRequest] Error 1\nmake[6]: *** [tools] Error 2\nmake[5]: *** [base_tools] Error 2\nmake[4]: *** [tools_tier_platform] Error 2\nmake[3]: *** [tier_platform] Error 2\nmake[2]: *** [default] Error 2\nmake[1]: *** [realbuild] Error 2\nmake: *** [build] Error 2", "attachment_id": null, "id": 6022009, "count": 21, "creator": "m_kato@ga2.so-net.ne.jp", "is_private": false, "time": "2012-01-31T09:04:17Z", "bug_id": 702179, "tags": [], "text": "backout\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/5cb20ac871d0\n\nWindows build uses shared js...\n\nTestRacingServiceManager.exe : fatal error LNK1120: 1 unresolved externals\nmake[6]: *** [TestRacingServiceManager.exe] Error 96\nmake[5]: *** [tools] Error 2\nmake[4]: *** [tools_tier_platform] Error 2\nmake[3]: *** [tier_platform] Error 2\nmake[2]: *** [default] Error 2\nmake[1]: *** [realbuild] Error 2\nmake: *** [build] Error 2\n\nMacOSX ...\n\nmake[7]: *** [TestGetURL] Error 1\nmake[7]: *** Waiting for unfinished jobs....\nmake[7]: *** [TestNativeXMLHttpRequest] Error 1\nmake[6]: *** [tools] Error 2\nmake[5]: *** [base_tools] Error 2\nmake[4]: *** [tools_tier_platform] Error 2\nmake[3]: *** [tier_platform] Error 2\nmake[2]: *** [default] Error 2\nmake[1]: *** [realbuild] Error 2\nmake: *** [build] Error 2", "author": "m_kato@ga2.so-net.ne.jp", "creation_time": "2012-01-31T09:04:17Z"}, {"id": 6022185, "raw_text": "So we do require $(MOZ_JS_LIBS) for debug build now, even no JS_SHARED_LIBRARY or MOZ_SHARK. (for JS_Assert)\n\nI can't remember why it broke win64.", "attachment_id": null, "tags": [], "time": "2012-01-31T11:00:15Z", "text": "So we do require $(MOZ_JS_LIBS) for debug build now, even no JS_SHARED_LIBRARY or MOZ_SHARK. (for JS_Assert)\n\nI can't remember why it broke win64.", "author": "ginnchen+exoracle@gmail.com", "creation_time": "2012-01-31T11:00:15Z", "creator": "ginnchen+exoracle@gmail.com", "is_private": false, "bug_id": 702179, "count": 22}, {"id": 6022440, "attachment_id": null, "raw_text": "Here's the error message with Win64 opt, without the additional fix.\n\nc:/mozilla-build/python/python2.6.exe /e/builds/moz2_slave/try-w64/build/config/pythonpath.py -I../../../config /e/builds/moz2_slave/try-w64/build/config/expandlibs_exec.py --uselist -- link -nologo -out:TestCOM.exe -pdb:TestCOM.pdb TestCOM.obj  -LARGEADDRESSAWARE -NXCOMPAT -DYNAMICBASE  -DEBUG -DEBUGTYPE:CV -DEBUG -OPT:REF,ICF   -LIBPATH:../../../dist/lib -NODEFAULTLIB:msvcrt -NODEFAULTLIB:msvcrtd -NODEFAULTLIB:msvcprt -NODEFAULTLIB:msvcprtd -DEFAULTLIB:mozcrt e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcomglue_s.lib e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcom.lib e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/mozalloc.lib e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/nspr4.lib e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plc4.lib e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plds4.lib  ../../../js/src/js_static.lib  rpcrt4.lib uuid.lib advapi32.lib\n   Creating library TestCOM.lib and object TestCOM.exp\nprmjtime.obj : error LNK2019: unresolved external symbol __imp_timeEndPeriod referenced in function \"void __cdecl NowCalibrate(void)\" (?NowCalibrate@@YAXXZ)\nprmjtime.obj : error LNK2019: unresolved external symbol __imp_timeBeginPeriod referenced in function \"void __cdecl NowCalibrate(void)\" (?NowCalibrate@@YAXXZ)\nTestCOM.exe : fatal error LNK1120: 2 unresolved externals\n\nSo the problem is:\nMOZ_ASSERT uses JS_Assert for debug builds, we need link js libs for that.\nIf we use js_static.lib on Win64, we need Winmm.lib.", "creation_time": "2012-01-31T14:21:44Z", "author": "ginnchen+exoracle@gmail.com", "text": "Here's the error message with Win64 opt, without the additional fix.\n\nc:/mozilla-build/python/python2.6.exe /e/builds/moz2_slave/try-w64/build/config/pythonpath.py -I../../../config /e/builds/moz2_slave/try-w64/build/config/expandlibs_exec.py --uselist -- link -nologo -out:TestCOM.exe -pdb:TestCOM.pdb TestCOM.obj  -LARGEADDRESSAWARE -NXCOMPAT -DYNAMICBASE  -DEBUG -DEBUGTYPE:CV -DEBUG -OPT:REF,ICF   -LIBPATH:../../../dist/lib -NODEFAULTLIB:msvcrt -NODEFAULTLIB:msvcrtd -NODEFAULTLIB:msvcprt -NODEFAULTLIB:msvcprtd -DEFAULTLIB:mozcrt e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcomglue_s.lib e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcom.lib e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/mozalloc.lib e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/nspr4.lib e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plc4.lib e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plds4.lib  ../../../js/src/js_static.lib  rpcrt4.lib uuid.lib advapi32.lib\n   Creating library TestCOM.lib and object TestCOM.exp\nprmjtime.obj : error LNK2019: unresolved external symbol __imp_timeEndPeriod referenced in function \"void __cdecl NowCalibrate(void)\" (?NowCalibrate@@YAXXZ)\nprmjtime.obj : error LNK2019: unresolved external symbol __imp_timeBeginPeriod referenced in function \"void __cdecl NowCalibrate(void)\" (?NowCalibrate@@YAXXZ)\nTestCOM.exe : fatal error LNK1120: 2 unresolved externals\n\nSo the problem is:\nMOZ_ASSERT uses JS_Assert for debug builds, we need link js libs for that.\nIf we use js_static.lib on Win64, we need Winmm.lib.", "bug_id": 702179, "time": "2012-01-31T14:21:44Z", "tags": [], "is_private": false, "creator": "ginnchen+exoracle@gmail.com", "count": 23}, {"text": "So it all boils down to bug 717540", "bug_id": 702179, "tags": [], "time": "2012-01-31T14:36:11Z", "creation_time": "2012-01-31T14:36:11Z", "author": "mh+mozilla@glandium.org", "count": 24, "is_private": false, "creator": "mh+mozilla@glandium.org", "id": 6022469, "raw_text": "So it all boils down to bug 717540", "attachment_id": null}, {"count": 25, "is_private": false, "creator": "m_kato@ga2.so-net.ne.jp", "text": "(In reply to Ginn Chen from comment #23)\n> Here's the error message with Win64 opt, without the additional fix.\n> \n> c:/mozilla-build/python/python2.6.exe\n> /e/builds/moz2_slave/try-w64/build/config/pythonpath.py -I../../../config\n> /e/builds/moz2_slave/try-w64/build/config/expandlibs_exec.py --uselist --\n> link -nologo -out:TestCOM.exe -pdb:TestCOM.pdb TestCOM.obj \n> -LARGEADDRESSAWARE -NXCOMPAT -DYNAMICBASE  -DEBUG -DEBUGTYPE:CV -DEBUG\n> -OPT:REF,ICF   -LIBPATH:../../../dist/lib -NODEFAULTLIB:msvcrt\n> -NODEFAULTLIB:msvcrtd -NODEFAULTLIB:msvcprt -NODEFAULTLIB:msvcprtd\n> -DEFAULTLIB:mozcrt\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcomglue_s.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcom.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/mozalloc.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/nspr4.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plc4.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plds4.lib \n> ../../../js/src/js_static.lib  rpcrt4.lib uuid.lib advapi32.lib\n>    Creating library TestCOM.lib and object TestCOM.exp\n> prmjtime.obj : error LNK2019: unresolved external symbol __imp_timeEndPeriod\n> referenced in function \"void __cdecl NowCalibrate(void)\"\n> (?NowCalibrate@@YAXXZ)\n> prmjtime.obj : error LNK2019: unresolved external symbol\n> __imp_timeBeginPeriod referenced in function \"void __cdecl\n> NowCalibrate(void)\" (?NowCalibrate@@YAXXZ)\n> TestCOM.exe : fatal error LNK1120: 2 unresolved externals\n> \n> So the problem is:\n> MOZ_ASSERT uses JS_Assert for debug builds, we need link js libs for that.\n> If we use js_static.lib on Win64, we need Winmm.lib.\n\n(In reply to Ginn Chen from comment #23)\n> Here's the error message with Win64 opt, without the additional fix.\n> \n> c:/mozilla-build/python/python2.6.exe\n> /e/builds/moz2_slave/try-w64/build/config/pythonpath.py -I../../../config\n> /e/builds/moz2_slave/try-w64/build/config/expandlibs_exec.py --uselist --\n> link -nologo -out:TestCOM.exe -pdb:TestCOM.pdb TestCOM.obj \n> -LARGEADDRESSAWARE -NXCOMPAT -DYNAMICBASE  -DEBUG -DEBUGTYPE:CV -DEBUG\n> -OPT:REF,ICF   -LIBPATH:../../../dist/lib -NODEFAULTLIB:msvcrt\n> -NODEFAULTLIB:msvcrtd -NODEFAULTLIB:msvcprt -NODEFAULTLIB:msvcprtd\n> -DEFAULTLIB:mozcrt\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcomglue_s.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcom.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/mozalloc.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/nspr4.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plc4.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plds4.lib \n> ../../../js/src/js_static.lib  rpcrt4.lib uuid.lib advapi32.lib\n>    Creating library TestCOM.lib and object TestCOM.exp\n> prmjtime.obj : error LNK2019: unresolved external symbol __imp_timeEndPeriod\n> referenced in function \"void __cdecl NowCalibrate(void)\"\n> (?NowCalibrate@@YAXXZ)\n> prmjtime.obj : error LNK2019: unresolved external symbol\n> __imp_timeBeginPeriod referenced in function \"void __cdecl\n> NowCalibrate(void)\" (?NowCalibrate@@YAXXZ)\n> TestCOM.exe : fatal error LNK1120: 2 unresolved externals\n> \n> So the problem is:\n> MOZ_ASSERT uses JS_Assert for debug builds, we need link js libs for that.\n> If we use js_static.lib on Win64, we need Winmm.lib.\n\nWin64 is --disable-shared-js as default.  (Win32 is --enable-shared-js as default).  If using --disable-shared-js on Win32, this error will occurs.  Also, this option will turn on after switching to VS2010SP1.\n\nAlso, this error means that winmm.lib is requried for linking.", "time": "2012-01-31T14:40:44Z", "bug_id": 702179, "tags": [], "creation_time": "2012-01-31T14:40:44Z", "author": "m_kato@ga2.so-net.ne.jp", "raw_text": "(In reply to Ginn Chen from comment #23)\n> Here's the error message with Win64 opt, without the additional fix.\n> \n> c:/mozilla-build/python/python2.6.exe\n> /e/builds/moz2_slave/try-w64/build/config/pythonpath.py -I../../../config\n> /e/builds/moz2_slave/try-w64/build/config/expandlibs_exec.py --uselist --\n> link -nologo -out:TestCOM.exe -pdb:TestCOM.pdb TestCOM.obj \n> -LARGEADDRESSAWARE -NXCOMPAT -DYNAMICBASE  -DEBUG -DEBUGTYPE:CV -DEBUG\n> -OPT:REF,ICF   -LIBPATH:../../../dist/lib -NODEFAULTLIB:msvcrt\n> -NODEFAULTLIB:msvcrtd -NODEFAULTLIB:msvcprt -NODEFAULTLIB:msvcprtd\n> -DEFAULTLIB:mozcrt\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcomglue_s.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcom.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/mozalloc.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/nspr4.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plc4.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plds4.lib \n> ../../../js/src/js_static.lib  rpcrt4.lib uuid.lib advapi32.lib\n>    Creating library TestCOM.lib and object TestCOM.exp\n> prmjtime.obj : error LNK2019: unresolved external symbol __imp_timeEndPeriod\n> referenced in function \"void __cdecl NowCalibrate(void)\"\n> (?NowCalibrate@@YAXXZ)\n> prmjtime.obj : error LNK2019: unresolved external symbol\n> __imp_timeBeginPeriod referenced in function \"void __cdecl\n> NowCalibrate(void)\" (?NowCalibrate@@YAXXZ)\n> TestCOM.exe : fatal error LNK1120: 2 unresolved externals\n> \n> So the problem is:\n> MOZ_ASSERT uses JS_Assert for debug builds, we need link js libs for that.\n> If we use js_static.lib on Win64, we need Winmm.lib.\n\n(In reply to Ginn Chen from comment #23)\n> Here's the error message with Win64 opt, without the additional fix.\n> \n> c:/mozilla-build/python/python2.6.exe\n> /e/builds/moz2_slave/try-w64/build/config/pythonpath.py -I../../../config\n> /e/builds/moz2_slave/try-w64/build/config/expandlibs_exec.py --uselist --\n> link -nologo -out:TestCOM.exe -pdb:TestCOM.pdb TestCOM.obj \n> -LARGEADDRESSAWARE -NXCOMPAT -DYNAMICBASE  -DEBUG -DEBUGTYPE:CV -DEBUG\n> -OPT:REF,ICF   -LIBPATH:../../../dist/lib -NODEFAULTLIB:msvcrt\n> -NODEFAULTLIB:msvcrtd -NODEFAULTLIB:msvcprt -NODEFAULTLIB:msvcprtd\n> -DEFAULTLIB:mozcrt\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcomglue_s.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/xpcom.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/mozalloc.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/nspr4.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plc4.lib\n> e:/builds/moz2_slave/try-w64/build/obj-firefox/dist/lib/plds4.lib \n> ../../../js/src/js_static.lib  rpcrt4.lib uuid.lib advapi32.lib\n>    Creating library TestCOM.lib and object TestCOM.exp\n> prmjtime.obj : error LNK2019: unresolved external symbol __imp_timeEndPeriod\n> referenced in function \"void __cdecl NowCalibrate(void)\"\n> (?NowCalibrate@@YAXXZ)\n> prmjtime.obj : error LNK2019: unresolved external symbol\n> __imp_timeBeginPeriod referenced in function \"void __cdecl\n> NowCalibrate(void)\" (?NowCalibrate@@YAXXZ)\n> TestCOM.exe : fatal error LNK1120: 2 unresolved externals\n> \n> So the problem is:\n> MOZ_ASSERT uses JS_Assert for debug builds, we need link js libs for that.\n> If we use js_static.lib on Win64, we need Winmm.lib.\n\nWin64 is --disable-shared-js as default.  (Win32 is --enable-shared-js as default).  If using --disable-shared-js on Win32, this error will occurs.  Also, this option will turn on after switching to VS2010SP1.\n\nAlso, this error means that winmm.lib is requried for linking.", "attachment_id": null, "id": 6022480}, {"bug_id": 702179, "count": 26, "time": "2014-07-21T17:03:50Z", "tags": [], "text": "(In reply to Ginn Chen from comment #0)\n> I don't know if we need to similar fix it on BSD or Linux.\n\nConfirming the issue for FreeBSD. Not sure in what shape userland DTrace is on NetBSD.", "author": "jbeich@FreeBSD.org", "creation_time": "2014-07-21T17:03:50Z", "creator": "jbeich@FreeBSD.org", "is_private": false, "id": 9080380, "raw_text": "(In reply to Ginn Chen from comment #0)\n> I don't know if we need to similar fix it on BSD or Linux.\n\nConfirming the issue for FreeBSD. Not sure in what shape userland DTrace is on NetBSD.", "attachment_id": null}, {"creation_time": "2014-07-24T13:20:42Z", "author": "jbeich@FreeBSD.org", "text": "comment 9 before/after bug 1036894. \"after\" version regresses bug 1041936 comment 10.\n\nhttps://treeherder.mozilla.org/ui/#/jobs?repo=try&revision=d163f60763e5\nhttps://treeherder.mozilla.org/ui/#/jobs?repo=try&revision=6bdb85ae34bf", "tags": [], "time": "2014-07-24T13:20:42Z", "is_private": false, "creator": "jbeich@FreeBSD.org", "id": 9095510, "attachment_id": null, "raw_text": "comment 9 before/after bug 1036894. \"after\" version regresses bug 1041936 comment 10.\n\nhttps://treeherder.mozilla.org/ui/#/jobs?repo=try&revision=d163f60763e5\nhttps://treeherder.mozilla.org/ui/#/jobs?repo=try&revision=6bdb85ae34bf", "bug_id": 702179, "count": 27}, {"id": 12094371, "attachment_id": 8840706, "raw_text": "Review commit: https://reviewboard.mozilla.org/r/115138/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/115138/", "creation_time": "2017-02-24T03:02:46Z", "author": "jbeich@FreeBSD.org", "text": "Created attachment 8840706\nBug 702179 - Don't build static JS library to fix DTrace probes on Solaris and FreeBSD.\n\nReview commit: https://reviewboard.mozilla.org/r/115138/diff/#index_header\nSee other reviews: https://reviewboard.mozilla.org/r/115138/", "time": "2017-02-24T03:02:46Z", "tags": ["mozreview-request"], "bug_id": 702179, "is_private": false, "creator": "jbeich@FreeBSD.org", "count": 28}, {"text": "Comment on attachment 8840706\nBug 702179 - Don't build static JS library to fix DTrace probes on Solaris and FreeBSD.\n\nhttps://reviewboard.mozilla.org/r/115138/#review116614", "tags": ["mozreview-review", "obsolete"], "time": "2017-02-24T03:16:10Z", "creation_time": "2017-02-24T03:16:10Z", "author": "jbeich@FreeBSD.org", "is_private": false, "creator": "jbeich@FreeBSD.org", "id": 12094387, "raw_text": "https://reviewboard.mozilla.org/r/115138/#review116614", "attachment_id": 8840706, "bug_id": 702179, "count": 29}, {"id": 12094388, "raw_text": "https://reviewboard.mozilla.org/r/115138/#review116614\n\n[PGO Try build](https://treeherder.mozilla.org/#/jobs?repo=try&revision=35741a4c871e1487d040a5e2aa81480e9a231c20)", "attachment_id": 8840706, "tags": ["mozreview-review-reply"], "bug_id": 702179, "time": "2017-02-24T03:17:36Z", "text": "Comment on attachment 8840706\nBug 702179 - Don't build static JS library to fix DTrace probes on Solaris and FreeBSD.\n\nhttps://reviewboard.mozilla.org/r/115138/#review116614\n\n[PGO Try build](https://treeherder.mozilla.org/#/jobs?repo=try&revision=35741a4c871e1487d040a5e2aa81480e9a231c20)", "author": "jbeich@FreeBSD.org", "creation_time": "2017-02-24T03:17:36Z", "count": 30, "creator": "jbeich@FreeBSD.org", "is_private": false}, {"id": 12094653, "raw_text": "https://reviewboard.mozilla.org/r/115136/#review116646", "attachment_id": 8840706, "text": "Comment on attachment 8840706\nBug 702179 - Don't build static JS library to fix DTrace probes on Solaris and FreeBSD.\n\nhttps://reviewboard.mozilla.org/r/115136/#review116646", "bug_id": 702179, "tags": ["mozreview-review"], "time": "2017-02-24T07:24:09Z", "creation_time": "2017-02-24T07:24:09Z", "author": "jbeich@FreeBSD.org", "count": 31, "is_private": false, "creator": "jbeich@FreeBSD.org"}, {"raw_text": "https://reviewboard.mozilla.org/r/115138/#review116648\n\n`make check` on Linux and mozjs-crate debug build failed.\n\n```\nobj-firefox/_virtualenv/bin/python config/check_vanilla_allocations.py libjs_static.a\nTraceback (most recent call last):\n  File \"config/check_vanilla_allocations.py\", line 190, in <module>\n    main()\n  File \"config/check_vanilla_allocations.py\", line 81, in main\n    stderr=subprocess.PIPE).split('\\n')\n  File \"/usr/lib/python2.7/subprocess.py\", line 573, in check_output\n    raise CalledProcessError(retcode, cmd, output=output)\nsubprocess.CalledProcessError: Command '['nm', '-u', '-C', '-A', 'libjs_static.a']' returned non-zero exit status 1\nMakefile:53: recipe for target 'check-vanilla-allocations' failed\nmake[1]: *** [check-vanilla-allocations] Error 1\nmake[1]: Target 'check' not remade because of errors.\n```\n\n```\n+ cargo build --verbose --frozen --features debugmozjs\n[...]\n     Running `rustc --crate-name mozjs_sys lib.rs --crate-type lib -g --cfg feature=\\\"debugmozjs\\\" -C metadata=5b0cf026770f624a -C extra-filename=-5b0cf026770f624a --out-dir js/src/target/debug/deps --emit=dep-info,link -L dependency=js/src/target/debug/deps --extern libc=js/src/target/debug/deps/liblibc-83c2bd88b43ecde3.rlib --extern libz_sys=js/src/target/debug/deps/liblibz_sys-16ebe4b239f83619.rlib -L native=js/src/target/debug/build/mozjs_sys-f2c6bbd7d5d251d7/out/js/src -l stdc++ -l static=js_static -L native=/usr/lib64`\nerror: could not find native static library `js_static`, perhaps an -L flag is missing?\n\nerror: Could not compile `mozjs_sys`.\n```", "attachment_id": 8840706, "id": 12094658, "count": 32, "is_private": false, "creator": "jbeich@FreeBSD.org", "text": "Comment on attachment 8840706\nBug 702179 - Don't build static JS library to fix DTrace probes on Solaris and FreeBSD.\n\nhttps://reviewboard.mozilla.org/r/115138/#review116648\n\n`make check` on Linux and mozjs-crate debug build failed.\n\n```\nobj-firefox/_virtualenv/bin/python config/check_vanilla_allocations.py libjs_static.a\nTraceback (most recent call last):\n  File \"config/check_vanilla_allocations.py\", line 190, in <module>\n    main()\n  File \"config/check_vanilla_allocations.py\", line 81, in main\n    stderr=subprocess.PIPE).split('\\n')\n  File \"/usr/lib/python2.7/subprocess.py\", line 573, in check_output\n    raise CalledProcessError(retcode, cmd, output=output)\nsubprocess.CalledProcessError: Command '['nm', '-u', '-C', '-A', 'libjs_static.a']' returned non-zero exit status 1\nMakefile:53: recipe for target 'check-vanilla-allocations' failed\nmake[1]: *** [check-vanilla-allocations] Error 1\nmake[1]: Target 'check' not remade because of errors.\n```\n\n```\n+ cargo build --verbose --frozen --features debugmozjs\n[...]\n     Running `rustc --crate-name mozjs_sys lib.rs --crate-type lib -g --cfg feature=\\\"debugmozjs\\\" -C metadata=5b0cf026770f624a -C extra-filename=-5b0cf026770f624a --out-dir js/src/target/debug/deps --emit=dep-info,link -L dependency=js/src/target/debug/deps --extern libc=js/src/target/debug/deps/liblibc-83c2bd88b43ecde3.rlib --extern libz_sys=js/src/target/debug/deps/liblibz_sys-16ebe4b239f83619.rlib -L native=js/src/target/debug/build/mozjs_sys-f2c6bbd7d5d251d7/out/js/src -l stdc++ -l static=js_static -L native=/usr/lib64`\nerror: could not find native static library `js_static`, perhaps an -L flag is missing?\n\nerror: Could not compile `mozjs_sys`.\n```", "tags": ["mozreview-review"], "bug_id": 702179, "time": "2017-02-24T07:26:42Z", "creation_time": "2017-02-24T07:26:42Z", "author": "jbeich@FreeBSD.org"}, {"id": 13256701, "raw_text": "No longer builds after bug 1063728:\n\ngmake[2]: Entering directory 'obj-x86_64-unknown-freebsd12.0/js/src/build'\ngmake[2]: *** No rule to make target 'libjs_static.a', needed by 'spidermonkey_checks'.  Stop.", "attachment_id": 8840706, "bug_id": 702179, "tags": [], "time": "2018-05-05T22:29:44Z", "text": "Comment on attachment 8840706\nBug 702179 - Don't build static JS library to fix DTrace probes on Solaris and FreeBSD.\n\nNo longer builds after bug 1063728:\n\ngmake[2]: Entering directory 'obj-x86_64-unknown-freebsd12.0/js/src/build'\ngmake[2]: *** No rule to make target 'libjs_static.a', needed by 'spidermonkey_checks'.  Stop.", "author": "jbeich@FreeBSD.org", "creation_time": "2018-05-05T22:29:44Z", "count": 33, "creator": "jbeich@FreeBSD.org", "is_private": false}]}}, "comments": {}}