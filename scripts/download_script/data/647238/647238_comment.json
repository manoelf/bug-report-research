{"comments": {}, "bugs": {"647238": {"comments": [{"attachment_id": null, "is_private": false, "creator": "sabreware@gmail.com", "tags": [], "raw_text": "User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0) Gecko/20100101 Firefox/4.0\nBuild Identifier: Firefox 4.0\n\nI have written a great deal of animation code, and I find that it is consistently jerky in Firefox 4, whereas, it's rock solid in Chrome and Safari.\n\nThe example that I have provided uses the clipping region to avoid erasing the entire canvas every frame (that's why the background is painted in as the discs move), but clipping is not the problem. If I change the example so that it erases the canvas every frame, I still get the same results: jerky animation in Firefox, rock solid in webkit browsers.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Open the web page in the provided url\n2. Click the animate button\n3.\nActual Results:  \nJerky animation\n\nExpected Results:  \nSmooth animation\n\nI have noticed other problems when I use themes, such as images not being painted in a canvas, but this problem -- jerky animation -- is unrelated to themes. The animation is jerky whether I have a theme installed or not.\n\nThe example that I provided does not use mozRequestAnimationFrame(), because in Firefox 4 that method restricts the number of fps to an unrealistic number that makes the animation even worse.\n\nI have filed this under Severity: Major, because I feel this is a show-stopper for animations in Firefox.", "creation_time": "2011-04-01T15:38:23Z", "bug_id": 647238, "id": 5386345, "author": "sabreware@gmail.com", "time": "2011-04-01T15:38:23Z", "count": 0, "text": "User-Agent:       Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0) Gecko/20100101 Firefox/4.0\nBuild Identifier: Firefox 4.0\n\nI have written a great deal of animation code, and I find that it is consistently jerky in Firefox 4, whereas, it's rock solid in Chrome and Safari.\n\nThe example that I have provided uses the clipping region to avoid erasing the entire canvas every frame (that's why the background is painted in as the discs move), but clipping is not the problem. If I change the example so that it erases the canvas every frame, I still get the same results: jerky animation in Firefox, rock solid in webkit browsers.\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Open the web page in the provided url\n2. Click the animate button\n3.\nActual Results:  \nJerky animation\n\nExpected Results:  \nSmooth animation\n\nI have noticed other problems when I use themes, such as images not being painted in a canvas, but this problem -- jerky animation -- is unrelated to themes. The animation is jerky whether I have a theme installed or not.\n\nThe example that I provided does not use mozRequestAnimationFrame(), because in Firefox 4 that method restricts the number of fps to an unrealistic number that makes the animation even worse.\n\nI have filed this under Severity: Major, because I feel this is a show-stopper for animations in Firefox."}, {"tags": [], "creation_time": "2011-04-01T15:46:28Z", "bug_id": 647238, "raw_text": "It's really smooth for me on my Mac (10.6) with the odd gc pause.", "is_private": false, "id": 5386361, "time": "2011-04-01T15:46:28Z", "creator": "david.humphrey@senecacollege.ca", "attachment_id": null, "count": 1, "text": "It's really smooth for me on my Mac (10.6) with the odd gc pause.", "author": "david.humphrey@senecacollege.ca"}, {"count": 2, "text": "(In reply to comment #1)\n> It's really smooth for me on my Mac (10.6) with the odd gc pause.\n\nMe too, as long as I'm using Chrome. \n\nI see a *huge* difference between Chrome 10 and FF4. With Firefox, the discs lurch forward about 15 times for each horizontal traversal of the screen. On Chrome and Safari, I see a hitch at about 0.5 seconds (which I understand is a known characteristic of Chrome), but other than that, it's smooth all the way.\n\nLooks like we're running the same OS. I'm on Mac OS X 10.6.4, 2.53 GHz Intel Core 2 Duo, with 4GB of RAM.", "author": "sabreware@gmail.com", "creator": "sabreware@gmail.com", "attachment_id": null, "time": "2011-04-01T16:26:38Z", "id": 5386440, "raw_text": "(In reply to comment #1)\n> It's really smooth for me on my Mac (10.6) with the odd gc pause.\n\nMe too, as long as I'm using Chrome. \n\nI see a *huge* difference between Chrome 10 and FF4. With Firefox, the discs lurch forward about 15 times for each horizontal traversal of the screen. On Chrome and Safari, I see a hitch at about 0.5 seconds (which I understand is a known characteristic of Chrome), but other than that, it's smooth all the way.\n\nLooks like we're running the same OS. I'm on Mac OS X 10.6.4, 2.53 GHz Intel Core 2 Duo, with 4GB of RAM.", "bug_id": 647238, "creation_time": "2011-04-01T16:26:38Z", "tags": [], "is_private": false}, {"text": "It's completely smooth for me to on 10.6, thogugh with a slightly better processor.\n\nIS this a clean profile?  Or do you have extensions installed?", "count": 3, "author": "bzbarsky@mit.edu", "time": "2011-04-01T17:12:25Z", "id": 5386536, "raw_text": "It's completely smooth for me to on 10.6, thogugh with a slightly better processor.\n\nIS this a clean profile?  Or do you have extensions installed?", "bug_id": 647238, "creation_time": "2011-04-01T17:12:25Z", "creator": "bzbarsky@mit.edu", "tags": [], "is_private": false, "attachment_id": null}, {"author": "bzbarsky@mit.edu", "count": 4, "text": "Also, at least over here the animation is using less than 20% of the CPU.  So even with the limitation that mozRequestAnimationFrame has in Fx4 you would be getting 50+ fps on my hardware.  I'm not sure where you got the \"unrealistic number\" thing.", "attachment_id": null, "creator": "bzbarsky@mit.edu", "id": 5386553, "time": "2011-04-01T17:16:22Z", "is_private": false, "tags": [], "raw_text": "Also, at least over here the animation is using less than 20% of the CPU.  So even with the limitation that mozRequestAnimationFrame has in Fx4 you would be getting 50+ fps on my hardware.  I'm not sure where you got the \"unrealistic number\" thing.", "creation_time": "2011-04-01T17:16:22Z", "bug_id": 647238}, {"tags": [], "creation_time": "2011-04-01T17:45:23Z", "bug_id": 647238, "raw_text": "Could this be a dupe of bug 640170 ?", "is_private": false, "id": 5386649, "time": "2011-04-01T17:45:23Z", "creator": "jacob.benoit.1@gmail.com", "attachment_id": null, "count": 5, "text": "Could this be a dupe of bug 640170 ?", "author": "jacob.benoit.1@gmail.com"}, {"id": 5386668, "author": "bzbarsky@mit.edu", "time": "2011-04-01T17:52:13Z", "text": "Benoit, hard to tell...\n\nDavid, I do see a few pauses (2-3) on the very first pass of the balls across the field, when they're between 1/2 and 3/4 of the way across.  No pauses after they bounce off the right-hand wall the first time.\n\nAre you seeing pauses throughout, or just near the beginning there?", "count": 6, "is_private": false, "attachment_id": null, "creator": "bzbarsky@mit.edu", "tags": [], "raw_text": "Benoit, hard to tell...\n\nDavid, I do see a few pauses (2-3) on the very first pass of the balls across the field, when they're between 1/2 and 3/4 of the way across.  No pauses after they bounce off the right-hand wall the first time.\n\nAre you seeing pauses throughout, or just near the beginning there?", "creation_time": "2011-04-01T17:52:13Z", "bug_id": 647238}, {"text": "(In reply to comment #6)\n> Benoit, hard to tell...\n> \n> David, I do see a few pauses (2-3) on the very first pass of the balls across\n> the field, when they're between 1/2 and 3/4 of the way across.  No pauses after\n> they bounce off the right-hand wall the first time.\n> \n> Are you seeing pauses throughout, or just near the beginning there?\n\nI'm seeing pauses throughout. Sometimes it's so bad that the discs are momentarily sheared apart. Huge pauses, too, maybe up to 1/2 second sometimes.", "count": 7, "author": "sabreware@gmail.com", "time": "2011-04-01T18:25:01Z", "id": 5386792, "raw_text": "(In reply to comment #6)\n> Benoit, hard to tell...\n> \n> David, I do see a few pauses (2-3) on the very first pass of the balls across\n> the field, when they're between 1/2 and 3/4 of the way across.  No pauses after\n> they bounce off the right-hand wall the first time.\n> \n> Are you seeing pauses throughout, or just near the beginning there?\n\nI'm seeing pauses throughout. Sometimes it's so bad that the discs are momentarily sheared apart. Huge pauses, too, maybe up to 1/2 second sometimes.", "creation_time": "2011-04-01T18:25:01Z", "bug_id": 647238, "creator": "sabreware@gmail.com", "tags": [], "is_private": false, "attachment_id": null}, {"attachment_id": null, "is_private": false, "raw_text": "(In reply to comment #4)\n> Also, at least over here the animation is using less than 20% of the CPU. \n\nWithout the animation running, Firefox takes up about 5% of the CPU. With the animation running, it's about 54% on my machine.\n\n> So\n> even with the limitation that mozRequestAnimationFrame has in Fx4 you would be\n> getting 50+ fps on my hardware.  I'm not sure where you got the \"unrealistic\n> number\" thing.\n\nI typically get about 30-40fps when I use mozRequestAnimationFrame. Since most monitors refresh at 60Hz or above, it seems to me that half that rate is unrealistic for animations.", "bug_id": 647238, "creation_time": "2011-04-01T18:30:10Z", "creator": "sabreware@gmail.com", "tags": [], "author": "sabreware@gmail.com", "time": "2011-04-01T18:30:10Z", "id": 5386810, "text": "(In reply to comment #4)\n> Also, at least over here the animation is using less than 20% of the CPU. \n\nWithout the animation running, Firefox takes up about 5% of the CPU. With the animation running, it's about 54% on my machine.\n\n> So\n> even with the limitation that mozRequestAnimationFrame has in Fx4 you would be\n> getting 50+ fps on my hardware.  I'm not sure where you got the \"unrealistic\n> number\" thing.\n\nI typically get about 30-40fps when I use mozRequestAnimationFrame. Since most monitors refresh at 60Hz or above, it seems to me that half that rate is unrealistic for animations.", "count": 8}, {"text": "(In reply to comment #3)\n> It's completely smooth for me to on 10.6, thogugh with a slightly better\n> processor.\n> \n> IS this a clean profile?  Or do you have extensions installed?\n\nIt's pretty clean. I only have YSlow and Firebug installed.", "count": 9, "author": "sabreware@gmail.com", "time": "2011-04-01T18:31:44Z", "id": 5386815, "raw_text": "(In reply to comment #3)\n> It's completely smooth for me to on 10.6, thogugh with a slightly better\n> processor.\n> \n> IS this a clean profile?  Or do you have extensions installed?\n\nIt's pretty clean. I only have YSlow and Firebug installed.", "bug_id": 647238, "creation_time": "2011-04-01T18:31:44Z", "creator": "sabreware@gmail.com", "tags": [], "attachment_id": null, "is_private": false}, {"count": 10, "text": "Can you try with a clean profile?  I have neither in mine, and I'm not getting anything like this (I'm seeing what Boris is describing).", "id": 5386860, "author": "david.humphrey@senecacollege.ca", "time": "2011-04-01T18:44:01Z", "creator": "david.humphrey@senecacollege.ca", "tags": [], "raw_text": "Can you try with a clean profile?  I have neither in mine, and I'm not getting anything like this (I'm seeing what Boris is describing).", "bug_id": 647238, "creation_time": "2011-04-01T18:44:01Z", "is_private": false, "attachment_id": null}, {"count": 11, "text": "> It's pretty clean. I only have YSlow and Firebug installed.\n\nIs Firebug active while your animation is running perchance?  Note that it can be active without being open.", "time": "2011-04-01T18:50:03Z", "author": "bzbarsky@mit.edu", "id": 5386891, "bug_id": 647238, "creation_time": "2011-04-01T18:50:03Z", "raw_text": "> It's pretty clean. I only have YSlow and Firebug installed.\n\nIs Firebug active while your animation is running perchance?  Note that it can be active without being open.", "tags": [], "creator": "bzbarsky@mit.edu", "is_private": false, "attachment_id": null}, {"text": "(In reply to comment #10)\n> Can you try with a clean profile?  I have neither in mine, and I'm not getting\n> anything like this (I'm seeing what Boris is describing).\n\nI removed FF entirely, downloaded a new copy, and I still get the same results.", "count": 12, "id": 5387079, "author": "sabreware@gmail.com", "time": "2011-04-01T19:50:24Z", "creator": "sabreware@gmail.com", "tags": [], "raw_text": "(In reply to comment #10)\n> Can you try with a clean profile?  I have neither in mine, and I'm not getting\n> anything like this (I'm seeing what Boris is describing).\n\nI removed FF entirely, downloaded a new copy, and I still get the same results.", "bug_id": 647238, "creation_time": "2011-04-01T19:50:24Z", "is_private": false, "attachment_id": null}, {"id": 5387090, "time": "2011-04-01T19:54:21Z", "tags": [], "bug_id": 647238, "creation_time": "2011-04-01T19:54:21Z", "raw_text": "David, sorry that this wasn't clear.  I'm hoping you can run with a clean profile (e.g., one that doesn't have Firebug etc installed):\n\n/Applications/Firefox.app/Contents/MacOS/firefox -profilemanager\n\nThen make a new profile.  See if that makes a difference.  It might not, but it would be good to rule out Firebug, which has been known to cause issues.", "is_private": false, "count": 13, "text": "David, sorry that this wasn't clear.  I'm hoping you can run with a clean profile (e.g., one that doesn't have Firebug etc installed):\n\n/Applications/Firefox.app/Contents/MacOS/firefox -profilemanager\n\nThen make a new profile.  See if that makes a difference.  It might not, but it would be good to rule out Firebug, which has been known to cause issues.", "author": "david.humphrey@senecacollege.ca", "creator": "david.humphrey@senecacollege.ca", "attachment_id": null}, {"time": "2011-04-01T20:14:13Z", "id": 5387134, "bug_id": 647238, "creation_time": "2011-04-01T20:14:13Z", "raw_text": "(In reply to comment #13)\n> David, sorry that this wasn't clear.  I'm hoping you can run with a clean\n> profile (e.g., one that doesn't have Firebug etc installed):\n> \n> /Applications/Firefox.app/Contents/MacOS/firefox -profilemanager\n> \n> Then make a new profile.  See if that makes a difference.  It might not, but it\n> would be good to rule out Firebug, which has been known to cause issues.\n\nOkay, I did that, but no dice. The animation is still choppy.", "tags": [], "is_private": false, "count": 14, "text": "(In reply to comment #13)\n> David, sorry that this wasn't clear.  I'm hoping you can run with a clean\n> profile (e.g., one that doesn't have Firebug etc installed):\n> \n> /Applications/Firefox.app/Contents/MacOS/firefox -profilemanager\n> \n> Then make a new profile.  See if that makes a difference.  It might not, but it\n> would be good to rule out Firebug, which has been known to cause issues.\n\nOkay, I did that, but no dice. The animation is still choppy.", "author": "sabreware@gmail.com", "creator": "sabreware@gmail.com", "attachment_id": null}, {"id": 5387939, "time": "2011-04-02T02:49:03Z", "is_private": false, "tags": [], "creation_time": "2011-04-02T02:49:03Z", "bug_id": 647238, "raw_text": "OK.  Can you open about:config, type \"mem.log\" into the filter field, then double-click the \"javascript.options.mem.log\"?\n\nThen open the error console (Cmd-Shift-J on Mac, Ctrl-Shift-J on Windows, I think), clear it, and select the \"Messages\" tab.  Now start the animation, and watch the error console.\n\nTwo questions:\n1)  Are pauses in the animation correlated with the appearance of \"CC timestamp\"\n    or \"GC mode\" lines in the console?\n2)  If they are, what do some of the lines involved look like?  You should be\n    able to just select an item in the console, copy, and then paste into this\n    bug report.", "author": "bzbarsky@mit.edu", "text": "OK.  Can you open about:config, type \"mem.log\" into the filter field, then double-click the \"javascript.options.mem.log\"?\n\nThen open the error console (Cmd-Shift-J on Mac, Ctrl-Shift-J on Windows, I think), clear it, and select the \"Messages\" tab.  Now start the animation, and watch the error console.\n\nTwo questions:\n1)  Are pauses in the animation correlated with the appearance of \"CC timestamp\"\n    or \"GC mode\" lines in the console?\n2)  If they are, what do some of the lines involved look like?  You should be\n    able to just select an item in the console, copy, and then paste into this\n    bug report.", "count": 15, "attachment_id": null, "creator": "bzbarsky@mit.edu"}, {"bug_id": 647238, "creation_time": "2011-04-02T13:19:31Z", "raw_text": "I let it run for about 20 minutes with the error console open. I got four\nmessages:\n\nGC mode: full, timestamp: 1301748802901845, duration: 80 ms.\nCC timestamp: 1301748803889104, collected: 164 (164 waiting for GC), suspected:\n4892, duration: 40 ms.\nCC timestamp: 1301748812394823, collected: 0 (164 waiting for GC), suspected:\n4739, duration: 38 ms.\nCC timestamp: 1301750055028823, collected: 0 (164 waiting for GC), suspected:\n1447, duration: 65 ms.\n\nThat's it. All the messages came within the first few seconds of the start of\nthe animation, and for the rest of the time there was nothing. The animation is\nalways jumpy, so I don't think there's any connection to GC.", "tags": [], "is_private": false, "time": "2011-04-02T13:19:31Z", "id": 5388268, "creator": "sabreware@gmail.com", "attachment_id": null, "count": 16, "text": "I let it run for about 20 minutes with the error console open. I got four\nmessages:\n\nGC mode: full, timestamp: 1301748802901845, duration: 80 ms.\nCC timestamp: 1301748803889104, collected: 164 (164 waiting for GC), suspected:\n4892, duration: 40 ms.\nCC timestamp: 1301748812394823, collected: 0 (164 waiting for GC), suspected:\n4739, duration: 38 ms.\nCC timestamp: 1301750055028823, collected: 0 (164 waiting for GC), suspected:\n1447, duration: 65 ms.\n\nThat's it. All the messages came within the first few seconds of the start of\nthe animation, and for the rest of the time there was nothing. The animation is\nalways jumpy, so I don't think there's any connection to GC.", "author": "sabreware@gmail.com"}, {"attachment_id": null, "is_private": false, "tags": [], "creator": "bzbarsky@mit.edu", "creation_time": "2011-04-02T18:45:36Z", "bug_id": 647238, "raw_text": "> All the messages came within the first few seconds of the start of\n> the animation\n\nOK, that's what I see too, and in my cases those few GCs were the reason for the pauses I was observing (I was testing in a session with ~300 tabs open, so the GCs take some time).\n\nI agree that the problem you're seeing is not GC.\n\nJust to check, does disabling hardware acceleration (needs a browser restart) change anything for you?\n\nIf not, are you willing to try profiling this on your end?  I assume that you're seeing the problem on OS X 10.6 per comment 0?  I can give you directions to create a profile that I could then look at.", "id": 5388517, "time": "2011-04-02T18:45:36Z", "author": "bzbarsky@mit.edu", "count": 17, "text": "> All the messages came within the first few seconds of the start of\n> the animation\n\nOK, that's what I see too, and in my cases those few GCs were the reason for the pauses I was observing (I was testing in a session with ~300 tabs open, so the GCs take some time).\n\nI agree that the problem you're seeing is not GC.\n\nJust to check, does disabling hardware acceleration (needs a browser restart) change anything for you?\n\nIf not, are you willing to try profiling this on your end?  I assume that you're seeing the problem on OS X 10.6 per comment 0?  I can give you directions to create a profile that I could then look at."}, {"tags": [], "raw_text": "Disabling hardware acceleration did not make it any better. It may have made it worse, in fact.\n\nSure, I can create a profile. Let me know what to do.\n\n\ndavid\n\n> > All the messages came within the first few seconds of the start of\n> > the animation\n> \n> OK, that's what I see too, and in my cases those few GCs were the reason for\n> the pauses I was observing (I was testing in a session with ~300 tabs open, so\n> the GCs take some time).\n> \n> I agree that the problem you're seeing is not GC.\n> \n> Just to check, does disabling hardware acceleration (needs a browser restart)\n> change anything for you?\n> \n> If not, are you willing to try profiling this on your end?  I assume that\n> you're seeing the problem on OS X 10.6 per comment 0?  I can give you\n> directions to create a profile that I could then look at.", "creation_time": "2011-04-04T14:49:23Z", "bug_id": 647238, "is_private": false, "id": 5390140, "time": "2011-04-04T14:49:23Z", "creator": "sabreware@gmail.com", "attachment_id": null, "text": "Disabling hardware acceleration did not make it any better. It may have made it worse, in fact.\n\nSure, I can create a profile. Let me know what to do.\n\n\ndavid\n\n> > All the messages came within the first few seconds of the start of\n> > the animation\n> \n> OK, that's what I see too, and in my cases those few GCs were the reason for\n> the pauses I was observing (I was testing in a session with ~300 tabs open, so\n> the GCs take some time).\n> \n> I agree that the problem you're seeing is not GC.\n> \n> Just to check, does disabling hardware acceleration (needs a browser restart)\n> change anything for you?\n> \n> If not, are you willing to try profiling this on your end?  I assume that\n> you're seeing the problem on OS X 10.6 per comment 0?  I can give you\n> directions to create a profile that I could then look at.", "count": 18, "author": "sabreware@gmail.com"}, {"raw_text": "Thanks for checking on the hardware acceleration bit.  It was a long shot, but needed checking.\n\n> Let me know what to do.\n\nOK.  You will need to install XCode (which should install Shark).\n\nThen\n\n1) Download one of our profiling-enabled builds from http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/latest-trunk/firefox-4.2a1pre.en-US.mac-shark.dmg\n\n2) Start the build in question and load the animation page in it.  Make sure you're seeing the stutter.\n\n3) Open Shark.  Make sure that \"Time profile\" is selected in the dropwdown next to the \"Start\" button in Shark, that \"Process\" is selected in the dropwdown to the right of the \"Time Profile\" one, and that your firefox-bin with the little bomb icon is selected in the last dropdown.  \n\n4) In Shark, select the \"Show Mini Config Editor\" option from the Config menu.\n\n5) Change the sample interval to 20us.\n\n6) Check the \"WTF Mode\" checkbox, and set the \"Sample-history\" text field to\n   5000 * (number of seconds the stutter lasts).  Probably just 50000 is good\n   enough.\n\n7) Click the \"Start\" button.\n\n8) Wait until you see the stutter finish and then click the Stop button.\n\n\"WTF mode\" means that you keep the last however many samples, so if the stutter is 1 second long and you keep 50000 samples and stop the profiler when the stutter ends you will have exactly the information you need.\n\nNow Shark will think for a while and then pop up a new window with the profile.  Go to File > Save, pick a file name, and if/when it asks about source files (which you don't have anywy) tell it to strip them from the profile.\n\nYou'll probably need to e-mail the result to me, since I suspect it will be too big to attach to the bug.  If you run into any trouble, please mail me and we can get it sorted out!", "bug_id": 647238, "creation_time": "2011-04-04T22:39:25Z", "creator": "bzbarsky@mit.edu", "tags": [], "is_private": false, "attachment_id": null, "text": "Thanks for checking on the hardware acceleration bit.  It was a long shot, but needed checking.\n\n> Let me know what to do.\n\nOK.  You will need to install XCode (which should install Shark).\n\nThen\n\n1) Download one of our profiling-enabled builds from http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/latest-trunk/firefox-4.2a1pre.en-US.mac-shark.dmg\n\n2) Start the build in question and load the animation page in it.  Make sure you're seeing the stutter.\n\n3) Open Shark.  Make sure that \"Time profile\" is selected in the dropwdown next to the \"Start\" button in Shark, that \"Process\" is selected in the dropwdown to the right of the \"Time Profile\" one, and that your firefox-bin with the little bomb icon is selected in the last dropdown.  \n\n4) In Shark, select the \"Show Mini Config Editor\" option from the Config menu.\n\n5) Change the sample interval to 20us.\n\n6) Check the \"WTF Mode\" checkbox, and set the \"Sample-history\" text field to\n   5000 * (number of seconds the stutter lasts).  Probably just 50000 is good\n   enough.\n\n7) Click the \"Start\" button.\n\n8) Wait until you see the stutter finish and then click the Stop button.\n\n\"WTF mode\" means that you keep the last however many samples, so if the stutter is 1 second long and you keep 50000 samples and stop the profiler when the stutter ends you will have exactly the information you need.\n\nNow Shark will think for a while and then pop up a new window with the profile.  Go to File > Save, pick a file name, and if/when it asks about source files (which you don't have anywy) tell it to strip them from the profile.\n\nYou'll probably need to e-mail the result to me, since I suspect it will be too big to attach to the bug.  If you run into any trouble, please mail me and we can get it sorted out!", "count": 19, "author": "bzbarsky@mit.edu", "time": "2011-04-04T22:39:25Z", "id": 5390567}, {"time": "2011-04-06T21:22:31Z", "id": 5393212, "is_private": false, "creation_time": "2011-04-06T21:22:31Z", "bug_id": 647238, "raw_text": "Thanks for the detailed, and accurate instructions. I just emailed you the shark session. The discs jumped about 10 times during the session.\n\n(In reply to comment #19)\n> Thanks for checking on the hardware acceleration bit.  It was a long shot, but\n> needed checking.\n> \n> > Let me know what to do.\n> \n> OK.  You will need to install XCode (which should install Shark).\n> \n> Then\n> \n> 1) Download one of our profiling-enabled builds from\n> http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/latest-trunk/firefox-4.2a1pre.en-US.mac-shark.dmg\n> \n> 2) Start the build in question and load the animation page in it.  Make sure\n> you're seeing the stutter.\n> \n> 3) Open Shark.  Make sure that \"Time profile\" is selected in the dropwdown next\n> to the \"Start\" button in Shark, that \"Process\" is selected in the dropwdown to\n> the right of the \"Time Profile\" one, and that your firefox-bin with the little\n> bomb icon is selected in the last dropdown.  \n> \n> 4) In Shark, select the \"Show Mini Config Editor\" option from the Config menu.\n> \n> 5) Change the sample interval to 20us.\n> \n> 6) Check the \"WTF Mode\" checkbox, and set the \"Sample-history\" text field to\n>    5000 * (number of seconds the stutter lasts).  Probably just 50000 is good\n>    enough.\n> \n> 7) Click the \"Start\" button.\n> \n> 8) Wait until you see the stutter finish and then click the Stop button.\n> \n> \"WTF mode\" means that you keep the last however many samples, so if the stutter\n> is 1 second long and you keep 50000 samples and stop the profiler when the\n> stutter ends you will have exactly the information you need.\n> \n> Now Shark will think for a while and then pop up a new window with the profile.\n>  Go to File > Save, pick a file name, and if/when it asks about source files\n> (which you don't have anywy) tell it to strip them from the profile.\n> \n> You'll probably need to e-mail the result to me, since I suspect it will be too\n> big to attach to the bug.  If you run into any trouble, please mail me and we\n> can get it sorted out!", "tags": [], "author": "sabreware@gmail.com", "text": "Thanks for the detailed, and accurate instructions. I just emailed you the shark session. The discs jumped about 10 times during the session.\n\n(In reply to comment #19)\n> Thanks for checking on the hardware acceleration bit.  It was a long shot, but\n> needed checking.\n> \n> > Let me know what to do.\n> \n> OK.  You will need to install XCode (which should install Shark).\n> \n> Then\n> \n> 1) Download one of our profiling-enabled builds from\n> http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/latest-trunk/firefox-4.2a1pre.en-US.mac-shark.dmg\n> \n> 2) Start the build in question and load the animation page in it.  Make sure\n> you're seeing the stutter.\n> \n> 3) Open Shark.  Make sure that \"Time profile\" is selected in the dropwdown next\n> to the \"Start\" button in Shark, that \"Process\" is selected in the dropwdown to\n> the right of the \"Time Profile\" one, and that your firefox-bin with the little\n> bomb icon is selected in the last dropdown.  \n> \n> 4) In Shark, select the \"Show Mini Config Editor\" option from the Config menu.\n> \n> 5) Change the sample interval to 20us.\n> \n> 6) Check the \"WTF Mode\" checkbox, and set the \"Sample-history\" text field to\n>    5000 * (number of seconds the stutter lasts).  Probably just 50000 is good\n>    enough.\n> \n> 7) Click the \"Start\" button.\n> \n> 8) Wait until you see the stutter finish and then click the Stop button.\n> \n> \"WTF mode\" means that you keep the last however many samples, so if the stutter\n> is 1 second long and you keep 50000 samples and stop the profiler when the\n> stutter ends you will have exactly the information you need.\n> \n> Now Shark will think for a while and then pop up a new window with the profile.\n>  Go to File > Save, pick a file name, and if/when it asks about source files\n> (which you don't have anywy) tell it to strip them from the profile.\n> \n> You'll probably need to e-mail the result to me, since I suspect it will be too\n> big to attach to the bug.  If you run into any trouble, please mail me and we\n> can get it sorted out!", "count": 20, "attachment_id": null, "creator": "sabreware@gmail.com"}, {"text": "OK, the profile breakdown is sort of like this:\n\n48% painting (half of this in CoreGraphics' sseCGSBlendXXXX8888)\n 8% fill() on the canvas\n 7% clearRect() on the canvas\n22% stroke() on the canvas\n 3% getting the canvas from the 2d context\n \nand a bit of moveTo, lineTo, beginPath, etc, etc.\n\nThe strokes actually come in two flavors.  About 7% of the stroking is mostly CGContextDrawPath-bound.  The rest seems to spend not that much time on the actual path but lots of time on cairo state setup (esp. setting up the color)... \n\nJeff, any idea what's up here?", "count": 21, "author": "bzbarsky@mit.edu", "creator": "bzbarsky@mit.edu", "attachment_id": null, "id": 5393929, "time": "2011-04-07T05:13:45Z", "tags": [], "bug_id": 647238, "creation_time": "2011-04-07T05:13:45Z", "raw_text": "OK, the profile breakdown is sort of like this:\n\n48% painting (half of this in CoreGraphics' sseCGSBlendXXXX8888)\n 8% fill() on the canvas\n 7% clearRect() on the canvas\n22% stroke() on the canvas\n 3% getting the canvas from the 2d context\n \nand a bit of moveTo, lineTo, beginPath, etc, etc.\n\nThe strokes actually come in two flavors.  About 7% of the stroking is mostly CGContextDrawPath-bound.  The rest seems to spend not that much time on the actual path but lots of time on cairo state setup (esp. setting up the color)... \n\nJeff, any idea what's up here?", "is_private": false}, {"raw_text": "That profile is one I've seen before.  Perhaps this is bug 540066?", "bug_id": 647238, "creation_time": "2011-04-07T11:28:12Z", "tags": [], "is_private": false, "time": "2011-04-07T11:28:12Z", "id": 5394202, "creator": "david.humphrey@senecacollege.ca", "attachment_id": null, "count": 22, "text": "That profile is one I've seen before.  Perhaps this is bug 540066?", "author": "david.humphrey@senecacollege.ca"}, {"attachment_id": null, "creator": "sabreware@gmail.com", "author": "sabreware@gmail.com", "count": 23, "text": "Perhaps, so I changed the example so that it only\ndoes two things during the animation: context.clearRect() and\ncontext.drawImage(). I still get choppy animation. You can try it at\nhttp://corehtml5canvas.com/bugreports/firefox4/animation/images/example.html.\n\nWith Minefield, something is awry: the images leave considerable residue on the\ncanvas as they animate. I don't see that problem with FF4.\n\nI will send Boris a profile of the new example.", "is_private": false, "raw_text": "Perhaps, so I changed the example so that it only\ndoes two things during the animation: context.clearRect() and\ncontext.drawImage(). I still get choppy animation. You can try it at\nhttp://corehtml5canvas.com/bugreports/firefox4/animation/images/example.html.\n\nWith Minefield, something is awry: the images leave considerable residue on the\ncanvas as they animate. I don't see that problem with FF4.\n\nI will send Boris a profile of the new example.", "creation_time": "2011-04-07T15:19:11Z", "bug_id": 647238, "tags": [], "time": "2011-04-07T15:19:11Z", "id": 5394430}, {"attachment_id": null, "creator": "jmuizelaar@mozilla.com", "author": "jmuizelaar@mozilla.com", "text": "(In reply to comment #21)\n> OK, the profile breakdown is sort of like this:\n> \n> 48% painting (half of this in CoreGraphics' sseCGSBlendXXXX8888)\n>  8% fill() on the canvas\n>  7% clearRect() on the canvas\n> 22% stroke() on the canvas\n>  3% getting the canvas from the 2d context\n> \n> and a bit of moveTo, lineTo, beginPath, etc, etc.\n> \n> The strokes actually come in two flavors.  About 7% of the stroking is mostly\n> CGContextDrawPath-bound.  The rest seems to spend not that much time on the\n> actual path but lots of time on cairo state setup (esp. setting up the\n> color)... \n> \n> Jeff, any idea what's up here?\n\nI can't reproduce this either and don't really have any guesses either.", "count": 24, "is_private": false, "raw_text": "(In reply to comment #21)\n> OK, the profile breakdown is sort of like this:\n> \n> 48% painting (half of this in CoreGraphics' sseCGSBlendXXXX8888)\n>  8% fill() on the canvas\n>  7% clearRect() on the canvas\n> 22% stroke() on the canvas\n>  3% getting the canvas from the 2d context\n> \n> and a bit of moveTo, lineTo, beginPath, etc, etc.\n> \n> The strokes actually come in two flavors.  About 7% of the stroking is mostly\n> CGContextDrawPath-bound.  The rest seems to spend not that much time on the\n> actual path but lots of time on cairo state setup (esp. setting up the\n> color)... \n> \n> Jeff, any idea what's up here?\n\nI can't reproduce this either and don't really have any guesses either.", "bug_id": 647238, "creation_time": "2011-04-07T16:37:01Z", "tags": [], "time": "2011-04-07T16:37:01Z", "id": 5394565}, {"id": 5838777, "time": "2011-11-09T23:56:26Z", "is_private": false, "tags": [], "bug_id": 647238, "creation_time": "2011-11-09T23:56:26Z", "raw_text": "I'm having jerkier animation with mozRequestAnimationFrame than without it (Even with the fps internally limited to 60 fps, mozRequestAnimationFrame wants to do less). Should it be a separate bug or not? The webkitRequestAnimationFrame animation is smoother than without it, the opposite of which is happening with the moz version.", "author": "grantgalitz@gmail.com", "text": "I'm having jerkier animation with mozRequestAnimationFrame than without it (Even with the fps internally limited to 60 fps, mozRequestAnimationFrame wants to do less). Should it be a separate bug or not? The webkitRequestAnimationFrame animation is smoother than without it, the opposite of which is happening with the moz version.", "count": 25, "attachment_id": null, "creator": "grantgalitz@gmail.com"}, {"time": "2011-11-09T23:57:12Z", "author": "grantgalitz@gmail.com", "id": 5838779, "count": 26, "text": "Also, I'm getting lots of frame tearing on mozRequestAnimationFrame at a low fps with jerky animation.", "attachment_id": null, "is_private": false, "bug_id": 647238, "creation_time": "2011-11-09T23:57:12Z", "raw_text": "Also, I'm getting lots of frame tearing on mozRequestAnimationFrame at a low fps with jerky animation.", "tags": [], "creator": "grantgalitz@gmail.com"}, {"time": "2012-03-06T09:58:11Z", "id": 6117063, "raw_text": "I'm seeing a very stable stuttering approx. 3 times/sec. only using 3-5% cpu ..  it's not specific to this test obviously.\n\nIt seems less frequent here:\nhttp://ie.microsoft.com/testdrive/Performance/ParticleAcceleration/\n\nBut still very stable at approx. 2 times/sec. (using 9-12% cpu).\n\nWindows 7 x64 - Aurora - clean profile", "creation_time": "2012-03-06T09:58:11Z", "bug_id": 647238, "tags": [], "is_private": false, "count": 27, "text": "I'm seeing a very stable stuttering approx. 3 times/sec. only using 3-5% cpu ..  it's not specific to this test obviously.\n\nIt seems less frequent here:\nhttp://ie.microsoft.com/testdrive/Performance/ParticleAcceleration/\n\nBut still very stable at approx. 2 times/sec. (using 9-12% cpu).\n\nWindows 7 x64 - Aurora - clean profile", "author": "brunis@gmail.com", "creator": "brunis@gmail.com", "attachment_id": null}, {"text": "ParticleAcceleration is jerky even though it's registering 60FPS on any FF including FF 21. Same deal with Impact's HTML benchmark, Chrome just has super smoothness in both of these. This HTML5 related code needs to be improved.", "count": 28, "author": "Rythestampede@gmail.com", "creator": "Rythestampede@gmail.com", "attachment_id": null, "id": 6850283, "time": "2012-11-26T02:03:48Z", "tags": [], "bug_id": 647238, "creation_time": "2012-11-26T02:03:48Z", "raw_text": "ParticleAcceleration is jerky even though it's registering 60FPS on any FF including FF 21. Same deal with Impact's HTML benchmark, Chrome just has super smoothness in both of these. This HTML5 related code needs to be improved.", "is_private": false}]}}}