{"bugs": {"669045": {"comments": [{"count": 0, "creator": "jruderman@gmail.com", "is_private": false, "time": "2011-07-03T05:40:21Z", "tags": [], "bug_id": 669045, "text": "The patch in bug 369306 was supposed to make pop-unders impossible (turning them into pop-ups), but http://megadownload.net/ somehow has an onclick pop-under.", "author": "jruderman@gmail.com", "creation_time": "2011-07-03T05:40:21Z", "raw_text": "The patch in bug 369306 was supposed to make pop-unders impossible (turning them into pop-ups), but http://megadownload.net/ somehow has an onclick pop-under.", "attachment_id": null, "id": 5571611}, {"text": "It seems like nsGlobalWindow::Focus() is called on the main window and canFocus is set to 0 but despite that, the window is still focused. I tried to return if canFocus is equal to 0 but that doesn't seem to change anything.\n\nSo, now, I wonder how the window could be focused without being a bug in the widget/ code. It would be interesting to check what's happening on Windows actually.", "bug_id": 669045, "tags": [], "time": "2011-07-20T19:14:39Z", "creation_time": "2011-07-20T19:14:39Z", "author": "mounir@lamouri.fr", "count": 1, "is_private": false, "creator": "mounir@lamouri.fr", "id": 5602457, "raw_text": "It seems like nsGlobalWindow::Focus() is called on the main window and canFocus is set to 0 but despite that, the window is still focused. I tried to return if canFocus is equal to 0 but that doesn't seem to change anything.\n\nSo, now, I wonder how the window could be focused without being a bug in the widget/ code. It would be interesting to check what's happening on Windows actually.", "attachment_id": null}, {"attachment_id": 547584, "raw_text": "Took me nearly the entire afternoon but I've finally found what's happening.\nYou can enjoy this self-explanatory testcase too ;)", "id": 5606157, "is_private": false, "creator": "mounir@lamouri.fr", "count": 2, "creation_time": "2011-07-22T01:14:51Z", "author": "mounir@lamouri.fr", "text": "Created attachment 547584\ntestcase\n\nTook me nearly the entire afternoon but I've finally found what's happening.\nYou can enjoy this self-explanatory testcase too ;)", "tags": [], "time": "2011-07-22T01:14:51Z", "bug_id": 669045}, {"author": "mounir@lamouri.fr", "creation_time": "2011-07-22T01:58:01Z", "tags": [], "time": "2011-07-22T01:58:01Z", "text": "Two interesting facts about this test case:\n1. under.open() doesn't create a new tab in the popup window as expected but in the main window. Actually, Chrome has the same behavior, Safari creates a new window (and prevents the popunder) and Opera doesn't even create the second window as requested. Seems like IE8 and 9 does the same thing. Though, I didn't check that myself.\n2. under.open() then alibi.close() creates a popunder but window.open()/alibi.close() or under.opener.open()/alibi.close() doesn't.", "creator": "mounir@lamouri.fr", "is_private": false, "id": 5606220, "attachment_id": null, "raw_text": "Two interesting facts about this test case:\n1. under.open() doesn't create a new tab in the popup window as expected but in the main window. Actually, Chrome has the same behavior, Safari creates a new window (and prevents the popunder) and Opera doesn't even create the second window as requested. Seems like IE8 and 9 does the same thing. Though, I didn't check that myself.\n2. under.open() then alibi.close() creates a popunder but window.open()/alibi.close() or under.opener.open()/alibi.close() doesn't.", "bug_id": 669045, "count": 3}, {"bug_id": 669045, "count": 4, "id": 5606222, "attachment_id": null, "raw_text": "Awesome exploit. Makes perfect sense.", "creation_time": "2011-07-22T02:00:02Z", "author": "jruderman@gmail.com", "text": "Awesome exploit. Makes perfect sense.", "tags": [], "time": "2011-07-22T02:00:02Z", "is_private": false, "creator": "jruderman@gmail.com"}, {"raw_text": "I had a second look at that bug...\n\nEverything comes from here:\nhttp://mxr.mozilla.org/mozilla-central/source/browser/base/content/browser.js#l4917\n\nIf we create a new tab with a parent window being a popup, we look at the last \"main window\" and add the tab to it and focus it explicitly. Weirdly, we don't do that if the new tab is directly added to the main window. That means these two codes are going to have a very different behavior:\nvar w = window.open(/* a popup */);\nw.open(/* new tab */);\nand:r\nvar w = window.open(/* a popup */);\nwindow.open(/* new tab */);\nor even:\nvar w = window.open(/* a popup */);\nw.opener.open(/* new tab */);\n\nOnly the first case is going to focus the new tab and transform the popup to a popunder. According to hg blame, the reason is bug 445845.\n\nI see three solutions:\n1. We change the code of the focus manager to re-focus the previous focused window when the new tab is closed;\n2. We revert the change from bug 448545 and hope we do not break too many legit behavior (note that calling window.close() would refocus the main window);\n3. We do not allow more than one window.open() per event that allows window.open().\n\nSolution 1 is very unlikely and the solution 2 seems risky.\nThe best solution, IMO, is the last one and might fix more annoying behavior (as far as I've tested we can currently open tons of windows from a click handlers).", "attachment_id": null, "id": 5624735, "count": 5, "creator": "mounir@lamouri.fr", "is_private": false, "time": "2011-08-01T06:34:45Z", "tags": [], "bug_id": 669045, "text": "I had a second look at that bug...\n\nEverything comes from here:\nhttp://mxr.mozilla.org/mozilla-central/source/browser/base/content/browser.js#l4917\n\nIf we create a new tab with a parent window being a popup, we look at the last \"main window\" and add the tab to it and focus it explicitly. Weirdly, we don't do that if the new tab is directly added to the main window. That means these two codes are going to have a very different behavior:\nvar w = window.open(/* a popup */);\nw.open(/* new tab */);\nand:r\nvar w = window.open(/* a popup */);\nwindow.open(/* new tab */);\nor even:\nvar w = window.open(/* a popup */);\nw.opener.open(/* new tab */);\n\nOnly the first case is going to focus the new tab and transform the popup to a popunder. According to hg blame, the reason is bug 445845.\n\nI see three solutions:\n1. We change the code of the focus manager to re-focus the previous focused window when the new tab is closed;\n2. We revert the change from bug 448545 and hope we do not break too many legit behavior (note that calling window.close() would refocus the main window);\n3. We do not allow more than one window.open() per event that allows window.open().\n\nSolution 1 is very unlikely and the solution 2 seems risky.\nThe best solution, IMO, is the last one and might fix more annoying behavior (as far as I've tested we can currently open tons of windows from a click handlers).", "author": "mounir@lamouri.fr", "creation_time": "2011-08-01T06:34:45Z"}, {"is_private": false, "creator": "gingerbread_man@live.com", "count": 6, "creation_time": "2011-11-04T03:09:07Z", "author": "gingerbread_man@live.com", "text": "Filesonic and Wupload both have pop-unders that appear when the CAPTCHA is submitted (in both cases the advertiser is mgid.com). The pop-unders appear even though the value of dom.popup_allowed_events is empty and there are no enabled plug-ins (i.e. it's not coming from Flash content).\n\nCould someone kindly have a look at those cases as well? It's very disappointing that the browser allows pop-unders when the user goes through so much trouble to ensure they're blocked.\n\nSample links:\nhttp://www.filesonic.com/file/2671061331/\nhttp://www.wupload.com/file/136440685/", "bug_id": 669045, "tags": [], "time": "2011-11-04T03:09:07Z", "attachment_id": null, "raw_text": "Filesonic and Wupload both have pop-unders that appear when the CAPTCHA is submitted (in both cases the advertiser is mgid.com). The pop-unders appear even though the value of dom.popup_allowed_events is empty and there are no enabled plug-ins (i.e. it's not coming from Flash content).\n\nCould someone kindly have a look at those cases as well? It's very disappointing that the browser allows pop-unders when the user goes through so much trouble to ensure they're blocked.\n\nSample links:\nhttp://www.filesonic.com/file/2671061331/\nhttp://www.wupload.com/file/136440685/", "id": 5825614}, {"creation_time": "2018-06-29T04:49:47Z", "author": "bug-husbandry-bot@mozilla.bugs", "text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1472046\n\nMove all DOM bugs that haven\u2019t been updated in more than 3 years and has no one currently assigned to P5.\n\nIf you have questions, please contact :mdaly.", "tags": [], "time": "2018-06-29T04:49:47Z", "is_private": false, "creator": "bug-husbandry-bot@mozilla.bugs", "id": 13436347, "attachment_id": null, "raw_text": "https://bugzilla.mozilla.org/show_bug.cgi?id=1472046\n\nMove all DOM bugs that haven\u2019t been updated in more than 3 years and has no one currently assigned to P5.\n\nIf you have questions, please contact :mdaly.", "bug_id": 669045, "count": 7}]}}, "comments": {}}