{"bugs": {"1633505": {"comments": [{"raw_text": "This work is being prioritized in order to help users who are trying to fix a problem with Firefox resolve issues. We see that a lot of users uninstall and then re-install Firefox (which does not actually do a refresh). Making it easier to fix corrupt profiles is something we'd like to include within the uninstaller.\n\nThis will cover adding a refresh button to the first screen of the uninstaller, as well as some minor text changes throughout.", "text": "This work is being prioritized in order to help users who are trying to fix a problem with Firefox resolve issues. We see that a lot of users uninstall and then re-install Firefox (which does not actually do a refresh). Making it easier to fix corrupt profiles is something we'd like to include within the uninstaller.\n\nThis will cover adding a refresh button to the first screen of the uninstaller, as well as some minor text changes throughout.", "creation_time": "2020-04-27T18:04:05Z", "time": "2020-04-27T18:04:05Z", "is_private": false, "count": 0, "bug_id": 1633505, "id": 14782207, "creator": "rtublitz@mozilla.com", "attachment_id": null, "author": "rtublitz@mozilla.com", "tags": []}, {"bug_id": 1633505, "id": 14836938, "creator": "agashlin+bz@gmail.com", "attachment_id": 9150952, "author": "agashlin+bz@gmail.com", "tags": [], "raw_text": "\nDetect a profile for the installation, if found offer refresh on welcome page:\n- Replace text\n- Add help link and button\n- Use Uninstall button text on the Next button\n\nAdd a different prompt to close the browser for refresh.\n\nWhen leaving the welcome page:\n- via help link, launch a URL\n- via Refresh button, launch Firefox with the necessary args\n\nAdd utility functions to launch the link and Firefox.\n\nRemove the UN_CONFIRM_CLICK label and cleared UN_CONFIRM_PAGE_TITLE,\nthis was an auxiliary to the design.\n\nMove the check for the install-specific profile to common.nsh from stub.nsi,\nit should be identical, just wrapped in stack ops to save regs.\n\nMove InitHashAppModelId to just after un.UninstallUnOnInitCommon (which sets\n$INSTDIR correctly), so AUMID would be available in un.PreWelcome. I don't\nthink there's anything else that would change $INSTDIR in the uninstaller\nso this should be ok.\n\nUnrelated but adjacent cleanup: Remove inappropriate use of _MOZFUNC_UN\nin CopyPostSigningData.", "creation_time": "2020-05-22T03:13:15Z", "time": "2020-05-22T03:13:15Z", "text": "Created attachment 9150952\nBug 1633505 - Show refresh button within the uninstaller. r?mhowell\n\n\nDetect a profile for the installation, if found offer refresh on welcome page:\n- Replace text\n- Add help link and button\n- Use Uninstall button text on the Next button\n\nAdd a different prompt to close the browser for refresh.\n\nWhen leaving the welcome page:\n- via help link, launch a URL\n- via Refresh button, launch Firefox with the necessary args\n\nAdd utility functions to launch the link and Firefox.\n\nRemove the UN_CONFIRM_CLICK label and cleared UN_CONFIRM_PAGE_TITLE,\nthis was an auxiliary to the design.\n\nMove the check for the install-specific profile to common.nsh from stub.nsi,\nit should be identical, just wrapped in stack ops to save regs.\n\nMove InitHashAppModelId to just after un.UninstallUnOnInitCommon (which sets\n$INSTDIR correctly), so AUMID would be available in un.PreWelcome. I don't\nthink there's anything else that would change $INSTDIR in the uninstaller\nso this should be ok.\n\nUnrelated but adjacent cleanup: Remove inappropriate use of _MOZFUNC_UN\nin CopyPostSigningData.", "is_private": false, "count": 1}, {"raw_text": "From left to right: Screenshots of the new welcome page, a slightly modified confirm page (removed subtitle and click Uninstall to proceed msg), and the welcome page with 3x longer English text as an estimate for localized versions.\n\nI'm still waiting to hear whether we are going to replace the watermark with a white background version.\n\nThe 3X rule of thumb may be a little excessive here, but I'd rather not move the button and link up just a few lines, as I think they look better close to the bottom than hanging out in the middle of the page.", "time": "2020-05-22T03:18:52Z", "creation_time": "2020-05-22T03:18:52Z", "text": "Created attachment 9150954\nuninstall refresh.png\n\nFrom left to right: Screenshots of the new welcome page, a slightly modified confirm page (removed subtitle and click Uninstall to proceed msg), and the welcome page with 3x longer English text as an estimate for localized versions.\n\nI'm still waiting to hear whether we are going to replace the watermark with a white background version.\n\nThe 3X rule of thumb may be a little excessive here, but I'd rather not move the button and link up just a few lines, as I think they look better close to the bottom than hanging out in the middle of the page.", "is_private": false, "count": 2, "bug_id": 1633505, "id": 14836945, "creator": "agashlin+bz@gmail.com", "attachment_id": 9150954, "author": "agashlin+bz@gmail.com", "tags": []}, {"author": "agashlin+bz@gmail.com", "tags": [], "attachment_id": 9151212, "creation_time": "2020-05-23T02:14:30Z", "text": "Created attachment 9151212\nuninstall refresh 2.png\n\nTop row is as before, from left: Welcome page, confirm page, welcome page with 3x simulating localization expansion.\n\nBottom row is simulated RTL, the layout is accurate but the punctuation seems scrambled as en-US isn't truly RTL.", "id": 14838638, "bug_id": 1633505, "creator": "agashlin+bz@gmail.com", "is_private": false, "raw_text": "Top row is as before, from left: Welcome page, confirm page, welcome page with 3x simulating localization expansion.\n\nBottom row is simulated RTL, the layout is accurate but the punctuation seems scrambled as en-US isn't truly RTL.", "time": "2020-05-23T02:14:30Z", "count": 3}, {"bug_id": 1633505, "id": 14844826, "creator": "mwalkington@mozilla.com", "attachment_id": null, "author": "mwalkington@mozilla.com", "tags": [], "raw_text": "Thanks, Adam! This is looking good. \n\nIdeally, the 'Learn more' link would follow closely after the body copy, rather than stack on top of the Refresh button. I assume we had to do it this way because of build or l10n needs?", "time": "2020-05-26T19:23:25Z", "creation_time": "2020-05-26T19:23:25Z", "text": "Thanks, Adam! This is looking good. \n\nIdeally, the 'Learn more' link would follow closely after the body copy, rather than stack on top of the Refresh button. I assume we had to do it this way because of build or l10n needs?", "is_private": false, "count": 4}, {"raw_text": "(In reply to Meridel from comment #4)\n> Ideally, the 'Learn more' link would follow closely after the body copy, rather than stack on top of the Refresh button. I assume we had to do it this way because of build or l10n needs?\n\nIt's both l10n and general uncertainty around text rendering. The link and the body have to be different controls (unless using SysLink, see below, or something even more powerful), so we're responsible for placing and sizing them so they don't overlap or get clipped. It's impractical to determine the size needed for the text precisely enough to use for layout, so generally we give much more space than needed.\n\nIt's possible to use [DrawText](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-drawtextw)'s `DT_CALCRECT` to get the height of text given a font and width, but that's only if using DrawText. There is a complex relationship between this and the size of text in a dialog label. I think this mostly revolves around padding, but I never was able to get to the bottom of it, it can vary in different Windows versions, themes, and resolutions. We used this for sizing with the earlier stub installer, but we really could only use it with a large margin of error, more to ensure that we didn't cut off any locales than to lay things out nicely. The web stub (bug 1596812) was implemented in part to get out of this situation. It would have been very difficult to take over the rendering ourselves to directly use DrawText, especially given the toolkit we're using in the uninstaller (\"[Modern UI](https://nsis.sourceforge.io/Docs/Modern%20UI/Readme.html)\", which uses [InstallOptions](https://nsis.sourceforge.io/Contrib/InstallOptions/Readme.html)).\n\nThere is a [SysLink](https://docs.microsoft.com/en-us/windows/win32/controls/syslink-overview) control that enables using anchor tags to intersperse links with text, but there isn't support for it in InstallOptions. Managing it ourselves, in particular properly dealing with the events, would have been a large task in itself.", "creation_time": "2020-05-26T20:50:42Z", "time": "2020-05-26T20:50:42Z", "text": "(In reply to Meridel from comment #4)\n> Ideally, the 'Learn more' link would follow closely after the body copy, rather than stack on top of the Refresh button. I assume we had to do it this way because of build or l10n needs?\n\nIt's both l10n and general uncertainty around text rendering. The link and the body have to be different controls (unless using SysLink, see below, or something even more powerful), so we're responsible for placing and sizing them so they don't overlap or get clipped. It's impractical to determine the size needed for the text precisely enough to use for layout, so generally we give much more space than needed.\n\nIt's possible to use [DrawText](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-drawtextw)'s `DT_CALCRECT` to get the height of text given a font and width, but that's only if using DrawText. There is a complex relationship between this and the size of text in a dialog label. I think this mostly revolves around padding, but I never was able to get to the bottom of it, it can vary in different Windows versions, themes, and resolutions. We used this for sizing with the earlier stub installer, but we really could only use it with a large margin of error, more to ensure that we didn't cut off any locales than to lay things out nicely. The web stub (bug 1596812) was implemented in part to get out of this situation. It would have been very difficult to take over the rendering ourselves to directly use DrawText, especially given the toolkit we're using in the uninstaller (\"[Modern UI](https://nsis.sourceforge.io/Docs/Modern%20UI/Readme.html)\", which uses [InstallOptions](https://nsis.sourceforge.io/Contrib/InstallOptions/Readme.html)).\n\nThere is a [SysLink](https://docs.microsoft.com/en-us/windows/win32/controls/syslink-overview) control that enables using anchor tags to intersperse links with text, but there isn't support for it in InstallOptions. Managing it ourselves, in particular properly dealing with the events, would have been a large task in itself.", "is_private": false, "count": 5, "bug_id": 1633505, "id": 14845017, "creator": "agashlin+bz@gmail.com", "attachment_id": null, "author": "agashlin+bz@gmail.com", "tags": []}, {"id": 14845226, "bug_id": 1633505, "author": "jsavory@mozilla.com", "tags": [], "creator": "jsavory@mozilla.com", "attachment_id": null, "is_private": false, "raw_text": "This looks great Adam, thanks for getting that title centered! \nI don't see anything else we need to change for this round, looking forward to doing a bigger refresh in the future :)", "text": "This looks great Adam, thanks for getting that title centered! \nI don't see anything else we need to change for this round, looking forward to doing a bigger refresh in the future :)", "creation_time": "2020-05-26T22:30:10Z", "time": "2020-05-26T22:30:10Z", "count": 6}, {"count": 7, "creation_time": "2020-05-26T23:25:18Z", "time": "2020-05-26T23:25:18Z", "text": "Pushed by agashlin@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/c7f88fdf7837\nShow refresh button within the uninstaller. r=mhowell", "raw_text": "Pushed by agashlin@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/c7f88fdf7837\nShow refresh button within the uninstaller. r=mhowell", "is_private": false, "attachment_id": null, "creator": "pulsebot@bots.tld", "tags": [], "author": "pulsebot@bots.tld", "bug_id": 1633505, "id": 14845311}, {"id": 14845558, "bug_id": 1633505, "author": "btara@mozilla.com", "tags": ["bugherder"], "creator": "btara@mozilla.com", "attachment_id": null, "is_private": false, "raw_text": "https://hg.mozilla.org/mozilla-central/rev/c7f88fdf7837", "creation_time": "2020-05-27T03:55:13Z", "text": "https://hg.mozilla.org/mozilla-central/rev/c7f88fdf7837", "time": "2020-05-27T03:55:13Z", "count": 8}, {"attachment_id": null, "tags": [], "author": "agashlin+bz@gmail.com", "creation_time": "2020-05-27T23:08:59Z", "text": "*** Bug 926877 has been marked as a duplicate of this bug. ***", "bug_id": 1633505, "id": 14848290, "creator": "agashlin+bz@gmail.com", "time": "2020-05-27T23:08:59Z", "raw_text": "", "is_private": false, "count": 9}, {"time": "2020-05-28T14:07:35Z", "text": "Do we want to mention this in the 78 release notes?\n\n(see [this doc](https://wiki.mozilla.org/Release_Management/Release_Notes#Nomination_in_Bugzilla) for the nomination process)", "creation_time": "2020-05-28T14:07:35Z", "raw_text": "Do we want to mention this in the 78 release notes?\n\n(see [this doc](https://wiki.mozilla.org/Release_Management/Release_Notes#Nomination_in_Bugzilla) for the nomination process)", "is_private": false, "count": 10, "bug_id": 1633505, "id": 14849400, "attachment_id": null, "creator": "jcristau@mozilla.com", "tags": [], "author": "jcristau@mozilla.com"}, {"count": 11, "is_private": false, "creation_time": "2020-05-28T20:51:57Z", "text": "(In reply to Julien Cristau [:jcristau] from comment #10)\n> Do we want to mention this in the 78 release notes?\n> \n> (see [this doc](https://wiki.mozilla.org/Release_Management/Release_Notes#Nomination_in_Bugzilla) for the nomination process)\n\nYes. This is a change that it would be useful for other users to know about as well in case they are trying to resolve issues and have never heard about refreshing Firefox in order to do so.", "time": "2020-05-28T20:51:57Z", "raw_text": "(In reply to Julien Cristau [:jcristau] from comment #10)\n> Do we want to mention this in the 78 release notes?\n> \n> (see [this doc](https://wiki.mozilla.org/Release_Management/Release_Notes#Nomination_in_Bugzilla) for the nomination process)\n\nYes. This is a change that it would be useful for other users to know about as well in case they are trying to resolve issues and have never heard about refreshing Firefox in order to do so.", "tags": [], "author": "rtublitz@mozilla.com", "attachment_id": null, "creator": "rtublitz@mozilla.com", "id": 14850400, "bug_id": 1633505}, {"creator": "rtublitz@mozilla.com", "attachment_id": null, "author": "rtublitz@mozilla.com", "tags": [], "bug_id": 1633505, "id": 14850530, "count": 12, "raw_text": "Release Note Request (optional, but appreciated)\n[Why is this notable]:\nSee [comment 11](https://bugzilla.mozilla.org/show_bug.cgi?id=1633505#c11)\n[Affects Firefox for Android]:\nNo\n[Suggested wording]:\nI'd suggest that we also link to [https://support.mozilla.org/kb/refresh-firefox-reset-add-ons-and-settings](https://support.mozilla.org/kb/refresh-firefox-reset-add-ons-and-settings) in case users come across this in the release notes and want to learn more about how this works, or how to do it.\n[Links (documentation, blog post, etc)]:\nPRD is linked at the top of this bug", "time": "2020-05-28T21:44:50Z", "creation_time": "2020-05-28T21:44:50Z", "text": "Release Note Request (optional, but appreciated)\n[Why is this notable]:\nSee [comment 11](https://bugzilla.mozilla.org/show_bug.cgi?id=1633505#c11)\n[Affects Firefox for Android]:\nNo\n[Suggested wording]:\nI'd suggest that we also link to [https://support.mozilla.org/kb/refresh-firefox-reset-add-ons-and-settings](https://support.mozilla.org/kb/refresh-firefox-reset-add-ons-and-settings) in case users come across this in the release notes and want to learn more about how this works, or how to do it.\n[Links (documentation, blog post, etc)]:\nPRD is linked at the top of this bug", "is_private": false}, {"count": 13, "raw_text": "Thanks, added \"On Windows, the Firefox uninstaller has a new option to refresh your profile\" to the draft relnotes.", "time": "2020-05-29T10:29:10Z", "is_private": false, "creator": "jcristau@mozilla.com", "bug_id": 1633505, "id": 14851320, "creation_time": "2020-05-29T10:29:10Z", "text": "Thanks, added \"On Windows, the Firefox uninstaller has a new option to refresh your profile\" to the draft relnotes.", "attachment_id": null, "author": "jcristau@mozilla.com", "tags": []}, {"is_private": false, "raw_text": "For testing with longer text before all localizations are complete, here are modified full installers (based on mozilla-beta):\n\n* [en-US](https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/D_iUzWTTTNuPfDodcg1R1w/runs/0/artifacts/public/build/target.installer.exe) ([try task](https://treeherder.mozilla.org/#/jobs?repo=try&revision=91841fd69691e98e64ce4eedff7b3930245cc471&selectedTaskRun=D_iUzWTTTNuPfDodcg1R1w-0))\n* [ar](https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/JqvArQomTBSGPp6w7gpfKg/runs/0/artifacts/public/build/ar/target.installer.exe) ([try task](https://treeherder.mozilla.org/#/jobs?repo=try&revision=91841fd69691e98e64ce4eedff7b3930245cc471&selectedTaskRun=JqvArQomTBSGPp6w7gpfKg-0)) (for checking RTL, the new text is still in English)\n\nHebrew translations are complete, you can see proper RTL in the Hebrew Beta installer.", "creation_time": "2020-06-04T21:08:53Z", "text": "For testing with longer text before all localizations are complete, here are modified full installers (based on mozilla-beta):\n\n* [en-US](https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/D_iUzWTTTNuPfDodcg1R1w/runs/0/artifacts/public/build/target.installer.exe) ([try task](https://treeherder.mozilla.org/#/jobs?repo=try&revision=91841fd69691e98e64ce4eedff7b3930245cc471&selectedTaskRun=D_iUzWTTTNuPfDodcg1R1w-0))\n* [ar](https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/JqvArQomTBSGPp6w7gpfKg/runs/0/artifacts/public/build/ar/target.installer.exe) ([try task](https://treeherder.mozilla.org/#/jobs?repo=try&revision=91841fd69691e98e64ce4eedff7b3930245cc471&selectedTaskRun=JqvArQomTBSGPp6w7gpfKg-0)) (for checking RTL, the new text is still in English)\n\nHebrew translations are complete, you can see proper RTL in the Hebrew Beta installer.", "time": "2020-06-04T21:08:53Z", "count": 14, "id": 14863996, "bug_id": 1633505, "author": "agashlin+bz@gmail.com", "tags": [], "creator": "agashlin+bz@gmail.com", "attachment_id": null}, {"tags": [], "author": "mdroettboom@mozilla.com", "attachment_id": null, "creator": "mdroettboom@mozilla.com", "id": 14876998, "bug_id": 1633505, "count": 15, "is_private": false, "text": "Apologies for the drive by question from the data org here -- I might be retreading ground already discussed elsewhere.  I got here from researching detecting reinstalls wrt retention analysis.\n\nThere are obviously some implications with respect to how this will affect our retention metrics.  Currently, we can track users across reinstalls since their client id remains the same.  Removing the profile would reset their client id and look like churn instead.  At a minimum, it would be good to collect telemetry on profile resets (if we don't already) so that we don't erroneously count it as churn.  (The alternative of connecting client ids across profile resets is probably less desirable since we can't assume the user is resetting only to fix an issue -- they may be trying to reset their profile data).", "creation_time": "2020-06-11T19:45:51Z", "time": "2020-06-11T19:45:51Z", "raw_text": "Apologies for the drive by question from the data org here -- I might be retreading ground already discussed elsewhere.  I got here from researching detecting reinstalls wrt retention analysis.\n\nThere are obviously some implications with respect to how this will affect our retention metrics.  Currently, we can track users across reinstalls since their client id remains the same.  Removing the profile would reset their client id and look like churn instead.  At a minimum, it would be good to collect telemetry on profile resets (if we don't already) so that we don't erroneously count it as churn.  (The alternative of connecting client ids across profile resets is probably less desirable since we can't assume the user is resetting only to fix an issue -- they may be trying to reset their profile data)."}, {"count": 16, "is_private": false, "text": "I believe the client ID and some other telemetry info is preserved through the refresh migration, this is the same mechanism as with an in-browser \"Refresh Firefox\" (though it doesn't offer to restore tabs). The data is migrated [starting here](https://searchfox.org/mozilla-central/rev/0e09b9191c02097034e46b193930f91c45b7885d/browser/components/migration/FirefoxProfileMigrator.jsm#299). It looks like you might get a new \"first-shutdown\" ping after this. The client ID shows up as null in about:telemetry on the run when it was refreshed, but it gets submitted correctly.\n\nThere is a scalar [migration.uninstaller_profile_refresh](https://probes.telemetry.mozilla.org/?view=detail&probeId=scalar/migration.uninstaller_profile_refresh) (bug 1634115) specifically for the uninstaller route, and all refreshes are tracked by histogram [FX_MIGRATION_ENTRY_POINT](https://probes.telemetry.mozilla.org/?view=detail&probeId=histogram%2FFX_MIGRATION_ENTRY_POINT) = 2.", "time": "2020-06-11T20:47:39Z", "creation_time": "2020-06-11T20:47:39Z", "raw_text": "I believe the client ID and some other telemetry info is preserved through the refresh migration, this is the same mechanism as with an in-browser \"Refresh Firefox\" (though it doesn't offer to restore tabs). The data is migrated [starting here](https://searchfox.org/mozilla-central/rev/0e09b9191c02097034e46b193930f91c45b7885d/browser/components/migration/FirefoxProfileMigrator.jsm#299). It looks like you might get a new \"first-shutdown\" ping after this. The client ID shows up as null in about:telemetry on the run when it was refreshed, but it gets submitted correctly.\n\nThere is a scalar [migration.uninstaller_profile_refresh](https://probes.telemetry.mozilla.org/?view=detail&probeId=scalar/migration.uninstaller_profile_refresh) (bug 1634115) specifically for the uninstaller route, and all refreshes are tracked by histogram [FX_MIGRATION_ENTRY_POINT](https://probes.telemetry.mozilla.org/?view=detail&probeId=histogram%2FFX_MIGRATION_ENTRY_POINT) = 2.", "tags": [], "author": "agashlin+bz@gmail.com", "attachment_id": null, "creator": "agashlin+bz@gmail.com", "id": 14877147, "bug_id": 1633505}]}}, "comments": {}}