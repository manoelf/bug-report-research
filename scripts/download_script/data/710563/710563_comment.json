{"bugs": {"710563": {"comments": [{"tags": [], "is_private": false, "count": 0, "id": 5914909, "bug_id": 710563, "creation_time": "2011-12-14T09:16:05Z", "raw_text": "A SLACK timer has the effect of causing animations to drift away from 60fps depending on how long the repaint callback takes.  For example, a callback that takes 16ms will get 30fps, and one that takes 8ms will get 40fps, even though both can drive 60fps animations.  The only way to achieve full 60fps is with a callback that takes 0ms.  (And of course throughout I'm assuming perfect timers.)\n\nWe should try as hard as we can to hit 60fps.  The simplest way of doing that in the current code is to switch to REPEATING_PRECISE_CAN_SKIP wholesale, not just for requestanimationframe callbacks.\n\nIn b2g's home screen, we saw a nice qualitative perf improvement when flipping the pref to always use CAN_SKIP.  However, the home screen uses RAF with webgl and a simple CSS animation, which are supposed to flip on CAN_SKIP already.  So now I'm not so sure what was happening with b2g.  mwu did you get any quantitative data from the pref flip?\n\nHowever, I think we should make this change anyway.", "text": "A SLACK timer has the effect of causing animations to drift away from 60fps depending on how long the repaint callback takes.  For example, a callback that takes 16ms will get 30fps, and one that takes 8ms will get 40fps, even though both can drive 60fps animations.  The only way to achieve full 60fps is with a callback that takes 0ms.  (And of course throughout I'm assuming perfect timers.)\n\nWe should try as hard as we can to hit 60fps.  The simplest way of doing that in the current code is to switch to REPEATING_PRECISE_CAN_SKIP wholesale, not just for requestanimationframe callbacks.\n\nIn b2g's home screen, we saw a nice qualitative perf improvement when flipping the pref to always use CAN_SKIP.  However, the home screen uses RAF with webgl and a simple CSS animation, which are supposed to flip on CAN_SKIP already.  So now I'm not so sure what was happening with b2g.  mwu did you get any quantitative data from the pref flip?\n\nHowever, I think we should make this change anyway.", "attachment_id": null, "time": "2011-12-14T09:16:05Z", "creator": "cjones.bugs@gmail.com", "author": "cjones.bugs@gmail.com"}, {"raw_text": "", "creation_time": "2011-12-14T09:36:40Z", "attachment_id": 581561, "time": "2011-12-14T09:36:40Z", "text": "Created attachment 581561\nUse REPEATING_TIMER_PRECISE_CAN_SKIP instead of SLACK to try to stay closer to 60fps rendering", "id": 5914936, "count": 1, "is_private": false, "tags": [], "bug_id": 710563, "author": "cjones.bugs@gmail.com", "creator": "cjones.bugs@gmail.com"}, {"creator": "mwu.code@gmail.com", "author": "mwu.code@gmail.com", "text": "Well we had the FPS counter on. That doesn't give the best data but it clearly went from hovering around 35 FPS to around 55 FPS.", "attachment_id": null, "time": "2011-12-14T19:07:58Z", "creation_time": "2011-12-14T19:07:58Z", "raw_text": "Well we had the FPS counter on. That doesn't give the best data but it clearly went from hovering around 35 FPS to around 55 FPS.", "bug_id": 710563, "tags": [], "is_private": false, "count": 2, "id": 5916408}, {"attachment_id": 581561, "time": "2011-12-14T21:56:16Z", "text": "Comment on attachment 581561\nUse REPEATING_TIMER_PRECISE_CAN_SKIP instead of SLACK to try to stay closer to 60fps rendering\n\n> However, the home screen uses RAF with webgl and a simple CSS animation, which\n> are supposed to flip on CAN_SKIP already.\n\nCSS stuff doesn't.  RAF does.  Can you fix the comment accordingly?\n\nr=me.", "raw_text": "> However, the home screen uses RAF with webgl and a simple CSS animation, which\n> are supposed to flip on CAN_SKIP already.\n\nCSS stuff doesn't.  RAF does.  Can you fix the comment accordingly?\n\nr=me.", "creation_time": "2011-12-14T21:56:16Z", "bug_id": 710563, "id": 5917027, "tags": [], "is_private": false, "count": 3, "author": "bzbarsky@mit.edu", "creator": "bzbarsky@mit.edu"}, {"creator": "dbaron@dbaron.org", "author": "dbaron@dbaron.org", "is_private": false, "count": 4, "tags": [], "id": 5917060, "bug_id": 710563, "raw_text": "Speaking of which, can you just write requestAnimationFrame?  RAF is the Royal Air Force.", "creation_time": "2011-12-14T22:04:11Z", "text": "Speaking of which, can you just write requestAnimationFrame?  RAF is the Royal Air Force.", "attachment_id": null, "time": "2011-12-14T22:04:11Z"}, {"creator": "cjones.bugs@gmail.com", "author": "cjones.bugs@gmail.com", "creation_time": "2011-12-15T23:46:58Z", "raw_text": "(In reply to Boris Zbarsky (:bz) from comment #3)\n> Comment on attachment 581561\n> Use REPEATING_TIMER_PRECISE_CAN_SKIP instead of SLACK to try to stay closer\n> to 60fps rendering\n> \n> > However, the home screen uses RAF with webgl and a simple CSS animation, which\n> > are supposed to flip on CAN_SKIP already.\n> \n> CSS stuff doesn't.  RAF does.  Can you fix the comment accordingly?\n> \n\nOh hm.  I asked and was told that it does.  Will fix.\n\n(In reply to David Baron [:dbaron] from comment #4)\n> Speaking of which, can you just write requestAnimationFrame?  RAF is the\n> Royal Air Force.\n\nOK, but I could also say that FPS means \"first person shooter\".  If requestAnimationFrame is abbreviated, is \"raf\" better?  (My fingers are lazy.)", "text": "(In reply to Boris Zbarsky (:bz) from comment #3)\n> Comment on attachment 581561\n> Use REPEATING_TIMER_PRECISE_CAN_SKIP instead of SLACK to try to stay closer\n> to 60fps rendering\n> \n> > However, the home screen uses RAF with webgl and a simple CSS animation, which\n> > are supposed to flip on CAN_SKIP already.\n> \n> CSS stuff doesn't.  RAF does.  Can you fix the comment accordingly?\n> \n\nOh hm.  I asked and was told that it does.  Will fix.\n\n(In reply to David Baron [:dbaron] from comment #4)\n> Speaking of which, can you just write requestAnimationFrame?  RAF is the\n> Royal Air Force.\n\nOK, but I could also say that FPS means \"first person shooter\".  If requestAnimationFrame is abbreviated, is \"raf\" better?  (My fingers are lazy.)", "attachment_id": null, "time": "2011-12-15T23:46:58Z", "count": 5, "is_private": false, "tags": [], "id": 5920555, "bug_id": 710563}, {"author": "cjones.bugs@gmail.com", "creator": "cjones.bugs@gmail.com", "bug_id": 710563, "id": 5924176, "tags": [], "count": 6, "is_private": false, "attachment_id": null, "time": "2011-12-17T09:10:16Z", "text": "Looking at\n\nhttp://perf.snarkfest.net/compare-talos/index.html?oldRevs=30e270816255,221eccfa6a3f,ceffbd680e2c,0c46aac6a23f,96a644cb3158,9fae755f5103,58a278555680&newRev=20521568a931&tests=a11y,tdhtml,tdhtml_nochrome,a11y_paint,tdhtml_paint,tdhtml_nochrome_paint,tp4,tp4_memset,tp4_pbytes,tp4_rss,tp4_shutdown,tp4_xres,tp5,tp5_memset,tp5_pbytes,tp5_rss,tp5_shutdown,tp5_xres,tp5_paint,tp5_memset_paint,tp5_pbytes_paint,tp5_rss_paint,tp5_shutdown_paint,tp5_xres_paint,dromaeo_basics,dromaeo_css,dromaeo_dom,dromaeo_jslib,dromaeo_sunspider,dromaeo_v8,tsspider,tsspider_nochrome,tsspider_paint,tsspider_nochrome_paint,tgfx,tgfx_nochrome,tgfx_paint,tgfx_nochrome_paint,tscroll,tsvg,tsvg_opacity,ts,ts_paint,ts_cold,ts_cold_generated_max,ts_cold_generated_max_shutdown,ts_cold_generated_med,ts_cold_generated_med_shutdown,ts_cold_generated_min,ts_cold_generated_min_shutdown,ts_cold_shutdown,ts_places_generated_max,ts_places_generated_max_shutdown,ts_places_generated_med,ts_places_generated_med_shutdown,ts_places_generated_min,ts_places_generated_min_shutdown,ts_shutdown,twinopen,tpaint&submit=true\n\nwe might have a big regression on \"tp5_shutdown_paint\" on win7 (not sure what that is ...) and a general regression on \"tdhtml_nochrome_paint\".  Will kick off another set of runs.", "raw_text": "Looking at\n\nhttp://perf.snarkfest.net/compare-talos/index.html?oldRevs=30e270816255,221eccfa6a3f,ceffbd680e2c,0c46aac6a23f,96a644cb3158,9fae755f5103,58a278555680&newRev=20521568a931&tests=a11y,tdhtml,tdhtml_nochrome,a11y_paint,tdhtml_paint,tdhtml_nochrome_paint,tp4,tp4_memset,tp4_pbytes,tp4_rss,tp4_shutdown,tp4_xres,tp5,tp5_memset,tp5_pbytes,tp5_rss,tp5_shutdown,tp5_xres,tp5_paint,tp5_memset_paint,tp5_pbytes_paint,tp5_rss_paint,tp5_shutdown_paint,tp5_xres_paint,dromaeo_basics,dromaeo_css,dromaeo_dom,dromaeo_jslib,dromaeo_sunspider,dromaeo_v8,tsspider,tsspider_nochrome,tsspider_paint,tsspider_nochrome_paint,tgfx,tgfx_nochrome,tgfx_paint,tgfx_nochrome_paint,tscroll,tsvg,tsvg_opacity,ts,ts_paint,ts_cold,ts_cold_generated_max,ts_cold_generated_max_shutdown,ts_cold_generated_med,ts_cold_generated_med_shutdown,ts_cold_generated_min,ts_cold_generated_min_shutdown,ts_cold_shutdown,ts_places_generated_max,ts_places_generated_max_shutdown,ts_places_generated_med,ts_places_generated_med_shutdown,ts_places_generated_min,ts_places_generated_min_shutdown,ts_shutdown,twinopen,tpaint&submit=true\n\nwe might have a big regression on \"tp5_shutdown_paint\" on win7 (not sure what that is ...) and a general regression on \"tdhtml_nochrome_paint\".  Will kick off another set of runs.", "creation_time": "2011-12-17T09:10:16Z"}, {"count": 7, "is_private": false, "tags": [], "id": 5925714, "bug_id": 710563, "creation_time": "2011-12-18T22:45:47Z", "raw_text": "Similar results for tdhtml_paint and tdhtml_nochrome_paint.  I don't have any guesses about what's causing this, but I suspect some timing is being altered a bit.\n\nhttp://perf.snarkfest.net/compare-talos/index.html?oldRevs=30e270816255,221eccfa6a3f,ceffbd680e2c,0c46aac6a23f,96a644cb3158,9fae755f5103,58a278555680&newRev=20521568a931&tests=a11y,tdhtml,tdhtml_nochrome,a11y_paint,tdhtml_paint,tdhtml_nochrome_paint,tp4,tp4_memset,tp4_pbytes,tp4_rss,tp4_shutdown,tp4_xres,tp5,tp5_memset,tp5_pbytes,tp5_rss,tp5_shutdown,tp5_xres,tp5_paint,tp5_memset_paint,tp5_pbytes_paint,tp5_rss_paint,tp5_shutdown_paint,tp5_xres_paint,dromaeo_basics,dromaeo_css,dromaeo_dom,dromaeo_jslib,dromaeo_sunspider,dromaeo_v8,tsspider,tsspider_nochrome,tsspider_paint,tsspider_nochrome_paint,tgfx,tgfx_nochrome,tgfx_paint,tgfx_nochrome_paint,tscroll,tsvg,tsvg_opacity,ts,ts_paint,ts_cold,ts_cold_generated_max,ts_cold_generated_max_shutdown,ts_cold_generated_med,ts_cold_generated_med_shutdown,ts_cold_generated_min,ts_cold_generated_min_shutdown,ts_cold_shutdown,ts_places_generated_max,ts_places_generated_max_shutdown,ts_places_generated_med,ts_places_generated_med_shutdown,ts_places_generated_min,ts_places_generated_min_shutdown,ts_shutdown,twinopen,tpaint&submit=true\n\nI'm not going to have time to investigate this deeply for a while :(.  Un-assigning myself.  Someone else, please feel free to steal!", "text": "Similar results for tdhtml_paint and tdhtml_nochrome_paint.  I don't have any guesses about what's causing this, but I suspect some timing is being altered a bit.\n\nhttp://perf.snarkfest.net/compare-talos/index.html?oldRevs=30e270816255,221eccfa6a3f,ceffbd680e2c,0c46aac6a23f,96a644cb3158,9fae755f5103,58a278555680&newRev=20521568a931&tests=a11y,tdhtml,tdhtml_nochrome,a11y_paint,tdhtml_paint,tdhtml_nochrome_paint,tp4,tp4_memset,tp4_pbytes,tp4_rss,tp4_shutdown,tp4_xres,tp5,tp5_memset,tp5_pbytes,tp5_rss,tp5_shutdown,tp5_xres,tp5_paint,tp5_memset_paint,tp5_pbytes_paint,tp5_rss_paint,tp5_shutdown_paint,tp5_xres_paint,dromaeo_basics,dromaeo_css,dromaeo_dom,dromaeo_jslib,dromaeo_sunspider,dromaeo_v8,tsspider,tsspider_nochrome,tsspider_paint,tsspider_nochrome_paint,tgfx,tgfx_nochrome,tgfx_paint,tgfx_nochrome_paint,tscroll,tsvg,tsvg_opacity,ts,ts_paint,ts_cold,ts_cold_generated_max,ts_cold_generated_max_shutdown,ts_cold_generated_med,ts_cold_generated_med_shutdown,ts_cold_generated_min,ts_cold_generated_min_shutdown,ts_cold_shutdown,ts_places_generated_max,ts_places_generated_max_shutdown,ts_places_generated_med,ts_places_generated_med_shutdown,ts_places_generated_min,ts_places_generated_min_shutdown,ts_shutdown,twinopen,tpaint&submit=true\n\nI'm not going to have time to investigate this deeply for a while :(.  Un-assigning myself.  Someone else, please feel free to steal!", "attachment_id": null, "time": "2011-12-18T22:45:47Z", "creator": "cjones.bugs@gmail.com", "author": "cjones.bugs@gmail.com"}, {"id": 5976335, "count": 8, "is_private": false, "tags": [], "bug_id": 710563, "creation_time": "2012-01-12T20:14:38Z", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/0dbdc8243364", "time": "2012-01-12T20:14:38Z", "attachment_id": null, "text": "https://hg.mozilla.org/mozilla-central/rev/0dbdc8243364", "author": "mbrubeck@limpet.net", "creator": "mbrubeck@limpet.net"}, {"author": "cjones.bugs@gmail.com", "creator": "cjones.bugs@gmail.com", "creation_time": "2012-01-12T20:26:08Z", "raw_text": "Ugh, sorry, I typo'd the first bug number in the comment.  The b2g \"preview landing\" was bug 717532.  Talos issues here still to be sorted out.", "attachment_id": null, "time": "2012-01-12T20:26:08Z", "text": "Ugh, sorry, I typo'd the first bug number in the comment.  The b2g \"preview landing\" was bug 717532.  Talos issues here still to be sorted out.", "id": 5976389, "tags": [], "count": 9, "is_private": false, "bug_id": 710563}, {"creator": "cjones.bugs@gmail.com", "author": "cjones.bugs@gmail.com", "text": "Whups, mid-aired.", "attachment_id": null, "time": "2013-02-25T22:45:23Z", "creation_time": "2013-02-25T22:45:23Z", "raw_text": "Whups, mid-aired.", "bug_id": 710563, "count": 10, "is_private": false, "tags": [], "id": 7140835}]}}, "comments": {}}