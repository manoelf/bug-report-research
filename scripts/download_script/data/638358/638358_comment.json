{"bugs": {"638358": {"comments": [{"time": "2011-03-03T05:58:31Z", "id": 5317665, "bug_id": 638358, "creation_time": "2011-03-03T05:58:31Z", "raw_text": "Draft mail saved in IMAP Drafts folder during Work Offline mode is not deleted by next Save As Draft.\n\n[Buil Identifier]\n> Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.14) Gecko/20110221 Thunderbird/3.1.8\n\n[Steps to re-produce problem]\n(1) Setups.\n    - Yahoo! Mail IMAP account (\\Deleted flag is kept normally).\n      If Gmail IMAP, auto-expunging=off of Gmail IMAP is recommended.\n    - offline-use=on or off of Drafts folder was irrelevant.\n    - To observe phenomenon easily, use \"Just mark it as delete\" model.\n    - Disable new mail check for ease of observation.\n    - Disable IDLE command use for ease of observation.\n    - Use \"All Folders\" view at folder pane to avoid confusion.\n      Don't use \"Unified Folders\" view to avoid confusion.\n    - Enable next option for ease of observation.\n      [ X ] Show  confirmation dialog when messages are saved\n(2) Open Drafts folder\n(3) Compose a mail, and execute Save As Draft several times,\n    with changing subject upon each save.\n    - subject-1 : UID=1, deleted(shown with strike-thru line), old version\n    - subject-2 : UID=2, active\n(4) Go Work Offline. Emulation of \"just after suspend/resume\".\n(5) Execute Save As Draft several times, with changing subject upon each save.\n    - subject-2 : UID=2, deleted(shown with strike-thru line), old version\n    - subject-3 : UID=4294967168, not deleted\n    - subject-4 : UID=4294967167, not deleted\n    - subject-5 : UID=4294967166, not deleted\n    Note: UID in this case is value shown at \"Order Received\" column.\n(6) Go back to Work Online. Emulation of automatic recovery from interface down.\n    After a while, Drafts folder is re-sync'ed.\n    - subject-2 : UID=2, deleted(shown with strike-thru line), old version\n    - subject-3 : UID=5, not deleted\n    - subject-4 : UID=4, not deleted\n    - subject-5 : UID=3, not deleted\n(7) Execute Save As Draft several times, with changing subject upon each save.\n    - subject-3 : UID=5, not deleted\n    - subject-4 : UID=4, not deleted\n    - subject-5 : UID=3, not deleted\n    - subject-6 : UID=6, deleted(shown with strike-thru line), old version\n    - subject-7 : UID=7, active\n(8) After that, not-deleted draft mails remain.\n    - subject-1 : UID=1, deleted(shown with strike-thru line), old version\n    - subject-2 : UID=2, deleted(shown with strike-thru line), old version\n    - subject-5 : UID=3, not deleted\n    - subject-4 : UID=4, not deleted\n    - subject-3 : UID=5, not deleted\n    - subject-6 : UID=6, deleted(shown with strike-thru line), old version\n    - subject-7 : UID=7, active\n    Note-1: If other than \"Just mark it as deleted\",\n            UID=1/2/6 is not shown at any thread pane.\n    Note-2: If Drafts of \"Unified Folders\", UID=1/2/6 is shown\n            as if active draft mail due to Bug 635869,\n            because \"Just mark it as deleted\" is used in test.\n\n(Problems observed)\n(a) If draft mail is saved during Work Offline mode, draft mail is not deleted by new Save As Draft.\n(b) Upon re-sync by \"go back to Online mode\", append of old draft mails are done in reversed order(done in order of \"Order Received\" column value.)\nIt may be Win specific issue, because unsigned 32bits integer is used for \"Order Received\" column value if local mail folder(offset value, if local mail folders).\nIt may be a reason of \"funny order of re-sync of mails\" when mail is moved multiple times during Work Offline mode.", "tags": [], "is_private": false, "text": "Draft mail saved in IMAP Drafts folder during Work Offline mode is not deleted by next Save As Draft.\n\n[Buil Identifier]\n> Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.14) Gecko/20110221 Thunderbird/3.1.8\n\n[Steps to re-produce problem]\n(1) Setups.\n    - Yahoo! Mail IMAP account (\\Deleted flag is kept normally).\n      If Gmail IMAP, auto-expunging=off of Gmail IMAP is recommended.\n    - offline-use=on or off of Drafts folder was irrelevant.\n    - To observe phenomenon easily, use \"Just mark it as delete\" model.\n    - Disable new mail check for ease of observation.\n    - Disable IDLE command use for ease of observation.\n    - Use \"All Folders\" view at folder pane to avoid confusion.\n      Don't use \"Unified Folders\" view to avoid confusion.\n    - Enable next option for ease of observation.\n      [ X ] Show  confirmation dialog when messages are saved\n(2) Open Drafts folder\n(3) Compose a mail, and execute Save As Draft several times,\n    with changing subject upon each save.\n    - subject-1 : UID=1, deleted(shown with strike-thru line), old version\n    - subject-2 : UID=2, active\n(4) Go Work Offline. Emulation of \"just after suspend/resume\".\n(5) Execute Save As Draft several times, with changing subject upon each save.\n    - subject-2 : UID=2, deleted(shown with strike-thru line), old version\n    - subject-3 : UID=4294967168, not deleted\n    - subject-4 : UID=4294967167, not deleted\n    - subject-5 : UID=4294967166, not deleted\n    Note: UID in this case is value shown at \"Order Received\" column.\n(6) Go back to Work Online. Emulation of automatic recovery from interface down.\n    After a while, Drafts folder is re-sync'ed.\n    - subject-2 : UID=2, deleted(shown with strike-thru line), old version\n    - subject-3 : UID=5, not deleted\n    - subject-4 : UID=4, not deleted\n    - subject-5 : UID=3, not deleted\n(7) Execute Save As Draft several times, with changing subject upon each save.\n    - subject-3 : UID=5, not deleted\n    - subject-4 : UID=4, not deleted\n    - subject-5 : UID=3, not deleted\n    - subject-6 : UID=6, deleted(shown with strike-thru line), old version\n    - subject-7 : UID=7, active\n(8) After that, not-deleted draft mails remain.\n    - subject-1 : UID=1, deleted(shown with strike-thru line), old version\n    - subject-2 : UID=2, deleted(shown with strike-thru line), old version\n    - subject-5 : UID=3, not deleted\n    - subject-4 : UID=4, not deleted\n    - subject-3 : UID=5, not deleted\n    - subject-6 : UID=6, deleted(shown with strike-thru line), old version\n    - subject-7 : UID=7, active\n    Note-1: If other than \"Just mark it as deleted\",\n            UID=1/2/6 is not shown at any thread pane.\n    Note-2: If Drafts of \"Unified Folders\", UID=1/2/6 is shown\n            as if active draft mail due to Bug 635869,\n            because \"Just mark it as deleted\" is used in test.\n\n(Problems observed)\n(a) If draft mail is saved during Work Offline mode, draft mail is not deleted by new Save As Draft.\n(b) Upon re-sync by \"go back to Online mode\", append of old draft mails are done in reversed order(done in order of \"Order Received\" column value.)\nIt may be Win specific issue, because unsigned 32bits integer is used for \"Order Received\" column value if local mail folder(offset value, if local mail folders).\nIt may be a reason of \"funny order of re-sync of mails\" when mail is moved multiple times during Work Offline mode.", "count": 0, "author": "m-wada@usa.com", "creator": "m-wada@usa.com", "attachment_id": null}, {"author": "m-wada@usa.com", "time": "2014-12-10T02:01:58Z", "id": 9675980, "count": 1, "text": "See Bug 1108441 Comment #4 for \"what happened\".\nPhenomenon was as follows,\n   1. UID of Editing draft=N, so draftiD=N at composition window\n   2. go Work Offline\n   3. Save => new draft is saved with messageKey=FakedKey, then messaeSend is not set. \n       Data of mail is saved in Offline-Store, regardless of Offline-Use=On/Off of Drafts folder.\n       Delete mail of draftID=N => msgDBHdr of messageKey=UID=N is deleted locally.\n       Because messageSend is not set, draftID=N is kept.\n   4. Repeat Save M times => mail of messageKey=FakedKey is written by each save, but draftID=N is always kept.\n   5. go back to Work Onlne, and Save\n       Sooner or later, re-synchronization of Drafts occurs.\n       If Save happens before re-sync, UID of newly saved draft is UID=N+1, and \\Deleted is stored to UID=N.,\n       and UID=N+1+1 to UID=N+1+M is created for non-deleted draft mails by re-sync.\n       =>  messageSend=N+1, so draftID=N+1 after Save.\n              So, by next Save, \\Deleted is stored to UID=N+1 \n   5-A. If re-sync is executed before first Save after going back online,\n           \\Deleted is stored to UID=N, and UID=N+1 to UID=N+m is created for non-deleted draft mails,\n           and UID=N+m+1 is created for newly saved draft.\n           =>  messageSend=N+m+1, so draftID=N+m+1 after Save\n                 So, by next Save, \\Deleted is stored to UID=N+m+1", "is_private": false, "attachment_id": null, "raw_text": "See Bug 1108441 Comment #4 for \"what happened\".\nPhenomenon was as follows,\n   1. UID of Editing draft=N, so draftiD=N at composition window\n   2. go Work Offline\n   3. Save => new draft is saved with messageKey=FakedKey, then messaeSend is not set. \n       Data of mail is saved in Offline-Store, regardless of Offline-Use=On/Off of Drafts folder.\n       Delete mail of draftID=N => msgDBHdr of messageKey=UID=N is deleted locally.\n       Because messageSend is not set, draftID=N is kept.\n   4. Repeat Save M times => mail of messageKey=FakedKey is written by each save, but draftID=N is always kept.\n   5. go back to Work Onlne, and Save\n       Sooner or later, re-synchronization of Drafts occurs.\n       If Save happens before re-sync, UID of newly saved draft is UID=N+1, and \\Deleted is stored to UID=N.,\n       and UID=N+1+1 to UID=N+1+M is created for non-deleted draft mails by re-sync.\n       =>  messageSend=N+1, so draftID=N+1 after Save.\n              So, by next Save, \\Deleted is stored to UID=N+1 \n   5-A. If re-sync is executed before first Save after going back online,\n           \\Deleted is stored to UID=N, and UID=N+1 to UID=N+m is created for non-deleted draft mails,\n           and UID=N+m+1 is created for newly saved draft.\n           =>  messageSend=N+m+1, so draftID=N+m+1 after Save\n                 So, by next Save, \\Deleted is stored to UID=N+m+1", "bug_id": 638358, "creation_time": "2014-12-10T02:01:58Z", "creator": "m-wada@usa.com", "tags": []}, {"author": "m-wada@usa.com", "text": "Sorry, too quick Enter,\n   5. go back to Work Onlne, and Save\n       Sooner or later, re-synchronization of Drafts occurs.\n   5-A. If Save happens before re-sync, UID of newly saved draft is UID=N+1, and \\Deleted is stored to UID=N.,\n           and UID=N+1+1 to UID=N+1+M is created for non-deleted draft mails by re-sync.\n           =>  messageSend=N+1, so draftID=N+1 after Save.\n                  So, by next Save, \\Deleted is stored to UID=N+1 \n   5-B. If re-sync is executed before first Save after going back online,\n           \\Deleted is stored to UID=N, and UID=N+1 to UID=N+m is created for non-deleted draft mails,\n           and UID=N+m+1 is created for newly saved draft.\n           =>  messageSend=N+m+1, so draftID=N+m+1 after Save\n                 So, by next Save, \\Deleted is stored to UID=N+m+1", "count": 2, "attachment_id": null, "creator": "m-wada@usa.com", "time": "2014-12-10T02:05:20Z", "id": 9675995, "is_private": false, "creation_time": "2014-12-10T02:05:20Z", "bug_id": 638358, "raw_text": "Sorry, too quick Enter,\n   5. go back to Work Onlne, and Save\n       Sooner or later, re-synchronization of Drafts occurs.\n   5-A. If Save happens before re-sync, UID of newly saved draft is UID=N+1, and \\Deleted is stored to UID=N.,\n           and UID=N+1+1 to UID=N+1+M is created for non-deleted draft mails by re-sync.\n           =>  messageSend=N+1, so draftID=N+1 after Save.\n                  So, by next Save, \\Deleted is stored to UID=N+1 \n   5-B. If re-sync is executed before first Save after going back online,\n           \\Deleted is stored to UID=N, and UID=N+1 to UID=N+m is created for non-deleted draft mails,\n           and UID=N+m+1 is created for newly saved draft.\n           =>  messageSend=N+m+1, so draftID=N+m+1 after Save\n                 So, by next Save, \\Deleted is stored to UID=N+m+1", "tags": []}, {"id": 9675998, "time": "2014-12-10T02:06:58Z", "tags": [], "bug_id": 638358, "creation_time": "2014-12-10T02:06:58Z", "raw_text": "", "is_private": false, "text": "*** Bug 811339 has been marked as a duplicate of this bug. ***", "count": 3, "author": "m-wada@usa.com", "creator": "m-wada@usa.com", "attachment_id": null}, {"raw_text": "Since the above description of the issue is pretty hard to read, here is much simpler text, updated from my own report (bug 811339) meanwhile marked as duplicate:\n\nSteps to reproduce:\n\n1. Work offline, e.g., by clicking the icon on the lower left-hand corner.\n2. Save a draft message (or let it get auto-saved) multiple times.\n3. Find a number of copies in the drafts folder, all marked as read.\n4. Re-establish connection by clicking again on the icon.\n5. Observe that those multiple copies are not deleted.\n6. Refresh the Drafts folder.\n7. Observe that messages are re-fetched from the server and marked as unread.\n\nExpected results:\n\nOnly the latest version of the draft should appear in the Drafts folder,\nthat is, any existing earlier version of the draft should be replaced,\nregardless whether TB is in online or offline mode.", "creation_time": "2014-12-13T15:09:32Z", "bug_id": 638358, "tags": [], "is_private": false, "time": "2014-12-13T15:09:32Z", "id": 9691320, "creator": "nl0@von-Oheimb.de", "attachment_id": null, "count": 4, "text": "Since the above description of the issue is pretty hard to read, here is much simpler text, updated from my own report (bug 811339) meanwhile marked as duplicate:\n\nSteps to reproduce:\n\n1. Work offline, e.g., by clicking the icon on the lower left-hand corner.\n2. Save a draft message (or let it get auto-saved) multiple times.\n3. Find a number of copies in the drafts folder, all marked as read.\n4. Re-establish connection by clicking again on the icon.\n5. Observe that those multiple copies are not deleted.\n6. Refresh the Drafts folder.\n7. Observe that messages are re-fetched from the server and marked as unread.\n\nExpected results:\n\nOnly the latest version of the draft should appear in the Drafts folder,\nthat is, any existing earlier version of the draft should be replaced,\nregardless whether TB is in online or offline mode.", "author": "nl0@von-Oheimb.de"}, {"tags": [], "creator": "u328142@disabled.tld", "creation_time": "2015-07-30T02:06:41Z", "bug_id": 638358, "raw_text": "I encounter this defect all the time, it is easily repeatable and extremely annoying as I work offline for a couple of hours a day.  3 weeks after clearing out my old draft messages, I now have around 70 messages, most of which are duplicate copies of the a message that has already been sent.\n\n+1 vote from me.", "is_private": false, "attachment_id": null, "count": 5, "text": "I encounter this defect all the time, it is easily repeatable and extremely annoying as I work offline for a couple of hours a day.  3 weeks after clearing out my old draft messages, I now have around 70 messages, most of which are duplicate copies of the a message that has already been sent.\n\n+1 vote from me.", "id": 10554406, "time": "2015-07-30T02:06:41Z", "author": "u328142@disabled.tld"}, {"author": "d.agostino.victor@gmail.com", "count": 6, "text": "Reproductible on Thunderbird 56b4 in offline mode only and using Draft IMAP folder on Zimbra.\nVictor", "attachment_id": null, "creator": "d.agostino.victor@gmail.com", "time": "2018-01-25T12:20:47Z", "id": 12994283, "is_private": false, "bug_id": 638358, "creation_time": "2018-01-25T12:20:47Z", "raw_text": "Reproductible on Thunderbird 56b4 in offline mode only and using Draft IMAP folder on Zimbra.\nVictor", "tags": []}]}}, "comments": {}}