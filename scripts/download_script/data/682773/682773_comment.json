{"comments": {}, "bugs": {"682773": {"comments": [{"id": 5684101, "raw_text": "While looking at the moz-icon code, I noticed some things that I don't think are correct:\n\n1. We are omitting the color table for bitmaps < 16 bits per pixel for moz-icon URLs.  \n2. I'm pretty sure we are overwritting memory we don't own because the iconSize is calculated wrong by omitting the color table in the calculation.  Win32 API GetDIBits is pretty unsafe and doesn't ask for the buffer size you are passing in.  So it will overwrite memory.\n3. The alpha 'AND mask' I think is created way too big, it should only be 1 bit per pixel. \n4. The alpha 'AND mask' is being created for 32 bit per pixel bitmaps, but those bitmaps shouldn't have one.\n5. We are currently doing allocations we don't need to wasting memory and time (possibly get rid of CreateBitmapInfo)\n\nProblem 1 might be able to be fixed by requesting that windows return to us a specific bit per pixel (always 32) value instead of using the suggested one by Windows.", "attachment_id": null, "text": "While looking at the moz-icon code, I noticed some things that I don't think are correct:\n\n1. We are omitting the color table for bitmaps < 16 bits per pixel for moz-icon URLs.  \n2. I'm pretty sure we are overwritting memory we don't own because the iconSize is calculated wrong by omitting the color table in the calculation.  Win32 API GetDIBits is pretty unsafe and doesn't ask for the buffer size you are passing in.  So it will overwrite memory.\n3. The alpha 'AND mask' I think is created way too big, it should only be 1 bit per pixel. \n4. The alpha 'AND mask' is being created for 32 bit per pixel bitmaps, but those bitmaps shouldn't have one.\n5. We are currently doing allocations we don't need to wasting memory and time (possibly get rid of CreateBitmapInfo)\n\nProblem 1 might be able to be fixed by requesting that windows return to us a specific bit per pixel (always 32) value instead of using the suggested one by Windows.", "time": "2011-08-29T04:06:43Z", "tags": [], "creation_time": "2011-08-29T04:06:43Z", "author": "netzen@gmail.com", "is_private": false, "creator": "netzen@gmail.com", "bug_id": 682773, "count": 0}]}}}