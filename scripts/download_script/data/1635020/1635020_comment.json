{"comments": {}, "bugs": {"1635020": {"comments": [{"creation_time": "2020-05-04T06:34:56Z", "time": "2020-05-04T06:34:56Z", "text": "This bug is for crash report bp-a18b3a1d-63f9-4bfb-bb97-f422c0200503.\n\n```\nTop 10 frames of crashing thread:\n\n0 xul.dll nsGlobalWindowInner::StorageAccessGranted dom/base/nsGlobalWindowInner.cpp:7202\n1 xul.dll static mozilla::ContentBlocking::OnAllowAccessFor toolkit/components/antitracking/ContentBlocking.cpp:567\n2 xul.dll mozilla::ContentBlocking::AllowAccessFor::<unnamed-tag>::operator const toolkit/components/antitracking/ContentBlocking.cpp:363\n3 xul.dll mozilla::MozPromise<mozilla::Maybe<mozilla::ContentBlocking::StorageAccessPromptChoices>, mozilla::ipc::ResponseRejectReason, 1>::ThenValue<`lambda at /builds/worker/checkouts/gecko/toolkit/components/antitracking/ContentBlocking.cpp:354:14'>::DoResolveOrRejectInternal xpcom/threads/MozPromise.h:798\n4 xul.dll mozilla::MozPromise<CopyableTArray<bool>, nsresult, 0>::ThenValueBase::ResolveOrRejectRunnable::Run xpcom/threads/MozPromise.h:405\n5 xul.dll nsThread::ProcessNextEvent xpcom/threads/nsThread.cpp:1200\n6 xul.dll NS_ProcessNextEvent xpcom/threads/nsThreadUtils.cpp:481\n7 xul.dll mozilla::ipc::MessagePump::Run ipc/glue/MessagePump.cpp:87\n8 xul.dll MessageLoop::RunHandler ipc/chromium/src/base/message_loop.cc:308\n9 xul.dll MessageLoop::Run ipc/chromium/src/base/message_loop.cc:290\n\n```\nThis looks like a a dereference of a `NULL` `this` pointer. The oldest buildid for this crash is 20200429215539. Tentatively filing under Core > Privacy: Anti-Tracking because most of the changes around this code seem to be happening in this component. Please move to the right component if this is wrong.", "raw_text": "This bug is for crash report bp-a18b3a1d-63f9-4bfb-bb97-f422c0200503.\n\n```\nTop 10 frames of crashing thread:\n\n0 xul.dll nsGlobalWindowInner::StorageAccessGranted dom/base/nsGlobalWindowInner.cpp:7202\n1 xul.dll static mozilla::ContentBlocking::OnAllowAccessFor toolkit/components/antitracking/ContentBlocking.cpp:567\n2 xul.dll mozilla::ContentBlocking::AllowAccessFor::<unnamed-tag>::operator const toolkit/components/antitracking/ContentBlocking.cpp:363\n3 xul.dll mozilla::MozPromise<mozilla::Maybe<mozilla::ContentBlocking::StorageAccessPromptChoices>, mozilla::ipc::ResponseRejectReason, 1>::ThenValue<`lambda at /builds/worker/checkouts/gecko/toolkit/components/antitracking/ContentBlocking.cpp:354:14'>::DoResolveOrRejectInternal xpcom/threads/MozPromise.h:798\n4 xul.dll mozilla::MozPromise<CopyableTArray<bool>, nsresult, 0>::ThenValueBase::ResolveOrRejectRunnable::Run xpcom/threads/MozPromise.h:405\n5 xul.dll nsThread::ProcessNextEvent xpcom/threads/nsThread.cpp:1200\n6 xul.dll NS_ProcessNextEvent xpcom/threads/nsThreadUtils.cpp:481\n7 xul.dll mozilla::ipc::MessagePump::Run ipc/glue/MessagePump.cpp:87\n8 xul.dll MessageLoop::RunHandler ipc/chromium/src/base/message_loop.cc:308\n9 xul.dll MessageLoop::Run ipc/chromium/src/base/message_loop.cc:290\n\n```\nThis looks like a a dereference of a `NULL` `this` pointer. The oldest buildid for this crash is 20200429215539. Tentatively filing under Core > Privacy: Anti-Tracking because most of the changes around this code seem to be happening in this component. Please move to the right component if this is wrong.", "is_private": false, "count": 0, "bug_id": 1635020, "id": 14794556, "attachment_id": null, "creator": "gsvelto@mozilla.com", "tags": [], "author": "gsvelto@mozilla.com"}, {"text": "Created attachment 9145733\nBug 1635020 - Check whether browsing context is discarded after returning from an IPC call r=timhuang\n\n\nWe keep the reference of BrowsingContext across IPC call. But the\nBrowsingContext may be discarded when returning from the IPC call.\n\nThis crash happens when:\nA first-party window calls window.open(a 3rd-party url), which triggers\nthe storage access heuristic, and then the window is closed\nimmediatelly.\n\nThis patch fixes this issue by checking IsDiscard() when returning from\nthe IPC call.", "creation_time": "2020-05-05T09:36:53Z", "attachment_id": 9145733, "tags": [], "author": "dlee@mozilla.com", "time": "2020-05-05T09:36:53Z", "raw_text": "\nWe keep the reference of BrowsingContext across IPC call. But the\nBrowsingContext may be discarded when returning from the IPC call.\n\nThis crash happens when:\nA first-party window calls window.open(a 3rd-party url), which triggers\nthe storage access heuristic, and then the window is closed\nimmediatelly.\n\nThis patch fixes this issue by checking IsDiscard() when returning from\nthe IPC call.", "is_private": false, "count": 1, "bug_id": 1635020, "id": 14797422, "creator": "dlee@mozilla.com"}, {"attachment_id": null, "tags": [], "author": "pulsebot@bots.tld", "text": "Pushed by dlee@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/f40fc32a73f9\nCheck whether browsing context is discarded after returning from an IPC call r=timhuang", "creation_time": "2020-05-05T19:01:29Z", "bug_id": 1635020, "id": 14798669, "creator": "pulsebot@bots.tld", "time": "2020-05-05T19:01:29Z", "raw_text": "Pushed by dlee@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/f40fc32a73f9\nCheck whether browsing context is discarded after returning from an IPC call r=timhuang", "is_private": false, "count": 2}, {"text": "https://hg.mozilla.org/mozilla-central/rev/f40fc32a73f9", "creation_time": "2020-05-05T21:42:01Z", "tags": ["bugherder"], "author": "malexandru@mozilla.com", "attachment_id": null, "is_private": false, "time": "2020-05-05T21:42:01Z", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/f40fc32a73f9", "count": 3, "id": 14799022, "bug_id": 1635020, "creator": "malexandru@mozilla.com"}, {"bug_id": 1635020, "id": 14802223, "attachment_id": null, "creator": "pascalc@gmail.com", "tags": [], "author": "pascalc@gmail.com", "text": "There was no crash in the last 3 nightly builds with the patch, Dimi do you want to request an uplift to beta?", "creation_time": "2020-05-07T10:29:43Z", "time": "2020-05-07T10:29:43Z", "raw_text": "There was no crash in the last 3 nightly builds with the patch, Dimi do you want to request an uplift to beta?", "is_private": false, "count": 4}, {"attachment_id": 9145733, "creator": "dlee@mozilla.com", "tags": [], "author": "dlee@mozilla.com", "bug_id": 1635020, "id": 14803463, "count": 5, "text": "Comment on attachment 9145733\nBug 1635020 - Check whether browsing context is discarded after returning from an IPC call r=timhuang\n\n### Beta/Release Uplift Approval Request\n* **User impact if declined**: may crash if a 3rd-party tracker's iframe opens a window and then the iframes'window is immediately closed.\n* **Is this code covered by automated tests?**: No\n* **Has the fix been verified in Nightly?**: Yes\n* **Needs manual test from QE?**: No\n* **If yes, steps to reproduce**: \n* **List of other uplifts needed**: None\n* **Risk to taking this patch**: Low\n* **Why is the change risky/not risky? (and alternatives if risky)**: This change only check if browsing context is discarded before continuing\n* **String changes made/needed**:", "time": "2020-05-07T20:46:09Z", "creation_time": "2020-05-07T20:46:09Z", "raw_text": "### Beta/Release Uplift Approval Request\n* **User impact if declined**: may crash if a 3rd-party tracker's iframe opens a window and then the iframes'window is immediately closed.\n* **Is this code covered by automated tests?**: No\n* **Has the fix been verified in Nightly?**: Yes\n* **Needs manual test from QE?**: No\n* **If yes, steps to reproduce**: \n* **List of other uplifts needed**: None\n* **Risk to taking this patch**: Low\n* **Why is the change risky/not risky? (and alternatives if risky)**: This change only check if browsing context is discarded before continuing\n* **String changes made/needed**:", "is_private": false}, {"id": 14803811, "bug_id": 1635020, "tags": [], "author": "ryanvm@gmail.com", "attachment_id": 9145733, "creator": "ryanvm@gmail.com", "is_private": false, "text": "Comment on attachment 9145733\nBug 1635020 - Check whether browsing context is discarded after returning from an IPC call r=timhuang\n\nSimple null check crash fix. Approved for 77.0b3.", "time": "2020-05-07T23:32:03Z", "creation_time": "2020-05-07T23:32:03Z", "raw_text": "Simple null check crash fix. Approved for 77.0b3.", "count": 6}, {"count": 7, "text": "https://hg.mozilla.org/releases/mozilla-beta/rev/3dfa2ea51f02", "time": "2020-05-07T23:33:47Z", "creation_time": "2020-05-07T23:33:47Z", "raw_text": "https://hg.mozilla.org/releases/mozilla-beta/rev/3dfa2ea51f02", "is_private": false, "attachment_id": null, "creator": "ryanvm@gmail.com", "tags": ["bugherder", "uplift"], "author": "ryanvm@gmail.com", "bug_id": 1635020, "id": 14803814}, {"text": "1 failures in 5276 pushes (0.0 failures/push) were associated with this bug in the last 7 days.\n\nRepository breakdown:\n* mozilla-central: 1\n\nPlatform breakdown:\n* linux1804-64-qr: 1\n\nFor more details, see:\nhttps://treeherder.mozilla.org/intermittent-failures.html#/bugdetails?bug=1635020&startday=2020-05-04&endday=2020-05-10&tree=all", "creation_time": "2020-05-11T06:26:35Z", "attachment_id": null, "tags": [], "author": "orangefactor@bots.tld", "time": "2020-05-11T06:26:35Z", "raw_text": "1 failures in 5276 pushes (0.0 failures/push) were associated with this bug in the last 7 days.\n\nRepository breakdown:\n* mozilla-central: 1\n\nPlatform breakdown:\n* linux1804-64-qr: 1\n\nFor more details, see:\nhttps://treeherder.mozilla.org/intermittent-failures.html#/bugdetails?bug=1635020&startday=2020-05-04&endday=2020-05-10&tree=all", "is_private": false, "count": 8, "bug_id": 1635020, "id": 14807971, "creator": "orangefactor@bots.tld"}]}}}