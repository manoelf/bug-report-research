{"comments": {}, "bugs": {"700644": {"comments": [{"raw_text": "I have had reports of this happening with an ICS zimbra calendar. Dismissing all alarms produces the following error, dismissing single alarms doesn't work. The cache is enabled:\n\nError: An error occurred when writing to the calendar Mozilla! Error code: MODIFICATION_FAILED. Description:\nSource File: resource://calendar/modules/calUtils.jsm -> file:///C:/Users/xx/AppData/Roaming/Thunderbird/Profiles/hnju2r5c.default/extensions/%7Be2fda1a4-762b-4020-b5ad-a41df1933103%7D/calendar-js/calCalendarManager.js\nLine: 1101\nWarning: There has been an error reading data for calendar: Mozilla. Error code: 0x80004005. Description: old item mismatch in modifyItem storedId:BEGIN:VEVENT\nDTSTAMP:20111031T135250Z\nUID:bb3e7d11-c56f-4c1f-a112-a2e2790b6298\nSUMMARY:xxx\nSTATUS:CONFIRMED\nORGANIZER;CN=xxx:mailto:xxx@mozilla.com\nATTENDEE;RSVP=TRUE;CN=yyy;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIP\n ANT:mailto:yyy@mozilla.com\nRRULE:FREQ=WEEKLY\nEXDATE:20110922T160000Z\nX-MOZ-LASTACK:20111031T135250Z\nDTSTART;TZID=Europe/Brussels:20110623T180000\nDTEND;TZID=Europe/Brussels:20110623T190000\nDESCRIPTION:\\n\nX-MOZ-GENERATION:26\nCLASS:PUBLIC\nX-MICROSOFT-CDO-INTENDEDSTATUS:BUSY\nTRANSP:OPAQUE\nSEQUENCE:1\nBEGIN:VALARM\nACTION:DISPLAY\nTRIGGER;VALUE=DURATION:-PT5M\nDESCRIPTION:Reminder\nEND:VALARM\nEND:VEVENT\n old item:BEGIN:VEVENT\nCREATED:20111107T104757Z\nLAST-MODIFIED:20111107T104757Z\nDTSTAMP:20111107T104757Z\nUID:bb3e7d11-c56f-4c1f-a112-a2e2790b6298\nSUMMARY:xxx\nSTATUS:CONFIRMED\nORGANIZER;CN=xxx:mailto:xxx@mozilla.com\nATTENDEE;RSVP=TRUE;CN=yyy;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIP\n ANT:mailto:yyy@mozilla.com\nRRULE:FREQ=WEEKLY\nEXDATE:20110922T160000Z\nX-MOZ-LASTACK:20111031T135250Z\nDTSTART;TZID=Europe/Brussels:20110623T180000\nDTEND;TZID=Europe/Brussels:20110623T190000\nCLASS:PUBLIC\nDESCRIPTION:\\n\nX-MOZ-GENERATION:26\nX-MICROSOFT-CDO-INTENDEDSTATUS:BUSY\nTRANSP:OPAQUE\nSEQUENCE:1\nBEGIN:VALARM\nACTION:DISPLAY\nTRIGGER;VALUE=DURATION:-PT5M\nDESCRIPTION:Reminder\nEND:VALARM\nEND:VEVENT\n\n\nError: uncaught exception: [Exception... \"'<error>' when calling method: [calICalendar::modifyItem]\"  nsresult: \"0x804a0002 (<unknown>)\"  location: \"JS frame :: resource://calendar/modules/calUtils.jsm -> file:///C:/Users/xx/AppData/Roaming/Thunderbird/Profiles/hnju2r5c.default/extensions/%7Be2fda1a4-762b-4020-b5ad-a41df1933103%7D/calendar-js/calCachedCalendar.js :: <TOP_LEVEL> :: line 781\"  data: no]", "attachment_id": null, "tags": [], "bug_id": 700644, "text": "I have had reports of this happening with an ICS zimbra calendar. Dismissing all alarms produces the following error, dismissing single alarms doesn't work. The cache is enabled:\n\nError: An error occurred when writing to the calendar Mozilla! Error code: MODIFICATION_FAILED. Description:\nSource File: resource://calendar/modules/calUtils.jsm -> file:///C:/Users/xx/AppData/Roaming/Thunderbird/Profiles/hnju2r5c.default/extensions/%7Be2fda1a4-762b-4020-b5ad-a41df1933103%7D/calendar-js/calCalendarManager.js\nLine: 1101\nWarning: There has been an error reading data for calendar: Mozilla. Error code: 0x80004005. Description: old item mismatch in modifyItem storedId:BEGIN:VEVENT\nDTSTAMP:20111031T135250Z\nUID:bb3e7d11-c56f-4c1f-a112-a2e2790b6298\nSUMMARY:xxx\nSTATUS:CONFIRMED\nORGANIZER;CN=xxx:mailto:xxx@mozilla.com\nATTENDEE;RSVP=TRUE;CN=yyy;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIP\n ANT:mailto:yyy@mozilla.com\nRRULE:FREQ=WEEKLY\nEXDATE:20110922T160000Z\nX-MOZ-LASTACK:20111031T135250Z\nDTSTART;TZID=Europe/Brussels:20110623T180000\nDTEND;TZID=Europe/Brussels:20110623T190000\nDESCRIPTION:\\n\nX-MOZ-GENERATION:26\nCLASS:PUBLIC\nX-MICROSOFT-CDO-INTENDEDSTATUS:BUSY\nTRANSP:OPAQUE\nSEQUENCE:1\nBEGIN:VALARM\nACTION:DISPLAY\nTRIGGER;VALUE=DURATION:-PT5M\nDESCRIPTION:Reminder\nEND:VALARM\nEND:VEVENT\n old item:BEGIN:VEVENT\nCREATED:20111107T104757Z\nLAST-MODIFIED:20111107T104757Z\nDTSTAMP:20111107T104757Z\nUID:bb3e7d11-c56f-4c1f-a112-a2e2790b6298\nSUMMARY:xxx\nSTATUS:CONFIRMED\nORGANIZER;CN=xxx:mailto:xxx@mozilla.com\nATTENDEE;RSVP=TRUE;CN=yyy;PARTSTAT=NEEDS-ACTION;ROLE=REQ-PARTICIP\n ANT:mailto:yyy@mozilla.com\nRRULE:FREQ=WEEKLY\nEXDATE:20110922T160000Z\nX-MOZ-LASTACK:20111031T135250Z\nDTSTART;TZID=Europe/Brussels:20110623T180000\nDTEND;TZID=Europe/Brussels:20110623T190000\nCLASS:PUBLIC\nDESCRIPTION:\\n\nX-MOZ-GENERATION:26\nX-MICROSOFT-CDO-INTENDEDSTATUS:BUSY\nTRANSP:OPAQUE\nSEQUENCE:1\nBEGIN:VALARM\nACTION:DISPLAY\nTRIGGER;VALUE=DURATION:-PT5M\nDESCRIPTION:Reminder\nEND:VALARM\nEND:VEVENT\n\n\nError: uncaught exception: [Exception... \"'<error>' when calling method: [calICalendar::modifyItem]\"  nsresult: \"0x804a0002 (<unknown>)\"  location: \"JS frame :: resource://calendar/modules/calUtils.jsm -> file:///C:/Users/xx/AppData/Roaming/Thunderbird/Profiles/hnju2r5c.default/extensions/%7Be2fda1a4-762b-4020-b5ad-a41df1933103%7D/calendar-js/calCachedCalendar.js :: <TOP_LEVEL> :: line 781\"  data: no]", "is_private": false, "id": 5833864, "count": 0, "author": "philipp@bugzilla.kewis.ch", "creator": "philipp@bugzilla.kewis.ch", "time": "2011-11-08T14:01:54Z", "creation_time": "2011-11-08T14:01:54Z"}, {"count": 1, "id": 5834114, "is_private": false, "author": "mohit.kanwal@gmail.com", "creation_time": "2011-11-08T15:32:24Z", "time": "2011-11-08T15:32:24Z", "creator": "mohit.kanwal@gmail.com", "raw_text": "in my view the error message is due to the memory calendar exception in:\n\n> if (!cal.compareItemContent(storedOldItem, aOldItem)) {\n>                return reportError(\"old item mismatch in modifyItem\" + \" storedId:\" + storedOldItem.icalComponent + \" old  item:\" + aOldItem.icalComponent);\n>            }\n\nAlso I found that bug 418805 might be related to this one.\n\nAnd on examining the compareItemContent function in calUtils.js I found that, it ignores revision information like: \"X-MOZ-GENERATION, SEQUENCE, DTSTAMP, LAST-MODIFIED.\", however in the above ical strings, there field \"CREATED:\" is present in the old item while it is not present in the stored old item. That's why the exception is thrown, the then question is, why does the old item (the stored old item in mItems[aOldItem.id]) does not have a created field?", "attachment_id": null, "text": "in my view the error message is due to the memory calendar exception in:\n\n> if (!cal.compareItemContent(storedOldItem, aOldItem)) {\n>                return reportError(\"old item mismatch in modifyItem\" + \" storedId:\" + storedOldItem.icalComponent + \" old  item:\" + aOldItem.icalComponent);\n>            }\n\nAlso I found that bug 418805 might be related to this one.\n\nAnd on examining the compareItemContent function in calUtils.js I found that, it ignores revision information like: \"X-MOZ-GENERATION, SEQUENCE, DTSTAMP, LAST-MODIFIED.\", however in the above ical strings, there field \"CREATED:\" is present in the old item while it is not present in the stored old item. That's why the exception is thrown, the then question is, why does the old item (the stored old item in mItems[aOldItem.id]) does not have a created field?", "bug_id": 700644, "tags": []}, {"is_private": false, "id": 5834120, "count": 2, "author": "mohit.kanwal@gmail.com", "creator": "mohit.kanwal@gmail.com", "creation_time": "2011-11-08T15:34:28Z", "time": "2011-11-08T15:34:28Z", "raw_text": "Commenting out the above code in modifyItem [calMemoryCalendar.js] should solve the issue.", "attachment_id": null, "text": "Commenting out the above code in modifyItem [calMemoryCalendar.js] should solve the issue.", "bug_id": 700644, "tags": []}, {"tags": [], "text": "Yes, that will make the issue no longer show up, but on the other side the generation checks are there for a reason. We don't want to be silently overwriting old items. I can imagine this happens because we don't have access to the real old item, or are updating the item in wierd ways.\n\nLooking at the differences between the items:\n\n--- storedItem\t2011-11-08 17:22:05.000000000 +0100\n+++ oldItem\t2011-11-08 17:22:04.000000000 +0100\n@@ -1,5 +1,7 @@\n BEGIN:VEVENT\n-DTSTAMP:20111031T135250Z\n+DTSTAMP:20111107T104757Z\n+CREATED:20111107T104757Z\n+LAST-MODIFIED:20111107T104757Z\n UID:bb3e7d11-c56f-4c1f-a112-a2e2790b6298\n SUMMARY:xxx\n STATUS:CONFIRMED\n\nIts just a few date objects that changed. We need to figure out when the DTSTAMP and LAST-MODIFIED is changed and see how we could be triggering that in the cache or ics provider.\n\n\nWe could also consider making the ics provider use the offline storage fully and drop that memory cache, but this is very radical :-)", "bug_id": 700644, "attachment_id": null, "raw_text": "Yes, that will make the issue no longer show up, but on the other side the generation checks are there for a reason. We don't want to be silently overwriting old items. I can imagine this happens because we don't have access to the real old item, or are updating the item in wierd ways.\n\nLooking at the differences between the items:\n\n--- storedItem\t2011-11-08 17:22:05.000000000 +0100\n+++ oldItem\t2011-11-08 17:22:04.000000000 +0100\n@@ -1,5 +1,7 @@\n BEGIN:VEVENT\n-DTSTAMP:20111031T135250Z\n+DTSTAMP:20111107T104757Z\n+CREATED:20111107T104757Z\n+LAST-MODIFIED:20111107T104757Z\n UID:bb3e7d11-c56f-4c1f-a112-a2e2790b6298\n SUMMARY:xxx\n STATUS:CONFIRMED\n\nIts just a few date objects that changed. We need to figure out when the DTSTAMP and LAST-MODIFIED is changed and see how we could be triggering that in the cache or ics provider.\n\n\nWe could also consider making the ics provider use the offline storage fully and drop that memory cache, but this is very radical :-)", "creation_time": "2011-11-08T16:24:10Z", "time": "2011-11-08T16:24:10Z", "creator": "philipp@bugzilla.kewis.ch", "author": "philipp@bugzilla.kewis.ch", "count": 3, "id": 5834274, "is_private": false}, {"attachment_id": null, "raw_text": "Marcel just gave a great tip what this might have to do with. The calendar this event was on is a zimbra calendar, and the item in question was likely an invitation. It seems zimbra accepts the event automatically and changes some timestamps. Maybe this is why there are differences. See bug 581943", "bug_id": 700644, "text": "Marcel just gave a great tip what this might have to do with. The calendar this event was on is a zimbra calendar, and the item in question was likely an invitation. It seems zimbra accepts the event automatically and changes some timestamps. Maybe this is why there are differences. See bug 581943", "tags": [], "is_private": false, "count": 4, "id": 5838530, "creator": "philipp@bugzilla.kewis.ch", "time": "2011-11-09T22:32:58Z", "creation_time": "2011-11-09T22:32:58Z", "author": "philipp@bugzilla.kewis.ch"}, {"is_private": false, "id": 5842651, "count": 5, "creator": "ee.ff.rr.oo.gg@gmail.com", "creation_time": "2011-11-11T15:18:23Z", "time": "2011-11-11T15:18:23Z", "author": "ee.ff.rr.oo.gg@gmail.com", "attachment_id": null, "raw_text": "I'm seeing the same issue after upgrading to TB 8 and Lightning 1.0 (Windows 7)\nThis is NOT Zimbra but and ICS calendar on a webdav share  (http://server/webdav/Gemeinsam.ics). The exact same setup used to work before the upgrade.\n\nWarnung: Fehler beim Lesen von Daten f\u00fcr Kalender: Gemeinsam. Er wurde daher in den schreibgesch\u00fctzten Modus gesetzt, da \u00c4nderungen in diesem Kalender wahrscheinlich Datenverlust verursachen. Sie k\u00f6nnen diese Einstellung \u00e4ndern, indem Sie \"Kalender bearbeiten\" w\u00e4hlen. Fehlercode: 0x80004005. Beschreibung: old item mismatch in modifyItem storedId:BEGIN:VEVENT\nCREATED:20091213T092656Z\nLAST-MODIFIED:20111111T150105Z\nDTSTAMP:20111111T150105Z\nUID:4cc402aa-16cd-4182-8d21-94dbe94cfaea\nSUMMARY:Kaffeemaschine sauber machen\nRRULE:FREQ=MONTHLY;BYDAY=2SA\nX-MOZ-LASTACK:20111111T150105Z\nDTSTART;VALUE=DATE:20091212\nDTEND;VALUE=DATE:20091213\nTRANSP:TRANSPARENT\nX-MOZ-GENERATION:922\nSEQUENCE:2\nX-MOZ-SNOOZE-TIME-1319241600000000:20111025T202254Z\nX-MOZ-SNOOZE-TIME-1321056000000000:20111111T160105Z\nBEGIN:VALARM\nACTION:DISPLAY\nTRIGGER;VALUE=DURATION:-P1D\nDESCRIPTION:Mozilla Standardbeschreibung\nEND:VALARM\nEND:VEVENT\n old item:BEGIN:VEVENT\nCREATED:20091213T092656Z\nLAST-MODIFIED:20111111T053810Z\nDTSTAMP:20111111T053810Z\nUID:4cc402aa-16cd-4182-8d21-94dbe94cfaea\nSUMMARY:Kaffeemaschine sauber machen\nRRULE:FREQ=MONTHLY;BYDAY=2SA\nX-MOZ-LASTACK:20111111T053810Z\nDTSTART;VALUE=DATE:20091212\nDTEND;VALUE=DATE:20091213\nTRANSP:TRANSPARENT\nX-MOZ-GENERATION:921\nSEQUENCE:2\nX-MOZ-SNOOZE-TIME-1319241600000000:20111025T202254Z\nX-MOZ-SNOOZE-TIME-1321056000000000:20111111T073810Z\nBEGIN:VALARM\nACTION:DISPLAY\nTRIGGER;VALUE=DURATION:-P1D\nDESCRIPTION:Mozilla Standardbeschreibung\nEND:VALARM\nEND:VEVENT", "text": "I'm seeing the same issue after upgrading to TB 8 and Lightning 1.0 (Windows 7)\nThis is NOT Zimbra but and ICS calendar on a webdav share  (http://server/webdav/Gemeinsam.ics). The exact same setup used to work before the upgrade.\n\nWarnung: Fehler beim Lesen von Daten f\u00fcr Kalender: Gemeinsam. Er wurde daher in den schreibgesch\u00fctzten Modus gesetzt, da \u00c4nderungen in diesem Kalender wahrscheinlich Datenverlust verursachen. Sie k\u00f6nnen diese Einstellung \u00e4ndern, indem Sie \"Kalender bearbeiten\" w\u00e4hlen. Fehlercode: 0x80004005. Beschreibung: old item mismatch in modifyItem storedId:BEGIN:VEVENT\nCREATED:20091213T092656Z\nLAST-MODIFIED:20111111T150105Z\nDTSTAMP:20111111T150105Z\nUID:4cc402aa-16cd-4182-8d21-94dbe94cfaea\nSUMMARY:Kaffeemaschine sauber machen\nRRULE:FREQ=MONTHLY;BYDAY=2SA\nX-MOZ-LASTACK:20111111T150105Z\nDTSTART;VALUE=DATE:20091212\nDTEND;VALUE=DATE:20091213\nTRANSP:TRANSPARENT\nX-MOZ-GENERATION:922\nSEQUENCE:2\nX-MOZ-SNOOZE-TIME-1319241600000000:20111025T202254Z\nX-MOZ-SNOOZE-TIME-1321056000000000:20111111T160105Z\nBEGIN:VALARM\nACTION:DISPLAY\nTRIGGER;VALUE=DURATION:-P1D\nDESCRIPTION:Mozilla Standardbeschreibung\nEND:VALARM\nEND:VEVENT\n old item:BEGIN:VEVENT\nCREATED:20091213T092656Z\nLAST-MODIFIED:20111111T053810Z\nDTSTAMP:20111111T053810Z\nUID:4cc402aa-16cd-4182-8d21-94dbe94cfaea\nSUMMARY:Kaffeemaschine sauber machen\nRRULE:FREQ=MONTHLY;BYDAY=2SA\nX-MOZ-LASTACK:20111111T053810Z\nDTSTART;VALUE=DATE:20091212\nDTEND;VALUE=DATE:20091213\nTRANSP:TRANSPARENT\nX-MOZ-GENERATION:921\nSEQUENCE:2\nX-MOZ-SNOOZE-TIME-1319241600000000:20111025T202254Z\nX-MOZ-SNOOZE-TIME-1321056000000000:20111111T073810Z\nBEGIN:VALARM\nACTION:DISPLAY\nTRIGGER;VALUE=DURATION:-P1D\nDESCRIPTION:Mozilla Standardbeschreibung\nEND:VALARM\nEND:VEVENT", "bug_id": 700644, "tags": []}, {"tags": [], "text": "Another workaround might be to use just the item id's at the alarm service level, and retrieve the actual item again just before we modify it on alarm acknowledgement. I'm not sure what kind of performance hit that would cause, but it could resolve the cases where the items are being modified on the server side.", "bug_id": 700644, "raw_text": "Another workaround might be to use just the item id's at the alarm service level, and retrieve the actual item again just before we modify it on alarm acknowledgement. I'm not sure what kind of performance hit that would cause, but it could resolve the cases where the items are being modified on the server side.", "attachment_id": null, "author": "matthew.mecca@gmail.com", "creator": "matthew.mecca@gmail.com", "time": "2011-11-11T17:30:12Z", "creation_time": "2011-11-11T17:30:12Z", "is_private": false, "id": 5842974, "count": 6}, {"raw_text": "I guess the impact would be negligible. While the alarm dialog is displayed (assuming the user hasn't disabled it) one has a few 100 ms or even seconds before the user closes the dialog one way or the other.", "id": 5844878, "count": 7, "attachment_id": null, "is_private": false, "bug_id": 700644, "text": "I guess the impact would be negligible. While the alarm dialog is displayed (assuming the user hasn't disabled it) one has a few 100 ms or even seconds before the user closes the dialog one way or the other.", "tags": [], "author": "marcel@frightanic.com", "creation_time": "2011-11-12T20:30:51Z", "time": "2011-11-12T20:30:51Z", "creator": "marcel@frightanic.com"}, {"text": "I don't think we should work around this on a dialog level. I think this is rather related to how the cache operates as it was not happening before.", "bug_id": 700644, "tags": [], "author": "philipp@bugzilla.kewis.ch", "time": "2011-11-14T18:27:18Z", "creation_time": "2011-11-14T18:27:18Z", "creator": "philipp@bugzilla.kewis.ch", "raw_text": "I don't think we should work around this on a dialog level. I think this is rather related to how the cache operates as it was not happening before.", "id": 5847118, "count": 8, "is_private": false, "attachment_id": null}, {"is_private": false, "count": 9, "id": 5847286, "creator": "marcel@frightanic.com", "creation_time": "2011-11-14T19:16:55Z", "time": "2011-11-14T19:16:55Z", "author": "marcel@frightanic.com", "attachment_id": null, "raw_text": "(In reply to Philipp Kewisch [:Fallen] from comment #8)\n> I don't think we should work around this on a dialog level.\n\nNeither do I. I meant to say that the proposal in comment 6 probably doesn't have a noticeable performance impact. The proposed strategy might also work to nearly eliminate the issues described in bug 581943.", "tags": [], "text": "(In reply to Philipp Kewisch [:Fallen] from comment #8)\n> I don't think we should work around this on a dialog level.\n\nNeither do I. I meant to say that the proposal in comment 6 probably doesn't have a noticeable performance impact. The proposed strategy might also work to nearly eliminate the issues described in bug 581943.", "bug_id": 700644}, {"attachment_id": null, "raw_text": "I'm seeing this with caching enabled for a davical hosted calendar (read/write access).\n\nDisabling 'offline support' restores functionality.  I ran tcpdump when clicking on the 'dismiss' buttons and got no network activity at all to my davical host over several minutes (and no dialog dismissed except by destroying the window with the window manager's close button - it was reminding me to bring the trash out all week).  With 'offline support' disabled, functionality is restored. \n\n$ rpm -q thunderbird-lightning thunderbird\nthunderbird-lightning-1.9-1.fc17.x86_64\nthunderbird-17.0-1.fc17.x86_64\n\nsetting OS: Mac OS X => All", "tags": [], "text": "I'm seeing this with caching enabled for a davical hosted calendar (read/write access).\n\nDisabling 'offline support' restores functionality.  I ran tcpdump when clicking on the 'dismiss' buttons and got no network activity at all to my davical host over several minutes (and no dialog dismissed except by destroying the window with the window manager's close button - it was reminding me to bring the trash out all week).  With 'offline support' disabled, functionality is restored. \n\n$ rpm -q thunderbird-lightning thunderbird\nthunderbird-lightning-1.9-1.fc17.x86_64\nthunderbird-17.0-1.fc17.x86_64\n\nsetting OS: Mac OS X => All", "bug_id": 700644, "id": 6956114, "count": 10, "is_private": false, "time": "2013-01-02T15:35:49Z", "creation_time": "2013-01-02T15:35:49Z", "creator": "bill+mozilla-bugzilla@bfccomputing.com", "author": "bill+mozilla-bugzilla@bfccomputing.com"}, {"count": 11, "id": 8168765, "is_private": false, "author": "martinlipka@e-napse.com", "time": "2013-12-07T08:31:00Z", "creation_time": "2013-12-07T08:31:00Z", "creator": "martinlipka@e-napse.com", "raw_text": "Hi People,\n\nI'm pretty sure I'm seeing this bug as well with a client who has a copy of mails at home (using thunderbird) and at work (using thunderbird). He also syncs with Ipad and an Android handset.  Yes it is a Zimbra server.\n\nError log diff;\n-LAST-MODIFIED:20131121T072853Z\n+LAST-MODIFIED:20131121T062627Z\n-DTSTAMP:20131121T072853Z\n+DTSTAMP:20131121T062627Z\n-X-MOZ-LASTACK:20131121T072847Z\n+X-MOZ-LASTACK:20131121T062623Z\n-X-MOZ-SNOOZE-TIME:20131121T074347Z\n+X-MOZ-SNOOZE-TIME:20131121T072623Z\n-X-MOZ-GENERATION:4\n+X-MOZ-GENERATION:3\n\nNoting in the code what is ignored (thanks Mohit), this leaves;\n-X-MOZ-LASTACK:20131121T072847Z\n+X-MOZ-LASTACK:20131121T062623Z\n-X-MOZ-SNOOZE-TIME:20131121T074347Z\n+X-MOZ-SNOOZE-TIME:20131121T072623Z\n\nAs the key value pairs that cause the lightning to trip and push the calendar into read only mode.\n\nMy evaluation is that these are about as trivial as possible, in terms of \"data consistency\".\n\nThe simplest solution would be to ignore these as well, however I believe the solution proposed by Matthew in Comment 6 - which can be summarised as \"verify cache consistency prior to write\" is the most robust solution to this issue.\n\nHow can I get this actioned?  I don't want to create special builds of lightning for this client.  Happy to do a bit of coding if that will help.\n\nThanks\n\nMartin", "attachment_id": null, "bug_id": 700644, "text": "Hi People,\n\nI'm pretty sure I'm seeing this bug as well with a client who has a copy of mails at home (using thunderbird) and at work (using thunderbird). He also syncs with Ipad and an Android handset.  Yes it is a Zimbra server.\n\nError log diff;\n-LAST-MODIFIED:20131121T072853Z\n+LAST-MODIFIED:20131121T062627Z\n-DTSTAMP:20131121T072853Z\n+DTSTAMP:20131121T062627Z\n-X-MOZ-LASTACK:20131121T072847Z\n+X-MOZ-LASTACK:20131121T062623Z\n-X-MOZ-SNOOZE-TIME:20131121T074347Z\n+X-MOZ-SNOOZE-TIME:20131121T072623Z\n-X-MOZ-GENERATION:4\n+X-MOZ-GENERATION:3\n\nNoting in the code what is ignored (thanks Mohit), this leaves;\n-X-MOZ-LASTACK:20131121T072847Z\n+X-MOZ-LASTACK:20131121T062623Z\n-X-MOZ-SNOOZE-TIME:20131121T074347Z\n+X-MOZ-SNOOZE-TIME:20131121T072623Z\n\nAs the key value pairs that cause the lightning to trip and push the calendar into read only mode.\n\nMy evaluation is that these are about as trivial as possible, in terms of \"data consistency\".\n\nThe simplest solution would be to ignore these as well, however I believe the solution proposed by Matthew in Comment 6 - which can be summarised as \"verify cache consistency prior to write\" is the most robust solution to this issue.\n\nHow can I get this actioned?  I don't want to create special builds of lightning for this client.  Happy to do a bit of coding if that will help.\n\nThanks\n\nMartin", "tags": []}, {"creator": "philipp@bugzilla.kewis.ch", "time": "2013-12-09T19:43:47Z", "creation_time": "2013-12-09T19:43:47Z", "author": "philipp@bugzilla.kewis.ch", "is_private": false, "count": 12, "id": 8173772, "bug_id": 700644, "text": "Just by reading the comments here it seems that ignoring X-MOZ-LASTACK / SNOOZE-TIME is fine. I'm also happy you are willing to contribute the patch. Do you need anything to get started, or are you good? Feel free to email me if you like.\n\nThe complete solution would probably be to have some sort of conflict manager that can be used from within the providers, that merges some properties trivially and provides the infrastructure to connect some UI that allows the user to decide on item merges. That would require someone (you? ;-) with a fair amount of time and the initiative to make some architecture plans. We can go there in smaller steps though if you like.", "tags": [], "attachment_id": null, "raw_text": "Just by reading the comments here it seems that ignoring X-MOZ-LASTACK / SNOOZE-TIME is fine. I'm also happy you are willing to contribute the patch. Do you need anything to get started, or are you good? Feel free to email me if you like.\n\nThe complete solution would probably be to have some sort of conflict manager that can be used from within the providers, that merges some properties trivially and provides the infrastructure to connect some UI that allows the user to decide on item merges. That would require someone (you? ;-) with a fair amount of time and the initiative to make some architecture plans. We can go there in smaller steps though if you like."}, {"tags": [], "bug_id": 700644, "text": "Hi Martin,\n\nGreat to hear that you want to contribute the patch. The problem lies here: http://mxr.mozilla.org/comm-central/source/calendar/providers/memory/calMemoryCalendar.js#221 essentially some key value pairs might be necessary to ignore. The calUtils function [http://mxr.mozilla.org/comm-central/source/calendar/base/src/calUtils.js#1698] takes in an array of item properties that can be ignored. Perhaps this could be utilized to ignore some of the properties?\n\nAnd as for the second solution, \"verify cache consistency prior to write\" you might need to take a look into modifyItem of calCachedCalendar.js [http://mxr.mozilla.org/comm-central/source/calendar/base/src/calCachedCalendar.js#704] because that's the place from where the various cache based calendar operations are routed. However, the only thing I am concerned is that doing this might end up being hidden from the user's view. I agree with Philipp that we should have \"some sort of conflict manager\" to deal with these sort of issues.\n\nActually, @Philipp there was code that you wrote in case of conflicts to show the user a UI whether to take in the server copy or overwrite the server's version, maybe that can be extended to use in this case?", "raw_text": "Hi Martin,\n\nGreat to hear that you want to contribute the patch. The problem lies here: http://mxr.mozilla.org/comm-central/source/calendar/providers/memory/calMemoryCalendar.js#221 essentially some key value pairs might be necessary to ignore. The calUtils function [http://mxr.mozilla.org/comm-central/source/calendar/base/src/calUtils.js#1698] takes in an array of item properties that can be ignored. Perhaps this could be utilized to ignore some of the properties?\n\nAnd as for the second solution, \"verify cache consistency prior to write\" you might need to take a look into modifyItem of calCachedCalendar.js [http://mxr.mozilla.org/comm-central/source/calendar/base/src/calCachedCalendar.js#704] because that's the place from where the various cache based calendar operations are routed. However, the only thing I am concerned is that doing this might end up being hidden from the user's view. I agree with Philipp that we should have \"some sort of conflict manager\" to deal with these sort of issues.\n\nActually, @Philipp there was code that you wrote in case of conflicts to show the user a UI whether to take in the server copy or overwrite the server's version, maybe that can be extended to use in this case?", "attachment_id": null, "author": "mohit.kanwal@gmail.com", "creator": "mohit.kanwal@gmail.com", "time": "2013-12-10T02:40:13Z", "creation_time": "2013-12-10T02:40:13Z", "is_private": false, "count": 13, "id": 8175735}, {"id": 8184288, "count": 14, "is_private": false, "creation_time": "2013-12-11T19:16:30Z", "time": "2013-12-11T19:16:30Z", "creator": "philipp@bugzilla.kewis.ch", "author": "philipp@bugzilla.kewis.ch", "attachment_id": null, "raw_text": "(In reply to Mohit Kanwal [:redDragon] from comment #13)\n> Actually, @Philipp there was code that you wrote in case of conflicts to\n> show the user a UI whether to take in the server copy or overwrite the\n> server's version, maybe that can be extended to use in this case?\n\nThis is a very simple dialog that just gives you the leave or take choice. A real dialog would have to have some good UI that collects conflicts for multiple items and makes it easy for the user to decide. Thats another bug for itself though. The code I wrote that I think you are referencing just hooked up the cached calendar to that existing dialog, right?", "bug_id": 700644, "text": "(In reply to Mohit Kanwal [:redDragon] from comment #13)\n> Actually, @Philipp there was code that you wrote in case of conflicts to\n> show the user a UI whether to take in the server copy or overwrite the\n> server's version, maybe that can be extended to use in this case?\n\nThis is a very simple dialog that just gives you the leave or take choice. A real dialog would have to have some good UI that collects conflicts for multiple items and makes it easy for the user to decide. Thats another bug for itself though. The code I wrote that I think you are referencing just hooked up the cached calendar to that existing dialog, right?", "tags": []}, {"is_private": false, "count": 15, "id": 8208419, "creator": "martinlipka@e-napse.com", "creation_time": "2013-12-18T00:02:25Z", "time": "2013-12-18T00:02:25Z", "author": "martinlipka@e-napse.com", "attachment_id": null, "raw_text": "Hi People,\n\nThanks for the encouragement and feedback. Is there a primer somewhere on how to submit changes?  I've never done this before.\n\nThanks\n\nMartin", "text": "Hi People,\n\nThanks for the encouragement and feedback. Is there a primer somewhere on how to submit changes?  I've never done this before.\n\nThanks\n\nMartin", "bug_id": 700644, "tags": []}, {"author": "mohit.kanwal@gmail.com", "creation_time": "2013-12-18T04:26:54Z", "time": "2013-12-18T04:26:54Z", "creator": "mohit.kanwal@gmail.com", "count": 16, "id": 8209218, "is_private": false, "tags": [], "text": "(In reply to Philipp Kewisch [:Fallen] from comment #14)\n> This is a very simple dialog that just gives you the leave or take choice. A\n> real dialog would have to have some good UI that collects conflicts for\n> multiple items and makes it easy for the user to decide. Thats another bug\n> for itself though. The code I wrote that I think you are referencing just\n> hooked up the cached calendar to that existing dialog, right?\n\nYes I believe that's right. Only the cached calendar was hooked up.  \n\n(In reply to Martin Lipka from comment #15)\n> Hi People,\n> \n> Thanks for the encouragement and feedback. Is there a primer somewhere on\n> how to submit changes?  I've never done this before.\n> \nYou can start by building calendar source code, replicating the problem and then trying out a fix.\n\nCalendar Build guidelines: https://developer.mozilla.org/en-US/docs/Developer_Guide/Source_Code/Getting_comm-central?redirectlocale=en-US&redirectslug=Comm-central_source_code_%28Mercurial%29\n\nStarting with code: https://wiki.mozilla.org/Calendar:Hacking [perhaps might be out of date?]", "bug_id": 700644, "raw_text": "(In reply to Philipp Kewisch [:Fallen] from comment #14)\n> This is a very simple dialog that just gives you the leave or take choice. A\n> real dialog would have to have some good UI that collects conflicts for\n> multiple items and makes it easy for the user to decide. Thats another bug\n> for itself though. The code I wrote that I think you are referencing just\n> hooked up the cached calendar to that existing dialog, right?\n\nYes I believe that's right. Only the cached calendar was hooked up.  \n\n(In reply to Martin Lipka from comment #15)\n> Hi People,\n> \n> Thanks for the encouragement and feedback. Is there a primer somewhere on\n> how to submit changes?  I've never done this before.\n> \nYou can start by building calendar source code, replicating the problem and then trying out a fix.\n\nCalendar Build guidelines: https://developer.mozilla.org/en-US/docs/Developer_Guide/Source_Code/Getting_comm-central?redirectlocale=en-US&redirectslug=Comm-central_source_code_%28Mercurial%29\n\nStarting with code: https://wiki.mozilla.org/Calendar:Hacking [perhaps might be out of date?]", "attachment_id": null}, {"tags": [], "bug_id": 700644, "text": "This is the most up to date guide: https://developer.mozilla.org/En/Simple_Thunderbird_build", "attachment_id": null, "raw_text": "This is the most up to date guide: https://developer.mozilla.org/En/Simple_Thunderbird_build", "creator": "philipp@bugzilla.kewis.ch", "creation_time": "2013-12-18T09:39:45Z", "time": "2013-12-18T09:39:45Z", "author": "philipp@bugzilla.kewis.ch", "is_private": false, "count": 17, "id": 8209972}]}}}