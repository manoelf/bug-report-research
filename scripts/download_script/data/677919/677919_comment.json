{"bugs": {"677919": {"comments": [{"bug_id": 677919, "id": 5645092, "is_private": false, "count": 0, "tags": [], "attachment_id": 552086, "time": "2011-08-10T15:43:20Z", "author": "kaixiluo@gmail.com", "text": "Created attachment 552086\nScreenshot showing the issue. Rendering inconsistencies have been highlighted.\n\nUser Agent: Mozilla/5.0 (Windows NT 6.1; rv:8.0a1) Gecko/20110809 Firefox/8.0a1\nBuild ID: 20110809030751\n\nSteps to reproduce:\n\nI made a list containing Chinese characters with Workflowy (http://workflowy.com)\n\n\nActual results:\n\nFirefox rendered the Chinese characters inconsistently, i.e. some characters appeared bolder than others, some other characters were fuzzier than the rest.\n\n\nExpected results:\n\nChinese characters should be should rendered in a uniform way.", "creator": "kaixiluo@gmail.com", "raw_text": "User Agent: Mozilla/5.0 (Windows NT 6.1; rv:8.0a1) Gecko/20110809 Firefox/8.0a1\nBuild ID: 20110809030751\n\nSteps to reproduce:\n\nI made a list containing Chinese characters with Workflowy (http://workflowy.com)\n\n\nActual results:\n\nFirefox rendered the Chinese characters inconsistently, i.e. some characters appeared bolder than others, some other characters were fuzzier than the rest.\n\n\nExpected results:\n\nChinese characters should be should rendered in a uniform way.", "creation_time": "2011-08-10T15:43:20Z"}, {"id": 5646876, "tags": [], "count": 1, "is_private": false, "bug_id": 677919, "raw_text": "Kaixi, could you attach HTML file to reproduce this?", "creation_time": "2011-08-11T03:47:55Z", "time": "2011-08-11T03:47:55Z", "attachment_id": null, "text": "Kaixi, could you attach HTML file to reproduce this?", "author": "m_kato@ga2.so-net.ne.jp", "creator": "m_kato@ga2.so-net.ne.jp"}, {"attachment_id": null, "time": "2011-08-11T07:10:43Z", "text": "I've been able to pinpoint the problem I think. When a web page doesn't specify a Chinese font in their CSS rules, Firefox will attempt to render the page with 2 different fallback fonts, Simsun (which is the default Simplified Chinese font in Firefox) and MS PGothic.\n\nIn all those cases, Firefox should only use Simsun.", "creation_time": "2011-08-11T07:10:43Z", "raw_text": "I've been able to pinpoint the problem I think. When a web page doesn't specify a Chinese font in their CSS rules, Firefox will attempt to render the page with 2 different fallback fonts, Simsun (which is the default Simplified Chinese font in Firefox) and MS PGothic.\n\nIn all those cases, Firefox should only use Simsun.", "bug_id": 677919, "id": 5647060, "tags": [], "is_private": false, "count": 2, "author": "kaixiluo@gmail.com", "creator": "kaixiluo@gmail.com"}, {"author": "kaixiluo@gmail.com", "creator": "kaixiluo@gmail.com", "time": "2011-08-11T07:14:29Z", "attachment_id": null, "text": "I can consistenly reproduce this with a static HTML file that meet the above conditions.", "raw_text": "I can consistenly reproduce this with a static HTML file that meet the above conditions.", "creation_time": "2011-08-11T07:14:29Z", "bug_id": 677919, "id": 5647062, "is_private": false, "count": 3, "tags": []}, {"author": "kaixiluo@gmail.com", "creator": "kaixiluo@gmail.com", "time": "2011-08-11T07:16:58Z", "attachment_id": 552320, "text": "Created attachment 552320\ntestcase1\n\nHTML file demonstrating the problem. I used the Fontinfo addon to find out the fonts used by Firefox to render the page.", "raw_text": "HTML file demonstrating the problem. I used the Fontinfo addon to find out the fonts used by Firefox to render the page.", "creation_time": "2011-08-11T07:16:58Z", "bug_id": 677919, "id": 5647065, "is_private": false, "count": 4, "tags": []}, {"text": "Created attachment 552322\nWorkaround for web developers\n\nA workaround for web developers is to put a Latin font first and then a Chinese font in their CSS file, i.e. font-family: Arial, Simsun;", "time": "2011-08-11T07:28:47Z", "attachment_id": 552322, "creation_time": "2011-08-11T07:28:47Z", "raw_text": "A workaround for web developers is to put a Latin font first and then a Chinese font in their CSS file, i.e. font-family: Arial, Simsun;", "bug_id": 677919, "is_private": false, "count": 5, "tags": [], "id": 5647075, "creator": "kaixiluo@gmail.com", "author": "kaixiluo@gmail.com"}, {"creator": "bugz-moz@lapage.com", "author": "bugz-moz@lapage.com", "raw_text": "Can you post screenshots from the two test cases?\n\nI don't see any bold characters, but I am on WinXP. Nightly, fresh profile. Fontinfo addon says it is using Arial and SimSun only. Also tested \"Namoroka/3.6.21pre\" and \"Firefox/6.0 SeaMonkey/2.3\" and saw no bold.", "creation_time": "2011-08-11T11:17:00Z", "text": "Can you post screenshots from the two test cases?\n\nI don't see any bold characters, but I am on WinXP. Nightly, fresh profile. Fontinfo addon says it is using Arial and SimSun only. Also tested \"Namoroka/3.6.21pre\" and \"Firefox/6.0 SeaMonkey/2.3\" and saw no bold.", "attachment_id": null, "time": "2011-08-11T11:17:00Z", "tags": [], "is_private": false, "count": 6, "id": 5647213, "bug_id": 677919}, {"id": 5647326, "is_private": false, "count": 7, "tags": [], "bug_id": 677919, "raw_text": "Here's the screenshot of testcase1.", "creation_time": "2011-08-11T12:42:44Z", "attachment_id": 552345, "time": "2011-08-11T12:42:44Z", "text": "Created attachment 552345\ntestcase1 screenshot\n\nHere's the screenshot of testcase1.", "author": "kaixiluo@gmail.com", "creator": "kaixiluo@gmail.com"}, {"bug_id": 677919, "is_private": false, "count": 8, "tags": [], "id": 5647330, "text": "Created attachment 552346\ntestcase2 screenshot\n\nHere's the screenshot of what the page looks like after I change \n\nbody { font-family: Arial; } \n\nto \n\nbody { font-family: Arial, Simsum; }", "creator": "kaixiluo@gmail.com", "time": "2011-08-11T12:46:34Z", "attachment_id": 552346, "author": "kaixiluo@gmail.com", "raw_text": "Here's the screenshot of what the page looks like after I change \n\nbody { font-family: Arial; } \n\nto \n\nbody { font-family: Arial, Simsum; }", "creation_time": "2011-08-11T12:46:34Z"}, {"creator": "kaixiluo@gmail.com", "author": "kaixiluo@gmail.com", "text": "btw, I am on Windows 7 Professional (English Edition). And neither Chrome nor IE9 have any problems rendering Chinese characters.", "attachment_id": null, "time": "2011-08-11T12:50:01Z", "raw_text": "btw, I am on Windows 7 Professional (English Edition). And neither Chrome nor IE9 have any problems rendering Chinese characters.", "creation_time": "2011-08-11T12:50:01Z", "bug_id": 677919, "tags": [], "is_private": false, "count": 9, "id": 5647333}, {"bug_id": 677919, "id": 5647345, "tags": [], "is_private": false, "count": 10, "time": "2011-08-11T12:56:48Z", "attachment_id": null, "text": "I just tested everything with a fresh profile on the latest Nightly 32-bit build and the problem is still the same.", "creation_time": "2011-08-11T12:56:48Z", "raw_text": "I just tested everything with a fresh profile on the latest Nightly 32-bit build and the problem is still the same.", "author": "kaixiluo@gmail.com", "creator": "kaixiluo@gmail.com"}, {"creator": "bugz-moz@lapage.com", "author": "bugz-moz@lapage.com", "bug_id": 677919, "count": 11, "is_private": false, "tags": [], "id": 5647368, "text": "I do not have the font \"MS PGothic\" on my U.S. WinXP so that is why I do not see the bug.\n\nMicrosoft says:\n\nProducts that supply this font\nOffice Mac 2008\t5.02\nWindows 7\t5.01\nWindows Server 2008\t5.00\nWindows Vista\t5.00\n\nhttp://www.microsoft.com/typography/fonts/font.aspx?FMID=1271", "time": "2011-08-11T13:14:31Z", "attachment_id": null, "creation_time": "2011-08-11T13:14:31Z", "raw_text": "I do not have the font \"MS PGothic\" on my U.S. WinXP so that is why I do not see the bug.\n\nMicrosoft says:\n\nProducts that supply this font\nOffice Mac 2008\t5.02\nWindows 7\t5.01\nWindows Server 2008\t5.00\nWindows Vista\t5.00\n\nhttp://www.microsoft.com/typography/fonts/font.aspx?FMID=1271"}, {"creator": "kaixiluo@gmail.com", "author": "kaixiluo@gmail.com", "text": "(In reply to kitchin from comment #11)\n> I do not have the font \"MS PGothic\" on my U.S. WinXP so that is why I do not\n> see the bug.\n\nI've uploaded the MS PGothic font file to my Dropbox account. Could you download the font, install it on your system and test again?\n\nhttp://dl.dropbox.com/u/1829895/msgothic.ttc", "attachment_id": null, "time": "2011-08-11T16:38:28Z", "raw_text": "(In reply to kitchin from comment #11)\n> I do not have the font \"MS PGothic\" on my U.S. WinXP so that is why I do not\n> see the bug.\n\nI've uploaded the MS PGothic font file to my Dropbox account. Could you download the font, install it on your system and test again?\n\nhttp://dl.dropbox.com/u/1829895/msgothic.ttc", "creation_time": "2011-08-11T16:38:28Z", "bug_id": 677919, "is_private": false, "count": 12, "tags": [], "id": 5647783}, {"attachment_id": null, "time": "2011-08-11T22:19:03Z", "author": "bugz-moz@lapage.com", "text": "Confirming bug. After I installed the \"MS PGothic\" font to WinXp, the test page is displayed in a mixture of \"MS PGothic\" and \"SimSun\", resulting in some bold-looking characters, as in the screenshot. Is it due to the fact that Japanese uses a subset of Chinese characters? I think \"MS PGothic\" is a Japanese font.\n\nBug:\nFirefox Nightly\nSeamonkey 2.3 Beta (Firefox/6.0 SeaMonkey/2.3)\nNamoroka/3.6.21pre\n\nNo bug:\nIE8, latest release\nChrome, latest release\nOpera, latest release", "creator": "bugz-moz@lapage.com", "creation_time": "2011-08-11T22:19:03Z", "raw_text": "Confirming bug. After I installed the \"MS PGothic\" font to WinXp, the test page is displayed in a mixture of \"MS PGothic\" and \"SimSun\", resulting in some bold-looking characters, as in the screenshot. Is it due to the fact that Japanese uses a subset of Chinese characters? I think \"MS PGothic\" is a Japanese font.\n\nBug:\nFirefox Nightly\nSeamonkey 2.3 Beta (Firefox/6.0 SeaMonkey/2.3)\nNamoroka/3.6.21pre\n\nNo bug:\nIE8, latest release\nChrome, latest release\nOpera, latest release", "bug_id": 677919, "id": 5648794, "count": 13, "is_private": false, "tags": []}, {"creation_time": "2011-08-11T22:45:35Z", "raw_text": "The test page has no indication of language; hence Firefox can't tell whether to default to the Japanese or Chinese (which locale?) fonts from preferences (for the CJK characters not supported by Arial, the font actually specified by the page). In my testing (on a US English system), it appears to give priority to the Japanese font prefs; but then if there are specific characters not supported in the default Japanese font (MS PGothic), it falls back to the Chinese one (SimSun).\n\nThis prioritization should depend on the browser's Accept-Languages settings, and on the user's system locale. If Chinese is given priority in Accept-Languages, for example, I think this should resolve the problem. (You need to restart the browser after adding to the list of \"preferred languages\" in Tools/Options/Content.)\n\nAlso, if you add a language tag such as  lang=\"zh\" to the <body> element, the CJK characters all render with SimSun, as this provides the hint needed to tell the browser which font preference to use.\n\nIt's not clear to me how Firefox should be expected to guess the \"best\" font to use when no appropriate style or language information is available, however.", "text": "The test page has no indication of language; hence Firefox can't tell whether to default to the Japanese or Chinese (which locale?) fonts from preferences (for the CJK characters not supported by Arial, the font actually specified by the page). In my testing (on a US English system), it appears to give priority to the Japanese font prefs; but then if there are specific characters not supported in the default Japanese font (MS PGothic), it falls back to the Chinese one (SimSun).\n\nThis prioritization should depend on the browser's Accept-Languages settings, and on the user's system locale. If Chinese is given priority in Accept-Languages, for example, I think this should resolve the problem. (You need to restart the browser after adding to the list of \"preferred languages\" in Tools/Options/Content.)\n\nAlso, if you add a language tag such as  lang=\"zh\" to the <body> element, the CJK characters all render with SimSun, as this provides the hint needed to tell the browser which font preference to use.\n\nIt's not clear to me how Firefox should be expected to guess the \"best\" font to use when no appropriate style or language information is available, however.", "attachment_id": null, "time": "2011-08-11T22:45:35Z", "is_private": false, "count": 14, "tags": [], "id": 5648863, "bug_id": 677919, "creator": "jfkthame@gmail.com", "author": "jfkthame@gmail.com"}, {"count": 15, "is_private": false, "tags": [], "id": 5648905, "bug_id": 677919, "creation_time": "2011-08-11T22:57:45Z", "raw_text": "Thanks for the explanation. I deliberately left out any language tags in the test cases. Why can't Firefox guess the best font to use if both Chrome and IE can?", "text": "Thanks for the explanation. I deliberately left out any language tags in the test cases. Why can't Firefox guess the best font to use if both Chrome and IE can?", "time": "2011-08-11T22:57:45Z", "attachment_id": null, "creator": "kaixiluo@gmail.com", "author": "kaixiluo@gmail.com"}, {"id": 5649259, "tags": [], "count": 16, "is_private": false, "bug_id": 677919, "creation_time": "2011-08-12T03:01:26Z", "raw_text": "Bisecting, Firefox 1.0 also has this bug.\n\nAlso, if I paste the MS PGothic text from Firefox Nightly to WordPad, it is converted to this:\nFont [SimSun] Font Size [10] Font Script [Chinese_GB2312]\n\nIf I highlight the text in WordPad and try to change it to \"MS PGothic,\" I cannot, unless I first change Font Script to \"Western\":\nFont [MS PGothic] Font Size [10] Font Script [Western]\n\nThe fact that Opera, Chrome and IE agree with each other makes me think the WinAPI is being used differently. Perhaps alpha order plays a role, rightly or wrongly.\n\nThe alternative is that Opera, Chrome and IE are all using heuristics, to survey the characters. To test that, we need a test case with only the bold characters. Certainly Chrome uses heuristics for some purposes, because it offers to translate the document from Chinese (Simplified Han) to English!", "time": "2011-08-12T03:01:26Z", "attachment_id": null, "text": "Bisecting, Firefox 1.0 also has this bug.\n\nAlso, if I paste the MS PGothic text from Firefox Nightly to WordPad, it is converted to this:\nFont [SimSun] Font Size [10] Font Script [Chinese_GB2312]\n\nIf I highlight the text in WordPad and try to change it to \"MS PGothic,\" I cannot, unless I first change Font Script to \"Western\":\nFont [MS PGothic] Font Size [10] Font Script [Western]\n\nThe fact that Opera, Chrome and IE agree with each other makes me think the WinAPI is being used differently. Perhaps alpha order plays a role, rightly or wrongly.\n\nThe alternative is that Opera, Chrome and IE are all using heuristics, to survey the characters. To test that, we need a test case with only the bold characters. Certainly Chrome uses heuristics for some purposes, because it offers to translate the document from Chinese (Simplified Han) to English!", "author": "bugz-moz@lapage.com", "creator": "bugz-moz@lapage.com"}, {"attachment_id": null, "time": "2011-08-12T03:25:21Z", "text": "See also:\nBug 543200 font fallback should try to use the same font for a complete character cluster or word", "raw_text": "See also:\nBug 543200 font fallback should try to use the same font for a complete character cluster or word", "creation_time": "2011-08-12T03:25:21Z", "bug_id": 677919, "id": 5649285, "tags": [], "count": 17, "is_private": false, "author": "bugz-moz@lapage.com", "creator": "bugz-moz@lapage.com"}, {"author": "kaixiluo@gmail.com", "time": "2011-08-12T07:12:14Z", "attachment_id": null, "creator": "kaixiluo@gmail.com", "text": "(In reply to Jonathan Kew from comment #14) \n> This prioritization should depend on the browser's Accept-Languages\n> settings, and on the user's system locale. If Chinese is given priority in\n> Accept-Languages, for example, I think this should resolve the problem. (You\n> need to restart the browser after adding to the list of \"preferred\n> languages\" in Tools/Options/Content.)\n> \n> Also, if you add a language tag such as  lang=\"zh\" to the <body> element,\n> the CJK characters all render with SimSun, as this provides the hint needed\n> to tell the browser which font preference to use.\n\nAdding the language tag definitely makes Firefox render everything with SimSun but adding Chinese in Preferred Languages doesn't resolve the problem.", "raw_text": "(In reply to Jonathan Kew from comment #14) \n> This prioritization should depend on the browser's Accept-Languages\n> settings, and on the user's system locale. If Chinese is given priority in\n> Accept-Languages, for example, I think this should resolve the problem. (You\n> need to restart the browser after adding to the list of \"preferred\n> languages\" in Tools/Options/Content.)\n> \n> Also, if you add a language tag such as  lang=\"zh\" to the <body> element,\n> the CJK characters all render with SimSun, as this provides the hint needed\n> to tell the browser which font preference to use.\n\nAdding the language tag definitely makes Firefox render everything with SimSun but adding Chinese in Preferred Languages doesn't resolve the problem.", "creation_time": "2011-08-12T07:12:14Z", "bug_id": 677919, "id": 5649508, "tags": [], "is_private": false, "count": 18}, {"raw_text": "This is yet another testcase, which is an article from today's news on Xinhuanet (http://news.xinhuanet.com/photo/2011-08/12/c_121848818.htm). I copied the contents of the article to an html file which doesn't has any lang tag or css rule for Chinese characters. \n\nHere Firefox uses 3 fallback fonts to render Chinese characters, Gulim, Simsun and MS PGothic.", "creation_time": "2011-08-12T07:50:31Z", "time": "2011-08-12T07:50:31Z", "attachment_id": 552615, "text": "Created attachment 552615\ntestcase3 - an article from Xinhuanet\n\nThis is yet another testcase, which is an article from today's news on Xinhuanet (http://news.xinhuanet.com/photo/2011-08/12/c_121848818.htm). I copied the contents of the article to an html file which doesn't has any lang tag or css rule for Chinese characters. \n\nHere Firefox uses 3 fallback fonts to render Chinese characters, Gulim, Simsun and MS PGothic.", "id": 5649535, "tags": [], "is_private": false, "count": 19, "bug_id": 677919, "author": "kaixiluo@gmail.com", "creator": "kaixiluo@gmail.com"}, {"text": "confirmed on\nMozilla/5.0 (Windows NT 6.1; Win64; x64; rv:8.0a1) Gecko/20110812 Firefox/8.0a1", "attachment_id": null, "time": "2011-08-12T10:25:03Z", "raw_text": "confirmed on\nMozilla/5.0 (Windows NT 6.1; Win64; x64; rv:8.0a1) Gecko/20110812 Firefox/8.0a1", "creation_time": "2011-08-12T10:25:03Z", "bug_id": 677919, "tags": [], "is_private": false, "count": 20, "id": 5649628, "creator": "Virtual@teknik.io", "author": "Virtual@teknik.io"}, {"bug_id": 677919, "id": 5683650, "count": 21, "is_private": false, "tags": [], "attachment_id": null, "time": "2011-08-28T18:47:12Z", "text": "I see a different scenario.\n\nMozilla/5.0 (Windows NT 6.1; WOW64; rv:9.0a1) Gecko/20110828 Firefox/9.0a1\n\nIn a new profile, extension Fontinfo is showing that testcase1 (sans workaround) and testcase3 are using only Arial (for English characters and numbers) and MingLiu_HKSCS (for Chinese characters, Traditional or simplified) on my machine. No Gulim, Simsun or MS PGothic are involved. I had all these fonts installed.\nOn the page in xinhuanet, my Nightly is using Mingliu_HKSCS and Arial on the first 3 paragraphs, and Simsun only for the remaining paragraphs.\n\n\nMy Windows 7 Sp1 English version settings FWIW:\nRegion and Language-\nFormat: Chinese (Traditional, Hong Kong S.A.R.)\nLocation: Hong Kong S.A.R.\nLanguage for non-Unicode programs: Chinese (Traditional, Hong Kong S.A.R.)\n\nAlso My Nightly's chrome's font follows the setting of \"Fonts for Traditional Chinese (Hong Kong)\" in Options > Content > Font, which may differ from you guys.", "creation_time": "2011-08-28T18:47:12Z", "raw_text": "I see a different scenario.\n\nMozilla/5.0 (Windows NT 6.1; WOW64; rv:9.0a1) Gecko/20110828 Firefox/9.0a1\n\nIn a new profile, extension Fontinfo is showing that testcase1 (sans workaround) and testcase3 are using only Arial (for English characters and numbers) and MingLiu_HKSCS (for Chinese characters, Traditional or simplified) on my machine. No Gulim, Simsun or MS PGothic are involved. I had all these fonts installed.\nOn the page in xinhuanet, my Nightly is using Mingliu_HKSCS and Arial on the first 3 paragraphs, and Simsun only for the remaining paragraphs.\n\n\nMy Windows 7 Sp1 English version settings FWIW:\nRegion and Language-\nFormat: Chinese (Traditional, Hong Kong S.A.R.)\nLocation: Hong Kong S.A.R.\nLanguage for non-Unicode programs: Chinese (Traditional, Hong Kong S.A.R.)\n\nAlso My Nightly's chrome's font follows the setting of \"Fonts for Traditional Chinese (Hong Kong)\" in Options > Content > Font, which may differ from you guys.", "author": "Fanolian+BMO@gmail.com", "creator": "Fanolian+BMO@gmail.com"}, {"author": "goldyn.chyld9@gmail.com", "creator": "goldyn.chyld9@gmail.com", "id": 6075826, "count": 22, "is_private": false, "tags": [], "bug_id": 677919, "creation_time": "2012-02-20T09:46:10Z", "raw_text": "", "time": "2012-02-20T09:46:10Z", "attachment_id": 598799, "text": "Created attachment 598799\nanother example of ugly character rendering"}, {"time": "2012-02-20T09:46:46Z", "attachment_id": 598799, "text": "Comment on attachment 598799\nanother example of ugly character rendering\n\nI have found this inconsistent rendering of Chinese characters frustrating for quite some time now. Finally I decided to register here, on Bugzilla in hoping you could fix this.\n\nWhy can Chrome or Safari display them perfectly, yet Firefox keeps having issues? (Mac user here.)\n\nI believe the default rendering font for Chinese characters should be Heiti SC - I've altered my Firefox' userChrome.css to make the browser use this font when displaying Chinese characters in the tabs (since Chinese characters look uneven, ugly in tabs too, by default), and it works like a charm.\n\nHere's what I use in the userChrome.css (through Stylish):\n\n{font-family: \"Lucida Grande\", \"Heiti SC\" !important;}\n\n\nI wish something like this could be done for text rendering on websites, too. Please, do something about it!", "raw_text": "I have found this inconsistent rendering of Chinese characters frustrating for quite some time now. Finally I decided to register here, on Bugzilla in hoping you could fix this.\n\nWhy can Chrome or Safari display them perfectly, yet Firefox keeps having issues? (Mac user here.)\n\nI believe the default rendering font for Chinese characters should be Heiti SC - I've altered my Firefox' userChrome.css to make the browser use this font when displaying Chinese characters in the tabs (since Chinese characters look uneven, ugly in tabs too, by default), and it works like a charm.\n\nHere's what I use in the userChrome.css (through Stylish):\n\n{font-family: \"Lucida Grande\", \"Heiti SC\" !important;}\n\n\nI wish something like this could be done for text rendering on websites, too. Please, do something about it!", "creation_time": "2012-02-20T09:46:46Z", "bug_id": 677919, "id": 6075827, "tags": [], "count": 23, "is_private": false, "author": "goldyn.chyld9@gmail.com", "creator": "goldyn.chyld9@gmail.com"}, {"bug_id": 677919, "is_private": false, "count": 24, "tags": [], "id": 6077598, "text": "(In reply to Jonathan Kew (:jfkthame) from comment #14)\n\n> It's not clear to me how Firefox should be expected to guess the \"best\" font\n> to use when no appropriate style or language information is available,\n> however.\n\nCan we do what Safari and or IE does in the same situation?", "attachment_id": null, "time": "2012-02-21T02:50:30Z", "creation_time": "2012-02-21T02:50:30Z", "raw_text": "(In reply to Jonathan Kew (:jfkthame) from comment #14)\n\n> It's not clear to me how Firefox should be expected to guess the \"best\" font\n> to use when no appropriate style or language information is available,\n> however.\n\nCan we do what Safari and or IE does in the same situation?", "creator": "gen@mozilla.com", "author": "gen@mozilla.com"}, {"raw_text": "(In reply to Kaixi Luo from comment #15)\n> Thanks for the explanation. I deliberately left out any language tags in the\n> test cases. Why can't Firefox guess the best font to use if both Chrome and\n> IE can?\nBecause it is not the \"best\" for Japanese text. We, Japanese users, sometimes suffered from ugly rendering of IE and Chrome. There's no solution everybody can be comfortable because of Han Unification. It's the reason authors should specify the language explicitly.\n\n(In reply to Gen Kanai [:gen] from comment #24)\n> Can we do what Safari and or IE does in the same situation?\nThings are not so easy.", "creation_time": "2012-02-21T05:36:07Z", "time": "2012-02-21T05:36:07Z", "attachment_id": null, "text": "(In reply to Kaixi Luo from comment #15)\n> Thanks for the explanation. I deliberately left out any language tags in the\n> test cases. Why can't Firefox guess the best font to use if both Chrome and\n> IE can?\nBecause it is not the \"best\" for Japanese text. We, Japanese users, sometimes suffered from ugly rendering of IE and Chrome. There's no solution everybody can be comfortable because of Han Unification. It's the reason authors should specify the language explicitly.\n\n(In reply to Gen Kanai [:gen] from comment #24)\n> Can we do what Safari and or IE does in the same situation?\nThings are not so easy.", "id": 6077759, "tags": [], "is_private": false, "count": 25, "bug_id": 677919, "author": "VYV03354@nifty.ne.jp", "creator": "VYV03354@nifty.ne.jp"}, {"author": "masayuki@d-toybox.com", "creator": "masayuki@d-toybox.com", "raw_text": "(In reply to Masatoshi Kimura [:emk] from comment #25)\n> (In reply to Gen Kanai [:gen] from comment #24)\n> > Can we do what Safari and or IE does in the same situation?\n> Things are not so easy.\n\nYeah. As jfkthame said in comment 14, we're using Accept-Language pref values for deciding the priority between CJKT languages. Normally, users must download their language's localized build or customize Accept-Language pref if they don't use the localized build. If so, the list gives priority for the language. I guess that you're using English Nightly build on non-CJKT Windows and you have never customized the Accept-Language list. If so, we try Japanese, Korean, Chinese Simplified, Chinese HK, Chinese Taiwan by this order.\nhttp://mxr.mozilla.org/mozilla-central/source/gfx/thebes/gfxPlatform.cpp#1014", "creation_time": "2012-02-21T06:22:19Z", "time": "2012-02-21T06:22:19Z", "attachment_id": null, "text": "(In reply to Masatoshi Kimura [:emk] from comment #25)\n> (In reply to Gen Kanai [:gen] from comment #24)\n> > Can we do what Safari and or IE does in the same situation?\n> Things are not so easy.\n\nYeah. As jfkthame said in comment 14, we're using Accept-Language pref values for deciding the priority between CJKT languages. Normally, users must download their language's localized build or customize Accept-Language pref if they don't use the localized build. If so, the list gives priority for the language. I guess that you're using English Nightly build on non-CJKT Windows and you have never customized the Accept-Language list. If so, we try Japanese, Korean, Chinese Simplified, Chinese HK, Chinese Taiwan by this order.\nhttp://mxr.mozilla.org/mozilla-central/source/gfx/thebes/gfxPlatform.cpp#1014", "id": 6077804, "tags": [], "is_private": false, "count": 26, "bug_id": 677919}, {"attachment_id": null, "time": "2012-02-21T08:29:42Z", "text": "(In reply to Masayuki Nakano (:masayuki) (Mozilla Japan) from comment #26)\n> I guess that you're using English Nightly build on\n> non-CJKT Windows and you have never customized the Accept-Language list.\nPer comment #18, Accept-Language settings do not have an effect (and I confirmed).\nOur fallback order selection may have a bug.", "creation_time": "2012-02-21T08:29:42Z", "raw_text": "(In reply to Masayuki Nakano (:masayuki) (Mozilla Japan) from comment #26)\n> I guess that you're using English Nightly build on\n> non-CJKT Windows and you have never customized the Accept-Language list.\nPer comment #18, Accept-Language settings do not have an effect (and I confirmed).\nOur fallback order selection may have a bug.", "bug_id": 677919, "id": 6077917, "count": 27, "is_private": false, "tags": [], "author": "VYV03354@nifty.ne.jp", "creator": "VYV03354@nifty.ne.jp"}, {"author": "VYV03354@nifty.ne.jp", "creator": "VYV03354@nifty.ne.jp", "time": "2012-02-21T14:03:03Z", "attachment_id": null, "text": "I found [Regional and Language Options] > [Formats] virtually took over the settings from Accept-Languages. Is this intentional?\nEven if it's deliberate, I'm not sure it's correct to obtain the default language from the [Format] settings for the purpose of font selection. Using [Language for non-Unicode programs] would be more appropriate (and what other browsers did).", "creation_time": "2012-02-21T14:03:03Z", "raw_text": "I found [Regional and Language Options] > [Formats] virtually took over the settings from Accept-Languages. Is this intentional?\nEven if it's deliberate, I'm not sure it's correct to obtain the default language from the [Format] settings for the purpose of font selection. Using [Language for non-Unicode programs] would be more appropriate (and what other browsers did).", "bug_id": 677919, "id": 6078381, "tags": [], "is_private": false, "count": 28}, {"author": "VYV03354@nifty.ne.jp", "creator": "VYV03354@nifty.ne.jp", "id": 6078464, "tags": [], "count": 29, "is_private": false, "bug_id": 677919, "raw_text": "If the font-family property does not list a generic family, it would be appended. The appended family would be taken from the \"font.name.variable.<language>\" pref.\nhttp://hg.mozilla.org/mozilla-central/file/8822243a8d6c/layout/style/nsRuleNode.cpp#l2749\nnsStyleFont::Init would call nsPresContext::GetLanguageFromCharset() to get the language if the language is not specified on the Web page explicitly.\nhttp://hg.mozilla.org/mozilla-central/file/8822243a8d6c/layout/style/nsStyleStruct.cpp#l158\nnsPresContext would get the mLanguage from nsLanguageAtomService::GetLocaleLanguage().\nhttp://hg.mozilla.org/mozilla-central/file/8822243a8d6c/layout/base/nsPresContext.cpp#l1129\nnsLanguageAtomService::GetLocaleLanguage() would call nsLocaleService::GetApplicationLocale().\nhttp://hg.mozilla.org/mozilla-central/file/8822243a8d6c/intl/locale/src/nsLanguageAtomService.cpp#l113\nOn Windows, nsLocaleService would get the application locale from GetUserDefaultLCID() which corresponds to [Formats] settings.\nhttp://hg.mozilla.org/mozilla-central/file/8822243a8d6c/intl/locale/src/nsLocaleService.cpp#l150", "creation_time": "2012-02-21T14:28:30Z", "attachment_id": null, "time": "2012-02-21T14:28:30Z", "text": "If the font-family property does not list a generic family, it would be appended. The appended family would be taken from the \"font.name.variable.<language>\" pref.\nhttp://hg.mozilla.org/mozilla-central/file/8822243a8d6c/layout/style/nsRuleNode.cpp#l2749\nnsStyleFont::Init would call nsPresContext::GetLanguageFromCharset() to get the language if the language is not specified on the Web page explicitly.\nhttp://hg.mozilla.org/mozilla-central/file/8822243a8d6c/layout/style/nsStyleStruct.cpp#l158\nnsPresContext would get the mLanguage from nsLanguageAtomService::GetLocaleLanguage().\nhttp://hg.mozilla.org/mozilla-central/file/8822243a8d6c/layout/base/nsPresContext.cpp#l1129\nnsLanguageAtomService::GetLocaleLanguage() would call nsLocaleService::GetApplicationLocale().\nhttp://hg.mozilla.org/mozilla-central/file/8822243a8d6c/intl/locale/src/nsLanguageAtomService.cpp#l113\nOn Windows, nsLocaleService would get the application locale from GetUserDefaultLCID() which corresponds to [Formats] settings.\nhttp://hg.mozilla.org/mozilla-central/file/8822243a8d6c/intl/locale/src/nsLocaleService.cpp#l150"}, {"author": "VYV03354@nifty.ne.jp", "creator": "VYV03354@nifty.ne.jp", "id": 6078519, "tags": [], "count": 30, "is_private": false, "bug_id": 677919, "creation_time": "2012-02-21T14:52:05Z", "raw_text": "If the application locale is not CJK, \"font.name.*.<lang>\" and \"font.name-list.*.<lang>\" do not contain the CJK fonts, hence expanded generic family also do not.\nSo Accept-Language settings would have an effect.\nIf the application locale is Japanese, \"MS PGothic\" would have precedence over \"SimSun\" regardless of Accept-Language settings because \"font.name.*.ja\" contain the former.\nIf the application locale is Chinese, \"SimSun\" would have precedence regardless of Accept-Language settings.", "attachment_id": null, "time": "2012-02-21T14:52:05Z", "text": "If the application locale is not CJK, \"font.name.*.<lang>\" and \"font.name-list.*.<lang>\" do not contain the CJK fonts, hence expanded generic family also do not.\nSo Accept-Language settings would have an effect.\nIf the application locale is Japanese, \"MS PGothic\" would have precedence over \"SimSun\" regardless of Accept-Language settings because \"font.name.*.ja\" contain the former.\nIf the application locale is Chinese, \"SimSun\" would have precedence regardless of Accept-Language settings."}, {"tags": [], "count": 31, "is_private": false, "id": 6081658, "bug_id": 677919, "creation_time": "2012-02-22T08:30:10Z", "raw_text": "Guys, is there a way Firefox could utilize Heiti SC font to display Chinese characters? This font seems to work best, at least for the Chinese characters in tabs...", "text": "Guys, is there a way Firefox could utilize Heiti SC font to display Chinese characters? This font seems to work best, at least for the Chinese characters in tabs...", "time": "2012-02-22T08:30:10Z", "attachment_id": null, "creator": "goldyn.chyld9@gmail.com", "author": "goldyn.chyld9@gmail.com"}, {"author": "VYV03354@nifty.ne.jp", "creator": "VYV03354@nifty.ne.jp", "time": "2012-02-22T10:41:11Z", "attachment_id": null, "text": "(In reply to goldyn chyld from comment #31)\n> Guys, is there a way Firefox could utilize Heiti SC font to display Chinese\n> characters? This font seems to work best, at least for the Chinese\n> characters in tabs...\nPlease do one of the following:\n- Set the system locale to Chinese (But I don't know how to change the system locale on Mac OS X).\n- If the system locale is non-CJK and you do not want change it, add Chinese to \"preferred languages\" preference of Firefox.", "raw_text": "(In reply to goldyn chyld from comment #31)\n> Guys, is there a way Firefox could utilize Heiti SC font to display Chinese\n> characters? This font seems to work best, at least for the Chinese\n> characters in tabs...\nPlease do one of the following:\n- Set the system locale to Chinese (But I don't know how to change the system locale on Mac OS X).\n- If the system locale is non-CJK and you do not want change it, add Chinese to \"preferred languages\" preference of Firefox.", "creation_time": "2012-02-22T10:41:11Z", "bug_id": 677919, "id": 6081850, "count": 32, "is_private": false, "tags": []}, {"creation_time": "2012-02-22T22:30:51Z", "raw_text": "Ok, wow this seems to have done the trick! I moved Chinese/China [zh-cn] language on top of my preferred languages in Firefox and it looks like the Chinese characters appear even now!\n\nThanks!", "text": "Ok, wow this seems to have done the trick! I moved Chinese/China [zh-cn] language on top of my preferred languages in Firefox and it looks like the Chinese characters appear even now!\n\nThanks!", "time": "2012-02-22T22:30:51Z", "attachment_id": null, "count": 33, "is_private": false, "tags": [], "id": 6084352, "bug_id": 677919, "creator": "goldyn.chyld9@gmail.com", "author": "goldyn.chyld9@gmail.com"}, {"raw_text": "It seems to be working fine now... Would still be nice if it worked this good without changing my default language to Chinese (on Firefox), too...", "creation_time": "2012-02-23T19:26:49Z", "text": "It seems to be working fine now... Would still be nice if it worked this good without changing my default language to Chinese (on Firefox), too...", "creator": "goldyn.chyld9@gmail.com", "attachment_id": null, "time": "2012-02-23T19:26:49Z", "author": "goldyn.chyld9@gmail.com", "is_private": false, "count": 34, "tags": [], "id": 6087409, "bug_id": 677919}, {"raw_text": "There's no way to determine whether the character is indeed Chinese because Unicode uses the same code-points for Chinese, Japanese, and Korean Ideographs. Chrome and IE just assume that everything is Chinese if language-info is unavailable.\nWhile it may be possible to guess the language from the content (like universalchardet), it is not an easy task.", "creation_time": "2012-02-24T02:00:59Z", "attachment_id": null, "time": "2012-02-24T02:00:59Z", "text": "There's no way to determine whether the character is indeed Chinese because Unicode uses the same code-points for Chinese, Japanese, and Korean Ideographs. Chrome and IE just assume that everything is Chinese if language-info is unavailable.\nWhile it may be possible to guess the language from the content (like universalchardet), it is not an easy task.", "id": 6088896, "count": 35, "is_private": false, "tags": [], "bug_id": 677919, "author": "VYV03354@nifty.ne.jp", "creator": "VYV03354@nifty.ne.jp"}, {"author": "goldyn.chyld9@gmail.com", "creator": "goldyn.chyld9@gmail.com", "bug_id": 677919, "id": 6093747, "count": 36, "is_private": false, "tags": [], "attachment_id": null, "time": "2012-02-26T12:58:46Z", "text": "Why can't Firefox also \"just assume that everything is Chinese if language-info is unavailable\" then?", "raw_text": "Why can't Firefox also \"just assume that everything is Chinese if language-info is unavailable\" then?", "creation_time": "2012-02-26T12:58:46Z"}, {"id": 6093750, "is_private": false, "count": 37, "tags": [], "bug_id": 677919, "raw_text": "See comment #25.", "creation_time": "2012-02-26T13:04:02Z", "attachment_id": null, "time": "2012-02-26T13:04:02Z", "text": "See comment #25.", "author": "VYV03354@nifty.ne.jp", "creator": "VYV03354@nifty.ne.jp"}, {"author": "goldyn.chyld9@gmail.com", "creator": "goldyn.chyld9@gmail.com", "raw_text": "I see... So for now the only solution to solve the ugly rendering of Chinese characters is to set Firefox \"preferred language\" to Chinese?", "creation_time": "2012-02-26T13:05:26Z", "attachment_id": null, "time": "2012-02-26T13:05:26Z", "text": "I see... So for now the only solution to solve the ugly rendering of Chinese characters is to set Firefox \"preferred language\" to Chinese?", "id": 6093752, "tags": [], "is_private": false, "count": 38, "bug_id": 677919}, {"author": "VYV03354@nifty.ne.jp", "creator": "VYV03354@nifty.ne.jp", "bug_id": 677919, "id": 6093754, "tags": [], "is_private": false, "count": 39, "attachment_id": null, "time": "2012-02-26T13:12:24Z", "text": "(In reply to goldyn chyld from comment #38)\n> I see... So for now the only solution to solve the ugly rendering of Chinese\n> characters is to set Firefox \"preferred language\" to Chinese?\nUnfortunately, yes. Sorry for the inconvenience to Chinese users.\n\nI have one question. Do Chinese users usually use English version of Firefox? Chinese version sets the \"preferred language\" to Chinese by default.", "raw_text": "(In reply to goldyn chyld from comment #38)\n> I see... So for now the only solution to solve the ugly rendering of Chinese\n> characters is to set Firefox \"preferred language\" to Chinese?\nUnfortunately, yes. Sorry for the inconvenience to Chinese users.\n\nI have one question. Do Chinese users usually use English version of Firefox? Chinese version sets the \"preferred language\" to Chinese by default.", "creation_time": "2012-02-26T13:12:24Z"}, {"id": 6093756, "count": 40, "is_private": false, "tags": [], "bug_id": 677919, "creation_time": "2012-02-26T13:14:31Z", "raw_text": "It's more of an inconvenience for us \"non-Chinese\" users, since we generally don't use the Chinese version of Firefox...", "time": "2012-02-26T13:14:31Z", "attachment_id": null, "text": "It's more of an inconvenience for us \"non-Chinese\" users, since we generally don't use the Chinese version of Firefox...", "author": "goldyn.chyld9@gmail.com", "creator": "goldyn.chyld9@gmail.com"}, {"bug_id": 677919, "is_private": false, "count": 41, "tags": [], "id": 6093767, "text": "Do \"non-Chinese\" users usually see Chinese texts?\n\nBTW I recalled another work around.\n1. Open about:config.\n2. Select New > String from the context menu.\n3. Enter \"font.name-list.serif.x-western\" as the preference name (assuming you usually set \"preferred language\" to English).\n4. Enter \"Heiti SC\" as the value.\n5. Restart Firefox.\n\nThis work around would not work on CJK versions of Operating systems until bug 729982 is fixed.", "time": "2012-02-26T13:39:07Z", "attachment_id": null, "creation_time": "2012-02-26T13:39:07Z", "raw_text": "Do \"non-Chinese\" users usually see Chinese texts?\n\nBTW I recalled another work around.\n1. Open about:config.\n2. Select New > String from the context menu.\n3. Enter \"font.name-list.serif.x-western\" as the preference name (assuming you usually set \"preferred language\" to English).\n4. Enter \"Heiti SC\" as the value.\n5. Restart Firefox.\n\nThis work around would not work on CJK versions of Operating systems until bug 729982 is fixed.", "creator": "VYV03354@nifty.ne.jp", "author": "VYV03354@nifty.ne.jp"}, {"bug_id": 677919, "tags": [], "is_private": false, "count": 42, "id": 6093774, "text": "Wow, this worked!! (I'm on a Mac) -- thanks so much! :)", "attachment_id": null, "time": "2012-02-26T13:53:45Z", "raw_text": "Wow, this worked!! (I'm on a Mac) -- thanks so much! :)", "creation_time": "2012-02-26T13:53:45Z", "creator": "goldyn.chyld9@gmail.com", "author": "goldyn.chyld9@gmail.com"}, {"creator": "goldyn.chyld9@gmail.com", "author": "goldyn.chyld9@gmail.com", "is_private": false, "count": 43, "tags": [], "id": 6095218, "bug_id": 677919, "creation_time": "2012-02-27T14:45:43Z", "raw_text": "Masatoshi Kimura, I've sent you an e-mail... :)", "text": "Masatoshi Kimura, I've sent you an e-mail... :)", "attachment_id": null, "time": "2012-02-27T14:45:43Z"}, {"id": 7605996, "is_private": false, "count": 44, "tags": [], "bug_id": 677919, "raw_text": "Confirmed here using English Firefox 22 in Linux Mint 15 Cinnamon.\nI've tried @Kimura's suggestion of adding font.name-list but the issue remains.\nMust \"Heiti SC\" match a font name on my system? Is there a more general setting?\n\nWhen I add lang=\"ja\" or lang=\"zh\" to the <html>, the font rendering is okay.\nSee the attached pngs.\n\nAgain, setting preferred language in preference won't work (bug 729982).", "creation_time": "2013-07-05T14:34:13Z", "time": "2013-07-05T14:34:13Z", "attachment_id": null, "text": "Confirmed here using English Firefox 22 in Linux Mint 15 Cinnamon.\nI've tried @Kimura's suggestion of adding font.name-list but the issue remains.\nMust \"Heiti SC\" match a font name on my system? Is there a more general setting?\n\nWhen I add lang=\"ja\" or lang=\"zh\" to the <html>, the font rendering is okay.\nSee the attached pngs.\n\nAgain, setting preferred language in preference won't work (bug 729982).", "author": "leesei@gmail.com", "creator": "leesei@gmail.com"}, {"raw_text": "", "creation_time": "2013-07-05T14:34:57Z", "time": "2013-07-05T14:34:57Z", "attachment_id": 771630, "text": "Created attachment 771630\nfail case capture", "id": 7605999, "tags": [], "is_private": false, "count": 45, "bug_id": 677919, "author": "leesei@gmail.com", "creator": "leesei@gmail.com"}, {"raw_text": "", "creation_time": "2013-07-05T14:36:11Z", "text": "Created attachment 771631\nsuccess case after setting lang=\"ja\"", "attachment_id": 771631, "time": "2013-07-05T14:36:11Z", "is_private": false, "count": 46, "tags": [], "id": 7606001, "bug_id": 677919, "creator": "leesei@gmail.com", "author": "leesei@gmail.com"}, {"bug_id": 677919, "id": 7606083, "count": 47, "is_private": false, "tags": [], "attachment_id": null, "time": "2013-07-05T15:38:16Z", "text": "The font name depends on your Operating System.\nPlease copy the font name from your Chinese settings. (For example, see the value of \"font.name-list.serif.zh-CN\" in about:config.)", "raw_text": "The font name depends on your Operating System.\nPlease copy the font name from your Chinese settings. (For example, see the value of \"font.name-list.serif.zh-CN\" in about:config.)", "creation_time": "2013-07-05T15:38:16Z", "author": "VYV03354@nifty.ne.jp", "creator": "VYV03354@nifty.ne.jp"}, {"creator": "leesei@gmail.com", "author": "leesei@gmail.com", "bug_id": 677919, "tags": [], "count": 48, "is_private": false, "id": 7606185, "text": "Thanks for the reply.\n\nI cannot find any other \"font.name-list\" in my settings.\nI tried to use \"WenQuanYi Micro Hei\" (hinted from FontInfo and font conf) but test1 is still ugly :-(.\n\nhttp://i74.photobucket.com/albums/i261/leesei/screenshot/Screenshotfrom2013-07-06004552.png", "time": "2013-07-05T16:52:28Z", "attachment_id": null, "raw_text": "Thanks for the reply.\n\nI cannot find any other \"font.name-list\" in my settings.\nI tried to use \"WenQuanYi Micro Hei\" (hinted from FontInfo and font conf) but test1 is still ugly :-(.\n\nhttp://i74.photobucket.com/albums/i261/leesei/screenshot/Screenshotfrom2013-07-06004552.png", "creation_time": "2013-07-05T16:52:28Z"}, {"bug_id": 677919, "tags": [], "is_private": false, "count": 49, "id": 12166985, "text": "Still experiencing this bug...", "attachment_id": null, "time": "2017-03-22T11:38:57Z", "creation_time": "2017-03-22T11:38:57Z", "raw_text": "Still experiencing this bug...", "creator": "nyanpasu64@tuta.io", "author": "nyanpasu64@tuta.io"}, {"attachment_id": null, "time": "2017-03-22T12:01:02Z", "text": "Chrome and IE11 works fine.\nBut Edge has same problem...", "creation_time": "2017-03-22T12:01:02Z", "raw_text": "Chrome and IE11 works fine.\nBut Edge has same problem...", "bug_id": 677919, "id": 12167074, "tags": [], "is_private": false, "count": 50, "author": "alice0775@gmail.com", "creator": "alice0775@gmail.com"}, {"id": 12168894, "tags": [], "is_private": false, "count": 51, "bug_id": 677919, "raw_text": "jimbo1qaz send me an e-mail on this bug. For your reference, this is the current situation (which I replied to him/her):\n\n===\n\nThe test cases tests when the markup sets the language of the text to English, but use some CJK characters in there. Here is how Firefox decide the font to use:\n\n1. The default sans-serif font for Latin scripts is \"Arial\" on Windows. Obviously, Arial doesn't come with CJK characters. http://searchfox.org/mozilla-central/rev/0079c7adf3b329bff579d3bbe6ac7ba2f6218a19/modules/libpref/init/all.js#3292\n2. We do not set font.name-list.sans-serif.x-western on Windows (you may want to verify that on your own about:config), so there is no font to check here. This should be set in the same file (all.js) in the source code.\n3. Because you are using a English version of Firefox, your preferred language list (found in Options -> Content -> Languages) should not contain any of the CJK locales, none will be considered ahead of others. http://searchfox.org/mozilla-central/rev/0079c7adf3b329bff579d3bbe6ac7ba2f6218a19/gfx/thebes/gfxPlatformFontList.cpp#1060\n4. You are using a English version of Firefox, so none of the CJK fonts will be used before others. http://searchfox.org/mozilla-central/rev/0079c7adf3b329bff579d3bbe6ac7ba2f6218a19/gfx/thebes/gfxPlatformFontList.cpp#1095\n5. At this point, Firefox has no way to tell the locale it should render the characters into. It decided to use the old gfx (Netscape?) hard-coded list, which is Japanese, Korean, Chinese - China, Chinese - HK, and Chinese - Taiwan. http://searchfox.org/mozilla-central/rev/0079c7adf3b329bff579d3bbe6ac7ba2f6218a19/gfx/thebes/gfxPlatformFontList.cpp#1113-1118 This is why you see MS PGothic here.\n\nAs a user, you can fix that by setting the preferred content language preferences (step 3), or use Firefox of a specific locale (step 4).\n\n===\n\nAs I browse the code, I found this which use Arial Unicode MS as the last resort in the system font matching.\n\nhttp://searchfox.org/mozilla-central/rev/0079c7adf3b329bff579d3bbe6ac7ba2f6218a19/gfx/thebes/gfxWindowsPlatform.cpp#863\n\nThis is probably a better default than step 5 described above given that it's locale generic. The current step 5 will result mixed fonts in the sans-serif/en test case. Masayuki, what do you think?\n\n(The test case come from an add-on of mine, which tweak the font.name-list pref: https://addons.mozilla.org/en-US/firefox/addon/chinese-default-font-tweak/ . It will be broken by Fx57 when we disable classic add-ons, so it's probably make more sense to fix that here.)", "creation_time": "2017-03-22T19:56:47Z", "time": "2017-03-22T19:56:47Z", "attachment_id": null, "text": "jimbo1qaz send me an e-mail on this bug. For your reference, this is the current situation (which I replied to him/her):\n\n===\n\nThe test cases tests when the markup sets the language of the text to English, but use some CJK characters in there. Here is how Firefox decide the font to use:\n\n1. The default sans-serif font for Latin scripts is \"Arial\" on Windows. Obviously, Arial doesn't come with CJK characters. http://searchfox.org/mozilla-central/rev/0079c7adf3b329bff579d3bbe6ac7ba2f6218a19/modules/libpref/init/all.js#3292\n2. We do not set font.name-list.sans-serif.x-western on Windows (you may want to verify that on your own about:config), so there is no font to check here. This should be set in the same file (all.js) in the source code.\n3. Because you are using a English version of Firefox, your preferred language list (found in Options -> Content -> Languages) should not contain any of the CJK locales, none will be considered ahead of others. http://searchfox.org/mozilla-central/rev/0079c7adf3b329bff579d3bbe6ac7ba2f6218a19/gfx/thebes/gfxPlatformFontList.cpp#1060\n4. You are using a English version of Firefox, so none of the CJK fonts will be used before others. http://searchfox.org/mozilla-central/rev/0079c7adf3b329bff579d3bbe6ac7ba2f6218a19/gfx/thebes/gfxPlatformFontList.cpp#1095\n5. At this point, Firefox has no way to tell the locale it should render the characters into. It decided to use the old gfx (Netscape?) hard-coded list, which is Japanese, Korean, Chinese - China, Chinese - HK, and Chinese - Taiwan. http://searchfox.org/mozilla-central/rev/0079c7adf3b329bff579d3bbe6ac7ba2f6218a19/gfx/thebes/gfxPlatformFontList.cpp#1113-1118 This is why you see MS PGothic here.\n\nAs a user, you can fix that by setting the preferred content language preferences (step 3), or use Firefox of a specific locale (step 4).\n\n===\n\nAs I browse the code, I found this which use Arial Unicode MS as the last resort in the system font matching.\n\nhttp://searchfox.org/mozilla-central/rev/0079c7adf3b329bff579d3bbe6ac7ba2f6218a19/gfx/thebes/gfxWindowsPlatform.cpp#863\n\nThis is probably a better default than step 5 described above given that it's locale generic. The current step 5 will result mixed fonts in the sans-serif/en test case. Masayuki, what do you think?\n\n(The test case come from an add-on of mine, which tweak the font.name-list pref: https://addons.mozilla.org/en-US/firefox/addon/chinese-default-font-tweak/ . It will be broken by Fx57 when we disable classic add-ons, so it's probably make more sense to fix that here.)", "author": "timdream@gmail.com", "creator": "timdream@gmail.com"}, {"bug_id": 677919, "is_private": false, "count": 52, "tags": [], "id": 12170036, "text": "Hmm, I'm surprising at actually some users reach #5. Users who read Chinese characters should set accept-language settings because global company's web sites check accept-language and they send localized pages.\n\nAnyway, we don't have any good resolution for this issue if content language is different from UI locale nor OS locale.\n\nArial Unicode MS isn't a good solution. It seems that it's already not maintained. So, some glyph may be too old and anyway, it must have glyph difference issue between CJKT. Additionally, it doesn't have good glyph. So, if it had higher priority than current CJKT fonts listed in font.name-list.*, the rendering result on some web sites would become uglier.\n\nI wonder, isn't you guys see different recent regression of bug 1346674? Because suddenly some users added some comments since yesterday. If so, wait a couple of days to fix the regression.", "creator": "masayuki@d-toybox.com", "time": "2017-03-23T03:06:52Z", "attachment_id": null, "author": "masayuki@d-toybox.com", "raw_text": "Hmm, I'm surprising at actually some users reach #5. Users who read Chinese characters should set accept-language settings because global company's web sites check accept-language and they send localized pages.\n\nAnyway, we don't have any good resolution for this issue if content language is different from UI locale nor OS locale.\n\nArial Unicode MS isn't a good solution. It seems that it's already not maintained. So, some glyph may be too old and anyway, it must have glyph difference issue between CJKT. Additionally, it doesn't have good glyph. So, if it had higher priority than current CJKT fonts listed in font.name-list.*, the rendering result on some web sites would become uglier.\n\nI wonder, isn't you guys see different recent regression of bug 1346674? Because suddenly some users added some comments since yesterday. If so, wait a couple of days to fix the regression.", "creation_time": "2017-03-23T03:06:52Z"}, {"author": "nyanpasu64@tuta.io", "creator": "nyanpasu64@tuta.io", "time": "2017-03-23T06:01:55Z", "attachment_id": null, "text": "@masayuki: I think this bug has existed since forever, I just only recently commented and sent timdream an email.\n\n1. I want my pages in English, but still want Chinese pages to render correctly.\n2. Chrome renders https://timdream.org/zh-font-tweak/test.html and Google Docs Chinese characters correctly, without me setting any special Chinese settings. If I explicitly change to a Chinese font, Firefox uses it.\n\nGoogle Translate renders correctly on Chrome through `lang=\"zh-CN, ja...\"` tags: <span id=\"result_box\" class=\"short_text\" lang=\"ja\"><span class=\"\" contenteditable=\"false\" tabindex=\"-1\">\u5c0f\u3055\u3044</span></span>\n\nGoogle Docs does not have `lang=\"\"` attributes, and renders incorrectly in Firefox. Apparently Chrome renders CJK characters in SimSun and Japanese-specific characters in Yu Gothic. The same behavior is observed in htmledit.squarefree.com.\n\nOn Chrome, if I manually add Japanese into the list of languages, CJK characters are rendered in Yu Gothic.\n\n3. Does changing my language preferences fix font rendering? On Firefox, I added \"zh-ch\" and \"zh\" to my font list, but CJK characters are still rendering in MS PGothic (my default Japanese font).", "creation_time": "2017-03-23T06:01:55Z", "raw_text": "@masayuki: I think this bug has existed since forever, I just only recently commented and sent timdream an email.\n\n1. I want my pages in English, but still want Chinese pages to render correctly.\n2. Chrome renders https://timdream.org/zh-font-tweak/test.html and Google Docs Chinese characters correctly, without me setting any special Chinese settings. If I explicitly change to a Chinese font, Firefox uses it.\n\nGoogle Translate renders correctly on Chrome through `lang=\"zh-CN, ja...\"` tags: <span id=\"result_box\" class=\"short_text\" lang=\"ja\"><span class=\"\" contenteditable=\"false\" tabindex=\"-1\">\u5c0f\u3055\u3044</span></span>\n\nGoogle Docs does not have `lang=\"\"` attributes, and renders incorrectly in Firefox. Apparently Chrome renders CJK characters in SimSun and Japanese-specific characters in Yu Gothic. The same behavior is observed in htmledit.squarefree.com.\n\nOn Chrome, if I manually add Japanese into the list of languages, CJK characters are rendered in Yu Gothic.\n\n3. Does changing my language preferences fix font rendering? On Firefox, I added \"zh-ch\" and \"zh\" to my font list, but CJK characters are still rendering in MS PGothic (my default Japanese font).", "bug_id": 677919, "id": 12170622, "is_private": false, "count": 53, "tags": []}, {"bug_id": 677919, "tags": [], "count": 54, "is_private": false, "id": 12170640, "text": "I <s>love</s>hate how Han Unification got us into such messes.", "attachment_id": null, "time": "2017-03-23T06:05:19Z", "creation_time": "2017-03-23T06:05:19Z", "raw_text": "I <s>love</s>hate how Han Unification got us into such messes.", "creator": "nyanpasu64@tuta.io", "author": "nyanpasu64@tuta.io"}, {"creation_time": "2017-03-23T08:23:09Z", "raw_text": "(In reply to jimbo1qaz from comment #53)\n> 1. I want my pages in English, but still want Chinese pages to render\n> correctly.\n\nI don't understand what is \"my pages\". If you meant an HTML file you wrote should be rendered with proper language's font, use lang attribute properly. But it seems that you didn't try to say that...\n\n> 2. Chrome renders https://timdream.org/zh-font-tweak/test.html and Google\n> Docs Chinese characters correctly, without me setting any special Chinese\n> settings.\n\nYeah, that's very difficult issue to decide proper language to render web pages and web apps which don't have lang attribute due to used in worldwide.\n\n> If I explicitly change to a Chinese font, Firefox uses it.\n\nDid you mean that you changed en-US's Serif or Sans-serif font to a Chinese font? If so, it should be so.\n\n> Google Translate renders correctly on Chrome through `lang=\"zh-CN, ja...\"`\n> tags: <span id=\"result_box\" class=\"short_text\" lang=\"ja\"><span class=\"\"\n> contenteditable=\"false\" tabindex=\"-1\">\u5c0f\u3055\u3044</span></span>\n\nIf lang attribute is specified \"correctly\", it should be rendered. Otherwise, rendering engine needs to guess proper language from other hints. That's very difficult, comment 51 explains current our implementation.\n\n> Google Docs does not have `lang=\"\"` attributes, and renders incorrectly in\n> Firefox. Apparently Chrome renders CJK characters in SimSun and\n> Japanese-specific characters in Yu Gothic. The same behavior is observed in\n> htmledit.squarefree.com.\n\nSo, sounds like you reached #5 of comment 51 unfortunately. Do you use which locale's Firefox and OS? If one of them is CJKT, the locale should be used to render Chinese characters when it's not specified CJKT language with lang attribute.\n\n> 3. Does changing my language preferences fix font rendering? On Firefox, I\n> added \"zh-ch\" and \"zh\" to my font list, but CJK characters are still\n> rendering in MS PGothic (my default Japanese font).\n\nWhen you add zh-CN from [Options] -> [Content] -> [Languages] -> [Choose...] -> [Select a language to add] and press [Add] button and make it moved up to other CJKT languages, Simplified Chinese font should be used unless elements are specified as JKT language. Default fonts for each language can be specified from [Advanced...] button of [Fonts & Colors] above the [Languages].\n\nIf you use localized build for Simplified Chinese, the [Languages] settings should have \"zh-CN\" at its top. (I've never checked the localized build for Simplified Chinese, though.)", "text": "(In reply to jimbo1qaz from comment #53)\n> 1. I want my pages in English, but still want Chinese pages to render\n> correctly.\n\nI don't understand what is \"my pages\". If you meant an HTML file you wrote should be rendered with proper language's font, use lang attribute properly. But it seems that you didn't try to say that...\n\n> 2. Chrome renders https://timdream.org/zh-font-tweak/test.html and Google\n> Docs Chinese characters correctly, without me setting any special Chinese\n> settings.\n\nYeah, that's very difficult issue to decide proper language to render web pages and web apps which don't have lang attribute due to used in worldwide.\n\n> If I explicitly change to a Chinese font, Firefox uses it.\n\nDid you mean that you changed en-US's Serif or Sans-serif font to a Chinese font? If so, it should be so.\n\n> Google Translate renders correctly on Chrome through `lang=\"zh-CN, ja...\"`\n> tags: <span id=\"result_box\" class=\"short_text\" lang=\"ja\"><span class=\"\"\n> contenteditable=\"false\" tabindex=\"-1\">\u5c0f\u3055\u3044</span></span>\n\nIf lang attribute is specified \"correctly\", it should be rendered. Otherwise, rendering engine needs to guess proper language from other hints. That's very difficult, comment 51 explains current our implementation.\n\n> Google Docs does not have `lang=\"\"` attributes, and renders incorrectly in\n> Firefox. Apparently Chrome renders CJK characters in SimSun and\n> Japanese-specific characters in Yu Gothic. The same behavior is observed in\n> htmledit.squarefree.com.\n\nSo, sounds like you reached #5 of comment 51 unfortunately. Do you use which locale's Firefox and OS? If one of them is CJKT, the locale should be used to render Chinese characters when it's not specified CJKT language with lang attribute.\n\n> 3. Does changing my language preferences fix font rendering? On Firefox, I\n> added \"zh-ch\" and \"zh\" to my font list, but CJK characters are still\n> rendering in MS PGothic (my default Japanese font).\n\nWhen you add zh-CN from [Options] -> [Content] -> [Languages] -> [Choose...] -> [Select a language to add] and press [Add] button and make it moved up to other CJKT languages, Simplified Chinese font should be used unless elements are specified as JKT language. Default fonts for each language can be specified from [Advanced...] button of [Fonts & Colors] above the [Languages].\n\nIf you use localized build for Simplified Chinese, the [Languages] settings should have \"zh-CN\" at its top. (I've never checked the localized build for Simplified Chinese, though.)", "attachment_id": null, "time": "2017-03-23T08:23:09Z", "is_private": false, "count": 55, "tags": [], "id": 12170995, "bug_id": 677919, "creator": "masayuki@d-toybox.com", "author": "masayuki@d-toybox.com"}, {"author": "timdream@gmail.com", "creator": "timdream@gmail.com", "bug_id": 677919, "id": 12171590, "is_private": false, "count": 56, "tags": [], "attachment_id": null, "time": "2017-03-23T12:54:03Z", "text": "(In reply to Masayuki Nakano [:masayuki] from comment #52)\n> Hmm, I'm surprising at actually some users reach #5. Users who read Chinese\n> characters should set accept-language settings because global company's web\n> sites check accept-language and they send localized pages.\n> \n\nWould it make sense to collect telemetry on how many user reached this case? That will help us making an informed decision on whether or not we should spend time on this.", "creation_time": "2017-03-23T12:54:03Z", "raw_text": "(In reply to Masayuki Nakano [:masayuki] from comment #52)\n> Hmm, I'm surprising at actually some users reach #5. Users who read Chinese\n> characters should set accept-language settings because global company's web\n> sites check accept-language and they send localized pages.\n> \n\nWould it make sense to collect telemetry on how many user reached this case? That will help us making an informed decision on whether or not we should spend time on this."}, {"creator": "Fanolian+BMO@gmail.com", "author": "Fanolian+BMO@gmail.com", "count": 57, "is_private": false, "tags": [], "id": 14501826, "bug_id": 677919, "creation_time": "2019-11-21T08:48:05Z", "raw_text": "I think this bug is fixed by bug 1581822 and is customisable by bug 1596875.", "text": "I think this bug is fixed by bug 1581822 and is customisable by bug 1596875.", "attachment_id": null, "time": "2019-11-21T08:48:05Z"}, {"author": "release-mgmt-account-bot@mozilla.tld", "creator": "release-mgmt-account-bot@mozilla.tld", "id": 14502079, "count": 58, "is_private": false, "tags": [], "bug_id": 677919, "creation_time": "2019-11-21T12:11:48Z", "raw_text": "[Bugbug](https://github.com/mozilla/bugbug/) thinks this bug is a regression, but please revert this change in case of error.", "attachment_id": null, "time": "2019-11-21T12:11:48Z", "text": "[Bugbug](https://github.com/mozilla/bugbug/) thinks this bug is a regression, but please revert this change in case of error."}]}}, "comments": {}}