{"bugs": {"634526": {"comments": [{"time": "2011-02-16T06:03:02Z", "is_private": false, "attachment_id": 512711, "bug_id": 634526, "count": 0, "creator": "vseerror@lehigh.edu", "tags": [], "raw_text": "shutdown hang with imap threads blocked\n(hopefully this is a reproduction of a stack I got earlier with 2011-02-08 build)\n\nusing 2011-02-15 tryserver build protz created using TM branch.\n\nsending imap log via email", "id": 5282310, "text": "Created attachment 512711\nstacktrace of shutdown hang\n\nshutdown hang with imap threads blocked\n(hopefully this is a reproduction of a stack I got earlier with 2011-02-08 build)\n\nusing 2011-02-15 tryserver build protz created using TM branch.\n\nsending imap log via email", "creation_time": "2011-02-16T06:03:02Z", "author": "vseerror@lehigh.edu"}, {"bug_id": 634526, "count": 1, "creator": "vseerror@lehigh.edu", "tags": [], "text": "Created attachment 512714\nfirst (earlier) hang stacktrace with the 20110208 build", "creation_time": "2011-02-16T06:13:17Z", "raw_text": "", "id": 5282322, "author": "vseerror@lehigh.edu", "time": "2011-02-16T06:13:17Z", "is_private": false, "attachment_id": 512714}, {"text": "The first stack trace doesn't have useful symbols, so I can't tell if it's the same kind of hang.", "is_private": false, "creation_time": "2011-02-16T16:22:44Z", "raw_text": "The first stack trace doesn't have useful symbols, so I can't tell if it's the same kind of hang.", "id": 5283160, "bug_id": 634526, "time": "2011-02-16T16:22:44Z", "creator": "mozilla@davidbienvenu.org", "count": 2, "tags": [], "author": "mozilla@davidbienvenu.org", "attachment_id": null}, {"bug_id": 634526, "tags": [], "count": 3, "creator": "vseerror@lehigh.edu", "text": "(In reply to comment #2)\n> The first stack trace doesn't have useful symbols, so I can't tell if it's the\n> same kind of hang.\n\nyeah. that's the tracemonkey build. can you use the other trace?\nI'll revert to using comm-central trunk.\n\nI'm going to label this a regression, but I don't have proof yet. perhaps from bug 613184?", "creation_time": "2011-02-17T13:42:16Z", "raw_text": "(In reply to comment #2)\n> The first stack trace doesn't have useful symbols, so I can't tell if it's the\n> same kind of hang.\n\nyeah. that's the tracemonkey build. can you use the other trace?\nI'll revert to using comm-central trunk.\n\nI'm going to label this a regression, but I don't have proof yet. perhaps from bug 613184?", "id": 5286044, "author": "vseerror@lehigh.edu", "time": "2011-02-17T13:42:16Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "time": "2011-02-17T15:31:09Z", "is_private": false, "author": "mozilla@davidbienvenu.org", "bug_id": 634526, "creator": "mozilla@davidbienvenu.org", "tags": [], "count": 4, "text": "(In reply to comment #3)\n\n> yeah. that's the tracemonkey build. can you use the other trace?\n> I'll revert to using comm-central trunk.\n\nI don't know that the hangs are the same, so I'd just be guessing. Also, it's possible that I need a more complete log, i.e., not just the last part of the log, if the problem has to do with stalled connections that stalled long before shutdown.\n> \n> I'm going to label this a regression, but I don't have proof yet. perhaps from\n> bug 613184?\n\nPossibly.\n\nI'll try to think if there's a way to instrument this better.", "creation_time": "2011-02-17T15:31:09Z", "raw_text": "(In reply to comment #3)\n\n> yeah. that's the tracemonkey build. can you use the other trace?\n> I'll revert to using comm-central trunk.\n\nI don't know that the hangs are the same, so I'd just be guessing. Also, it's possible that I need a more complete log, i.e., not just the last part of the log, if the problem has to do with stalled connections that stalled long before shutdown.\n> \n> I'm going to label this a regression, but I don't have proof yet. perhaps from\n> bug 613184?\n\nPossibly.\n\nI'll try to think if there's a way to instrument this better.", "id": 5286276}, {"is_private": false, "time": "2011-02-18T00:28:28Z", "attachment_id": null, "raw_text": "I suspect this is an issue with the server sending an unsolicited response to the DONE command:\n\n2011-02-17 16:00:05.613000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:SendData: DONE\n\n2011-02-17 16:00:05.613000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:CreateNewLineFromSocket: * OK Timeout in 30 minutes\n\n2011-02-17 16:00:05.629000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:CreateNewLineFromSocket: 60 OK IDLE completed\n\nGenerally, your server gives that response to the IDLE command, not the DONE command (DONE gets us out of IDLE). Looking at our handling of parsing the DONE response, I don't think we deal with unsolicited responses, and that may be confusing our state. I'll have to hack our test server to be similarly rude.", "id": 5288222, "text": "I suspect this is an issue with the server sending an unsolicited response to the DONE command:\n\n2011-02-17 16:00:05.613000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:SendData: DONE\n\n2011-02-17 16:00:05.613000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:CreateNewLineFromSocket: * OK Timeout in 30 minutes\n\n2011-02-17 16:00:05.629000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:CreateNewLineFromSocket: 60 OK IDLE completed\n\nGenerally, your server gives that response to the IDLE command, not the DONE command (DONE gets us out of IDLE). Looking at our handling of parsing the DONE response, I don't think we deal with unsolicited responses, and that may be confusing our state. I'll have to hack our test server to be similarly rude.", "creation_time": "2011-02-18T00:28:28Z", "bug_id": 634526, "tags": [], "creator": "mozilla@davidbienvenu.org", "count": 5, "author": "mozilla@davidbienvenu.org"}, {"time": "2011-02-18T00:37:45Z", "is_private": false, "attachment_id": null, "tags": [], "count": 6, "creator": "mozilla@davidbienvenu.org", "bug_id": 634526, "id": 5288246, "raw_text": "er, after first trying to make it support IDLE, which might be hard.", "creation_time": "2011-02-18T00:37:45Z", "text": "er, after first trying to make it support IDLE, which might be hard.", "author": "mozilla@davidbienvenu.org"}, {"author": "mozilla@davidbienvenu.org", "id": 5291230, "raw_text": "I added IDLE support to the imap fake server, and made it generate the same unsolicited response to DONE, but it doesn't seem to cause any problems with the parser. The unit test I wrote to simulate the behavior I saw in Wayne's log had no problems. So I'm at a bit of a loss. I'll attach the changes I made to this bug, but I'm at a bit of a dead end.\n\nWhat I can tell from Wayne's log is that for a couple minutes, we think the moz-lxmac/moz-FF folder is busy, and status urls fail to run. Then, after a couple minutes, we think the folder isn't busy, but we use a different connection to run the url. Wayne's connection timeout looks like it's 29 minutes, so we're not timing out the connection. Maybe we think the connection has gone bad, but the thread is still around...I'll have to think more about this.", "creation_time": "2011-02-19T00:49:15Z", "text": "I added IDLE support to the imap fake server, and made it generate the same unsolicited response to DONE, but it doesn't seem to cause any problems with the parser. The unit test I wrote to simulate the behavior I saw in Wayne's log had no problems. So I'm at a bit of a loss. I'll attach the changes I made to this bug, but I'm at a bit of a dead end.\n\nWhat I can tell from Wayne's log is that for a couple minutes, we think the moz-lxmac/moz-FF folder is busy, and status urls fail to run. Then, after a couple minutes, we think the folder isn't busy, but we use a different connection to run the url. Wayne's connection timeout looks like it's 29 minutes, so we're not timing out the connection. Maybe we think the connection has gone bad, but the thread is still around...I'll have to think more about this.", "count": 7, "creator": "mozilla@davidbienvenu.org", "tags": [], "bug_id": 634526, "attachment_id": null, "is_private": false, "time": "2011-02-19T00:49:15Z"}, {"attachment_id": 513823, "author": "mozilla@davidbienvenu.org", "is_private": false, "creation_time": "2011-02-20T01:20:53Z", "text": "Created attachment 513823\nunit test for this that doesn't show failure", "id": 5292560, "raw_text": "", "tags": [], "time": "2011-02-20T01:20:53Z", "count": 8, "creator": "mozilla@davidbienvenu.org", "bug_id": 634526}, {"time": "2011-02-22T15:52:45Z", "is_private": false, "attachment_id": null, "bug_id": 634526, "count": 9, "tags": [], "creator": "mozilla@davidbienvenu.org", "text": "We might be timing out a blocking read, which has a roughly 100 second timeout. I'm not sure why the read timeout would leave the imap thread blocked the way it was, or mark the folder as not busy.\n\nLooking at the timestamps on the log, we're reading the * OK timeout response with the exact same timestamp as sending the DONE command, which makes me think it was in the input stream from previous IDLE command the whole time. But I still don't see why that would cause a problem.\n\n2011-02-17 16:00:05.613000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:SendData: DONE\n\n2011-02-17 16:00:05.613000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:CreateNewLineFromSocket: * OK Timeout in 30 minutes\n\n2011-02-17 16:00:05.629000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:CreateNewLineFromSocket: 60 OK IDLE completed", "creation_time": "2011-02-22T15:52:45Z", "raw_text": "We might be timing out a blocking read, which has a roughly 100 second timeout. I'm not sure why the read timeout would leave the imap thread blocked the way it was, or mark the folder as not busy.\n\nLooking at the timestamps on the log, we're reading the * OK timeout response with the exact same timestamp as sending the DONE command, which makes me think it was in the input stream from previous IDLE command the whole time. But I still don't see why that would cause a problem.\n\n2011-02-17 16:00:05.613000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:SendData: DONE\n\n2011-02-17 16:00:05.613000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:CreateNewLineFromSocket: * OK Timeout in 30 minutes\n\n2011-02-17 16:00:05.629000 UTC - 3084[4de17c0]: a81b800:mail.lehigh.edu:S-/home/vseerror/mail/moz-lxmac/moz-FF:CreateNewLineFromSocket: 60 OK IDLE completed", "id": 5295804, "author": "mozilla@davidbienvenu.org"}, {"author": "vseerror@lehigh.edu", "tags": [], "creator": "vseerror@lehigh.edu", "count": 10, "bug_id": 634526, "creation_time": "2015-05-09T01:41:10Z", "text": "*** Bug 702152 has been marked as a duplicate of this bug. ***", "id": 10250199, "raw_text": "", "attachment_id": null, "time": "2015-05-09T01:41:10Z", "is_private": false}, {"author": "vseerror@lehigh.edu", "bug_id": 634526, "count": 11, "tags": [], "creator": "vseerror@lehigh.edu", "text": "Gene, do we have similar bug reports?", "creation_time": "2019-08-12T11:35:53Z", "raw_text": "Gene, do we have similar bug reports?", "id": 14294493, "attachment_id": null, "time": "2019-08-12T11:35:53Z", "is_private": false}, {"author": "gds@chartertn.net", "raw_text": "Doesn't ring any bells...", "id": 14295358, "text": "Doesn't ring any bells...", "creation_time": "2019-08-12T17:51:29Z", "bug_id": 634526, "count": 12, "creator": "gds@chartertn.net", "tags": [], "attachment_id": null, "is_private": false, "time": "2019-08-12T17:51:29Z"}]}}, "comments": {}}