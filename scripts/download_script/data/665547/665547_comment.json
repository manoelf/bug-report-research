{"bugs": {"665547": {"comments": [{"time": "2011-06-20T15:03:04Z", "tags": [], "bug_id": 665547, "text": "Simple example:\nvar i = document.createElement('input');\ni.placeholder = 'foo';\ni.value = 'bar';\n\nThis is going to nsHTMLInputElement::SetValueInternal which is going to call UpdateState(true) because it has a placeholder. but |mInputData.mState->SetValue(.., ...)| a few lines above will go to nsTextEditorState::SetValue() which is going to end up calling nsHTMLInputElement::OnValueChanged(true) which is going to update validity states and call UpdateState().\n\nThis is likely a no-op because UpdateState() is just going to call IntrinsitState() and do nothing because it will be equal to mState. Though, it shows an issue in our design.\nI believe we could probably remove the UpdateState() in ::SetValueInternal(). I will try that.", "author": "mounir@lamouri.fr", "creation_time": "2011-06-20T15:03:04Z", "count": 0, "creator": "mounir@lamouri.fr", "is_private": false, "id": 5542560, "raw_text": "Simple example:\nvar i = document.createElement('input');\ni.placeholder = 'foo';\ni.value = 'bar';\n\nThis is going to nsHTMLInputElement::SetValueInternal which is going to call UpdateState(true) because it has a placeholder. but |mInputData.mState->SetValue(.., ...)| a few lines above will go to nsTextEditorState::SetValue() which is going to end up calling nsHTMLInputElement::OnValueChanged(true) which is going to update validity states and call UpdateState().\n\nThis is likely a no-op because UpdateState() is just going to call IntrinsitState() and do nothing because it will be equal to mState. Though, it shows an issue in our design.\nI believe we could probably remove the UpdateState() in ::SetValueInternal(). I will try that.", "attachment_id": null}, {"raw_text": "I expect there are various such issues left in the forms code....\n\nIn this case, the UpdateState call is there because there used to be a ContentStateChanged() call there before and there is no way to tell that SetValue will do an UpdateState.\n\nThough I guess OnValueChanged explicitly checks for the placeholder case, eh?\n\nWe can probably replace the UpdateState in SetValueInternal with an assert...", "attachment_id": null, "id": 5545511, "count": 1, "is_private": false, "creator": "bzbarsky@mit.edu", "text": "I expect there are various such issues left in the forms code....\n\nIn this case, the UpdateState call is there because there used to be a ContentStateChanged() call there before and there is no way to tell that SetValue will do an UpdateState.\n\nThough I guess OnValueChanged explicitly checks for the placeholder case, eh?\n\nWe can probably replace the UpdateState in SetValueInternal with an assert...", "bug_id": 665547, "time": "2011-06-21T15:29:42Z", "tags": [], "creation_time": "2011-06-21T15:29:42Z", "author": "bzbarsky@mit.edu"}]}}, "comments": {}}