{"comments": {}, "bugs": {"647998": {"comments": [{"id": 5392277, "author": "jruderman@gmail.com", "is_private": false, "bug_id": 647998, "attachment_id": null, "tags": [], "creation_time": "2011-04-06T14:50:59Z", "count": 0, "time": "2011-04-06T14:50:59Z", "text": "See bug 640629 for the latest round of screw-ups.\n\nI understand that we can't change the GC behavior of nsITimer right now. Can we at least make it assert-fail, so it doesn't just make pieces of the browser fail quietly and mysteriously?  At least for one-shot timers?", "creator": "jruderman@gmail.com", "raw_text": "See bug 640629 for the latest round of screw-ups.\n\nI understand that we can't change the GC behavior of nsITimer right now. Can we at least make it assert-fail, so it doesn't just make pieces of the browser fail quietly and mysteriously?  At least for one-shot timers?"}, {"is_private": false, "count": 1, "author": "benjamin@smedbergs.us", "time": "2011-04-06T16:08:16Z", "id": 5392350, "attachment_id": null, "tags": [], "creation_time": "2011-04-06T16:08:16Z", "creator": "benjamin@smedbergs.us", "raw_text": "I've never understood why we can't make timers root themselves while they are pending (and we're not shutting down)... can we just do that, and perhaps deal with the little bit of leak fallout that might happen?", "bug_id": 647998, "text": "I've never understood why we can't make timers root themselves while they are pending (and we're not shutting down)... can we just do that, and perhaps deal with the little bit of leak fallout that might happen?"}, {"count": 2, "time": "2011-04-06T16:21:21Z", "creator": "bzbarsky@mit.edu", "raw_text": "That seems fine offhand to me.  Brendan, any reason not to do that?", "text": "That seems fine offhand to me.  Brendan, any reason not to do that?", "is_private": false, "author": "bzbarsky@mit.edu", "id": 5392378, "attachment_id": null, "creation_time": "2011-04-06T16:21:21Z", "tags": [], "bug_id": 647998}, {"author": "jruderman@gmail.com", "is_private": false, "id": 5397729, "attachment_id": null, "creation_time": "2011-04-08T22:39:11Z", "tags": [], "bug_id": 647998, "count": 3, "time": "2011-04-08T22:39:11Z", "creator": "jruderman@gmail.com", "raw_text": "Hrm, bug 387341 seems related.", "text": "Hrm, bug 387341 seems related."}, {"raw_text": "I agree that the only sane model for timers is that they are rooted as long as they can fire in the future. It's terribly wrong for whether a timer fires or not to depend on the timing of GC.\n\nWe would have to audit users of repeating timers, at least, to make sure something cancels them. And obviously JS setTimeout/setInterval would have to cancel automatically when a window needs to go away.", "creator": "roc@ocallahan.org", "text": "I agree that the only sane model for timers is that they are rooted as long as they can fire in the future. It's terribly wrong for whether a timer fires or not to depend on the timing of GC.\n\nWe would have to audit users of repeating timers, at least, to make sure something cancels them. And obviously JS setTimeout/setInterval would have to cancel automatically when a window needs to go away.", "time": "2011-07-06T23:01:46Z", "count": 4, "tags": [], "creation_time": "2011-07-06T23:01:46Z", "attachment_id": null, "bug_id": 647998, "is_private": false, "author": "roc@ocallahan.org", "id": 5577636}, {"raw_text": "That last part works already: nsGlobalWindow::SetDocshell calls FreeInnerObjects on all the inners when aDocShell is null, and FreeInnerObjects calls ClearAllTimeouts, which cancels all the timer.  This covers the \"window closing\" case.  FreeInnerObjects is also called from nsGlobalWindow::SetNewDocument, which is what happens in the \"navigating away\" case.", "creator": "bzbarsky@mit.edu", "text": "That last part works already: nsGlobalWindow::SetDocshell calls FreeInnerObjects on all the inners when aDocShell is null, and FreeInnerObjects calls ClearAllTimeouts, which cancels all the timer.  This covers the \"window closing\" case.  FreeInnerObjects is also called from nsGlobalWindow::SetNewDocument, which is what happens in the \"navigating away\" case.", "time": "2011-07-07T00:52:13Z", "count": 5, "tags": [], "creation_time": "2011-07-07T00:52:13Z", "attachment_id": null, "bug_id": 647998, "is_private": false, "author": "bzbarsky@mit.edu", "id": 5577841}]}}}