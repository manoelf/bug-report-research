{"bugs": {"1636053": {"comments": [{"attachment_id": null, "creator": "markh@mozilla.com", "creation_time": "2020-05-07T08:43:31Z", "id": 14802070, "text": "I've many sync pings for my personal account which have, say:\n\n```\n\"devices\": [\n    {\n      \"id\": \"00000000000000000000000000000000\",\n      \"type\": \"desktop\",\n      \"os\": \"Darwin\",\n      \"version\": \"77.0a1\"\n    },\n    {\n      \"id\": \"00000000000000000000000000000000\",\n      \"type\": \"desktop\"\n    }\n  ],\n...\n\"uid\": \"2b...\",\n```\n\nThe ping reports a sync did happen (so we should have a token) and given we report the uid, we should be able to report the device IDs.\n\nThis is true for all recent pings, then they start appearing (on May 2). Without digging deeper and without real evidence, I'm suspecting bug 1604844", "time": "2020-05-07T08:43:31Z", "raw_text": "I've many sync pings for my personal account which have, say:\n\n```\n\"devices\": [\n    {\n      \"id\": \"00000000000000000000000000000000\",\n      \"type\": \"desktop\",\n      \"os\": \"Darwin\",\n      \"version\": \"77.0a1\"\n    },\n    {\n      \"id\": \"00000000000000000000000000000000\",\n      \"type\": \"desktop\"\n    }\n  ],\n...\n\"uid\": \"2b...\",\n```\n\nThe ping reports a sync did happen (so we should have a token) and given we report the uid, we should be able to report the device IDs.\n\nThis is true for all recent pings, then they start appearing (on May 2). Without digging deeper and without real evidence, I'm suspecting bug 1604844", "bug_id": 1636053, "tags": [], "is_private": false, "count": 0, "author": "markh@mozilla.com"}, {"count": 1, "is_private": false, "bug_id": 1636053, "tags": [], "author": "markh@mozilla.com", "time": "2020-05-07T08:46:00Z", "raw_text": "(oh - the top-level `deviceID` field is also missing entirely, which I suspect is just a direct result of whatever the underlying issue is)", "text": "(oh - the top-level `deviceID` field is also missing entirely, which I suspect is just a direct result of whatever the underlying issue is)", "id": 14802073, "attachment_id": null, "creator": "markh@mozilla.com", "creation_time": "2020-05-07T08:46:00Z"}, {"time": "2020-05-07T09:30:30Z", "raw_text": ">  I'm suspecting bug 1604844\n\nOof, yep, the lack of a `return` on this method would probably explain it:\n\n  * https://dxr.mozilla.org/mozilla-central/rev/93a33cb7f2369ac4f1d1f2ac97ec14ba60e1e7d7/services/sync/modules/telemetry.js#583", "is_private": false, "count": 2, "bug_id": 1636053, "tags": [], "author": "ryan@rfk.id.au", "creator": "ryan@rfk.id.au", "attachment_id": null, "creation_time": "2020-05-07T09:30:30Z", "id": 14802141, "text": ">  I'm suspecting bug 1604844\n\nOof, yep, the lack of a `return` on this method would probably explain it:\n\n  * https://dxr.mozilla.org/mozilla-central/rev/93a33cb7f2369ac4f1d1f2ac97ec14ba60e1e7d7/services/sync/modules/telemetry.js#583"}, {"raw_text": "The regressing patch landed in 77, flipping some flags to indicate this.", "time": "2020-05-07T09:59:02Z", "author": "ryan@rfk.id.au", "bug_id": 1636053, "tags": [], "count": 3, "is_private": false, "creation_time": "2020-05-07T09:59:02Z", "attachment_id": null, "creator": "ryan@rfk.id.au", "text": "The regressing patch landed in 77, flipping some flags to indicate this.", "id": 14802180}, {"time": "2020-05-07T10:04:42Z", "raw_text": "", "count": 4, "is_private": false, "tags": [], "bug_id": 1636053, "author": "ryan@rfk.id.au", "creator": "ryan@rfk.id.au", "attachment_id": 9146437, "creation_time": "2020-05-07T10:04:42Z", "text": "Created attachment 9146437\nBug 1636053 - correctly include deviceID in the sync ping. r?markh", "id": 14802190}, {"creation_time": "2020-05-07T10:08:36Z", "attachment_id": null, "creator": "ryan@rfk.id.au", "id": 14802195, "text": "Mark, are you able to share instructions for inspecting sync pings from your own device, for QA purposes? I wasn't able to inspect this information via `about:telemetry`.", "raw_text": "Mark, are you able to share instructions for inspecting sync pings from your own device, for QA purposes? I wasn't able to inspect this information via `about:telemetry`.", "time": "2020-05-07T10:08:36Z", "author": "ryan@rfk.id.au", "bug_id": 1636053, "tags": [], "count": 5, "is_private": false}, {"id": 14802215, "text": "It should be about:telemetry, then \"current data\" -> \"archived ping data\", then \"ping type\" can be selected where \"sync\" is an option - then \"raw payload\" to see the content.", "creator": "markh@mozilla.com", "attachment_id": null, "creation_time": "2020-05-07T10:26:12Z", "count": 6, "is_private": false, "tags": [], "bug_id": 1636053, "author": "markh@mozilla.com", "time": "2020-05-07T10:26:12Z", "raw_text": "It should be about:telemetry, then \"current data\" -> \"archived ping data\", then \"ping type\" can be selected where \"sync\" is an option - then \"raw payload\" to see the content."}, {"creator": "ryan@rfk.id.au", "attachment_id": null, "creation_time": "2020-05-07T10:46:07Z", "id": 14802260, "text": "Thanks, that did the trick! (I didn't realize the \"current data\" thing was a drop-down, for some reason).\n\nThe fix here seems to have resolved the issue.\n\nThe very first sync ping submitted after signing in has valid-looking `deviceID` fields in the individual items in the `devices` array, but not in the top-level fields of the ping. Subsequent pings appear to contain the `deviceID` in the top-level fields as well.", "time": "2020-05-07T10:46:07Z", "raw_text": "Thanks, that did the trick! (I didn't realize the \"current data\" thing was a drop-down, for some reason).\n\nThe fix here seems to have resolved the issue.\n\nThe very first sync ping submitted after signing in has valid-looking `deviceID` fields in the individual items in the `devices` array, but not in the top-level fields of the ping. Subsequent pings appear to contain the `deviceID` in the top-level fields as well.", "bug_id": 1636053, "tags": [], "count": 7, "is_private": false, "author": "ryan@rfk.id.au"}, {"creation_time": "2020-05-07T10:49:22Z", "raw_text": "Pushed by rkelly@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/f603312246a6\ncorrectly include deviceID in the sync ping. r=markh", "attachment_id": null, "creator": "pulsebot@bots.tld", "time": "2020-05-07T10:49:22Z", "text": "Pushed by rkelly@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/f603312246a6\ncorrectly include deviceID in the sync ping. r=markh", "id": 14802263, "author": "pulsebot@bots.tld", "is_private": false, "count": 8, "bug_id": 1636053, "tags": []}, {"attachment_id": null, "creator": "apavel@mozilla.com", "creation_time": "2020-05-07T21:59:06Z", "id": 14803647, "text": "https://hg.mozilla.org/mozilla-central/rev/f603312246a6", "time": "2020-05-07T21:59:06Z", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/f603312246a6", "tags": ["bugherder"], "bug_id": 1636053, "count": 9, "is_private": false, "author": "apavel@mozilla.com"}, {"raw_text": "### Beta/Release Uplift Approval Request\n* **User impact if declined**: No user-visible impact, but it will make analysis of sync-related telemetry pings much more difficult, because we won't be able to distinguish between pings sent from different devices on the same account.\n* **Is this code covered by automated tests?**: Yes\n* **Has the fix been verified in Nightly?**: Yes\n* **Needs manual test from QE?**: No\n* **If yes, steps to reproduce**: IMHO additional manual verification of this is not a good use of someone's time, but if desired, here's what I did to confirm the fix:\n\n* Sign in to Firefox and enable sync\n* Select \"Accounts toolbar icon -> sync now\" to force a sync\n* Restart the browser to flush the sync telemetry ping\n* Go to about:telemetry, change \"current data\" to \"archived ping data\", then change \"ping type\" to \"sync\"\n* Select \"raw payload\" to view the contents of the most recent sync ping\n* Find the \"devices\" field in the resulting JSON, and check that all of the items therein have an \"id\" field that is not a string of 32 zeros.\n* **List of other uplifts needed**: None\n* **Risk to taking this patch**: Low\n* **Why is the change risky/not risky? (and alternatives if risky)**: It's a one-line fix for a pretty scrutable bug (failing to return a value from a method) and the affected code is all internal to the same file as the fix itself, so it seems very low risk to me.\n* **String changes made/needed**: None", "time": "2020-05-08T00:35:07Z", "author": "ryan@rfk.id.au", "tags": [], "bug_id": 1636053, "is_private": false, "count": 10, "creation_time": "2020-05-08T00:35:07Z", "creator": "ryan@rfk.id.au", "attachment_id": 9146437, "id": 14803883, "text": "Comment on attachment 9146437\nBug 1636053 - correctly include deviceID in the sync ping. r?markh\n\n### Beta/Release Uplift Approval Request\n* **User impact if declined**: No user-visible impact, but it will make analysis of sync-related telemetry pings much more difficult, because we won't be able to distinguish between pings sent from different devices on the same account.\n* **Is this code covered by automated tests?**: Yes\n* **Has the fix been verified in Nightly?**: Yes\n* **Needs manual test from QE?**: No\n* **If yes, steps to reproduce**: IMHO additional manual verification of this is not a good use of someone's time, but if desired, here's what I did to confirm the fix:\n\n* Sign in to Firefox and enable sync\n* Select \"Accounts toolbar icon -> sync now\" to force a sync\n* Restart the browser to flush the sync telemetry ping\n* Go to about:telemetry, change \"current data\" to \"archived ping data\", then change \"ping type\" to \"sync\"\n* Select \"raw payload\" to view the contents of the most recent sync ping\n* Find the \"devices\" field in the resulting JSON, and check that all of the items therein have an \"id\" field that is not a string of 32 zeros.\n* **List of other uplifts needed**: None\n* **Risk to taking this patch**: Low\n* **Why is the change risky/not risky? (and alternatives if risky)**: It's a one-line fix for a pretty scrutable bug (failing to return a value from a method) and the affected code is all internal to the same file as the fix itself, so it seems very low risk to me.\n* **String changes made/needed**: None"}, {"author": "pascalc@gmail.com", "is_private": false, "count": 11, "tags": [], "bug_id": 1636053, "raw_text": "Low risk and has tests, uplift approved for the next beta, thanks.", "time": "2020-05-11T08:07:22Z", "text": "Comment on attachment 9146437\nBug 1636053 - correctly include deviceID in the sync ping. r?markh\n\nLow risk and has tests, uplift approved for the next beta, thanks.", "id": 14808853, "creation_time": "2020-05-11T08:07:22Z", "creator": "pascalc@gmail.com", "attachment_id": 9146437}, {"bug_id": 1636053, "tags": ["bugherder", "uplift"], "is_private": false, "count": 12, "author": "aryx.bugmail@gmx-topmail.de", "time": "2020-05-11T09:10:21Z", "raw_text": "https://hg.mozilla.org/releases/mozilla-beta/rev/cf426e586100", "id": 14808956, "text": "https://hg.mozilla.org/releases/mozilla-beta/rev/cf426e586100", "creator": "aryx.bugmail@gmx-topmail.de", "attachment_id": null, "creation_time": "2020-05-11T09:10:21Z"}]}}, "comments": {}}