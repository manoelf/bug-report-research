{"comments": {}, "bugs": {"700979": {"comments": [{"creator": "mozilla@grepular.com", "is_private": false, "creation_time": "2011-11-09T10:58:02Z", "attachment_id": 573151, "tags": [], "count": 0, "text": "Created attachment 573151\nsvg_test_email.txt\n\nUser Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:8.0) Gecko/20100101 Firefox/8.0\nBuild ID: 20111104165243\n\nSteps to reproduce:\n\nNormally, when you click a link in an HTML email, Thunderbird will tell your default browser to visit that page. It is possible however to get Thunderbird to open the page in a Thunderbird tab instead though, if you use an inline SVG image. Here is an example SVG with two such links:\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\">\n\n  <a xlink:href=\"https://www.mozilla.org/\" xlink:show=\"new\">\n     <text x=\"0\" y=\"12\" font-family=\"Verdana\" font-size=\"12\" fill=\"black\">link 1</text>\n  </a>\n\n  <a xlink:href=\"https://www.mozilla.org/\" target=\"_blank\">\n     <text x=\"50\" y=\"12\" font-family=\"Verdana\" font-size=\"12\" fill=\"black\">link 2</text>\n  </a>\n\n</svg>\n\nI have attached a full example of an email which does this.\n\nI will mark this ticket as \"hidden\" initially, in case there are any security implications of being able to open remote pages within the context of Thunderbird.\n\nThere is definitely the problem that using this method an attacker could get you to open a page without any security defences that your default browser might have, such as NoScript, proxy configuration, Tor usage etc.", "author": "mozilla@grepular.com", "bug_id": 700979, "id": 5836617, "time": "2011-11-09T10:58:02Z", "raw_text": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:8.0) Gecko/20100101 Firefox/8.0\nBuild ID: 20111104165243\n\nSteps to reproduce:\n\nNormally, when you click a link in an HTML email, Thunderbird will tell your default browser to visit that page. It is possible however to get Thunderbird to open the page in a Thunderbird tab instead though, if you use an inline SVG image. Here is an example SVG with two such links:\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\">\n\n  <a xlink:href=\"https://www.mozilla.org/\" xlink:show=\"new\">\n     <text x=\"0\" y=\"12\" font-family=\"Verdana\" font-size=\"12\" fill=\"black\">link 1</text>\n  </a>\n\n  <a xlink:href=\"https://www.mozilla.org/\" target=\"_blank\">\n     <text x=\"50\" y=\"12\" font-family=\"Verdana\" font-size=\"12\" fill=\"black\">link 2</text>\n  </a>\n\n</svg>\n\nI have attached a full example of an email which does this.\n\nI will mark this ticket as \"hidden\" initially, in case there are any security implications of being able to open remote pages within the context of Thunderbird.\n\nThere is definitely the problem that using this method an attacker could get you to open a page without any security defences that your default browser might have, such as NoScript, proxy configuration, Tor usage etc."}, {"bug_id": 700979, "id": 5838882, "author": "dveditz@mozilla.com", "text": "Since there's no protocol on an in-line message to know how to load it remotely this is probably by design, but we need to make sure we have a safe principal for this content. If the SVG image had <script> tags would the scripts run (they wouldn't as an image, but might as a document)? If they ran would they have a safe principal?", "count": 1, "raw_text": "Since there's no protocol on an in-line message to know how to load it remotely this is probably by design, but we need to make sure we have a safe principal for this content. If the SVG image had <script> tags would the scripts run (they wouldn't as an image, but might as a document)? If they ran would they have a safe principal?", "time": "2011-11-10T00:27:02Z", "is_private": false, "creation_time": "2011-11-10T00:27:02Z", "creator": "dveditz@mozilla.com", "tags": [], "attachment_id": null}, {"tags": [], "time": "2011-11-10T09:44:08Z", "raw_text": "I already tested sticking script tags within an inline SVG. I also tested using a multipart/related SVG attachment which contains script, and embedding that in the HTML part of the email using Content-Id/CID:. In neither case was the script executed, thankfully. I also tried using CSS to pull in remote content for both of these SVG tests, to try and bypass the default remote content block, and again, that didn't work.\n\nA URL that is opened within Thunderbird in a new tab, using this SVG link method, happily executes script, but I don't think that is a problem? I looked at the attributes on the \"window\" object and I didn't see anything there unusual.\n\nAs an end user, when I click a link in an email in Thunderbird, I expect it to open in my browser, not in Thunderbird. My browser has numerous security extensions installed and runs under a different UID to Thunderbird. This \"flaw\" allows an attacker to bypass those defences.\n\nI wonder if you could abuse this technique as part of a wider phishing attack also? You have complete control over the content of the new tab that is opened, so it should be possible to create a second fake email display tab, or calendar tab.", "attachment_id": null, "id": 5839530, "bug_id": 700979, "creation_time": "2011-11-10T09:44:08Z", "is_private": false, "creator": "mozilla@grepular.com", "text": "I already tested sticking script tags within an inline SVG. I also tested using a multipart/related SVG attachment which contains script, and embedding that in the HTML part of the email using Content-Id/CID:. In neither case was the script executed, thankfully. I also tried using CSS to pull in remote content for both of these SVG tests, to try and bypass the default remote content block, and again, that didn't work.\n\nA URL that is opened within Thunderbird in a new tab, using this SVG link method, happily executes script, but I don't think that is a problem? I looked at the attributes on the \"window\" object and I didn't see anything there unusual.\n\nAs an end user, when I click a link in an email in Thunderbird, I expect it to open in my browser, not in Thunderbird. My browser has numerous security extensions installed and runs under a different UID to Thunderbird. This \"flaw\" allows an attacker to bypass those defences.\n\nI wonder if you could abuse this technique as part of a wider phishing attack also? You have complete control over the content of the new tab that is opened, so it should be possible to create a second fake email display tab, or calendar tab.", "count": 2, "author": "mozilla@grepular.com"}, {"time": "2011-11-17T01:05:52Z", "attachment_id": null, "raw_text": "I completely misunderstood and thought the SVG \"image\" itself was what was being opened in a tab, like other inline images. You mean the mail contains links to random urls and those urls open in Thunderbird, as opposed to what happens with the same <a href=\"\"> in an HTML mail.\n\nThis is a bug. Lacking a URL bar of any kind this is also way too prone to spoofing, whether as some other site or even part of the Thunderbird UI itself (which is using tabs a lot these days).", "tags": [], "creator": "dveditz@mozilla.com", "author": "dveditz@mozilla.com", "count": 3, "text": "I completely misunderstood and thought the SVG \"image\" itself was what was being opened in a tab, like other inline images. You mean the mail contains links to random urls and those urls open in Thunderbird, as opposed to what happens with the same <a href=\"\"> in an HTML mail.\n\nThis is a bug. Lacking a URL bar of any kind this is also way too prone to spoofing, whether as some other site or even part of the Thunderbird UI itself (which is using tabs a lot these days).", "id": 5854164, "bug_id": 700979, "is_private": false, "creation_time": "2011-11-17T01:05:52Z"}, {"is_private": false, "creation_time": "2011-11-17T09:37:00Z", "bug_id": 700979, "id": 5854870, "author": "mozilla@grepular.com", "count": 4, "text": "That is what I meant yes. The SVG displays inside the normal email display, just like a normal image, but the SVG contains anchor tags. Clicking one of those links does actually open the URL in your default browser *unless* you add one of these two attributes to it:\n\nxlink:show=\"new\"\ntarget=\"_blank\"\n\nThen, the URL opens in a Thunderbird tab instead. I tested the target=\"_blank\" attribute with a normal non-svg anchor tag, and it processed that one correctly, opening it in my default browsers window. It's only when it's used inside an SVG anchor tag that it does this. The example email I attached to this bug demonstrates the problem.\n\nLike you said, this could be potentially abused to spoof parts of the Thunderbird UI. It can also be used to bypass your default browsers security mechanisms.", "creator": "mozilla@grepular.com", "tags": [], "attachment_id": null, "raw_text": "That is what I meant yes. The SVG displays inside the normal email display, just like a normal image, but the SVG contains anchor tags. Clicking one of those links does actually open the URL in your default browser *unless* you add one of these two attributes to it:\n\nxlink:show=\"new\"\ntarget=\"_blank\"\n\nThen, the URL opens in a Thunderbird tab instead. I tested the target=\"_blank\" attribute with a normal non-svg anchor tag, and it processed that one correctly, opening it in my default browsers window. It's only when it's used inside an SVG anchor tag that it does this. The example email I attached to this bug demonstrates the problem.\n\nLike you said, this could be potentially abused to spoof parts of the Thunderbird UI. It can also be used to bypass your default browsers security mechanisms.", "time": "2011-11-17T09:37:00Z"}, {"tags": [], "raw_text": "This is just a heads up. I write a technical/security blog and intend to write this up at some point next week. I think 26 months is a long enough period for responsible disclosure ;)", "attachment_id": null, "time": "2014-01-23T13:40:57Z", "creation_time": "2014-01-23T13:40:57Z", "is_private": false, "bug_id": 700979, "id": 8325254, "text": "This is just a heads up. I write a technical/security blog and intend to write this up at some point next week. I think 26 months is a long enough period for responsible disclosure ;)", "count": 5, "author": "mozilla@grepular.com", "creator": "mozilla@grepular.com"}, {"tags": [], "raw_text": "You actually discussed it publicly on the Tor developer email list today.", "attachment_id": null, "time": "2014-01-27T05:11:42Z", "is_private": false, "creation_time": "2014-01-27T05:11:42Z", "bug_id": 700979, "id": 8335629, "text": "You actually discussed it publicly on the Tor developer email list today.", "count": 6, "author": "albill@gmail.com", "creator": "albill@gmail.com"}, {"raw_text": "Blog post is at https://grepular.com/Security_Bug_Thunderbird_Websites_Tabs.\n\nCommenter there notes: 'It applies only to the \"View Message Body As Original HTML\".'", "time": "2014-01-27T05:13:45Z", "text": "Blog post is at https://grepular.com/Security_Bug_Thunderbird_Websites_Tabs.\n\nCommenter there notes: 'It applies only to the \"View Message Body As Original HTML\".'", "count": 7, "author": "albill@gmail.com", "bug_id": 700979, "id": 8335630, "attachment_id": null, "tags": [], "creator": "albill@gmail.com", "creation_time": "2014-01-27T05:13:45Z", "is_private": false}, {"tags": [], "attachment_id": null, "raw_text": "Yes. I did. Shortly after I wrote the blog post I stated I would.", "time": "2014-01-27T09:28:11Z", "creation_time": "2014-01-27T09:28:11Z", "is_private": false, "id": 8336025, "bug_id": 700979, "author": "mozilla@grepular.com", "count": 8, "text": "Yes. I did. Shortly after I wrote the blog post I stated I would.", "creator": "mozilla@grepular.com"}, {"time": "2014-01-27T20:12:25Z", "raw_text": "A Tor thunderbird user (Torbirdy) commented on their discussion list:\n\n\"When I opened that email and set View/Message Body As/Original HTML, \nTorbirdy did not prevent the tab to load nor refuse to display the HTML.\"\n\nSo, HTML is displayed but not without user interaction to view the original HTML.", "attachment_id": null, "tags": [], "creator": "albill@gmail.com", "text": "A Tor thunderbird user (Torbirdy) commented on their discussion list:\n\n\"When I opened that email and set View/Message Body As/Original HTML, \nTorbirdy did not prevent the tab to load nor refuse to display the HTML.\"\n\nSo, HTML is displayed but not without user interaction to view the original HTML.", "count": 9, "author": "albill@gmail.com", "bug_id": 700979, "id": 8338489, "is_private": false, "creation_time": "2014-01-27T20:12:25Z"}, {"author": "jporterbugs@gmail.com", "text": "Created attachment 8366472\nFix it\n\nIt turns out this is pretty easy to fix, actually. Here's a patch that works, but probably needs more tuning, e.g. catching similar cases for MathML. Also tests would be good. I'm not sure if I'll be able to do any more with this before next week though, so other enterprising folks are welcome to take over.\n\nAlso, I fixed the indentation and brace style in the file because it was gross.", "count": 10, "creator": "jporterbugs@gmail.com", "is_private": false, "creation_time": "2014-01-28T06:33:56Z", "bug_id": 700979, "id": 8340714, "attachment_id": 8366472, "raw_text": "It turns out this is pretty easy to fix, actually. Here's a patch that works, but probably needs more tuning, e.g. catching similar cases for MathML. Also tests would be good. I'm not sure if I'll be able to do any more with this before next week though, so other enterprising folks are welcome to take over.\n\nAlso, I fixed the indentation and brace style in the file because it was gross.", "time": "2014-01-28T06:33:56Z", "tags": []}, {"attachment_id": null, "raw_text": "I think a couple of comments by \"Al Billings\" above just confuse matters a little. So to clear things up: All that needs to happen in order for this bug to be triggered is:\n\n1.) User installs Thunderbird\n2.) User receives email\n3.) User clicks link\n\n\"View Message Body As Original HTML\" is *the default* in Thunderbird. \"TorBirdy\" is an addon that a tiny minority of Thunderbird users use, and which changes that default to viewing messages as plain text. When messages are viewed in this non-default configuration, the bug apparently isn't triggered.", "time": "2014-01-28T07:07:41Z", "tags": [], "author": "mozilla@grepular.com", "text": "I think a couple of comments by \"Al Billings\" above just confuse matters a little. So to clear things up: All that needs to happen in order for this bug to be triggered is:\n\n1.) User installs Thunderbird\n2.) User receives email\n3.) User clicks link\n\n\"View Message Body As Original HTML\" is *the default* in Thunderbird. \"TorBirdy\" is an addon that a tiny minority of Thunderbird users use, and which changes that default to viewing messages as plain text. When messages are viewed in this non-default configuration, the bug apparently isn't triggered.", "count": 11, "creator": "mozilla@grepular.com", "is_private": false, "creation_time": "2014-01-28T07:07:41Z", "id": 8340804, "bug_id": 700979}, {"count": 12, "text": "News article: http://www.networkworld.com/community/node/84683", "author": "ben.bucksch@beonex.com", "creator": "ben.bucksch@beonex.com", "creation_time": "2014-01-28T13:42:03Z", "is_private": false, "bug_id": 700979, "id": 8341809, "raw_text": "News article: http://www.networkworld.com/community/node/84683", "attachment_id": null, "time": "2014-01-28T13:42:03Z", "tags": []}, {"id": 8341827, "bug_id": 700979, "creation_time": "2014-01-28T13:48:05Z", "is_private": false, "creator": "ben.bucksch@beonex.com", "author": "ben.bucksch@beonex.com", "count": 13, "text": "As the patch: If we're serious about fixing this, we need to catch all cases, present and future, without exception. I don't think we can achieve this by listing all ways that a link can be expressed, because we're sure to miss one sooner or later.\nRather, we should catch all link clicks, e.g. on a DocShell level or similar container level, independent from content, and then treat all links as external, unless they meet certain criteria for internal links. I.e. whitelist instead of blacklist.", "tags": [], "time": "2014-01-28T13:48:05Z", "attachment_id": null, "raw_text": "As the patch: If we're serious about fixing this, we need to catch all cases, present and future, without exception. I don't think we can achieve this by listing all ways that a link can be expressed, because we're sure to miss one sooner or later.\nRather, we should catch all link clicks, e.g. on a DocShell level or similar container level, independent from content, and then treat all links as external, unless they meet certain criteria for internal links. I.e. whitelist instead of blacklist."}]}}}