{"comments": {}, "bugs": {"638815": {"comments": [{"tags": [], "creation_time": "2011-03-04T16:54:01Z", "bug_id": 638815, "raw_text": "In trying to fix all the .list files for reftests to fails-if(Android) so we can see green, I have ran into an issue where tests randomly fail for every run.\n\nAt first I had about 230 tests which failed on Android.  This was determined by running a single .list file and documenting the failures, rerunning it twice and verifying it is green both times.\n\nThen I put it all together into the main reftest.list and have found that I would get random failures.  A lot of the same tests would show up after 10 runs, so I added some random-if(Android) to document those tests (now ~100) and low and behold new tests kept cropping up that would fail.  On average I get about 4 failures per run (have done well over 100 runs at chunk 1 of 2).\n\nRather than random-if(Android) for everything, it is evident that there is an underlying problem.  Here is the list of differences I see between this test run and a desktop firefox:\n1) fennec\n2) android\n3) remote (http vs file)\n4) ipc (remote=true)\n\nI did some experimenting and found that running remotely on a desktop Firefox build yields some random oranges, but at a rate of <1 per test run.  \n\nI am confused because running crashtests,jsreftests, or chunks 2 of 2 seems to be a lot more stable than chunk 1 of 2 for the regular reftests.  This makes me think that our tools are working well and some specific thing we are testing in the first 2600 reftests are causing problems in fennec.", "is_private": false, "id": 5321871, "time": "2011-03-04T16:54:01Z", "creator": "jmaher@mozilla.com", "attachment_id": null, "count": 0, "text": "In trying to fix all the .list files for reftests to fails-if(Android) so we can see green, I have ran into an issue where tests randomly fail for every run.\n\nAt first I had about 230 tests which failed on Android.  This was determined by running a single .list file and documenting the failures, rerunning it twice and verifying it is green both times.\n\nThen I put it all together into the main reftest.list and have found that I would get random failures.  A lot of the same tests would show up after 10 runs, so I added some random-if(Android) to document those tests (now ~100) and low and behold new tests kept cropping up that would fail.  On average I get about 4 failures per run (have done well over 100 runs at chunk 1 of 2).\n\nRather than random-if(Android) for everything, it is evident that there is an underlying problem.  Here is the list of differences I see between this test run and a desktop firefox:\n1) fennec\n2) android\n3) remote (http vs file)\n4) ipc (remote=true)\n\nI did some experimenting and found that running remotely on a desktop Firefox build yields some random oranges, but at a rate of <1 per test run.  \n\nI am confused because running crashtests,jsreftests, or chunks 2 of 2 seems to be a lot more stable than chunk 1 of 2 for the regular reftests.  This makes me think that our tools are working well and some specific thing we are testing in the first 2600 reftests are causing problems in fennec.", "author": "jmaher@mozilla.com"}, {"id": 5321930, "author": "jmaher@mozilla.com", "time": "2011-03-04T17:13:16Z", "count": 1, "text": "Here is an example command line that exhibits this behavior:\npython reftest/remotereftest.py --deviceIP=192.168.1.103 --xre-path=../bin --utility-path=../bin --app=org.mozilla.fennec reftest/tests/layout/reftests/bugs/reftest.list\n\nWhat I have here is a device at 192.168.1.103 with a SUTAgent installed, and a desktop build of firefox where I did a make package-tests and 'cd dist/test-package-tests'.  \n\nRun this 5 times in a row and you will get many different results.", "attachment_id": null, "is_private": false, "creator": "jmaher@mozilla.com", "tags": [], "raw_text": "Here is an example command line that exhibits this behavior:\npython reftest/remotereftest.py --deviceIP=192.168.1.103 --xre-path=../bin --utility-path=../bin --app=org.mozilla.fennec reftest/tests/layout/reftests/bugs/reftest.list\n\nWhat I have here is a device at 192.168.1.103 with a SUTAgent installed, and a desktop build of firefox where I did a make package-tests and 'cd dist/test-package-tests'.  \n\nRun this 5 times in a row and you will get many different results.", "creation_time": "2011-03-04T17:13:16Z", "bug_id": 638815}, {"time": "2011-03-05T01:44:48Z", "author": "cjones.bugs@gmail.com", "id": 5323303, "count": 2, "text": "This isn't too surprising; a few months ago, all the reftests were passing on desktop linux with remote=true, but now ~30-40 are failing.  Yesterday I ran all the reftests on desktop-linux with a build config more like what we ship on android, and ~100 tests were failing.\n\nIt's going to take a good chunk of work just to sort out the failures on desktop-linux, and android will introduce additional problems on top of that.  And, loading all tests over HTTP will likely introduce yet more issues.  In the meantime, I would aim for a less ambitious goal --- just try to get the same subset of tests that are running on tinderbox for desktop-linux passing on the tegras, or get an idea of which are failing and we can try to understand why.\n\nGuessing from the command line in comment 1, you should be able to run the reftest subset (reftest-sanity) with\n  python reftest/remotereftest.py --deviceIP=192.168.1.103 --xre-path=../bin\n--utility-path=../bin --app=org.mozilla.fennec\nreftest/tests/layout/reftests/reftest-sanity/reftest.list\n\nIf those tests are failing, pasting reftest log(s) here would help a lot in understanding what the problems might be.", "attachment_id": null, "is_private": false, "bug_id": 638815, "creation_time": "2011-03-05T01:44:48Z", "raw_text": "This isn't too surprising; a few months ago, all the reftests were passing on desktop linux with remote=true, but now ~30-40 are failing.  Yesterday I ran all the reftests on desktop-linux with a build config more like what we ship on android, and ~100 tests were failing.\n\nIt's going to take a good chunk of work just to sort out the failures on desktop-linux, and android will introduce additional problems on top of that.  And, loading all tests over HTTP will likely introduce yet more issues.  In the meantime, I would aim for a less ambitious goal --- just try to get the same subset of tests that are running on tinderbox for desktop-linux passing on the tegras, or get an idea of which are failing and we can try to understand why.\n\nGuessing from the command line in comment 1, you should be able to run the reftest subset (reftest-sanity) with\n  python reftest/remotereftest.py --deviceIP=192.168.1.103 --xre-path=../bin\n--utility-path=../bin --app=org.mozilla.fennec\nreftest/tests/layout/reftests/reftest-sanity/reftest.list\n\nIf those tests are failing, pasting reftest log(s) here would help a lot in understanding what the problems might be.", "tags": [], "creator": "cjones.bugs@gmail.com"}, {"count": 3, "text": "Created attachment 517120\nreftest-sanity run on android remotely\n\nthis patch shows 53 successful runs on Android, the only change I made to the manifest is:\nfails-if(xulRuntime.OS!=\"Linux\"&&!Android) == data:text/html,<body>Linux data:text/html,<script>document.write(navigator.platform.substr(0,5))</script>\n\nOverall, this is a pretty consistent result I get.  This is also running in 2 chunks on: http://tinderbox.mozilla.org/showbuilds.cgi?tree=Mobile&noignore=1.", "author": "jmaher@mozilla.com", "time": "2011-03-05T12:24:28Z", "id": 5323914, "raw_text": "this patch shows 53 successful runs on Android, the only change I made to the manifest is:\nfails-if(xulRuntime.OS!=\"Linux\"&&!Android) == data:text/html,<body>Linux data:text/html,<script>document.write(navigator.platform.substr(0,5))</script>\n\nOverall, this is a pretty consistent result I get.  This is also running in 2 chunks on: http://tinderbox.mozilla.org/showbuilds.cgi?tree=Mobile&noignore=1.", "creation_time": "2011-03-05T12:24:28Z", "bug_id": 638815, "creator": "jmaher@mozilla.com", "tags": [], "is_private": false, "attachment_id": 517120}, {"tags": [], "raw_text": "this weekend I found that I could run large volumes of tests over and over again with no failures.  The only difference was I had to comment out certain include lines in the reftest.list file.\n\nThis leads me to believe that in general IPC and remote testing are working fine.  Another thing I ruled out was a large volume of tests, fails-if, random-if, and skip-if conditions, that had no effect on random oranges.  I suspect that we hit certain code paths in these troublesome directories which cause random failures to occur.  \n\nI was able to run 40 runs in a row last night on chunk 1 of 2 for all reftests on my tegra device with these turned off:\njoel@joel-laptop:~/mozilla/src$ grep Android layout/reftests/reftest.list \nskip-if(Android) include border-image/reftest.list\nskip-if(Android) include bugs/reftest.list\nskip-if(Android) include css-disabled/reftest.list\nskip-if(Android) include css-enabled/reftest.list\nskip-if(Android) include css-valid/reftest.list\nskip-if(Android) include css-invalid/reftest.list\nskip-if(Android) include css-ui-invalid/reftest.list\nskip-if(Android) include css-ui-valid/reftest.list\nskip-if(Android) include first-letter/reftest.list\nskip-if(Android) include forms/reftest.list\nskip-if(Android) include native-theme/reftest.list\nskip-if(Android) include text-shadow/reftest.list\njoel@joel-laptop:~/mozilla/src$ \n\n\nMy new approach to get tests running for android is to provide a patch that allows for skip-if before and include directive as well as skipping these troublesome directories.", "creation_time": "2011-03-07T15:27:23Z", "bug_id": 638815, "is_private": false, "id": 5327144, "time": "2011-03-07T15:27:23Z", "creator": "jmaher@mozilla.com", "attachment_id": null, "text": "this weekend I found that I could run large volumes of tests over and over again with no failures.  The only difference was I had to comment out certain include lines in the reftest.list file.\n\nThis leads me to believe that in general IPC and remote testing are working fine.  Another thing I ruled out was a large volume of tests, fails-if, random-if, and skip-if conditions, that had no effect on random oranges.  I suspect that we hit certain code paths in these troublesome directories which cause random failures to occur.  \n\nI was able to run 40 runs in a row last night on chunk 1 of 2 for all reftests on my tegra device with these turned off:\njoel@joel-laptop:~/mozilla/src$ grep Android layout/reftests/reftest.list \nskip-if(Android) include border-image/reftest.list\nskip-if(Android) include bugs/reftest.list\nskip-if(Android) include css-disabled/reftest.list\nskip-if(Android) include css-enabled/reftest.list\nskip-if(Android) include css-valid/reftest.list\nskip-if(Android) include css-invalid/reftest.list\nskip-if(Android) include css-ui-invalid/reftest.list\nskip-if(Android) include css-ui-valid/reftest.list\nskip-if(Android) include first-letter/reftest.list\nskip-if(Android) include forms/reftest.list\nskip-if(Android) include native-theme/reftest.list\nskip-if(Android) include text-shadow/reftest.list\njoel@joel-laptop:~/mozilla/src$ \n\n\nMy new approach to get tests running for android is to provide a patch that allows for skip-if before and include directive as well as skipping these troublesome directories.", "count": 4, "author": "jmaher@mozilla.com"}, {"id": 5327593, "time": "2011-03-07T18:23:39Z", "is_private": false, "tags": [], "creation_time": "2011-03-07T18:23:39Z", "bug_id": 638815, "raw_text": "Was going to point out bug 473817, but I see you found it already.\n\nThis sounds good, but if disabling a bunch of these directories looks like it will be a high maintenance burden, it might be easier to just fix the failing tests.", "author": "cjones.bugs@gmail.com", "count": 5, "text": "Was going to point out bug 473817, but I see you found it already.\n\nThis sounds good, but if disabling a bunch of these directories looks like it will be a high maintenance burden, it might be easier to just fix the failing tests.", "attachment_id": null, "creator": "cjones.bugs@gmail.com"}, {"text": "well, we have a large list of tests that we should investigate which are already fails-if(Android).  It would be nice if we could start turning on tests from these skipped directories after we get these tests turned on and can spend some time debugging the failures.\n\nIt boils down to I have already spent a full week and a half trying to figure out what tests we can run and we need to get some tests running on android sooner than later.  \n\nMaybe this list of skipped directories can help narrow down the problem of random failing reftests.", "count": 6, "id": 5327623, "author": "jmaher@mozilla.com", "time": "2011-03-07T18:31:40Z", "creator": "jmaher@mozilla.com", "tags": [], "raw_text": "well, we have a large list of tests that we should investigate which are already fails-if(Android).  It would be nice if we could start turning on tests from these skipped directories after we get these tests turned on and can spend some time debugging the failures.\n\nIt boils down to I have already spent a full week and a half trying to figure out what tests we can run and we need to get some tests running on android sooner than later.  \n\nMaybe this list of skipped directories can help narrow down the problem of random failing reftests.", "bug_id": 638815, "creation_time": "2011-03-07T18:31:40Z", "attachment_id": null, "is_private": false}, {"text": "Created attachment 523075\nconditionally pull out orange directories (1.0)\n\nthis is a patch to get us running green for the time being.  All of these tests that I am pulling out will run green by themselves, but when run as a set or >1 times there is a good chance that some tests will fail.", "count": 7, "time": "2011-03-30T19:00:56Z", "author": "jmaher@mozilla.com", "id": 5381057, "bug_id": 638815, "creation_time": "2011-03-30T19:00:56Z", "raw_text": "this is a patch to get us running green for the time being.  All of these tests that I am pulling out will run green by themselves, but when run as a set or >1 times there is a good chance that some tests will fail.", "tags": [], "creator": "jmaher@mozilla.com", "attachment_id": 523075, "is_private": false}, {"time": "2011-03-31T01:17:17Z", "id": 5382079, "bug_id": 638815, "creation_time": "2011-03-31T01:17:17Z", "raw_text": "Since these tests are green when run alone, they are great candidates for someone from Mobile Dev to look at and get green all the time.", "tags": [], "is_private": false, "text": "Comment on attachment 523075\nconditionally pull out orange directories (1.0)\n\nSince these tests are green when run alone, they are great candidates for someone from Mobile Dev to look at and get green all the time.", "count": 8, "author": "mark.finkle@gmail.com", "creator": "mark.finkle@gmail.com", "attachment_id": 523075}, {"count": 9, "text": "landed on mozilla-central:\nhttp://hg.mozilla.org/mozilla-central/pushloghtml?changeset=6f02e5c7d02c\n\nI am leaving this bug open so we can investigate the randomness that this bug comments out.", "author": "jmaher@mozilla.com", "creator": "jmaher@mozilla.com", "attachment_id": null, "time": "2011-03-31T17:58:49Z", "id": 5383743, "raw_text": "landed on mozilla-central:\nhttp://hg.mozilla.org/mozilla-central/pushloghtml?changeset=6f02e5c7d02c\n\nI am leaving this bug open so we can investigate the randomness that this bug comments out.", "creation_time": "2011-03-31T17:58:49Z", "bug_id": 638815, "tags": [], "is_private": false}, {"id": 6315327, "time": "2012-05-17T12:57:06Z", "is_private": false, "tags": [], "bug_id": 638815, "creation_time": "2012-05-17T12:57:06Z", "raw_text": "", "author": "jmaher@mozilla.com", "count": 10, "text": "*** Bug 551269 has been marked as a duplicate of this bug. ***", "attachment_id": null, "creator": "jmaher@mozilla.com"}, {"tags": [], "raw_text": "I continue to run into this problem and will probably disable even more tests to get running on android native.\n\nIf anybody has tips for figuring out how earlier reftests affect later reftests, I am all ears.", "creation_time": "2012-05-17T13:02:16Z", "bug_id": 638815, "is_private": false, "id": 6315343, "time": "2012-05-17T13:02:16Z", "creator": "jmaher@mozilla.com", "attachment_id": null, "count": 11, "text": "I continue to run into this problem and will probably disable even more tests to get running on android native.\n\nIf anybody has tips for figuring out how earlier reftests affect later reftests, I am all ears.", "author": "jmaher@mozilla.com"}]}}}