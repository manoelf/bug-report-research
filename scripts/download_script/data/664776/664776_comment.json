{"bugs": {"664776": {"comments": [{"creator": "kliu@code.kliu.org", "author": "kliu@code.kliu.org", "raw_text": "There are two ways to reverse native theme images for RTL UIs:\n\n1) Manually, by using SetLayout to reverse the device context.  The downside to this approach is this also reverses the positioning, so it is necessary to manually transform the widget and clip rects to compensate.\n\n2) Automatically, by using DrawThemeBackgroundEx and passing along the DTBG_MIRRORDC flag.\n\nA few years ago, when I implemented DrawThemeBGRTLAware, I went with method 1 because the MSDN docs said that DrawThemeBackgroundEx will soon be removed.  In the Vista era, the uxtheme header said that DrawThemeBackgroundEx will be removed \"after beta 2\".  But not only did it survive into Vista RTM, it survived Windows 7 as well (the same now-outdated comment still persists, verbatim, in the uxtheme header).  So it's starting to look like that they've backtracked on that decision (it never made much sense to deprecate an -Ex API that has more functionality in favor of the non-Ex).\n\nSince it doesn't look like DrawThemeBackgroundEx is going to go anywhere, I think it's worth redoing DrawThemeBGRTLAware using method 2 (and with a less hackish implementation of RTL-aware DTBG, we might even convert all of our DTBG calls into RTL-aware DTBGEx calls, instead of the current conservative approach of using the RTL-aware code path only for a hardcoded list of parts that we know to be directional in the default theme).\n\nTo be extra-safe, we might consider waiting until the Windows 8 beta (IIRC, should just be a few months away?) to confirm that DrawThemeBackgroundEx really isn't headed for the big bitbucket in the sky.", "creation_time": "2011-06-16T17:53:53Z", "text": "Created attachment 539827\nuse DrawThemeBackgroundEx instead of SetLayout and rect transforms\n\nThere are two ways to reverse native theme images for RTL UIs:\n\n1) Manually, by using SetLayout to reverse the device context.  The downside to this approach is this also reverses the positioning, so it is necessary to manually transform the widget and clip rects to compensate.\n\n2) Automatically, by using DrawThemeBackgroundEx and passing along the DTBG_MIRRORDC flag.\n\nA few years ago, when I implemented DrawThemeBGRTLAware, I went with method 1 because the MSDN docs said that DrawThemeBackgroundEx will soon be removed.  In the Vista era, the uxtheme header said that DrawThemeBackgroundEx will be removed \"after beta 2\".  But not only did it survive into Vista RTM, it survived Windows 7 as well (the same now-outdated comment still persists, verbatim, in the uxtheme header).  So it's starting to look like that they've backtracked on that decision (it never made much sense to deprecate an -Ex API that has more functionality in favor of the non-Ex).\n\nSince it doesn't look like DrawThemeBackgroundEx is going to go anywhere, I think it's worth redoing DrawThemeBGRTLAware using method 2 (and with a less hackish implementation of RTL-aware DTBG, we might even convert all of our DTBG calls into RTL-aware DTBGEx calls, instead of the current conservative approach of using the RTL-aware code path only for a hardcoded list of parts that we know to be directional in the default theme).\n\nTo be extra-safe, we might consider waiting until the Windows 8 beta (IIRC, should just be a few months away?) to confirm that DrawThemeBackgroundEx really isn't headed for the big bitbucket in the sky.", "attachment_id": 539827, "time": "2011-06-16T17:53:53Z", "tags": [], "count": 0, "is_private": false, "id": 5537066, "bug_id": 664776}, {"author": "jmathies@mozilla.com", "creator": "jmathies@mozilla.com", "bug_id": 664776, "id": 5546638, "is_private": false, "count": 1, "tags": [], "attachment_id": null, "time": "2011-06-21T21:37:20Z", "text": "ehhh..\n\n\"This function is available through Windows XP Service Pack 2 (SP2) and Windows Server 2003. It might be altered or unavailable in subsequent versions of Windows.\"\n\nIs there anything in the current implementation that hinders other work? Moving toward an api marked for depreciation vs. something that works doesn't make much sense, unless DrawThemeBGRTLAware is broken in some way.", "creation_time": "2011-06-21T21:37:20Z", "raw_text": "ehhh..\n\n\"This function is available through Windows XP Service Pack 2 (SP2) and Windows Server 2003. It might be altered or unavailable in subsequent versions of Windows.\"\n\nIs there anything in the current implementation that hinders other work? Moving toward an api marked for depreciation vs. something that works doesn't make much sense, unless DrawThemeBGRTLAware is broken in some way."}, {"time": "2011-06-21T21:52:51Z", "attachment_id": null, "text": "And the SDK header had the same deprecation warning since the Vista beta.  There isn't much in the way of tangible benefit; it's cleaner code.  This is the way that I originally wanted to implement DrawThemeBGRTLAware before being scared off by that deprecation warning; I'm just revisiting it now that it looks like Microsoft isn't making good on that deprecation threat.  We can wait for Win8 to confirm that it's really not going to be deprecated.", "raw_text": "And the SDK header had the same deprecation warning since the Vista beta.  There isn't much in the way of tangible benefit; it's cleaner code.  This is the way that I originally wanted to implement DrawThemeBGRTLAware before being scared off by that deprecation warning; I'm just revisiting it now that it looks like Microsoft isn't making good on that deprecation threat.  We can wait for Win8 to confirm that it's really not going to be deprecated.", "creation_time": "2011-06-21T21:52:51Z", "bug_id": 664776, "id": 5546684, "tags": [], "count": 2, "is_private": false, "author": "kliu@code.kliu.org", "creator": "kliu@code.kliu.org"}, {"time": "2011-06-23T16:39:50Z", "attachment_id": 539827, "text": "Comment on attachment 539827\nuse DrawThemeBackgroundEx instead of SetLayout and rect transforms\n\nLet's wait for another rev of the os and see what happens.", "creation_time": "2011-06-23T16:39:50Z", "raw_text": "Let's wait for another rev of the os and see what happens.", "bug_id": 664776, "id": 5551319, "is_private": false, "count": 3, "tags": [], "author": "jmathies@mozilla.com", "creator": "jmathies@mozilla.com"}]}}, "comments": {}}