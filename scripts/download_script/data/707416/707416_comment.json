{"bugs": {"707416": {"comments": [{"attachment_id": null, "tags": [], "creator": "ronen.zilberman@gmail.com", "creation_time": "2011-12-03T09:45:06Z", "is_private": false, "time": "2011-12-03T09:45:06Z", "raw_text": "I am trying to be able to cancel navigations (document location changes).\nI am using a progress listener and call the cancel() method on the Request object passed to the onStateChange() listener function.\n\nThis works for clicks on link, however it does not work for the Forward and Back buttons consistently: Mostly, the call is ignored and the location changes, however sometimes it does cancel.\n\nRun the POC code and play with your responses while pressing links, Back and Forward.\n\n\n-----------------------------------------------------------\n\nvar PL = {\n\nonStateChange: function(aBrowser, aWebProgress, aRequest, aFlag, aStatus) {\n\nif(aFlag & Components.interfaces.nsIWebProgressListener.STATE_START) {\n\nvar promptService = Components.classes[\"@mozilla.org/embedcomp/prompt-service;1\"].getService(Components.interfaces.nsIPromptService);\nvar res = promptService.confirm(window, \"\", \"shall I go?\");\n if (!res) {\n    aRequest.cancel(Components.results.NS_BINDING_ABORTED);\n }\n}\n}\n\ngBrowser.addTabsProgressListener(PL);", "text": "I am trying to be able to cancel navigations (document location changes).\nI am using a progress listener and call the cancel() method on the Request object passed to the onStateChange() listener function.\n\nThis works for clicks on link, however it does not work for the Forward and Back buttons consistently: Mostly, the call is ignored and the location changes, however sometimes it does cancel.\n\nRun the POC code and play with your responses while pressing links, Back and Forward.\n\n\n-----------------------------------------------------------\n\nvar PL = {\n\nonStateChange: function(aBrowser, aWebProgress, aRequest, aFlag, aStatus) {\n\nif(aFlag & Components.interfaces.nsIWebProgressListener.STATE_START) {\n\nvar promptService = Components.classes[\"@mozilla.org/embedcomp/prompt-service;1\"].getService(Components.interfaces.nsIPromptService);\nvar res = promptService.confirm(window, \"\", \"shall I go?\");\n if (!res) {\n    aRequest.cancel(Components.results.NS_BINDING_ABORTED);\n }\n}\n}\n\ngBrowser.addTabsProgressListener(PL);", "count": 0, "author": "ronen.zilberman@gmail.com", "bug_id": 707416, "id": 5890410}, {"creation_time": "2011-12-08T12:10:51Z", "is_private": false, "bug_id": 707416, "id": 5900210, "author": "mak@mozilla.com", "text": "Not sure where this bug belongs, but surely not Location Bar", "count": 1, "creator": "mak@mozilla.com", "tags": [], "attachment_id": null, "raw_text": "Not sure where this bug belongs, but surely not Location Bar", "time": "2011-12-08T12:10:51Z"}]}}, "comments": {}}