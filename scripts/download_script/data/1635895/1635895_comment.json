{"bugs": {"1635895": {"comments": [{"bug_id": 1635895, "attachment_id": null, "is_private": false, "raw_text": "We will need to coordinate with Data Ops to deploy AccountEcosystemDecryptor Dataflow jobs and to update routing in the edge service to route AET pings to the decryptor.", "text": "We will need to coordinate with Data Ops to deploy AccountEcosystemDecryptor Dataflow jobs and to update routing in the edge service to route AET pings to the decryptor.", "id": 14801136, "author": "jklukas@mozilla.com", "tags": [], "count": 0, "time": "2020-05-06T19:39:17Z", "creation_time": "2020-05-06T19:39:17Z", "creator": "jklukas@mozilla.com"}, {"tags": [], "count": 1, "time": "2020-06-10T14:48:43Z", "creation_time": "2020-06-10T14:48:43Z", "creator": "jklukas@mozilla.com", "bug_id": 1635895, "attachment_id": null, "is_private": false, "raw_text": "New options now exist in the Decoder to allow deployment of a pipeline family that support AET decryption.", "text": "New options now exist in the Decoder to allow deployment of a pipeline family that support AET decryption.", "author": "jklukas@mozilla.com", "id": 14874284}, {"creator": "jklukas@mozilla.com", "creation_time": "2020-06-10T20:46:40Z", "time": "2020-06-10T20:46:40Z", "count": 2, "tags": [], "id": 14874969, "author": "jklukas@mozilla.com", "text": ":whd is working on the deployment configuration for stage today.", "raw_text": ":whd is working on the deployment configuration for stage today.", "is_private": false, "attachment_id": null, "bug_id": 1635895}, {"tags": [], "count": 3, "time": "2020-06-12T17:38:51Z", "creation_time": "2020-06-12T17:38:51Z", "creator": "jklukas@mozilla.com", "bug_id": 1635895, "attachment_id": null, "is_private": false, "raw_text": "AET Decryptor is deployed in stage and is correctly decrypting payloads. The relevant tables for watching payloads flow through stage is:\n\n- `moz-fx-data-shar-nonprod-efed.telemetry_live.account_ecosystem_v4`\n- `moz-fx-data-shar-nonprod-efed.firefox_accounts_live.account_ecosystem_v1`\n\nExample curl invocation for sending a payload through stage for FxA:\n\n```\ncurl -k -X POST \"https://stage.ingestion.nonprod.dataops.mozgcp.net/submit/firefox-accounts/account-ecosystem/1/$(uuidgen)\" -d '{\"ecosystem_client_id\":\"foo\",\"ecosystem_device_id\":\"bar\",\"ecosystem_anon_id\":\"eyJraWQiOiJMbFU0a2VPbWhUdXE5ZkNObnBJbGRZR1Q5dlQ5ZElEd251X1NCdFRnZUVRIiwiYWxnIjoiRUNESC1FUytBMjU2S1ciLCJlbmMiOiJBMjU2R0NNIiwiZXBrIjp7Imt0eSI6IkVDIiwieCI6InpyVHRDYTZDdnhNN0NNMXNXdHlubVVkUW9MSzVpdU01YjZSbHJwWUhxZGsiLCJ5IjoiWEhoWFVJQ21RS0dNbnEwRXVFLXBqRFZ2UGRtTUNHTkRoODNZamEtSVRNcyIsImNydiI6IlAtMjU2In19.aO4mqhu_1C5A4ac99-DMjsbqloeeb9YBQ1kH0ZRYD46pHe_eP35Iyw.LgmHq54T_sSgm5Th.sqjkEhqe5hecP7GsVwqSF4f-9tA2M1_qO3KfOkU_GkE.3bh32H0xW3uvwwyrbEOJ8g\"}'\n```\n\nExample curl invocation for sending a payload through stage for desktop telemetry:\n\n```\ncurl -k -X POST \"https://stage.ingestion.nonprod.dataops.mozgcp.net/submit/telemetry/$(uuidgen)/account-ecosystem/Firefox/77.0a1/default/20200415104457?v=4\" -d '{\"payload\":{\"ecosystemClientId\":\"foo\",\"ecosystemDeviceId\":\"bar\",\"ecosystemAnonId\":\"eyJraWQiOiJMbFU0a2VPbWhUdXE5ZkNObnBJbGRZR1Q5dlQ5ZElEd251X1NCdFRnZUVRIiwiYWxnIjoiRUNESC1FUytBMjU2S1ciLCJlbmMiOiJBMjU2R0NNIiwiZXBrIjp7Imt0eSI6IkVDIiwieCI6InpyVHRDYTZDdnhNN0NNMXNXdHlubVVkUW9MSzVpdU01YjZSbHJwWUhxZGsiLCJ5IjoiWEhoWFVJQ21RS0dNbnEwRXVFLXBqRFZ2UGRtTUNHTkRoODNZamEtSVRNcyIsImNydiI6IlAtMjU2In19.aO4mqhu_1C5A4ac99-DMjsbqloeeb9YBQ1kH0ZRYD46pHe_eP35Iyw.LgmHq54T_sSgm5Th.sqjkEhqe5hecP7GsVwqSF4f-9tA2M1_qO3KfOkU_GkE.3bh32H0xW3uvwwyrbEOJ8g\"}}'\n```\n\nNote that this desktop example fails schema validation and goes to error output because it lacks various required fields. But the entry in errors contains the correctly decrypted \"ecosystemUserId\" field.", "text": "AET Decryptor is deployed in stage and is correctly decrypting payloads. The relevant tables for watching payloads flow through stage is:\n\n- `moz-fx-data-shar-nonprod-efed.telemetry_live.account_ecosystem_v4`\n- `moz-fx-data-shar-nonprod-efed.firefox_accounts_live.account_ecosystem_v1`\n\nExample curl invocation for sending a payload through stage for FxA:\n\n```\ncurl -k -X POST \"https://stage.ingestion.nonprod.dataops.mozgcp.net/submit/firefox-accounts/account-ecosystem/1/$(uuidgen)\" -d '{\"ecosystem_client_id\":\"foo\",\"ecosystem_device_id\":\"bar\",\"ecosystem_anon_id\":\"eyJraWQiOiJMbFU0a2VPbWhUdXE5ZkNObnBJbGRZR1Q5dlQ5ZElEd251X1NCdFRnZUVRIiwiYWxnIjoiRUNESC1FUytBMjU2S1ciLCJlbmMiOiJBMjU2R0NNIiwiZXBrIjp7Imt0eSI6IkVDIiwieCI6InpyVHRDYTZDdnhNN0NNMXNXdHlubVVkUW9MSzVpdU01YjZSbHJwWUhxZGsiLCJ5IjoiWEhoWFVJQ21RS0dNbnEwRXVFLXBqRFZ2UGRtTUNHTkRoODNZamEtSVRNcyIsImNydiI6IlAtMjU2In19.aO4mqhu_1C5A4ac99-DMjsbqloeeb9YBQ1kH0ZRYD46pHe_eP35Iyw.LgmHq54T_sSgm5Th.sqjkEhqe5hecP7GsVwqSF4f-9tA2M1_qO3KfOkU_GkE.3bh32H0xW3uvwwyrbEOJ8g\"}'\n```\n\nExample curl invocation for sending a payload through stage for desktop telemetry:\n\n```\ncurl -k -X POST \"https://stage.ingestion.nonprod.dataops.mozgcp.net/submit/telemetry/$(uuidgen)/account-ecosystem/Firefox/77.0a1/default/20200415104457?v=4\" -d '{\"payload\":{\"ecosystemClientId\":\"foo\",\"ecosystemDeviceId\":\"bar\",\"ecosystemAnonId\":\"eyJraWQiOiJMbFU0a2VPbWhUdXE5ZkNObnBJbGRZR1Q5dlQ5ZElEd251X1NCdFRnZUVRIiwiYWxnIjoiRUNESC1FUytBMjU2S1ciLCJlbmMiOiJBMjU2R0NNIiwiZXBrIjp7Imt0eSI6IkVDIiwieCI6InpyVHRDYTZDdnhNN0NNMXNXdHlubVVkUW9MSzVpdU01YjZSbHJwWUhxZGsiLCJ5IjoiWEhoWFVJQ21RS0dNbnEwRXVFLXBqRFZ2UGRtTUNHTkRoODNZamEtSVRNcyIsImNydiI6IlAtMjU2In19.aO4mqhu_1C5A4ac99-DMjsbqloeeb9YBQ1kH0ZRYD46pHe_eP35Iyw.LgmHq54T_sSgm5Th.sqjkEhqe5hecP7GsVwqSF4f-9tA2M1_qO3KfOkU_GkE.3bh32H0xW3uvwwyrbEOJ8g\"}}'\n```\n\nNote that this desktop example fails schema validation and goes to error output because it lacks various required fields. But the entry in errors contains the correctly decrypted \"ecosystemUserId\" field.", "id": 14879074, "author": "jklukas@mozilla.com"}, {"creator": "jklukas@mozilla.com", "creation_time": "2020-08-03T20:44:34Z", "time": "2020-08-03T20:44:34Z", "count": 4, "tags": [], "author": "jklukas@mozilla.com", "id": 14970204, "text": "AET team is ready to move forward with deploying support in prod, so I will coordinate with :whd about pushing AET Decoder support in the prod data pipeline.", "raw_text": "AET team is ready to move forward with deploying support in prod, so I will coordinate with :whd about pushing AET Decoder support in the prod data pipeline.", "is_private": false, "attachment_id": null, "bug_id": 1635895}, {"attachment_id": null, "bug_id": 1635895, "id": 14971189, "author": "jklukas@mozilla.com", "is_private": false, "text": ":whd is planning to push AET support to the prod data pipeline today.", "raw_text": ":whd is planning to push AET support to the prod data pipeline today.", "time": "2020-08-04T12:56:22Z", "tags": [], "count": 5, "creation_time": "2020-08-04T12:56:22Z", "creator": "jklukas@mozilla.com"}, {"bug_id": 1635895, "count": 6, "tags": [], "attachment_id": null, "time": "2020-08-04T23:58:48Z", "text": "(In reply to Jeff Klukas [:klukas] (UTC-4) from comment #5)\n> :whd is planning to push AET support to the prod data pipeline today.\n\nhttps://github.com/mozilla-services/cloudops-infra/pull/2229 has been deployed to production. The edge routing table update is still propagating but will be done by tomorrow (US time).", "raw_text": "(In reply to Jeff Klukas [:klukas] (UTC-4) from comment #5)\n> :whd is planning to push AET support to the prod data pipeline today.\n\nhttps://github.com/mozilla-services/cloudops-infra/pull/2229 has been deployed to production. The edge routing table update is still propagating but will be done by tomorrow (US time).", "is_private": false, "creator": "whd@mozilla.com", "creation_time": "2020-08-04T23:58:48Z", "author": "whd@mozilla.com", "id": 14972751}, {"tags": [], "count": 7, "time": "2020-08-05T15:21:41Z", "creation_time": "2020-08-05T15:21:41Z", "creator": "jklukas@mozilla.com", "bug_id": 1635895, "attachment_id": null, "is_private": false, "raw_text": "I just attempted to send AET pings to the prod telemetry and structured jobs.\n\nI looks like as soon as the structured AET decoder job attempted to process pings, it started to throw errors indicating it failed to load the `cities15000.txt` file from GCS, so seems likely there's a permissions issue with the service account. The telemtry job doesn't show those errors, but hasn't yet processed any messages, which indicates a problem either with routing or with the curl invocation I made.", "text": "I just attempted to send AET pings to the prod telemetry and structured jobs.\n\nI looks like as soon as the structured AET decoder job attempted to process pings, it started to throw errors indicating it failed to load the `cities15000.txt` file from GCS, so seems likely there's a permissions issue with the service account. The telemtry job doesn't show those errors, but hasn't yet processed any messages, which indicates a problem either with routing or with the curl invocation I made.", "id": 14973709, "author": "jklukas@mozilla.com"}, {"attachment_id": null, "bug_id": 1635895, "author": "whd@mozilla.com", "id": 14973986, "is_private": false, "text": "> it started to throw errors indicating it failed to load the `cities15000.txt` file from GCS\n\nThis was caused by an error in in the set of `terraform apply` commands I used to address https://github.com/mozilla-services/cloudops-infra/pull/2229#issuecomment-668769669. The configuration in that PR is correct, I just forgot to target the resource for adding this viewer access. I've done that and it seems to be working now.\n\n> which indicates a problem either with routing or with the curl invocation I made.\n\nI'm still investigating this, but it appears at last [one message](https://console.cloud.google.com/cloudpubsub/topic/detail/telemetry-aet?organizationId=442341870013&project=moz-fx-data-shared-prod) has been routed to `telemetry-aet`, though I don't see it in the aet decoder subscription.", "raw_text": "> it started to throw errors indicating it failed to load the `cities15000.txt` file from GCS\n\nThis was caused by an error in in the set of `terraform apply` commands I used to address https://github.com/mozilla-services/cloudops-infra/pull/2229#issuecomment-668769669. The configuration in that PR is correct, I just forgot to target the resource for adding this viewer access. I've done that and it seems to be working now.\n\n> which indicates a problem either with routing or with the curl invocation I made.\n\nI'm still investigating this, but it appears at last [one message](https://console.cloud.google.com/cloudpubsub/topic/detail/telemetry-aet?organizationId=442341870013&project=moz-fx-data-shared-prod) has been routed to `telemetry-aet`, though I don't see it in the aet decoder subscription.", "time": "2020-08-05T17:12:14Z", "tags": [], "count": 8, "creation_time": "2020-08-05T17:12:14Z", "creator": "whd@mozilla.com"}, {"bug_id": 1635895, "attachment_id": null, "is_private": false, "text": "> I'm still investigating this\n\nThis was a permissions issue with the edge addressed by https://github.com/mozilla-services/cloudops-infra/pull/2389. It looks like the edge queued the messages correctly and the publish request I saw go through was actually an error. At this point I believe everything is in order.", "raw_text": "> I'm still investigating this\n\nThis was a permissions issue with the edge addressed by https://github.com/mozilla-services/cloudops-infra/pull/2389. It looks like the edge queued the messages correctly and the publish request I saw go through was actually an error. At this point I believe everything is in order.", "author": "whd@mozilla.com", "id": 14974023, "tags": [], "count": 9, "time": "2020-08-05T17:36:02Z", "creation_time": "2020-08-05T17:36:02Z", "creator": "whd@mozilla.com"}, {"attachment_id": null, "bug_id": 1635895, "author": "jklukas@mozilla.com", "id": 14974064, "raw_text": "I now see documents that have gotten past the DecryptAetIdentifiers transform in both structured and telemetry, so I can confirm this looks to be working in prod now.", "text": "I now see documents that have gotten past the DecryptAetIdentifiers transform in both structured and telemetry, so I can confirm this looks to be working in prod now.", "is_private": false, "time": "2020-08-05T17:56:54Z", "count": 10, "tags": [], "creator": "jklukas@mozilla.com", "creation_time": "2020-08-05T17:56:54Z"}, {"time": "2020-08-06T04:26:27Z", "tags": [], "count": 11, "creation_time": "2020-08-06T04:26:27Z", "creator": "ryan@rfk.id.au", "attachment_id": null, "bug_id": 1635895, "id": 14974848, "author": "ryan@rfk.id.au", "is_private": false, "raw_text": "I expect I probably don't have access to the \"live\" tables in prod to see my own pings coming in, but I just tried out the patch from Bug 1635659 with prod FxA and prod telemetry stacks, and it claims to have successfully submitted an ecosystem ping. If it's possible to confirm whether we got a successful ping for ecosystemClientId beginning `6ddfcef9` that would be great! (Or alternately, if we got any errors that claim to come from an ISP in Australia, that was probably me).", "text": "I expect I probably don't have access to the \"live\" tables in prod to see my own pings coming in, but I just tried out the patch from Bug 1635659 with prod FxA and prod telemetry stacks, and it claims to have successfully submitted an ecosystem ping. If it's possible to confirm whether we got a successful ping for ecosystemClientId beginning `6ddfcef9` that would be great! (Or alternately, if we got any errors that claim to come from an ISP in Australia, that was probably me)."}, {"creator": "jklukas@mozilla.com", "creation_time": "2020-08-06T13:09:41Z", "count": 12, "tags": [], "time": "2020-08-06T13:09:41Z", "text": "You do indeed have access to see the live prod tables and there are indeed several Aussie Broadband pings in there: https://sql.telemetry.mozilla.org/queries/73682/source\n\nAnd here's a base for investigating AET errors:\nhttps://sql.telemetry.mozilla.org/queries/73683/source\n\nI am assuming that we can tackle locking down access to these tables before AET hits release, but for the current moment it's good to have open access for debugging.", "raw_text": "You do indeed have access to see the live prod tables and there are indeed several Aussie Broadband pings in there: https://sql.telemetry.mozilla.org/queries/73682/source\n\nAnd here's a base for investigating AET errors:\nhttps://sql.telemetry.mozilla.org/queries/73683/source\n\nI am assuming that we can tackle locking down access to these tables before AET hits release, but for the current moment it's good to have open access for debugging.", "is_private": false, "author": "jklukas@mozilla.com", "id": 14975461, "bug_id": 1635895, "attachment_id": null}, {"creation_time": "2020-08-06T20:27:46Z", "creator": "ryan@rfk.id.au", "tags": [], "count": 13, "time": "2020-08-06T20:27:46Z", "is_private": false, "raw_text": "> I am assuming that we can tackle locking down access to these tables before AET hits release, but for the current moment it's good\n> to have open access for debugging.\n\nGreat, yes, this sounds good to me.", "text": "> I am assuming that we can tackle locking down access to these tables before AET hits release, but for the current moment it's good\n> to have open access for debugging.\n\nGreat, yes, this sounds good to me.", "id": 14976509, "author": "ryan@rfk.id.au", "bug_id": 1635895, "attachment_id": null}]}}, "comments": {}}