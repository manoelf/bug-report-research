{"bugs": {"684519": {"comments": [{"bug_id": 684519, "count": 0, "id": 5698479, "raw_text": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.865.0 Safari/535.2\n\nSteps to reproduce:\n\nCreated a complex object (no native items referenced) in my Worker and trying to post it to the main thread.\n\nWorkaround:\nRun the object through JSON.stringify to post and then run JSON.parse on the other side. This allows it to run without error. But from my understanding, shouldn't it be doing that in the background anyways? I'd hate to duplicate work if it should be doing that to begin with.\n\n\nActual results:\n\nI get :\n\n\"Component returned failure code: 0x80530019 [nsIWorkerScope.postMessage]\" nsresult: \"0x80530019 (<unknown>)\" location: \"JS frame :: chrome://flashbug/content/lib/swf/swfWorker.js :: <TOP_LEVEL> :: line 805\" data: no]\n\nLine #805, swf being my complex object:\n\npostMessage(swf);\n\n\nExpected results:\n\nIt should have posted the object to the main thread without error.\n\nOr atleast in the event of an error, be more descriptive on whats wrong, <unknown> is pretty useless.", "attachment_id": null, "tags": [], "time": "2011-09-03T17:36:54Z", "text": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.2 (KHTML, like Gecko) Chrome/15.0.865.0 Safari/535.2\n\nSteps to reproduce:\n\nCreated a complex object (no native items referenced) in my Worker and trying to post it to the main thread.\n\nWorkaround:\nRun the object through JSON.stringify to post and then run JSON.parse on the other side. This allows it to run without error. But from my understanding, shouldn't it be doing that in the background anyways? I'd hate to duplicate work if it should be doing that to begin with.\n\n\nActual results:\n\nI get :\n\n\"Component returned failure code: 0x80530019 [nsIWorkerScope.postMessage]\" nsresult: \"0x80530019 (<unknown>)\" location: \"JS frame :: chrome://flashbug/content/lib/swf/swfWorker.js :: <TOP_LEVEL> :: line 805\" data: no]\n\nLine #805, swf being my complex object:\n\npostMessage(swf);\n\n\nExpected results:\n\nIt should have posted the object to the main thread without error.\n\nOr atleast in the event of an error, be more descriptive on whats wrong, <unknown> is pretty useless.", "author": "e618758@rmqkr.net", "creation_time": "2011-09-03T17:36:54Z", "creator": "e618758@rmqkr.net", "is_private": false}, {"creator": "bent.mozilla@gmail.com", "is_private": false, "count": 1, "author": "bent.mozilla@gmail.com", "creation_time": "2011-09-06T23:09:39Z", "bug_id": 684519, "tags": [], "time": "2011-09-06T23:09:39Z", "text": "All this code has been recently rewritten (will be available in FF8) but for now that error code is NS_ERROR_DOM_DATA_CLONE_ERR and it probably means that your swf object either has cyclical references or it has functions on it. Neither can be cloned. Can you provide any further details on what your swf object has?", "attachment_id": null, "raw_text": "All this code has been recently rewritten (will be available in FF8) but for now that error code is NS_ERROR_DOM_DATA_CLONE_ERR and it probably means that your swf object either has cyclical references or it has functions on it. Neither can be cloned. Can you provide any further details on what your swf object has?", "id": 5703456}, {"count": 2, "bug_id": 684519, "is_private": false, "creator": "e618758@rmqkr.net", "creation_time": "2011-09-09T10:36:58Z", "author": "e618758@rmqkr.net", "text": "Well I've narrowed it down to a specific DefineShape2 object in teh SWF spec. There are multiple of these objects, but just one seems to kill the postMessage. The DefineShape2 is a fairly complex object and have been trying to narrow it down to what specifically in it is causing the issue. How can I tell if there are cyclical references?", "time": "2011-09-09T10:36:58Z", "tags": [], "attachment_id": null, "raw_text": "Well I've narrowed it down to a specific DefineShape2 object in teh SWF spec. There are multiple of these objects, but just one seems to kill the postMessage. The DefineShape2 is a fairly complex object and have been trying to narrow it down to what specifically in it is causing the issue. How can I tell if there are cyclical references?", "id": 5710230}, {"attachment_id": null, "raw_text": "Cyclic references are fine as of some recent version of Firefox (7, I think).\n\nCan you post a testcase here?", "id": 5710258, "is_private": false, "creator": "khuey@kylehuey.com", "count": 3, "creation_time": "2011-09-09T11:11:44Z", "author": "khuey@kylehuey.com", "text": "Cyclic references are fine as of some recent version of Firefox (7, I think).\n\nCan you post a testcase here?", "time": "2011-09-09T11:11:44Z", "tags": [], "bug_id": 684519}, {"creator": "e618758@rmqkr.net", "is_private": false, "count": 4, "author": "e618758@rmqkr.net", "creation_time": "2011-09-10T13:26:23Z", "tags": [], "bug_id": 684519, "time": "2011-09-10T13:26:23Z", "text": "Hmm i was testing with FF6 so that might be a reason. The SWF spec itself stores read objects into a dictionary for reference. So if i had an object stored in the dictionary and it's referenced by another shape would that count as cyclical? Also I think the problem might be how I was creating the DefineShape2 object.  I had a DefineShape object like this:\n\nfunction DefineShape(ba, obj) {\n\tif (!ba) return;\n\tvar start = ba.position;\n\t\n\tthis.header = new RecordHeader(ba);\n\tvar end = ba.position + this.header.tagLength;\n\tthis.id = ba.readUI16();\n\t\n\t//this.bounds = new Rect(ba);\n\t//this.bounds.fromTwips();\n\t//ba.align();\n\t\n\t//this.shapes = new ShapeWithStyle(ba, obj, this.header.type, start, end);\n\t\n\t//this.svg = shape2SVG(this);\n}; \n\nand the DefineShape2 object like this:\n\nfunction DefineShape2(ba, obj) {\n\tDefineShape.apply(this, arguments);\n}\nDefineShape2.prototype = new DefineShape();\nDefineShape2.prototype.constructor = DefineShape2; \n\nand it would throw that error. But when i replaced DefineShape2 with this:\n\nfunction DefineShape2(ba, obj) {\n\tvar start = ba.position;\n\t\n\tthis.header = new RecordHeader(ba);\n\tvar end = ba.position + this.header.tagLength;\n\tthis.id = ba.readUI16();\n\t\n\t//this.bounds = new Rect(ba);\n\t//this.bounds.fromTwips();\n\t//ba.align();\n\t\n\t//this.shapes = new ShapeWithStyle(ba, obj, this.header.type, start, end);\n\t\n\t//this.svg = shape2SVG(this);\n};\n\nIt passed correctly. Any idea why trying to extend from that previous object would cause an error?", "attachment_id": null, "raw_text": "Hmm i was testing with FF6 so that might be a reason. The SWF spec itself stores read objects into a dictionary for reference. So if i had an object stored in the dictionary and it's referenced by another shape would that count as cyclical? Also I think the problem might be how I was creating the DefineShape2 object.  I had a DefineShape object like this:\n\nfunction DefineShape(ba, obj) {\n\tif (!ba) return;\n\tvar start = ba.position;\n\t\n\tthis.header = new RecordHeader(ba);\n\tvar end = ba.position + this.header.tagLength;\n\tthis.id = ba.readUI16();\n\t\n\t//this.bounds = new Rect(ba);\n\t//this.bounds.fromTwips();\n\t//ba.align();\n\t\n\t//this.shapes = new ShapeWithStyle(ba, obj, this.header.type, start, end);\n\t\n\t//this.svg = shape2SVG(this);\n}; \n\nand the DefineShape2 object like this:\n\nfunction DefineShape2(ba, obj) {\n\tDefineShape.apply(this, arguments);\n}\nDefineShape2.prototype = new DefineShape();\nDefineShape2.prototype.constructor = DefineShape2; \n\nand it would throw that error. But when i replaced DefineShape2 with this:\n\nfunction DefineShape2(ba, obj) {\n\tvar start = ba.position;\n\t\n\tthis.header = new RecordHeader(ba);\n\tvar end = ba.position + this.header.tagLength;\n\tthis.id = ba.readUI16();\n\t\n\t//this.bounds = new Rect(ba);\n\t//this.bounds.fromTwips();\n\t//ba.align();\n\t\n\t//this.shapes = new ShapeWithStyle(ba, obj, this.header.type, start, end);\n\t\n\t//this.svg = shape2SVG(this);\n};\n\nIt passed correctly. Any idea why trying to extend from that previous object would cause an error?", "id": 5712492}, {"id": 5712903, "raw_text": "That was the issue. I had it in about 5 other tags, I just used copies instead of extending the tag and I no longer get an error.", "attachment_id": null, "bug_id": 684519, "time": "2011-09-10T23:45:19Z", "tags": [], "text": "That was the issue. I had it in about 5 other tags, I just used copies instead of extending the tag and I no longer get an error.", "author": "e618758@rmqkr.net", "creation_time": "2011-09-10T23:45:19Z", "count": 5, "creator": "e618758@rmqkr.net", "is_private": false}, {"creator": "fb+mozdev@quantumedia.de", "is_private": false, "count": 6, "author": "fb+mozdev@quantumedia.de", "creation_time": "2015-11-23T10:23:02Z", "bug_id": 684519, "tags": [], "time": "2015-11-23T10:23:02Z", "text": "Can you please test if this issue still exists in the latest Nightly? There have been numerous changes to postMessage in the last releases.", "attachment_id": null, "raw_text": "Can you please test if this issue still exists in the latest Nightly? There have been numerous changes to postMessage in the last releases.", "id": 10955632}]}}, "comments": {}}