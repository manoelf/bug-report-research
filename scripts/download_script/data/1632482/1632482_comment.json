{"bugs": {"1632482": {"comments": [{"attachment_id": null, "tags": [], "author": "hskupin@gmail.com", "text": "I just noticed by trying to reproduce bug 1631344 that Fennec has more than 60 open tabs when running the Raptor tests. I doubt that this is expected, and might add some memory footprint, which could cause problems.\n\nTarek, does the code miss to close all the tabs?", "creation_time": "2020-04-23T12:56:58Z", "creator": "hskupin@gmail.com", "bug_id": 1632482, "id": 14773800, "count": 0, "time": "2020-04-23T12:56:58Z", "raw_text": "I just noticed by trying to reproduce bug 1631344 that Fennec has more than 60 open tabs when running the Raptor tests. I doubt that this is expected, and might add some memory footprint, which could cause problems.\n\nTarek, does the code miss to close all the tabs?", "is_private": false}, {"is_private": false, "raw_text": "Good finding, I could reproduce it as well \n\n\nFor some reason, when we open Fennec without actually opening any tab, the about:blank page will be displayed and once we close it, it's going to stick in the profile, and next time we open it, it creates a new one. Is there a way in Geckodriver to close all tabs even if they are created outside the session?\n\nThis is the whole geckodriver session we are doing for the settled profile:\n\n```\n1586973236955\tgeckodriver\tDEBUG\tListening on 127.0.0.1:44213\n1586973236957\twebdriver::server\tDEBUG\t-> GET /status \n1586973236957\twebdriver::server\tDEBUG\t<- 200 OK {\"value\":{\"message\":\"\",\"ready\":true}}\n1586973236958\twebdriver::server\tDEBUG\t-> POST /session {\"desiredCapabilities\": {\"browserName\": \"firefox\", \"marionette\": true, \"acceptInsecureCerts\": true, \"moz:firefoxOptions\": {\"args\": [\"--allow-downgrade\", \"-headless\"], \"prefs\": {}}}}\n1586973236958\twebdriver::command\tWARN\tYou are using deprecated legacy session negotiation patterns (desiredCapabilities/requiredCapabilities), see https://developer.mozilla.org/en-US/docs/Web/WebDriver/Capabilities#Legacy\n1586973236959\tgeckodriver::marionette\tDEBUG\tWaiting 60s to connect to browser on 127.0.0.1:2828\n1586973236996\tgeckodriver::marionette\tDEBUG\tConnection to Marionette established on 127.0.0.1:2828.\n1586973237341\twebdriver::server\tDEBUG\t<- 200 OK {\"value\":{\"sessionId\":\"7f361a92-d24c-48a2-a946-b6616a8946fa\",\"capabilities\":{\"acceptInsecureCerts\":true,\"browserName\":\"firefox\",\"browserVersion\":\"68.8.0\",\"marionette\":true,\"moz:accessibilityChecks\":false,\"moz:buildID\":\"20200413162527\",\"moz:geckodriverVersion\":\"0.26.0\",\"moz:headless\":false,\"moz:processID\":7221,\"moz:profile\":\"/storage/emulated/0/tests/condprof/profile\",\"moz:shutdownTimeout\":60000,\"moz:useNonSpecCompliantPointerOrigin\":false,\"moz:webdriverClick\":true,\"pageLoadStrategy\":\"normal\",\"platformName\":\"linux\",\"platformVersion\":24,\"rotatable\":false,\"setWindowRect\":false,\"strictFileInteractability\":false,\"timeouts\":{\"implicit\":0,\"pageLoad\":300000,\"script\":30000},\"unhandledPromptBehavior\":\"dismiss and notify\"}}}\n```\nI will try to see if /session/{session id}/window/handles works with previously opened tab", "creation_time": "2020-04-23T14:37:28Z", "text": "Good finding, I could reproduce it as well \n\n\nFor some reason, when we open Fennec without actually opening any tab, the about:blank page will be displayed and once we close it, it's going to stick in the profile, and next time we open it, it creates a new one. Is there a way in Geckodriver to close all tabs even if they are created outside the session?\n\nThis is the whole geckodriver session we are doing for the settled profile:\n\n```\n1586973236955\tgeckodriver\tDEBUG\tListening on 127.0.0.1:44213\n1586973236957\twebdriver::server\tDEBUG\t-> GET /status \n1586973236957\twebdriver::server\tDEBUG\t<- 200 OK {\"value\":{\"message\":\"\",\"ready\":true}}\n1586973236958\twebdriver::server\tDEBUG\t-> POST /session {\"desiredCapabilities\": {\"browserName\": \"firefox\", \"marionette\": true, \"acceptInsecureCerts\": true, \"moz:firefoxOptions\": {\"args\": [\"--allow-downgrade\", \"-headless\"], \"prefs\": {}}}}\n1586973236958\twebdriver::command\tWARN\tYou are using deprecated legacy session negotiation patterns (desiredCapabilities/requiredCapabilities), see https://developer.mozilla.org/en-US/docs/Web/WebDriver/Capabilities#Legacy\n1586973236959\tgeckodriver::marionette\tDEBUG\tWaiting 60s to connect to browser on 127.0.0.1:2828\n1586973236996\tgeckodriver::marionette\tDEBUG\tConnection to Marionette established on 127.0.0.1:2828.\n1586973237341\twebdriver::server\tDEBUG\t<- 200 OK {\"value\":{\"sessionId\":\"7f361a92-d24c-48a2-a946-b6616a8946fa\",\"capabilities\":{\"acceptInsecureCerts\":true,\"browserName\":\"firefox\",\"browserVersion\":\"68.8.0\",\"marionette\":true,\"moz:accessibilityChecks\":false,\"moz:buildID\":\"20200413162527\",\"moz:geckodriverVersion\":\"0.26.0\",\"moz:headless\":false,\"moz:processID\":7221,\"moz:profile\":\"/storage/emulated/0/tests/condprof/profile\",\"moz:shutdownTimeout\":60000,\"moz:useNonSpecCompliantPointerOrigin\":false,\"moz:webdriverClick\":true,\"pageLoadStrategy\":\"normal\",\"platformName\":\"linux\",\"platformVersion\":24,\"rotatable\":false,\"setWindowRect\":false,\"strictFileInteractability\":false,\"timeouts\":{\"implicit\":0,\"pageLoad\":300000,\"script\":30000},\"unhandledPromptBehavior\":\"dismiss and notify\"}}}\n```\nI will try to see if /session/{session id}/window/handles works with previously opened tab", "time": "2020-04-23T14:37:28Z", "count": 1, "id": 14773976, "bug_id": 1632482, "author": "tarek@mozilla.com", "tags": [], "creator": "tarek@mozilla.com", "attachment_id": null}, {"id": 14773979, "bug_id": 1632482, "tags": [], "author": "tarek@mozilla.com", "attachment_id": null, "creator": "tarek@mozilla.com", "is_private": false, "text": "command used to replicate the issue\n\n```\n./mach raptor --test=raptor-tp6m-12-fennec68-cold --app=fennec --binary=org.mozilla.firefox --device-name=g5 --disable-e10s\n```", "time": "2020-04-23T14:38:06Z", "creation_time": "2020-04-23T14:38:06Z", "raw_text": "command used to replicate the issue\n\n```\n./mach raptor --test=raptor-tp6m-12-fennec68-cold --app=fennec --binary=org.mozilla.firefox --device-name=g5 --disable-e10s\n```", "count": 2}, {"tags": [], "author": "hskupin@gmail.com", "attachment_id": null, "text": "You want to iterate through all the windows and close them each except the last one. \n\nhttps://w3c.github.io/webdriver/#get-window-handles\nhttps://w3c.github.io/webdriver/#close-window", "creation_time": "2020-04-23T14:47:19Z", "id": 14774007, "bug_id": 1632482, "creator": "hskupin@gmail.com", "is_private": false, "time": "2020-04-23T14:47:19Z", "raw_text": "You want to iterate through all the windows and close them each except the last one. \n\nhttps://w3c.github.io/webdriver/#get-window-handles\nhttps://w3c.github.io/webdriver/#close-window", "count": 3}, {"creator": "tarek@mozilla.com", "id": 14774059, "bug_id": 1632482, "count": 4, "is_private": false, "raw_text": "This patch makes sure all tabs are closed before we close the\nbrowser.", "time": "2020-04-23T15:06:07Z", "author": "tarek@mozilla.com", "tags": [], "attachment_id": 9142731, "text": "Created attachment 9142731\nBug 1632482 - close all tabs at the end of a condprof scenario\n\nThis patch makes sure all tabs are closed before we close the\nbrowser.", "creation_time": "2020-04-23T15:06:07Z"}, {"id": 14774179, "bug_id": 1632482, "tags": [], "author": "tarek@mozilla.com", "attachment_id": null, "creator": "tarek@mozilla.com", "is_private": false, "creation_time": "2020-04-23T15:50:23Z", "time": "2020-04-23T15:50:23Z", "text": "try run https://treeherder.mozilla.org/#/jobs?repo=try&revision=c541936124af6b69b53bf14d8382caca175f637e", "raw_text": "try run https://treeherder.mozilla.org/#/jobs?repo=try&revision=c541936124af6b69b53bf14d8382caca175f637e", "count": 5}, {"count": 6, "is_private": false, "raw_text": "try run without other patches, and with the change were we keep the last window open\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=355dc3f0232e97ea530ec97c256add0ed6582e57", "creation_time": "2020-04-23T17:19:39Z", "time": "2020-04-23T17:19:39Z", "text": "try run without other patches, and with the change were we keep the last window open\n\nhttps://treeherder.mozilla.org/#/jobs?repo=try&revision=355dc3f0232e97ea530ec97c256add0ed6582e57", "author": "tarek@mozilla.com", "tags": [], "creator": "tarek@mozilla.com", "attachment_id": null, "id": 14774393, "bug_id": 1632482}, {"count": 7, "is_private": false, "raw_text": "Pushed by tziade@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/ae8e1196c5de\nclose all tabs at the end of a condprof scenario r=whimboo", "text": "Pushed by tziade@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/ae8e1196c5de\nclose all tabs at the end of a condprof scenario r=whimboo", "time": "2020-04-23T22:41:06Z", "creation_time": "2020-04-23T22:41:06Z", "author": "pulsebot@bots.tld", "tags": [], "creator": "pulsebot@bots.tld", "attachment_id": null, "id": 14775142, "bug_id": 1632482}, {"text": "https://hg.mozilla.org/mozilla-central/rev/ae8e1196c5de", "time": "2020-04-24T03:09:33Z", "creation_time": "2020-04-24T03:09:33Z", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/ae8e1196c5de", "is_private": false, "count": 8, "bug_id": 1632482, "id": 14775487, "attachment_id": null, "creator": "cbrindusan@mozilla.com", "tags": ["bugherder"], "author": "cbrindusan@mozilla.com"}]}}, "comments": {}}