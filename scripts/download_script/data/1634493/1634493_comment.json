{"comments": {}, "bugs": {"1634493": {"comments": [{"raw_text": "Related fenix issue: https://github.com/mozilla-mobile/fenix/issues/10290\n\nSTR:\n- Set `WebExtension.allowedInPrivateBrowsing` to true (false by default)\n- Close the app & restart\n\nIt appears that if `WebExtension.enabled state` is changed with  `allowedInPrivateBrowsing`, then the `allowedInPrivateBrowsing` is persisted.", "creation_time": "2020-04-30T17:55:44Z", "attachment_id": null, "creator": "schae@mozilla.com", "time": "2020-04-30T17:55:44Z", "author": "schae@mozilla.com", "text": "Related fenix issue: https://github.com/mozilla-mobile/fenix/issues/10290\n\nSTR:\n- Set `WebExtension.allowedInPrivateBrowsing` to true (false by default)\n- Close the app & restart\n\nIt appears that if `WebExtension.enabled state` is changed with  `allowedInPrivateBrowsing`, then the `allowedInPrivateBrowsing` is persisted.", "id": 14789408, "count": 0, "is_private": false, "bug_id": 1634493, "tags": []}, {"id": 14796895, "text": "Created attachment 9145652\nBug 1634493 - Wait for extension policy to be ready.\n\nWhen exporting the addon object, the extension policy sometimes is not ready\nyet (very common when `list()` is called at startup), so we need to wait until\nit's ready or the values in it will not be correct.", "creator": "agi@sferro.dev", "attachment_id": 9145652, "creation_time": "2020-05-05T00:20:09Z", "count": 1, "is_private": false, "tags": [], "bug_id": 1634493, "author": "agi@sferro.dev", "time": "2020-05-05T00:20:09Z", "raw_text": "When exporting the addon object, the extension policy sometimes is not ready\nyet (very common when `list()` is called at startup), so we need to wait until\nit's ready or the values in it will not be correct."}, {"id": 14796897, "text": "Created attachment 9145654\nBug 1634493 - Wait for extension policy to be ready.\n\nWhen exporting the addon object, the extension policy sometimes is not ready\nyet (very common when `list()` is called at startup), so we need to wait until\nit's ready or the values in it will not be correct.", "author": "agi@sferro.dev", "tags": [], "bug_id": 1634493, "is_private": false, "count": 2, "raw_text": "When exporting the addon object, the extension policy sometimes is not ready\nyet (very common when `list()` is called at startup), so we need to wait until\nit's ready or the values in it will not be correct.", "creation_time": "2020-05-05T00:21:01Z", "time": "2020-05-05T00:21:01Z", "attachment_id": 9145654, "creator": "agi@sferro.dev"}, {"text": "Created attachment 9145655\nBug 1634493 - Add GVE setting for extensions in private browsing.", "id": 14796898, "creation_time": "2020-05-05T00:21:04Z", "attachment_id": 9145655, "creator": "agi@sferro.dev", "author": "agi@sferro.dev", "tags": [], "bug_id": 1634493, "is_private": false, "count": 3, "raw_text": "", "time": "2020-05-05T00:21:04Z"}, {"attachment_id": null, "creator": "pulsebot@bots.tld", "creation_time": "2020-05-05T18:08:56Z", "text": "Pushed by asferro@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/65e4e70c6851\nWait for extension policy to be ready. r=aklotz\nhttps://hg.mozilla.org/integration/autoland/rev/4d31941a0eb4\nAdd GVE setting for extensions in private browsing. r=aklotz", "id": 14798561, "time": "2020-05-05T18:08:56Z", "raw_text": "Pushed by asferro@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/65e4e70c6851\nWait for extension policy to be ready. r=aklotz\nhttps://hg.mozilla.org/integration/autoland/rev/4d31941a0eb4\nAdd GVE setting for extensions in private browsing. r=aklotz", "is_private": false, "count": 4, "bug_id": 1634493, "tags": [], "author": "pulsebot@bots.tld"}, {"is_private": false, "count": 5, "bug_id": 1634493, "tags": ["bugherder"], "text": "https://hg.mozilla.org/mozilla-central/rev/65e4e70c6851\nhttps://hg.mozilla.org/mozilla-central/rev/4d31941a0eb4", "id": 14799015, "author": "malexandru@mozilla.com", "creator": "malexandru@mozilla.com", "attachment_id": null, "time": "2020-05-05T21:41:47Z", "creation_time": "2020-05-05T21:41:47Z", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/65e4e70c6851\nhttps://hg.mozilla.org/mozilla-central/rev/4d31941a0eb4"}, {"time": "2020-05-08T16:23:16Z", "raw_text": "I'm seeing this bug intermittently now. Here's a reproducible workflow:\n\n1. Set ublock allowPrivateBrowsing to false (from true) and confirm success callback\n2. Restart app and check metadata for ublock when `runtime.webExtensionController.list()` - confirm false\n3. Set ublock allowPrivateBrowsing to true (from false) and confirm success callback\n4. Restart app and check metadata for ublock when `runtime.webExtensionController.list()` - still false\n\n```2020-05-08 12:14:31.188 14135-14135/org.mozilla.samples.browser D/allowPrivateBrowsing: listInstalledWebExtensions: uBlock0@raymondhill.net/true\n2020-05-08 12:14:38.096 14135-14135/org.mozilla.samples.browser D/allowPrivateBrowsing: success: false\n2020-05-08 12:14:47.810 14594-14594/org.mozilla.samples.browser D/allowPrivateBrowsing: listInstalledWebExtensions: uBlock0@raymondhill.net/false\n2020-05-08 12:14:54.268 14594-14594/org.mozilla.samples.browser D/allowPrivateBrowsing: success: true\n2020-05-08 12:15:02.545 14858-14858/org.mozilla.samples.browser D/allowPrivateBrowsing: listInstalledWebExtensions: uBlock0@raymondhill.net/false", "count": 6, "is_private": false, "bug_id": 1634493, "tags": [], "author": "schae@mozilla.com", "attachment_id": null, "creator": "schae@mozilla.com", "creation_time": "2020-05-08T16:23:16Z", "text": "I'm seeing this bug intermittently now. Here's a reproducible workflow:\n\n1. Set ublock allowPrivateBrowsing to false (from true) and confirm success callback\n2. Restart app and check metadata for ublock when `runtime.webExtensionController.list()` - confirm false\n3. Set ublock allowPrivateBrowsing to true (from false) and confirm success callback\n4. Restart app and check metadata for ublock when `runtime.webExtensionController.list()` - still false\n\n```2020-05-08 12:14:31.188 14135-14135/org.mozilla.samples.browser D/allowPrivateBrowsing: listInstalledWebExtensions: uBlock0@raymondhill.net/true\n2020-05-08 12:14:38.096 14135-14135/org.mozilla.samples.browser D/allowPrivateBrowsing: success: false\n2020-05-08 12:14:47.810 14594-14594/org.mozilla.samples.browser D/allowPrivateBrowsing: listInstalledWebExtensions: uBlock0@raymondhill.net/false\n2020-05-08 12:14:54.268 14594-14594/org.mozilla.samples.browser D/allowPrivateBrowsing: success: true\n2020-05-08 12:15:02.545 14858-14858/org.mozilla.samples.browser D/allowPrivateBrowsing: listInstalledWebExtensions: uBlock0@raymondhill.net/false", "id": 14805007}, {"creation_time": "2020-05-08T19:44:47Z", "creator": "agi@sferro.dev", "attachment_id": 9146888, "text": "Created attachment 9146888\nBug 1634493 - Re-read the policy object when exporting extensions.\n\nWebExtensionPolicy.getByID(id) will return a stub when called earlier during\nstartup. Once the startup process is complete, this object is sawpped with the\nreal extension policy.\n\nBefore this patch, we used to hold onto the stub object, which makes it so that\nwe read incorrect values even though we are waiting for the policy to be ready.\n\nTo fix this we just read the result value of the readyPromise promise.", "id": 14805443, "raw_text": "WebExtensionPolicy.getByID(id) will return a stub when called earlier during\nstartup. Once the startup process is complete, this object is sawpped with the\nreal extension policy.\n\nBefore this patch, we used to hold onto the stub object, which makes it so that\nwe read incorrect values even though we are waiting for the policy to be ready.\n\nTo fix this we just read the result value of the readyPromise promise.", "time": "2020-05-08T19:44:47Z", "author": "agi@sferro.dev", "is_private": false, "count": 7, "tags": [], "bug_id": 1634493}, {"creation_time": "2020-05-08T20:07:40Z", "attachment_id": null, "creator": "agi@sferro.dev", "id": 14805484, "text": "Thanks Simon! There was a bug on our side, next nightly should have the fix :)", "raw_text": "Thanks Simon! There was a bug on our side, next nightly should have the fix :)", "time": "2020-05-08T20:07:40Z", "author": "agi@sferro.dev", "is_private": false, "count": 8, "bug_id": 1634493, "tags": []}, {"raw_text": "Pushed by asferro@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/e1d0588ee5c5\nRe-read the policy object when exporting extensions. r=snorp", "time": "2020-05-08T20:51:44Z", "author": "pulsebot@bots.tld", "is_private": false, "count": 9, "tags": [], "bug_id": 1634493, "creation_time": "2020-05-08T20:51:44Z", "creator": "pulsebot@bots.tld", "attachment_id": null, "text": "Pushed by asferro@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/e1d0588ee5c5\nRe-read the policy object when exporting extensions. r=snorp", "id": 14805549}, {"time": "2020-05-09T09:16:59Z", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/e1d0588ee5c5", "count": 10, "is_private": false, "tags": ["bugherder"], "bug_id": 1634493, "author": "csabou@mozilla.com", "creator": "csabou@mozilla.com", "attachment_id": null, "creation_time": "2020-05-09T09:16:59Z", "text": "https://hg.mozilla.org/mozilla-central/rev/e1d0588ee5c5", "id": 14806074}, {"author": "schae@mozilla.com", "bug_id": 1634493, "tags": [], "is_private": false, "count": 11, "raw_text": "I'm still seeing intermittent issue with nightly version (78.0.20200510092917):\n\nlog with id is from `runtime.webExtensionController.list()` and just the boolean value is from `runtime.webExtensionController.setAllowedInPrivateBrowsing()` success callback\n```2020-05-11 09:53:40.071 5759-5759/org.mozilla.samples.browser D/++private-browsing++: true\n2020-05-11 09:53:41.878 5759-5759/org.mozilla.samples.browser D/++private-browsing++: false\n2020-05-11 09:53:43.242 5759-5759/org.mozilla.samples.browser D/++private-browsing++: true\n2020-05-11 09:53:53.963 6817-6817/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / true\n2020-05-11 09:54:03.541 6817-6817/org.mozilla.samples.browser D/++private-browsing++: false\n2020-05-11 09:54:16.406 7137-7137/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / true\n2020-05-11 09:54:25.290 7137-7137/org.mozilla.samples.browser D/++private-browsing++: false\n2020-05-11 09:54:36.985 7401-7401/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / false\n2020-05-11 09:54:43.557 7401-7401/org.mozilla.samples.browser D/++private-browsing++: true\n2020-05-11 09:54:54.302 7714-7714/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / true\n2020-05-11 09:55:05.207 7714-7714/org.mozilla.samples.browser D/++private-browsing++: false\n2020-05-11 09:55:14.388 7983-7983/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / false\n2020-05-11 09:55:20.700 7983-7983/org.mozilla.samples.browser D/++private-browsing++: true\n2020-05-11 09:55:28.649 8265-8265/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / false```", "time": "2020-05-11T13:59:21Z", "text": "I'm still seeing intermittent issue with nightly version (78.0.20200510092917):\n\nlog with id is from `runtime.webExtensionController.list()` and just the boolean value is from `runtime.webExtensionController.setAllowedInPrivateBrowsing()` success callback\n```2020-05-11 09:53:40.071 5759-5759/org.mozilla.samples.browser D/++private-browsing++: true\n2020-05-11 09:53:41.878 5759-5759/org.mozilla.samples.browser D/++private-browsing++: false\n2020-05-11 09:53:43.242 5759-5759/org.mozilla.samples.browser D/++private-browsing++: true\n2020-05-11 09:53:53.963 6817-6817/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / true\n2020-05-11 09:54:03.541 6817-6817/org.mozilla.samples.browser D/++private-browsing++: false\n2020-05-11 09:54:16.406 7137-7137/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / true\n2020-05-11 09:54:25.290 7137-7137/org.mozilla.samples.browser D/++private-browsing++: false\n2020-05-11 09:54:36.985 7401-7401/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / false\n2020-05-11 09:54:43.557 7401-7401/org.mozilla.samples.browser D/++private-browsing++: true\n2020-05-11 09:54:54.302 7714-7714/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / true\n2020-05-11 09:55:05.207 7714-7714/org.mozilla.samples.browser D/++private-browsing++: false\n2020-05-11 09:55:14.388 7983-7983/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / false\n2020-05-11 09:55:20.700 7983-7983/org.mozilla.samples.browser D/++private-browsing++: true\n2020-05-11 09:55:28.649 8265-8265/org.mozilla.samples.browser D/++private-browsing++: id: uBlock0@raymondhill.net / false```", "id": 14809516, "creation_time": "2020-05-11T13:59:21Z", "creator": "schae@mozilla.com", "attachment_id": null}, {"time": "2020-05-11T21:31:27Z", "raw_text": "Simon: do you kill the app quickly after setting the value? The value has to be written to disk so it takes a little bit to persist. We could potentially change this behavior but I think it would be a separate bug.", "tags": [], "bug_id": 1634493, "is_private": false, "count": 12, "author": "agi@sferro.dev", "attachment_id": null, "creator": "agi@sferro.dev", "creation_time": "2020-05-11T21:31:27Z", "id": 14810745, "text": "Simon: do you kill the app quickly after setting the value? The value has to be written to disk so it takes a little bit to persist. We could potentially change this behavior but I think it would be a separate bug."}, {"raw_text": "(In reply to Agi Sferro | :agi | \u23f0 PST | he/him from comment #12)\n> Simon: do you kill the app quickly after setting the value? The value has to be written to disk so it takes a little bit to persist. We could potentially change this behavior but I think it would be a separate bug.\n\nHmm, how quickly is too quickly? I kill the app after `runtime.webExtensionController.setAllowedInPrivateBrowsing()` success callback (https://github.com/mozilla-mobile/android-components/blob/master/components/browser/engine-gecko-nightly/src/main/java/mozilla/components/browser/engine/gecko/GeckoEngine.kt#L437).", "time": "2020-05-11T23:30:25Z", "author": "schae@mozilla.com", "is_private": false, "count": 13, "bug_id": 1634493, "tags": [], "creation_time": "2020-05-11T23:30:25Z", "attachment_id": null, "creator": "schae@mozilla.com", "id": 14810956, "text": "(In reply to Agi Sferro | :agi | \u23f0 PST | he/him from comment #12)\n> Simon: do you kill the app quickly after setting the value? The value has to be written to disk so it takes a little bit to persist. We could potentially change this behavior but I think it would be a separate bug.\n\nHmm, how quickly is too quickly? I kill the app after `runtime.webExtensionController.setAllowedInPrivateBrowsing()` success callback (https://github.com/mozilla-mobile/android-components/blob/master/components/browser/engine-gecko-nightly/src/main/java/mozilla/components/browser/engine/gecko/GeckoEngine.kt#L437)."}, {"time": "2020-05-12T17:21:17Z", "raw_text": "About a few seconds, can you still reproduce if you wait like 10 seconds before restarting the app?", "tags": [], "bug_id": 1634493, "is_private": false, "count": 14, "author": "agi@sferro.dev", "attachment_id": null, "creator": "agi@sferro.dev", "creation_time": "2020-05-12T17:21:17Z", "id": 14814959, "text": "About a few seconds, can you still reproduce if you wait like 10 seconds before restarting the app?"}, {"creation_time": "2020-05-22T15:33:54Z", "creator": "schae@mozilla.com", "attachment_id": null, "id": 14837742, "text": "It does appear to be more consistent if I wait x amount of time before restarting the app. Enable/disable works with minimal wait time, is there a difference between how these two values are written to the disk?", "raw_text": "It does appear to be more consistent if I wait x amount of time before restarting the app. Enable/disable works with minimal wait time, is there a difference between how these two values are written to the disk?", "time": "2020-05-22T15:33:54Z", "author": "schae@mozilla.com", "bug_id": 1634493, "tags": [], "count": 15, "is_private": false}, {"raw_text": "Yeah we do have different code paths and some flush earlier than others, I'm addressing that in Bug 1637680, please follow that bug. I'm gonna resolve this in the meanwhile since the problem outlined in this bug is fixed.", "time": "2020-05-27T17:09:42Z", "author": "agi@sferro.dev", "tags": [], "bug_id": 1634493, "is_private": false, "count": 16, "creation_time": "2020-05-27T17:09:42Z", "creator": "agi@sferro.dev", "attachment_id": null, "id": 14846845, "text": "Yeah we do have different code paths and some flush earlier than others, I'm addressing that in Bug 1637680, please follow that bug. I'm gonna resolve this in the meanwhile since the problem outlined in this bug is fixed."}]}}}