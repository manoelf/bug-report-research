{"comments": {}, "bugs": {"647102": {"comments": [{"is_private": false, "time": "2011-04-01T02:19:13Z", "attachment_id": 523500, "text": "Created attachment 523500\nv1 PRAGMA synchronous = OFF\n\nOur gloda xpcshell tests do not care whether their data actually hits the disk in the event of a power failure, so we can relax our fsync needs to none.\n\nOn my machine (7200 rpm drive and otherwise ridiculously powerful) the tests went from ~160 seconds to ~112 seconds in duration, which is nothing to sneeze at.\n\nOther, more drastic options include:\n\n- Just create a memory database from the get-go when unit testing so there is no disk involvement.  (Requires changing non-test code, not applicable in all situations like the corrupt database test, would need a way to easily override it so that in check-one situations we could investigate the database after or even during the test run.)\n\n- Don't use a memory database, but do turn off the fsync's as early as possible.  (Also requires changing non-test code, not sure what benefits it would bring.)\n\nI'm asking standard8 for review because I consider test speed to be a testing cross-cutting concern and as release-driver-for-life he should be aware of any potential aspects of realism I am removing from the tests.", "creation_time": "2011-04-01T02:19:13Z", "raw_text": "Our gloda xpcshell tests do not care whether their data actually hits the disk in the event of a power failure, so we can relax our fsync needs to none.\n\nOn my machine (7200 rpm drive and otherwise ridiculously powerful) the tests went from ~160 seconds to ~112 seconds in duration, which is nothing to sneeze at.\n\nOther, more drastic options include:\n\n- Just create a memory database from the get-go when unit testing so there is no disk involvement.  (Requires changing non-test code, not applicable in all situations like the corrupt database test, would need a way to easily override it so that in check-one situations we could investigate the database after or even during the test run.)\n\n- Don't use a memory database, but do turn off the fsync's as early as possible.  (Also requires changing non-test code, not sure what benefits it would bring.)\n\nI'm asking standard8 for review because I consider test speed to be a testing cross-cutting concern and as release-driver-for-life he should be aware of any potential aspects of realism I am removing from the tests.", "id": 5385482, "bug_id": 647102, "creator": "bugmail@asutherland.org", "count": 0, "tags": [], "author": "bugmail@asutherland.org"}, {"author": "bugmail@asutherland.org", "id": 5385488, "raw_text": "Oh, and since this may shake out potential intermittent oranges, I've pushed this to try to see if it does.", "creation_time": "2011-04-01T02:21:23Z", "text": "Oh, and since this may shake out potential intermittent oranges, I've pushed this to try to see if it does.", "count": 1, "tags": [], "creator": "bugmail@asutherland.org", "bug_id": 647102, "attachment_id": null, "is_private": false, "time": "2011-04-01T02:21:23Z"}, {"is_private": false, "creation_time": "2011-05-04T08:33:48Z", "text": "What's the likelyhood of this actually hiding issues with sqlite/gloda later on?\n\ni.e. could we get into a case where a test failure would have been shown, but because we're not doing the fsyncs then the test passes somehow?", "id": 5447811, "raw_text": "What's the likelyhood of this actually hiding issues with sqlite/gloda later on?\n\ni.e. could we get into a case where a test failure would have been shown, but because we're not doing the fsyncs then the test passes somehow?", "tags": [], "count": 2, "creator": "standard8@mozilla.com", "time": "2011-05-04T08:33:48Z", "bug_id": 647102, "attachment_id": null, "author": "standard8@mozilla.com"}, {"attachment_id": null, "author": "bugmail@asutherland.org", "is_private": false, "creation_time": "2011-05-04T16:11:14Z", "text": "Hypothetical intermittent oranges could be impacted.  Namely, the asynchronous thread will likely complete items in its queue more quickly except in cases where actual disk reads or writes need to occur due to insufficient memory to have kept things cached.  This would be visible to the main thread by having callbacks invoked on the main thread earlier than they would otherwise be.\n\nI say hypothetical since the only tests that run with gloda enabled are the gloda tests, and they should not be vulnerable to that type of thing; if they are, it's probably an actual gloda bug...\n\nFunctionally speaking, the usage of fsync only matters if the entire system crashes during the operation of the test.  This would only matter if we had tests where we crashed the machine/VM and then as part of the test brought the system back up and tried to re-use that same database.", "id": 5448481, "raw_text": "Hypothetical intermittent oranges could be impacted.  Namely, the asynchronous thread will likely complete items in its queue more quickly except in cases where actual disk reads or writes need to occur due to insufficient memory to have kept things cached.  This would be visible to the main thread by having callbacks invoked on the main thread earlier than they would otherwise be.\n\nI say hypothetical since the only tests that run with gloda enabled are the gloda tests, and they should not be vulnerable to that type of thing; if they are, it's probably an actual gloda bug...\n\nFunctionally speaking, the usage of fsync only matters if the entire system crashes during the operation of the test.  This would only matter if we had tests where we crashed the machine/VM and then as part of the test brought the system back up and tried to re-use that same database.", "time": "2011-05-04T16:11:14Z", "count": 3, "tags": [], "creator": "bugmail@asutherland.org", "bug_id": 647102}, {"author": "vseerror@lehigh.edu", "bug_id": 647102, "creator": "vseerror@lehigh.edu", "tags": [], "count": 4, "raw_text": "this got review+ but never landed.\nSTM we should land this and see if it sticks", "id": 11123361, "text": "this got review+ but never landed.\nSTM we should land this and see if it sticks", "creation_time": "2016-01-31T14:10:39Z", "attachment_id": null, "time": "2016-01-31T14:10:39Z", "is_private": false}]}}}