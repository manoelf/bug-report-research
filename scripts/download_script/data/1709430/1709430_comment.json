{"comments": {}, "bugs": {"1709430": {"comments": [{"creator": "agarcia@kimbellmuseum.org", "creation_time": "2021-05-04T18:35:10Z", "text": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:88.0) Gecko/20100101 Firefox/88.0\n\nSteps to reproduce:\n\nI used these instructions for making Firefox the default web browser on Windows 10/2012 clients/servers: https://support.mozilla.org/en-US/kb/make-firefox-enterprise-default-browser#firefox-enterprise:win10:\n\nDownload the enterprise version of Firefox (either rapid release or ESR) and install on a Windows 10 or Windows 2012 client.  These instructions call for applying a GPO on Windows machines that calls a separate Default Associations xml document that looks like this:\n\n<DefaultAssociations>\n\n <Association Identifier=\".htm\" ProgId=\"FirefoxHTML\" ApplicationName=\"Firefox\" />\n <Association Identifier=\".html\" ProgId=\"FirefoxHTML\" ApplicationName=\"Firefox\" />\n <Association Identifier=\"http\" ProgId=\"FirefoxHTML\" ApplicationName=\"Firefox\" />\n <Association Identifier=\"https\" ProgId=\"FirefoxHTML\" ApplicationName=\"Firefox\" />\n\n</DefaultAssociations>\n\nPut this file in a location that is accessible to the client and have the GPO point to that file (per the instructions linked above).  These same steps work just fine with Google Chrome using the exact same file at the same location if you just change the progid and application name to match what Google uses (ProgId=\"ChromeHTML\" ApplicationName=\"Google Chrome\") \n\n\nActual results:\n\nWhen you follow these steps for Firefox, and apply the GPO on the windows 10 client (applying the GPO with the command \"gpupdate /force and logging out of Windows and back in) there will be no browser set as the default browser.  Opening an HTML document or clicking on an http/https link will bring up the Windows prompt to select the application you would like to be the default browser.\n\nIf you manually make Firefox the default browser and logout and log back into Windows the problem returns since as expected the GPO applies again at login.  This problem does not occur if you perform the same steps but with/for Google Chrome.\n\nI believe the issue is related to the ProgID portion of the default associations xml document listed in the instructions.  If you manually set Firefox as the default web browser in Windows 10 or Windows 2012 and then go to:\nHKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\Shell\\Associations\\URLAssociations\\(http|https)\\UserChoice\nit shows that the progid of Firefox is \"FirefoxURL-308046B0AF4A39CB\"\n\nIf you edit the default associations xml document from the instructions above and change the http and https sections so that the progid is \"FirefoxURL-308046B0AF4A39CB\" the problem does not occur and everything works as expected.  If this progID changes periodically with updates then this will break GPO's that use this ProgID to make Firefox the default web browser.\n\nI reproduced this issue on multiple machines on new installs as well as machines where Firefox was already installed and just updated to the latest release.\n\n\nExpected results:\n\nThe expected result is that the GPO, along with the default associations file should make Firefox the default application in Windows 10 clients whenever a user logs into windows (just as the instructions state).  Unfortunately this is broken.", "raw_text": "User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:88.0) Gecko/20100101 Firefox/88.0\n\nSteps to reproduce:\n\nI used these instructions for making Firefox the default web browser on Windows 10/2012 clients/servers: https://support.mozilla.org/en-US/kb/make-firefox-enterprise-default-browser#firefox-enterprise:win10:\n\nDownload the enterprise version of Firefox (either rapid release or ESR) and install on a Windows 10 or Windows 2012 client.  These instructions call for applying a GPO on Windows machines that calls a separate Default Associations xml document that looks like this:\n\n<DefaultAssociations>\n\n <Association Identifier=\".htm\" ProgId=\"FirefoxHTML\" ApplicationName=\"Firefox\" />\n <Association Identifier=\".html\" ProgId=\"FirefoxHTML\" ApplicationName=\"Firefox\" />\n <Association Identifier=\"http\" ProgId=\"FirefoxHTML\" ApplicationName=\"Firefox\" />\n <Association Identifier=\"https\" ProgId=\"FirefoxHTML\" ApplicationName=\"Firefox\" />\n\n</DefaultAssociations>\n\nPut this file in a location that is accessible to the client and have the GPO point to that file (per the instructions linked above).  These same steps work just fine with Google Chrome using the exact same file at the same location if you just change the progid and application name to match what Google uses (ProgId=\"ChromeHTML\" ApplicationName=\"Google Chrome\") \n\n\nActual results:\n\nWhen you follow these steps for Firefox, and apply the GPO on the windows 10 client (applying the GPO with the command \"gpupdate /force and logging out of Windows and back in) there will be no browser set as the default browser.  Opening an HTML document or clicking on an http/https link will bring up the Windows prompt to select the application you would like to be the default browser.\n\nIf you manually make Firefox the default browser and logout and log back into Windows the problem returns since as expected the GPO applies again at login.  This problem does not occur if you perform the same steps but with/for Google Chrome.\n\nI believe the issue is related to the ProgID portion of the default associations xml document listed in the instructions.  If you manually set Firefox as the default web browser in Windows 10 or Windows 2012 and then go to:\nHKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\Shell\\Associations\\URLAssociations\\(http|https)\\UserChoice\nit shows that the progid of Firefox is \"FirefoxURL-308046B0AF4A39CB\"\n\nIf you edit the default associations xml document from the instructions above and change the http and https sections so that the progid is \"FirefoxURL-308046B0AF4A39CB\" the problem does not occur and everything works as expected.  If this progID changes periodically with updates then this will break GPO's that use this ProgID to make Firefox the default web browser.\n\nI reproduced this issue on multiple machines on new installs as well as machines where Firefox was already installed and just updated to the latest release.\n\n\nExpected results:\n\nThe expected result is that the GPO, along with the default associations file should make Firefox the default application in Windows 10 clients whenever a user logs into windows (just as the instructions state).  Unfortunately this is broken.", "tags": [], "author": "agarcia@kimbellmuseum.org", "id": 15394331, "bug_id": 1709430, "attachment_id": null, "count": 0, "time": "2021-05-04T18:35:10Z", "is_private": false}, {"author": "release-mgmt-account-bot@mozilla.tld", "tags": [], "raw_text": "The [Bugbug](https://github.com/mozilla/bugbug/) bot thinks this bug should belong to the 'Firefox::Shell Integration' component, and is moving the bug to that component. Please revert this change in case you think the bot is wrong.", "text": "The [Bugbug](https://github.com/mozilla/bugbug/) bot thinks this bug should belong to the 'Firefox::Shell Integration' component, and is moving the bug to that component. Please revert this change in case you think the bot is wrong.", "creation_time": "2021-05-04T19:18:13Z", "creator": "release-mgmt-account-bot@mozilla.tld", "is_private": false, "attachment_id": null, "count": 1, "time": "2021-05-04T19:18:13Z", "bug_id": 1709430, "id": 15394400}, {"text": "An additional piece of information that may or may not be useful.  In Regedit on the windows 10 client, if you go to: \n\nComputer\\HKEY_CLASSES_ROOT\\.html\\OpenWithProgids\nand also\nComputer\\HKEY_CLASSES_ROOT\\.htm\\OpenWithProgids\n\nIt shows a ProgID for each browser installed on the client:\nChromeHTML\nIE.AssocFile.HTM\nMSEdgeHTM\nOperaStable\n\nExcept there's no listing for FireFox, even though its now the default.  There was an additional item there but I can't tell if its firefox or not:\nAppX4hxtad77fbk3jkkeerkrm0ze94wjf3s9\nI was expecting something like FirefoxHTML-308046B0AF4A39CB", "creation_time": "2021-05-04T20:27:31Z", "creator": "agarcia@kimbellmuseum.org", "raw_text": "An additional piece of information that may or may not be useful.  In Regedit on the windows 10 client, if you go to: \n\nComputer\\HKEY_CLASSES_ROOT\\.html\\OpenWithProgids\nand also\nComputer\\HKEY_CLASSES_ROOT\\.htm\\OpenWithProgids\n\nIt shows a ProgID for each browser installed on the client:\nChromeHTML\nIE.AssocFile.HTM\nMSEdgeHTM\nOperaStable\n\nExcept there's no listing for FireFox, even though its now the default.  There was an additional item there but I can't tell if its firefox or not:\nAppX4hxtad77fbk3jkkeerkrm0ze94wjf3s9\nI was expecting something like FirefoxHTML-308046B0AF4A39CB", "tags": [], "author": "agarcia@kimbellmuseum.org", "id": 15394485, "bug_id": 1709430, "is_private": false, "time": "2021-05-04T20:27:31Z", "count": 2, "attachment_id": null}, {"tags": [], "author": "ksteuber@mozilla.com", "text": "(In reply to Alex from comment #0)\n> I used these instructions for making Firefox the default web browser on Windows 10/2012 clients/servers: https://support.mozilla.org/en-US/kb/make-firefox-enterprise-default-browser#firefox-enterprise:win10:\n\nThose instructions seem to be incorrect. As you seem to have discovered, the correct ProgID to set for `http`/`https` is `FirefoxURL-<path hash>`, and the correct ProgID to set for `.htm`/`.html` is `FirefoxHTML-<path hash>`. As far as I know, there is not really a good reason why we use two different ProgIDs, besides the fact that it would be difficult to change at this point.\n\nThose `<path hash>` components make it difficult to write generic instructions using the method that the instructions currently use. Assuming that people want to deploy this GPO to installations where Firefox's path is the same, we could update the instructions to explain how to calculate the path hash. We could also include some common values (i.e. the hashes of the default installation paths).\n\nIf, however, people want to deploy this GPO to installations where Firefox may not always reside at the same path, I suspect that there may be no way to make this mechanism work cleanly.\n\n@mkaply - I believe that you know a lot more about GPO than I do. Do you have any suggestions for what should be done here?", "creation_time": "2021-05-04T23:32:22Z", "creator": "ksteuber@mozilla.com", "raw_text": "(In reply to Alex from comment #0)\n> I used these instructions for making Firefox the default web browser on Windows 10/2012 clients/servers: https://support.mozilla.org/en-US/kb/make-firefox-enterprise-default-browser#firefox-enterprise:win10:\n\nThose instructions seem to be incorrect. As you seem to have discovered, the correct ProgID to set for `http`/`https` is `FirefoxURL-<path hash>`, and the correct ProgID to set for `.htm`/`.html` is `FirefoxHTML-<path hash>`. As far as I know, there is not really a good reason why we use two different ProgIDs, besides the fact that it would be difficult to change at this point.\n\nThose `<path hash>` components make it difficult to write generic instructions using the method that the instructions currently use. Assuming that people want to deploy this GPO to installations where Firefox's path is the same, we could update the instructions to explain how to calculate the path hash. We could also include some common values (i.e. the hashes of the default installation paths).\n\nIf, however, people want to deploy this GPO to installations where Firefox may not always reside at the same path, I suspect that there may be no way to make this mechanism work cleanly.\n\n@mkaply - I believe that you know a lot more about GPO than I do. Do you have any suggestions for what should be done here?", "is_private": false, "count": 3, "attachment_id": null, "time": "2021-05-04T23:32:22Z", "id": 15394728, "bug_id": 1709430}, {"raw_text": "(In reply to Kirk Steuber (he/him) [:bytesized] from comment #3)\n> (In reply to Alex from comment #0)\n> > I used these instructions for making Firefox the default web browser on Windows 10/2012 clients/servers: https://support.mozilla.org/en-US/kb/make-firefox-enterprise-default-browser#firefox-enterprise:win10:\n> \n> Those instructions seem to be incorrect. As you seem to have discovered, the correct ProgID to set for `http`/`https` is `FirefoxURL-<path hash>`, and the correct ProgID to set for `.htm`/`.html` is `FirefoxHTML-<path hash>`. As far as I know, there is not really a good reason why we use two different ProgIDs, besides the fact that it would be difficult to change at this point.\n> \n> Those `<path hash>` components make it difficult to write generic instructions using the method that the instructions currently use. Assuming that people want to deploy this GPO to installations where Firefox's path is the same, we could update the instructions to explain how to calculate the path hash. We could also include some common values (i.e. the hashes of the default installation paths).\n> \n> If, however, people want to deploy this GPO to installations where Firefox may not always reside at the same path, I suspect that there may be no way to make this mechanism work cleanly.\n> \n> @mkaply - I believe that you know a lot more about GPO than I do. Do you have any suggestions for what should be done here?\n\nI have since found this bug report from 3 yrs ago:\nhttps://bugzilla.mozilla.org/show_bug.cgi?id=1462542\n\nIt does a good job of explaining the rationale for adding the hash of the installation path.  Anyway in comment 7 (sorry, don't know how to link directly to a comment) it states the following:\n\"You can also get the hash for an installed copy from the registry at HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\Firefox\\TaskBarIDs, which is a key that contains one value for each install, the name of the value is the install path and the data is the hash as a string.\"\n\nIf I understood that correctly, it will show the hash for each install of Firefox on a machine if there are multiple installations in different locations.  Is that correct?\n\nSo it sounds to me like the solution really is to edit the instructions.  Replace what is currently listed as the progid with the most common progid for default installs in Windows 10  (FirefoxURL-308046B0AF4A39CB and FirefoxHTML-308046B0AF4A39CB) and have a note that states that if Firefox is installed anywhere else other than the default location that the progid will be different and will need to be looked up.  It would be nice if there's a way to find it in about:config or some other place within the browser, or if there is a simple command that would display it in the command prompt or powershell, but if those are not an option then at the very least list this location in the registry to determine the correct progid.", "creator": "agarcia@kimbellmuseum.org", "creation_time": "2021-05-05T02:34:08Z", "text": "(In reply to Kirk Steuber (he/him) [:bytesized] from comment #3)\n> (In reply to Alex from comment #0)\n> > I used these instructions for making Firefox the default web browser on Windows 10/2012 clients/servers: https://support.mozilla.org/en-US/kb/make-firefox-enterprise-default-browser#firefox-enterprise:win10:\n> \n> Those instructions seem to be incorrect. As you seem to have discovered, the correct ProgID to set for `http`/`https` is `FirefoxURL-<path hash>`, and the correct ProgID to set for `.htm`/`.html` is `FirefoxHTML-<path hash>`. As far as I know, there is not really a good reason why we use two different ProgIDs, besides the fact that it would be difficult to change at this point.\n> \n> Those `<path hash>` components make it difficult to write generic instructions using the method that the instructions currently use. Assuming that people want to deploy this GPO to installations where Firefox's path is the same, we could update the instructions to explain how to calculate the path hash. We could also include some common values (i.e. the hashes of the default installation paths).\n> \n> If, however, people want to deploy this GPO to installations where Firefox may not always reside at the same path, I suspect that there may be no way to make this mechanism work cleanly.\n> \n> @mkaply - I believe that you know a lot more about GPO than I do. Do you have any suggestions for what should be done here?\n\nI have since found this bug report from 3 yrs ago:\nhttps://bugzilla.mozilla.org/show_bug.cgi?id=1462542\n\nIt does a good job of explaining the rationale for adding the hash of the installation path.  Anyway in comment 7 (sorry, don't know how to link directly to a comment) it states the following:\n\"You can also get the hash for an installed copy from the registry at HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\Firefox\\TaskBarIDs, which is a key that contains one value for each install, the name of the value is the install path and the data is the hash as a string.\"\n\nIf I understood that correctly, it will show the hash for each install of Firefox on a machine if there are multiple installations in different locations.  Is that correct?\n\nSo it sounds to me like the solution really is to edit the instructions.  Replace what is currently listed as the progid with the most common progid for default installs in Windows 10  (FirefoxURL-308046B0AF4A39CB and FirefoxHTML-308046B0AF4A39CB) and have a note that states that if Firefox is installed anywhere else other than the default location that the progid will be different and will need to be looked up.  It would be nice if there's a way to find it in about:config or some other place within the browser, or if there is a simple command that would display it in the command prompt or powershell, but if those are not an option then at the very least list this location in the registry to determine the correct progid.", "author": "agarcia@kimbellmuseum.org", "tags": [], "bug_id": 1709430, "id": 15394834, "count": 4, "attachment_id": null, "time": "2021-05-05T02:34:08Z", "is_private": false}, {"tags": [], "count": 5, "time": "2021-05-05T15:06:00Z", "attachment_id": null, "is_private": false, "bug_id": 1709430, "id": 15395687, "author": "mozilla@kaply.com", "raw_text": "Yeah, we just need to update the docs. I'll work on it this week.", "creator": "mozilla@kaply.com", "text": "Yeah, we just need to update the docs. I'll work on it this week.", "creation_time": "2021-05-05T15:06:00Z"}, {"tags": [], "author": "ksteuber@mozilla.com", "raw_text": "(In reply to Mike Kaply [:mkaply] from comment #5)\n> Yeah, we just need to update the docs. I'll work on it this week.\n\nThank you!\n\n(In reply to Alex from comment #4)\n> If I understood that correctly, it will show the hash for each install of Firefox on a machine if there are multiple installations in different locations.  Is that correct?\n\nYes, that should be correct. As long as an installation of Firefox was installed with the installer, it will be listed in the `TaskBarIDs` registry key.\n\n> It would be nice if there's a way to find it in about:config or some other place within the browser\n\nThere is a way that you can look it up in the browser. If you open `about:support` in Firefox, one of the top lines will list the \"Update Folder\". The update folder should be `C:\\ProgramData\\Mozilla\\updates\\<install hash>`.\n\nAlternately, if you are comfortable running commands in the Firefox browser console (You have to enable a setting for Firefox to accept commands in the browser console - more details [here](https://developer.mozilla.org/en-US/docs/Tools/Browser_Console)), you can run this command to get the install hash:\n```\nconst xreDirProvider = Cc[\"@mozilla.org/xre/directory-provider;1\"].getService(Ci.nsIXREDirProvider);\nxreDirProvider.getInstallHash();\n```", "text": "(In reply to Mike Kaply [:mkaply] from comment #5)\n> Yeah, we just need to update the docs. I'll work on it this week.\n\nThank you!\n\n(In reply to Alex from comment #4)\n> If I understood that correctly, it will show the hash for each install of Firefox on a machine if there are multiple installations in different locations.  Is that correct?\n\nYes, that should be correct. As long as an installation of Firefox was installed with the installer, it will be listed in the `TaskBarIDs` registry key.\n\n> It would be nice if there's a way to find it in about:config or some other place within the browser\n\nThere is a way that you can look it up in the browser. If you open `about:support` in Firefox, one of the top lines will list the \"Update Folder\". The update folder should be `C:\\ProgramData\\Mozilla\\updates\\<install hash>`.\n\nAlternately, if you are comfortable running commands in the Firefox browser console (You have to enable a setting for Firefox to accept commands in the browser console - more details [here](https://developer.mozilla.org/en-US/docs/Tools/Browser_Console)), you can run this command to get the install hash:\n```\nconst xreDirProvider = Cc[\"@mozilla.org/xre/directory-provider;1\"].getService(Ci.nsIXREDirProvider);\nxreDirProvider.getInstallHash();\n```", "creation_time": "2021-05-05T17:07:20Z", "creator": "ksteuber@mozilla.com", "is_private": false, "time": "2021-05-05T17:07:20Z", "attachment_id": null, "count": 6, "bug_id": 1709430, "id": 15395873}, {"author": "agarcia@kimbellmuseum.org", "tags": [], "raw_text": "To me the \"about:support\" method seems like the simplest set of instructions, that way people aren't having to dig down through the registry.  The command line method intrigues me because that may make it possible to script/automate the creation of the default associations xml file with the the correct progid and eliminate the need to ever have to go look it up.", "creator": "agarcia@kimbellmuseum.org", "creation_time": "2021-05-06T17:24:46Z", "text": "To me the \"about:support\" method seems like the simplest set of instructions, that way people aren't having to dig down through the registry.  The command line method intrigues me because that may make it possible to script/automate the creation of the default associations xml file with the the correct progid and eliminate the need to ever have to go look it up.", "attachment_id": null, "count": 7, "time": "2021-05-06T17:24:46Z", "is_private": false, "bug_id": 1709430, "id": 15397605}, {"author": "mozilla@kaply.com", "tags": [], "raw_text": "How does this sound for the update?\n\n```\n <DefaultAssociations>\n <Association Identifier=\".htm\" ProgId=\"FirefoxHTML-308046B0AF4A39CB\" ApplicationName=\"Firefox\" />\n <Association Identifier=\".html\" ProgId=\"FirefoxHTML-308046B0AF4A39CB\" ApplicationName=\"Firefox\" />\n <Association Identifier=\"http\" ProgId=\"FirefoxURL-308046B0AF4A39CB\" ApplicationName=\"Firefox\" />\n <Association Identifier=\"https\" ProgId=\"FirefoxURL-308046B0AF4A39CB\" ApplicationName=\"Firefox\" />\n</DefaultAssociations>\n```\n\nNote: The 308046B0AF4A39CB value is based on where Firefox is installed. 308046B0AF4A39CB corresponds to C:\\Program Files\\Mozilla Firefox. If your Firefox installation is in C:\\Program Files (x86)\\Mozilla Firefox, you should use E7CF176E110C211B. For any other install location, you can go to about:support and look at the value for Update Folder. The value is after C:\\ProgramData\\Mozilla\\updates\\.", "text": "How does this sound for the update?\n\n```\n <DefaultAssociations>\n <Association Identifier=\".htm\" ProgId=\"FirefoxHTML-308046B0AF4A39CB\" ApplicationName=\"Firefox\" />\n <Association Identifier=\".html\" ProgId=\"FirefoxHTML-308046B0AF4A39CB\" ApplicationName=\"Firefox\" />\n <Association Identifier=\"http\" ProgId=\"FirefoxURL-308046B0AF4A39CB\" ApplicationName=\"Firefox\" />\n <Association Identifier=\"https\" ProgId=\"FirefoxURL-308046B0AF4A39CB\" ApplicationName=\"Firefox\" />\n</DefaultAssociations>\n```\n\nNote: The 308046B0AF4A39CB value is based on where Firefox is installed. 308046B0AF4A39CB corresponds to C:\\Program Files\\Mozilla Firefox. If your Firefox installation is in C:\\Program Files (x86)\\Mozilla Firefox, you should use E7CF176E110C211B. For any other install location, you can go to about:support and look at the value for Update Folder. The value is after C:\\ProgramData\\Mozilla\\updates\\.", "creation_time": "2021-05-06T22:17:42Z", "creator": "mozilla@kaply.com", "is_private": false, "count": 8, "time": "2021-05-06T22:17:42Z", "attachment_id": null, "bug_id": 1709430, "id": 15397970}, {"id": 15397974, "bug_id": 1709430, "attachment_id": null, "count": 9, "time": "2021-05-06T22:22:12Z", "is_private": false, "creator": "agarcia@kimbellmuseum.org", "text": "It looks good to me.  I can confirm that with those values in the default associations .xml file the GPO to make Firefox the default web browser in Windows 10 works correctly as expected.\n\nThank you", "creation_time": "2021-05-06T22:22:12Z", "raw_text": "It looks good to me.  I can confirm that with those values in the default associations .xml file the GPO to make Firefox the default web browser in Windows 10 works correctly as expected.\n\nThank you", "tags": [], "author": "agarcia@kimbellmuseum.org"}, {"creation_time": "2021-05-06T22:23:18Z", "text": "(In reply to Mike Kaply [:mkaply] from comment #8)\n> How does this sound for the update?\n> ...\n\nThat sounds reasonable to me. Thanks!", "creator": "ksteuber@mozilla.com", "raw_text": "(In reply to Mike Kaply [:mkaply] from comment #8)\n> How does this sound for the update?\n> ...\n\nThat sounds reasonable to me. Thanks!", "tags": [], "author": "ksteuber@mozilla.com", "id": 15397975, "bug_id": 1709430, "is_private": false, "attachment_id": null, "count": 10, "time": "2021-05-06T22:23:18Z"}, {"bug_id": 1709430, "id": 15398869, "attachment_id": null, "time": "2021-05-07T15:02:00Z", "count": 11, "is_private": false, "raw_text": "The SUMO documentation has been updated.\n\nThanks for reporting this.", "creator": "mozilla@kaply.com", "creation_time": "2021-05-07T15:02:00Z", "text": "The SUMO documentation has been updated.\n\nThanks for reporting this.", "author": "mozilla@kaply.com", "tags": []}]}}}