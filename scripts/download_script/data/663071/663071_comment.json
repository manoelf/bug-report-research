{"bugs": {"663071": {"comments": [{"id": 5521945, "attachment_id": null, "raw_text": "User-Agent:       Mozilla/5.0 (X11; U; Linux i686; ja; rv:1.9.2.17) Gecko/20110420 Firefox/3.6.17\nBuild Identifier: Mozilla/5.0 (X11; U; Linux i686; ja; rv:1.9.2.17) Gecko/20110414 Thunderbird/3.1.10\n\nWhen I attempt to saving an attachment to a message\nto an almost full file system (by left double-clicking on the attachment),\nTB3 shows displays an misleading error message and then leaves an incomplete\npartial file in the target directory.\n\nMisleading error message is something about\n\"The application has run out of memory for the intended operation, \nplease restart Thunderbird and try again.\"\n\n(The message appears in Japanese, and I am not sure what the English message would be.)\n\nRetrying after restart would not succeed since the file system would remain full\nby the partially saved incomplete file.\n\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Creating a low free space condition in a file system.\n2. Try saving a large attachment that will overflow the file system.\n3. During saving, TB3 generates a misleading error dialog and leaves the partially saved incomplete file behind.\n\n\nActual Results:  \nTB3 shows a misleading error message and leaves\na partially saved incomplete file.\n\nExpected Results:  \nTB3 should show a error dialog that states clearly that the file system\nbecame full, and\nshould remove the partially saved incomplete file.\n\n\nChecking the saving of attachment to \nan almost full system under linux is prompted by\nthe other post\nhttp://bugzilla.mozilla.org/show_bug.cgi?id=429827#c149\n\nabout a bug under XP under similar conditions.\nhttp://bugzilla.mozilla.org/show_bug.cgi?id=632431\n\nUnder XP, it was reported that not only the file, but the file system got corrupted.\n\nBelow is a shell command that creates 5MB volume (and the created\nfilesystem on\nit is much smaller 3.x MB due to the overhead of i-node table, etc.)\n\nI tested saving attachment to the /mnt/5mb-fs above.\n(Saving /usr/lib/libc.a which was about 2.5 MB)\n\n---- create-5mb-fs.sh\n:\n#\nLANG=C \nLC_ALL=C\nexport LANG LC_ALL\n\nLOOPDEV=/dev/loop0\nFILENAME=/tmp/5mb_file\n\n# size\n\nPATH=/sbin:/usr/sbin:$PATH\nexport PATH\n\ndd if=/dev/zero of=${FILENAME} bs=1024 count=5000\nlosetup ${LOOPDEV} ${FILENAME}\nmkfs -t ext3 ${LOOPDEV}\nmkdir /mnt/5mb-fs\nmount ${LOOPDEV} /mnt/5mb-fs/\nls -l /mnt/5mb-fs\n---- end \n\nIt should be easy to test the similar situation using the small filesystem created in this manner.\n\nBy running strace -o /tmp/t.out -p pid-of-thunderbird process,\nI notice that NOSPC (no space error condition seems to have been noted and subsequent write stopped after one re-try, but\nthe error handling from there is not quite right. And I am not even sure\nif the saved file is closed() explicitly.\n[Because the output of strace becomes very huge, I run strace immediately before I hit [SAVE] button, and stopped it immediately after\nthe error dialog is shown and closed by me. strace  output that covers\nthat period doesn't seem to contain the close statement against the file descriptor that is used to write to that file if I am not mistaken.", "creation_time": "2011-06-09T10:19:34Z", "author": "ishikawa@yk.rim.or.jp", "text": "User-Agent:       Mozilla/5.0 (X11; U; Linux i686; ja; rv:1.9.2.17) Gecko/20110420 Firefox/3.6.17\nBuild Identifier: Mozilla/5.0 (X11; U; Linux i686; ja; rv:1.9.2.17) Gecko/20110414 Thunderbird/3.1.10\n\nWhen I attempt to saving an attachment to a message\nto an almost full file system (by left double-clicking on the attachment),\nTB3 shows displays an misleading error message and then leaves an incomplete\npartial file in the target directory.\n\nMisleading error message is something about\n\"The application has run out of memory for the intended operation, \nplease restart Thunderbird and try again.\"\n\n(The message appears in Japanese, and I am not sure what the English message would be.)\n\nRetrying after restart would not succeed since the file system would remain full\nby the partially saved incomplete file.\n\n\nReproducible: Always\n\nSteps to Reproduce:\n1. Creating a low free space condition in a file system.\n2. Try saving a large attachment that will overflow the file system.\n3. During saving, TB3 generates a misleading error dialog and leaves the partially saved incomplete file behind.\n\n\nActual Results:  \nTB3 shows a misleading error message and leaves\na partially saved incomplete file.\n\nExpected Results:  \nTB3 should show a error dialog that states clearly that the file system\nbecame full, and\nshould remove the partially saved incomplete file.\n\n\nChecking the saving of attachment to \nan almost full system under linux is prompted by\nthe other post\nhttp://bugzilla.mozilla.org/show_bug.cgi?id=429827#c149\n\nabout a bug under XP under similar conditions.\nhttp://bugzilla.mozilla.org/show_bug.cgi?id=632431\n\nUnder XP, it was reported that not only the file, but the file system got corrupted.\n\nBelow is a shell command that creates 5MB volume (and the created\nfilesystem on\nit is much smaller 3.x MB due to the overhead of i-node table, etc.)\n\nI tested saving attachment to the /mnt/5mb-fs above.\n(Saving /usr/lib/libc.a which was about 2.5 MB)\n\n---- create-5mb-fs.sh\n:\n#\nLANG=C \nLC_ALL=C\nexport LANG LC_ALL\n\nLOOPDEV=/dev/loop0\nFILENAME=/tmp/5mb_file\n\n# size\n\nPATH=/sbin:/usr/sbin:$PATH\nexport PATH\n\ndd if=/dev/zero of=${FILENAME} bs=1024 count=5000\nlosetup ${LOOPDEV} ${FILENAME}\nmkfs -t ext3 ${LOOPDEV}\nmkdir /mnt/5mb-fs\nmount ${LOOPDEV} /mnt/5mb-fs/\nls -l /mnt/5mb-fs\n---- end \n\nIt should be easy to test the similar situation using the small filesystem created in this manner.\n\nBy running strace -o /tmp/t.out -p pid-of-thunderbird process,\nI notice that NOSPC (no space error condition seems to have been noted and subsequent write stopped after one re-try, but\nthe error handling from there is not quite right. And I am not even sure\nif the saved file is closed() explicitly.\n[Because the output of strace becomes very huge, I run strace immediately before I hit [SAVE] button, and stopped it immediately after\nthe error dialog is shown and closed by me. strace  output that covers\nthat period doesn't seem to contain the close statement against the file descriptor that is used to write to that file if I am not mistaken.", "time": "2011-06-09T10:19:34Z", "tags": [], "is_private": false, "creator": "ishikawa@yk.rim.or.jp", "bug_id": 663071, "count": 0}, {"count": 1, "bug_id": 663071, "creator": "ishikawa@yk.rim.or.jp", "is_private": false, "author": "ishikawa@yk.rim.or.jp", "creation_time": "2011-06-09T10:23:11Z", "tags": [], "time": "2011-06-09T10:23:11Z", "text": "\n> ---- create-5mb-fs.sh\n> :\n> #\n> LANG=C \n> LC_ALL=C\n> export LANG LC_ALL\n> \n> LOOPDEV=/dev/loop0\n> FILENAME=/tmp/5mb_file\n> \n> # size\n> \n> PATH=/sbin:/usr/sbin:$PATH\n> export PATH\n> \n> dd if=/dev/zero of=${FILENAME} bs=1024 count=5000\n> losetup ${LOOPDEV} ${FILENAME}\n> mkfs -t ext3 ${LOOPDEV}\n> mkdir /mnt/5mb-fs\n> mount ${LOOPDEV} /mnt/5mb-fs/\n> ls -l /mnt/5mb-fs\n> ---- end \n> \n\nRun this as superuser and don't forget to make the directory\nworld-writable\n\nchmod a+rwx /mnt/5mb-fs\n\nOtherwise, you can not write to it and will be bitten by another bug\nwhen you left-click (doubleclicking) on the attachment and trying to save the\nattachment.\nBug 567585\n(the saving will fail silently without visible error-feedback.)", "attachment_id": null, "raw_text": "\n> ---- create-5mb-fs.sh\n> :\n> #\n> LANG=C \n> LC_ALL=C\n> export LANG LC_ALL\n> \n> LOOPDEV=/dev/loop0\n> FILENAME=/tmp/5mb_file\n> \n> # size\n> \n> PATH=/sbin:/usr/sbin:$PATH\n> export PATH\n> \n> dd if=/dev/zero of=${FILENAME} bs=1024 count=5000\n> losetup ${LOOPDEV} ${FILENAME}\n> mkfs -t ext3 ${LOOPDEV}\n> mkdir /mnt/5mb-fs\n> mount ${LOOPDEV} /mnt/5mb-fs/\n> ls -l /mnt/5mb-fs\n> ---- end \n> \n\nRun this as superuser and don't forget to make the directory\nworld-writable\n\nchmod a+rwx /mnt/5mb-fs\n\nOtherwise, you can not write to it and will be bitten by another bug\nwhen you left-click (doubleclicking) on the attachment and trying to save the\nattachment.\nBug 567585\n(the saving will fail silently without visible error-feedback.)", "id": 5521952}, {"creation_time": "2011-11-06T03:52:28Z", "author": "ishikawa@yk.rim.or.jp", "text": "I have checked the operation under the latest comm-central(checked out a few days ago).\nThe version ([help] -> about thunderbird) says\n10.0a1\n\nThe message has changed slightly, but still\nmisleading nonetheless. It doesn't say that it is the device/filesystem that is getting full explicitly.\nI am attaching a screen dump to show the dialog.", "bug_id": 663071, "time": "2011-11-06T03:52:28Z", "tags": [], "is_private": false, "creator": "ishikawa@yk.rim.or.jp", "count": 2, "id": 5829008, "attachment_id": null, "raw_text": "I have checked the operation under the latest comm-central(checked out a few days ago).\nThe version ([help] -> about thunderbird) says\n10.0a1\n\nThe message has changed slightly, but still\nmisleading nonetheless. It doesn't say that it is the device/filesystem that is getting full explicitly.\nI am attaching a screen dump to show the dialog."}, {"attachment_id": 572256, "raw_text": "This is the dialog with slightly misleading message when an attachment is saved\nto an almost full file system resulting error.", "id": 5829010, "creator": "ishikawa@yk.rim.or.jp", "is_private": false, "author": "ishikawa@yk.rim.or.jp", "creation_time": "2011-11-06T03:53:45Z", "tags": [], "time": "2011-11-06T03:53:45Z", "text": "Created attachment 572256\nDialog shown on the screen (TB 10.0a1)\n\nThis is the dialog with slightly misleading message when an attachment is saved\nto an almost full file system resulting error.", "count": 3, "bug_id": 663071}, {"count": 4, "bug_id": 663071, "raw_text": "Removing myslef on all the bugs I'm cced on. Please NI me if you need something on MailNews Core bugs from me.", "attachment_id": null, "id": 10776330, "creator": "ludovic@hirlimann.net", "is_private": false, "time": "2015-09-25T12:49:14Z", "tags": [], "text": "Removing myslef on all the bugs I'm cced on. Please NI me if you need something on MailNews Core bugs from me.", "author": "ludovic@hirlimann.net", "creation_time": "2015-09-25T12:49:14Z"}]}}, "comments": {}}