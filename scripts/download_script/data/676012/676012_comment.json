{"comments": {}, "bugs": {"676012": {"comments": [{"tags": [], "attachment_id": null, "is_private": false, "creation_time": "2011-08-02T17:51:47Z", "creator": "kaie@kuix.de", "raw_text": "Today, when using libpkix verification, combined with strict OCSP,\nvisit https://www.dhl.de\nand you get a \"revoked cert\" error page.\n\nAfter the usual nightmare to trace through the libpkix code,\nI identified the cause is:\n\nThe OCSP server returns SEC_ERROR_OCSP_UNAUTHORIZED_REQUEST\nfor the intermediate CA with subject name\n\"CN=DPWN Root CA R2 PS,OU=IT Services,O=Deutsche Post World Net,DC=com\".\n\n\nCurrently the detailed error code for our revocation checking failure is lost.\n\nFor example, pkix_OcspChecker_CheckExternal will set the revocation status to \"revoked\", and the detailed error code is lost.\n\n\nIn my opinion, we might have a difficult time to lobby for strict OCSP checking, as long as diagnosing OCSP failures is difficult.\n\nWe should enhance NSS to return this information.\n\nFor example, after pkix_CheckChain called PKIX_RevocationChecker_Check, detects the \"revoked\" status, and creates an error object, the original error code should be added.\n\n\n(I realize that NSS already creates an error log entry that points to the affected intermediate cert, so the application COULD already report exactly which cert triggered the failure... I will file a separate bug to propose to do that.)", "time": "2011-08-02T17:51:47Z", "id": 5628182, "bug_id": 676012, "author": "kaie@kuix.de", "text": "Today, when using libpkix verification, combined with strict OCSP,\nvisit https://www.dhl.de\nand you get a \"revoked cert\" error page.\n\nAfter the usual nightmare to trace through the libpkix code,\nI identified the cause is:\n\nThe OCSP server returns SEC_ERROR_OCSP_UNAUTHORIZED_REQUEST\nfor the intermediate CA with subject name\n\"CN=DPWN Root CA R2 PS,OU=IT Services,O=Deutsche Post World Net,DC=com\".\n\n\nCurrently the detailed error code for our revocation checking failure is lost.\n\nFor example, pkix_OcspChecker_CheckExternal will set the revocation status to \"revoked\", and the detailed error code is lost.\n\n\nIn my opinion, we might have a difficult time to lobby for strict OCSP checking, as long as diagnosing OCSP failures is difficult.\n\nWe should enhance NSS to return this information.\n\nFor example, after pkix_CheckChain called PKIX_RevocationChecker_Check, detects the \"revoked\" status, and creates an error object, the original error code should be added.\n\n\n(I realize that NSS already creates an error log entry that points to the affected intermediate cert, so the application COULD already report exactly which cert triggered the failure... I will file a separate bug to propose to do that.)", "count": 0}, {"raw_text": "I think in the strict mode, we should report the original error\n(such as SEC_ERROR_OCSP_UNAUTHORIZED_REQUEST) instead of\nSEC_ERROR_REVOKED_CERTIFICATE.  It is inaccurate to report a\ncertificate is revoked when we cannot check the revocation\nstatus.  Reporting the original error will also fix this bug.", "time": "2011-08-02T18:32:42Z", "id": 5628315, "bug_id": 676012, "count": 1, "text": "I think in the strict mode, we should report the original error\n(such as SEC_ERROR_OCSP_UNAUTHORIZED_REQUEST) instead of\nSEC_ERROR_REVOKED_CERTIFICATE.  It is inaccurate to report a\ncertificate is revoked when we cannot check the revocation\nstatus.  Reporting the original error will also fix this bug.", "author": "wtc@google.com", "tags": [], "attachment_id": null, "is_private": false, "creation_time": "2011-08-02T18:32:42Z", "creator": "wtc@google.com"}]}}}