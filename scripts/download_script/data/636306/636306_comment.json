{"bugs": {"636306": {"comments": [{"raw_text": "Improve virtual folder / saved search performance - doesn't scale for large numbers of virtual folders.  \n\nThis isn't about the impact of entering a folder (such as Bug 534520 - Significant lag selecting Inbox Smart Folder (or any very large folder) but rather, Thunderbird becomes slower in normal usage when there are many virtual folders.\n\nI don't have precise steps to reproduce nor a measure for what \"many\" means.\nBut I've encountered this myself - probably starting in the range of 10+ virtual folders. Pretty sure it's dependent on the aggregate size of the folders being spanned (not surprising) - so the number of virtual folders where one hits the breaking point may vary.  \n\nWere it not for this performance issue I'd probably have more virtuals defined to make my life easier. And (dmose) iirc it's one of the reasons I abandoned the mailing list manager addon. \n\nhttp://getsatisfaction.com/mozilla_messaging/topics/smart_folders_that_only_search_when_you_click_on_them#reply_4015258 cites this performance issue (user created 100+ virtuals).  I see it often mentioned in the context of people's small businesses, even for modest numbers of folders, so I'm going to mark this blocking Bug 564148.  And there are many possible applications such as http://getsatisfaction.com/mozilla_messaging/topics/can_we_please_have_a_combined_unified_inbox_view_in_thunderbird\n\n\nPerhaps this should be a meta bug blocked by several bugs which address the technical issues.", "id": 5300292, "text": "Improve virtual folder / saved search performance - doesn't scale for large numbers of virtual folders.  \n\nThis isn't about the impact of entering a folder (such as Bug 534520 - Significant lag selecting Inbox Smart Folder (or any very large folder) but rather, Thunderbird becomes slower in normal usage when there are many virtual folders.\n\nI don't have precise steps to reproduce nor a measure for what \"many\" means.\nBut I've encountered this myself - probably starting in the range of 10+ virtual folders. Pretty sure it's dependent on the aggregate size of the folders being spanned (not surprising) - so the number of virtual folders where one hits the breaking point may vary.  \n\nWere it not for this performance issue I'd probably have more virtuals defined to make my life easier. And (dmose) iirc it's one of the reasons I abandoned the mailing list manager addon. \n\nhttp://getsatisfaction.com/mozilla_messaging/topics/smart_folders_that_only_search_when_you_click_on_them#reply_4015258 cites this performance issue (user created 100+ virtuals).  I see it often mentioned in the context of people's small businesses, even for modest numbers of folders, so I'm going to mark this blocking Bug 564148.  And there are many possible applications such as http://getsatisfaction.com/mozilla_messaging/topics/can_we_please_have_a_combined_unified_inbox_view_in_thunderbird\n\n\nPerhaps this should be a meta bug blocked by several bugs which address the technical issues.", "creation_time": "2011-02-23T23:55:55Z", "bug_id": 636306, "creator": "vseerror@lehigh.edu", "count": 0, "tags": [], "author": "vseerror@lehigh.edu", "is_private": false, "time": "2011-02-23T23:55:55Z", "attachment_id": null}, {"id": 5490245, "raw_text": "(In reply to comment #0)\n> Improve virtual folder / saved search performance - doesn't scale for large\n> numbers of virtual folders.  \n> \n> This isn't about the impact of entering a folder (such as Bug 534520 -\n> Significant lag selecting Inbox Smart Folder (or any very large folder) but\n> rather, Thunderbird becomes slower in normal usage when there are many\n> virtual folders.\n> \n> I don't have precise steps to reproduce nor a measure for what \"many\" means.\n> But I've encountered this myself - probably starting in the range of 10+\n> virtual folders. Pretty sure it's dependent on the aggregate size of the\n> folders being spanned (not surprising) - so the number of virtual folders\n> where one hits the breaking point may vary.  \n> \n> Were it not for this performance issue I'd probably have more virtuals\n> defined to make my life easier. And (dmose) iirc it's one of the reasons I\n> abandoned the mailing list manager addon. \n> \n> http://getsatisfaction.com/mozilla_messaging/topics/\n> smart_folders_that_only_search_when_you_click_on_them#reply_4015258 cites\n> this performance issue (user created 100+ virtuals). \n\ndudley, on Mac 10.4 machine with 1GB memory posted that gsfn topic, and wrote me \"I have 508 \"smart (virtual) folders\" in Macmail\"   I suppose we can't rule out that 508 folders might have caused high memory usage.\n\nHe blew away all the virtual folders, so we no longer have his testcase.", "creation_time": "2011-05-24T19:39:36Z", "text": "(In reply to comment #0)\n> Improve virtual folder / saved search performance - doesn't scale for large\n> numbers of virtual folders.  \n> \n> This isn't about the impact of entering a folder (such as Bug 534520 -\n> Significant lag selecting Inbox Smart Folder (or any very large folder) but\n> rather, Thunderbird becomes slower in normal usage when there are many\n> virtual folders.\n> \n> I don't have precise steps to reproduce nor a measure for what \"many\" means.\n> But I've encountered this myself - probably starting in the range of 10+\n> virtual folders. Pretty sure it's dependent on the aggregate size of the\n> folders being spanned (not surprising) - so the number of virtual folders\n> where one hits the breaking point may vary.  \n> \n> Were it not for this performance issue I'd probably have more virtuals\n> defined to make my life easier. And (dmose) iirc it's one of the reasons I\n> abandoned the mailing list manager addon. \n> \n> http://getsatisfaction.com/mozilla_messaging/topics/\n> smart_folders_that_only_search_when_you_click_on_them#reply_4015258 cites\n> this performance issue (user created 100+ virtuals). \n\ndudley, on Mac 10.4 machine with 1GB memory posted that gsfn topic, and wrote me \"I have 508 \"smart (virtual) folders\" in Macmail\"   I suppose we can't rule out that 508 folders might have caused high memory usage.\n\nHe blew away all the virtual folders, so we no longer have his testcase.", "creator": "vseerror@lehigh.edu", "count": 1, "tags": [], "bug_id": 636306, "author": "vseerror@lehigh.edu", "is_private": false, "time": "2011-05-24T19:39:36Z", "attachment_id": null}, {"is_private": false, "time": "2012-06-27T13:00:59Z", "attachment_id": null, "creation_time": "2012-06-27T13:00:59Z", "text": "is cache working 100% for saved search? \n\nfor reference purposes, here are examples of fixed bugs perf from 3.1/3.0 era:\nBug 533865 - Doing a quick search in a cross-folder saved search clears cached results\nBug 537820 - quick search in smart folders/saved searches should prefer offline when it has a choice\nBug 466048 - Thunderbird freezes/slow when selecting threaded Saved Search/Virtual Folder", "id": 6426783, "raw_text": "is cache working 100% for saved search? \n\nfor reference purposes, here are examples of fixed bugs perf from 3.1/3.0 era:\nBug 533865 - Doing a quick search in a cross-folder saved search clears cached results\nBug 537820 - quick search in smart folders/saved searches should prefer offline when it has a choice\nBug 466048 - Thunderbird freezes/slow when selecting threaded Saved Search/Virtual Folder", "creator": "vseerror@lehigh.edu", "tags": [], "count": 2, "bug_id": 636306, "author": "vseerror@lehigh.edu"}, {"author": "vseerror@lehigh.edu", "count": 3, "tags": [], "creator": "vseerror@lehigh.edu", "bug_id": 636306, "creation_time": "2012-06-27T13:09:05Z", "text": "(In reply to Wayne Mery (:wsmwk) from comment #0)\n> This isn't about a) the impact of entering a folder (such as Bug 534520 -\n> Significant lag selecting Inbox Smart Folder (or any very large folder) but\n> rather, b) Thunderbird becomes slower in normal usage when there are many\n> virtual folders.\n\nbacktracking slightly, it's possible that a) and b) are tightly linked.  so we could explore general virtual perf issues, and split bugs off for specific use cases if needed", "id": 6426801, "raw_text": "(In reply to Wayne Mery (:wsmwk) from comment #0)\n> This isn't about a) the impact of entering a folder (such as Bug 534520 -\n> Significant lag selecting Inbox Smart Folder (or any very large folder) but\n> rather, b) Thunderbird becomes slower in normal usage when there are many\n> virtual folders.\n\nbacktracking slightly, it's possible that a) and b) are tightly linked.  so we could explore general virtual perf issues, and split bugs off for specific use cases if needed", "attachment_id": null, "time": "2012-06-27T13:09:05Z", "is_private": false}, {"attachment_id": null, "is_private": false, "time": "2015-03-10T05:33:28Z", "author": "m-wada@usa.com", "id": 10007575, "raw_text": "If slowness started to occur in Tb 3, it's perhaps due to \"MsgDB open takes long if .msf is big or many .msf is read\".\n   From Tb 3, \"close msgDB after inactivity period\" is executed. \n   Virtual Folder(Search Folder, United Folder/Smart Folder) opens many msgDB at once.\nIf slowness started to occur after landing of patch for bug 764306(landed on Tb 16), and if IMAP folder is relevant, slowness of ListAllKeys() may be involved.\n   http://mxr.mozilla.org/comm-central/source/mailnews/db/msgdb/src/nsMsgDatabase.cpp#1402\n      nsMsgDatabase::OpenMDB calls  DumpContents();\n   http://mxr.mozilla.org/comm-central/source/mailnews/db/msgdb/src/nsMsgDatabase.cpp#5004\n      nsMsgDatabase::DumpContents() calls ListAllKeys(keys);\n   ListAllKeys() has problem of Bug 872869 after patch for bug 764306.\n       See test result of bug 872869 comment #33\n           With patch for bug 764306                   : 266 seconds.\n           After backout of patch for bug 764306 : 265 milliseconds for same job.\n \nTo bug opener, how big is your Virtual Folder?\n     # of Search Target Folder ]\n         # of vlocal Mbox, # of real imap Mbox with Offline-Use=Off, # of real imap Mbox with Offline-Use=Off\n     # of mails in each Search Target Folder.\n\nOnce a Virtual Folder is opened, Search Target Folders(real Mbox) is opened at least a while.\nIf other than Virtual Folder is clicked at folder pane and the Virtual Folder is clicked again, open of Virtual Folder is executed bu open of real Mbox is not needed.\n\nTo bug opener: Do you see your \"Significant lag\" issue in this \"second open of Virtual Folder\"?\nCall \"# of Search Target Folder\" \"N\". Is the \"Significant lag\"  O(  N ^ 2 ) like one? Or O(  N * logN ) like one?  Or O( N )?\n\nI can't imagine  other than O( N ) in Virtual Folder open where N = \"# of Search Target Folder\", although I can imagine O(  M * logM ) folder open time of each Search Target Folder where M=\"number of mails in Search Target Folder\".\n\n> Bug Summaary : doesn't scale for large numbers of virtual folders\n\nTo bug opener: Actually scalability issue in \"numbers of virtual folders\"? Scalability of what?\n\n \n\n(const char *dbName, bool create, bool sync)\n\n, 872869  in Tb 3, it's perhaps due to \"MsgDB open takes long if .msf is big or many .msf is read\".\n   From Tb 3, \"close msgDB after inactivity period\" is executed. \n   Virtual Folder(Search Folder, United Folder/Smart Folder) opens many msgDB at once.", "creation_time": "2015-03-10T05:33:28Z", "text": "If slowness started to occur in Tb 3, it's perhaps due to \"MsgDB open takes long if .msf is big or many .msf is read\".\n   From Tb 3, \"close msgDB after inactivity period\" is executed. \n   Virtual Folder(Search Folder, United Folder/Smart Folder) opens many msgDB at once.\nIf slowness started to occur after landing of patch for bug 764306(landed on Tb 16), and if IMAP folder is relevant, slowness of ListAllKeys() may be involved.\n   http://mxr.mozilla.org/comm-central/source/mailnews/db/msgdb/src/nsMsgDatabase.cpp#1402\n      nsMsgDatabase::OpenMDB calls  DumpContents();\n   http://mxr.mozilla.org/comm-central/source/mailnews/db/msgdb/src/nsMsgDatabase.cpp#5004\n      nsMsgDatabase::DumpContents() calls ListAllKeys(keys);\n   ListAllKeys() has problem of Bug 872869 after patch for bug 764306.\n       See test result of bug 872869 comment #33\n           With patch for bug 764306                   : 266 seconds.\n           After backout of patch for bug 764306 : 265 milliseconds for same job.\n \nTo bug opener, how big is your Virtual Folder?\n     # of Search Target Folder ]\n         # of vlocal Mbox, # of real imap Mbox with Offline-Use=Off, # of real imap Mbox with Offline-Use=Off\n     # of mails in each Search Target Folder.\n\nOnce a Virtual Folder is opened, Search Target Folders(real Mbox) is opened at least a while.\nIf other than Virtual Folder is clicked at folder pane and the Virtual Folder is clicked again, open of Virtual Folder is executed bu open of real Mbox is not needed.\n\nTo bug opener: Do you see your \"Significant lag\" issue in this \"second open of Virtual Folder\"?\nCall \"# of Search Target Folder\" \"N\". Is the \"Significant lag\"  O(  N ^ 2 ) like one? Or O(  N * logN ) like one?  Or O( N )?\n\nI can't imagine  other than O( N ) in Virtual Folder open where N = \"# of Search Target Folder\", although I can imagine O(  M * logM ) folder open time of each Search Target Folder where M=\"number of mails in Search Target Folder\".\n\n> Bug Summaary : doesn't scale for large numbers of virtual folders\n\nTo bug opener: Actually scalability issue in \"numbers of virtual folders\"? Scalability of what?\n\n \n\n(const char *dbName, bool create, bool sync)\n\n, 872869  in Tb 3, it's perhaps due to \"MsgDB open takes long if .msf is big or many .msf is read\".\n   From Tb 3, \"close msgDB after inactivity period\" is executed. \n   Virtual Folder(Search Folder, United Folder/Smart Folder) opens many msgDB at once.", "tags": [], "count": 4, "creator": "m-wada@usa.com", "bug_id": 636306}, {"attachment_id": null, "is_private": false, "time": "2015-03-10T05:48:41Z", "author": "m-wada@usa.com", "creation_time": "2015-03-10T05:48:41Z", "text": "(In reply to Wayne Mery (:wsmwk) from comment #0)\n> but rather, Thunderbird becomes slower in normal usage when there are many virtual folders.\n\nEach Virtual Folder opens all real folder requested as Search Target Folder. And all Virtual Folders does do it.\nThis produces state of \"very many mail boxes are opened at same time and kept open\" by single folder click at folder pane.\nThis surely increases Virtual Memory consumption.\nAll Unified Folder are opened by Tb upon startup of Tb.\n.\nUnified Folder(aka Smart Folder) hooks events such as msgDBHdrAdded of real Mboxes to reflect new mail in Inbox, sent mail copy to Sent etc., because it's \"Unified Folder\"(user expects real Inbox, real Sent like presentation) instead of \"Search Folder\"(display of a Search Result).\nThis kind of activites may increase CPU utilization, Virtual Memory  consumption.", "id": 10007604, "raw_text": "(In reply to Wayne Mery (:wsmwk) from comment #0)\n> but rather, Thunderbird becomes slower in normal usage when there are many virtual folders.\n\nEach Virtual Folder opens all real folder requested as Search Target Folder. And all Virtual Folders does do it.\nThis produces state of \"very many mail boxes are opened at same time and kept open\" by single folder click at folder pane.\nThis surely increases Virtual Memory consumption.\nAll Unified Folder are opened by Tb upon startup of Tb.\n.\nUnified Folder(aka Smart Folder) hooks events such as msgDBHdrAdded of real Mboxes to reflect new mail in Inbox, sent mail copy to Sent etc., because it's \"Unified Folder\"(user expects real Inbox, real Sent like presentation) instead of \"Search Folder\"(display of a Search Result).\nThis kind of activites may increase CPU utilization, Virtual Memory  consumption.", "creator": "m-wada@usa.com", "count": 5, "tags": [], "bug_id": 636306}]}}, "comments": {}}