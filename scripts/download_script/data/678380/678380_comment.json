{"bugs": {"678380": {"comments": [{"creator": "margaret.leibovic@gmail.com", "author": "margaret.leibovic@gmail.com", "count": 0, "is_private": false, "tags": [], "id": 5648844, "bug_id": 678380, "creation_time": "2011-08-11T22:36:24Z", "raw_text": "Looking into the dependency tree for bug 579874, it seems like the only time we actually want to overwrite an app tab with a new URI is when the user navigates within the website with links clicks (except for external links, as fixed by bug 575561).\n\nThat being said, it seems like we want to avoid overwriting the app tab when the browser is the one loading a new URI. I made a patch that adds a pinned tab check to tabbrowser's loadURI and loadURIWithFlags method and loads a new tab if the current one is pinned, and this fixes bug 579873 and bug 598587.\n\nI haven't audited all the places we call these methods, but like I said above, I can't really think of cases where we call these methods and actually want to load the new URI in a currently pinned tab.", "text": "Created attachment 552524\npatch\n\nLooking into the dependency tree for bug 579874, it seems like the only time we actually want to overwrite an app tab with a new URI is when the user navigates within the website with links clicks (except for external links, as fixed by bug 575561).\n\nThat being said, it seems like we want to avoid overwriting the app tab when the browser is the one loading a new URI. I made a patch that adds a pinned tab check to tabbrowser's loadURI and loadURIWithFlags method and loads a new tab if the current one is pinned, and this fixes bug 579873 and bug 598587.\n\nI haven't audited all the places we call these methods, but like I said above, I can't really think of cases where we call these methods and actually want to load the new URI in a currently pinned tab.", "time": "2011-08-11T22:36:24Z", "attachment_id": 552524}, {"creation_time": "2011-08-11T23:16:19Z", "raw_text": "Does this seem like a good idea, or are there places that this would break things? Also, what kinds of tests would be needed here?", "attachment_id": 552524, "time": "2011-08-11T23:16:19Z", "text": "Comment on attachment 552524\npatch\n\nDoes this seem like a good idea, or are there places that this would break things? Also, what kinds of tests would be needed here?", "id": 5648951, "tags": [], "count": 1, "is_private": false, "bug_id": 678380, "author": "margaret.leibovic@gmail.com", "creator": "margaret.leibovic@gmail.com"}, {"is_private": false, "count": 2, "tags": [], "id": 5649605, "bug_id": 678380, "creation_time": "2011-08-12T09:54:32Z", "raw_text": ">       <method name=\"loadURI\">\n>         <parameter name=\"aURI\"/>\n>         <parameter name=\"aReferrerURI\"/>\n>         <parameter name=\"aCharset\"/>\n>         <body>\n>           <![CDATA[\n>+            // Avoid overwriting pinned tabs by loading the new URI in a new tab\n>+            if (this.mCurrentTab.pinned)\n>+              return this.loadOneTab(aURI, { referrerURI: aReferrerURI,\n>+                                             charset: aCharset,\n>+                                             inBackground: false });\n>+\n>             return this.mCurrentBrowser.loadURI(aURI, aReferrerURI, aCharset);\n>           ]]>\n>         </body>\n>       </method>\n\nloadURI isn't supposed to return a tab. (And the existing 'return' is bogus; it always returns undefined.)\n\nGenerally, I think this is going too far, unless you check the host before redirecting the load.", "text": "Comment on attachment 552524\npatch\n\n>       <method name=\"loadURI\">\n>         <parameter name=\"aURI\"/>\n>         <parameter name=\"aReferrerURI\"/>\n>         <parameter name=\"aCharset\"/>\n>         <body>\n>           <![CDATA[\n>+            // Avoid overwriting pinned tabs by loading the new URI in a new tab\n>+            if (this.mCurrentTab.pinned)\n>+              return this.loadOneTab(aURI, { referrerURI: aReferrerURI,\n>+                                             charset: aCharset,\n>+                                             inBackground: false });\n>+\n>             return this.mCurrentBrowser.loadURI(aURI, aReferrerURI, aCharset);\n>           ]]>\n>         </body>\n>       </method>\n\nloadURI isn't supposed to return a tab. (And the existing 'return' is bogus; it always returns undefined.)\n\nGenerally, I think this is going too far, unless you check the host before redirecting the load.", "time": "2011-08-12T09:54:32Z", "attachment_id": 552524, "creator": "dao+bmo@mozilla.com", "author": "dao+bmo@mozilla.com"}, {"creator": "margaret.leibovic@gmail.com", "author": "margaret.leibovic@gmail.com", "text": "Comment on attachment 552524\npatch\n\nThinking about this more, this may not be as magical a fix as I had hoped. For example, if you load a URI from the location bar, this patch does not handle reverting the urlbar value in the app tab, so something would probably still need to be done to fix bug 598587. If that's the case, we might be better off doing spot fixes where these problems are cropping up.", "time": "2011-08-15T23:33:32Z", "attachment_id": 552524, "raw_text": "Thinking about this more, this may not be as magical a fix as I had hoped. For example, if you load a URI from the location bar, this patch does not handle reverting the urlbar value in the app tab, so something would probably still need to be done to fix bug 598587. If that's the case, we might be better off doing spot fixes where these problems are cropping up.", "creation_time": "2011-08-15T23:33:32Z", "bug_id": 678380, "is_private": false, "count": 3, "tags": [], "id": 5655608}]}}, "comments": {}}