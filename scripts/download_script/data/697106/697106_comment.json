{"comments": {}, "bugs": {"697106": {"comments": [{"is_private": false, "creation_time": "2011-10-25T14:44:26Z", "creator": "acelists@atlas.sk", "tags": [], "attachment_id": null, "bug_id": 697106, "id": 5803126, "author": "acelists@atlas.sk", "text": "Steps to reproduce:\n1. open msgfilterrules.dat file in some program that locks it (I used Far Manager built-in viewer (F3)). I don't know what type of lock is needed, but Tb will probably need and exclusive RW one so read lock could be enough.\n2. go to Message Filters and make any changes to a filter.\n3. confirm with OK, close dialog. No warning.\n4. close TB. Notice the changes weren't stored in the msgfilterrules.dat file but TB didn't warn about it.\n\nI get this error in the Error console after step 3:\nError: uncaught exception: [Exception... \"Component returned failure code: 0x80520015 (NS_ERROR_FILE_ACCESS_DENIED) [nsIMsgFilterList.saveToDefaultFile]\"  nsresult: \"0x80520015 (NS_ERROR_FILE_ACCESS_DENIED)\"  location: \"JS frame :: chrome://messenger/content/FilterListDialog.js :: onFilterUnload :: line 315\"  data: no]\n\nExpected result:\nTb should display a warning the filters could not be saved.", "count": 0, "raw_text": "Steps to reproduce:\n1. open msgfilterrules.dat file in some program that locks it (I used Far Manager built-in viewer (F3)). I don't know what type of lock is needed, but Tb will probably need and exclusive RW one so read lock could be enough.\n2. go to Message Filters and make any changes to a filter.\n3. confirm with OK, close dialog. No warning.\n4. close TB. Notice the changes weren't stored in the msgfilterrules.dat file but TB didn't warn about it.\n\nI get this error in the Error console after step 3:\nError: uncaught exception: [Exception... \"Component returned failure code: 0x80520015 (NS_ERROR_FILE_ACCESS_DENIED) [nsIMsgFilterList.saveToDefaultFile]\"  nsresult: \"0x80520015 (NS_ERROR_FILE_ACCESS_DENIED)\"  location: \"JS frame :: chrome://messenger/content/FilterListDialog.js :: onFilterUnload :: line 315\"  data: no]\n\nExpected result:\nTb should display a warning the filters could not be saved.", "time": "2011-10-25T14:44:26Z"}, {"time": "2011-12-29T11:48:09Z", "raw_text": "FYI.\nIf file is opened by other software when Tb attempts file I/O, some known problems may occur. I think many Tb's file I/O code is not so torelant with interfere by other software, as Tb's file I/O code is not torelant with system crash, power failure, crash/freeze of Tb and so on.\n\n(1) prefs.js\nBecause I/O of prefs.js is \"write to prefs-N.js, delete prefs.js, rename prefs-N.js prefs.js\"(called \"Safe file writing), if prefs.js is opened by other software, prefs.js is not updatd and file named prefs-N.js increases upon each prefs.js update by Tb. If this continues even when termination of Tb, update of prefs.js is lost, although final data is kept in latest prefs-N.js.\n(2) VirtualFolders.dat, bug 650831 relevant.\nVirtualFolders.dat is written by \"open write replace, write data\".(not method called \"Safe file writing\"). See bug 650831 for this. File I/O for msgFilterRules.dat is similar to VirtualFolders.dat. So, similar problem to this bug can occur on virtualFolders.dat too.\n(3) MsgDB, bug 498814\nIf mail folder file is opened by other software when Tb tries to Compact folder, Compact silently fails. If mail folder file is closed by other software just before Tb's \"delete of old file\" step, mail folder file is possibly deleted by Tb.\n(4) Mail data of IMAP offline-use=on folder, Bug 501851\nIf appending to IMAP offline-store file is interfered with other software, mail data at offset=0 in offline-store(length=102,256 bytes) is used as mail data.", "author": "m-wada@usa.com", "count": 1, "text": "FYI.\nIf file is opened by other software when Tb attempts file I/O, some known problems may occur. I think many Tb's file I/O code is not so torelant with interfere by other software, as Tb's file I/O code is not torelant with system crash, power failure, crash/freeze of Tb and so on.\n\n(1) prefs.js\nBecause I/O of prefs.js is \"write to prefs-N.js, delete prefs.js, rename prefs-N.js prefs.js\"(called \"Safe file writing), if prefs.js is opened by other software, prefs.js is not updatd and file named prefs-N.js increases upon each prefs.js update by Tb. If this continues even when termination of Tb, update of prefs.js is lost, although final data is kept in latest prefs-N.js.\n(2) VirtualFolders.dat, bug 650831 relevant.\nVirtualFolders.dat is written by \"open write replace, write data\".(not method called \"Safe file writing\"). See bug 650831 for this. File I/O for msgFilterRules.dat is similar to VirtualFolders.dat. So, similar problem to this bug can occur on virtualFolders.dat too.\n(3) MsgDB, bug 498814\nIf mail folder file is opened by other software when Tb tries to Compact folder, Compact silently fails. If mail folder file is closed by other software just before Tb's \"delete of old file\" step, mail folder file is possibly deleted by Tb.\n(4) Mail data of IMAP offline-use=on folder, Bug 501851\nIf appending to IMAP offline-store file is interfered with other software, mail data at offset=0 in offline-store(length=102,256 bytes) is used as mail data.", "bug_id": 697106, "id": 5944712, "attachment_id": null, "tags": [], "creator": "m-wada@usa.com", "is_private": false, "creation_time": "2011-12-29T11:48:09Z"}, {"raw_text": "FYI.\nBug 494706 was one of most critical problems ivoked by interfere of other software.", "time": "2011-12-29T19:55:39Z", "bug_id": 697106, "id": 5945449, "author": "m-wada@usa.com", "count": 2, "text": "FYI.\nBug 494706 was one of most critical problems ivoked by interfere of other software.", "tags": [], "attachment_id": null, "creation_time": "2011-12-29T19:55:39Z", "is_private": false, "creator": "m-wada@usa.com"}, {"creator": "m-wada@usa.com", "count": 3, "text": "Created attachment 584807\nProcess Monitor Log : rename msgFilterRules-1.dat msgFilterRules.dat is OK\n\nSave to msgFilterRules.dat is successful.\n1. Write to msgFilterRules-1.dat\n2. Rename msgFilterRules-1.dat msgFilterRules.dat (with ReplaceIfExists mode)", "author": "m-wada@usa.com", "id": 5945475, "bug_id": 697106, "creation_time": "2011-12-29T20:03:30Z", "is_private": false, "time": "2011-12-29T20:03:30Z", "raw_text": "Save to msgFilterRules.dat is successful.\n1. Write to msgFilterRules-1.dat\n2. Rename msgFilterRules-1.dat msgFilterRules.dat (with ReplaceIfExists mode)", "attachment_id": 584807, "tags": []}, {"attachment_id": 584810, "tags": [], "creator": "m-wada@usa.com", "creation_time": "2011-12-29T20:09:46Z", "is_private": false, "time": "2011-12-29T20:09:46Z", "raw_text": "Save to msgFilterRules.dat fails, because interfered by other software.\n1. Write mode open of msgFilterRules.dat by Sakura Editor.\n2. Write to msgFilterRules-1.dat\n3. Rename msgFilterRules-1.dat msgFilterRules.dat (with ReplaceIfExists mode)\n   => fails with \"ACCESS DENIED\"\n> Error: uncaught exception: [Exception... \"Component returned failure code: 0x80520015 (NS_ERROR_FILE_ACCESS_DENIED)\n> [nsIMsgFilterList.saveToDefaultFile]\"  nsresult: \"0x80520015 (NS_ERROR_FILE_ACCESS_DENIED)\"\n> location: \"JS frame :: chrome://messenger/content/FilterListDialog.js :: onFilterUnload :: line 300\"  data: no]\n4. Delete msgFilterRules-1.dat", "author": "m-wada@usa.com", "text": "Created attachment 584810\nProcess Monitor Log : rename msgFilterRules-1.dat msgFilterRules.dat fails\n\nSave to msgFilterRules.dat fails, because interfered by other software.\n1. Write mode open of msgFilterRules.dat by Sakura Editor.\n2. Write to msgFilterRules-1.dat\n3. Rename msgFilterRules-1.dat msgFilterRules.dat (with ReplaceIfExists mode)\n   => fails with \"ACCESS DENIED\"\n> Error: uncaught exception: [Exception... \"Component returned failure code: 0x80520015 (NS_ERROR_FILE_ACCESS_DENIED)\n> [nsIMsgFilterList.saveToDefaultFile]\"  nsresult: \"0x80520015 (NS_ERROR_FILE_ACCESS_DENIED)\"\n> location: \"JS frame :: chrome://messenger/content/FilterListDialog.js :: onFilterUnload :: line 300\"  data: no]\n4. Delete msgFilterRules-1.dat", "count": 4, "id": 5945488, "bug_id": 697106}, {"raw_text": "Problem was reproduced with Tb 9.0.1 on Win-XP.\nConfirming.", "time": "2011-12-29T20:11:17Z", "bug_id": 697106, "id": 5945495, "count": 5, "text": "Problem was reproduced with Tb 9.0.1 on Win-XP.\nConfirming.", "author": "m-wada@usa.com", "tags": [], "attachment_id": null, "creation_time": "2011-12-29T20:11:17Z", "is_private": false, "creator": "m-wada@usa.com"}, {"bug_id": 697106, "id": 5945520, "creation_time": "2011-12-29T20:19:37Z", "is_private": false, "creator": "m-wada@usa.com", "author": "m-wada@usa.com", "text": "File I/O of msgFilterRules.dat was same as or similar to prefs.js.\n  \"write xxx-N.ext, rename xxx-N.ext xxx.ext\" way,\n   but msgFilterRules-1.dat was deleted when \"ACCESS DENIED\" is returned to rename.\nIf prefs.js, delete of prefs-N.js was not observed when test in the past.", "count": 6, "tags": [], "time": "2011-12-29T20:19:37Z", "attachment_id": null, "raw_text": "File I/O of msgFilterRules.dat was same as or similar to prefs.js.\n  \"write xxx-N.ext, rename xxx-N.ext xxx.ext\" way,\n   but msgFilterRules-1.dat was deleted when \"ACCESS DENIED\" is returned to rename.\nIf prefs.js, delete of prefs-N.js was not observed when test in the past."}, {"is_private": false, "creation_time": "2011-12-29T20:32:21Z", "id": 5945564, "bug_id": 697106, "author": "m-wada@usa.com", "count": 7, "text": "(In reply to :aceman from comment #0)\n> Expected result:\n> Tb should display a warning the filters could not be saved.\n\nI think \"Retry? Save to other location? Cancel?\" like dialog is kind for user, because \"Retry? Cancel?\" dialog is already shown by Tb when Draft/Sent/Templates save error.\nThis kind of dialog is also useful for write error of Tb's important flat files such as prefs.js, virtualFolders.dat, abook-X.mab.", "creator": "m-wada@usa.com", "tags": [], "attachment_id": null, "raw_text": "(In reply to :aceman from comment #0)\n> Expected result:\n> Tb should display a warning the filters could not be saved.\n\nI think \"Retry? Save to other location? Cancel?\" like dialog is kind for user, because \"Retry? Cancel?\" dialog is already shown by Tb when Draft/Sent/Templates save error.\nThis kind of dialog is also useful for write error of Tb's important flat files such as prefs.js, virtualFolders.dat, abook-X.mab.", "time": "2011-12-29T20:32:21Z"}, {"bug_id": 697106, "id": 5945632, "is_private": false, "creation_time": "2011-12-29T20:53:40Z", "creator": "m-wada@usa.com", "text": "FYI.\nWhen virtualFolders.dat, file is written with \"write with OverwriteIf\" mode, and no error message is shown even if write error occurs, and latest data is lost. However, severity of problem is far lower than msgFilterRules.dat case, because virtual folder is recovered from existent .msf file for virtual folder upon restart of Tb and virtualFolders.dat is updated by latest information.", "count": 8, "author": "m-wada@usa.com", "tags": [], "time": "2011-12-29T20:53:40Z", "raw_text": "FYI.\nWhen virtualFolders.dat, file is written with \"write with OverwriteIf\" mode, and no error message is shown even if write error occurs, and latest data is lost. However, severity of problem is far lower than msgFilterRules.dat case, because virtual folder is recovered from existent .msf file for virtual folder upon restart of Tb and virtualFolders.dat is updated by latest information.", "attachment_id": null}, {"creator": "acelists@atlas.sk", "text": "I'll take this as I no longer can reproduce the error. Maybe we replace the filter file in a safe manner now (e.g. create new one, write, then replace the old one) in which case the lock on the original file is not an issue anymore.\nEven if I kept the file locked while TB was open, after closing TB and reopening the file in an editor, the NEW contents was in the file.", "count": 9, "author": "acelists@atlas.sk", "id": 11483100, "bug_id": 697106, "creation_time": "2016-06-14T13:39:49Z", "is_private": false, "time": "2016-06-14T13:39:49Z", "raw_text": "I'll take this as I no longer can reproduce the error. Maybe we replace the filter file in a safe manner now (e.g. create new one, write, then replace the old one) in which case the lock on the original file is not an issue anymore.\nEven if I kept the file locked while TB was open, after closing TB and reopening the file in an editor, the NEW contents was in the file.", "attachment_id": null, "tags": []}, {"bug_id": 697106, "id": 11808058, "creation_time": "2016-10-24T10:51:17Z", "is_private": false, "creator": "vseerror@lehigh.edu", "text": "https://support.mozilla.org/en-US/questions/1143806 might be describing this.", "count": 10, "author": "vseerror@lehigh.edu", "tags": [], "time": "2016-10-24T10:51:17Z", "raw_text": "https://support.mozilla.org/en-US/questions/1143806 might be describing this.", "attachment_id": null}, {"creation_time": "2016-12-21T23:24:25Z", "is_private": false, "bug_id": 697106, "id": 11936291, "count": 11, "text": "*** Bug 1324287 has been marked as a duplicate of this bug. ***", "author": "jorgk-bmo@jorgk.com", "creator": "jorgk-bmo@jorgk.com", "tags": [], "raw_text": "", "attachment_id": null, "time": "2016-12-21T23:24:25Z"}, {"creator": "jorgk-bmo@jorgk.com", "author": "jorgk-bmo@jorgk.com", "count": 12, "text": "*** Bug 1341563 has been marked as a duplicate of this bug. ***", "bug_id": 697106, "id": 12088455, "is_private": false, "creation_time": "2017-02-22T15:30:04Z", "time": "2017-02-22T15:30:04Z", "attachment_id": null, "raw_text": "", "tags": []}, {"author": "contactjlrdb@gmail.com", "text": "I think the problem is worse than initially reported: all chnages are discarded, the passwords to accounts are stored in the password manager file as long as tb is open. when closed and repopened, everything has vanished.\n\nthis is quite annoying. does it have anything to do with permissions ? I use el crapitan and I regret my move from windows, which i did cause i wasted so much time on windows applications.\n\nsame happening here.", "count": 13, "id": 12098491, "bug_id": 697106, "time": "2017-02-26T11:14:48Z", "raw_text": "I think the problem is worse than initially reported: all chnages are discarded, the passwords to accounts are stored in the password manager file as long as tb is open. when closed and repopened, everything has vanished.\n\nthis is quite annoying. does it have anything to do with permissions ? I use el crapitan and I regret my move from windows, which i did cause i wasted so much time on windows applications.\n\nsame happening here.", "creator": "contactjlrdb@gmail.com", "is_private": false, "creation_time": "2017-02-26T11:14:48Z", "attachment_id": null, "tags": []}, {"text": "If you don't have write access to the files in your profile you're in trouble ;-(\n\nWhy don't you visit the profile (Help > Troubleshooting Information, open the profile) and check the access rights?", "count": 14, "author": "jorgk-bmo@jorgk.com", "bug_id": 697106, "id": 12098518, "time": "2017-02-26T12:11:33Z", "raw_text": "If you don't have write access to the files in your profile you're in trouble ;-(\n\nWhy don't you visit the profile (Help > Troubleshooting Information, open the profile) and check the access rights?", "creator": "jorgk-bmo@jorgk.com", "is_private": false, "creation_time": "2017-02-26T12:11:33Z", "attachment_id": null, "tags": []}, {"creator": "zetka@volny.cz", "is_private": false, "creation_time": "2017-03-05T10:44:02Z", "attachment_id": null, "tags": [], "author": "zetka@volny.cz", "text": "As far as I was struggling with the similar problem (bug 1324287) and it tooks a time to find, where is the root of the problem, it would be nice to have at least warning, that something could not be saved. In case of not saving data of password manager it is quite critical I think.", "count": 15, "bug_id": 697106, "id": 12116474, "time": "2017-03-05T10:44:02Z", "raw_text": "As far as I was struggling with the similar problem (bug 1324287) and it tooks a time to find, where is the root of the problem, it would be nice to have at least warning, that something could not be saved. In case of not saving data of password manager it is quite critical I think."}]}}}