{"bugs": {"711924": {"comments": [{"attachment_id": 582763, "raw_text": "Go to this page and it uses 100% CPU (this has been the case for years now IIRC).\n\nThe culprit appears to be the smooth-scrolling \"Community\" box.\n\nJProf (of a recent trunk pull, opt on) shows js_Date() as uses almost 50% of the CPU (and of that, 4% is memcpy and 5% in date_getTime, and 8% in gettimeofday)\n\nAbout 1/2 the rest is processing events, mostly painting, spawning threads (odd?), reflow, etc.\n\nVirtually fresh profile, no extensions.", "text": "Created attachment 582763\njprof of sitting at the given URL for a few minutes\n\nGo to this page and it uses 100% CPU (this has been the case for years now IIRC).\n\nThe culprit appears to be the smooth-scrolling \"Community\" box.\n\nJProf (of a recent trunk pull, opt on) shows js_Date() as uses almost 50% of the CPU (and of that, 4% is memcpy and 5% in date_getTime, and 8% in gettimeofday)\n\nAbout 1/2 the rest is processing events, mostly painting, spawning threads (odd?), reflow, etc.\n\nVirtually fresh profile, no extensions.", "bug_id": 711924, "tags": [], "is_private": false, "count": 0, "id": 5926173, "creator": "rjesup@jesup.org", "time": "2011-12-19T09:05:20Z", "creation_time": "2011-12-19T09:05:20Z", "author": "rjesup@jesup.org"}, {"count": 1, "id": 5926654, "is_private": false, "creation_time": "2011-12-19T15:21:44Z", "time": "2011-12-19T15:21:44Z", "creator": "rjesup@jesup.org", "author": "rjesup@jesup.org", "attachment_id": null, "raw_text": "Additional information: under IE8, it also uses 100% CPU, but if the box is hidden (covered by another window), CPU use drops to about 50% of a core (and in particular 'system' cpu use on Windows drops dramatically).  FF doesn't do that, but does suspend the scrollbox when the tab is hidden.\n\nIt may be that the change in IE when it's hidden is avoiding trying to redraw the hidden box, and that the other 50% of a core is doing the equivalent to js_Date, but that's just a guess.  You might be able to tell by monitoring gfx requests at the OS level while the two are running.\n\nSo this could be JS or GFX.", "tags": [], "bug_id": 711924, "text": "Additional information: under IE8, it also uses 100% CPU, but if the box is hidden (covered by another window), CPU use drops to about 50% of a core (and in particular 'system' cpu use on Windows drops dramatically).  FF doesn't do that, but does suspend the scrollbox when the tab is hidden.\n\nIt may be that the change in IE when it's hidden is avoiding trying to redraw the hidden box, and that the other 50% of a core is doing the equivalent to js_Date, but that's just a guess.  You might be able to tell by monitoring gfx requests at the OS level while the two are running.\n\nSo this could be JS or GFX."}, {"is_private": false, "id": 5931625, "count": 2, "author": "dmandelin@mozilla.com", "creator": "dmandelin@mozilla.com", "time": "2011-12-21T02:02:26Z", "creation_time": "2011-12-21T02:02:26Z", "raw_text": "Is this a recent regression?", "attachment_id": null, "bug_id": 711924, "text": "Is this a recent regression?", "tags": []}, {"creator": "rjesup@jesup.org", "time": "2011-12-21T04:28:35Z", "creation_time": "2011-12-21T04:28:35Z", "author": "rjesup@jesup.org", "is_private": false, "count": 3, "id": 5931773, "text": "No, not recent (per comment 0: \"this has been the case for years now IIRC\")", "bug_id": 711924, "tags": [], "attachment_id": null, "raw_text": "No, not recent (per comment 0: \"this has been the case for years now IIRC\")"}, {"is_private": false, "id": 5932351, "count": 4, "author": "rjesup@jesup.org", "creator": "rjesup@jesup.org", "time": "2011-12-21T13:11:21Z", "creation_time": "2011-12-21T13:11:21Z", "raw_text": "Classic bad JS, identical to http://stackoverflow.com/questions/951021/javascript-sleep\n\nThe only interesting thing left here is that IE dramatically cuts the overhead when the box is obscured (perhaps by not trying to draw - the 'system' CPU use on WinXP drops to virtually zero), while we don't cut it unless the tab is hidden.  Changing title, moving to GFX\n\nUsed with \"sleep(2)\" in LCScriptUtils.js:\n\n/* To have finer control on the rate of scroll */\nfunction sleep(naptime)\n{\n\tnaptime = naptime * 10;\n\tvar sleeping = true;\n\tvar now = new Date();\n\tvar alarm;\n\tvar startingMSeconds = now.getTime();\n\t\n\twhile (sleeping)\n\t{\n\t\talarm = new Date();\n\t\talarmMSeconds = alarm.getTime();\n\t\tif (alarmMSeconds - startingMSeconds > naptime)\n\t\t{\n\t\t\tsleeping = false;\n\t\t}\n\t}\n}", "attachment_id": null, "tags": [], "text": "Classic bad JS, identical to http://stackoverflow.com/questions/951021/javascript-sleep\n\nThe only interesting thing left here is that IE dramatically cuts the overhead when the box is obscured (perhaps by not trying to draw - the 'system' CPU use on WinXP drops to virtually zero), while we don't cut it unless the tab is hidden.  Changing title, moving to GFX\n\nUsed with \"sleep(2)\" in LCScriptUtils.js:\n\n/* To have finer control on the rate of scroll */\nfunction sleep(naptime)\n{\n\tnaptime = naptime * 10;\n\tvar sleeping = true;\n\tvar now = new Date();\n\tvar alarm;\n\tvar startingMSeconds = now.getTime();\n\t\n\twhile (sleeping)\n\t{\n\t\talarm = new Date();\n\t\talarmMSeconds = alarm.getTime();\n\t\tif (alarmMSeconds - startingMSeconds > naptime)\n\t\t{\n\t\t\tsleeping = false;\n\t\t}\n\t}\n}", "bug_id": 711924}]}}, "comments": {}}