{"comments": {}, "bugs": {"1635764": {"comments": [{"id": 14800261, "creation_time": "2020-05-06T13:37:27Z", "author": "jbeich@FreeBSD.org", "creator": "jbeich@FreeBSD.org", "is_private": false, "raw_text": "```c++\n$ c++ --version\nFreeBSD clang version 10.0.0 (git@github.com:llvm/llvm-project.git llvmorg-10.0.0-0-gd32170dbd5b)\nTarget: x86_64-unknown-freebsd13.0\nThread model: posix\nInstalledDir: /usr/bin\n\n$ pkg info -x icu\nicu-67.1,1\n\n$ echo \"ac_add_options --with-system-icu\" >>.mozconfig\n$ ./mach build\n[...]\nld.lld: error: undefined hidden symbol: uloc_getDefault\n>>> referenced by OSPreferences_gtk.cpp\n>>>               ../../../intl/locale/gtk/OSPreferences_gtk.o:(mozilla::intl::OSPreferences::ReadSystemLocales(nsTArray<nsTString<char> >&))\n>>> referenced by Unified_cpp_js_src25.cpp\n>>>               Unified_cpp_js_src25.o:(JSRuntime::getDefaultLocale()) in archive ../../../js/src/build/libjs_static.a\n>>> did you mean: uloc_setDefault\n>>> defined in: /usr/local/lib/libicuuc.so\nld.lld: error: undefined hidden symbol: unorm2_getNFDInstance\n>>> referenced by Unified_cpp_unicharutil_util0.cpp\n>>>               ../../../intl/unicharutil/util/Unified_cpp_unicharutil_util0.o:(mozilla::unicode::GetNaked(unsigned int))\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(str_normalize(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unorm2_getNFCInstance\n>>> referenced by Unified_cpp_gfx_thebes1.cpp\n>>>               ../../../gfx/thebes/Unified_cpp_gfx_thebes1.o:(gfxHarfBuzzShaper::Initialize())\n>>> referenced by Unified_cpp_gfx_thebes1.cpp\n>>>               ../../../gfx/thebes/Unified_cpp_gfx_thebes1.o:(gfxFontGroup::FindFontForChar(unsigned int, unsigned int, unsigned int, mozilla::unicode::Script, gfxFont*, FontMatchType*))\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(str_normalize(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::createTimeZone(icu::UnicodeString const&)\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalResyncICUDefaultTimeZone()) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::getUnknown()\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalResyncICUDefaultTimeZone()) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::detectHostTimeZone()\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalResyncICUDefaultTimeZone()) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::adoptDefault(icu::TimeZone*)\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalResyncICUDefaultTimeZone()) in archive ../../../js/src/build/libjs_static.a\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalResyncICUDefaultTimeZone()) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::createDefault()\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::computeDSTOffsetMilliseconds(long)) in archive ../../../js/src/build/libjs_static.a\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::computeUTCOffsetMilliseconds(long)) in archive ../../../js/src/build/libjs_static.a\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::computeLocalOffsetMilliseconds(long)) in archive ../../../js/src/build/libjs_static.a\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalTimeZoneDisplayName(char16_t*, unsigned long, long, char const*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::getDisplayName(signed char, icu::TimeZone::EDisplayType, icu::Locale const&, icu::UnicodeString&) const\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalTimeZoneDisplayName(char16_t*, unsigned long, long, char const*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unorm2_getNFKCInstance\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(str_normalize(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unorm2_getNFKDInstance\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(str_normalize(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unorm2_spanQuickCheckYes\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(str_normalize(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unorm2_normalizeSecondAndAppend\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(int js::intl::CallICU<str_normalize(JSContext*, unsigned int, JS::Value*)::$_16, char16_t, 32ul>(JSContext*, str_normalize(JSContext*, unsigned int, JS::Value*)::$_16 const&, mozilla::Vector<char16_t, 32ul, js::TempAllocPolicy>&)) in archive ../../../js/src/build/libjs_static.a\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(int js::intl::CallICU<str_normalize(JSContext*, unsigned int, JS::Value*)::$_16, char16_t, 32ul>(JSContext*, str_normalize(JSContext*, unsigned int, JS::Value*)::$_16 const&, mozilla::Vector<char16_t, 32ul, js::TempAllocPolicy>&)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unumsys_open\n>>> referenced by Unified_cpp_js_src5.cpp\n>>>               Unified_cpp_js_src5.o:(js::intl_numberingSystem(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unumsys_getName\n>>> referenced by Unified_cpp_js_src5.cpp\n>>>               Unified_cpp_js_src5.o:(js::intl_numberingSystem(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unumsys_close\n>>> referenced by Unified_cpp_js_src5.cpp\n>>>               Unified_cpp_js_src5.o:(js::intl_numberingSystem(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nc++: error: linker command failed with exit code 1 (use -v to see invocation)\n```", "text": "```c++\n$ c++ --version\nFreeBSD clang version 10.0.0 (git@github.com:llvm/llvm-project.git llvmorg-10.0.0-0-gd32170dbd5b)\nTarget: x86_64-unknown-freebsd13.0\nThread model: posix\nInstalledDir: /usr/bin\n\n$ pkg info -x icu\nicu-67.1,1\n\n$ echo \"ac_add_options --with-system-icu\" >>.mozconfig\n$ ./mach build\n[...]\nld.lld: error: undefined hidden symbol: uloc_getDefault\n>>> referenced by OSPreferences_gtk.cpp\n>>>               ../../../intl/locale/gtk/OSPreferences_gtk.o:(mozilla::intl::OSPreferences::ReadSystemLocales(nsTArray<nsTString<char> >&))\n>>> referenced by Unified_cpp_js_src25.cpp\n>>>               Unified_cpp_js_src25.o:(JSRuntime::getDefaultLocale()) in archive ../../../js/src/build/libjs_static.a\n>>> did you mean: uloc_setDefault\n>>> defined in: /usr/local/lib/libicuuc.so\nld.lld: error: undefined hidden symbol: unorm2_getNFDInstance\n>>> referenced by Unified_cpp_unicharutil_util0.cpp\n>>>               ../../../intl/unicharutil/util/Unified_cpp_unicharutil_util0.o:(mozilla::unicode::GetNaked(unsigned int))\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(str_normalize(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unorm2_getNFCInstance\n>>> referenced by Unified_cpp_gfx_thebes1.cpp\n>>>               ../../../gfx/thebes/Unified_cpp_gfx_thebes1.o:(gfxHarfBuzzShaper::Initialize())\n>>> referenced by Unified_cpp_gfx_thebes1.cpp\n>>>               ../../../gfx/thebes/Unified_cpp_gfx_thebes1.o:(gfxFontGroup::FindFontForChar(unsigned int, unsigned int, unsigned int, mozilla::unicode::Script, gfxFont*, FontMatchType*))\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(str_normalize(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::createTimeZone(icu::UnicodeString const&)\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalResyncICUDefaultTimeZone()) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::getUnknown()\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalResyncICUDefaultTimeZone()) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::detectHostTimeZone()\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalResyncICUDefaultTimeZone()) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::adoptDefault(icu::TimeZone*)\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalResyncICUDefaultTimeZone()) in archive ../../../js/src/build/libjs_static.a\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalResyncICUDefaultTimeZone()) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::createDefault()\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::computeDSTOffsetMilliseconds(long)) in archive ../../../js/src/build/libjs_static.a\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::computeUTCOffsetMilliseconds(long)) in archive ../../../js/src/build/libjs_static.a\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::computeLocalOffsetMilliseconds(long)) in archive ../../../js/src/build/libjs_static.a\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalTimeZoneDisplayName(char16_t*, unsigned long, long, char const*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: icu::TimeZone::getDisplayName(signed char, icu::TimeZone::EDisplayType, icu::Locale const&, icu::UnicodeString&) const\n>>> referenced by Unified_cpp_js_src18.cpp\n>>>               Unified_cpp_js_src18.o:(js::DateTimeInfo::internalTimeZoneDisplayName(char16_t*, unsigned long, long, char const*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unorm2_getNFKCInstance\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(str_normalize(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unorm2_getNFKDInstance\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(str_normalize(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unorm2_spanQuickCheckYes\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(str_normalize(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unorm2_normalizeSecondAndAppend\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(int js::intl::CallICU<str_normalize(JSContext*, unsigned int, JS::Value*)::$_16, char16_t, 32ul>(JSContext*, str_normalize(JSContext*, unsigned int, JS::Value*)::$_16 const&, mozilla::Vector<char16_t, 32ul, js::TempAllocPolicy>&)) in archive ../../../js/src/build/libjs_static.a\n>>> referenced by Unified_cpp_js_src2.cpp\n>>>               Unified_cpp_js_src2.o:(int js::intl::CallICU<str_normalize(JSContext*, unsigned int, JS::Value*)::$_16, char16_t, 32ul>(JSContext*, str_normalize(JSContext*, unsigned int, JS::Value*)::$_16 const&, mozilla::Vector<char16_t, 32ul, js::TempAllocPolicy>&)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unumsys_open\n>>> referenced by Unified_cpp_js_src5.cpp\n>>>               Unified_cpp_js_src5.o:(js::intl_numberingSystem(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unumsys_getName\n>>> referenced by Unified_cpp_js_src5.cpp\n>>>               Unified_cpp_js_src5.o:(js::intl_numberingSystem(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nld.lld: error: undefined hidden symbol: unumsys_close\n>>> referenced by Unified_cpp_js_src5.cpp\n>>>               Unified_cpp_js_src5.o:(js::intl_numberingSystem(JSContext*, unsigned int, JS::Value*)) in archive ../../../js/src/build/libjs_static.a\nc++: error: linker command failed with exit code 1 (use -v to see invocation)\n```", "time": "2020-05-06T13:37:27Z", "attachment_id": null, "tags": [], "count": 0, "bug_id": 1635764}, {"count": 1, "tags": [], "time": "2020-05-07T16:17:45Z", "creator": "rstewart@mozilla.com", "creation_time": "2020-05-07T16:17:45Z", "bug_id": 1635764, "attachment_id": null, "text": "Can you take a look dmajor?", "raw_text": "Can you take a look dmajor?", "is_private": false, "id": 14802831, "author": "rstewart@mozilla.com"}, {"attachment_id": null, "bug_id": 1635764, "id": 14802946, "author": "rstewart@mozilla.com", "is_private": false, "text": "Ah yeah, so I missed that you were building for FreeBSD, which is a [tier-3 supported platform](https://developer.mozilla.org/en-US/docs/Mozilla/Supported_build_configurations). That combined with the `--with-system-icu` makes it unlikely we would have time to devote to working on this.\n\nThe error messages would suggest that your system ICU doesn't expose all the functions that the in-tree library does when linked. If that's not the case and it's a build thing we may accept patches.", "raw_text": "Ah yeah, so I missed that you were building for FreeBSD, which is a [tier-3 supported platform](https://developer.mozilla.org/en-US/docs/Mozilla/Supported_build_configurations). That combined with the `--with-system-icu` makes it unlikely we would have time to devote to working on this.\n\nThe error messages would suggest that your system ICU doesn't expose all the functions that the in-tree library does when linked. If that's not the case and it's a build thing we may accept patches.", "time": "2020-05-07T17:04:42Z", "tags": [], "count": 2, "creation_time": "2020-05-07T17:04:42Z", "creator": "rstewart@mozilla.com"}, {"bug_id": 1635764, "attachment_id": null, "is_private": false, "text": "FWIW since this was already traced down to bug 1634623, maybe glandium might have an idea offhand.", "raw_text": "FWIW since this was already traced down to bug 1634623, maybe glandium might have an idea offhand.", "id": 14802957, "author": "away@bugmail.cc", "tags": [], "count": 3, "time": "2020-05-07T17:06:38Z", "creation_time": "2020-05-07T17:06:38Z", "creator": "away@bugmail.cc"}, {"time": "2020-05-07T23:56:02Z", "count": 4, "tags": [], "creator": "mh+mozilla@glandium.org", "creation_time": "2020-05-07T23:56:02Z", "attachment_id": null, "bug_id": 1635764, "author": "mh+mozilla@glandium.org", "id": 14803832, "raw_text": "This affects more than just --enable-system-icu, unfortunately.", "text": "This affects more than just --enable-system-icu, unfortunately.", "is_private": false}, {"author": "mh+mozilla@glandium.org", "id": 14850944, "is_private": false, "raw_text": "For the record, the reason I'm filing bugs to move various flags to python configure blocking this one is that to fix the regression from bug 1634623, the flags for old-configure need to be switched to js_option. But when doing that, when we invoke the js subconfigure, we also explicitly pass default values from the top-level configure, because they could be different from the js subconfigure default. So e.g. we'd pass --without-system-icu by default. For this specific one, it's actually okay. But for about all the cases that take string arguments, it's not handled correctly. It's a pretty common misuse of autoconf, and of all the flags we have, only one does it correctly-ish.", "text": "For the record, the reason I'm filing bugs to move various flags to python configure blocking this one is that to fix the regression from bug 1634623, the flags for old-configure need to be switched to js_option. But when doing that, when we invoke the js subconfigure, we also explicitly pass default values from the top-level configure, because they could be different from the js subconfigure default. So e.g. we'd pass --without-system-icu by default. For this specific one, it's actually okay. But for about all the cases that take string arguments, it's not handled correctly. It's a pretty common misuse of autoconf, and of all the flags we have, only one does it correctly-ish.", "attachment_id": null, "bug_id": 1635764, "creation_time": "2020-05-29T05:57:12Z", "creator": "mh+mozilla@glandium.org", "time": "2020-05-29T05:57:12Z", "tags": [], "count": 5}, {"attachment_id": 9152630, "bug_id": 1635764, "author": "mh+mozilla@glandium.org", "id": 14851107, "text": "Created attachment 9152630\nBug 1635764 - Move --with-system-icu and --with-intl-api to python configure.\n\nAt the same time, because it's now simpler to do so, set the right data\nfile name for big-endians, even though we don't have or produce it\n(bug #1264836). Also remove USE_ICU, which is redundant with\nJS_HAS_INTL_API, and actively break the build at configure time when\nusing --without-intl-api with Firefox because this hasn't actually\nworked for close to 3 years (since bug 1402048).", "raw_text": "At the same time, because it's now simpler to do so, set the right data\nfile name for big-endians, even though we don't have or produce it\n(bug #1264836). Also remove USE_ICU, which is redundant with\nJS_HAS_INTL_API, and actively break the build at configure time when\nusing --without-intl-api with Firefox because this hasn't actually\nworked for close to 3 years (since bug 1402048).", "is_private": false, "time": "2020-05-29T08:39:53Z", "count": 6, "tags": [], "creator": "mh+mozilla@glandium.org", "creation_time": "2020-05-29T08:39:53Z"}, {"tags": [], "count": 7, "time": "2020-05-29T08:59:35Z", "creation_time": "2020-05-29T08:59:35Z", "creator": "mh+mozilla@glandium.org", "bug_id": 1635764, "attachment_id": null, "is_private": false, "text": "With the patch in this bug and all its dependencies, all the remaining flags attached to old-configure are not for Spidermonkey, so for the purpose of the regression from bug 1634623, this marks the end of it.", "raw_text": "With the patch in this bug and all its dependencies, all the remaining flags attached to old-configure are not for Spidermonkey, so for the purpose of the regression from bug 1634623, this marks the end of it.", "author": "mh+mozilla@glandium.org", "id": 14851132}, {"attachment_id": null, "bug_id": 1635764, "author": "pulsebot@bots.tld", "id": 14852676, "text": "Pushed by mh@glandium.org:\nhttps://hg.mozilla.org/integration/autoland/rev/23f9231f76bf\nMove --with-system-icu and --with-intl-api to python configure. r=firefox-build-system-reviewers,rstewart", "raw_text": "Pushed by mh@glandium.org:\nhttps://hg.mozilla.org/integration/autoland/rev/23f9231f76bf\nMove --with-system-icu and --with-intl-api to python configure. r=firefox-build-system-reviewers,rstewart", "is_private": false, "time": "2020-05-29T22:42:34Z", "count": 8, "tags": [], "creator": "pulsebot@bots.tld", "creation_time": "2020-05-29T22:42:34Z"}, {"attachment_id": null, "bug_id": 1635764, "id": 14853020, "author": "malexandru@mozilla.com", "is_private": false, "text": "https://hg.mozilla.org/mozilla-central/rev/23f9231f76bf", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/23f9231f76bf", "time": "2020-05-30T09:48:42Z", "tags": ["bugherder"], "count": 9, "creation_time": "2020-05-30T09:48:42Z", "creator": "malexandru@mozilla.com"}, {"attachment_id": null, "bug_id": 1635764, "id": 14856782, "author": "dan@danny.cz", "is_private": false, "text": "This change caused bug 1642184 on big endian arches like s390x.", "raw_text": "This change caused bug 1642184 on big endian arches like s390x.", "time": "2020-06-01T21:50:35Z", "tags": [], "count": 10, "creation_time": "2020-06-01T21:50:35Z", "creator": "dan@danny.cz"}]}}}