{"bugs": {"658138": {"comments": [{"author": "mcmanus@ducksong.com", "creator": "mcmanus@ducksong.com", "text": "a PR_poll of a ssl socket using in_flags of (PR_POLL_READ | PR_POLL_EXCEPT) will generate PR_POLL_EXCEPT (or maybe PR_POLL_ERR - I forget) if PK11LoggedOut or AlreadyShutDown is satisified..\n\nbut a PR_poll of the same socket using just PR_POLL_EXCEPT returns no conditions.\n\nas PR_POLL_READ is just a test of whether there is data available to to be read, it shouldn't impact this. I am pretty certain that PR_POLL_WRITE could be substituted for PR_POLL_READ.\n\nfound during bug 654201 - which has inserted an extraneous PR_POLL_READ check into the code to workaround this.", "id": 5478903, "attachment_id": null, "creation_time": "2011-05-19T01:16:56Z", "tags": [], "is_private": false, "time": "2011-05-19T01:16:56Z", "count": 0, "bug_id": 658138, "raw_text": "a PR_poll of a ssl socket using in_flags of (PR_POLL_READ | PR_POLL_EXCEPT) will generate PR_POLL_EXCEPT (or maybe PR_POLL_ERR - I forget) if PK11LoggedOut or AlreadyShutDown is satisified..\n\nbut a PR_poll of the same socket using just PR_POLL_EXCEPT returns no conditions.\n\nas PR_POLL_READ is just a test of whether there is data available to to be read, it shouldn't impact this. I am pretty certain that PR_POLL_WRITE could be substituted for PR_POLL_READ.\n\nfound during bug 654201 - which has inserted an extraneous PR_POLL_READ check into the code to workaround this."}, {"time": "2011-05-22T03:37:54Z", "bug_id": 658138, "count": 1, "creator": "mcmanus@ducksong.com", "author": "mcmanus@ducksong.com", "tags": [], "is_private": false, "raw_text": "35 ERROR TEST-UNEXPECTED-FAIL | /tests/security/ssl/stricttransportsecurity/test_sts_privatebrowsing.html | Test timed out.\n\nin the absence of PR_POLL_READ in nsSocketTransport::IsAlive() this test fails often - more often on linux and os x (though not all the time).. it is in mochitest-5", "text": "35 ERROR TEST-UNEXPECTED-FAIL | /tests/security/ssl/stricttransportsecurity/test_sts_privatebrowsing.html | Test timed out.\n\nin the absence of PR_POLL_READ in nsSocketTransport::IsAlive() this test fails often - more often on linux and os x (though not all the time).. it is in mochitest-5", "id": 5485003, "attachment_id": null, "creation_time": "2011-05-22T03:37:54Z"}, {"raw_text": "This is due to the following code in the (platform-specific) implementations of PR_Poll:\n\n            if (pd->in_flags & PR_POLL_READ)\n            {\n                in_flags_read = (pd->fd->methods->poll)(\n                    pd->fd, (PRInt16)(pd->in_flags & ~PR_POLL_WRITE),\n                    &out_flags_read);\n            }\n            if (pd->in_flags & PR_POLL_WRITE)\n            {\n                in_flags_write = (pd->fd->methods->poll)(\n                    pd->fd, (PRInt16)(pd->in_flags & ~PR_POLL_READ),\n                    &out_flags_write);\n            }\n\nIf neither PR_POLL_READ or PR_POLL_WRITE is passed, then the poll method never gets called. Some poll methods (such as the one in PSM) return errors that are generated by non-network-related issues, and we (Mozilla) at one point tried to use PR_Poll to detect these errors.\n\nPerhaps if neither PR_POLL_READ or PR_POLL_WRITE are passed in in_flags, but in_flags is nonzero, then we should call the poll method with in_flags.", "is_private": false, "tags": [], "creation_time": "2011-09-04T08:27:33Z", "attachment_id": null, "id": 5698934, "text": "This is due to the following code in the (platform-specific) implementations of PR_Poll:\n\n            if (pd->in_flags & PR_POLL_READ)\n            {\n                in_flags_read = (pd->fd->methods->poll)(\n                    pd->fd, (PRInt16)(pd->in_flags & ~PR_POLL_WRITE),\n                    &out_flags_read);\n            }\n            if (pd->in_flags & PR_POLL_WRITE)\n            {\n                in_flags_write = (pd->fd->methods->poll)(\n                    pd->fd, (PRInt16)(pd->in_flags & ~PR_POLL_READ),\n                    &out_flags_write);\n            }\n\nIf neither PR_POLL_READ or PR_POLL_WRITE is passed, then the poll method never gets called. Some poll methods (such as the one in PSM) return errors that are generated by non-network-related issues, and we (Mozilla) at one point tried to use PR_Poll to detect these errors.\n\nPerhaps if neither PR_POLL_READ or PR_POLL_WRITE are passed in in_flags, but in_flags is nonzero, then we should call the poll method with in_flags.", "count": 2, "bug_id": 658138, "time": "2011-09-04T08:27:33Z", "author": "brian@briansmith.org", "creator": "brian@briansmith.org"}]}}, "comments": {}}