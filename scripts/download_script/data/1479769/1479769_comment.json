{"bugs": {"1479769": {"comments": [{"author": "shaun.miller@hull.ac.uk", "text": "Created attachment 8996304\nFirefox version, registry and options snip\n\nUser Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:61.0) Gecko/20100101 Firefox/61.0\nBuild ID: 20180704003137\n\nSteps to reproduce:\n\nI am setting the homepage via the new group policy templates in ESR 60.1.0 (64-bit en-US). The URL has an anchor link at the end which is required in this instance. I can see that the value is being set via the GPO in the windows registry at HKLM\\Software\\Policies\\Mozilla\\Firefox\\Homepage\\URL with the correct value.\n\n\nActual results:\n\nWhen firefox is launched, the path is loaded from the registry but the # and everthing afterwards (the anchor link) is being removed. This is visible within Options in Firefox as well where the URL is incomplete.\n\n\nExpected results:\n\nThe value should have been read as-is from the registry and applied to the homepage value in Firefox on first launch. Instead, the string appears to be cleaned and removes the anchor link.", "tags": [], "bug_id": 1479769, "count": 0, "id": 13512948, "is_private": false, "raw_text": "User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:61.0) Gecko/20100101 Firefox/61.0\nBuild ID: 20180704003137\n\nSteps to reproduce:\n\nI am setting the homepage via the new group policy templates in ESR 60.1.0 (64-bit en-US). The URL has an anchor link at the end which is required in this instance. I can see that the value is being set via the GPO in the windows registry at HKLM\\Software\\Policies\\Mozilla\\Firefox\\Homepage\\URL with the correct value.\n\n\nActual results:\n\nWhen firefox is launched, the path is loaded from the registry but the # and everthing afterwards (the anchor link) is being removed. This is visible within Options in Firefox as well where the URL is incomplete.\n\n\nExpected results:\n\nThe value should have been read as-is from the registry and applied to the homepage value in Firefox on first launch. Instead, the string appears to be cleaned and removes the anchor link.", "creator": "shaun.miller@hull.ac.uk", "attachment_id": 8996304, "creation_time": "2018-07-31T13:46:04Z", "time": "2018-07-31T13:46:04Z"}, {"text": "Can you test this using Nightly to see if the same problem happens?\n\nIf so, please go to about:support and click on the Active policies link (this is only available on nightly at the moment) to see if the anchor shows up in the parsed JSON", "author": "felipc@gmail.com", "bug_id": 1479769, "tags": [], "id": 13517438, "count": 1, "is_private": false, "creator": "felipc@gmail.com", "attachment_id": null, "raw_text": "Can you test this using Nightly to see if the same problem happens?\n\nIf so, please go to about:support and click on the Active policies link (this is only available on nightly at the moment) to see if the anchor shows up in the parsed JSON", "creation_time": "2018-08-02T02:18:12Z", "time": "2018-08-02T02:18:12Z"}, {"is_private": false, "time": "2018-08-02T09:16:21Z", "creation_time": "2018-08-02T09:16:21Z", "attachment_id": 8996951, "creator": "shaun.miller@hull.ac.uk", "raw_text": "Screenshot of testing bug against nightly as requested", "bug_id": 1479769, "tags": [], "text": "Created attachment 8996951\nNightly 20180801 Snip\n\nScreenshot of testing bug against nightly as requested", "author": "shaun.miller@hull.ac.uk", "id": 13517955, "count": 2}, {"count": 3, "id": 13517959, "tags": [], "bug_id": 1479769, "author": "shaun.miller@hull.ac.uk", "text": "Hi Felipe,\n\nUnfortunately, the behavior is the same. I removed ESR 60.1, installed nightly 63.0a1 and deleted the user profile to clear any cached settings. Because the Options page(s) have change since the last ESR release, the location of the value in the interface has moved and doesn't seemed to be presented as yet. I presume it will appear as a custom URL by release. Screenshot is attached as before.\n\nThanks,\nShaun", "creation_time": "2018-08-02T09:19:08Z", "time": "2018-08-02T09:19:08Z", "raw_text": "Hi Felipe,\n\nUnfortunately, the behavior is the same. I removed ESR 60.1, installed nightly 63.0a1 and deleted the user profile to clear any cached settings. Because the Options page(s) have change since the last ESR release, the location of the value in the interface has moved and doesn't seemed to be presented as yet. I presume it will appear as a custom URL by release. Screenshot is attached as before.\n\nThanks,\nShaun", "creator": "shaun.miller@hull.ac.uk", "attachment_id": null, "is_private": false}, {"creator": "kanika16047@iiitd.ac.in", "attachment_id": null, "raw_text": "I tried reproduce this error and coincidentally, I had set the \"Locked\" property to be true. And to my surprise, it worked fine. \nThen I removed the value of Locked and I got this error. \nTherefore, it becomes easier to find the bug in the code. \nHere at https://searchfox.org/mozilla-central/source/browser/components/enterprisepolicies/Policies.jsm#531,539-541\nwe can see the difference between two conditional blocks. \nIn the \"else\" block, prefvalue is being prefixed with \"data:text/plain,browser.startup.homepage=\". On removing this extra string, the homepage is set as expected. \nI couldn't figure out what this string value is changing in the else block and breaking the code as well. \nFelipe, any inputs?", "creation_time": "2018-08-05T11:09:17Z", "time": "2018-08-05T11:09:17Z", "is_private": false, "id": 13523366, "count": 4, "text": "I tried reproduce this error and coincidentally, I had set the \"Locked\" property to be true. And to my surprise, it worked fine. \nThen I removed the value of Locked and I got this error. \nTherefore, it becomes easier to find the bug in the code. \nHere at https://searchfox.org/mozilla-central/source/browser/components/enterprisepolicies/Policies.jsm#531,539-541\nwe can see the difference between two conditional blocks. \nIn the \"else\" block, prefvalue is being prefixed with \"data:text/plain,browser.startup.homepage=\". On removing this extra string, the homepage is set as expected. \nI couldn't figure out what this string value is changing in the else block and breaking the code as well. \nFelipe, any inputs?", "author": "kanika16047@iiitd.ac.in", "bug_id": 1479769, "tags": []}, {"text": "Ok, so I did some code history investigation here.\n\nWhen the Homepage policy was written, setting the default homepage required setting a \"complex\" pref value. This wasn't initially noticed, but was fixed in bug 1448085.\n\nI just did some tests with these complex pref values and it turns out it has some encoding problems and does not support the # character.  (at least not easily, there's probably a way to fix it but it won't be necessary)\n\n\nTurns out that, luckily, very recently the Firefox code that handles the homepage was refactored and it now supports having it as a normal string pref (bug 721211).\n\n\nSo all that we need to do to fix this is to revert the code change done in bug 1448085, and go back to using setDefaultPref which will just call setStringPref. (no need to revert the test changes)\n\n\nAnd we should add a new testcase in the test browser_policy_set_homepage.js to make sure this is covered.", "author": "felipc@gmail.com", "bug_id": 1479769, "tags": [], "is_private": false, "creator": "felipc@gmail.com", "attachment_id": null, "raw_text": "Ok, so I did some code history investigation here.\n\nWhen the Homepage policy was written, setting the default homepage required setting a \"complex\" pref value. This wasn't initially noticed, but was fixed in bug 1448085.\n\nI just did some tests with these complex pref values and it turns out it has some encoding problems and does not support the # character.  (at least not easily, there's probably a way to fix it but it won't be necessary)\n\n\nTurns out that, luckily, very recently the Firefox code that handles the homepage was refactored and it now supports having it as a normal string pref (bug 721211).\n\n\nSo all that we need to do to fix this is to revert the code change done in bug 1448085, and go back to using setDefaultPref which will just call setStringPref. (no need to revert the test changes)\n\n\nAnd we should add a new testcase in the test browser_policy_set_homepage.js to make sure this is covered.", "creation_time": "2018-08-06T21:06:20Z", "id": 13525808, "time": "2018-08-06T21:06:20Z", "count": 5}, {"time": "2018-08-10T10:29:25Z", "creation_time": "2018-08-10T10:29:25Z", "id": 13535004, "count": 6, "attachment_id": 8999150, "creator": "kanika16047@iiitd.ac.in", "raw_text": "", "bug_id": 1479769, "tags": [], "is_private": false, "text": "Created attachment 8999150\nBug 1479769 - Policy: Homepage now correctly sets homepage URLs with anchors", "author": "kanika16047@iiitd.ac.in"}, {"is_private": false, "creation_time": "2018-08-10T16:41:12Z", "time": "2018-08-10T16:41:12Z", "creator": "mozilla@kaply.com", "attachment_id": null, "raw_text": "[Tracking Requested - why for this release]: This might be another nice to have if we get it done in time. Just a bug fix.", "bug_id": 1479769, "tags": [], "text": "[Tracking Requested - why for this release]: This might be another nice to have if we get it done in time. Just a bug fix.", "author": "mozilla@kaply.com", "id": 13535841, "count": 7}, {"author": "felipc@gmail.com", "text": "Comment on attachment 8999150\nBug 1479769 - Policy: Homepage now correctly sets homepage URLs with anchors\n\n:Felipe Gomes (needinfo me!) has approved the revision.", "is_private": false, "tags": [], "bug_id": 1479769, "raw_text": ":Felipe Gomes (needinfo me!) has approved the revision.", "creator": "felipc@gmail.com", "attachment_id": 8999150, "count": 8, "creation_time": "2018-08-10T17:50:10Z", "id": 13536006, "time": "2018-08-10T17:50:10Z"}, {"bug_id": 1479769, "tags": [], "text": "Pushed by felipc@gmail.com:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/44e8eb2860b6\nHomepage Policy no longer needs to use complex prefs. r=felipe", "author": "pulsebot@bots.tld", "id": 13536030, "count": 9, "is_private": false, "creation_time": "2018-08-10T18:04:34Z", "time": "2018-08-10T18:04:34Z", "creator": "pulsebot@bots.tld", "attachment_id": null, "raw_text": "Pushed by felipc@gmail.com:\nhttps://hg.mozilla.org/integration/mozilla-inbound/rev/44e8eb2860b6\nHomepage Policy no longer needs to use complex prefs. r=felipe"}, {"count": 10, "id": 13537155, "tags": ["bugherder"], "bug_id": 1479769, "author": "apavel@mozilla.com", "text": "https://hg.mozilla.org/mozilla-central/rev/44e8eb2860b6", "creation_time": "2018-08-11T13:18:53Z", "time": "2018-08-11T13:18:53Z", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/44e8eb2860b6", "creator": "apavel@mozilla.com", "attachment_id": null, "is_private": false}, {"author": "ryanvm@gmail.com", "text": "Please nominate this for Beta/ESR60 approval if you feel it appropriate to do so.", "tags": [], "bug_id": 1479769, "count": 11, "id": 13539745, "is_private": false, "raw_text": "Please nominate this for Beta/ESR60 approval if you feel it appropriate to do so.", "attachment_id": null, "creator": "ryanvm@gmail.com", "time": "2018-08-13T15:18:02Z", "creation_time": "2018-08-13T15:18:02Z"}, {"bug_id": 1479769, "tags": [], "text": "Thanks for the reminder. It'd be nice if this was fixed on ESR but unfortunately it relies on bug 721211 and I don't think we should try to uplift that.", "author": "felipc@gmail.com", "id": 13539871, "count": 12, "is_private": false, "creation_time": "2018-08-13T16:04:56Z", "time": "2018-08-13T16:04:56Z", "creator": "felipc@gmail.com", "attachment_id": null, "raw_text": "Thanks for the reminder. It'd be nice if this was fixed on ESR but unfortunately it relies on bug 721211 and I don't think we should try to uplift that."}]}}, "comments": {}}