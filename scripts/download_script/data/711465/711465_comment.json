{"comments": {}, "bugs": {"711465": {"comments": [{"author": "rjesup@jesup.org", "creator": "rjesup@jesup.org", "raw_text": "DOM Session storage is retained across crashes, which is specifically allowed by the spec.  We also appear to restore session storage data across a quit and restore-last-session, which is mildly contrary to the intent of the spec, though not disallowed that I know of.\n\nIE8 doesn't restore the data across crashes, and I assume it doesn't restore it across a quit-and-restart.  I assume IE9 does save it across crashes, but that's a shaky assumption.  Chrome apparently doesn't restore it under any circumstance.\n\nI don't know if session storage data is cleared on a history clear (it probably should be).\n\nVarious patches are under consideration that may affect these behaviors, such as in bug 669603 (to store the data in the cache, which would cause it to be lost on a crash).\n\nOur options are:\na) Current behavior - restore session storage data on restore-last-session after a quit or a crash\nb) Restore session storage data on restore-last-session after a crash only (more in keeping with the spec)\nc) Never restore session storage data (like Chrome and maybe IE8)\nd) Restore session storage data on restore-last-session after a quit, but NOT after a crash (current patch in bug 669603).\n\nNote: in crash cases, there's always a chance the data won't be recoverable.\n\nExplicitly choosing a behavior will set what our options for improving the performance are.", "creation_time": "2011-12-16T15:39:42Z", "attachment_id": null, "time": "2011-12-16T15:39:42Z", "text": "DOM Session storage is retained across crashes, which is specifically allowed by the spec.  We also appear to restore session storage data across a quit and restore-last-session, which is mildly contrary to the intent of the spec, though not disallowed that I know of.\n\nIE8 doesn't restore the data across crashes, and I assume it doesn't restore it across a quit-and-restart.  I assume IE9 does save it across crashes, but that's a shaky assumption.  Chrome apparently doesn't restore it under any circumstance.\n\nI don't know if session storage data is cleared on a history clear (it probably should be).\n\nVarious patches are under consideration that may affect these behaviors, such as in bug 669603 (to store the data in the cache, which would cause it to be lost on a crash).\n\nOur options are:\na) Current behavior - restore session storage data on restore-last-session after a quit or a crash\nb) Restore session storage data on restore-last-session after a crash only (more in keeping with the spec)\nc) Never restore session storage data (like Chrome and maybe IE8)\nd) Restore session storage data on restore-last-session after a quit, but NOT after a crash (current patch in bug 669603).\n\nNote: in crash cases, there's always a chance the data won't be recoverable.\n\nExplicitly choosing a behavior will set what our options for improving the performance are.", "id": 5921957, "is_private": false, "count": 0, "tags": [], "bug_id": 711465}, {"creator": "paul@oshannessy.com", "author": "paul@oshannessy.com", "count": 1, "is_private": false, "tags": [], "id": 5923171, "bug_id": 711465, "raw_text": "For session restore we've always pushed the boundaries of \"session\" specs. Some people don't like that we restore session cookies (see bug 443354, bug 530594), but the definition of \"session\" isn't strictly defined.\n\n> mildly contrary to the intent of the spec, though not disallowed that I know of.\ndescribes it pretty well.\n\nPersonally, I really like that behavior and it's something that (I think) has become expected of Firefox's session restore (even if we can't always get along).\n\nSo my 2 cents is that we should keep current behavior as best as possible.", "creation_time": "2011-12-16T21:53:13Z", "text": "For session restore we've always pushed the boundaries of \"session\" specs. Some people don't like that we restore session cookies (see bug 443354, bug 530594), but the definition of \"session\" isn't strictly defined.\n\n> mildly contrary to the intent of the spec, though not disallowed that I know of.\ndescribes it pretty well.\n\nPersonally, I really like that behavior and it's something that (I think) has become expected of Firefox's session restore (even if we can't always get along).\n\nSo my 2 cents is that we should keep current behavior as best as possible.", "attachment_id": null, "time": "2011-12-16T21:53:13Z"}, {"creator": "taras.mozilla@glek.net", "author": "taras.mozilla@glek.net", "bug_id": 711465, "count": 2, "is_private": false, "tags": [], "id": 5923192, "text": "I think Randell's motivation here is pauses during session-store saving caused by this. Do we know how much this feature is costing us?", "attachment_id": null, "time": "2011-12-16T21:59:44Z", "creation_time": "2011-12-16T21:59:44Z", "raw_text": "I think Randell's motivation here is pauses during session-store saving caused by this. Do we know how much this feature is costing us?"}, {"author": "rjesup@jesup.org", "creator": "rjesup@jesup.org", "raw_text": "Correct (bug 669034, etc). The proposal/patch in bug 669603 helps solve the pauses (I believe), but would cause a significant regression in user-visible-behavior (loss of data on a crash).\n\nThere are other ways to deal with this, some of which were (unfortunately) discussed in m.d.performance (which due to the decision to delete it, the archives of which have disappeared, though I understand they're not lost).  The group is probably still archived elsewhere on the web (google groups perhaps).\n\nLevelDB, flat files (a fair bit of work), storing the session history as some form of journal effectively to avoid full re-writes (combined with dirty bits), etc, etc.", "creation_time": "2011-12-16T22:19:18Z", "time": "2011-12-16T22:19:18Z", "attachment_id": null, "text": "Correct (bug 669034, etc). The proposal/patch in bug 669603 helps solve the pauses (I believe), but would cause a significant regression in user-visible-behavior (loss of data on a crash).\n\nThere are other ways to deal with this, some of which were (unfortunately) discussed in m.d.performance (which due to the decision to delete it, the archives of which have disappeared, though I understand they're not lost).  The group is probably still archived elsewhere on the web (google groups perhaps).\n\nLevelDB, flat files (a fair bit of work), storing the session history as some form of journal effectively to avoid full re-writes (combined with dirty bits), etc, etc.", "id": 5923245, "tags": [], "count": 3, "is_private": false, "bug_id": 711465}, {"id": 5973712, "tags": [], "count": 4, "is_private": false, "bug_id": 711465, "raw_text": "See http://old.nabble.com/SessionStore-size---Bloat-in-sessionstore.js-from-Google-and-others-causing-major-UI-freezes-tt32091916.html#a32091916 for the original discussion from mozilla.dev.performance", "creation_time": "2012-01-11T22:53:23Z", "author": "rjesup@jesup.org", "attachment_id": null, "time": "2012-01-11T22:53:23Z", "text": "See http://old.nabble.com/SessionStore-size---Bloat-in-sessionstore.js-from-Google-and-others-causing-major-UI-freezes-tt32091916.html#a32091916 for the original discussion from mozilla.dev.performance", "creator": "rjesup@jesup.org"}, {"raw_text": "What is the actual cost to us on shut down and start up? Is this only problematic with large uses? What sites use this for what purposes?", "creation_time": "2012-01-31T16:02:43Z", "text": "What is the actual cost to us on shut down and start up? Is this only problematic with large uses? What sites use this for what purposes?", "attachment_id": null, "time": "2012-01-31T16:02:43Z", "tags": [], "is_private": false, "count": 5, "id": 6022715, "bug_id": 711465, "creator": "asa@mozilla.com", "author": "asa@mozilla.com"}, {"bug_id": 711465, "id": 6062169, "count": 6, "is_private": false, "tags": [], "time": "2012-02-15T01:02:51Z", "attachment_id": null, "text": "We should revisit this once Dietrich & Co are done with bug 669034", "raw_text": "We should revisit this once Dietrich & Co are done with bug 669034", "creation_time": "2012-02-15T01:02:51Z", "author": "taras.mozilla@glek.net", "creator": "taras.mozilla@glek.net"}, {"author": "denoyse@mail.com", "creator": "denoyse@mail.com", "id": 7253280, "tags": [], "count": 7, "is_private": false, "bug_id": 711465, "creation_time": "2013-03-28T09:57:28Z", "raw_text": "What is the default lifetime for a cookie based browser session? Shouldn't session storage be deleted after a certain timeout?\n\nAlso: Why is session storage not deleted through if active logins are deleted? This way, session storage survives a firefox restart deleting all private data, while local storage doesn't...\n\nAnd as cookie sessions seem to be restored on a firefox crash, session storage should survive a crash too.", "time": "2013-03-28T09:57:28Z", "attachment_id": null, "text": "What is the default lifetime for a cookie based browser session? Shouldn't session storage be deleted after a certain timeout?\n\nAlso: Why is session storage not deleted through if active logins are deleted? This way, session storage survives a firefox restart deleting all private data, while local storage doesn't...\n\nAnd as cookie sessions seem to be restored on a firefox crash, session storage should survive a crash too."}, {"attachment_id": null, "time": "2013-11-22T12:19:25Z", "author": "Tobias.Besemer@Googlemail.com", "creator": "Tobias.Besemer@Googlemail.com", "text": "e) Restore session storage data on restore-last-session after a quit, but NOT closed tabs & windows. ;-)", "creation_time": "2013-11-22T12:19:25Z", "raw_text": "e) Restore session storage data on restore-last-session after a quit, but NOT closed tabs & windows. ;-)", "bug_id": 711465, "id": 8112816, "count": 8, "is_private": false, "tags": []}, {"raw_text": "Screenshot of the output of this extension:\nhttps://addons.mozilla.org/en-US/firefox/addon/about-sessionstore/", "creation_time": "2013-11-22T12:23:07Z", "time": "2013-11-22T12:23:07Z", "attachment_id": 8336732, "text": "Created attachment 8336732\nWaste of sessionstore through keep data from closed tabs & windows\n\nScreenshot of the output of this extension:\nhttps://addons.mozilla.org/en-US/firefox/addon/about-sessionstore/", "id": 8112822, "count": 9, "is_private": false, "tags": [], "bug_id": 711465, "author": "Tobias.Besemer@Googlemail.com", "creator": "Tobias.Besemer@Googlemail.com"}, {"author": "rjesup@jesup.org", "creator": "rjesup@jesup.org", "id": 8113411, "is_private": false, "count": 10, "tags": [], "bug_id": 711465, "raw_text": "Tagging with memshrink because of the issues referred to, especially in comment 8 and comment 9.", "creation_time": "2013-11-22T15:18:22Z", "time": "2013-11-22T15:18:22Z", "attachment_id": null, "text": "Tagging with memshrink because of the issues referred to, especially in comment 8 and comment 9."}, {"creation_time": "2013-11-26T22:09:52Z", "raw_text": "What exactly are the issues?  Do we have any measurements indicating the memory consumption is excessive?", "author": "n.nethercote@gmail.com", "time": "2013-11-26T22:09:52Z", "attachment_id": null, "creator": "n.nethercote@gmail.com", "text": "What exactly are the issues?  Do we have any measurements indicating the memory consumption is excessive?", "id": 8127950, "tags": [], "is_private": false, "count": 11, "bug_id": 711465}, {"author": "emanuel.hoogeveen@protonmail.com", "creator": "emanuel.hoogeveen@protonmail.com", "id": 8127974, "tags": [], "is_private": false, "count": 12, "bug_id": 711465, "raw_text": "In bug 942601 I saw bursts of 400-500 MiB RAM usage in Windows' task manager each time the sessionstore file was updated, and saw stable memory usage decrease by ~100 MiB after opening the pages in new tabs and clearing the old entries. Note that bug 943339 should mitigate my issue a lot, though there may be other situations that need a bigger hammer (or a subtler one).", "creation_time": "2013-11-26T22:16:36Z", "attachment_id": null, "time": "2013-11-26T22:16:36Z", "text": "In bug 942601 I saw bursts of 400-500 MiB RAM usage in Windows' task manager each time the sessionstore file was updated, and saw stable memory usage decrease by ~100 MiB after opening the pages in new tabs and clearing the old entries. Note that bug 943339 should mitigate my issue a lot, though there may be other situations that need a bigger hammer (or a subtler one)."}, {"creator": "rjesup@jesup.org", "author": "rjesup@jesup.org", "tags": [], "is_private": false, "count": 13, "id": 8128166, "bug_id": 711465, "raw_text": "400MB for a 26MB file is a regression from when I filed the initial sessionstore bugs (669603, etc)  Back then, I'd see a spike of circa 4-5x the sessionstore.js size.  Some large expansion was (is?) unavoidable due to having to convert it entirely to a JSON object and then write it; several proposals were on the table about how to alleviate the problem and do incremental writes.", "creation_time": "2013-11-26T22:50:56Z", "text": "400MB for a 26MB file is a regression from when I filed the initial sessionstore bugs (669603, etc)  Back then, I'd see a spike of circa 4-5x the sessionstore.js size.  Some large expansion was (is?) unavoidable due to having to convert it entirely to a JSON object and then write it; several proposals were on the table about how to alleviate the problem and do incremental writes.", "time": "2013-11-26T22:50:56Z", "attachment_id": null}, {"creator": "emanuel.hoogeveen@protonmail.com", "author": "emanuel.hoogeveen@protonmail.com", "text": "Note I haven't had a chance to test this in a fresh profile yet, so if addons can make this worse, they probably are. In addition I need to test and see if bug 930967 made a difference.", "time": "2013-11-27T00:13:55Z", "attachment_id": null, "raw_text": "Note I haven't had a chance to test this in a fresh profile yet, so if addons can make this worse, they probably are. In addition I need to test and see if bug 930967 made a difference.", "creation_time": "2013-11-27T00:13:55Z", "bug_id": 711465, "tags": [], "is_private": false, "count": 14, "id": 8128488}, {"text": "Bug 952998 changed sessionstore to only collect DOMSessionStorage data for the currently shown history entry. Data for other shistory entries is not collected. This should reduce data collection time and also sessionstore.js file size.", "time": "2014-01-27T21:21:40Z", "attachment_id": null, "creation_time": "2014-01-27T21:21:40Z", "raw_text": "Bug 952998 changed sessionstore to only collect DOMSessionStorage data for the currently shown history entry. Data for other shistory entries is not collected. This should reduce data collection time and also sessionstore.js file size.", "bug_id": 711465, "count": 15, "is_private": false, "tags": [], "id": 8338824, "creator": "ttaubert@mozilla.com", "author": "ttaubert@mozilla.com"}, {"author": "rjesup@jesup.org", "creator": "rjesup@jesup.org", "bug_id": 711465, "id": 15701216, "count": 16, "is_private": false, "tags": [], "attachment_id": null, "time": "2021-12-17T03:17:29Z", "text": "Ping as IIRC you've been looking at sessionstore stuff lately.   While most details here are now irrelevant, we still have the original behavior.  Also I wonder how much we spike memory use during a save of session data.", "creation_time": "2021-12-17T03:17:29Z", "raw_text": "Ping as IIRC you've been looking at sessionstore stuff lately.   While most details here are now irrelevant, we still have the original behavior.  Also I wonder how much we spike memory use during a save of session data."}]}}}