{"bugs": {"670871": {"comments": [{"bug_id": 670871, "count": 0, "id": 5586187, "raw_text": "User Agent: Mozilla/5.0 (Windows NT 5.1; rv:6.0) Gecko/20100101 Firefox/6.0\nBuild ID: 20110705195857\n\nSteps to reproduce:\n\nI set my IMAP mail account to synchronize all messages locally.\n\n\nActual results:\n\nI ran out of disk space and discovered that the file \"C:\\Documents and Settings\\username\\Application Data\\Thunderbird\\Profiles\\zlsnxtyp.default\\ImapMail\\imap.1and1.co.uk\\Sent-1\" was over 15GB.\n\nAfter discussion on the mozillazine support forum (http://forums.mozillazine.org/viewtopic.php?f=39&t=2248757&e=0) I discovered that when any folder in my IMAP mail account contains a particular message the OS file representing the local synchronization of that folder grows intermittently by the size of the message (554K), even when the folder only contains that message and when there is no user activity on the folder.\n\n\nExpected results:\n\nThe size of the file should have remained at the size of the message.", "attachment_id": 545335, "text": "Created attachment 545335\nMessage file for message causing described behaviour.\n\nUser Agent: Mozilla/5.0 (Windows NT 5.1; rv:6.0) Gecko/20100101 Firefox/6.0\nBuild ID: 20110705195857\n\nSteps to reproduce:\n\nI set my IMAP mail account to synchronize all messages locally.\n\n\nActual results:\n\nI ran out of disk space and discovered that the file \"C:\\Documents and Settings\\username\\Application Data\\Thunderbird\\Profiles\\zlsnxtyp.default\\ImapMail\\imap.1and1.co.uk\\Sent-1\" was over 15GB.\n\nAfter discussion on the mozillazine support forum (http://forums.mozillazine.org/viewtopic.php?f=39&t=2248757&e=0) I discovered that when any folder in my IMAP mail account contains a particular message the OS file representing the local synchronization of that folder grows intermittently by the size of the message (554K), even when the folder only contains that message and when there is no user activity on the folder.\n\n\nExpected results:\n\nThe size of the file should have remained at the size of the message.", "tags": [], "time": "2011-07-12T08:35:05Z", "creation_time": "2011-07-12T08:35:05Z", "author": "mail@duncanpearson.net", "is_private": false, "creator": "mail@duncanpearson.net"}, {"raw_text": "To reproduce - create a new folder in an IMAP mail account. Ensure the folder is set to synchronise locally. Drop the attached file on the folder. At apparently random intervals the OS file containing the local copy of the folder will grow in increments of 554K.", "attachment_id": null, "id": 5593451, "count": 1, "creator": "mail@duncanpearson.net", "is_private": false, "tags": [], "time": "2011-07-15T14:30:16Z", "bug_id": 670871, "text": "To reproduce - create a new folder in an IMAP mail account. Ensure the folder is set to synchronise locally. Drop the attached file on the folder. At apparently random intervals the OS file containing the local copy of the folder will grow in increments of 554K.", "author": "mail@duncanpearson.net", "creation_time": "2011-07-15T14:30:16Z"}, {"id": 5604083, "attachment_id": null, "raw_text": "Does the message actually come back with the first two lines:\n\n-090206040500040500090307--\n@duncanpearson.net>\n\n\nthat's not a valid rfc822 message, which makes us think there was an error downloading it.", "author": "mozilla@davidbienvenu.org", "creation_time": "2011-07-21T13:17:55Z", "tags": [], "bug_id": 670871, "time": "2011-07-21T13:17:55Z", "text": "Does the message actually come back with the first two lines:\n\n-090206040500040500090307--\n@duncanpearson.net>\n\n\nthat's not a valid rfc822 message, which makes us think there was an error downloading it.", "creator": "mozilla@davidbienvenu.org", "is_private": false, "count": 2}, {"attachment_id": null, "raw_text": "Those are the first two lines of the .EML file created when I saved the message.\n\nA similar message from the same source began with the line:\n\nMessage-ID: <4D7A9CF8.6090602@duncanpearson.net>\n\nThis message was in my \"Sent\" folder as a result of me auto-forwarding to someone else.", "id": 5604099, "creator": "mail@duncanpearson.net", "is_private": false, "count": 3, "author": "mail@duncanpearson.net", "creation_time": "2011-07-21T13:23:54Z", "bug_id": 670871, "tags": [], "time": "2011-07-21T13:23:54Z", "text": "Those are the first two lines of the .EML file created when I saved the message.\n\nA similar message from the same source began with the line:\n\nMessage-ID: <4D7A9CF8.6090602@duncanpearson.net>\n\nThis message was in my \"Sent\" folder as a result of me auto-forwarding to someone else."}, {"creation_time": "2011-07-21T13:50:32Z", "author": "mozilla@davidbienvenu.org", "text": "(In reply to comment #3)\n\n> \n> A similar message from the same source began with the line:\n> \n> Message-ID: <4D7A9CF8.6090602@duncanpearson.net>\n> \n> This message was in my \"Sent\" folder as a result of me auto-forwarding to\n> someone else.\n\nThat's actually OK - it begins with an RFC822 header, so it's a valid message.", "bug_id": 670871, "time": "2011-07-21T13:50:32Z", "tags": [], "is_private": false, "creator": "mozilla@davidbienvenu.org", "count": 4, "id": 5604146, "attachment_id": null, "raw_text": "(In reply to comment #3)\n\n> \n> A similar message from the same source began with the line:\n> \n> Message-ID: <4D7A9CF8.6090602@duncanpearson.net>\n> \n> This message was in my \"Sent\" folder as a result of me auto-forwarding to\n> someone else.\n\nThat's actually OK - it begins with an RFC822 header, so it's a valid message."}, {"id": 5604162, "raw_text": "What I meant was that the corrupt message had been forwarded by me and was in my \"Sent\" folder as a result. Sorry for the misunderstanding.", "attachment_id": null, "text": "What I meant was that the corrupt message had been forwarded by me and was in my \"Sent\" folder as a result. Sorry for the misunderstanding.", "tags": [], "time": "2011-07-21T14:02:11Z", "bug_id": 670871, "creation_time": "2011-07-21T14:02:11Z", "author": "mail@duncanpearson.net", "count": 5, "is_private": false, "creator": "mail@duncanpearson.net"}, {"id": 5604166, "raw_text": "Oh, so the copy in your sent folder is correct, but corrupt in the IMAP inbox. Is it possible to rebuild the IMAP Inbox on the server?\n\nTB should handle this better, obviously, but we were trying to detect corruption in our local cache by making sure the message is a valid rfc822 message from the server. I guess we need to somehow remember when the server sends us an invalid message at the protocol parsing level.", "attachment_id": null, "time": "2011-07-21T14:05:09Z", "bug_id": 670871, "tags": [], "text": "Oh, so the copy in your sent folder is correct, but corrupt in the IMAP inbox. Is it possible to rebuild the IMAP Inbox on the server?\n\nTB should handle this better, obviously, but we were trying to detect corruption in our local cache by making sure the message is a valid rfc822 message from the server. I guess we need to somehow remember when the server sends us an invalid message at the protocol parsing level.", "author": "mozilla@davidbienvenu.org", "creation_time": "2011-07-21T14:05:09Z", "count": 6, "creator": "mozilla@davidbienvenu.org", "is_private": false}, {"count": 7, "creator": "mail@duncanpearson.net", "is_private": false, "bug_id": 670871, "time": "2011-07-21T14:18:57Z", "tags": [], "text": "So is what you are saying that as it's corrupt TB is periodically re-fetching it and that when it is re-saved locally TB always allocates more space rather than reusing existing space?", "author": "mail@duncanpearson.net", "creation_time": "2011-07-21T14:18:57Z", "raw_text": "So is what you are saying that as it's corrupt TB is periodically re-fetching it and that when it is re-saved locally TB always allocates more space rather than reusing existing space?", "attachment_id": null, "id": 5604196}, {"raw_text": "(In reply to comment #7)\n> So is what you are saying that as it's corrupt TB is periodically\n> re-fetching it and that when it is re-saved locally TB always allocates more\n> space rather than reusing existing space?\n\nyes, though you can do a file | compact folders to reclaim the space.", "attachment_id": null, "id": 5604243, "count": 8, "creator": "mozilla@davidbienvenu.org", "is_private": false, "tags": [], "time": "2011-07-21T14:29:18Z", "bug_id": 670871, "text": "(In reply to comment #7)\n> So is what you are saying that as it's corrupt TB is periodically\n> re-fetching it and that when it is re-saved locally TB always allocates more\n> space rather than reusing existing space?\n\nyes, though you can do a file | compact folders to reclaim the space.", "author": "mozilla@davidbienvenu.org", "creation_time": "2011-07-21T14:29:18Z"}, {"tags": [], "bug_id": 670871, "time": "2014-08-24T14:15:34Z", "text": "Irving, do you recall if we've fixed such a beast in recent years?\n\nbugs related to message size dominate list of fixes in past three years https://bugzilla.mozilla.org/buglist.cgi?f1=short_desc&list_id=11048606&o1=nowordssubstr&resolution=FIXED&classification=Client%20Software&classification=Components&chfieldto=2014-08-24&chfield=resolution&query_format=advanced&chfieldfrom=2011-07-21&f2=OP&chfieldvalue=fixed&longdesc=rfc822%20invalid%20corrupt%20malformed&component=Networking%3A%20IMAP&longdesc_type=anywordssubstr&product=MailNews%20Core&product=Thunderbird", "author": "vseerror@lehigh.edu", "creation_time": "2014-08-24T14:15:34Z", "count": 9, "creator": "vseerror@lehigh.edu", "is_private": false, "id": 9222337, "raw_text": "Irving, do you recall if we've fixed such a beast in recent years?\n\nbugs related to message size dominate list of fixes in past three years https://bugzilla.mozilla.org/buglist.cgi?f1=short_desc&list_id=11048606&o1=nowordssubstr&resolution=FIXED&classification=Client%20Software&classification=Components&chfieldto=2014-08-24&chfield=resolution&query_format=advanced&chfieldfrom=2011-07-21&f2=OP&chfieldvalue=fixed&longdesc=rfc822%20invalid%20corrupt%20malformed&component=Networking%3A%20IMAP&longdesc_type=anywordssubstr&product=MailNews%20Core&product=Thunderbird", "attachment_id": null}, {"raw_text": "If anything I fixed affected this behaviour, it was by accident; I haven't intentionally changed the way we handle messages received from the server that fail message format checks.\n\nIt would be relatively easy to write an IMAP and/or POP fakeserver test for this.", "attachment_id": null, "id": 9241905, "count": 10, "is_private": false, "creator": "irving@cfrq.net", "text": "If anything I fixed affected this behaviour, it was by accident; I haven't intentionally changed the way we handle messages received from the server that fail message format checks.\n\nIt would be relatively easy to write an IMAP and/or POP fakeserver test for this.", "tags": [], "time": "2014-08-28T13:56:52Z", "bug_id": 670871, "creation_time": "2014-08-28T13:56:52Z", "author": "irving@cfrq.net"}, {"count": 11, "creator": "ludovic@hirlimann.net", "is_private": false, "bug_id": 670871, "tags": [], "time": "2015-09-25T12:48:59Z", "text": "Removing myslef on all the bugs I'm cced on. Please NI me if you need something on MailNews Core bugs from me.", "author": "ludovic@hirlimann.net", "creation_time": "2015-09-25T12:48:59Z", "raw_text": "Removing myslef on all the bugs I'm cced on. Please NI me if you need something on MailNews Core bugs from me.", "attachment_id": null, "id": 10776304}, {"id": 15625811, "raw_text": "Has testcase.\nDo we have the test suggested in comment 10?", "attachment_id": null, "text": "Has testcase.\nDo we have the test suggested in comment 10?", "time": "2021-10-23T13:46:32Z", "tags": [], "bug_id": 670871, "creation_time": "2021-10-23T13:46:32Z", "author": "vseerror@lehigh.edu", "count": 12, "is_private": false, "creator": "vseerror@lehigh.edu"}, {"attachment_id": null, "raw_text": "We fixed a bug recently where bad header delimiters causes the file to grow and even compacting didn't help. But didn't add any test to verify the fix.\n\nFrom comment 10:\n>It would be relatively easy to write an IMAP and/or POP fakeserver test for this.\n\nAt this point, not so easy. I have zero experience dealing with \"fakeserver\".", "id": 15661136, "creator": "gds@chartertn.net", "is_private": false, "count": 13, "author": "gds@chartertn.net", "creation_time": "2021-11-17T18:20:23Z", "tags": [], "time": "2021-11-17T18:20:23Z", "bug_id": 670871, "text": "We fixed a bug recently where bad header delimiters causes the file to grow and even compacting didn't help. But didn't add any test to verify the fix.\n\nFrom comment 10:\n>It would be relatively easy to write an IMAP and/or POP fakeserver test for this.\n\nAt this point, not so easy. I have zero experience dealing with \"fakeserver\"."}]}}, "comments": {}}