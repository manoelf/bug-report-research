{"comments": {}, "bugs": {"366075": {"comments": [{"tags": [], "time": "2007-01-05T21:14:15Z", "text": "[places] on shutdown, expire history entries based on the browser.history_expire_days\n\nfrom ria:\n\nSetting browser.history_expire_days to 0 has no effect since Bug 355738 landed,\nit does not delete the history entries from the sqlite file; history is still\npresent in the sidebar. Although it stops gathering new history.\nThe sanitize function (Tools > Clear Private Data) works however.\nCould be that this is an independent bug, for I see it also without imported\nhistory.\n\nSo the steps are:\n- Start Firefox in a new profile\n- Visit www.cnn.com\n- Set Tools > Options > Privacy > History > Remember visited pages to 0 days\n- Close the browser\nWhen you start the browser you'll see that www.cnn.com is still present; should\nbe empty. \n\nFirefox 2.0 appears to do this work in nsGlobalHistory::CloseDB(), see\nhttp://lxr.mozilla.org/seamonkey/source/toolkit/components/history/src/nsGlobalHistory.cpp#3136\n\nminefield doesn't seem to be doing this.  \n\nalso, I wonder if we should expire history entries when we observe the pref changes, and not on shutdown.", "attachment_id": null, "author": "moco@sspitzer.org", "is_private": false, "creation_time": "2007-01-05T21:14:15Z", "id": 3076571, "count": 0, "creator": "moco@sspitzer.org", "raw_text": "[places] on shutdown, expire history entries based on the browser.history_expire_days\n\nfrom ria:\n\nSetting browser.history_expire_days to 0 has no effect since Bug 355738 landed,\nit does not delete the history entries from the sqlite file; history is still\npresent in the sidebar. Although it stops gathering new history.\nThe sanitize function (Tools > Clear Private Data) works however.\nCould be that this is an independent bug, for I see it also without imported\nhistory.\n\nSo the steps are:\n- Start Firefox in a new profile\n- Visit www.cnn.com\n- Set Tools > Options > Privacy > History > Remember visited pages to 0 days\n- Close the browser\nWhen you start the browser you'll see that www.cnn.com is still present; should\nbe empty. \n\nFirefox 2.0 appears to do this work in nsGlobalHistory::CloseDB(), see\nhttp://lxr.mozilla.org/seamonkey/source/toolkit/components/history/src/nsGlobalHistory.cpp#3136\n\nminefield doesn't seem to be doing this.  \n\nalso, I wonder if we should expire history entries when we observe the pref changes, and not on shutdown.", "bug_id": 366075}, {"text": "See bug 328598 - you don't want to expire on shutdown.", "creation_time": "2007-01-05T22:28:31Z", "tags": [], "time": "2007-01-05T22:28:31Z", "is_private": false, "bug_id": 366075, "author": "philringnalda@gmail.com", "creator": "philringnalda@gmail.com", "raw_text": "See bug 328598 - you don't want to expire on shutdown.", "attachment_id": null, "id": 3076659, "count": 1}, {"text": "thanks for the pointer, phil.\n\nso, what about the idea of doing the expiration in the pref observer (in nsNavHistory.cpp) when the user changes the pref (but only if the \"new\" expire days is less than the \"old\" expire days.)\n\nwe'll still be paying a price for doing the expiration, but at least it will be associated with the action taken, and not on shutdown.\n\nnote, firefox 2.0 does not behave this way, but I think this would be more correct, as disabling the \"Remember pages visited\" pref would immediately clear history.\n\ncomments?", "creation_time": "2007-01-05T22:38:05Z", "tags": [], "time": "2007-01-05T22:38:05Z", "is_private": false, "bug_id": 366075, "author": "moco@sspitzer.org", "creator": "moco@sspitzer.org", "raw_text": "thanks for the pointer, phil.\n\nso, what about the idea of doing the expiration in the pref observer (in nsNavHistory.cpp) when the user changes the pref (but only if the \"new\" expire days is less than the \"old\" expire days.)\n\nwe'll still be paying a price for doing the expiration, but at least it will be associated with the action taken, and not on shutdown.\n\nnote, firefox 2.0 does not behave this way, but I think this would be more correct, as disabling the \"Remember pages visited\" pref would immediately clear history.\n\ncomments?", "attachment_id": null, "id": 3076674, "count": 2}, {"tags": [], "time": "2007-01-06T03:54:48Z", "creation_time": "2007-01-06T03:54:48Z", "text": "To avoid delaying shutdown, places expires history as you browse. On shutdown, it does some extra work to catch some edgecases (the *Paranoid functions). This code is in toolkit/components/places/src/nsNavHistoryExpire.cpp\n\nI'm not sure if the 0 days case is handled properly. In this case, OnAddURI\nmay never get called, and this is the function that schedules incremental expiration. OnExpirationChanged should handle all non-zero cases, although the items won't immediately be deleted (I think it's 5 items deleted per page visited).\n\nFor the 0 day case, you may want to call nsNavHistoryExpire::ClearHistory in OnExpirationChanged when the days are 0.\n\nIf it's really important that when the user decreases the expiration time those items get deleted immediately (I doubt this is important), you may want to modify ExpireItems. It takes the maximum number of things to expire as a parameter. Currently, we use 0 to mean expire all history. You may want to do something like making -1 expire all history, and 0 expire as many items as possible given the current expiration time. Then call this from OnExpirationChanged.", "attachment_id": null, "id": 3076908, "count": 3, "creator": "brettw@gmail.com", "author": "brettw@gmail.com", "raw_text": "To avoid delaying shutdown, places expires history as you browse. On shutdown, it does some extra work to catch some edgecases (the *Paranoid functions). This code is in toolkit/components/places/src/nsNavHistoryExpire.cpp\n\nI'm not sure if the 0 days case is handled properly. In this case, OnAddURI\nmay never get called, and this is the function that schedules incremental expiration. OnExpirationChanged should handle all non-zero cases, although the items won't immediately be deleted (I think it's 5 items deleted per page visited).\n\nFor the 0 day case, you may want to call nsNavHistoryExpire::ClearHistory in OnExpirationChanged when the days are 0.\n\nIf it's really important that when the user decreases the expiration time those items get deleted immediately (I doubt this is important), you may want to modify ExpireItems. It takes the maximum number of things to expire as a parameter. Currently, we use 0 to mean expire all history. You may want to do something like making -1 expire all history, and 0 expire as many items as possible given the current expiration time. Then call this from OnExpirationChanged.", "is_private": false, "bug_id": 366075}, {"tags": [], "time": "2007-01-26T08:02:39Z", "creation_time": "2007-01-26T08:02:39Z", "text": "Problem is (also) that none of the history is deleted when I change browser.history_expire_days from 600 days to 1 day. I changed it 24 hours ago and al my history is still there.", "attachment_id": null, "id": 3093660, "count": 4, "author": "ria.klaassen@gmail.com", "creator": "ria.klaassen@gmail.com", "raw_text": "Problem is (also) that none of the history is deleted when I change browser.history_expire_days from 600 days to 1 day. I changed it 24 hours ago and al my history is still there.", "is_private": false, "bug_id": 366075}, {"text": "Might need to relnote this for M8, moving out to M9.", "creation_time": "2007-08-12T06:40:34Z", "tags": [], "time": "2007-08-12T06:40:34Z", "is_private": false, "bug_id": 366075, "author": "mconnor@mozilla.com", "creator": "mconnor@mozilla.com", "raw_text": "Might need to relnote this for M8, moving out to M9.", "attachment_id": null, "id": 3277935, "count": 5}, {"author": "hzbz@pm.me", "is_private": false, "attachment_id": 285002, "text": "Created attachment 285002\nwip\n\nthe problem was that we currently do zero expiration at shutdown in some cases, even when there might be history to expire.\n\nwhen that was combined with our really slow incremental expiration (which also doesn't expire oldest to newest btw), it basically would never catch up.\n\nthis fix does the following:\n- always run expiration at shutdown\n- do expiration when 15 mins idle, hooking into the history vacuum timer for this (might want to alternate or something)\n\nexpiring 6mos+ of history took about 20 secs w/ a debug build. i'd prefer to err on the side of privacy here though, and fix perf in bug 395066.", "time": "2007-10-15T21:49:29Z", "tags": [], "raw_text": "the problem was that we currently do zero expiration at shutdown in some cases, even when there might be history to expire.\n\nwhen that was combined with our really slow incremental expiration (which also doesn't expire oldest to newest btw), it basically would never catch up.\n\nthis fix does the following:\n- always run expiration at shutdown\n- do expiration when 15 mins idle, hooking into the history vacuum timer for this (might want to alternate or something)\n\nexpiring 6mos+ of history took about 20 secs w/ a debug build. i'd prefer to err on the side of privacy here though, and fix perf in bug 395066.", "creator": "hzbz@pm.me", "bug_id": 366075, "count": 6, "id": 3342203, "creation_time": "2007-10-15T21:49:29Z"}, {"creator": "hzbz@pm.me", "author": "hzbz@pm.me", "raw_text": "", "is_private": false, "bug_id": 366075, "id": 3342637, "attachment_id": 285053, "count": 7, "creation_time": "2007-10-16T07:58:42Z", "text": "Created attachment 285053\nmore", "tags": [], "time": "2007-10-16T07:58:42Z"}, {"id": 3532529, "count": 8, "bug_id": 366075, "creator": "mconnor@mozilla.com", "raw_text": "Not blocking on this bug for final ship. Would take a safe enough patch if one comes through.", "creation_time": "2008-03-17T18:52:09Z", "attachment_id": null, "is_private": false, "author": "mconnor@mozilla.com", "tags": [], "time": "2008-03-17T18:52:09Z", "text": "Not blocking on this bug for final ship. Would take a safe enough patch if one comes through."}, {"creation_time": "2008-04-19T10:20:48Z", "text": "(In reply to comment #6)\n> the problem was that we currently do zero expiration at shutdown in some cases, even when there might be history to expire.\n\ni'm not sure this is still true\n\n> (which also doesn't expire oldest to newest btw)\n\nthis is no more true after latest changes\n", "tags": [], "time": "2008-04-19T10:20:48Z", "author": "mak@mozilla.com", "creator": "mak@mozilla.com", "raw_text": "(In reply to comment #6)\n> the problem was that we currently do zero expiration at shutdown in some cases, even when there might be history to expire.\n\ni'm not sure this is still true\n\n> (which also doesn't expire oldest to newest btw)\n\nthis is no more true after latest changes\n", "is_private": false, "bug_id": 366075, "attachment_id": null, "id": 3587143, "count": 9}, {"bug_id": 366075, "creator": "hzbz@pm.me", "raw_text": "(In reply to comment #4)\n> Problem is (also) that none of the history is deleted when I change\n> browser.history_expire_days from 600 days to 1 day. I changed it 24 hours ago\n> and al my history is still there.\n> \n\nfiled bug 433893 for this", "id": 3623533, "count": 10, "creation_time": "2008-05-15T15:56:09Z", "is_private": false, "author": "hzbz@pm.me", "attachment_id": null, "text": "(In reply to comment #4)\n> Problem is (also) that none of the history is deleted when I change\n> browser.history_expire_days from 600 days to 1 day. I changed it 24 hours ago\n> and al my history is still there.\n> \n\nfiled bug 433893 for this", "tags": [], "time": "2008-05-15T15:56:09Z"}, {"creation_time": "2008-05-15T16:01:03Z", "creator": "hzbz@pm.me", "raw_text": "Fixing this bug requires a full and complete truncation of history to match the prefs at shutdown, overriding the partial expiration mechanisms we have in place now.", "bug_id": 366075, "id": 3623543, "count": 11, "text": "Fixing this bug requires a full and complete truncation of history to match the prefs at shutdown, overriding the partial expiration mechanisms we have in place now.", "tags": [], "time": "2008-05-15T16:01:03Z", "author": "hzbz@pm.me", "is_private": false, "attachment_id": null}, {"creation_time": "2008-08-30T01:06:21Z", "text": "Since we're printing this as a known issue for Firefox 3, we should look at fixing for 3.1.", "time": "2008-08-30T01:06:21Z", "tags": [], "raw_text": "Since we're printing this as a known issue for Firefox 3, we should look at fixing for 3.1.", "author": "samuel.sidler+old@gmail.com", "creator": "samuel.sidler+old@gmail.com", "bug_id": 366075, "is_private": false, "count": 12, "id": 3760315, "attachment_id": null}, {"author": "hzbz@pm.me", "is_private": false, "attachment_id": null, "text": "Approving blocking request, this should be fixed. as well as at shutdown, the user expects history to be pruned after changing the setting.\n\nWe could do this w/o blocking UI by moving the expiration queries into the background.", "time": "2008-10-21T00:51:02Z", "tags": [], "raw_text": "Approving blocking request, this should be fixed. as well as at shutdown, the user expects history to be pruned after changing the setting.\n\nWe could do this w/o blocking UI by moving the expiration queries into the background.", "creator": "hzbz@pm.me", "bug_id": 366075, "count": 13, "id": 3823296, "creation_time": "2008-10-21T00:51:02Z"}, {"id": 3877597, "count": 14, "bug_id": 366075, "creator": "hzbz@pm.me", "raw_text": "Aaaannnnd removing the blocking flag: no major problems reported since the 3.0 release, so this doesn't need to block 3.1. We're making more progress on moving non-browsing-synchronous tasks to the background, so fixing this bug is becoming feasible.", "creation_time": "2008-12-02T19:12:46Z", "attachment_id": null, "is_private": false, "author": "hzbz@pm.me", "tags": [], "time": "2008-12-02T19:12:46Z", "text": "Aaaannnnd removing the blocking flag: no major problems reported since the 3.0 release, so this doesn't need to block 3.1. We're making more progress on moving non-browsing-synchronous tasks to the background, so fixing this bug is becoming feasible."}, {"text": "*** Bug 476868 has been marked as a duplicate of this bug. ***", "creation_time": "2009-02-04T22:31:41Z", "time": "2009-02-04T22:31:41Z", "tags": [], "bug_id": 366075, "is_private": false, "raw_text": "", "creator": "highmind63@gmail.com", "author": "highmind63@gmail.com", "count": 15, "id": 3960059, "attachment_id": null}, {"creation_time": "2009-11-26T15:23:23Z", "id": 4423962, "count": 16, "bug_id": 366075, "creator": "gerv@mozilla.org", "raw_text": "Bug 451915 - move Firefox/Places bugs to Firefox/Bookmarks and History. Remove all bugspam from this move by filtering for the string \"places-to-b-and-h\".\n\nIn Thunderbird 3.0b, you do that as follows:\nTools | Message Filters\nMake sure the correct account is selected. Click \"New\"\nConditions: Body   contains   places-to-b-and-h\nChange the action to \"Delete Message\".\nSelect \"Manually Run\" from the dropdown at the top.\nClick OK.\n\nSelect the filter in the list, make sure \"Inbox\" is selected at the bottom, and click \"Run Now\". This should delete all the bugspam. You can then delete the filter.\n\nGerv", "tags": [], "time": "2009-11-26T15:23:23Z", "text": "Bug 451915 - move Firefox/Places bugs to Firefox/Bookmarks and History. Remove all bugspam from this move by filtering for the string \"places-to-b-and-h\".\n\nIn Thunderbird 3.0b, you do that as follows:\nTools | Message Filters\nMake sure the correct account is selected. Click \"New\"\nConditions: Body   contains   places-to-b-and-h\nChange the action to \"Delete Message\".\nSelect \"Manually Run\" from the dropdown at the top.\nClick OK.\n\nSelect the filter in the list, make sure \"Inbox\" is selected at the bottom, and click \"Run Now\". This should delete all the bugspam. You can then delete the filter.\n\nGerv", "attachment_id": null, "is_private": false, "author": "gerv@mozilla.org"}, {"creator": "slump_ilawa@wp.pl", "author": "slump_ilawa@wp.pl", "raw_text": "Does https://bugzilla.mozilla.org/show_bug.cgi?id=520165 make this wont fix?", "is_private": false, "bug_id": 366075, "attachment_id": null, "id": 5220944, "count": 17, "creation_time": "2011-01-24T01:01:07Z", "text": "Does https://bugzilla.mozilla.org/show_bug.cgi?id=520165 make this wont fix?", "tags": [], "time": "2011-01-24T01:01:07Z"}, {"bug_id": 366075, "is_private": false, "raw_text": "(In reply to comment #17)\n> Does https://bugzilla.mozilla.org/show_bug.cgi?id=520165 make this wont fix?\n\nyes", "author": "mak@mozilla.com", "creator": "mak@mozilla.com", "count": 18, "attachment_id": null, "id": 5221612, "text": "(In reply to comment #17)\n> Does https://bugzilla.mozilla.org/show_bug.cgi?id=520165 make this wont fix?\n\nyes", "creation_time": "2011-01-24T12:52:11Z", "time": "2011-01-24T12:52:11Z", "tags": []}]}}}