{"bugs": {"1377100": {"comments": [{"count": 0, "attachment_id": null, "id": 12436620, "bug_id": 1377100, "is_private": false, "raw_text": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:54.0) Gecko/20100101 Firefox/54.0\nBuild ID: 20170608105825\n\nSteps to reproduce:\n\nUsing Sync to synchronise between a Firefox for Android device and a Firefox instance on a PC.\n\n\nActual results:\n\nSince the update to FF 54 and consequent re-authentication on the 23rd of June, 324 out of 336 saved passwords are no longer available either via the Password Manager or the Edit Passwords add-on. They are still present on the mobile device.\n\nAbout Sync shows all the 336 total passwords as server records and the 324 it needs to download under ClientMissing. However, although they are evidently fetched, they are not written to local storage.\n\nabout:sync-log shows lots of the following error, ever since the re-authentication:\n\nhttps://api.accounts.firefox.com/v1/certificate/sign failed: 2152398878 - NS_ERROR_UNKNOWN_HOST\n1498648337388\tHawk\tWARN\thawk request error: [Exception... \"NS_ERROR_UNKNOWN_HOST\"  nsresult: \"0x804b001e (NS_ERROR_UNKNOWN_HOST)\n\nThis happens irrespective of whether I am on an enterprise network, VPN'd into it, or at home - therefore the problem seems to be with this web service of yours. Requesting https://api.accounts.firefox.com/v1/certificate/sign explicitly fails with a 404 error and errorno 999 (\"Unspecified error\"), as does anything under /v1/. \nAnd yes, I've clicked on the link to confirm the sign-in (I just pulled up the e-mail and did so again, and was informed I already had done). \n\nTiming strongly suggests that either FF 54 or release v1.89.0 of fxa-auth-server is guilty.\n\n\nExpected results:\n\nMy passwords should get written to the local store.", "creator": "a.harrowell@gmail.com", "author": "a.harrowell@gmail.com", "time": "2017-06-29T13:22:33Z", "tags": [], "text": "User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:54.0) Gecko/20100101 Firefox/54.0\nBuild ID: 20170608105825\n\nSteps to reproduce:\n\nUsing Sync to synchronise between a Firefox for Android device and a Firefox instance on a PC.\n\n\nActual results:\n\nSince the update to FF 54 and consequent re-authentication on the 23rd of June, 324 out of 336 saved passwords are no longer available either via the Password Manager or the Edit Passwords add-on. They are still present on the mobile device.\n\nAbout Sync shows all the 336 total passwords as server records and the 324 it needs to download under ClientMissing. However, although they are evidently fetched, they are not written to local storage.\n\nabout:sync-log shows lots of the following error, ever since the re-authentication:\n\nhttps://api.accounts.firefox.com/v1/certificate/sign failed: 2152398878 - NS_ERROR_UNKNOWN_HOST\n1498648337388\tHawk\tWARN\thawk request error: [Exception... \"NS_ERROR_UNKNOWN_HOST\"  nsresult: \"0x804b001e (NS_ERROR_UNKNOWN_HOST)\n\nThis happens irrespective of whether I am on an enterprise network, VPN'd into it, or at home - therefore the problem seems to be with this web service of yours. Requesting https://api.accounts.firefox.com/v1/certificate/sign explicitly fails with a 404 error and errorno 999 (\"Unspecified error\"), as does anything under /v1/. \nAnd yes, I've clicked on the link to confirm the sign-in (I just pulled up the e-mail and did so again, and was informed I already had done). \n\nTiming strongly suggests that either FF 54 or release v1.89.0 of fxa-auth-server is guilty.\n\n\nExpected results:\n\nMy passwords should get written to the local store.", "creation_time": "2017-06-29T13:22:33Z"}, {"author": "a.harrowell@gmail.com", "creator": "a.harrowell@gmail.com", "raw_text": "WORKAROUND: disconnect affected device from sync, re-add it, all is love again.", "is_private": false, "bug_id": 1377100, "attachment_id": null, "id": 12437008, "count": 1, "creation_time": "2017-06-29T16:18:38Z", "text": "WORKAROUND: disconnect affected device from sync, re-add it, all is love again.", "tags": [], "time": "2017-06-29T16:18:38Z"}, {"tags": [], "time": "2017-07-03T22:16:08Z", "text": "I'm glad it seems to be working for you again, but in the interests of finding the underlying issue, could you please upload all logs from about:sync-log?", "attachment_id": null, "is_private": false, "author": "markh@mozilla.com", "creation_time": "2017-07-03T22:16:08Z", "id": 12444994, "count": 2, "bug_id": 1377100, "creator": "markh@mozilla.com", "raw_text": "I'm glad it seems to be working for you again, but in the interests of finding the underlying issue, could you please upload all logs from about:sync-log?"}, {"time": "2017-07-04T10:43:02Z", "tags": [], "creation_time": "2017-07-04T10:43:02Z", "text": "OK, here's a link: https://www.dropbox.com/sh/kf3wzl07lkz4yoy/AAC7nY-R9ppK6F6Y-F1jr1u2a?dl=1", "count": 3, "attachment_id": null, "id": 12445930, "raw_text": "OK, here's a link: https://www.dropbox.com/sh/kf3wzl07lkz4yoy/AAC7nY-R9ppK6F6Y-F1jr1u2a?dl=1", "creator": "a.harrowell@gmail.com", "author": "a.harrowell@gmail.com", "bug_id": 1377100, "is_private": false}, {"time": "2017-07-04T12:20:36Z", "tags": [], "text": "Thanks - those logs are helpful. I'll get back to this.", "attachment_id": null, "is_private": false, "author": "markh@mozilla.com", "creation_time": "2017-07-04T12:20:36Z", "count": 4, "id": 12446038, "bug_id": 1377100, "raw_text": "Thanks - those logs are helpful. I'll get back to this.", "creator": "markh@mozilla.com"}, {"author": "markh@mozilla.com", "is_private": false, "attachment_id": null, "text": "I thought we already had a bug for this, but I can't find it.\n\n(In reply to a.harrowell@gmail.com from comment #0)\n> Since the update to FF 54 and consequent re-authentication on the 23rd of\n> June,\n\nI'm not sure what happened as you updated, but whatever it was, I expect all your logins were suddenly unable to be decrypted. This is roughly the same thing that will happen if you set a master password then reset it. In short, Sync doesn't know the data has been lost, so doesn't attempt to refetch the logins and re-save them. Sadly, even if it did, currently it would still fail due to bug 621846, but hopefully that will be fixed soon.\n\nWhat *might* be possible is for Sync to count how many logins are unable to be decrypted and store that in preferences. If it ever finds that number has changed since the last sync, it could do a local \"reset\" and force all new logins to be downloaded and applied.\n\n(This still wouldn't solve the issue if the problem is actually that logins.json was deleted or became corrupt - we could possibly solve that by storing a GUID in logins.json and in sync preferences, and if sync finds them different it also does a reset.)", "time": "2017-07-06T08:07:34Z", "tags": [], "raw_text": "I thought we already had a bug for this, but I can't find it.\n\n(In reply to a.harrowell@gmail.com from comment #0)\n> Since the update to FF 54 and consequent re-authentication on the 23rd of\n> June,\n\nI'm not sure what happened as you updated, but whatever it was, I expect all your logins were suddenly unable to be decrypted. This is roughly the same thing that will happen if you set a master password then reset it. In short, Sync doesn't know the data has been lost, so doesn't attempt to refetch the logins and re-save them. Sadly, even if it did, currently it would still fail due to bug 621846, but hopefully that will be fixed soon.\n\nWhat *might* be possible is for Sync to count how many logins are unable to be decrypted and store that in preferences. If it ever finds that number has changed since the last sync, it could do a local \"reset\" and force all new logins to be downloaded and applied.\n\n(This still wouldn't solve the issue if the problem is actually that logins.json was deleted or became corrupt - we could possibly solve that by storing a GUID in logins.json and in sync preferences, and if sync finds them different it also does a reset.)", "creator": "markh@mozilla.com", "bug_id": 1377100, "count": 5, "id": 12450656, "creation_time": "2017-07-06T08:07:34Z"}, {"bug_id": 1377100, "is_private": false, "raw_text": "", "author": "markh@mozilla.com", "creator": "markh@mozilla.com", "count": 6, "attachment_id": null, "id": 13635848, "text": "*** Bug 1492384 has been marked as a duplicate of this bug. ***", "creation_time": "2018-09-24T08:05:16Z", "time": "2018-09-24T08:05:16Z", "tags": []}, {"tags": [], "time": "2019-12-04T05:04:05Z", "text": "*** Bug 1597358 has been marked as a duplicate of this bug. ***", "attachment_id": null, "is_private": false, "author": "markh@mozilla.com", "creation_time": "2019-12-04T05:04:05Z", "id": 14525804, "count": 7, "bug_id": 1377100, "creator": "markh@mozilla.com", "raw_text": ""}, {"creation_time": "2019-12-04T06:11:12Z", "bug_id": 1377100, "raw_text": "", "creator": "markh@mozilla.com", "count": 8, "id": 14525868, "text": "*** Bug 1600846 has been marked as a duplicate of this bug. ***", "time": "2019-12-04T06:11:12Z", "tags": [], "is_private": false, "author": "markh@mozilla.com", "attachment_id": null}, {"creation_time": "2020-01-09T02:20:46Z", "text": "*** Bug 1607616 has been marked as a duplicate of this bug. ***", "time": "2020-01-09T02:20:46Z", "tags": [], "raw_text": "", "author": "markh@mozilla.com", "creator": "markh@mozilla.com", "bug_id": 1377100, "is_private": false, "count": 9, "id": 14581561, "attachment_id": null}, {"tags": [], "time": "2020-02-27T04:38:42Z", "creation_time": "2020-02-27T04:38:42Z", "text": "*** Bug 1591401 has been marked as a duplicate of this bug. ***", "attachment_id": null, "id": 14664385, "count": 10, "creator": "markh@mozilla.com", "author": "markh@mozilla.com", "raw_text": "", "is_private": false, "bug_id": 1377100}, {"tags": [], "time": "2020-04-22T00:44:21Z", "creation_time": "2020-04-22T00:44:21Z", "text": "*** Bug 1627776 has been marked as a duplicate of this bug. ***", "id": 14770602, "attachment_id": null, "count": 11, "author": "markh@mozilla.com", "creator": "markh@mozilla.com", "raw_text": "", "is_private": false, "bug_id": 1377100}, {"bug_id": 1377100, "creator": "markh@mozilla.com", "raw_text": "", "id": 14853796, "count": 12, "creation_time": "2020-06-01T00:24:43Z", "is_private": false, "author": "markh@mozilla.com", "attachment_id": null, "text": "*** Bug 1642156 has been marked as a duplicate of this bug. ***", "tags": [], "time": "2020-06-01T00:24:43Z"}, {"time": "2020-07-08T08:34:11Z", "tags": [], "text": "I found a little time to work on this.", "creation_time": "2020-07-08T08:34:11Z", "count": 13, "id": 14924703, "attachment_id": null, "bug_id": 1377100, "is_private": false, "raw_text": "I found a little time to work on this.", "creator": "markh@mozilla.com", "author": "markh@mozilla.com"}, {"is_private": false, "bug_id": 1377100, "author": "markh@mozilla.com", "creator": "markh@mozilla.com", "raw_text": "\nThis is done so that if the login manager loses all data sync is \"reset\",\nmeaning will do a full reconcile with the server and pull all sync records\ndown and apply them locally - ie, sync will be ble to recover passwords for\nmany users.\n\nThe sync GUID is stored encrypted, so that even if the login manager data\nisn't lost, but the encryption key is, it will still reset and recover.\n\nThis will also make restoring an older logins.json a little more reliable for\nsync - if an old version is restored then sync should \"rewind\" itself to the\nstate it was in the backup.", "attachment_id": 9162081, "id": 14924707, "count": 14, "text": "Created attachment 9162081\nBug 1377100 - Store sync metadata in the LoginManager. r?lina,MattN\n\n\nThis is done so that if the login manager loses all data sync is \"reset\",\nmeaning will do a full reconcile with the server and pull all sync records\ndown and apply them locally - ie, sync will be ble to recover passwords for\nmany users.\n\nThe sync GUID is stored encrypted, so that even if the login manager data\nisn't lost, but the encryption key is, it will still reset and recover.\n\nThis will also make restoring an older logins.json a little more reliable for\nsync - if an old version is restored then sync should \"rewind\" itself to the\nstate it was in the backup.", "creation_time": "2020-07-08T08:38:38Z", "tags": [], "time": "2020-07-08T08:38:38Z"}, {"tags": [], "time": "2020-07-28T04:23:29Z", "text": "Pushed by mhammond@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/0d918902af47\nStore sync metadata in the LoginManager. r=lina,MattN", "creation_time": "2020-07-28T04:23:29Z", "attachment_id": null, "id": 14959704, "count": 15, "is_private": false, "bug_id": 1377100, "creator": "pulsebot@bots.tld", "author": "pulsebot@bots.tld", "raw_text": "Pushed by mhammond@mozilla.com:\nhttps://hg.mozilla.org/integration/autoland/rev/0d918902af47\nStore sync metadata in the LoginManager. r=lina,MattN"}, {"author": "ccoroiu@mozilla.com", "is_private": false, "attachment_id": null, "text": "https://hg.mozilla.org/mozilla-central/rev/0d918902af47", "tags": ["bugherder"], "time": "2020-07-28T09:53:39Z", "creator": "ccoroiu@mozilla.com", "raw_text": "https://hg.mozilla.org/mozilla-central/rev/0d918902af47", "bug_id": 1377100, "id": 14959948, "count": 16, "creation_time": "2020-07-28T09:53:39Z"}]}}, "comments": {}}