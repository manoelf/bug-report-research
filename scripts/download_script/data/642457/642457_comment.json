{"comments": {}, "bugs": {"642457": {"comments": [{"tags": [], "is_private": false, "time": "2011-03-17T15:13:05Z", "count": 0, "bug_id": 642457, "raw_text": "In bug 549539, we added {chrome|content}-document-window-created observer service notifications. The intent was to provide a hook for third parties to add content-exposed APIs, so that they could transition away from enablePrivilege.\n\nbug 582472 used that notification to add a SpecialPowers object to Mochitests. But, being forward-thinking, it also added support for e10s, so the observer was added in a content script.\n\nIn bug 641969, we discovered that this is broken, because the observer will get notifications about all windows, regardless of what tab they're in, but content scripts run per-tab.\n\nThis seems like a serious design flaw. Firefox is eventually going to move to e10s, and this API is broken by design in e10s. We shouldn't be encouraging people to rewrite enablePrivilege-using code to use an API that won't work with e10s. The SpecialPowers patch was reviewed by smaug, so if he didn't notice the problem initially, I have no faith that third parties will get it right.\n\nFurthermore, bug 567357 added a DOM event that covers the same purpose, specifically for e10s usage. This seems like the thing we should be encouraging people to use, since it works correctly with e10s (and it's already in use in-tree: http://mxr.mozilla.org/mozilla-central/source/toolkit/mozapps/extensions/content/extensions-content.js#211 )", "author": "ted@mielczarek.org", "text": "In bug 549539, we added {chrome|content}-document-window-created observer service notifications. The intent was to provide a hook for third parties to add content-exposed APIs, so that they could transition away from enablePrivilege.\n\nbug 582472 used that notification to add a SpecialPowers object to Mochitests. But, being forward-thinking, it also added support for e10s, so the observer was added in a content script.\n\nIn bug 641969, we discovered that this is broken, because the observer will get notifications about all windows, regardless of what tab they're in, but content scripts run per-tab.\n\nThis seems like a serious design flaw. Firefox is eventually going to move to e10s, and this API is broken by design in e10s. We shouldn't be encouraging people to rewrite enablePrivilege-using code to use an API that won't work with e10s. The SpecialPowers patch was reviewed by smaug, so if he didn't notice the problem initially, I have no faith that third parties will get it right.\n\nFurthermore, bug 567357 added a DOM event that covers the same purpose, specifically for e10s usage. This seems like the thing we should be encouraging people to use, since it works correctly with e10s (and it's already in use in-tree: http://mxr.mozilla.org/mozilla-central/source/toolkit/mozapps/extensions/content/extensions-content.js#211 )", "creator": "ted@mielczarek.org", "id": 5350748, "attachment_id": null, "creation_time": "2011-03-17T15:13:05Z"}, {"time": "2011-03-17T15:20:55Z", "bug_id": 642457, "count": 1, "creator": "benjamin@smedbergs.us", "author": "benjamin@smedbergs.us", "is_private": false, "tags": [], "raw_text": "Yesyes, the DOM event was for *exactly* this purpose.", "attachment_id": null, "id": 5350763, "text": "Yesyes, the DOM event was for *exactly* this purpose.", "creation_time": "2011-03-17T15:20:55Z"}, {"creator": "jonas@sicking.cc", "author": "jonas@sicking.cc", "time": "2011-03-17T17:00:54Z", "bug_id": 642457, "count": 2, "id": 5350974, "attachment_id": null, "text": "I'm all for migrating existing code to the better API as well as documenting how other people should use it.\n\nI don't know enough about e10s and event dispatch to know where and when to attach event listeners such that you get notified for all the relevant events here.", "creation_time": "2011-03-17T17:00:54Z", "is_private": false, "tags": [], "raw_text": "I'm all for migrating existing code to the better API as well as documenting how other people should use it.\n\nI don't know enough about e10s and event dispatch to know where and when to attach event listeners such that you get notified for all the relevant events here."}]}}}