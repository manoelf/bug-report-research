{"bugs": {"622817": {"comments": [{"creation_time": "2011-01-04T14:40:11Z", "tags": [], "is_private": false, "text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.224 Safari/534.10\nBuild Identifier: 4.0b4\n\nrange.setStart is behaving strangely in onkeyup. By the time onkeyup event is fired, the character should be displayed on the screen. now, if i do range.setStart(range.startContainer, range.startOffset-1), the pressed character is replacing the old character.\n\nHere is the sample html file which is causing an issue.\n\n<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN' 'http://www.w3.org/TR/html4/loose.dtd'>\n<html>\n<head>\n<title>Range.setStart Test</title>\n<script type=\"text/javascript\">\nfunction moveStartRange(rangeObject, unit, count)\n{\n\trangeObject.setStart(rangeObject.startContainer, rangeObject.startOffset-1);\n}\nfunction sampleFunc(eventObject)\n{\n\tvar selection = document.defaultView.getSelection();\n\tvar rangeObject = ( selection && selection.rangeCount > 0 ) ? selection.getRangeAt(0) : document.createRange();\n\tmoveStartRange(rangeObject, \"character\", -1);\n}\n</script>\n<body>\n<div id=\"sampleDiv\" contentEditable=\"true\" style=\"width:300px;height:300px;\" onkeyup=\"sampleFunc(event);\">This is Mozilla Firefox Browser.</div>\n</body>\n</html>\n\nReproducible: Always\n\nSteps to Reproduce:\n<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN' 'http://www.w3.org/TR/html4/loose.dtd'>\n<html>\n<head>\n<title>selection Test</title>\n<script type=\"text/javascript\">\nfunction moveStartRange(rangeObject, unit, count)\n{\n\trangeObject.setStart(rangeObject.startContainer, rangeObject.startOffset-1);\n}\nfunction sampleFunc(eventObject)\n{\n\tvar selection = document.defaultView.getSelection();\n\tvar rangeObject = ( selection && selection.rangeCount > 0 ) ? selection.getRangeAt(0) : document.createRange();\n\tmoveStartRange(rangeObject, \"character\", -1);\n}\n</script>\n<body>\n<div id=\"sampleDiv\" contentEditable=\"true\" style=\"width:300px;height:300px;\" onkeyup=\"sampleFunc(event);\">This is Mozilla Firefox Browser.</div>\n</body>\n</html>\n\n1. load above html.\n2. click anywhere in the text and press any key.\n3. then press another char, the previous char is replaced with the new char.\nActual Results:  \nThe pervious char is replaced with the new char\n\nExpected Results:  \nThe previous char should not be replaced with the new char.", "id": 5173553, "count": 0, "time": "2011-01-04T14:40:11Z", "attachment_id": null, "creator": "tgvrs_santhosh@yahoo.com", "author": "tgvrs_santhosh@yahoo.com", "bug_id": 622817, "raw_text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.224 Safari/534.10\nBuild Identifier: 4.0b4\n\nrange.setStart is behaving strangely in onkeyup. By the time onkeyup event is fired, the character should be displayed on the screen. now, if i do range.setStart(range.startContainer, range.startOffset-1), the pressed character is replacing the old character.\n\nHere is the sample html file which is causing an issue.\n\n<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN' 'http://www.w3.org/TR/html4/loose.dtd'>\n<html>\n<head>\n<title>Range.setStart Test</title>\n<script type=\"text/javascript\">\nfunction moveStartRange(rangeObject, unit, count)\n{\n\trangeObject.setStart(rangeObject.startContainer, rangeObject.startOffset-1);\n}\nfunction sampleFunc(eventObject)\n{\n\tvar selection = document.defaultView.getSelection();\n\tvar rangeObject = ( selection && selection.rangeCount > 0 ) ? selection.getRangeAt(0) : document.createRange();\n\tmoveStartRange(rangeObject, \"character\", -1);\n}\n</script>\n<body>\n<div id=\"sampleDiv\" contentEditable=\"true\" style=\"width:300px;height:300px;\" onkeyup=\"sampleFunc(event);\">This is Mozilla Firefox Browser.</div>\n</body>\n</html>\n\nReproducible: Always\n\nSteps to Reproduce:\n<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN' 'http://www.w3.org/TR/html4/loose.dtd'>\n<html>\n<head>\n<title>selection Test</title>\n<script type=\"text/javascript\">\nfunction moveStartRange(rangeObject, unit, count)\n{\n\trangeObject.setStart(rangeObject.startContainer, rangeObject.startOffset-1);\n}\nfunction sampleFunc(eventObject)\n{\n\tvar selection = document.defaultView.getSelection();\n\tvar rangeObject = ( selection && selection.rangeCount > 0 ) ? selection.getRangeAt(0) : document.createRange();\n\tmoveStartRange(rangeObject, \"character\", -1);\n}\n</script>\n<body>\n<div id=\"sampleDiv\" contentEditable=\"true\" style=\"width:300px;height:300px;\" onkeyup=\"sampleFunc(event);\">This is Mozilla Firefox Browser.</div>\n</body>\n</html>\n\n1. load above html.\n2. click anywhere in the text and press any key.\n3. then press another char, the previous char is replaced with the new char.\nActual Results:  \nThe pervious char is replaced with the new char\n\nExpected Results:  \nThe previous char should not be replaced with the new char."}, {"tags": [], "creation_time": "2011-01-04T19:35:15Z", "id": 5174379, "count": 1, "is_private": false, "text": "Created attachment 501077\nThe testcase", "creator": "bzbarsky@mit.edu", "attachment_id": 501077, "author": "bzbarsky@mit.edu", "time": "2011-01-04T19:35:15Z", "raw_text": "", "bug_id": 622817}, {"bug_id": 622817, "raw_text": "Ehsan, want to take a look?", "time": "2011-01-04T19:35:40Z", "creator": "bzbarsky@mit.edu", "attachment_id": null, "author": "bzbarsky@mit.edu", "is_private": false, "text": "Ehsan, want to take a look?", "id": 5174381, "count": 2, "tags": [], "creation_time": "2011-01-04T19:35:40Z"}, {"time": "2011-01-05T04:39:48Z", "creator": "tgvrs_santhosh@yahoo.com", "attachment_id": null, "author": "tgvrs_santhosh@yahoo.com", "bug_id": 622817, "raw_text": "If i do setStart operation on cloned range, then it is working fine. So, In my opinion, on doing setStart on original range, even the selection got updated and replaced with the new char.", "tags": [], "creation_time": "2011-01-05T04:39:48Z", "is_private": false, "text": "If i do setStart operation on cloned range, then it is working fine. So, In my opinion, on doing setStart on original range, even the selection got updated and replaced with the new char.", "id": 5176165, "count": 3}, {"bug_id": 622817, "raw_text": "i have observed that in mozilla, if i do selectionObj.getRangeAt(0) == selectionObj.getRangeAt(0), it is returning true. But, in chrome it is returning false. so, chrome before returning rangeObject to user, he is cloning. Even though it is strange, i still feel it is right because from selection we can get range but range should not effect the selection until and unless it is added to selection using selectionObj.addRange. In the above mentioned example, as i'm directly manipulating on the rangeObject returned by getRangeAt method, i think it is getting replaced. so, doing clone is solving the problem.\n\nHere is the test page for it..\n\n<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN' 'http://www.w3.org/TR/html4/loose.dtd'>\n<html>\n<head>\n<title>selection Test</title>\n<script type=\"text/javascript\">\nfunction moveStartRange(rangeObject, unit, count)\n{\n\t//var rangeObject1 = rangeObject.cloneRange();\n\trangeObject.setStart(rangeObject.startContainer, rangeObject.startOffset-1);\n}\nfunction sampleFunc(eventObject)\n{\n\tvar selection = document.defaultView.getSelection();\n\tvar rangeObject = ( selection && selection.rangeCount > 0 ) ? selection.getRangeAt(0) : document.createRange();\n\tmoveStartRange(rangeObject, \"character\", -1);\n\t//document.getElementById(\"sampleTextArea\").value+=\"::\" + selection.getRangeAt(0).toString() + \"::\";\n\tdocument.getElementById(\"sampleTextArea\").value+=\"::\" + (selection.getRangeAt(0) == selection.getRangeAt(0)) + \"::\";\n}\n</script>\n<body>\n<div id=\"sampleDiv\" contentEditable=\"true\" style=\"width:300px;height:300px;\" onkeyup=\"sampleFunc(event);\">This is Mozilla Firefox Browser.</div>\n<textarea id=\"sampleTextArea\" rows=\"10\" cols=\"50\"></textarea>\n</body>\n</html>", "time": "2011-01-05T06:02:40Z", "author": "tgvrs_santhosh@yahoo.com", "creator": "tgvrs_santhosh@yahoo.com", "attachment_id": null, "text": "i have observed that in mozilla, if i do selectionObj.getRangeAt(0) == selectionObj.getRangeAt(0), it is returning true. But, in chrome it is returning false. so, chrome before returning rangeObject to user, he is cloning. Even though it is strange, i still feel it is right because from selection we can get range but range should not effect the selection until and unless it is added to selection using selectionObj.addRange. In the above mentioned example, as i'm directly manipulating on the rangeObject returned by getRangeAt method, i think it is getting replaced. so, doing clone is solving the problem.\n\nHere is the test page for it..\n\n<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN' 'http://www.w3.org/TR/html4/loose.dtd'>\n<html>\n<head>\n<title>selection Test</title>\n<script type=\"text/javascript\">\nfunction moveStartRange(rangeObject, unit, count)\n{\n\t//var rangeObject1 = rangeObject.cloneRange();\n\trangeObject.setStart(rangeObject.startContainer, rangeObject.startOffset-1);\n}\nfunction sampleFunc(eventObject)\n{\n\tvar selection = document.defaultView.getSelection();\n\tvar rangeObject = ( selection && selection.rangeCount > 0 ) ? selection.getRangeAt(0) : document.createRange();\n\tmoveStartRange(rangeObject, \"character\", -1);\n\t//document.getElementById(\"sampleTextArea\").value+=\"::\" + selection.getRangeAt(0).toString() + \"::\";\n\tdocument.getElementById(\"sampleTextArea\").value+=\"::\" + (selection.getRangeAt(0) == selection.getRangeAt(0)) + \"::\";\n}\n</script>\n<body>\n<div id=\"sampleDiv\" contentEditable=\"true\" style=\"width:300px;height:300px;\" onkeyup=\"sampleFunc(event);\">This is Mozilla Firefox Browser.</div>\n<textarea id=\"sampleTextArea\" rows=\"10\" cols=\"50\"></textarea>\n</body>\n</html>", "is_private": false, "id": 5176227, "count": 4, "tags": [], "creation_time": "2011-01-05T06:02:40Z"}, {"creation_time": "2011-01-05T06:18:01Z", "tags": [], "id": 5176242, "count": 5, "is_private": false, "text": "There's an existing bug on cloning ranges when getting them from the selection (and also when adding them to the selection, of course).", "attachment_id": null, "creator": "bzbarsky@mit.edu", "author": "bzbarsky@mit.edu", "time": "2011-01-05T06:18:01Z", "raw_text": "There's an existing bug on cloning ranges when getting them from the selection (and also when adding them to the selection, of course).", "bug_id": 622817}, {"bug_id": 622817, "raw_text": "oh...so far i didn't face any problem with cloning and setting range to selection. Now, i used clone of range of selection and able to proceed further.", "time": "2011-01-05T08:51:03Z", "creator": "tgvrs_santhosh@yahoo.com", "author": "tgvrs_santhosh@yahoo.com", "attachment_id": null, "is_private": false, "text": "oh...so far i didn't face any problem with cloning and setting range to selection. Now, i used clone of range of selection and able to proceed further.", "count": 6, "id": 5176413, "tags": [], "creation_time": "2011-01-05T08:51:03Z"}]}}, "comments": {}}