{"comments": {}, "bugs": {"625245": {"comments": [{"creator": "azakai@mozilla.com", "creation_time": "2011-01-13T00:59:02Z", "is_private": false, "id": 5195402, "text": "If an Image is preloaded, using something like\n\n  x = new Image();\n  x.src = URL;\n\nthen it will be loaded, and TrackImage called. So we will run its animation, even if it isn't being shown anywhere.\n\nWe should only track the image if the image element is bound to a tree.\n\nThe approach I suggest is outlined in this patch (which does a few other things too),\n\nhttps://bugzilla.mozilla.org/attachment.cgi?id=503241&action=diff\n\nBasically,\n\n1. Take note when we are bound. I can't find a good way to do this, so I added mBoundToTree in that patch. Is there a better way?\n2. Not track the image if not bound.\n3. Call TrackImage when binding, and UntrackImage when unbinding.\n4. Track only the current request, and not the pending one, and be careful about tracking exactly once and always untracking (using mTrackedRequest - I suspect we called track more than once per image before).\n\nSee a few relevant comments here: https://bugzilla.mozilla.org/show_bug.cgi?id=594771#c52\n\nIs the approach described above acceptable?", "time": "2011-01-13T00:59:02Z", "tags": [], "author": "azakai@mozilla.com", "attachment_id": null, "bug_id": 625245, "raw_text": "If an Image is preloaded, using something like\n\n  x = new Image();\n  x.src = URL;\n\nthen it will be loaded, and TrackImage called. So we will run its animation, even if it isn't being shown anywhere.\n\nWe should only track the image if the image element is bound to a tree.\n\nThe approach I suggest is outlined in this patch (which does a few other things too),\n\nhttps://bugzilla.mozilla.org/attachment.cgi?id=503241&action=diff\n\nBasically,\n\n1. Take note when we are bound. I can't find a good way to do this, so I added mBoundToTree in that patch. Is there a better way?\n2. Not track the image if not bound.\n3. Call TrackImage when binding, and UntrackImage when unbinding.\n4. Track only the current request, and not the pending one, and be careful about tracking exactly once and always untracking (using mTrackedRequest - I suspect we called track more than once per image before).\n\nSee a few relevant comments here: https://bugzilla.mozilla.org/show_bug.cgi?id=594771#c52\n\nIs the approach described above acceptable?", "count": 0}, {"attachment_id": null, "bug_id": 625245, "tags": [], "author": "azakai@mozilla.com", "count": 1, "raw_text": "An alternative to this is to have several kinds of animation consumers/locks. So when not bound, one type of lock would be taken - just enough for preloading to work. When bound, another lock would be taken - enough to also actually render/animate. Perhaps other types are needed too.", "creation_time": "2011-01-26T21:41:43Z", "creator": "azakai@mozilla.com", "id": 5229884, "text": "An alternative to this is to have several kinds of animation consumers/locks. So when not bound, one type of lock would be taken - just enough for preloading to work. When bound, another lock would be taken - enough to also actually render/animate. Perhaps other types are needed too.", "time": "2011-01-26T21:41:43Z", "is_private": false}, {"text": "To clarify, the point of multiple lock types is to enable the following:\n\n1. When preloaded, we remain in memory but do not animate\n2. When shown, we animate\n3. When in a background tab, we freeze", "id": 5229889, "time": "2011-01-26T21:42:53Z", "is_private": false, "creation_time": "2011-01-26T21:42:53Z", "creator": "azakai@mozilla.com", "count": 2, "raw_text": "To clarify, the point of multiple lock types is to enable the following:\n\n1. When preloaded, we remain in memory but do not animate\n2. When shown, we animate\n3. When in a background tab, we freeze", "attachment_id": null, "bug_id": 625245, "tags": [], "author": "azakai@mozilla.com"}, {"is_private": false, "text": "This is implemented in bug 1157546. (Indeed, the condition is stronger: we need to not only be bound to the tree, but the frame must be visible.)\n\nI'm pretty sure it also worked before then, actually. But rather than verify that, I'll just make this blocked by bug 1157546, which should land very soon.", "id": 10932274, "time": "2015-11-13T23:18:56Z", "creation_time": "2015-11-13T23:18:56Z", "creator": "seth.bugzilla@blackhail.net", "count": 3, "raw_text": "This is implemented in bug 1157546. (Indeed, the condition is stronger: we need to not only be bound to the tree, but the frame must be visible.)\n\nI'm pretty sure it also worked before then, actually. But rather than verify that, I'll just make this blocked by bug 1157546, which should land very soon.", "attachment_id": null, "bug_id": 625245, "tags": [], "author": "seth.bugzilla@blackhail.net"}]}}}