{"comments": {}, "bugs": {"666739": {"comments": [{"attachment_id": null, "raw_text": "User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\n\nI'm using XPCOM proxies for dispatching JS-callbacks from my DLL to main GUI thread. It works but prevents windows system shutdown/log-off after using it.\n\nI have following code in my XPCOM component:\n\nnsresult rv;\nnsCOMPtr<nsIProxyObjectManager> proxyManager;\nproxyManager = do_GetService(NS_XPCOMPROXY_CONTRACTID,&rv);\nnsCString acc_id;\n\nacc_id.Assign(account->identify);\n\nif (NS_SUCCEEDED(rv))\n{\n        nsCOMPtr<nsISPCallbacks> prox;\n\tproxyManager->GetProxyForObject(NS_PROXY_TO_MAIN_THREAD,                NS_GET_IID(nsISPCallbacks),(nsISPCallbacks*)sip_callbacks, NS_PROXY_SYNC | NS_PROXY_ALWAYS, getter_AddRefs(prox));\n\tprox->OnRegisterSuccessCallback(acc_id.get());\n}\n\nWithout this, windows is shutdown normally.\n\nReproducible: Always", "id": 5552148, "creator": "devpieron@gmail.com", "is_private": false, "count": 0, "author": "devpieron@gmail.com", "creation_time": "2011-06-23T20:41:55Z", "time": "2011-06-23T20:41:55Z", "tags": [], "bug_id": 666739, "text": "User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\nBuild Identifier: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1\n\nI'm using XPCOM proxies for dispatching JS-callbacks from my DLL to main GUI thread. It works but prevents windows system shutdown/log-off after using it.\n\nI have following code in my XPCOM component:\n\nnsresult rv;\nnsCOMPtr<nsIProxyObjectManager> proxyManager;\nproxyManager = do_GetService(NS_XPCOMPROXY_CONTRACTID,&rv);\nnsCString acc_id;\n\nacc_id.Assign(account->identify);\n\nif (NS_SUCCEEDED(rv))\n{\n        nsCOMPtr<nsISPCallbacks> prox;\n\tproxyManager->GetProxyForObject(NS_PROXY_TO_MAIN_THREAD,                NS_GET_IID(nsISPCallbacks),(nsISPCallbacks*)sip_callbacks, NS_PROXY_SYNC | NS_PROXY_ALWAYS, getter_AddRefs(prox));\n\tprox->OnRegisterSuccessCallback(acc_id.get());\n}\n\nWithout this, windows is shutdown normally.\n\nReproducible: Always"}, {"id": 5553197, "raw_text": "Probably the wrong component to move this to but I'll choose Core::XPCOM at random.", "attachment_id": null, "text": "Probably the wrong component to move this to but I'll choose Core::XPCOM at random.", "time": "2011-06-24T04:03:46Z", "tags": [], "creation_time": "2011-06-24T04:03:46Z", "author": "philip.chee@gmail.com", "is_private": false, "creator": "philip.chee@gmail.com", "bug_id": 666739, "count": 1}, {"is_private": false, "creator": "benjamin@smedbergs.us", "count": 2, "creation_time": "2011-06-24T14:24:34Z", "author": "benjamin@smedbergs.us", "text": "Do you have a Firefox stack trace after \"shutdown\" when the Firefox process isn't actually shutting down?\n\nAre you using these proxies during the shutdown process? That's probably bad. I highly recommend never using XPCOM proxies because they are prone to deadlocks unless used extremely carefully: it's generally better to just write a custom nsIRunnable and post it to the main thread.", "time": "2011-06-24T14:24:34Z", "bug_id": 666739, "tags": [], "attachment_id": null, "raw_text": "Do you have a Firefox stack trace after \"shutdown\" when the Firefox process isn't actually shutting down?\n\nAre you using these proxies during the shutdown process? That's probably bad. I highly recommend never using XPCOM proxies because they are prone to deadlocks unless used extremely carefully: it's generally better to just write a custom nsIRunnable and post it to the main thread.", "id": 5553929}, {"count": 3, "bug_id": 666739, "attachment_id": null, "raw_text": "(In reply to comment #2)\n> Do you have a Firefox stack trace after \"shutdown\" when the Firefox process\n> isn't actually shutting down?\nNo i haven't. How can i get it? Just with MSVC gebugger or something else?\n\n> Are you using these proxies during the shutdown process? That's probably\n> bad. I highly recommend never using XPCOM proxies because they are prone to\n> deadlocks unless used extremely carefully: it's generally better to just\n> write a custom nsIRunnable and post it to the main thread.\nHm, unregistration callback is called after shutdown beginning. I'll try to disable it and check again.", "id": 5558502, "creator": "devpieron@gmail.com", "is_private": false, "author": "devpieron@gmail.com", "creation_time": "2011-06-27T13:22:35Z", "time": "2011-06-27T13:22:35Z", "tags": [], "text": "(In reply to comment #2)\n> Do you have a Firefox stack trace after \"shutdown\" when the Firefox process\n> isn't actually shutting down?\nNo i haven't. How can i get it? Just with MSVC gebugger or something else?\n\n> Are you using these proxies during the shutdown process? That's probably\n> bad. I highly recommend never using XPCOM proxies because they are prone to\n> deadlocks unless used extremely carefully: it's generally better to just\n> write a custom nsIRunnable and post it to the main thread.\nHm, unregistration callback is called after shutdown beginning. I'll try to disable it and check again."}, {"text": "Yes, the MSVC debugger using the symbol server.\n\nWhat unregistration callback?", "tags": [], "time": "2011-06-27T17:09:11Z", "bug_id": 666739, "creation_time": "2011-06-27T17:09:11Z", "author": "benjamin@smedbergs.us", "count": 4, "is_private": false, "creator": "benjamin@smedbergs.us", "id": 5558988, "raw_text": "Yes, the MSVC debugger using the symbol server.\n\nWhat unregistration callback?", "attachment_id": null}, {"raw_text": "(In reply to comment #4)\n> What unregistration callback?\nThis is our callback called on closing/shutdown event.\nWe're developing voip plug-in for firefox and other browsers.\n\nI disabled it and windows couldn't to shutdown again. No more callbacks are called.\n\nI'll try to provide stack trace.", "attachment_id": null, "id": 5564353, "count": 5, "creator": "devpieron@gmail.com", "is_private": false, "bug_id": 666739, "tags": [], "time": "2011-06-29T13:33:06Z", "text": "(In reply to comment #4)\n> What unregistration callback?\nThis is our callback called on closing/shutdown event.\nWe're developing voip plug-in for firefox and other browsers.\n\nI disabled it and windows couldn't to shutdown again. No more callbacks are called.\n\nI'll try to provide stack trace.", "author": "devpieron@gmail.com", "creation_time": "2011-06-29T13:33:06Z"}]}}}