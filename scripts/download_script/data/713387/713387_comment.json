{"comments": {}, "bugs": {"713387": {"comments": [{"raw_text": "nsTextFrame currently returns true to IsFrameOfType(eReplaced), even though text frames aren't replaced elements.\n\nHere's the code in question:\n> 142   virtual bool IsFrameOfType(PRUint32 aFlags) const\n> 143   {\n> 144     // Set the frame state bit for text frames to mark them as replaced.\n> 145     // XXX kipp: temporary\n> 146     return nsFrame::IsFrameOfType(aFlags & ~(nsIFrame::eReplaced |\n> 147                                              nsIFrame::eLineParticipant));\n> 148   }\nhttp://mxr.mozilla.org/mozilla-central/source/layout/generic/nsTextFrame.h#142\n\nThis dates at least as far back as the reflow branch:\nhttp://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/layout/generic/Attic/nsTextFrame.cpp&rev=1.615&root=/cvsroot#6346\n\nand before that, it appears to trace back to this commit (using a differently-named flag):\n> 1.81 \tkipp%netscape.com\t1999-02-23 11:35\t \tFor now text acts like a replaced element\nhttp://bonsai.mozilla.org/cvsview2.cgi?diff_mode=context&whitespace_mode=show&file=nsTextFrame.cpp&branch=1.615&root=/cvsroot&subdir=mozilla/layout/generic/Attic&command=DIFF_FRAMESET&rev1=1.80&rev2=1.81\n\nI tried removing the eReplaced chunk from nsTextFrame's IsFrameOfType impl, with a full Try run, and it doesn't appear to have broken anything -- just sporadic failures:\nhttps://tbpl.mozilla.org/?tree=Try&rev=d5c75f22dfd6\n\nBefore actually making this change, we should probably audit the uses of eReplaced to be sure we'll get the right behavior if a nsTextFrame ever hits those pieces of code.  In at least one instance, we have an explicit special-case for nsTextFrame to give it the non-Replaced behavior (and that special-case could be removed):\nhttp://mxr.mozilla.org/mozilla-central/source/layout/generic/nsHTMLReflowState.cpp#305", "attachment_id": null, "time": "2011-12-24T18:16:10Z", "tags": [], "count": 0, "text": "nsTextFrame currently returns true to IsFrameOfType(eReplaced), even though text frames aren't replaced elements.\n\nHere's the code in question:\n> 142   virtual bool IsFrameOfType(PRUint32 aFlags) const\n> 143   {\n> 144     // Set the frame state bit for text frames to mark them as replaced.\n> 145     // XXX kipp: temporary\n> 146     return nsFrame::IsFrameOfType(aFlags & ~(nsIFrame::eReplaced |\n> 147                                              nsIFrame::eLineParticipant));\n> 148   }\nhttp://mxr.mozilla.org/mozilla-central/source/layout/generic/nsTextFrame.h#142\n\nThis dates at least as far back as the reflow branch:\nhttp://bonsai.mozilla.org/cvsblame.cgi?file=mozilla/layout/generic/Attic/nsTextFrame.cpp&rev=1.615&root=/cvsroot#6346\n\nand before that, it appears to trace back to this commit (using a differently-named flag):\n> 1.81 \tkipp%netscape.com\t1999-02-23 11:35\t \tFor now text acts like a replaced element\nhttp://bonsai.mozilla.org/cvsview2.cgi?diff_mode=context&whitespace_mode=show&file=nsTextFrame.cpp&branch=1.615&root=/cvsroot&subdir=mozilla/layout/generic/Attic&command=DIFF_FRAMESET&rev1=1.80&rev2=1.81\n\nI tried removing the eReplaced chunk from nsTextFrame's IsFrameOfType impl, with a full Try run, and it doesn't appear to have broken anything -- just sporadic failures:\nhttps://tbpl.mozilla.org/?tree=Try&rev=d5c75f22dfd6\n\nBefore actually making this change, we should probably audit the uses of eReplaced to be sure we'll get the right behavior if a nsTextFrame ever hits those pieces of code.  In at least one instance, we have an explicit special-case for nsTextFrame to give it the non-Replaced behavior (and that special-case could be removed):\nhttp://mxr.mozilla.org/mozilla-central/source/layout/generic/nsHTMLReflowState.cpp#305", "author": "dholbert@mozilla.com", "creator": "dholbert@mozilla.com", "creation_time": "2011-12-24T18:16:10Z", "is_private": false, "id": 5938794, "bug_id": 713387}, {"tags": [], "attachment_id": 585961, "creation_time": "2012-01-05T02:08:38Z", "is_private": false, "creator": "dholbert@mozilla.com", "raw_text": "Just to kick this bug off -- here's the obvious patch to just tweak nsTextFrame's IsFrameOfType impl.\n\nWe probably will need to tweak code elsewhere too, per end of prev comment.  (If anyone feels like taking this bug, feel free to steal this patch and build off of it.)", "time": "2012-01-05T02:08:38Z", "id": 5956108, "bug_id": 713387, "count": 1, "text": "Created attachment 585961\ninitial strawman patch\n\nJust to kick this bug off -- here's the obvious patch to just tweak nsTextFrame's IsFrameOfType impl.\n\nWe probably will need to tweak code elsewhere too, per end of prev comment.  (If anyone feels like taking this bug, feel free to steal this patch and build off of it.)", "author": "dholbert@mozilla.com"}]}}}