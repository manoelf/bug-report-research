{"comments": {}, "bugs": {"628394": {"comments": [{"count": 0, "author": "rogjunk@gmail.com", "attachment_id": null, "creator": "rogjunk@gmail.com", "raw_text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1) Gecko/20090624 Firefox/3.5 GTB7.1\nBuild Identifier: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1) Gecko/20090624 Firefox/3.5 GTB7.1\n\nWhen using HTML5 Canvas 2D context, the Canvas DOM object is not loading images from the cache.  For example, the following Javascript pseudo-code:\n\nvar img = new Image(), var canvas = document.getElementById(\"canvas\").getContext(\"2d\");\nimg.src = \"http://foo/bar.baz\";\nimg.onload = function() {\n  canvas.drawImage(this, 0, 0);\n};\n\nThis is code from memory so the above code may not be 100% accurate, but it illustrates the general problem.\n\nWhen the canvas.drawImage method is called, the image resource is specified to be the LOADED img object.  Therefore, this image should already be cached and should load instantly.  However, with the canvas DOM object, instead of loading it directly from the cache, it tries to re-load the image entirely -- resulting in the following error:\n\nComponent returned failure code: 0x80040111 (NS_ERROR_NOT_AVAILABLE) [nsIDOMCanvasRenderingContext2D.drawImage]\n\nThe Canvas object does not think a valid image resource was provided because it's not loading the pre-loaded image that's already cached and instead trying to load (or re-load) the image entirely every time the drawImage method is called.\n\nThe error does not always occur (which suggests this is a race condition which can only occur with asynchronous events like waiting for images to load).  It's best to test with large image files as the bug will occur more often (since small image files can load rather quickly).  I tested with 200kb+ image files, with my largest being a 1.3MB image file.\n\nThe likelihood of the bug also increases with a loop and drawImage() method call like so:\n\nfor (var i=0;i<360;i++) {\n  canvas.drawImage(img, 0, 0);\n}\n\nEach loop, the image resource will be re-loaded which increases the likelihood of the race condition.\n\nReproducible: Sometimes\n\nSteps to Reproduce:\nAll steps are provided in \"Details,\" but in summary:\n\n1. Create a canvas element.  Get 2D context.\n2. Dynamically create an image object via Javascript.\n3. Specify a large (200kb+) image file to load.\n4. Add an event listener for image \"onload\" event.\n5. On image \"onload,\" call canvas.drawImage() method with pre-loaded, cached image file\n6. canvas.drawImage() will not used the cached image file but will instead try to load (or re-load) the image entirely every time the drawImage() method is called.\n7. Since image loading is asynchronous, this creates race conditions where the error does not always appear (although the likelihood of the error increases with larger image files and a loop that calls drawImage X number of times).\n8. This race condition can be easily fixed because there will be no race condition at all if canvas starts loading cached images and resources.\nActual Results:  \nAssuming the race condition occurs, this error should appear:\n\nComponent returned failure code: 0x80040111 (NS_ERROR_NOT_AVAILABLE) [nsIDOMCanvasRenderingContext2D.drawImage]\n\nExpected Results:  \nThe canvas DOM object should not be loading (or re-loading) images when the drawImage() method is called.  It should load pre-loaded and cached images where available.", "bug_id": 628394, "id": 5223151, "text": "User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1) Gecko/20090624 Firefox/3.5 GTB7.1\nBuild Identifier: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1) Gecko/20090624 Firefox/3.5 GTB7.1\n\nWhen using HTML5 Canvas 2D context, the Canvas DOM object is not loading images from the cache.  For example, the following Javascript pseudo-code:\n\nvar img = new Image(), var canvas = document.getElementById(\"canvas\").getContext(\"2d\");\nimg.src = \"http://foo/bar.baz\";\nimg.onload = function() {\n  canvas.drawImage(this, 0, 0);\n};\n\nThis is code from memory so the above code may not be 100% accurate, but it illustrates the general problem.\n\nWhen the canvas.drawImage method is called, the image resource is specified to be the LOADED img object.  Therefore, this image should already be cached and should load instantly.  However, with the canvas DOM object, instead of loading it directly from the cache, it tries to re-load the image entirely -- resulting in the following error:\n\nComponent returned failure code: 0x80040111 (NS_ERROR_NOT_AVAILABLE) [nsIDOMCanvasRenderingContext2D.drawImage]\n\nThe Canvas object does not think a valid image resource was provided because it's not loading the pre-loaded image that's already cached and instead trying to load (or re-load) the image entirely every time the drawImage method is called.\n\nThe error does not always occur (which suggests this is a race condition which can only occur with asynchronous events like waiting for images to load).  It's best to test with large image files as the bug will occur more often (since small image files can load rather quickly).  I tested with 200kb+ image files, with my largest being a 1.3MB image file.\n\nThe likelihood of the bug also increases with a loop and drawImage() method call like so:\n\nfor (var i=0;i<360;i++) {\n  canvas.drawImage(img, 0, 0);\n}\n\nEach loop, the image resource will be re-loaded which increases the likelihood of the race condition.\n\nReproducible: Sometimes\n\nSteps to Reproduce:\nAll steps are provided in \"Details,\" but in summary:\n\n1. Create a canvas element.  Get 2D context.\n2. Dynamically create an image object via Javascript.\n3. Specify a large (200kb+) image file to load.\n4. Add an event listener for image \"onload\" event.\n5. On image \"onload,\" call canvas.drawImage() method with pre-loaded, cached image file\n6. canvas.drawImage() will not used the cached image file but will instead try to load (or re-load) the image entirely every time the drawImage() method is called.\n7. Since image loading is asynchronous, this creates race conditions where the error does not always appear (although the likelihood of the error increases with larger image files and a loop that calls drawImage X number of times).\n8. This race condition can be easily fixed because there will be no race condition at all if canvas starts loading cached images and resources.\nActual Results:  \nAssuming the race condition occurs, this error should appear:\n\nComponent returned failure code: 0x80040111 (NS_ERROR_NOT_AVAILABLE) [nsIDOMCanvasRenderingContext2D.drawImage]\n\nExpected Results:  \nThe canvas DOM object should not be loading (or re-loading) images when the drawImage() method is called.  It should load pre-loaded and cached images where available.", "tags": [], "is_private": false, "time": "2011-01-24T22:08:59Z", "creation_time": "2011-01-24T22:08:59Z"}, {"id": 5223176, "tags": [], "is_private": false, "count": 1, "author": "rogjunk@gmail.com", "bug_id": 628394, "text": "Note that when I suggest trying it in a loop, I mean like this:\n\nvar img = new Image();\nimg.src = \"http://foo.bar/baz.widget\";\nimg.onload = function() {\n  for (var i=0;i<360;i++) {\n    canvas.drawImage(img, 0, 0);\n  }\n};\n\nYou should not create a new Image() every loop (which is more bad design than a bug).  The large image file should only need to be loaded once, but, every loop, canvas will still try and re-load it even if it's not specified (and should already be pre-loaded and cached) as in the code above.", "time": "2011-01-24T22:15:02Z", "creation_time": "2011-01-24T22:15:02Z", "attachment_id": null, "creator": "rogjunk@gmail.com", "raw_text": "Note that when I suggest trying it in a loop, I mean like this:\n\nvar img = new Image();\nimg.src = \"http://foo.bar/baz.widget\";\nimg.onload = function() {\n  for (var i=0;i<360;i++) {\n    canvas.drawImage(img, 0, 0);\n  }\n};\n\nYou should not create a new Image() every loop (which is more bad design than a bug).  The large image file should only need to be loaded once, but, every loop, canvas will still try and re-load it even if it's not specified (and should already be pre-loaded and cached) as in the code above."}, {"id": 5223226, "bug_id": 628394, "tags": [], "text": "canvas 2d or Networking:cache", "is_private": false, "time": "2011-01-24T22:24:52Z", "creation_time": "2011-01-24T22:24:52Z", "count": 2, "author": "bugzilla@mversen.de", "raw_text": "canvas 2d or Networking:cache", "creator": "bugzilla@mversen.de", "attachment_id": null}, {"creator": "bzbarsky@mit.edu", "raw_text": "This looks a lot like 574330.  If you have a page that shows this problem at all, even intermittently, I would LOVE a link to it.  I have not been able to reproduce it so far...", "attachment_id": null, "bug_id": 628394, "text": "This looks a lot like 574330.  If you have a page that shows this problem at all, even intermittently, I would LOVE a link to it.  I have not been able to reproduce it so far...", "time": "2011-01-24T22:40:43Z", "creation_time": "2011-01-24T22:40:43Z", "count": 3, "author": "bzbarsky@mit.edu", "id": 5223310, "tags": [], "is_private": false}, {"creation_time": "2011-01-24T23:23:32Z", "is_private": false, "time": "2011-01-24T23:23:32Z", "text": "Here is a surefire demo that will trigger the bug:\n\nhttp://www.zoomgamer.com/bugs/canvas.html\n\nNo need to refresh.  Just keep clicking the \"Load Image\" button after the image has been drawn to the canvas.  Image file size is 2 MB.  If you get the error, an alert box will popup with an error message.  Since there is the strong possibility of a race condition, it would obviously depend on internet speed, ping, etc.  I'm on cable modem in west coast USA.  For me, the bug occurs roughly every once in 20 times.\n\nBoris,\n\nMy apologies, it does appear to be the same bug, but the bug report you mentioned does not seem to really zero in on the bug in the amount of detail I've provided.  I specifically zero in on the strong possibility of this being a race condition and the problem being asynchronous events and how the rate of occurrence increases with the file size.", "tags": [], "bug_id": 628394, "id": 5223510, "attachment_id": null, "raw_text": "Here is a surefire demo that will trigger the bug:\n\nhttp://www.zoomgamer.com/bugs/canvas.html\n\nNo need to refresh.  Just keep clicking the \"Load Image\" button after the image has been drawn to the canvas.  Image file size is 2 MB.  If you get the error, an alert box will popup with an error message.  Since there is the strong possibility of a race condition, it would obviously depend on internet speed, ping, etc.  I'm on cable modem in west coast USA.  For me, the bug occurs roughly every once in 20 times.\n\nBoris,\n\nMy apologies, it does appear to be the same bug, but the bug report you mentioned does not seem to really zero in on the bug in the amount of detail I've provided.  I specifically zero in on the strong possibility of this being a race condition and the problem being asynchronous events and how the rate of occurrence increases with the file size.", "creator": "rogjunk@gmail.com", "author": "rogjunk@gmail.com", "count": 4}, {"is_private": false, "tags": [], "id": 5224578, "author": "bzbarsky@mit.edu", "count": 5, "creation_time": "2011-01-25T07:13:41Z", "time": "2011-01-25T07:13:41Z", "text": "I can't reproduce the bug with that testcase.  :(  I tried clicking a few hundred times, then just holding down the enter key for a while.  Tried that in both 3.6 and 4.0 beta.\n\nJust to make sure... you're seeing this problem in a profile with no extensions, right?\n\nload events are in fact async, but you're creating a new image for each click, so it's not like the src sets are racing against the load events...  and there's nothing else to race here.", "bug_id": 628394, "attachment_id": null, "creator": "bzbarsky@mit.edu", "raw_text": "I can't reproduce the bug with that testcase.  :(  I tried clicking a few hundred times, then just holding down the enter key for a while.  Tried that in both 3.6 and 4.0 beta.\n\nJust to make sure... you're seeing this problem in a profile with no extensions, right?\n\nload events are in fact async, but you're creating a new image for each click, so it's not like the src sets are racing against the load events...  and there's nothing else to race here."}, {"raw_text": "Boris,\n\nIf you've clicked 100 times and you didn't see the error, you should click refresh (the regular refresh button on Firefox and NOT a full cntrl+f5 refresh).  I find the bug occurs more often when I click 100 times, refresh, click 100 times, refresh, and so on.\n\nAlso, what kind of internet connection are you using and where are you located?  The bug may be harder to reproduce with faster internet connections if it is indeed a race condition.\n\nThe only Firefox plugins I have loaded are as follows:\n\nFirebug 1.5.4\nGoogle Toolbar for Firefox 7.1.20101113Wb1\nJava Quick Starter 1.0\nTradeManager-Plugin 1.0", "creator": "rogjunk@gmail.com", "attachment_id": null, "time": "2011-01-26T20:32:58Z", "creation_time": "2011-01-26T20:32:58Z", "bug_id": 628394, "text": "Boris,\n\nIf you've clicked 100 times and you didn't see the error, you should click refresh (the regular refresh button on Firefox and NOT a full cntrl+f5 refresh).  I find the bug occurs more often when I click 100 times, refresh, click 100 times, refresh, and so on.\n\nAlso, what kind of internet connection are you using and where are you located?  The bug may be harder to reproduce with faster internet connections if it is indeed a race condition.\n\nThe only Firefox plugins I have loaded are as follows:\n\nFirebug 1.5.4\nGoogle Toolbar for Firefox 7.1.20101113Wb1\nJava Quick Starter 1.0\nTradeManager-Plugin 1.0", "count": 6, "author": "rogjunk@gmail.com", "is_private": false, "id": 5229574, "tags": []}, {"bug_id": 628394, "text": "> Also, what kind of internet connection are you using and where are you located?\n\nI'm on the east coast (Boston-ish) on a FIOS connection.  And I did try reloading and clicking and reloading when I was testing....\n\nDo you still see the issue if you disable Firebug?", "time": "2011-01-26T20:49:29Z", "creation_time": "2011-01-26T20:49:29Z", "creator": "bzbarsky@mit.edu", "raw_text": "> Also, what kind of internet connection are you using and where are you located?\n\nI'm on the east coast (Boston-ish) on a FIOS connection.  And I did try reloading and clicking and reloading when I was testing....\n\nDo you still see the issue if you disable Firebug?", "attachment_id": null, "id": 5229635, "tags": [], "is_private": false, "count": 7, "author": "bzbarsky@mit.edu"}, {"time": "2011-01-27T01:05:28Z", "creation_time": "2011-01-27T01:05:28Z", "bug_id": 628394, "text": "Disabled and uninstalled Firebug and I still see the issue.  Disabled (but did not uninstall) the rest of the plugins and I also still see the issue.\n\nStrangely enough, on WinXP Firefox 3.5, I see this issue.\n\nOn Windows Vista Firefox 3.5.8, I did not see this issue after 250 clicks on the \"Load Image\" button (Firebug had never been installed on this machine).  The only plugins on this machine are Microsoft .NET Framework Assistant 1.0 (which I can't enable since it says it's not compatible with Firefox 3.5.8) and Movie Media Player 1.0.0.%(version)s (which is the only plugin that appears to be enabled).", "attachment_id": null, "raw_text": "Disabled and uninstalled Firebug and I still see the issue.  Disabled (but did not uninstall) the rest of the plugins and I also still see the issue.\n\nStrangely enough, on WinXP Firefox 3.5, I see this issue.\n\nOn Windows Vista Firefox 3.5.8, I did not see this issue after 250 clicks on the \"Load Image\" button (Firebug had never been installed on this machine).  The only plugins on this machine are Microsoft .NET Framework Assistant 1.0 (which I can't enable since it says it's not compatible with Firefox 3.5.8) and Movie Media Player 1.0.0.%(version)s (which is the only plugin that appears to be enabled).", "creator": "rogjunk@gmail.com", "is_private": false, "id": 5230645, "tags": [], "count": 8, "author": "rogjunk@gmail.com"}, {"attachment_id": null, "creator": "bzbarsky@mit.edu", "raw_text": "Hmm.  I'll keep trying to reproduce, I guess, but I haven't managed to yet.  And code auditing suggests there's no way this should be able to happen.... which means I'm clearly missing something.", "bug_id": 628394, "text": "Hmm.  I'll keep trying to reproduce, I guess, but I haven't managed to yet.  And code auditing suggests there's no way this should be able to happen.... which means I'm clearly missing something.", "time": "2011-01-27T02:21:21Z", "creation_time": "2011-01-27T02:21:21Z", "count": 9, "author": "bzbarsky@mit.edu", "id": 5230870, "tags": [], "is_private": false}, {"author": "moonix.uk@gmail.com", "count": 10, "creator": "moonix.uk@gmail.com", "raw_text": "I'm getting the same problem as well, with canvas not loading the background image. This happens every time the page is loaded, but is resolved by refreshing the page.\n\n\nhttp://meepnix.github.com/HTML5_rocket/", "attachment_id": null, "tags": [], "text": "I'm getting the same problem as well, with canvas not loading the background image. This happens every time the page is loaded, but is resolved by refreshing the page.\n\n\nhttp://meepnix.github.com/HTML5_rocket/", "id": 5252180, "bug_id": 628394, "creation_time": "2011-02-03T19:22:38Z", "time": "2011-02-03T19:22:38Z", "is_private": false}, {"is_private": false, "time": "2011-02-03T19:32:31Z", "creation_time": "2011-02-03T19:32:31Z", "bug_id": 628394, "id": 5252211, "text": "Chris, that page works for me too... and in any case, since you repaint the image every 20ms instead of waiting for it to load, whatever you're seeing is different from the issue that this bug was reported on.", "tags": [], "attachment_id": null, "raw_text": "Chris, that page works for me too... and in any case, since you repaint the image every 20ms instead of waiting for it to load, whatever you're seeing is different from the issue that this bug was reported on.", "creator": "bzbarsky@mit.edu", "count": 11, "author": "bzbarsky@mit.edu"}, {"is_private": false, "tags": [], "id": 5256196, "author": "rogjunk@gmail.com", "count": 12, "creation_time": "2011-02-04T21:17:48Z", "time": "2011-02-04T21:17:48Z", "text": "This bug should ideally be fixed before Firefox 4 comes out of beta.  A lot of users are reporting this problem with canvas.\n\nIf anyone else is experiencing this bug, it would be best to post your system specs, connection and Firefox version so we can narrow down the bug.", "bug_id": 628394, "creator": "rogjunk@gmail.com", "raw_text": "This bug should ideally be fixed before Firefox 4 comes out of beta.  A lot of users are reporting this problem with canvas.\n\nIf anyone else is experiencing this bug, it would be best to post your system specs, connection and Firefox version so we can narrow down the bug.", "attachment_id": null}, {"time": "2021-09-25T19:20:15Z", "is_private": false, "creation_time": "2021-09-25T19:20:15Z", "bug_id": 628394, "id": 15584444, "text": "I think this bug fix after Firefox 4.5 come out. i had this bug on https://hexrom.com/roms/gamecube/ and when update to new version its work.", "tags": [], "attachment_id": null, "creator": "h.res6668@gmail.com", "raw_text": "I think this bug fix after Firefox 4.5 come out. i had this bug on https://hexrom.com/roms/gamecube/ and when update to new version its work.", "count": 13, "author": "h.res6668@gmail.com"}]}}}