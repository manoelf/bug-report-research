{"bugs": {"702892": {"comments": [{"creation_time": "2011-11-16T07:48:41Z", "raw_text": "I still encounter some gif problem after bug666446 fixed, \nhttps://bugzilla.mozilla.org/show_bug.cgi?id=666446#c474\n\nWin 7 sp1, with or without Hardware Acceleration, it can reproduce everytime with a fresh profile.\n\n1.open below links, it has some gif smiley faces.\nhttp://forums.mozillazine.org/posting.php?mode=smilies&f=38\nat the beginning, CPU usage is 0%\n\n2.keep that tab, and load some more pages. As for me, I open a bookmarks folder, it has MSN, Yahoo!, Sina... attachment is the bookmark backup\n\n3.wait those tab loaded, then surf a while, close every tabs except the smiley face tab.\n\n4.CPU usage is around 10% now. and it will not come down after Garbage Collection.\n\n0% and 10% is on my AMD x3 445 CPU, with cool'n'quite enabled, so it more significant(running on 800MHz when idle), if I disabled cool'n'quite, the situation remain, only the number change, form 0%->10% to 0%->4%", "text": "I still encounter some gif problem after bug666446 fixed, \nhttps://bugzilla.mozilla.org/show_bug.cgi?id=666446#c474\n\nWin 7 sp1, with or without Hardware Acceleration, it can reproduce everytime with a fresh profile.\n\n1.open below links, it has some gif smiley faces.\nhttp://forums.mozillazine.org/posting.php?mode=smilies&f=38\nat the beginning, CPU usage is 0%\n\n2.keep that tab, and load some more pages. As for me, I open a bookmarks folder, it has MSN, Yahoo!, Sina... attachment is the bookmark backup\n\n3.wait those tab loaded, then surf a while, close every tabs except the smiley face tab.\n\n4.CPU usage is around 10% now. and it will not come down after Garbage Collection.\n\n0% and 10% is on my AMD x3 445 CPU, with cool'n'quite enabled, so it more significant(running on 800MHz when idle), if I disabled cool'n'quite, the situation remain, only the number change, form 0%->10% to 0%->4%", "attachment_id": null, "time": "2011-11-16T07:48:41Z", "count": 0, "is_private": false, "tags": [], "id": 5851962, "bug_id": 702892, "creator": "dindog@163.com", "author": "dindog@163.com"}, {"bug_id": 702892, "id": 5851965, "tags": [], "count": 1, "is_private": false, "attachment_id": 574817, "time": "2011-11-16T07:49:25Z", "text": "Created attachment 574817\nbookmark to reproduce", "raw_text": "", "creation_time": "2011-11-16T07:49:25Z", "author": "dindog@163.com", "creator": "dindog@163.com"}, {"id": 5852008, "tags": [], "count": 2, "is_private": false, "bug_id": 702892, "raw_text": "Win7 x64 Nightly 11.0a1 (2011-11-15)\n\nNot able to reproduce this bug.", "creation_time": "2011-11-16T08:29:24Z", "attachment_id": null, "time": "2011-11-16T08:29:24Z", "text": "Win7 x64 Nightly 11.0a1 (2011-11-15)\n\nNot able to reproduce this bug.", "author": "thomas.harfmann@gmail.com", "creator": "thomas.harfmann@gmail.com"}, {"id": 5853438, "count": 3, "is_private": false, "tags": [], "bug_id": 702892, "raw_text": "I'm also not able to reproduce this bug, after trying the exact steps indicated by dindog@163.com.\n\nWin7 x64, intel Core i7-2820QM CPU @ 2.30 GHz, 8.0 GB RAM\nMozilla/5.0 (Windows NT 6.1; Win64; x64; rv:11.0a1) Gecko/20111116 Firefox/11.0a1", "creation_time": "2011-11-16T20:59:56Z", "time": "2011-11-16T20:59:56Z", "attachment_id": null, "text": "I'm also not able to reproduce this bug, after trying the exact steps indicated by dindog@163.com.\n\nWin7 x64, intel Core i7-2820QM CPU @ 2.30 GHz, 8.0 GB RAM\nMozilla/5.0 (Windows NT 6.1; Win64; x64; rv:11.0a1) Gecko/20111116 Firefox/11.0a1", "author": "jaywir3@gmail.com", "creator": "jaywir3@gmail.com"}, {"author": "dholbert@mozilla.com", "creator": "dholbert@mozilla.com", "raw_text": "(In reply to dindog from comment #0)\n> 3.wait those tab loaded, then surf a while, close every tabs except the\n> smiley face tab.\n> \n> 4.CPU usage is around 10% now. and it will not come down after Garbage\n> Collection.\n[...]\n> if I disabled cool'n'quite, the situation remain, only the number change, form 0%->10% to 0%->4%\n\nThis doesn't seem too odd to me -- animating all those smileys does take _some_ CPU. 4% / 10% doesn't seem unreasonable.\n\nFor comparison, what's your CPU usage when you first load the smiley tab (and have it in the foreground)?", "creation_time": "2011-11-16T22:34:02Z", "attachment_id": null, "time": "2011-11-16T22:34:02Z", "text": "(In reply to dindog from comment #0)\n> 3.wait those tab loaded, then surf a while, close every tabs except the\n> smiley face tab.\n> \n> 4.CPU usage is around 10% now. and it will not come down after Garbage\n> Collection.\n[...]\n> if I disabled cool'n'quite, the situation remain, only the number change, form 0%->10% to 0%->4%\n\nThis doesn't seem too odd to me -- animating all those smileys does take _some_ CPU. 4% / 10% doesn't seem unreasonable.\n\nFor comparison, what's your CPU usage when you first load the smiley tab (and have it in the foreground)?", "id": 5853740, "count": 4, "is_private": false, "tags": [], "bug_id": 702892}, {"bug_id": 702892, "id": 5853770, "tags": [], "count": 5, "is_private": false, "author": "dholbert@mozilla.com", "time": "2011-11-16T22:45:03Z", "attachment_id": null, "creator": "dholbert@mozilla.com", "text": "Ah, so you did say \"at the beginning, CPU usage is 0%\".\n\nIs that even after the smiley page has loaded completely and is in the foreground?  (That would surprise me a little -- I get continuous ~8-13% CPU usage, after loading that page in a fresh tab with a new profile.)", "creation_time": "2011-11-16T22:45:03Z", "raw_text": "Ah, so you did say \"at the beginning, CPU usage is 0%\".\n\nIs that even after the smiley page has loaded completely and is in the foreground?  (That would surprise me a little -- I get continuous ~8-13% CPU usage, after loading that page in a fresh tab with a new profile.)"}, {"creator": "dindog@163.com", "author": "dindog@163.com", "creation_time": "2011-11-17T00:07:50Z", "raw_text": "(In reply to Daniel Holbert [:dholbert] from comment #5)\n> Is that even after the smiley page has loaded completely and is in the\n> foreground?  (That would surprise me a little -- I get continuous ~8-13% CPU\n> usage, after loading that page in a fresh tab with a new profile.)\nIt only happen when the GIF page in foreground, and it not necessary to be one never close, I just put it that way to be clear: a untouched tab some how took more CPU.\n\nabout:blank has 0%-1% CPU usage (maybe Firefox has some background action)", "text": "(In reply to Daniel Holbert [:dholbert] from comment #5)\n> Is that even after the smiley page has loaded completely and is in the\n> foreground?  (That would surprise me a little -- I get continuous ~8-13% CPU\n> usage, after loading that page in a fresh tab with a new profile.)\nIt only happen when the GIF page in foreground, and it not necessary to be one never close, I just put it that way to be clear: a untouched tab some how took more CPU.\n\nabout:blank has 0%-1% CPU usage (maybe Firefox has some background action)", "attachment_id": null, "time": "2011-11-17T00:07:50Z", "tags": [], "count": 6, "is_private": false, "id": 5854002, "bug_id": 702892}, {"id": 5854170, "tags": [], "count": 7, "is_private": false, "bug_id": 702892, "raw_text": "So the bug that you're reporting here is that there's larger-than-1% CPU usage (maybe 10%), when you're looking at a page with 20+ animated gifs in the foreground?\n\nThat sounds like the expected/correct behavior, and I think this is how we've always behaved. (It's not a \"regression after Bug 666446 landed\").\n\nNote that Bug 666446 *did* make it so animated GIFs don't consume CPU when they're in *background* tabs.  But they'll still consume CPU (as they always have) in foreground tabs.\n\nSo I think this is INVALID, unless I'm misunderstanding you.", "creation_time": "2011-11-17T01:07:25Z", "time": "2011-11-17T01:07:25Z", "attachment_id": null, "text": "So the bug that you're reporting here is that there's larger-than-1% CPU usage (maybe 10%), when you're looking at a page with 20+ animated gifs in the foreground?\n\nThat sounds like the expected/correct behavior, and I think this is how we've always behaved. (It's not a \"regression after Bug 666446 landed\").\n\nNote that Bug 666446 *did* make it so animated GIFs don't consume CPU when they're in *background* tabs.  But they'll still consume CPU (as they always have) in foreground tabs.\n\nSo I think this is INVALID, unless I'm misunderstanding you.", "author": "dholbert@mozilla.com", "creator": "dholbert@mozilla.com"}, {"bug_id": 702892, "is_private": false, "count": 8, "tags": [], "id": 5854799, "text": "@Daniel Holbert\nIt also could have to do with some sort of speed-step or with AMD P-states. A CPU running at e.g 800 MHz will always show higher load than an unthrottled CPU running at e.g. 3200 MHz.", "attachment_id": null, "time": "2011-11-17T08:20:19Z", "raw_text": "@Daniel Holbert\nIt also could have to do with some sort of speed-step or with AMD P-states. A CPU running at e.g 800 MHz will always show higher load than an unthrottled CPU running at e.g. 3200 MHz.", "creation_time": "2011-11-17T08:20:19Z", "creator": "thomas.harfmann@gmail.com", "author": "thomas.harfmann@gmail.com"}, {"bug_id": 702892, "is_private": false, "count": 9, "tags": [], "id": 5855522, "text": "(In reply to Daniel Holbert [:dholbert] from comment #7)\n> So the bug that you're reporting here is that there's larger-than-1% CPU\n> usage (maybe 10%), when you're looking at a page with 20+ animated gifs in\n> the foreground?\nnot exactly, what I mean is: it took almost 0% CPU usage, then after a while, it took a couple times more on SAME page with gifs, and of course before & after the tab is foreground", "attachment_id": null, "time": "2011-11-17T17:07:56Z", "raw_text": "(In reply to Daniel Holbert [:dholbert] from comment #7)\n> So the bug that you're reporting here is that there's larger-than-1% CPU\n> usage (maybe 10%), when you're looking at a page with 20+ animated gifs in\n> the foreground?\nnot exactly, what I mean is: it took almost 0% CPU usage, then after a while, it took a couple times more on SAME page with gifs, and of course before & after the tab is foreground", "creation_time": "2011-11-17T17:07:56Z", "creator": "dindog@163.com", "author": "dindog@163.com"}, {"raw_text": "(In reply to dindog from comment #9)\n> not exactly, what I mean is: it took almost 0% CPU usage\n\nWith the animated-gif tab in the foreground?", "creation_time": "2011-11-18T01:47:44Z", "text": "(In reply to dindog from comment #9)\n> not exactly, what I mean is: it took almost 0% CPU usage\n\nWith the animated-gif tab in the foreground?", "attachment_id": null, "time": "2011-11-18T01:47:44Z", "tags": [], "is_private": false, "count": 10, "id": 5857113, "bug_id": 702892, "creator": "dholbert@mozilla.com", "author": "dholbert@mozilla.com"}, {"creator": "dindog@163.com", "author": "dindog@163.com", "text": "(In reply to Daniel Holbert [:dholbert] from comment #10)\n> (In reply to dindog from comment #9)\n> > not exactly, what I mean is: it took almost 0% CPU usage\n> \n> With the animated-gif tab in the foreground?\nYes, that simlies page tab in the foreground, 0% CPU usage, in fact, I am looking at the Task Manager right now, it say 0% when I not typing, and CPU-z show CPU's running on 800MHz", "time": "2011-11-18T03:20:21Z", "attachment_id": null, "raw_text": "(In reply to Daniel Holbert [:dholbert] from comment #10)\n> (In reply to dindog from comment #9)\n> > not exactly, what I mean is: it took almost 0% CPU usage\n> \n> With the animated-gif tab in the foreground?\nYes, that simlies page tab in the foreground, 0% CPU usage, in fact, I am looking at the Task Manager right now, it say 0% when I not typing, and CPU-z show CPU's running on 800MHz", "creation_time": "2011-11-18T03:20:21Z", "bug_id": 702892, "is_private": false, "count": 11, "tags": [], "id": 5857261}, {"creator": "dindog@163.com", "author": "dindog@163.com", "bug_id": 702892, "tags": [], "count": 12, "is_private": false, "id": 5857262, "text": "Created attachment 575366\nscreenshot", "time": "2011-11-18T03:21:21Z", "attachment_id": 575366, "creation_time": "2011-11-18T03:21:21Z", "raw_text": ""}, {"bug_id": 702892, "tags": [], "is_private": false, "count": 13, "id": 5857272, "text": "OK thanks for confirming that. That's very odd -- I'd expect that we'd be using a nonzero amount of CPU to animate those GIFs.\n\nSo, when you switch back to the tab, we probably do have to re-decode all the images, which takes some CPU -- I'd expect that to be pretty short CPU hit, though.", "attachment_id": null, "time": "2011-11-18T03:29:39Z", "raw_text": "OK thanks for confirming that. That's very odd -- I'd expect that we'd be using a nonzero amount of CPU to animate those GIFs.\n\nSo, when you switch back to the tab, we probably do have to re-decode all the images, which takes some CPU -- I'd expect that to be pretty short CPU hit, though.", "creation_time": "2011-11-18T03:29:39Z", "creator": "dholbert@mozilla.com", "author": "dholbert@mozilla.com"}, {"author": "dindog@163.com", "creator": "dindog@163.com", "attachment_id": null, "time": "2011-11-18T07:56:19Z", "text": "(In reply to Daniel Holbert [:dholbert] from comment #13)\n> OK thanks for confirming that. That's very odd -- I'd expect that we'd be\n> using a nonzero amount of CPU to animate those GIFs.\n> \n> So, when you switch back to the tab, we probably do have to re-decode all\n> the images, which takes some CPU -- I'd expect that to be pretty short CPU\n> hit, though.\n\nI don't think it is related to decode image. I reproduce the issue even I open two in-maximized windows, and make the GIF one always being displayed.\n\nIt's odd, and now I found a easier way to reproduce it, which make it look more weird: any page call for Flash plugin. If I disable Flash plugin, the issue fixed, it that possible?\n\nMy Flash plugin version is: 11.1.102.55, 32bit.", "raw_text": "(In reply to Daniel Holbert [:dholbert] from comment #13)\n> OK thanks for confirming that. That's very odd -- I'd expect that we'd be\n> using a nonzero amount of CPU to animate those GIFs.\n> \n> So, when you switch back to the tab, we probably do have to re-decode all\n> the images, which takes some CPU -- I'd expect that to be pretty short CPU\n> hit, though.\n\nI don't think it is related to decode image. I reproduce the issue even I open two in-maximized windows, and make the GIF one always being displayed.\n\nIt's odd, and now I found a easier way to reproduce it, which make it look more weird: any page call for Flash plugin. If I disable Flash plugin, the issue fixed, it that possible?\n\nMy Flash plugin version is: 11.1.102.55, 32bit.", "creation_time": "2011-11-18T07:56:19Z", "bug_id": 702892, "id": 5857574, "count": 14, "is_private": false, "tags": []}, {"bug_id": 702892, "id": 5857602, "count": 15, "is_private": false, "tags": [], "time": "2011-11-18T08:12:12Z", "attachment_id": null, "text": "Update, I test page with another two popular plugins: Silverlight v4.60831.0 & Windows Media Player Plugin(ns-mswmp v1.0.0.8), both are clean.\n\nAnd roll back to Flash plugin version 10.3.181.34 don't help. Though it looks freak, but that explain why at the beginning, CPU usage was low, cause it only trigger when there are page need Flash plugin.", "raw_text": "Update, I test page with another two popular plugins: Silverlight v4.60831.0 & Windows Media Player Plugin(ns-mswmp v1.0.0.8), both are clean.\n\nAnd roll back to Flash plugin version 10.3.181.34 don't help. Though it looks freak, but that explain why at the beginning, CPU usage was low, cause it only trigger when there are page need Flash plugin.", "creation_time": "2011-11-18T08:12:12Z", "author": "dindog@163.com", "creator": "dindog@163.com"}, {"attachment_id": null, "time": "2011-11-18T12:32:20Z", "author": "dindog@163.com", "creator": "dindog@163.com", "text": "A Windows XP sp3 machine, the CPU is Celeron 4 2.8GHz(single core), can reproduce the issue, and it more obvious for its slower single core CPU.\n\nAnd it's probably not a regression of bug 666446, since I can reproduce it in Firefox 9beta, which don't have the bug 666446's fixed, it the bug 666446 fixed make this more prominent. It should block bug 595671 instead.\n\nIt seem Linux is not affected... quick test on a fedora 14 Virtual Machine + Nightly, maybe some Linux user could provide some feedback.", "creation_time": "2011-11-18T12:32:20Z", "raw_text": "A Windows XP sp3 machine, the CPU is Celeron 4 2.8GHz(single core), can reproduce the issue, and it more obvious for its slower single core CPU.\n\nAnd it's probably not a regression of bug 666446, since I can reproduce it in Firefox 9beta, which don't have the bug 666446's fixed, it the bug 666446 fixed make this more prominent. It should block bug 595671 instead.\n\nIt seem Linux is not affected... quick test on a fedora 14 Virtual Machine + Nightly, maybe some Linux user could provide some feedback.", "bug_id": 702892, "id": 5857895, "is_private": false, "count": 16, "tags": []}, {"creator": "dindog@163.com", "author": "dindog@163.com", "tags": [], "is_private": false, "count": 17, "id": 5865209, "bug_id": 702892, "raw_text": "I have new discovery. This bug should rephrase as \"Firefox take much more CPU usage to display GIFs when system runs other media processes\"\n\nStep to reproduce:\n1. Disable Flash plugin\n2. Open page with GIF, eg\nhttp://forums.mozillazine.org/posting.php?mode=smilies&f=38\n3. Observe Firefox process in task manager when it's stabilized.\n4. Run media player(VLC player, KMPlyaer, MPC-HC, winamp almost everyone I test do the job.)  to play a movie or MP3 song.\n5. Observe Firefox process's CPU usage now... it should be times of step2.\n6. Close the media player process, Firefox's CPU usage back to normal.\n\nFlash video also a media player and do the same. But by default, the plugins-container.exe process never terminates by in a Firefox life-time process, so I seem like after play a Flash video, the GIFs page CPU usage bump up. Step 1 disabled flash plugin in case it's activated, deluding the outcome.\n\nI ask people around to do similar test, and have more confirms.\n\nShould I file a new bug?", "creation_time": "2011-11-22T14:03:19Z", "text": "I have new discovery. This bug should rephrase as \"Firefox take much more CPU usage to display GIFs when system runs other media processes\"\n\nStep to reproduce:\n1. Disable Flash plugin\n2. Open page with GIF, eg\nhttp://forums.mozillazine.org/posting.php?mode=smilies&f=38\n3. Observe Firefox process in task manager when it's stabilized.\n4. Run media player(VLC player, KMPlyaer, MPC-HC, winamp almost everyone I test do the job.)  to play a movie or MP3 song.\n5. Observe Firefox process's CPU usage now... it should be times of step2.\n6. Close the media player process, Firefox's CPU usage back to normal.\n\nFlash video also a media player and do the same. But by default, the plugins-container.exe process never terminates by in a Firefox life-time process, so I seem like after play a Flash video, the GIFs page CPU usage bump up. Step 1 disabled flash plugin in case it's activated, deluding the outcome.\n\nI ask people around to do similar test, and have more confirms.\n\nShould I file a new bug?", "time": "2011-11-22T14:03:19Z", "attachment_id": null}, {"bug_id": 702892, "id": 5865262, "tags": [], "count": 18, "is_private": false, "time": "2011-11-22T14:25:52Z", "attachment_id": null, "text": "> 5. Observe Firefox process's CPU usage now... it should be times of step2.\n\nNo it isn't.\n\nFF 11.0a1 (2011-11-21) Win7 x64.", "raw_text": "> 5. Observe Firefox process's CPU usage now... it should be times of step2.\n\nNo it isn't.\n\nFF 11.0a1 (2011-11-21) Win7 x64.", "creation_time": "2011-11-22T14:25:52Z", "author": "thomas.harfmann@gmail.com", "creator": "thomas.harfmann@gmail.com"}, {"creator": "jmjjeffery@gmail.com", "author": "jmjjeffery@gmail.com", "creation_time": "2011-11-22T15:40:08Z", "raw_text": "Confirming:\nStart with a new profile, no addons, history etc..\n\nSTR:\n1. visit the GIF page in comment #17\n2. Note in the Task Manager that the CPU is 0%\n3. Visit http://www.cnn.com note CPU usage in Task manager\n4. Close the CNN page - the plug-in container will remain of course \n5. Note the Task Manager for Firefox now shows some CPU use (5-6% on my system) when the tab with the GIF's is 'active', as opposed to what was observed in step 2, the CPU is 0% when nothing else is loaded, i.e. fresh start there is no container spawned.\n\nExpected:  Spawning of a plug-in container should not affect CPU use when the container is inactive.\n\nTested on Win7 x64 AMD Phenom II Quad, 8gig RAM, HD3200 on-board video\nlatest hourly build from m-c cset:\nhttp://hg.mozilla.org/mozilla-central/rev/243515ec2ad3", "text": "Confirming:\nStart with a new profile, no addons, history etc..\n\nSTR:\n1. visit the GIF page in comment #17\n2. Note in the Task Manager that the CPU is 0%\n3. Visit http://www.cnn.com note CPU usage in Task manager\n4. Close the CNN page - the plug-in container will remain of course \n5. Note the Task Manager for Firefox now shows some CPU use (5-6% on my system) when the tab with the GIF's is 'active', as opposed to what was observed in step 2, the CPU is 0% when nothing else is loaded, i.e. fresh start there is no container spawned.\n\nExpected:  Spawning of a plug-in container should not affect CPU use when the container is inactive.\n\nTested on Win7 x64 AMD Phenom II Quad, 8gig RAM, HD3200 on-board video\nlatest hourly build from m-c cset:\nhttp://hg.mozilla.org/mozilla-central/rev/243515ec2ad3", "time": "2011-11-22T15:40:08Z", "attachment_id": null, "tags": [], "is_private": false, "count": 19, "id": 5865421, "bug_id": 702892}, {"bug_id": 702892, "count": 20, "is_private": false, "tags": [], "id": 5865803, "text": "(In reply to dindog from comment #17)\n> I have new discovery. This bug should rephrase as \"Firefox take much more\n> CPU usage to display GIFs when system runs other media processes\"\n\nAh!  That's interesting.  Given that, I have a hypothesis about what's going on.\n\nI'm not sure if GIF drawing is graphics-card-accelerated, but assuming that it is -- I bet  your Firefox process is initially benefiting from the graphics card (that's why you have 0% CPU usage where I have more, per comment 5), but when you start some other media process, that boots Firefox off of the graphics card (or shares it), and we have to use the CPU instead.", "attachment_id": null, "time": "2011-11-22T17:54:46Z", "raw_text": "(In reply to dindog from comment #17)\n> I have new discovery. This bug should rephrase as \"Firefox take much more\n> CPU usage to display GIFs when system runs other media processes\"\n\nAh!  That's interesting.  Given that, I have a hypothesis about what's going on.\n\nI'm not sure if GIF drawing is graphics-card-accelerated, but assuming that it is -- I bet  your Firefox process is initially benefiting from the graphics card (that's why you have 0% CPU usage where I have more, per comment 5), but when you start some other media process, that boots Firefox off of the graphics card (or shares it), and we have to use the CPU instead.", "creation_time": "2011-11-22T17:54:46Z", "creator": "dholbert@mozilla.com", "author": "dholbert@mozilla.com"}, {"creation_time": "2011-11-22T17:57:25Z", "raw_text": "(clarifying summary, per comment 16 - 17)", "text": "(clarifying summary, per comment 16 - 17)", "attachment_id": null, "time": "2011-11-22T17:57:25Z", "tags": [], "count": 21, "is_private": false, "id": 5865816, "bug_id": 702892, "creator": "dholbert@mozilla.com", "author": "dholbert@mozilla.com"}, {"creation_time": "2011-11-22T18:42:01Z", "raw_text": "CC'ing jrmuizel in the hopes that he can confirm whether comment 20 makes sense.", "text": "CC'ing jrmuizel in the hopes that he can confirm whether comment 20 makes sense.", "attachment_id": null, "time": "2011-11-22T18:42:01Z", "count": 22, "is_private": false, "tags": [], "id": 5865949, "bug_id": 702892, "creator": "dholbert@mozilla.com", "author": "dholbert@mozilla.com"}, {"author": "dindog@163.com", "creator": "dindog@163.com", "time": "2011-11-23T02:30:38Z", "attachment_id": null, "text": "(In reply to Daniel Holbert [:dholbert] from comment #20)\n> (In reply to dindog from comment #17)\n> > I have new discovery. This bug should rephrase as \"Firefox take much more\n> > CPU usage to display GIFs when system runs other media processes\"\n> \n> Ah!  That's interesting.  Given that, I have a hypothesis about what's going\n> on.\n> \n> I'm not sure if GIF drawing is graphics-card-accelerated, but assuming that\n> it is -- I bet  your Firefox process is initially benefiting from the\n> graphics card (that's why you have 0% CPU usage where I have more, per\n> comment 5), but when you start some other media process, that boots Firefox\n> off of the graphics card (or shares it), and we have to use the CPU instead.\nwith gfx.direct2d.disabled: true, the issue remain, :(", "raw_text": "(In reply to Daniel Holbert [:dholbert] from comment #20)\n> (In reply to dindog from comment #17)\n> > I have new discovery. This bug should rephrase as \"Firefox take much more\n> > CPU usage to display GIFs when system runs other media processes\"\n> \n> Ah!  That's interesting.  Given that, I have a hypothesis about what's going\n> on.\n> \n> I'm not sure if GIF drawing is graphics-card-accelerated, but assuming that\n> it is -- I bet  your Firefox process is initially benefiting from the\n> graphics card (that's why you have 0% CPU usage where I have more, per\n> comment 5), but when you start some other media process, that boots Firefox\n> off of the graphics card (or shares it), and we have to use the CPU instead.\nwith gfx.direct2d.disabled: true, the issue remain, :(", "creation_time": "2011-11-23T02:30:38Z", "bug_id": 702892, "id": 5867491, "tags": [], "count": 23, "is_private": false}, {"author": "dholbert@mozilla.com", "creator": "dholbert@mozilla.com", "raw_text": "(In reply to dindog from comment #23)\n> with gfx.direct2d.disabled: true, the issue remain, :(\n\nWhat does \"the issue remain\" mean here?\n\nBased on my hypothesis, I'd expect that after disabling direct2d, your Firefox CPU usage would now be nonzero when you first load the smiley page and have it in the foreground, and it shouldn't really change much from its baseline value. (regardless of whether other programs are playing media).\n\nIs that correct?", "creation_time": "2011-11-23T02:47:58Z", "time": "2011-11-23T02:47:58Z", "attachment_id": null, "text": "(In reply to dindog from comment #23)\n> with gfx.direct2d.disabled: true, the issue remain, :(\n\nWhat does \"the issue remain\" mean here?\n\nBased on my hypothesis, I'd expect that after disabling direct2d, your Firefox CPU usage would now be nonzero when you first load the smiley page and have it in the foreground, and it shouldn't really change much from its baseline value. (regardless of whether other programs are playing media).\n\nIs that correct?", "id": 5867518, "count": 24, "is_private": false, "tags": [], "bug_id": 702892}, {"creation_time": "2011-11-23T02:50:00Z", "raw_text": "There are other types of hardware acceleration beyond d2d, no?", "text": "There are other types of hardware acceleration beyond d2d, no?", "attachment_id": null, "time": "2011-11-23T02:50:00Z", "tags": [], "count": 25, "is_private": false, "id": 5867521, "bug_id": 702892, "creator": "khuey@kylehuey.com", "author": "khuey@kylehuey.com"}, {"creator": "dindog@163.com", "author": "dindog@163.com", "tags": [], "count": 26, "is_private": false, "id": 5867550, "bug_id": 702892, "raw_text": "(In reply to Daniel Holbert [:dholbert] from comment #24)\n> (In reply to dindog from comment #23)\n> > with gfx.direct2d.disabled: true, the issue remain, :(\n> \n> What does \"the issue remain\" mean here?\n> \n> Based on my hypothesis, I'd expect that after disabling direct2d, your\n> Firefox CPU usage would now be nonzero when you first load the smiley page\n> and have it in the foreground, and it shouldn't really change much from its\n> baseline value. (regardless of whether other programs are playing media).\n> \n> Is that correct?\n\nI first found this with my everyday profile, which gfx.direct2d.disabled always set true.\n\nI got 0% with or without direct2d acceleration enabled at the beginning.\n\nAnd I want to point out that you can't reproduce this bug by opening another Firefox instance with -no-remote and leaving the existed instance, because the existed instance probably has activated flash plugins. And that will give your wrong result. Please close all media application and Firefox instance before you test it.\n\nAnd I test Firefox 3.6.24, which definitely has no Hardware Acceleration, 0% at the beginning.", "creation_time": "2011-11-23T03:06:24Z", "text": "(In reply to Daniel Holbert [:dholbert] from comment #24)\n> (In reply to dindog from comment #23)\n> > with gfx.direct2d.disabled: true, the issue remain, :(\n> \n> What does \"the issue remain\" mean here?\n> \n> Based on my hypothesis, I'd expect that after disabling direct2d, your\n> Firefox CPU usage would now be nonzero when you first load the smiley page\n> and have it in the foreground, and it shouldn't really change much from its\n> baseline value. (regardless of whether other programs are playing media).\n> \n> Is that correct?\n\nI first found this with my everyday profile, which gfx.direct2d.disabled always set true.\n\nI got 0% with or without direct2d acceleration enabled at the beginning.\n\nAnd I want to point out that you can't reproduce this bug by opening another Firefox instance with -no-remote and leaving the existed instance, because the existed instance probably has activated flash plugins. And that will give your wrong result. Please close all media application and Firefox instance before you test it.\n\nAnd I test Firefox 3.6.24, which definitely has no Hardware Acceleration, 0% at the beginning.", "attachment_id": null, "time": "2011-11-23T03:06:24Z"}, {"author": "joe@drew.ca", "creator": "joe@drew.ca", "attachment_id": null, "time": "2011-11-23T16:24:10Z", "text": "(In reply to Daniel Holbert [:dholbert] from comment #20)\n> I'm not sure if GIF drawing is graphics-card-accelerated, but assuming that\n> it is -- I bet  your Firefox process is initially benefiting from the\n> graphics card (that's why you have 0% CPU usage where I have more, per\n> comment 5), but when you start some other media process, that boots Firefox\n> off of the graphics card (or shares it), and we have to use the CPU instead.\n\nThe only acceleration that GIF drawing has is in the final compositing step, which is accelerated with Direct3D 9 or 10 on Windows. If you go into your Advanced Firefox preferences, and uncheck \"use hardware acceleration when available\", you can test with no hardware acceleration at all.\n\nBut the actual GIF frame-drawing code is done on the CPU 100% of the time.\n\n(It could make some sense that we get paged off the graphics card, yes, but at worst that would lead to us reuploading our textures, etc. We shouldn't do any work on the CPU.)\n\nThe next step for this bug needs to be someone doing a profile on Firefox when it's using 0% of the CPU, and a separate profile when it's using ~10%ish (i.e., when Flash is instantiated). To do this, you'll likely need to do a build on your local computer with --enable-profiling, so it's probably easiest to get a developer to reproduce this problem.", "raw_text": "(In reply to Daniel Holbert [:dholbert] from comment #20)\n> I'm not sure if GIF drawing is graphics-card-accelerated, but assuming that\n> it is -- I bet  your Firefox process is initially benefiting from the\n> graphics card (that's why you have 0% CPU usage where I have more, per\n> comment 5), but when you start some other media process, that boots Firefox\n> off of the graphics card (or shares it), and we have to use the CPU instead.\n\nThe only acceleration that GIF drawing has is in the final compositing step, which is accelerated with Direct3D 9 or 10 on Windows. If you go into your Advanced Firefox preferences, and uncheck \"use hardware acceleration when available\", you can test with no hardware acceleration at all.\n\nBut the actual GIF frame-drawing code is done on the CPU 100% of the time.\n\n(It could make some sense that we get paged off the graphics card, yes, but at worst that would lead to us reuploading our textures, etc. We shouldn't do any work on the CPU.)\n\nThe next step for this bug needs to be someone doing a profile on Firefox when it's using 0% of the CPU, and a separate profile when it's using ~10%ish (i.e., when Flash is instantiated). To do this, you'll likely need to do a build on your local computer with --enable-profiling, so it's probably easiest to get a developer to reproduce this problem.", "creation_time": "2011-11-23T16:24:10Z", "bug_id": 702892, "id": 5868541, "tags": [], "count": 27, "is_private": false}]}}, "comments": {}}